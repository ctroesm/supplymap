/*! For license information please see main.20efbd2b.js.LICENSE.txt */
(()=>{var e={4:(e,t,n)=>{"use strict";var i=n(853),r=n(43),o=n(950);function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(l(e)!==e)throw Error(s(188))}function h(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=h(e)))return t;e=e.sibling}return null}var d=Object.assign,f=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),x=Symbol.for("react.consumer"),b=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),S=Symbol.for("react.lazy");Symbol.for("react.scope");var D=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var C=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var I=Symbol.iterator;function R(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=I&&e[I]||e["@@iterator"])?e:null}var P=Symbol.for("react.client.reference");function M(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===P?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case g:return"Fragment";case y:return"Profiler";case _:return"StrictMode";case E:return"Suspense";case T:return"SuspenseList";case D:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case m:return"Portal";case b:return(e.displayName||"Context")+".Provider";case x:return(e._context.displayName||"Context")+".Consumer";case w:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case A:return null!==(t=e.displayName||null)?t:M(e.type)||"Memo";case S:t=e._payload,e=e._init;try{return M(e(t))}catch(n){}}return null}var F=Array.isArray,L=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O={pending:!1,data:null,method:null,action:null},B=[],z=-1;function N(e){return{current:e}}function U(e){0>z||(e.current=B[z],B[z]=null,z--)}function V(e,t){z++,B[z]=e.current,e.current=t}var j=N(null),G=N(null),H=N(null),W=N(null);function q(e,t){switch(V(H,t),V(G,e),V(j,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?rh(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=oh(t=rh(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}U(j),V(j,e)}function X(){U(j),U(G),U(H)}function Z(e){null!==e.memoizedState&&V(W,e);var t=j.current,n=oh(t,e.type);t!==n&&(V(G,e),V(j,n))}function Y(e){G.current===e&&(U(j),U(G)),W.current===e&&(U(W),Zh._currentValue=O)}var K=Object.prototype.hasOwnProperty,J=i.unstable_scheduleCallback,Q=i.unstable_cancelCallback,$=i.unstable_shouldYield,ee=i.unstable_requestPaint,te=i.unstable_now,ne=i.unstable_getCurrentPriorityLevel,ie=i.unstable_ImmediatePriority,re=i.unstable_UserBlockingPriority,oe=i.unstable_NormalPriority,se=i.unstable_LowPriority,ae=i.unstable_IdlePriority,le=i.log,ce=i.unstable_setDisableYieldValue,ue=null,he=null;function de(e){if("function"===typeof le&&ce(e),he&&"function"===typeof he.setStrictMode)try{he.setStrictMode(ue,e)}catch(t){}}var fe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(pe(e)/me|0)|0},pe=Math.log,me=Math.LN2;var ge=256,_e=4194304;function ye(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ve(e,t,n){var i=e.pendingLanes;if(0===i)return 0;var r=0,o=e.suspendedLanes,s=e.pingedLanes;e=e.warmLanes;var a=134217727&i;return 0!==a?0!==(i=a&~o)?r=ye(i):0!==(s&=a)?r=ye(s):n||0!==(n=a&~e)&&(r=ye(n)):0!==(a=i&~o)?r=ye(a):0!==s?r=ye(s):n||0!==(n=i&~e)&&(r=ye(n)),0===r?0:0!==t&&t!==r&&0===(t&o)&&((o=r&-r)>=(n=t&-t)||32===o&&0!==(4194048&n))?t:r}function xe(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function be(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function we(){var e=ge;return 0===(4194048&(ge<<=1))&&(ge=256),e}function Ee(){var e=_e;return 0===(62914560&(_e<<=1))&&(_e=4194304),e}function Te(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ae(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Se(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-fe(t);e.entangledLanes|=t,e.entanglements[i]=1073741824|e.entanglements[i]|4194090&n}function De(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-fe(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}function Ce(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ie(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Re(){var e=k.p;return 0!==e?e:void 0===(e=window.event)?32:cd(e.type)}var Pe=Math.random().toString(36).slice(2),Me="__reactFiber$"+Pe,Fe="__reactProps$"+Pe,Le="__reactContainer$"+Pe,ke="__reactEvents$"+Pe,Oe="__reactListeners$"+Pe,Be="__reactHandles$"+Pe,ze="__reactResources$"+Pe,Ne="__reactMarker$"+Pe;function Ue(e){delete e[Me],delete e[Fe],delete e[ke],delete e[Oe],delete e[Be]}function Ve(e){var t=e[Me];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Le]||n[Me]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=vh(e);null!==e;){if(n=e[Me])return n;e=vh(e)}return t}n=(e=n).parentNode}return null}function je(e){if(e=e[Me]||e[Le]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Ge(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(s(33))}function He(e){var t=e[ze];return t||(t=e[ze]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function We(e){e[Ne]=!0}var qe=new Set,Xe={};function Ze(e,t){Ye(e,t),Ye(e+"Capture",t)}function Ye(e,t){for(Xe[e]=t,e=0;e<t.length;e++)qe.add(t[e])}var Ke,Je,Qe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),$e={},et={};function tt(e,t,n){if(r=t,K.call(et,r)||!K.call($e,r)&&(Qe.test(r)?et[r]=!0:($e[r]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var i=t.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var r}function nt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function it(e,t,n,i){if(null===i)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+i)}}function rt(e){if(void 0===Ke)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ke=t&&t[1]||"",Je=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Ke+e+Je}var ot=!1;function st(e,t){if(!e||ot)return"";ot=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(r){var i=r}Reflect.construct(e,[],n)}else{try{n.call()}catch(o){i=o}e.call(n.prototype)}}else{try{throw Error()}catch(s){i=s}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(a){if(a&&i&&"string"===typeof a.stack)return[a.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var o=i.DetermineComponentFrameRoot(),s=o[0],a=o[1];if(s&&a){var l=s.split("\n"),c=a.split("\n");for(r=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;if(i===l.length||r===c.length)for(i=l.length-1,r=c.length-1;1<=i&&0<=r&&l[i]!==c[r];)r--;for(;1<=i&&0<=r;i--,r--)if(l[i]!==c[r]){if(1!==i||1!==r)do{if(i--,0>--r||l[i]!==c[r]){var u="\n"+l[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=i&&0<=r);break}}}finally{ot=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?rt(n):""}function at(e){switch(e.tag){case 26:case 27:case 5:return rt(e.type);case 16:return rt("Lazy");case 13:return rt("Suspense");case 19:return rt("SuspenseList");case 0:case 15:return st(e.type,!1);case 11:return st(e.type.render,!1);case 1:return st(e.type,!0);case 31:return rt("Activity");default:return""}}function lt(e){try{var t="";do{t+=at(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function ct(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ut(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ht(e){e._valueTracker||(e._valueTracker=function(e){var t=ut(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function dt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=ut(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function ft(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var pt=/[\n"\\]/g;function mt(e){return e.replace(pt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function gt(e,t,n,i,r,o,s,a){e.name="",null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.type=s:e.removeAttribute("type"),null!=t?"number"===s?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ct(t)):e.value!==""+ct(t)&&(e.value=""+ct(t)):"submit"!==s&&"reset"!==s||e.removeAttribute("value"),null!=t?yt(e,s,ct(t)):null!=n?yt(e,s,ct(n)):null!=i&&e.removeAttribute("value"),null==r&&null!=o&&(e.defaultChecked=!!o),null!=r&&(e.checked=r&&"function"!==typeof r&&"symbol"!==typeof r),null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.name=""+ct(a):e.removeAttribute("name")}function _t(e,t,n,i,r,o,s,a){if(null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(e.type=o),null!=t||null!=n){if(!("submit"!==o&&"reset"!==o||void 0!==t&&null!==t))return;n=null!=n?""+ct(n):"",t=null!=t?""+ct(t):n,a||t===e.value||(e.value=t),e.defaultValue=t}i="function"!==typeof(i=null!=i?i:r)&&"symbol"!==typeof i&&!!i,e.checked=a?e.checked:!!i,e.defaultChecked=!!i,null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(e.name=s)}function yt(e,t,n){"number"===t&&ft(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function vt(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+ct(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function xt(e,t,n){null==t||((t=""+ct(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ct(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function bt(e,t,n,i){if(null==t){if(null!=i){if(null!=n)throw Error(s(92));if(F(i)){if(1<i.length)throw Error(s(93));i=i[0]}n=i}null==n&&(n=""),t=n}n=ct(t),e.defaultValue=n,(i=e.textContent)===n&&""!==i&&null!==i&&(e.value=i)}function wt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Et=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tt(e,t,n){var i=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?i?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":i?e.setProperty(t,n):"number"!==typeof n||0===n||Et.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function At(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(s(62));if(e=e.style,null!=n){for(var i in n)!n.hasOwnProperty(i)||null!=t&&t.hasOwnProperty(i)||(0===i.indexOf("--")?e.setProperty(i,""):"float"===i?e.cssFloat="":e[i]="");for(var r in t)i=t[r],t.hasOwnProperty(r)&&n[r]!==i&&Tt(e,r,i)}else for(var o in t)t.hasOwnProperty(o)&&Tt(e,o,t[o])}function St(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ct=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function It(e){return Ct.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Rt=null;function Pt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Mt=null,Ft=null;function Lt(e){var t=je(e);if(t&&(e=t.stateNode)){var n=e[Fe]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+mt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=i[Fe]||null;if(!r)throw Error(s(90));gt(i,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<n.length;t++)(i=n[t]).form===e.form&&dt(i)}break e;case"textarea":xt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&vt(e,!!n.multiple,t,!1)}}}var kt=!1;function Ot(e,t,n){if(kt)return e(t,n);kt=!0;try{return e(t)}finally{if(kt=!1,(null!==Mt||null!==Ft)&&(Vc(),Mt&&(t=Mt,e=Ft,Ft=Mt=null,Lt(t),e)))for(t=0;t<e.length;t++)Lt(e[t])}}function Bt(e,t){var n=e.stateNode;if(null===n)return null;var i=n[Fe]||null;if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var zt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Nt=!1;if(zt)try{var Ut={};Object.defineProperty(Ut,"passive",{get:function(){Nt=!0}}),window.addEventListener("test",Ut,Ut),window.removeEventListener("test",Ut,Ut)}catch(Fd){Nt=!1}var Vt=null,jt=null,Gt=null;function Ht(){if(Gt)return Gt;var e,t,n=jt,i=n.length,r="value"in Vt?Vt.value:Vt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);return Gt=r.slice(e,1<t?1-t:void 0)}function Wt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function qt(){return!0}function Xt(){return!1}function Zt(e){function t(t,n,i,r,o){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?qt:Xt,this.isPropagationStopped=Xt,this}return d(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=qt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=qt)},persist:function(){},isPersistent:qt}),t}var Yt,Kt,Jt,Qt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$t=Zt(Qt),en=d({},Qt,{view:0,detail:0}),tn=Zt(en),nn=d({},en,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jt&&(Jt&&"mousemove"===e.type?(Yt=e.screenX-Jt.screenX,Kt=e.screenY-Jt.screenY):Kt=Yt=0,Jt=e),Yt)},movementY:function(e){return"movementY"in e?e.movementY:Kt}}),rn=Zt(nn),on=Zt(d({},nn,{dataTransfer:0})),sn=Zt(d({},en,{relatedTarget:0})),an=Zt(d({},Qt,{animationName:0,elapsedTime:0,pseudoElement:0})),ln=Zt(d({},Qt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),cn=Zt(d({},Qt,{data:0})),un={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=dn[e])&&!!t[e]}function pn(){return fn}var mn=Zt(d({},en,{key:function(e){if(e.key){var t=un[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Wt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pn,charCode:function(e){return"keypress"===e.type?Wt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Wt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),gn=Zt(d({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),_n=Zt(d({},en,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pn})),yn=Zt(d({},Qt,{propertyName:0,elapsedTime:0,pseudoElement:0})),vn=Zt(d({},nn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),xn=Zt(d({},Qt,{newState:0,oldState:0})),bn=[9,13,27,32],wn=zt&&"CompositionEvent"in window,En=null;zt&&"documentMode"in document&&(En=document.documentMode);var Tn=zt&&"TextEvent"in window&&!En,An=zt&&(!wn||En&&8<En&&11>=En),Sn=String.fromCharCode(32),Dn=!1;function Cn(e,t){switch(e){case"keyup":return-1!==bn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function In(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Rn=!1;var Pn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Pn[e.type]:"textarea"===t}function Fn(e,t,n,i){Mt?Ft?Ft.push(i):Ft=[i]:Mt=i,0<(t=Hu(t,"onChange")).length&&(n=new $t("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Ln=null,kn=null;function On(e){Ou(e,0)}function Bn(e){if(dt(Ge(e)))return e}function zn(e,t){if("change"===e)return t}var Nn=!1;if(zt){var Un;if(zt){var Vn="oninput"in document;if(!Vn){var jn=document.createElement("div");jn.setAttribute("oninput","return;"),Vn="function"===typeof jn.oninput}Un=Vn}else Un=!1;Nn=Un&&(!document.documentMode||9<document.documentMode)}function Gn(){Ln&&(Ln.detachEvent("onpropertychange",Hn),kn=Ln=null)}function Hn(e){if("value"===e.propertyName&&Bn(kn)){var t=[];Fn(t,kn,e,Pt(e)),Ot(On,t)}}function Wn(e,t,n){"focusin"===e?(Gn(),kn=n,(Ln=t).attachEvent("onpropertychange",Hn)):"focusout"===e&&Gn()}function qn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Bn(kn)}function Xn(e,t){if("click"===e)return Bn(t)}function Zn(e,t){if("input"===e||"change"===e)return Bn(t)}var Yn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Kn(e,t){if(Yn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!K.call(t,r)||!Yn(e[r],t[r]))return!1}return!0}function Jn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Qn(e,t){var n,i=Jn(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Jn(i)}}function $n(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?$n(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ei(e){for(var t=ft((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=ft((e=t.contentWindow).document)}return t}function ti(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ni=zt&&"documentMode"in document&&11>=document.documentMode,ii=null,ri=null,oi=null,si=!1;function ai(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;si||null==ii||ii!==ft(i)||("selectionStart"in(i=ii)&&ti(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},oi&&Kn(oi,i)||(oi=i,0<(i=Hu(ri,"onSelect")).length&&(t=new $t("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=ii)))}function li(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ci={animationend:li("Animation","AnimationEnd"),animationiteration:li("Animation","AnimationIteration"),animationstart:li("Animation","AnimationStart"),transitionrun:li("Transition","TransitionRun"),transitionstart:li("Transition","TransitionStart"),transitioncancel:li("Transition","TransitionCancel"),transitionend:li("Transition","TransitionEnd")},ui={},hi={};function di(e){if(ui[e])return ui[e];if(!ci[e])return e;var t,n=ci[e];for(t in n)if(n.hasOwnProperty(t)&&t in hi)return ui[e]=n[t];return e}zt&&(hi=document.createElement("div").style,"AnimationEvent"in window||(delete ci.animationend.animation,delete ci.animationiteration.animation,delete ci.animationstart.animation),"TransitionEvent"in window||delete ci.transitionend.transition);var fi=di("animationend"),pi=di("animationiteration"),mi=di("animationstart"),gi=di("transitionrun"),_i=di("transitionstart"),yi=di("transitioncancel"),vi=di("transitionend"),xi=new Map,bi="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wi(e,t){xi.set(e,t),Ze(t,[e])}bi.push("scrollEnd");var Ei=new WeakMap;function Ti(e,t){if("object"===typeof e&&null!==e){var n=Ei.get(e);return void 0!==n?n:(t={value:e,source:t,stack:lt(t)},Ei.set(e,t),t)}return{value:e,source:t,stack:lt(t)}}var Ai=[],Si=0,Di=0;function Ci(){for(var e=Si,t=Di=Si=0;t<e;){var n=Ai[t];Ai[t++]=null;var i=Ai[t];Ai[t++]=null;var r=Ai[t];Ai[t++]=null;var o=Ai[t];if(Ai[t++]=null,null!==i&&null!==r){var s=i.pending;null===s?r.next=r:(r.next=s.next,s.next=r),i.pending=r}0!==o&&Mi(n,r,o)}}function Ii(e,t,n,i){Ai[Si++]=e,Ai[Si++]=t,Ai[Si++]=n,Ai[Si++]=i,Di|=i,e.lanes|=i,null!==(e=e.alternate)&&(e.lanes|=i)}function Ri(e,t,n,i){return Ii(e,t,n,i),Fi(e)}function Pi(e,t){return Ii(e,null,null,t),Fi(e)}function Mi(e,t,n){e.lanes|=n;var i=e.alternate;null!==i&&(i.lanes|=n);for(var r=!1,o=e.return;null!==o;)o.childLanes|=n,null!==(i=o.alternate)&&(i.childLanes|=n),22===o.tag&&(null===(e=o.stateNode)||1&e._visibility||(r=!0)),e=o,o=o.return;return 3===e.tag?(o=e.stateNode,r&&null!==t&&(r=31-fe(n),null===(i=(e=o.hiddenUpdates)[r])?e[r]=[t]:i.push(t),t.lane=536870912|n),o):null}function Fi(e){if(50<Mc)throw Mc=0,Fc=null,Error(s(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Li={};function ki(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oi(e,t,n,i){return new ki(e,t,n,i)}function Bi(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zi(e,t){var n=e.alternate;return null===n?((n=Oi(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Ni(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Ui(e,t,n,i,r,o){var a=0;if(i=e,"function"===typeof e)Bi(e)&&(a=1);else if("string"===typeof e)a=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,j.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case D:return(e=Oi(31,n,t,r)).elementType=D,e.lanes=o,e;case g:return Vi(n.children,r,o,t);case _:a=8,r|=24;break;case y:return(e=Oi(12,n,t,2|r)).elementType=y,e.lanes=o,e;case E:return(e=Oi(13,n,t,r)).elementType=E,e.lanes=o,e;case T:return(e=Oi(19,n,t,r)).elementType=T,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case v:case b:a=10;break e;case x:a=9;break e;case w:a=11;break e;case A:a=14;break e;case S:a=16,i=null;break e}a=29,n=Error(s(130,null===e?"null":typeof e,"")),i=null}return(t=Oi(a,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function Vi(e,t,n,i){return(e=Oi(7,e,i,t)).lanes=n,e}function ji(e,t,n){return(e=Oi(6,e,null,t)).lanes=n,e}function Gi(e,t,n){return(t=Oi(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Hi=[],Wi=0,qi=null,Xi=0,Zi=[],Yi=0,Ki=null,Ji=1,Qi="";function $i(e,t){Hi[Wi++]=Xi,Hi[Wi++]=qi,qi=e,Xi=t}function er(e,t,n){Zi[Yi++]=Ji,Zi[Yi++]=Qi,Zi[Yi++]=Ki,Ki=e;var i=Ji;e=Qi;var r=32-fe(i)-1;i&=~(1<<r),n+=1;var o=32-fe(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,Ji=1<<32-fe(t)+r|n<<r|i,Qi=o+e}else Ji=1<<o|n<<r|i,Qi=e}function tr(e){null!==e.return&&($i(e,1),er(e,1,0))}function nr(e){for(;e===qi;)qi=Hi[--Wi],Hi[Wi]=null,Xi=Hi[--Wi],Hi[Wi]=null;for(;e===Ki;)Ki=Zi[--Yi],Zi[Yi]=null,Qi=Zi[--Yi],Zi[Yi]=null,Ji=Zi[--Yi],Zi[Yi]=null}var ir=null,rr=null,or=!1,sr=null,ar=!1,lr=Error(s(519));function cr(e){throw mr(Ti(Error(s(418,"")),e)),lr}function ur(e){var t=e.stateNode,n=e.type,i=e.memoizedProps;switch(t[Me]=e,t[Fe]=i,n){case"dialog":Bu("cancel",t),Bu("close",t);break;case"iframe":case"object":case"embed":Bu("load",t);break;case"video":case"audio":for(n=0;n<Lu.length;n++)Bu(Lu[n],t);break;case"source":Bu("error",t);break;case"img":case"image":case"link":Bu("error",t),Bu("load",t);break;case"details":Bu("toggle",t);break;case"input":Bu("invalid",t),_t(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),ht(t);break;case"select":Bu("invalid",t);break;case"textarea":Bu("invalid",t),bt(t,i.value,i.defaultValue,i.children),ht(t)}"string"!==typeof(n=i.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===i.suppressHydrationWarning||Ku(t.textContent,n)?(null!=i.popover&&(Bu("beforetoggle",t),Bu("toggle",t)),null!=i.onScroll&&Bu("scroll",t),null!=i.onScrollEnd&&Bu("scrollend",t),null!=i.onClick&&(t.onclick=Ju),t=!0):t=!1,t||cr(e)}function hr(e){for(ir=e.return;ir;)switch(ir.tag){case 5:case 13:return void(ar=!1);case 27:case 3:return void(ar=!0);default:ir=ir.return}}function dr(e){if(e!==ir)return!1;if(!or)return hr(e),or=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||sh(e.type,e.memoizedProps)),t=!t),t&&rr&&cr(e),hr(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){rr=_h(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}rr=null}}else 27===n?(n=rr,fh(e.type)?(e=yh,yh=null,rr=e):rr=n):rr=ir?_h(e.stateNode.nextSibling):null;return!0}function fr(){rr=ir=null,or=!1}function pr(){var e=sr;return null!==e&&(null===vc?vc=e:vc.push.apply(vc,e),sr=null),e}function mr(e){null===sr?sr=[e]:sr.push(e)}var gr=N(null),_r=null,yr=null;function vr(e,t,n){V(gr,t._currentValue),t._currentValue=n}function xr(e){e._currentValue=gr.current,U(gr)}function br(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function wr(e,t,n,i){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var o=r.dependencies;if(null!==o){var a=r.child;o=o.firstContext;e:for(;null!==o;){var l=o;o=r;for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),br(o.return,n,e),i||(a=null);break e}o=l.next}}else if(18===r.tag){if(null===(a=r.return))throw Error(s(341));a.lanes|=n,null!==(o=a.alternate)&&(o.lanes|=n),br(a,n,e),a=null}else a=r.child;if(null!==a)a.return=r;else for(a=r;null!==a;){if(a===e){a=null;break}if(null!==(r=a.sibling)){r.return=a.return,a=r;break}a=a.return}r=a}}function Er(e,t,n,i){e=null;for(var r=t,o=!1;null!==r;){if(!o)if(0!==(524288&r.flags))o=!0;else if(0!==(262144&r.flags))break;if(10===r.tag){var a=r.alternate;if(null===a)throw Error(s(387));if(null!==(a=a.memoizedProps)){var l=r.type;Yn(r.pendingProps.value,a.value)||(null!==e?e.push(l):e=[l])}}else if(r===W.current){if(null===(a=r.alternate))throw Error(s(387));a.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(Zh):e=[Zh])}r=r.return}null!==e&&wr(t,e,n,i),t.flags|=262144}function Tr(e){for(e=e.firstContext;null!==e;){if(!Yn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ar(e){_r=e,yr=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Sr(e){return Cr(_r,e)}function Dr(e,t){return null===_r&&Ar(e),Cr(e,t)}function Cr(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===yr){if(null===e)throw Error(s(308));yr=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else yr=yr.next=t;return n}var Ir="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Rr=i.unstable_scheduleCallback,Pr=i.unstable_NormalPriority,Mr={$$typeof:b,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Fr(){return{controller:new Ir,data:new Map,refCount:0}}function Lr(e){e.refCount--,0===e.refCount&&Rr(Pr,function(){e.controller.abort()})}var kr=null,Or=0,Br=0,zr=null;function Nr(){if(0===--Or&&null!==kr){null!==zr&&(zr.status="fulfilled");var e=kr;kr=null,Br=0,zr=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Ur=L.S;L.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===kr){var n=kr=[];Or=0,Br=Iu(),zr={status:"pending",value:void 0,then:function(e){n.push(e)}}}Or++,t.then(Nr,Nr)}(0,t),null!==Ur&&Ur(e,t)};var Vr=N(null);function jr(){var e=Vr.current;return null!==e?e:ic.pooledCache}function Gr(e,t){V(Vr,null===t?Vr.current:t.pool)}function Hr(){var e=jr();return null===e?null:{parent:Mr._currentValue,pool:e}}var Wr=Error(s(460)),qr=Error(s(474)),Xr=Error(s(542)),Zr={then:function(){}};function Yr(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Kr(){}function Jr(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Kr,Kr),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw eo(e=t.reason),e;default:if("string"===typeof t.status)t.then(Kr,Kr);else{if(null!==(e=ic)&&100<e.shellSuspendCounter)throw Error(s(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw eo(e=t.reason),e}throw Qr=t,Wr}}var Qr=null;function $r(){if(null===Qr)throw Error(s(459));var e=Qr;return Qr=null,e}function eo(e){if(e===Wr||e===Xr)throw Error(s(483))}var to=!1;function no(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function io(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ro(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function oo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&nc)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,t=Fi(e),Mi(e,null,n),t}return Ii(e,i,t,n),Fi(e)}function so(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,De(e,n)}}function ao(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===o?r=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,callbacks:i.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var lo=!1;function co(){if(lo){if(null!==zr)throw zr}}function uo(e,t,n,i){lo=!1;var r=e.updateQueue;to=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=r.baseState;for(s=0,u=c=l=null,a=o;;){var f=-536870913&a.lane,p=f!==a.lane;if(p?(oc&f)===f:(i&f)===f){0!==f&&f===Br&&(lo=!0),null!==u&&(u=u.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});e:{var m=e,g=a;f=t;var _=n;switch(g.tag){case 1:if("function"===typeof(m=g.payload)){h=m.call(_,h,f);break e}h=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(f="function"===typeof(m=g.payload)?m.call(_,h,f):m)||void 0===f)break e;h=d({},h,f);break e;case 2:to=!0}}null!==(f=a.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=r.callbacks)?r.callbacks=[f]:p.push(f))}else p={lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,s|=f;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(p=a).next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null===o&&(r.shared.lanes=0),fc|=s,e.lanes=s,e.memoizedState=h}}function ho(e,t){if("function"!==typeof e)throw Error(s(191,e));e.call(t)}function fo(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ho(n[e],t)}var po=N(null),mo=N(0);function go(e,t){V(mo,e=hc),V(po,t),hc=e|t.baseLanes}function _o(){V(mo,hc),V(po,po.current)}function yo(){hc=mo.current,U(po),U(mo)}var vo=0,xo=null,bo=null,wo=null,Eo=!1,To=!1,Ao=!1,So=0,Do=0,Co=null,Io=0;function Ro(){throw Error(s(321))}function Po(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Yn(e[n],t[n]))return!1;return!0}function Mo(e,t,n,i,r,o){return vo=o,xo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,L.H=null===e||null===e.memoizedState?qs:Xs,Ao=!1,o=n(i,r),Ao=!1,To&&(o=Lo(t,n,i,r)),Fo(e),o}function Fo(e){L.H=Ws;var t=null!==bo&&null!==bo.next;if(vo=0,wo=bo=xo=null,Eo=!1,Do=0,Co=null,t)throw Error(s(300));null===e||Da||null!==(e=e.dependencies)&&Tr(e)&&(Da=!0)}function Lo(e,t,n,i){xo=e;var r=0;do{if(To&&(Co=null),Do=0,To=!1,25<=r)throw Error(s(301));if(r+=1,wo=bo=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}L.H=Zs,o=t(n,i)}while(To);return o}function ko(){var e=L.H,t=e.useState()[0];return t="function"===typeof t.then?Vo(t):t,e=e.useState()[0],(null!==bo?bo.memoizedState:null)!==e&&(xo.flags|=1024),t}function Oo(){var e=0!==So;return So=0,e}function Bo(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function zo(e){if(Eo){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Eo=!1}vo=0,wo=bo=xo=null,To=!1,Do=So=0,Co=null}function No(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===wo?xo.memoizedState=wo=e:wo=wo.next=e,wo}function Uo(){if(null===bo){var e=xo.alternate;e=null!==e?e.memoizedState:null}else e=bo.next;var t=null===wo?xo.memoizedState:wo.next;if(null!==t)wo=t,bo=e;else{if(null===e){if(null===xo.alternate)throw Error(s(467));throw Error(s(310))}e={memoizedState:(bo=e).memoizedState,baseState:bo.baseState,baseQueue:bo.baseQueue,queue:bo.queue,next:null},null===wo?xo.memoizedState=wo=e:wo=wo.next=e}return wo}function Vo(e){var t=Do;return Do+=1,null===Co&&(Co=[]),e=Jr(Co,e,t),t=xo,null===(null===wo?t.memoizedState:wo.next)&&(t=t.alternate,L.H=null===t||null===t.memoizedState?qs:Xs),e}function jo(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Vo(e);if(e.$$typeof===b)return Sr(e)}throw Error(s(438,String(e)))}function Go(e){var t=null,n=xo.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var i=xo.alternate;null!==i&&(null!==(i=i.updateQueue)&&(null!=(i=i.memoCache)&&(t={data:i.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},xo.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),i=0;i<e;i++)n[i]=C;return t.index++,n}function Ho(e,t){return"function"===typeof t?t(e):t}function Wo(e){return qo(Uo(),bo,e)}function qo(e,t,n){var i=e.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=n;var r=e.baseQueue,o=i.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}t.baseQueue=r=o,i.pending=null}if(o=e.baseState,null===r)e.memoizedState=o;else{var l=a=null,c=null,u=t=r.next,h=!1;do{var d=-536870913&u.lane;if(d!==u.lane?(oc&d)===d:(vo&d)===d){var f=u.revertLane;if(0===f)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),d===Br&&(h=!0);else{if((vo&f)===f){u=u.next,f===Br&&(h=!0);continue}d={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=d,a=o):c=c.next=d,xo.lanes|=f,fc|=f}d=u.action,Ao&&n(o,d),o=u.hasEagerState?u.eagerState:n(o,d)}else f={lane:d,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=f,a=o):c=c.next=f,xo.lanes|=d,fc|=d;u=u.next}while(null!==u&&u!==t);if(null===c?a=o:c.next=l,!Yn(o,e.memoizedState)&&(Da=!0,h&&null!==(n=zr)))throw n;e.memoizedState=o,e.baseState=a,e.baseQueue=c,i.lastRenderedState=o}return null===r&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Xo(e){var t=Uo(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{o=e(o,a.action),a=a.next}while(a!==r);Yn(o,t.memoizedState)||(Da=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Zo(e,t,n){var i=xo,r=Uo(),o=or;if(o){if(void 0===n)throw Error(s(407));n=n()}else n=t();var a=!Yn((bo||r).memoizedState,n);if(a&&(r.memoizedState=n,Da=!0),r=r.queue,_s(2048,8,Jo.bind(null,i,r,e),[e]),r.getSnapshot!==t||a||null!==wo&&1&wo.memoizedState.tag){if(i.flags|=2048,ps(9,{destroy:void 0,resource:void 0},Ko.bind(null,i,r,n,t),null),null===ic)throw Error(s(349));o||0!==(124&vo)||Yo(i,t,n)}return n}function Yo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=xo.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},xo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ko(e,t,n,i){t.value=n,t.getSnapshot=i,Qo(t)&&$o(e)}function Jo(e,t,n){return n(function(){Qo(t)&&$o(e)})}function Qo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Yn(e,n)}catch(i){return!0}}function $o(e){var t=Pi(e,2);null!==t&&Oc(t,e,2)}function es(e){var t=No();if("function"===typeof e){var n=e;if(e=n(),Ao){de(!0);try{n()}finally{de(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:e},t}function ts(e,t,n,i){return e.baseState=n,qo(e,bo,"function"===typeof i?i:Ho)}function ns(e,t,n,i,r){if(js(e))throw Error(s(485));if(null!==(e=t.action)){var o={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==L.T?n(!0):o.isTransition=!1,i(o),null===(n=t.pending)?(o.next=t.pending=o,is(t,o)):(o.next=n.next,t.pending=n.next=o)}}function is(e,t){var n=t.action,i=t.payload,r=e.state;if(t.isTransition){var o=L.T,s={};L.T=s;try{var a=n(r,i),l=L.S;null!==l&&l(s,a),rs(e,t,a)}catch(c){ss(e,t,c)}finally{L.T=o}}else try{rs(e,t,o=n(r,i))}catch(u){ss(e,t,u)}}function rs(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){os(e,t,n)},function(n){return ss(e,t,n)}):os(e,t,n)}function os(e,t,n){t.status="fulfilled",t.value=n,as(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,is(e,n)))}function ss(e,t,n){var i=e.pending;if(e.pending=null,null!==i){i=i.next;do{t.status="rejected",t.reason=n,as(t),t=t.next}while(t!==i)}e.action=null}function as(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function ls(e,t){return t}function cs(e,t){if(or){var n=ic.formState;if(null!==n){e:{var i=xo;if(or){if(rr){t:{for(var r=rr,o=ar;8!==r.nodeType;){if(!o){r=null;break t}if(null===(r=_h(r.nextSibling))){r=null;break t}}r="F!"===(o=r.data)||"F"===o?r:null}if(r){rr=_h(r.nextSibling),i="F!"===r.data;break e}}cr(i)}i=!1}i&&(t=n[0])}}return(n=No()).memoizedState=n.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ls,lastRenderedState:t},n.queue=i,n=Ns.bind(null,xo,i),i.dispatch=n,i=es(!1),o=Vs.bind(null,xo,!1,i.queue),r={state:t,dispatch:null,action:e,pending:null},(i=No()).queue=r,n=ns.bind(null,xo,r,o,n),r.dispatch=n,i.memoizedState=e,[t,n,!1]}function us(e){return hs(Uo(),bo,e)}function hs(e,t,n){if(t=qo(e,t,ls)[0],e=Wo(Ho)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var i=Vo(t)}catch(s){if(s===Wr)throw Xr;throw s}else i=t;var r=(t=Uo()).queue,o=r.dispatch;return n!==t.memoizedState&&(xo.flags|=2048,ps(9,{destroy:void 0,resource:void 0},ds.bind(null,r,n),null)),[i,o,e]}function ds(e,t){e.action=t}function fs(e){var t=Uo(),n=bo;if(null!==n)return hs(t,n,e);Uo(),t=t.memoizedState;var i=(n=Uo()).queue.dispatch;return n.memoizedState=e,[t,i,!1]}function ps(e,t,n,i){return e={tag:e,create:n,deps:i,inst:t,next:null},null===(t=xo.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},xo.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function ms(){return Uo().memoizedState}function gs(e,t,n,i){var r=No();i=void 0===i?null:i,xo.flags|=e,r.memoizedState=ps(1|t,{destroy:void 0,resource:void 0},n,i)}function _s(e,t,n,i){var r=Uo();i=void 0===i?null:i;var o=r.memoizedState.inst;null!==bo&&null!==i&&Po(i,bo.memoizedState.deps)?r.memoizedState=ps(t,o,n,i):(xo.flags|=e,r.memoizedState=ps(1|t,o,n,i))}function ys(e,t){gs(8390656,8,e,t)}function vs(e,t){_s(2048,8,e,t)}function xs(e,t){return _s(4,2,e,t)}function bs(e,t){return _s(4,4,e,t)}function ws(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Es(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,_s(4,4,ws.bind(null,t,e),n)}function Ts(){}function As(e,t){var n=Uo();t=void 0===t?null:t;var i=n.memoizedState;return null!==t&&Po(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ss(e,t){var n=Uo();t=void 0===t?null:t;var i=n.memoizedState;if(null!==t&&Po(t,i[1]))return i[0];if(i=e(),Ao){de(!0);try{e()}finally{de(!1)}}return n.memoizedState=[i,t],i}function Ds(e,t,n){return void 0===n||0!==(1073741824&vo)?e.memoizedState=t:(e.memoizedState=n,e=kc(),xo.lanes|=e,fc|=e,n)}function Cs(e,t,n,i){return Yn(n,t)?n:null!==po.current?(e=Ds(e,n,i),Yn(e,t)||(Da=!0),e):0===(42&vo)?(Da=!0,e.memoizedState=n):(e=kc(),xo.lanes|=e,fc|=e,t)}function Is(e,t,n,i,r){var o=k.p;k.p=0!==o&&8>o?o:8;var s=L.T,a={};L.T=a,Vs(e,!1,t,n);try{var l=r(),c=L.S;if(null!==c&&c(a,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)Us(e,t,function(e,t){var n=[],i={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){i.status="fulfilled",i.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(i.status="rejected",i.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),i}(l,i),Lc());else Us(e,t,i,Lc())}catch(u){Us(e,t,{then:function(){},status:"rejected",reason:u},Lc())}finally{k.p=o,L.T=s}}function Rs(){}function Ps(e,t,n,i){if(5!==e.tag)throw Error(s(476));var r=Ms(e).queue;Is(e,r,t,O,null===n?Rs:function(){return Fs(e),n(i)})}function Ms(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:O,baseState:O,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:O},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Fs(e){Us(e,Ms(e).next.queue,{},Lc())}function Ls(){return Sr(Zh)}function ks(){return Uo().memoizedState}function Os(){return Uo().memoizedState}function Bs(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Lc(),i=oo(t,e=ro(n),n);return null!==i&&(Oc(i,t,n),so(i,t,n)),t={cache:Fr()},void(e.payload=t)}t=t.return}}function zs(e,t,n){var i=Lc();n={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},js(e)?Gs(t,n):null!==(n=Ri(e,t,n,i))&&(Oc(n,e,i),Hs(n,t,i))}function Ns(e,t,n){Us(e,t,n,Lc())}function Us(e,t,n,i){var r={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(js(e))Gs(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(r.hasEagerState=!0,r.eagerState=a,Yn(a,s))return Ii(e,t,r,0),null===ic&&Ci(),!1}catch(l){}if(null!==(n=Ri(e,t,r,i)))return Oc(n,e,i),Hs(n,t,i),!0}return!1}function Vs(e,t,n,i){if(i={lane:2,revertLane:Iu(),action:i,hasEagerState:!1,eagerState:null,next:null},js(e)){if(t)throw Error(s(479))}else null!==(t=Ri(e,n,i,2))&&Oc(t,e,2)}function js(e){var t=e.alternate;return e===xo||null!==t&&t===xo}function Gs(e,t){To=Eo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Hs(e,t,n){if(0!==(4194048&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,De(e,n)}}var Ws={readContext:Sr,use:jo,useCallback:Ro,useContext:Ro,useEffect:Ro,useImperativeHandle:Ro,useLayoutEffect:Ro,useInsertionEffect:Ro,useMemo:Ro,useReducer:Ro,useRef:Ro,useState:Ro,useDebugValue:Ro,useDeferredValue:Ro,useTransition:Ro,useSyncExternalStore:Ro,useId:Ro,useHostTransitionStatus:Ro,useFormState:Ro,useActionState:Ro,useOptimistic:Ro,useMemoCache:Ro,useCacheRefresh:Ro},qs={readContext:Sr,use:jo,useCallback:function(e,t){return No().memoizedState=[e,void 0===t?null:t],e},useContext:Sr,useEffect:ys,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,gs(4194308,4,ws.bind(null,t,e),n)},useLayoutEffect:function(e,t){return gs(4194308,4,e,t)},useInsertionEffect:function(e,t){gs(4,2,e,t)},useMemo:function(e,t){var n=No();t=void 0===t?null:t;var i=e();if(Ao){de(!0);try{e()}finally{de(!1)}}return n.memoizedState=[i,t],i},useReducer:function(e,t,n){var i=No();if(void 0!==n){var r=n(t);if(Ao){de(!0);try{n(t)}finally{de(!1)}}}else r=t;return i.memoizedState=i.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},i.queue=e,e=e.dispatch=zs.bind(null,xo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},No().memoizedState=e},useState:function(e){var t=(e=es(e)).queue,n=Ns.bind(null,xo,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Ts,useDeferredValue:function(e,t){return Ds(No(),e,t)},useTransition:function(){var e=es(!1);return e=Is.bind(null,xo,e.queue,!0,!1),No().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=xo,r=No();if(or){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===ic)throw Error(s(349));0!==(124&oc)||Yo(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,ys(Jo.bind(null,i,o,e),[e]),i.flags|=2048,ps(9,{destroy:void 0,resource:void 0},Ko.bind(null,i,o,n,t),null),n},useId:function(){var e=No(),t=ic.identifierPrefix;if(or){var n=Qi;t="\xab"+t+"R"+(n=(Ji&~(1<<32-fe(Ji)-1)).toString(32)+n),0<(n=So++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Io++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Ls,useFormState:cs,useActionState:cs,useOptimistic:function(e){var t=No();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Vs.bind(null,xo,!0,n),n.dispatch=t,[e,t]},useMemoCache:Go,useCacheRefresh:function(){return No().memoizedState=Bs.bind(null,xo)}},Xs={readContext:Sr,use:jo,useCallback:As,useContext:Sr,useEffect:vs,useImperativeHandle:Es,useInsertionEffect:xs,useLayoutEffect:bs,useMemo:Ss,useReducer:Wo,useRef:ms,useState:function(){return Wo(Ho)},useDebugValue:Ts,useDeferredValue:function(e,t){return Cs(Uo(),bo.memoizedState,e,t)},useTransition:function(){var e=Wo(Ho)[0],t=Uo().memoizedState;return["boolean"===typeof e?e:Vo(e),t]},useSyncExternalStore:Zo,useId:ks,useHostTransitionStatus:Ls,useFormState:us,useActionState:us,useOptimistic:function(e,t){return ts(Uo(),0,e,t)},useMemoCache:Go,useCacheRefresh:Os},Zs={readContext:Sr,use:jo,useCallback:As,useContext:Sr,useEffect:vs,useImperativeHandle:Es,useInsertionEffect:xs,useLayoutEffect:bs,useMemo:Ss,useReducer:Xo,useRef:ms,useState:function(){return Xo(Ho)},useDebugValue:Ts,useDeferredValue:function(e,t){var n=Uo();return null===bo?Ds(n,e,t):Cs(n,bo.memoizedState,e,t)},useTransition:function(){var e=Xo(Ho)[0],t=Uo().memoizedState;return["boolean"===typeof e?e:Vo(e),t]},useSyncExternalStore:Zo,useId:ks,useHostTransitionStatus:Ls,useFormState:fs,useActionState:fs,useOptimistic:function(e,t){var n=Uo();return null!==bo?ts(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:Go,useCacheRefresh:Os},Ys=null,Ks=0;function Js(e){var t=Ks;return Ks+=1,null===Ys&&(Ys=[]),Jr(Ys,e,t)}function Qs(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function $s(e,t){if(t.$$typeof===f)throw Error(s(525));throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ea(e){return(0,e._init)(e._payload)}function ta(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=zi(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=67108866,n):i:(t.flags|=67108866,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=ji(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var o=n.type;return o===g?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===S&&ea(o)===t.type)?(Qs(t=r(t,n.props),n),t.return=e,t):(Qs(t=Ui(n.type,n.key,n.props,null,e.mode,i),n),t.return=e,t)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Gi(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,o){return null===t||7!==t.tag?((t=Vi(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=ji(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case p:return Qs(n=Ui(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case m:return(t=Gi(t,e.mode,n)).return=e,t;case S:return d(e,t=(0,t._init)(t._payload),n)}if(F(t)||R(t))return(t=Vi(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return d(e,Js(t),n);if(t.$$typeof===b)return d(e,Dr(e,t),n);$s(e,t)}return null}function f(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case p:return n.key===r?c(e,t,n,i):null;case m:return n.key===r?u(e,t,n,i):null;case S:return f(e,t,n=(r=n._init)(n._payload),i)}if(F(n)||R(n))return null!==r?null:h(e,t,n,i,null);if("function"===typeof n.then)return f(e,t,Js(n),i);if(n.$$typeof===b)return f(e,t,Dr(e,n),i);$s(e,n)}return null}function _(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i||"bigint"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case p:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case m:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case S:return _(e,t,n,i=(0,i._init)(i._payload),r)}if(F(i)||R(i))return h(t,e=e.get(n)||null,i,r,null);if("function"===typeof i.then)return _(e,t,n,Js(i),r);if(i.$$typeof===b)return _(e,t,n,Dr(t,i),r);$s(t,i)}return null}function y(l,c,u,h){if("object"===typeof u&&null!==u&&u.type===g&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case p:e:{for(var v=u.key;null!==c;){if(c.key===v){if((v=u.type)===g){if(7===c.tag){n(l,c.sibling),(h=r(c,u.props.children)).return=l,l=h;break e}}else if(c.elementType===v||"object"===typeof v&&null!==v&&v.$$typeof===S&&ea(v)===c.type){n(l,c.sibling),Qs(h=r(c,u.props),u),h.return=l,l=h;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===g?((h=Vi(u.props.children,l.mode,h,u.key)).return=l,l=h):(Qs(h=Ui(u.type,u.key,u.props,null,l.mode,h),u),h.return=l,l=h)}return a(l);case m:e:{for(v=u.key;null!==c;){if(c.key===v){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(h=r(c,u.children||[])).return=l,l=h;break e}n(l,c);break}t(l,c),c=c.sibling}(h=Gi(u,l.mode,h)).return=l,l=h}return a(l);case S:return y(l,c,u=(v=u._init)(u._payload),h)}if(F(u))return function(r,s,a,l){for(var c=null,u=null,h=s,p=s=0,m=null;null!==h&&p<a.length;p++){h.index>p?(m=h,h=null):m=h.sibling;var g=f(r,h,a[p],l);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(r,h),s=o(g,s,p),null===u?c=g:u.sibling=g,u=g,h=m}if(p===a.length)return n(r,h),or&&$i(r,p),c;if(null===h){for(;p<a.length;p++)null!==(h=d(r,a[p],l))&&(s=o(h,s,p),null===u?c=h:u.sibling=h,u=h);return or&&$i(r,p),c}for(h=i(h);p<a.length;p++)null!==(m=_(h,r,p,a[p],l))&&(e&&null!==m.alternate&&h.delete(null===m.key?p:m.key),s=o(m,s,p),null===u?c=m:u.sibling=m,u=m);return e&&h.forEach(function(e){return t(r,e)}),or&&$i(r,p),c}(l,c,u,h);if(R(u)){if("function"!==typeof(v=R(u)))throw Error(s(150));return function(r,a,l,c){if(null==l)throw Error(s(151));for(var u=null,h=null,p=a,m=a=0,g=null,y=l.next();null!==p&&!y.done;m++,y=l.next()){p.index>m?(g=p,p=null):g=p.sibling;var v=f(r,p,y.value,c);if(null===v){null===p&&(p=g);break}e&&p&&null===v.alternate&&t(r,p),a=o(v,a,m),null===h?u=v:h.sibling=v,h=v,p=g}if(y.done)return n(r,p),or&&$i(r,m),u;if(null===p){for(;!y.done;m++,y=l.next())null!==(y=d(r,y.value,c))&&(a=o(y,a,m),null===h?u=y:h.sibling=y,h=y);return or&&$i(r,m),u}for(p=i(p);!y.done;m++,y=l.next())null!==(y=_(p,r,m,y.value,c))&&(e&&null!==y.alternate&&p.delete(null===y.key?m:y.key),a=o(y,a,m),null===h?u=y:h.sibling=y,h=y);return e&&p.forEach(function(e){return t(r,e)}),or&&$i(r,m),u}(l,c,u=v.call(u),h)}if("function"===typeof u.then)return y(l,c,Js(u),h);if(u.$$typeof===b)return y(l,c,Dr(l,u),h);$s(l,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(h=r(c,u)).return=l,l=h):(n(l,c),(h=ji(u,l.mode,h)).return=l,l=h),a(l)):n(l,c)}return function(e,t,n,i){try{Ks=0;var r=y(e,t,n,i);return Ys=null,r}catch(s){if(s===Wr||s===Xr)throw s;var o=Oi(29,s,null,e.mode);return o.lanes=i,o.return=e,o}}}var na=ta(!0),ia=ta(!1),ra=N(null),oa=null;function sa(e){var t=e.alternate;V(ua,1&ua.current),V(ra,e),null===oa&&(null===t||null!==po.current||null!==t.memoizedState)&&(oa=e)}function aa(e){if(22===e.tag){if(V(ua,ua.current),V(ra,e),null===oa){var t=e.alternate;null!==t&&null!==t.memoizedState&&(oa=e)}}else la()}function la(){V(ua,ua.current),V(ra,ra.current)}function ca(e){U(ra),oa===e&&(oa=null),U(ua)}var ua=N(0);function ha(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||gh(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function da(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:d({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var fa={enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Lc(),r=ro(i);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=oo(e,r,i))&&(Oc(t,e,i),so(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Lc(),r=ro(i);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=oo(e,r,i))&&(Oc(t,e,i),so(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Lc(),i=ro(n);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=oo(e,i,n))&&(Oc(t,e,n),so(t,e,n))}};function pa(e,t,n,i,r,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!Kn(n,i)||!Kn(r,o))}function ma(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&fa.enqueueReplaceState(t,t.state,null)}function ga(e,t){var n=t;if("ref"in t)for(var i in n={},t)"ref"!==i&&(n[i]=t[i]);if(e=e.defaultProps)for(var r in n===t&&(n=d({},n)),e)void 0===n[r]&&(n[r]=e[r]);return n}var _a="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function ya(e){_a(e)}function va(e){console.error(e)}function xa(e){_a(e)}function ba(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function wa(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function Ea(e,t,n){return(n=ro(n)).tag=3,n.payload={element:null},n.callback=function(){ba(e,t)},n}function Ta(e){return(e=ro(e)).tag=3,e}function Aa(e,t,n,i){var r=n.type.getDerivedStateFromError;if("function"===typeof r){var o=i.value;e.payload=function(){return r(o)},e.callback=function(){wa(t,n,i)}}var s=n.stateNode;null!==s&&"function"===typeof s.componentDidCatch&&(e.callback=function(){wa(t,n,i),"function"!==typeof r&&(null===Tc?Tc=new Set([this]):Tc.add(this));var e=i.stack;this.componentDidCatch(i.value,{componentStack:null!==e?e:""})})}var Sa=Error(s(461)),Da=!1;function Ca(e,t,n,i){t.child=null===e?ia(t,null,n,i):na(t,e.child,n,i)}function Ia(e,t,n,i,r){n=n.render;var o=t.ref;if("ref"in i){var s={};for(var a in i)"ref"!==a&&(s[a]=i[a])}else s=i;return Ar(t),i=Mo(e,t,n,s,o,r),a=Oo(),null===e||Da?(or&&a&&tr(t),t.flags|=1,Ca(e,t,i,r),t.child):(Bo(e,t,r),Ya(e,t,r))}function Ra(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Bi(o)||void 0!==o.defaultProps||null!==n.compare?((e=Ui(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Pa(e,t,o,i,r))}if(o=e.child,!Ka(e,r)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:Kn)(s,i)&&e.ref===t.ref)return Ya(e,t,r)}return t.flags|=1,(e=zi(o,i)).ref=t.ref,e.return=t,t.child=e}function Pa(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(Kn(o,i)&&e.ref===t.ref){if(Da=!1,t.pendingProps=i=o,!Ka(e,r))return t.lanes=e.lanes,Ya(e,t,r);0!==(131072&e.flags)&&(Da=!0)}}return ka(e,t,n,i,r)}function Ma(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode){if(0!==(128&t.flags)){if(i=null!==o?o.baseLanes|n:n,null!==e){for(r=t.child=e.child,o=0;null!==r;)o=o|r.lanes|r.childLanes,r=r.sibling;t.childLanes=o&~i}else t.childLanes=0,t.child=null;return Fa(e,t,i,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Fa(e,t,null!==o?o.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Gr(0,null!==o?o.cachePool:null),null!==o?go(t,o):_o(),aa(t)}else null!==o?(Gr(0,o.cachePool),go(t,o),la(),t.memoizedState=null):(null!==e&&Gr(0,null),_o(),la());return Ca(e,t,r,n),t.child}function Fa(e,t,n,i){var r=jr();return r=null===r?null:{parent:Mr._currentValue,pool:r},t.memoizedState={baseLanes:n,cachePool:r},null!==e&&Gr(0,null),_o(),aa(t),null!==e&&Er(e,t,i,!0),null}function La(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(s(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function ka(e,t,n,i,r){return Ar(t),n=Mo(e,t,n,i,void 0,r),i=Oo(),null===e||Da?(or&&i&&tr(t),t.flags|=1,Ca(e,t,n,r),t.child):(Bo(e,t,r),Ya(e,t,r))}function Oa(e,t,n,i,r,o){return Ar(t),t.updateQueue=null,n=Lo(t,i,n,r),Fo(e),i=Oo(),null===e||Da?(or&&i&&tr(t),t.flags|=1,Ca(e,t,n,o),t.child):(Bo(e,t,o),Ya(e,t,o))}function Ba(e,t,n,i,r){if(Ar(t),null===t.stateNode){var o=Li,s=n.contextType;"object"===typeof s&&null!==s&&(o=Sr(s)),o=new n(i,o),t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=fa,t.stateNode=o,o._reactInternals=t,(o=t.stateNode).props=i,o.state=t.memoizedState,o.refs={},no(t),s=n.contextType,o.context="object"===typeof s&&null!==s?Sr(s):Li,o.state=t.memoizedState,"function"===typeof(s=n.getDerivedStateFromProps)&&(da(t,n,s,i),o.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(s=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),s!==o.state&&fa.enqueueReplaceState(o,o.state,null),uo(t,i,o,r),co(),o.state=t.memoizedState),"function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!0}else if(null===e){o=t.stateNode;var a=t.memoizedProps,l=ga(n,a);o.props=l;var c=o.context,u=n.contextType;s=Li,"object"===typeof u&&null!==u&&(s=Sr(u));var h=n.getDerivedStateFromProps;u="function"===typeof h||"function"===typeof o.getSnapshotBeforeUpdate,a=t.pendingProps!==a,u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a||c!==s)&&ma(t,o,i,s),to=!1;var d=t.memoizedState;o.state=d,uo(t,i,o,r),co(),c=t.memoizedState,a||d!==c||to?("function"===typeof h&&(da(t,n,h,i),c=t.memoizedState),(l=to||pa(t,n,l,i,d,c,s))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),o.props=i,o.state=c,o.context=s,i=l):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,io(e,t),u=ga(n,s=t.memoizedProps),o.props=u,h=t.pendingProps,d=o.context,c=n.contextType,l=Li,"object"===typeof c&&null!==c&&(l=Sr(c)),(c="function"===typeof(a=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==l)&&ma(t,o,i,l),to=!1,d=t.memoizedState,o.state=d,uo(t,i,o,r),co();var f=t.memoizedState;s!==h||d!==f||to||null!==e&&null!==e.dependencies&&Tr(e.dependencies)?("function"===typeof a&&(da(t,n,a,i),f=t.memoizedState),(u=to||pa(t,n,u,i,d,f,l)||null!==e&&null!==e.dependencies&&Tr(e.dependencies))?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),o.props=i,o.state=f,o.context=l,i=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return o=i,La(e,t),i=0!==(128&t.flags),o||i?(o=t.stateNode,n=i&&"function"!==typeof n.getDerivedStateFromError?null:o.render(),t.flags|=1,null!==e&&i?(t.child=na(t,e.child,null,r),t.child=na(t,null,n,r)):Ca(e,t,n,r),t.memoizedState=o.state,e=t.child):e=Ya(e,t,r),e}function za(e,t,n,i){return fr(),t.flags|=256,Ca(e,t,n,i),t.child}var Na={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ua(e){return{baseLanes:e,cachePool:Hr()}}function Va(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=gc),e}function ja(e,t,n){var i,r=t.pendingProps,o=!1,a=0!==(128&t.flags);if((i=a)||(i=(null===e||null!==e.memoizedState)&&0!==(2&ua.current)),i&&(o=!0,t.flags&=-129),i=0!==(32&t.flags),t.flags&=-33,null===e){if(or){if(o?sa(t):la(),or){var l,c=rr;if(l=c){e:{for(l=c,c=ar;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=_h(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Ki?{id:Ji,overflow:Qi}:null,retryLane:536870912,hydrationErrors:null},(l=Oi(18,null,null,0)).stateNode=c,l.return=t,t.child=l,ir=t,rr=null,l=!0):l=!1}l||cr(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return gh(c)?t.lanes=32:t.lanes=536870912,null;ca(t)}return c=r.children,r=r.fallback,o?(la(),c=Ha({mode:"hidden",children:c},o=t.mode),r=Vi(r,o,n,null),c.return=t,r.return=t,c.sibling=r,t.child=c,(o=t.child).memoizedState=Ua(n),o.childLanes=Va(e,i,n),t.memoizedState=Na,r):(sa(t),Ga(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(a)256&t.flags?(sa(t),t.flags&=-257,t=Wa(e,t,n)):null!==t.memoizedState?(la(),t.child=e.child,t.flags|=128,t=null):(la(),o=r.fallback,c=t.mode,r=Ha({mode:"visible",children:r.children},c),(o=Vi(o,c,n,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,na(t,e.child,null,n),(r=t.child).memoizedState=Ua(n),r.childLanes=Va(e,i,n),t.memoizedState=Na,t=o);else if(sa(t),gh(c)){if(i=c.nextSibling&&c.nextSibling.dataset)var u=i.dgst;i=u,(r=Error(s(419))).stack="",r.digest=i,mr({value:r,source:null,stack:null}),t=Wa(e,t,n)}else if(Da||Er(e,t,n,!1),i=0!==(n&e.childLanes),Da||i){if(null!==(i=ic)&&(0!==(r=0!==((r=0!==(42&(r=n&-n))?1:Ce(r))&(i.suspendedLanes|n))?0:r)&&r!==l.retryLane))throw l.retryLane=r,Pi(e,r),Oc(i,e,r),Sa;"$?"===c.data||Xc(),t=Wa(e,t,n)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,rr=_h(c.nextSibling),ir=t,or=!0,sr=null,ar=!1,null!==e&&(Zi[Yi++]=Ji,Zi[Yi++]=Qi,Zi[Yi++]=Ki,Ji=e.id,Qi=e.overflow,Ki=t),(t=Ga(t,r.children)).flags|=4096);return t}return o?(la(),o=r.fallback,c=t.mode,u=(l=e.child).sibling,(r=zi(l,{mode:"hidden",children:r.children})).subtreeFlags=65011712&l.subtreeFlags,null!==u?o=zi(u,o):(o=Vi(o,c,n,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,null===(c=e.child.memoizedState)?c=Ua(n):(null!==(l=c.cachePool)?(u=Mr._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=Hr(),c={baseLanes:c.baseLanes|n,cachePool:l}),o.memoizedState=c,o.childLanes=Va(e,i,n),t.memoizedState=Na,r):(sa(t),e=(n=e.child).sibling,(n=zi(n,{mode:"visible",children:r.children})).return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n)}function Ga(e,t){return(t=Ha({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Ha(e,t){return(e=Oi(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Wa(e,t,n){return na(t,e.child,null,n),(e=Ga(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function qa(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),br(e.return,t,n)}function Xa(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Za(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(Ca(e,t,i.children,n),0!==(2&(i=ua.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&qa(e,n,t);else if(19===e.tag)qa(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}switch(V(ua,i),r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ha(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Xa(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ha(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Xa(t,!0,n,null,o);break;case"together":Xa(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ya(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),fc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Er(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=zi(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=zi(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ka(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Tr(e))}function Ja(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Da=!0;else{if(!Ka(e,n)&&0===(128&t.flags))return Da=!1,function(e,t,n){switch(t.tag){case 3:q(t,t.stateNode.containerInfo),vr(0,Mr,e.memoizedState.cache),fr();break;case 27:case 5:Z(t);break;case 4:q(t,t.stateNode.containerInfo);break;case 10:vr(0,t.type,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(sa(t),t.flags|=128,null):0!==(n&t.child.childLanes)?ja(e,t,n):(sa(t),null!==(e=Ya(e,t,n))?e.sibling:null);sa(t);break;case 19:var r=0!==(128&e.flags);if((i=0!==(n&t.childLanes))||(Er(e,t,n,!1),i=0!==(n&t.childLanes)),r){if(i)return Za(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),V(ua,ua.current),i)break;return null;case 22:case 23:return t.lanes=0,Ma(e,t,n);case 24:vr(0,Mr,e.memoizedState.cache)}return Ya(e,t,n)}(e,t,n);Da=0!==(131072&e.flags)}else Da=!1,or&&0!==(1048576&t.flags)&&er(t,Xi,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var i=t.elementType,r=i._init;if(i=r(i._payload),t.type=i,"function"!==typeof i){if(void 0!==i&&null!==i){if((r=i.$$typeof)===w){t.tag=11,t=Ia(null,t,i,e,n);break e}if(r===A){t.tag=14,t=Ra(null,t,i,e,n);break e}}throw t=M(i)||i,Error(s(306,t,""))}Bi(i)?(e=ga(i,e),t.tag=1,t=Ba(null,t,i,e,n)):(t.tag=0,t=ka(null,t,i,e,n))}return t;case 0:return ka(e,t,t.type,t.pendingProps,n);case 1:return Ba(e,t,i=t.type,r=ga(i,t.pendingProps),n);case 3:e:{if(q(t,t.stateNode.containerInfo),null===e)throw Error(s(387));i=t.pendingProps;var o=t.memoizedState;r=o.element,io(e,t),uo(t,i,null,n);var a=t.memoizedState;if(i=a.cache,vr(0,Mr,i),i!==o.cache&&wr(t,[Mr],n,!0),co(),i=a.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:a.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=za(e,t,i,n);break e}if(i!==r){mr(r=Ti(Error(s(424)),t)),t=za(e,t,i,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(rr=_h(e.firstChild),ir=t,or=!0,sr=null,ar=!0,n=ia(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fr(),i===r){t=Ya(e,t,n);break e}Ca(e,t,i,n)}t=t.child}return t;case 26:return La(e,t),null===e?(n=Ch(t.type,null,t.pendingProps,null))?t.memoizedState=n:or||(n=t.type,e=t.pendingProps,(i=ih(H.current).createElement(n))[Me]=t,i[Fe]=e,eh(i,n,e),We(i),t.stateNode=i):t.memoizedState=Ch(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Z(t),null===e&&or&&(i=t.stateNode=xh(t.type,t.pendingProps,H.current),ir=t,ar=!0,r=rr,fh(t.type)?(yh=r,rr=_h(i.firstChild)):rr=r),Ca(e,t,t.pendingProps.children,n),La(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&or&&((r=i=rr)&&(null!==(i=function(e,t,n,i){for(;1===e.nodeType;){var r=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(i){if(!e[Ne])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(o=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(o!==r.rel||e.getAttribute("href")!==(null==r.href||""===r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((o=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&o&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var o=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===o)return e}if(null===(e=_h(e.nextSibling)))break}return null}(i,t.type,t.pendingProps,ar))?(t.stateNode=i,ir=t,rr=_h(i.firstChild),ar=!1,r=!0):r=!1),r||cr(t)),Z(t),r=t.type,o=t.pendingProps,a=null!==e?e.memoizedProps:null,i=o.children,sh(r,o)?i=null:null!==a&&sh(r,a)&&(t.flags|=32),null!==t.memoizedState&&(r=Mo(e,t,ko,null,null,n),Zh._currentValue=r),La(e,t),Ca(e,t,i,n),t.child;case 6:return null===e&&or&&((e=n=rr)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=_h(e.nextSibling)))return null}return e}(n,t.pendingProps,ar))?(t.stateNode=n,ir=t,rr=null,e=!0):e=!1),e||cr(t)),null;case 13:return ja(e,t,n);case 4:return q(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=na(t,null,i,n):Ca(e,t,i,n),t.child;case 11:return Ia(e,t,t.type,t.pendingProps,n);case 7:return Ca(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ca(e,t,t.pendingProps.children,n),t.child;case 10:return i=t.pendingProps,vr(0,t.type,i.value),Ca(e,t,i.children,n),t.child;case 9:return r=t.type._context,i=t.pendingProps.children,Ar(t),i=i(r=Sr(r)),t.flags|=1,Ca(e,t,i,n),t.child;case 14:return Ra(e,t,t.type,t.pendingProps,n);case 15:return Pa(e,t,t.type,t.pendingProps,n);case 19:return Za(e,t,n);case 31:return i=t.pendingProps,n=t.mode,i={mode:i.mode,children:i.children},null===e?((n=Ha(i,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=zi(e.child,i)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Ma(e,t,n);case 24:return Ar(t),i=Sr(Mr),null===e?(null===(r=jr())&&(r=ic,o=Fr(),r.pooledCache=o,o.refCount++,null!==o&&(r.pooledCacheLanes|=n),r=o),t.memoizedState={parent:i,cache:r},no(t),vr(0,Mr,r)):(0!==(e.lanes&n)&&(io(e,t),uo(t,null,null,n),co()),r=e.memoizedState,o=t.memoizedState,r.parent!==i?(r={parent:i,cache:i},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),vr(0,Mr,i)):(i=o.cache,vr(0,Mr,i),i!==r.cache&&wr(t,[Mr],n,!0))),Ca(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}function Qa(e){e.flags|=4}function $a(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Vh(t)){if(null!==(t=ra.current)&&((4194048&oc)===oc?null!==oa:(62914560&oc)!==oc&&0===(536870912&oc)||t!==oa))throw Qr=Zr,qr;e.flags|=8192}}function el(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Ee():536870912,e.lanes|=t,_c|=t)}function tl(e,t){if(!or)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function nl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=65011712&r.subtreeFlags,i|=65011712&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function il(e,t,n){var i=t.pendingProps;switch(nr(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nl(t),null;case 3:return n=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),xr(Mr),X(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(dr(t)?Qa(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,pr())),nl(t),null;case 26:return n=t.memoizedState,null===e?(Qa(t),null!==n?(nl(t),$a(t,n)):(nl(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Qa(t),nl(t),$a(t,n)):(nl(t),t.flags&=-16777217):(e.memoizedProps!==i&&Qa(t),nl(t),t.flags&=-16777217),null;case 27:Y(t),n=H.current;var r=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Qa(t);else{if(!i){if(null===t.stateNode)throw Error(s(166));return nl(t),null}e=j.current,dr(t)?ur(t):(e=xh(r,i,n),t.stateNode=e,Qa(t))}return nl(t),null;case 5:if(Y(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Qa(t);else{if(!i){if(null===t.stateNode)throw Error(s(166));return nl(t),null}if(e=j.current,dr(t))ur(t);else{switch(r=ih(H.current),e){case 1:e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=r.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof i.is?r.createElement("select",{is:i.is}):r.createElement("select"),i.multiple?e.multiple=!0:i.size&&(e.size=i.size);break;default:e="string"===typeof i.is?r.createElement(n,{is:i.is}):r.createElement(n)}}e[Me]=t,e[Fe]=i;e:for(r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;null===r.sibling;){if(null===r.return||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=e;e:switch(eh(e,n,i),n){case"button":case"input":case"select":case"textarea":e=!!i.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Qa(t)}}return nl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==i&&Qa(t);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));if(e=H.current,dr(t)){if(e=t.stateNode,n=t.memoizedProps,i=null,null!==(r=ir))switch(r.tag){case 27:case 5:i=r.memoizedProps}e[Me]=t,(e=!!(e.nodeValue===n||null!==i&&!0===i.suppressHydrationWarning||Ku(e.nodeValue,n)))||cr(t)}else(e=ih(e).createTextNode(i))[Me]=t,t.stateNode=e}return nl(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=dr(t),null!==i&&null!==i.dehydrated){if(null===e){if(!r)throw Error(s(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(s(317));r[Me]=t}else fr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nl(t),r=!1}else r=pr(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return 256&t.flags?(ca(t),t):(ca(t),null)}if(ca(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==i,e=null!==e&&null!==e.memoizedState,n){r=null,null!==(i=t.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(r=i.alternate.memoizedState.cachePool.pool);var o=null;null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(o=i.memoizedState.cachePool.pool),o!==r&&(i.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),el(t,t.updateQueue),nl(t),null;case 4:return X(),null===e&&Uu(t.stateNode.containerInfo),nl(t),null;case 10:return xr(t.type),nl(t),null;case 19:if(U(ua),null===(r=t.memoizedState))return nl(t),null;if(i=0!==(128&t.flags),null===(o=r.rendering))if(i)tl(r,!1);else{if(0!==dc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=ha(e))){for(t.flags|=128,tl(r,!1),e=o.updateQueue,t.updateQueue=e,el(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Ni(n,e),n=n.sibling;return V(ua,1&ua.current|2),t.child}e=e.sibling}null!==r.tail&&te()>wc&&(t.flags|=128,i=!0,tl(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ha(o))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,el(t,e),tl(r,!0),null===r.tail&&"hidden"===r.tailMode&&!o.alternate&&!or)return nl(t),null}else 2*te()-r.renderingStartTime>wc&&536870912!==n&&(t.flags|=128,i=!0,tl(r,!1),t.lanes=4194304);r.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=r.last)?e.sibling=o:t.child=o,r.last=o)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=te(),t.sibling=null,e=ua.current,V(ua,i?1&e|2:1&e),t):(nl(t),null);case 22:case 23:return ca(t),yo(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?0!==(536870912&n)&&0===(128&t.flags)&&(nl(t),6&t.subtreeFlags&&(t.flags|=8192)):nl(t),null!==(n=t.updateQueue)&&el(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),null!==e&&U(Vr),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),xr(Mr),nl(t),null;case 25:case 30:return null}throw Error(s(156,t.tag))}function rl(e,t){switch(nr(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return xr(Mr),X(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return Y(t),null;case 13:if(ca(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));fr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return U(ua),null;case 4:return X(),null;case 10:return xr(t.type),null;case 22:case 23:return ca(t),yo(),null!==e&&U(Vr),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return xr(Mr),null;default:return null}}function ol(e,t){switch(nr(t),t.tag){case 3:xr(Mr),X();break;case 26:case 27:case 5:Y(t);break;case 4:X();break;case 13:ca(t);break;case 19:U(ua);break;case 10:xr(t.type);break;case 22:case 23:ca(t),yo(),null!==e&&U(Vr);break;case 24:xr(Mr)}}function sl(e,t){try{var n=t.updateQueue,i=null!==n?n.lastEffect:null;if(null!==i){var r=i.next;n=r;do{if((n.tag&e)===e){i=void 0;var o=n.create,s=n.inst;i=o(),s.destroy=i}n=n.next}while(n!==r)}}catch(a){uu(t,t.return,a)}}function al(e,t,n){try{var i=t.updateQueue,r=null!==i?i.lastEffect:null;if(null!==r){var o=r.next;i=o;do{if((i.tag&e)===e){var s=i.inst,a=s.destroy;if(void 0!==a){s.destroy=void 0,r=t;var l=n,c=a;try{c()}catch(u){uu(r,l,u)}}}i=i.next}while(i!==o)}}catch(u){uu(t,t.return,u)}}function ll(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{fo(t,n)}catch(i){uu(e,e.return,i)}}}function cl(e,t,n){n.props=ga(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(i){uu(e,t,i)}}function ul(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var i=e.stateNode;break;default:i=e.stateNode}"function"===typeof n?e.refCleanup=n(i):n.current=i}}catch(r){uu(e,t,r)}}function hl(e,t){var n=e.ref,i=e.refCleanup;if(null!==n)if("function"===typeof i)try{i()}catch(r){uu(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(o){uu(e,t,o)}else n.current=null}function dl(e){var t=e.type,n=e.memoizedProps,i=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(r){uu(e,e.return,r)}}function fl(e,t,n){try{var i=e.stateNode;!function(e,t,n,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,o=null,a=null,l=null,c=null,u=null,h=null;for(p in n){var d=n[p];if(n.hasOwnProperty(p)&&null!=d)switch(p){case"checked":case"value":break;case"defaultValue":c=d;default:i.hasOwnProperty(p)||Qu(e,t,p,null,i,d)}}for(var f in i){var p=i[f];if(d=n[f],i.hasOwnProperty(f)&&(null!=p||null!=d))switch(f){case"type":o=p;break;case"name":r=p;break;case"checked":u=p;break;case"defaultChecked":h=p;break;case"value":a=p;break;case"defaultValue":l=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(s(137,t));break;default:p!==d&&Qu(e,t,f,p,i,d)}}return void gt(e,a,l,c,u,h,o,r);case"select":for(o in p=a=l=f=null,n)if(c=n[o],n.hasOwnProperty(o)&&null!=c)switch(o){case"value":break;case"multiple":p=c;default:i.hasOwnProperty(o)||Qu(e,t,o,null,i,c)}for(r in i)if(o=i[r],c=n[r],i.hasOwnProperty(r)&&(null!=o||null!=c))switch(r){case"value":f=o;break;case"defaultValue":l=o;break;case"multiple":a=o;default:o!==c&&Qu(e,t,r,o,i,c)}return t=l,n=a,i=p,void(null!=f?vt(e,!!n,f,!1):!!i!==!!n&&(null!=t?vt(e,!!n,t,!0):vt(e,!!n,n?[]:"",!1)));case"textarea":for(l in p=f=null,n)if(r=n[l],n.hasOwnProperty(l)&&null!=r&&!i.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Qu(e,t,l,null,i,r)}for(a in i)if(r=i[a],o=n[a],i.hasOwnProperty(a)&&(null!=r||null!=o))switch(a){case"value":f=r;break;case"defaultValue":p=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(s(91));break;default:r!==o&&Qu(e,t,a,r,i,o)}return void xt(e,f,p);case"option":for(var m in n)if(f=n[m],n.hasOwnProperty(m)&&null!=f&&!i.hasOwnProperty(m))if("selected"===m)e.selected=!1;else Qu(e,t,m,null,i,f);for(c in i)if(f=i[c],p=n[c],i.hasOwnProperty(c)&&f!==p&&(null!=f||null!=p))if("selected"===c)e.selected=f&&"function"!==typeof f&&"symbol"!==typeof f;else Qu(e,t,c,f,i,p);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)f=n[g],n.hasOwnProperty(g)&&null!=f&&!i.hasOwnProperty(g)&&Qu(e,t,g,null,i,f);for(u in i)if(f=i[u],p=n[u],i.hasOwnProperty(u)&&f!==p&&(null!=f||null!=p))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(s(137,t));break;default:Qu(e,t,u,f,i,p)}return;default:if(St(t)){for(var _ in n)f=n[_],n.hasOwnProperty(_)&&void 0!==f&&!i.hasOwnProperty(_)&&$u(e,t,_,void 0,i,f);for(h in i)f=i[h],p=n[h],!i.hasOwnProperty(h)||f===p||void 0===f&&void 0===p||$u(e,t,h,f,i,p);return}}for(var y in n)f=n[y],n.hasOwnProperty(y)&&null!=f&&!i.hasOwnProperty(y)&&Qu(e,t,y,null,i,f);for(d in i)f=i[d],p=n[d],!i.hasOwnProperty(d)||f===p||null==f&&null==p||Qu(e,t,d,f,i,p)}(i,e.type,n,t),i[Fe]=t}catch(r){uu(e,e.return,r)}}function pl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&fh(e.type)||4===e.tag}function ml(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||pl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&fh(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function gl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Ju));else if(4!==i&&(27===i&&fh(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(gl(e,t,n),e=e.sibling;null!==e;)gl(e,t,n),e=e.sibling}function _l(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&(27===i&&fh(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(_l(e,t,n),e=e.sibling;null!==e;)_l(e,t,n),e=e.sibling}function yl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var i=e.type,r=t.attributes;r.length;)t.removeAttributeNode(r[0]);eh(t,i,n),t[Me]=e,t[Fe]=n}catch(o){uu(e,e.return,o)}}var vl=!1,xl=!1,bl=!1,wl="function"===typeof WeakSet?WeakSet:Set,El=null;function Tl(e,t,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:Bl(e,n),4&i&&sl(5,n);break;case 1:if(Bl(e,n),4&i)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(s){uu(n,n.return,s)}else{var r=ga(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(a){uu(n,n.return,a)}}64&i&&ll(n),512&i&&ul(n,n.return);break;case 3:if(Bl(e,n),64&i&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{fo(e,t)}catch(s){uu(n,n.return,s)}}break;case 27:null===t&&4&i&&yl(n);case 26:case 5:Bl(e,n),null===t&&4&i&&dl(n),512&i&&ul(n,n.return);break;case 12:Bl(e,n);break;case 13:Bl(e,n),4&i&&Rl(e,n),64&i&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var i=function(){t(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),e._reactRetry=i}}(e,n=pu.bind(null,n))));break;case 22:if(!(i=null!==n.memoizedState||vl)){t=null!==t&&null!==t.memoizedState||xl,r=vl;var o=xl;vl=i,(xl=t)&&!o?Nl(e,n,0!==(8772&n.subtreeFlags)):Bl(e,n),vl=r,xl=o}break;case 30:break;default:Bl(e,n)}}function Al(e){var t=e.alternate;null!==t&&(e.alternate=null,Al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ue(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Sl=null,Dl=!1;function Cl(e,t,n){for(n=n.child;null!==n;)Il(e,t,n),n=n.sibling}function Il(e,t,n){if(he&&"function"===typeof he.onCommitFiberUnmount)try{he.onCommitFiberUnmount(ue,n)}catch(o){}switch(n.tag){case 26:xl||hl(n,t),Cl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:xl||hl(n,t);var i=Sl,r=Dl;fh(n.type)&&(Sl=n.stateNode,Dl=!1),Cl(e,t,n),bh(n.stateNode),Sl=i,Dl=r;break;case 5:xl||hl(n,t);case 6:if(i=Sl,r=Dl,Sl=null,Cl(e,t,n),Dl=r,null!==(Sl=i))if(Dl)try{(9===Sl.nodeType?Sl.body:"HTML"===Sl.nodeName?Sl.ownerDocument.body:Sl).removeChild(n.stateNode)}catch(s){uu(n,t,s)}else try{Sl.removeChild(n.stateNode)}catch(s){uu(n,t,s)}break;case 18:null!==Sl&&(Dl?(ph(9===(e=Sl).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Dd(e)):ph(Sl,n.stateNode));break;case 4:i=Sl,r=Dl,Sl=n.stateNode.containerInfo,Dl=!0,Cl(e,t,n),Sl=i,Dl=r;break;case 0:case 11:case 14:case 15:xl||al(2,n,t),xl||al(4,n,t),Cl(e,t,n);break;case 1:xl||(hl(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount&&cl(n,t,i)),Cl(e,t,n);break;case 21:Cl(e,t,n);break;case 22:xl=(i=xl)||null!==n.memoizedState,Cl(e,t,n),xl=i;break;default:Cl(e,t,n)}}function Rl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Dd(e)}catch(n){uu(t,t.return,n)}}function Pl(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new wl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new wl),t;default:throw Error(s(435,e.tag))}}(e);t.forEach(function(t){var i=mu.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}function Ml(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i],o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 27:if(fh(l.type)){Sl=l.stateNode,Dl=!1;break e}break;case 5:Sl=l.stateNode,Dl=!1;break e;case 3:case 4:Sl=l.stateNode.containerInfo,Dl=!0;break e}l=l.return}if(null===Sl)throw Error(s(160));Il(o,a,r),Sl=null,Dl=!1,null!==(o=r.alternate)&&(o.return=null),r.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Ll(t,e),t=t.sibling}var Fl=null;function Ll(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Ml(t,e),kl(e),4&i&&(al(3,e,e.return),sl(3,e),al(5,e,e.return));break;case 1:Ml(t,e),kl(e),512&i&&(xl||null===n||hl(n,n.return)),64&i&&vl&&(null!==(e=e.updateQueue)&&(null!==(i=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?i:n.concat(i))));break;case 26:var r=Fl;if(Ml(t,e),kl(e),512&i&&(xl||null===n||hl(n,n.return)),4&i){var o=null!==n?n.memoizedState:null;if(i=e.memoizedState,null===n)if(null===i)if(null===e.stateNode){e:{i=e.type,n=e.memoizedProps,r=r.ownerDocument||r;t:switch(i){case"title":(!(o=r.getElementsByTagName("title")[0])||o[Ne]||o[Me]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=r.createElement(i),r.head.insertBefore(o,r.querySelector("head > title"))),eh(o,i,n),o[Me]=e,We(o),i=o;break e;case"link":var a=Nh("link","href",r).get(i+(n.href||""));if(a)for(var l=0;l<a.length;l++)if((o=a[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){a.splice(l,1);break t}eh(o=r.createElement(i),i,n),r.head.appendChild(o);break;case"meta":if(a=Nh("meta","content",r).get(i+(n.content||"")))for(l=0;l<a.length;l++)if((o=a[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){a.splice(l,1);break t}eh(o=r.createElement(i),i,n),r.head.appendChild(o);break;default:throw Error(s(468,i))}o[Me]=e,We(o),i=o}e.stateNode=i}else Uh(r,e.type,e.stateNode);else e.stateNode=Lh(r,i,e.memoizedProps);else o!==i?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===i?Uh(r,e.type,e.stateNode):Lh(r,i,e.memoizedProps)):null===i&&null!==e.stateNode&&fl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Ml(t,e),kl(e),512&i&&(xl||null===n||hl(n,n.return)),null!==n&&4&i&&fl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Ml(t,e),kl(e),512&i&&(xl||null===n||hl(n,n.return)),32&e.flags){r=e.stateNode;try{wt(r,"")}catch(p){uu(e,e.return,p)}}4&i&&null!=e.stateNode&&fl(e,r=e.memoizedProps,null!==n?n.memoizedProps:r),1024&i&&(bl=!0);break;case 6:if(Ml(t,e),kl(e),4&i){if(null===e.stateNode)throw Error(s(162));i=e.memoizedProps,n=e.stateNode;try{n.nodeValue=i}catch(p){uu(e,e.return,p)}}break;case 3:if(zh=null,r=Fl,Fl=Th(t.containerInfo),Ml(t,e),Fl=r,kl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Dd(t.containerInfo)}catch(p){uu(e,e.return,p)}bl&&(bl=!1,Ol(e));break;case 4:i=Fl,Fl=Th(e.stateNode.containerInfo),Ml(t,e),kl(e),Fl=i;break;case 12:default:Ml(t,e),kl(e);break;case 13:Ml(t,e),kl(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(bc=te()),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,Pl(e,i)));break;case 22:r=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=vl,h=xl;if(vl=u||r,xl=h||c,Ml(t,e),xl=h,vl=u,kl(e),8192&i)e:for(t=e.stateNode,t._visibility=r?-2&t._visibility:1|t._visibility,r&&(null===n||c||vl||xl||zl(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(o=c.stateNode,r)"function"===typeof(a=o.style).setProperty?a.setProperty("display","none","important"):a.display="none";else{l=c.stateNode;var d=c.memoizedProps.style,f=void 0!==d&&null!==d&&d.hasOwnProperty("display")?d.display:null;l.style.display=null==f||"boolean"===typeof f?"":(""+f).trim()}}catch(p){uu(c,c.return,p)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=r?"":c.memoizedProps}catch(p){uu(c,c.return,p)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&i&&(null!==(i=e.updateQueue)&&(null!==(n=i.retryQueue)&&(i.retryQueue=null,Pl(e,n))));break;case 19:Ml(t,e),kl(e),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,Pl(e,i)));case 30:case 21:}}function kl(e){var t=e.flags;if(2&t){try{for(var n,i=e.return;null!==i;){if(pl(i)){n=i;break}i=i.return}if(null==n)throw Error(s(160));switch(n.tag){case 27:var r=n.stateNode;_l(e,ml(e),r);break;case 5:var o=n.stateNode;32&n.flags&&(wt(o,""),n.flags&=-33),_l(e,ml(e),o);break;case 3:case 4:var a=n.stateNode.containerInfo;gl(e,ml(e),a);break;default:throw Error(s(161))}}catch(l){uu(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ol(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Ol(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Bl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Tl(e,t.alternate,t),t=t.sibling}function zl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:al(4,t,t.return),zl(t);break;case 1:hl(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&cl(t,t.return,n),zl(t);break;case 27:bh(t.stateNode);case 26:case 5:hl(t,t.return),zl(t);break;case 22:null===t.memoizedState&&zl(t);break;default:zl(t)}e=e.sibling}}function Nl(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var i=t.alternate,r=e,o=t,s=o.flags;switch(o.tag){case 0:case 11:case 15:Nl(r,o,n),sl(4,o);break;case 1:if(Nl(r,o,n),"function"===typeof(r=(i=o).stateNode).componentDidMount)try{r.componentDidMount()}catch(c){uu(i,i.return,c)}if(null!==(r=(i=o).updateQueue)){var a=i.stateNode;try{var l=r.shared.hiddenCallbacks;if(null!==l)for(r.shared.hiddenCallbacks=null,r=0;r<l.length;r++)ho(l[r],a)}catch(c){uu(i,i.return,c)}}n&&64&s&&ll(o),ul(o,o.return);break;case 27:yl(o);case 26:case 5:Nl(r,o,n),n&&null===i&&4&s&&dl(o),ul(o,o.return);break;case 12:Nl(r,o,n);break;case 13:Nl(r,o,n),n&&4&s&&Rl(r,o);break;case 22:null===o.memoizedState&&Nl(r,o,n),ul(o,o.return);break;case 30:break;default:Nl(r,o,n)}t=t.sibling}}function Ul(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Lr(n))}function Vl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Lr(e))}function jl(e,t,n,i){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Gl(e,t,n,i),t=t.sibling}function Gl(e,t,n,i){var r=t.flags;switch(t.tag){case 0:case 11:case 15:jl(e,t,n,i),2048&r&&sl(9,t);break;case 1:case 13:default:jl(e,t,n,i);break;case 3:jl(e,t,n,i),2048&r&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Lr(e)));break;case 12:if(2048&r){jl(e,t,n,i),e=t.stateNode;try{var o=t.memoizedProps,s=o.id,a=o.onPostCommit;"function"===typeof a&&a(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){uu(t,t.return,l)}}else jl(e,t,n,i);break;case 23:break;case 22:o=t.stateNode,s=t.alternate,null!==t.memoizedState?2&o._visibility?jl(e,t,n,i):Wl(e,t):2&o._visibility?jl(e,t,n,i):(o._visibility|=2,Hl(e,t,n,i,0!==(10256&t.subtreeFlags))),2048&r&&Ul(s,t);break;case 24:jl(e,t,n,i),2048&r&&Vl(t.alternate,t)}}function Hl(e,t,n,i,r){for(r=r&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var o=e,s=t,a=n,l=i,c=s.flags;switch(s.tag){case 0:case 11:case 15:Hl(o,s,a,l,r),sl(8,s);break;case 23:break;case 22:var u=s.stateNode;null!==s.memoizedState?2&u._visibility?Hl(o,s,a,l,r):Wl(o,s):(u._visibility|=2,Hl(o,s,a,l,r)),r&&2048&c&&Ul(s.alternate,s);break;case 24:Hl(o,s,a,l,r),r&&2048&c&&Vl(s.alternate,s);break;default:Hl(o,s,a,l,r)}t=t.sibling}}function Wl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,i=t,r=i.flags;switch(i.tag){case 22:Wl(n,i),2048&r&&Ul(i.alternate,i);break;case 24:Wl(n,i),2048&r&&Vl(i.alternate,i);break;default:Wl(n,i)}t=t.sibling}}var ql=8192;function Xl(e){if(e.subtreeFlags&ql)for(e=e.child;null!==e;)Zl(e),e=e.sibling}function Zl(e){switch(e.tag){case 26:Xl(e),e.flags&ql&&null!==e.memoizedState&&function(e,t,n){if(null===jh)throw Error(s(475));var i=jh;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var r=Ih(n.href),o=e.querySelector(Rh(r));if(o)return null!==(e=o._p)&&"object"===typeof e&&"function"===typeof e.then&&(i.count++,i=Hh.bind(i),e.then(i,i)),t.state.loading|=4,t.instance=o,void We(o);o=e.ownerDocument||e,n=Ph(n),(r=wh.get(r))&&Oh(n,r),We(o=o.createElement("link"));var a=o;a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),eh(o,"link",n),t.instance=o}null===i.stylesheets&&(i.stylesheets=new Map),i.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(i.count++,t=Hh.bind(i),e.addEventListener("load",t),e.addEventListener("error",t))}}(Fl,e.memoizedState,e.memoizedProps);break;case 5:default:Xl(e);break;case 3:case 4:var t=Fl;Fl=Th(e.stateNode.containerInfo),Xl(e),Fl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=ql,ql=16777216,Xl(e),ql=t):Xl(e))}}function Yl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Kl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];El=i,$l(i,e)}Yl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Jl(e),e=e.sibling}function Jl(e){switch(e.tag){case 0:case 11:case 15:Kl(e),2048&e.flags&&al(9,e,e.return);break;case 3:case 12:default:Kl(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Ql(e)):Kl(e)}}function Ql(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];El=i,$l(i,e)}Yl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:al(8,t,t.return),Ql(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Ql(t));break;default:Ql(t)}e=e.sibling}}function $l(e,t){for(;null!==El;){var n=El;switch(n.tag){case 0:case 11:case 15:al(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var i=n.memoizedState.cachePool.pool;null!=i&&i.refCount++}break;case 24:Lr(n.memoizedState.cache)}if(null!==(i=n.child))i.return=n,El=i;else e:for(n=e;null!==El;){var r=(i=El).sibling,o=i.return;if(Al(i),i===n){El=null;break e}if(null!==r){r.return=o,El=r;break e}El=o}}}var ec={getCacheForType:function(e){var t=Sr(Mr),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},tc="function"===typeof WeakMap?WeakMap:Map,nc=0,ic=null,rc=null,oc=0,sc=0,ac=null,lc=!1,cc=!1,uc=!1,hc=0,dc=0,fc=0,pc=0,mc=0,gc=0,_c=0,yc=null,vc=null,xc=!1,bc=0,wc=1/0,Ec=null,Tc=null,Ac=0,Sc=null,Dc=null,Cc=0,Ic=0,Rc=null,Pc=null,Mc=0,Fc=null;function Lc(){if(0!==(2&nc)&&0!==oc)return oc&-oc;if(null!==L.T){return 0!==Br?Br:Iu()}return Re()}function kc(){0===gc&&(gc=0===(536870912&oc)||or?we():536870912);var e=ra.current;return null!==e&&(e.flags|=32),gc}function Oc(e,t,n){(e!==ic||2!==sc&&9!==sc)&&null===e.cancelPendingCommit||(Gc(e,0),Uc(e,oc,gc,!1)),Ae(e,n),0!==(2&nc)&&e===ic||(e===ic&&(0===(2&nc)&&(pc|=n),4===dc&&Uc(e,oc,gc,!1)),wu(e))}function Bc(e,t,n){if(0!==(6&nc))throw Error(s(327));for(var i=!n&&0===(124&t)&&0===(t&e.expiredLanes)||xe(e,t),r=i?function(e,t){var n=nc;nc|=2;var i=Wc(),r=qc();ic!==e||oc!==t?(Ec=null,wc=te()+500,Gc(e,t)):cc=xe(e,t);e:for(;;)try{if(0!==sc&&null!==rc){t=rc;var o=ac;t:switch(sc){case 1:sc=0,ac=null,$c(e,t,o,1);break;case 2:case 9:if(Yr(o)){sc=0,ac=null,Qc(t);break}t=function(){2!==sc&&9!==sc||ic!==e||(sc=7),wu(e)},o.then(t,t);break e;case 3:sc=7;break e;case 4:sc=5;break e;case 7:Yr(o)?(sc=0,ac=null,Qc(t)):(sc=0,ac=null,$c(e,t,o,7));break;case 5:var a=null;switch(rc.tag){case 26:a=rc.memoizedState;case 5:case 27:var l=rc;if(!a||Vh(a)){sc=0,ac=null;var c=l.sibling;if(null!==c)rc=c;else{var u=l.return;null!==u?(rc=u,eu(u)):rc=null}break t}}sc=0,ac=null,$c(e,t,o,5);break;case 6:sc=0,ac=null,$c(e,t,o,6);break;case 8:jc(),dc=6;break e;default:throw Error(s(462))}}Kc();break}catch(h){Hc(e,h)}return yr=_r=null,L.H=i,L.A=r,nc=n,null!==rc?0:(ic=null,oc=0,Ci(),dc)}(e,t):Zc(e,t,!0),o=i;;){if(0===r){cc&&!i&&Uc(e,t,0,!1);break}if(n=e.current.alternate,!o||Nc(n)){if(2===r){if(o=t,e.errorRecoveryDisabledLanes&o)var a=0;else a=0!==(a=-536870913&e.pendingLanes)?a:536870912&a?536870912:0;if(0!==a){t=a;e:{var l=e;r=yc;var c=l.current.memoizedState.isDehydrated;if(c&&(Gc(l,a).flags|=256),2!==(a=Zc(l,a,!1))){if(uc&&!c){l.errorRecoveryDisabledLanes|=o,pc|=o,r=4;break e}o=vc,vc=r,null!==o&&(null===vc?vc=o:vc.push.apply(vc,o))}r=a}if(o=!1,2!==r)continue}}if(1===r){Gc(e,0),Uc(e,t,0,!0);break}e:{switch(i=e,o=r){case 0:case 1:throw Error(s(345));case 4:if((4194048&t)!==t)break;case 6:Uc(i,t,gc,!lc);break e;case 2:vc=null;break;case 3:case 5:break;default:throw Error(s(329))}if((62914560&t)===t&&10<(r=bc+300-te())){if(Uc(i,t,gc,!lc),0!==ve(i,0,!0))break e;i.timeoutHandle=lh(zc.bind(null,i,n,vc,Ec,xc,t,gc,pc,_c,lc,o,2,-0,0),r)}else zc(i,n,vc,Ec,xc,t,gc,pc,_c,lc,o,0,-0,0)}break}r=Zc(e,t,!1),o=!1}wu(e)}function zc(e,t,n,i,r,o,a,l,c,u,h,d,f,p){if(e.timeoutHandle=-1,(8192&(d=t.subtreeFlags)||16785408===(16785408&d))&&(jh={stylesheets:null,count:0,unsuspend:Gh},Zl(t),null!==(d=function(){if(null===jh)throw Error(s(475));var e=jh;return e.stylesheets&&0===e.count&&qh(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&qh(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=d(nu.bind(null,e,t,o,n,i,r,a,l,c,h,1,f,p)),void Uc(e,o,a,!u);nu(e,t,o,n,i,r,a,l,c)}function Nc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!Yn(o(),r))return!1}catch(s){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Uc(e,t,n,i){t&=~mc,t&=~pc,e.suspendedLanes|=t,e.pingedLanes&=~t,i&&(e.warmLanes|=t),i=e.expirationTimes;for(var r=t;0<r;){var o=31-fe(r),s=1<<o;i[o]=-1,r&=~s}0!==n&&Se(e,n,t)}function Vc(){return 0!==(6&nc)||(Eu(0,!1),!1)}function jc(){if(null!==rc){if(0===sc)var e=rc.return;else yr=_r=null,zo(e=rc),Ys=null,Ks=0,e=rc;for(;null!==e;)ol(e.alternate,e),e=e.return;rc=null}}function Gc(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,ch(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),jc(),ic=e,rc=n=zi(e.current,null),oc=t,sc=0,ac=null,lc=!1,cc=xe(e,t),uc=!1,_c=gc=mc=pc=fc=dc=0,vc=yc=null,xc=!1,0!==(8&t)&&(t|=32&t);var i=e.entangledLanes;if(0!==i)for(e=e.entanglements,i&=t;0<i;){var r=31-fe(i),o=1<<r;t|=e[r],i&=~o}return hc=t,Ci(),n}function Hc(e,t){xo=null,L.H=Ws,t===Wr||t===Xr?(t=$r(),sc=3):t===qr?(t=$r(),sc=4):sc=t===Sa?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,ac=t,null===rc&&(dc=1,ba(e,Ti(t,e.current)))}function Wc(){var e=L.H;return L.H=Ws,null===e?Ws:e}function qc(){var e=L.A;return L.A=ec,e}function Xc(){dc=4,lc||(4194048&oc)!==oc&&null!==ra.current||(cc=!0),0===(134217727&fc)&&0===(134217727&pc)||null===ic||Uc(ic,oc,gc,!1)}function Zc(e,t,n){var i=nc;nc|=2;var r=Wc(),o=qc();ic===e&&oc===t||(Ec=null,Gc(e,t)),t=!1;var s=dc;e:for(;;)try{if(0!==sc&&null!==rc){var a=rc,l=ac;switch(sc){case 8:jc(),s=6;break e;case 3:case 2:case 9:case 6:null===ra.current&&(t=!0);var c=sc;if(sc=0,ac=null,$c(e,a,l,c),n&&cc){s=0;break e}break;default:c=sc,sc=0,ac=null,$c(e,a,l,c)}}Yc(),s=dc;break}catch(u){Hc(e,u)}return t&&e.shellSuspendCounter++,yr=_r=null,nc=i,L.H=r,L.A=o,null===rc&&(ic=null,oc=0,Ci()),s}function Yc(){for(;null!==rc;)Jc(rc)}function Kc(){for(;null!==rc&&!$();)Jc(rc)}function Jc(e){var t=Ja(e.alternate,e,hc);e.memoizedProps=e.pendingProps,null===t?eu(e):rc=t}function Qc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Oa(n,t,t.pendingProps,t.type,void 0,oc);break;case 11:t=Oa(n,t,t.pendingProps,t.type.render,t.ref,oc);break;case 5:zo(t);default:ol(n,t),t=Ja(n,t=rc=Ni(t,hc),hc)}e.memoizedProps=e.pendingProps,null===t?eu(e):rc=t}function $c(e,t,n,i){yr=_r=null,zo(t),Ys=null,Ks=0;var r=t.return;try{if(function(e,t,n,i,r){if(n.flags|=32768,null!==i&&"object"===typeof i&&"function"===typeof i.then){if(null!==(t=n.alternate)&&Er(t,n,r,!0),null!==(n=ra.current)){switch(n.tag){case 13:return null===oa?Xc():null===n.alternate&&0===dc&&(dc=3),n.flags&=-257,n.flags|=65536,n.lanes=r,i===Zr?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([i]):t.add(i),hu(e,i,r)),!1;case 22:return n.flags|=65536,i===Zr?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([i]):n.add(i),hu(e,i,r)),!1}throw Error(s(435,n.tag))}return hu(e,i,r),Xc(),!1}if(or)return null!==(t=ra.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,i!==lr&&mr(Ti(e=Error(s(422),{cause:i}),n))):(i!==lr&&mr(Ti(t=Error(s(423),{cause:i}),n)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,i=Ti(i,n),ao(e,r=Ea(e.stateNode,i,r)),4!==dc&&(dc=2)),!1;var o=Error(s(520),{cause:i});if(o=Ti(o,n),null===yc?yc=[o]:yc.push(o),4!==dc&&(dc=2),null===t)return!0;i=Ti(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=r&-r,n.lanes|=e,ao(n,e=Ea(n.stateNode,i,e)),!1;case 1:if(t=n.type,o=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==o&&"function"===typeof o.componentDidCatch&&(null===Tc||!Tc.has(o))))return n.flags|=65536,r&=-r,n.lanes|=r,Aa(r=Ta(r),e,n,i),ao(n,r),!1}n=n.return}while(null!==n);return!1}(e,r,t,n,oc))return dc=1,ba(e,Ti(n,e.current)),void(rc=null)}catch(o){if(null!==r)throw rc=r,o;return dc=1,ba(e,Ti(n,e.current)),void(rc=null)}32768&t.flags?(or||1===i?e=!0:cc||0!==(536870912&oc)?e=!1:(lc=e=!0,(2===i||9===i||3===i||6===i)&&(null!==(i=ra.current)&&13===i.tag&&(i.flags|=16384))),tu(t,e)):eu(t)}function eu(e){var t=e;do{if(0!==(32768&t.flags))return void tu(t,lc);e=t.return;var n=il(t.alternate,t,hc);if(null!==n)return void(rc=n);if(null!==(t=t.sibling))return void(rc=t);rc=t=e}while(null!==t);0===dc&&(dc=5)}function tu(e,t){do{var n=rl(e.alternate,e);if(null!==n)return n.flags&=32767,void(rc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(rc=e);rc=e=n}while(null!==e);dc=6,rc=null}function nu(e,t,n,i,r,o,a,l,c){e.cancelPendingCommit=null;do{au()}while(0!==Ac);if(0!==(6&nc))throw Error(s(327));if(null!==t){if(t===e.current)throw Error(s(177));if(o=t.lanes|t.childLanes,function(e,t,n,i,r,o){var s=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var a=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=s&~n;0<n;){var u=31-fe(n),h=1<<u;a[u]=0,l[u]=-1;var d=c[u];if(null!==d)for(c[u]=null,u=0;u<d.length;u++){var f=d[u];null!==f&&(f.lane&=-536870913)}n&=~h}0!==i&&Se(e,i,0),0!==o&&0===r&&0!==e.tag&&(e.suspendedLanes|=o&~(s&~t))}(e,n,o|=Di,a,l,c),e===ic&&(rc=ic=null,oc=0),Dc=t,Sc=e,Cc=n,Ic=o,Rc=r,Pc=i,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,J(oe,function(){return lu(),null})):(e.callbackNode=null,e.callbackPriority=0),i=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||i){i=L.T,L.T=null,r=k.p,k.p=2,a=nc,nc|=4;try{!function(e,t){if(e=e.containerInfo,th=nd,ti(e=ei(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(g){n=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==r&&3!==d.nodeType||(l=a+r),d!==o||0!==i&&3!==d.nodeType||(c=a+i),3===d.nodeType&&(a+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++u===r&&(l=a),f===o&&++h===i&&(c=a),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nh={focusedElem:e,selectionRange:n},nd=!1,El=t;null!==El;)if(e=(t=El).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,El=e;else for(;null!==El;){switch(o=(t=El).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==o){e=void 0,n=t,r=o.memoizedProps,o=o.memoizedState,i=n.stateNode;try{var m=ga(n.type,r,(n.elementType,n.type));e=i.getSnapshotBeforeUpdate(m,o),i.__reactInternalSnapshotBeforeUpdate=e}catch(_){uu(n,n.return,_)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))mh(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":mh(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(s(163))}if(null!==(e=t.sibling)){e.return=t.return,El=e;break}El=t.return}}(e,t)}finally{nc=a,k.p=r,L.T=i}}Ac=1,iu(),ru(),ou()}}function iu(){if(1===Ac){Ac=0;var e=Sc,t=Dc,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=L.T,L.T=null;var i=k.p;k.p=2;var r=nc;nc|=4;try{Ll(t,e);var o=nh,s=ei(e.containerInfo),a=o.focusedElem,l=o.selectionRange;if(s!==a&&a&&a.ownerDocument&&$n(a.ownerDocument.documentElement,a)){if(null!==l&&ti(a)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in a)a.selectionStart=c,a.selectionEnd=Math.min(u,a.value.length);else{var h=a.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var f=d.getSelection(),p=a.textContent.length,m=Math.min(l.start,p),g=void 0===l.end?m:Math.min(l.end,p);!f.extend&&m>g&&(s=g,g=m,m=s);var _=Qn(a,m),y=Qn(a,g);if(_&&y&&(1!==f.rangeCount||f.anchorNode!==_.node||f.anchorOffset!==_.offset||f.focusNode!==y.node||f.focusOffset!==y.offset)){var v=h.createRange();v.setStart(_.node,_.offset),f.removeAllRanges(),m>g?(f.addRange(v),f.extend(y.node,y.offset)):(v.setEnd(y.node,y.offset),f.addRange(v))}}}}for(h=[],f=a;f=f.parentNode;)1===f.nodeType&&h.push({element:f,left:f.scrollLeft,top:f.scrollTop});for("function"===typeof a.focus&&a.focus(),a=0;a<h.length;a++){var x=h[a];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}nd=!!th,nh=th=null}finally{nc=r,k.p=i,L.T=n}}e.current=t,Ac=2}}function ru(){if(2===Ac){Ac=0;var e=Sc,t=Dc,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=L.T,L.T=null;var i=k.p;k.p=2;var r=nc;nc|=4;try{Tl(e,t.alternate,t)}finally{nc=r,k.p=i,L.T=n}}Ac=3}}function ou(){if(4===Ac||3===Ac){Ac=0,ee();var e=Sc,t=Dc,n=Cc,i=Pc;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Ac=5:(Ac=0,Dc=Sc=null,su(e,e.pendingLanes));var r=e.pendingLanes;if(0===r&&(Tc=null),Ie(n),t=t.stateNode,he&&"function"===typeof he.onCommitFiberRoot)try{he.onCommitFiberRoot(ue,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==i){t=L.T,r=k.p,k.p=2,L.T=null;try{for(var o=e.onRecoverableError,s=0;s<i.length;s++){var a=i[s];o(a.value,{componentStack:a.stack})}}finally{L.T=t,k.p=r}}0!==(3&Cc)&&au(),wu(e),r=e.pendingLanes,0!==(4194090&n)&&0!==(42&r)?e===Fc?Mc++:(Mc=0,Fc=e):Mc=0,Eu(0,!1)}}function su(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Lr(t)))}function au(e){return iu(),ru(),ou(),lu()}function lu(){if(5!==Ac)return!1;var e=Sc,t=Ic;Ic=0;var n=Ie(Cc),i=L.T,r=k.p;try{k.p=32>n?32:n,L.T=null,n=Rc,Rc=null;var o=Sc,a=Cc;if(Ac=0,Dc=Sc=null,Cc=0,0!==(6&nc))throw Error(s(331));var l=nc;if(nc|=4,Jl(o.current),Gl(o,o.current,a,n),nc=l,Eu(0,!1),he&&"function"===typeof he.onPostCommitFiberRoot)try{he.onPostCommitFiberRoot(ue,o)}catch(c){}return!0}finally{k.p=r,L.T=i,su(e,t)}}function cu(e,t,n){t=Ti(n,t),null!==(e=oo(e,t=Ea(e.stateNode,t,2),2))&&(Ae(e,2),wu(e))}function uu(e,t,n){if(3===e.tag)cu(e,e,n);else for(;null!==t;){if(3===t.tag){cu(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Tc||!Tc.has(i))){e=Ti(n,e),null!==(i=oo(t,n=Ta(2),2))&&(Aa(n,i,t,e),Ae(i,2),wu(i));break}}t=t.return}}function hu(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new tc;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(uc=!0,r.add(n),e=du.bind(null,e,t,n),t.then(e,e))}function du(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,ic===e&&(oc&n)===n&&(4===dc||3===dc&&(62914560&oc)===oc&&300>te()-bc?0===(2&nc)&&Gc(e,0):mc|=n,_c===oc&&(_c=0)),wu(e)}function fu(e,t){0===t&&(t=Ee()),null!==(e=Pi(e,t))&&(Ae(e,t),wu(e))}function pu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),fu(e,n)}function mu(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(s(314))}null!==i&&i.delete(t),fu(e,n)}var gu=null,_u=null,yu=!1,vu=!1,xu=!1,bu=0;function wu(e){e!==_u&&null===e.next&&(null===_u?gu=_u=e:_u=_u.next=e),vu=!0,yu||(yu=!0,hh(function(){0!==(6&nc)?J(ie,Tu):Au()}))}function Eu(e,t){if(!xu&&vu){xu=!0;do{for(var n=!1,i=gu;null!==i;){if(!t)if(0!==e){var r=i.pendingLanes;if(0===r)var o=0;else{var s=i.suspendedLanes,a=i.pingedLanes;o=(1<<31-fe(42|e)+1)-1,o=201326741&(o&=r&~(s&~a))?201326741&o|1:o?2|o:0}0!==o&&(n=!0,Cu(i,o))}else o=oc,0===(3&(o=ve(i,i===ic?o:0,null!==i.cancelPendingCommit||-1!==i.timeoutHandle)))||xe(i,o)||(n=!0,Cu(i,o));i=i.next}}while(n);xu=!1}}function Tu(){Au()}function Au(){vu=yu=!1;var e=0;0!==bu&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==ah&&(ah=e,!0);return ah=null,!1}()&&(e=bu),bu=0);for(var t=te(),n=null,i=gu;null!==i;){var r=i.next,o=Su(i,t);0===o?(i.next=null,null===n?gu=r:n.next=r,null===r&&(_u=n)):(n=i,(0!==e||0!==(3&o))&&(vu=!0)),i=r}Eu(e,!1)}function Su(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=-62914561&e.pendingLanes;0<o;){var s=31-fe(o),a=1<<s,l=r[s];-1===l?0!==(a&n)&&0===(a&i)||(r[s]=be(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}if(n=oc,n=ve(e,e===(t=ic)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),i=e.callbackNode,0===n||e===t&&(2===sc||9===sc)||null!==e.cancelPendingCommit)return null!==i&&null!==i&&Q(i),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||xe(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==i&&Q(i),Ie(n)){case 2:case 8:n=re;break;case 32:default:n=oe;break;case 268435456:n=ae}return i=Du.bind(null,e),n=J(n,i),e.callbackPriority=t,e.callbackNode=n,t}return null!==i&&null!==i&&Q(i),e.callbackPriority=2,e.callbackNode=null,2}function Du(e,t){if(0!==Ac&&5!==Ac)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(au()&&e.callbackNode!==n)return null;var i=oc;return 0===(i=ve(e,e===ic?i:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Bc(e,i,t),Su(e,te()),null!=e.callbackNode&&e.callbackNode===n?Du.bind(null,e):null)}function Cu(e,t){if(au())return null;Bc(e,t,!0)}function Iu(){return 0===bu&&(bu=we()),bu}function Ru(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:It(""+e)}function Pu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Mu=0;Mu<bi.length;Mu++){var Fu=bi[Mu];wi(Fu.toLowerCase(),"on"+(Fu[0].toUpperCase()+Fu.slice(1)))}wi(fi,"onAnimationEnd"),wi(pi,"onAnimationIteration"),wi(mi,"onAnimationStart"),wi("dblclick","onDoubleClick"),wi("focusin","onFocus"),wi("focusout","onBlur"),wi(gi,"onTransitionRun"),wi(_i,"onTransitionStart"),wi(yi,"onTransitionCancel"),wi(vi,"onTransitionEnd"),Ye("onMouseEnter",["mouseout","mouseover"]),Ye("onMouseLeave",["mouseout","mouseover"]),Ye("onPointerEnter",["pointerout","pointerover"]),Ye("onPointerLeave",["pointerout","pointerover"]),Ze("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ze("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ze("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ze("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ze("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ze("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ku=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Lu));function Ou(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var a=i[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;o=a,r.currentTarget=c;try{o(r)}catch(u){_a(u)}r.currentTarget=null,o=l}else for(s=0;s<i.length;s++){if(l=(a=i[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;o=a,r.currentTarget=c;try{o(r)}catch(u){_a(u)}r.currentTarget=null,o=l}}}}function Bu(e,t){var n=t[ke];void 0===n&&(n=t[ke]=new Set);var i=e+"__bubble";n.has(i)||(Vu(t,e,2,!1),n.add(i))}function zu(e,t,n){var i=0;t&&(i|=4),Vu(n,e,i,t)}var Nu="_reactListening"+Math.random().toString(36).slice(2);function Uu(e){if(!e[Nu]){e[Nu]=!0,qe.forEach(function(t){"selectionchange"!==t&&(ku.has(t)||zu(t,!1,e),zu(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Nu]||(t[Nu]=!0,zu("selectionchange",!1,t))}}function Vu(e,t,n,i){switch(cd(t)){case 2:var r=id;break;case 8:r=rd;break;default:r=od}n=r.bind(null,t,n,e),r=void 0,!Nt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function ju(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var a=i.stateNode.containerInfo;if(a===r)break;if(4===s)for(s=i.return;null!==s;){var c=s.tag;if((3===c||4===c)&&s.stateNode.containerInfo===r)return;s=s.return}for(;null!==a;){if(null===(s=Ve(a)))return;if(5===(c=s.tag)||6===c||26===c||27===c){i=o=s;continue e}a=a.parentNode}}i=i.return}Ot(function(){var i=o,r=Pt(n),s=[];e:{var a=xi.get(e);if(void 0!==a){var c=$t,u=e;switch(e){case"keypress":if(0===Wt(n))break e;case"keydown":case"keyup":c=mn;break;case"focusin":u="focus",c=sn;break;case"focusout":u="blur",c=sn;break;case"beforeblur":case"afterblur":c=sn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=_n;break;case fi:case pi:case mi:c=an;break;case vi:c=yn;break;case"scroll":case"scrollend":c=tn;break;case"wheel":c=vn;break;case"copy":case"cut":case"paste":c=ln;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=gn;break;case"toggle":case"beforetoggle":c=xn}var h=0!==(4&t),d=!h&&("scroll"===e||"scrollend"===e),f=h?null!==a?a+"Capture":null:a;h=[];for(var p,m=i;null!==m;){var g=m;if(p=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===p||null===f||null!=(g=Bt(m,f))&&h.push(Gu(m,g,p)),d)break;m=m.return}0<h.length&&(a=new c(a,u,null,n,r),s.push({event:a,listeners:h}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===Rt||!(u=n.relatedTarget||n.fromElement)||!Ve(u)&&!u[Le])&&(c||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=i,null!==(u=(u=n.relatedTarget||n.toElement)?Ve(u):null)&&(d=l(u),h=u.tag,u!==d||5!==h&&27!==h&&6!==h)&&(u=null)):(c=null,u=i),c!==u)){if(h=rn,g="onMouseLeave",f="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(h=gn,g="onPointerLeave",f="onPointerEnter",m="pointer"),d=null==c?a:Ge(c),p=null==u?a:Ge(u),(a=new h(g,m+"leave",c,n,r)).target=d,a.relatedTarget=p,g=null,Ve(r)===i&&((h=new h(f,m+"enter",u,n,r)).target=p,h.relatedTarget=d,g=h),d=g,c&&u)e:{for(f=u,m=0,p=h=c;p;p=Wu(p))m++;for(p=0,g=f;g;g=Wu(g))p++;for(;0<m-p;)h=Wu(h),m--;for(;0<p-m;)f=Wu(f),p--;for(;m--;){if(h===f||null!==f&&h===f.alternate)break e;h=Wu(h),f=Wu(f)}h=null}else h=null;null!==c&&qu(s,a,c,h,!1),null!==u&&null!==d&&qu(s,d,u,h,!0)}if("select"===(c=(a=i?Ge(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var _=zn;else if(Mn(a))if(Nn)_=Zn;else{_=qn;var y=Wn}else!(c=a.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==a.type&&"radio"!==a.type?i&&St(i.elementType)&&(_=zn):_=Xn;switch(_&&(_=_(e,i))?Fn(s,_,n,r):(y&&y(e,a,i),"focusout"===e&&i&&"number"===a.type&&null!=i.memoizedProps.value&&yt(a,"number",a.value)),y=i?Ge(i):window,e){case"focusin":(Mn(y)||"true"===y.contentEditable)&&(ii=y,ri=i,oi=null);break;case"focusout":oi=ri=ii=null;break;case"mousedown":si=!0;break;case"contextmenu":case"mouseup":case"dragend":si=!1,ai(s,n,r);break;case"selectionchange":if(ni)break;case"keydown":case"keyup":ai(s,n,r)}var v;if(wn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Rn?Cn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(An&&"ko"!==n.locale&&(Rn||"onCompositionStart"!==x?"onCompositionEnd"===x&&Rn&&(v=Ht()):(jt="value"in(Vt=r)?Vt.value:Vt.textContent,Rn=!0)),0<(y=Hu(i,x)).length&&(x=new cn(x,e,null,n,r),s.push({event:x,listeners:y}),v?x.data=v:null!==(v=In(n))&&(x.data=v))),(v=Tn?function(e,t){switch(e){case"compositionend":return In(t);case"keypress":return 32!==t.which?null:(Dn=!0,Sn);case"textInput":return(e=t.data)===Sn&&Dn?null:e;default:return null}}(e,n):function(e,t){if(Rn)return"compositionend"===e||!wn&&Cn(e,t)?(e=Ht(),Gt=jt=Vt=null,Rn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return An&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(x=Hu(i,"onBeforeInput")).length&&(y=new cn("onBeforeInput","beforeinput",null,n,r),s.push({event:y,listeners:x}),y.data=v)),function(e,t,n,i,r){if("submit"===t&&n&&n.stateNode===r){var o=Ru((r[Fe]||null).action),s=i.submitter;s&&null!==(t=(t=s[Fe]||null)?Ru(t.formAction):s.getAttribute("formAction"))&&(o=t,s=null);var a=new $t("action","action",null,i,r);e.push({event:a,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(0!==bu){var e=s?Pu(r,s):new FormData(r);Ps(n,{pending:!0,data:e,method:r.method,action:o},null,e)}}else"function"===typeof o&&(a.preventDefault(),e=s?Pu(r,s):new FormData(r),Ps(n,{pending:!0,data:e,method:r.method,action:o},o,e))},currentTarget:r}]})}}(s,e,i,n,r)}Ou(s,t)})}function Gu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hu(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;if(5!==(r=r.tag)&&26!==r&&27!==r||null===o||(null!=(r=Bt(e,n))&&i.unshift(Gu(e,r,o)),null!=(r=Bt(e,t))&&i.push(Gu(e,r,o))),3===e.tag)return i;e=e.return}return[]}function Wu(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function qu(e,t,n,i,r){for(var o=t._reactName,s=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(a=a.tag,null!==l&&l===i)break;5!==a&&26!==a&&27!==a||null===c||(l=c,r?null!=(c=Bt(n,o))&&s.unshift(Gu(n,c,l)):r||null!=(c=Bt(n,o))&&s.push(Gu(n,c,l))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Xu=/\r\n?/g,Zu=/\u0000|\uFFFD/g;function Yu(e){return("string"===typeof e?e:""+e).replace(Xu,"\n").replace(Zu,"")}function Ku(e,t){return t=Yu(t),Yu(e)===t}function Ju(){}function Qu(e,t,n,i,r,o){switch(n){case"children":"string"===typeof i?"body"===t||"textarea"===t&&""===i||wt(e,i):("number"===typeof i||"bigint"===typeof i)&&"body"!==t&&wt(e,""+i);break;case"className":nt(e,"class",i);break;case"tabIndex":nt(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(e,n,i);break;case"style":At(e,i,o);break;case"data":if("object"!==t){nt(e,"data",i);break}case"src":case"href":if(""===i&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==i||"function"===typeof i||"symbol"===typeof i||"boolean"===typeof i){e.removeAttribute(n);break}i=It(""+i),e.setAttribute(n,i);break;case"action":case"formAction":if("function"===typeof i){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof o&&("formAction"===n?("input"!==t&&Qu(e,t,"name",r.name,r,null),Qu(e,t,"formEncType",r.formEncType,r,null),Qu(e,t,"formMethod",r.formMethod,r,null),Qu(e,t,"formTarget",r.formTarget,r,null)):(Qu(e,t,"encType",r.encType,r,null),Qu(e,t,"method",r.method,r,null),Qu(e,t,"target",r.target,r,null))),null==i||"symbol"===typeof i||"boolean"===typeof i){e.removeAttribute(n);break}i=It(""+i),e.setAttribute(n,i);break;case"onClick":null!=i&&(e.onclick=Ju);break;case"onScroll":null!=i&&Bu("scroll",e);break;case"onScrollEnd":null!=i&&Bu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(s(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(s(60));e.innerHTML=n}}break;case"multiple":e.multiple=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"muted":e.muted=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==i||"function"===typeof i||"boolean"===typeof i||"symbol"===typeof i){e.removeAttribute("xlink:href");break}n=It(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,""+i):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===i?e.setAttribute(n,""):!1!==i&&null!=i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,i):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&!isNaN(i)&&1<=i?e.setAttribute(n,i):e.removeAttribute(n);break;case"rowSpan":case"start":null==i||"function"===typeof i||"symbol"===typeof i||isNaN(i)?e.removeAttribute(n):e.setAttribute(n,i);break;case"popover":Bu("beforetoggle",e),Bu("toggle",e),tt(e,"popover",i);break;case"xlinkActuate":it(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":it(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":it(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":it(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":it(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":it(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":it(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":it(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":it(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":tt(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&tt(e,n=Dt.get(n)||n,i)}}function $u(e,t,n,i,r,o){switch(n){case"style":At(e,i,o);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(s(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(s(60));e.innerHTML=n}}break;case"children":"string"===typeof i?wt(e,i):("number"===typeof i||"bigint"===typeof i)&&wt(e,""+i);break;case"onScroll":null!=i&&Bu("scroll",e);break;case"onScrollEnd":null!=i&&Bu("scrollend",e);break;case"onClick":null!=i&&(e.onclick=Ju);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Xe.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(r=n.endsWith("Capture"),t=n.slice(2,r?n.length-7:void 0),"function"===typeof(o=null!=(o=e[Fe]||null)?o[n]:null)&&e.removeEventListener(t,o,r),"function"!==typeof i)?n in e?e[n]=i:!0===i?e.setAttribute(n,""):tt(e,n,i):("function"!==typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,i,r)))}}function eh(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Bu("error",e),Bu("load",e);var i,r=!1,o=!1;for(i in n)if(n.hasOwnProperty(i)){var a=n[i];if(null!=a)switch(i){case"src":r=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:Qu(e,t,i,a,n,null)}}return o&&Qu(e,t,"srcSet",n.srcSet,n,null),void(r&&Qu(e,t,"src",n.src,n,null));case"input":Bu("invalid",e);var l=i=a=o=null,c=null,u=null;for(r in n)if(n.hasOwnProperty(r)){var h=n[r];if(null!=h)switch(r){case"name":o=h;break;case"type":a=h;break;case"checked":c=h;break;case"defaultChecked":u=h;break;case"value":i=h;break;case"defaultValue":l=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(s(137,t));break;default:Qu(e,t,r,h,n,null)}}return _t(e,i,l,c,u,a,o,!1),void ht(e);case"select":for(o in Bu("invalid",e),r=a=i=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":i=l;break;case"defaultValue":a=l;break;case"multiple":r=l;default:Qu(e,t,o,l,n,null)}return t=i,n=a,e.multiple=!!r,void(null!=t?vt(e,!!r,t,!1):null!=n&&vt(e,!!r,n,!0));case"textarea":for(a in Bu("invalid",e),i=o=r=null,n)if(n.hasOwnProperty(a)&&null!=(l=n[a]))switch(a){case"value":r=l;break;case"defaultValue":o=l;break;case"children":i=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(s(91));break;default:Qu(e,t,a,l,n,null)}return bt(e,r,o,i),void ht(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(r=n[c]))if("selected"===c)e.selected=r&&"function"!==typeof r&&"symbol"!==typeof r;else Qu(e,t,c,r,n,null);return;case"dialog":Bu("beforetoggle",e),Bu("toggle",e),Bu("cancel",e),Bu("close",e);break;case"iframe":case"object":Bu("load",e);break;case"video":case"audio":for(r=0;r<Lu.length;r++)Bu(Lu[r],e);break;case"image":Bu("error",e),Bu("load",e);break;case"details":Bu("toggle",e);break;case"embed":case"source":case"link":Bu("error",e),Bu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(r=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:Qu(e,t,u,r,n,null)}return;default:if(St(t)){for(h in n)n.hasOwnProperty(h)&&(void 0!==(r=n[h])&&$u(e,t,h,r,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(r=n[l])&&Qu(e,t,l,r,n,null))}var th=null,nh=null;function ih(e){return 9===e.nodeType?e:e.ownerDocument}function rh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function oh(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function sh(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ah=null;var lh="function"===typeof setTimeout?setTimeout:void 0,ch="function"===typeof clearTimeout?clearTimeout:void 0,uh="function"===typeof Promise?Promise:void 0,hh="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof uh?function(e){return uh.resolve(null).then(e).catch(dh)}:lh;function dh(e){setTimeout(function(){throw e})}function fh(e){return"head"===e}function ph(e,t){var n=t,i=0,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0<i&&8>i){n=i;var s=e.ownerDocument;if(1&n&&bh(s.documentElement),2&n&&bh(s.body),4&n)for(bh(n=s.head),s=n.firstChild;s;){var a=s.nextSibling,l=s.nodeName;s[Ne]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===s.rel.toLowerCase()||n.removeChild(s),s=a}}if(0===r)return e.removeChild(o),void Dd(t);r--}else"$"===n||"$?"===n||"$!"===n?r++:i=n.charCodeAt(0)-48;else i=0;n=o}while(n);Dd(t)}function mh(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":mh(n),Ue(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function gh(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function _h(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var yh=null;function vh(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function xh(e,t,n){switch(t=ih(n),e){case"html":if(!(e=t.documentElement))throw Error(s(452));return e;case"head":if(!(e=t.head))throw Error(s(453));return e;case"body":if(!(e=t.body))throw Error(s(454));return e;default:throw Error(s(451))}}function bh(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ue(e)}var wh=new Map,Eh=new Set;function Th(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Ah=k.d;k.d={f:function(){var e=Ah.f(),t=Vc();return e||t},r:function(e){var t=je(e);null!==t&&5===t.tag&&"form"===t.type?Fs(t):Ah.r(e)},D:function(e){Ah.D(e),Dh("dns-prefetch",e,null)},C:function(e,t){Ah.C(e,t),Dh("preconnect",e,t)},L:function(e,t,n){Ah.L(e,t,n);var i=Sh;if(i&&e&&t){var r='link[rel="preload"][as="'+mt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(r+='[imagesrcset="'+mt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(r+='[imagesizes="'+mt(n.imageSizes)+'"]')):r+='[href="'+mt(e)+'"]';var o=r;switch(t){case"style":o=Ih(e);break;case"script":o=Mh(e)}wh.has(o)||(e=d({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),wh.set(o,e),null!==i.querySelector(r)||"style"===t&&i.querySelector(Rh(o))||"script"===t&&i.querySelector(Fh(o))||(eh(t=i.createElement("link"),"link",e),We(t),i.head.appendChild(t)))}},m:function(e,t){Ah.m(e,t);var n=Sh;if(n&&e){var i=t&&"string"===typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+mt(i)+'"][href="'+mt(e)+'"]',o=r;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":o=Mh(e)}if(!wh.has(o)&&(e=d({rel:"modulepreload",href:e},t),wh.set(o,e),null===n.querySelector(r))){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Fh(o)))return}eh(i=n.createElement("link"),"link",e),We(i),n.head.appendChild(i)}}},X:function(e,t){Ah.X(e,t);var n=Sh;if(n&&e){var i=He(n).hoistableScripts,r=Mh(e),o=i.get(r);o||((o=n.querySelector(Fh(r)))||(e=d({src:e,async:!0},t),(t=wh.get(r))&&Bh(e,t),We(o=n.createElement("script")),eh(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},i.set(r,o))}},S:function(e,t,n){Ah.S(e,t,n);var i=Sh;if(i&&e){var r=He(i).hoistableStyles,o=Ih(e);t=t||"default";var s=r.get(o);if(!s){var a={loading:0,preload:null};if(s=i.querySelector(Rh(o)))a.loading=5;else{e=d({rel:"stylesheet",href:e,"data-precedence":t},n),(n=wh.get(o))&&Oh(e,n);var l=s=i.createElement("link");We(l),eh(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){a.loading|=1}),l.addEventListener("error",function(){a.loading|=2}),a.loading|=4,kh(s,t,i)}s={type:"stylesheet",instance:s,count:1,state:a},r.set(o,s)}}},M:function(e,t){Ah.M(e,t);var n=Sh;if(n&&e){var i=He(n).hoistableScripts,r=Mh(e),o=i.get(r);o||((o=n.querySelector(Fh(r)))||(e=d({src:e,async:!0,type:"module"},t),(t=wh.get(r))&&Bh(e,t),We(o=n.createElement("script")),eh(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},i.set(r,o))}}};var Sh="undefined"===typeof document?null:document;function Dh(e,t,n){var i=Sh;if(i&&"string"===typeof t&&t){var r=mt(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"===typeof n&&(r+='[crossorigin="'+n+'"]'),Eh.has(r)||(Eh.add(r),e={rel:e,crossOrigin:n,href:t},null===i.querySelector(r)&&(eh(t=i.createElement("link"),"link",e),We(t),i.head.appendChild(t)))}}function Ch(e,t,n,i){var r,o,a,l,c=(c=H.current)?Th(c):null;if(!c)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Ih(n.href),(i=(n=He(c).hoistableStyles).get(t))||(i={type:"style",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Ih(n.href);var u=He(c).hoistableStyles,h=u.get(e);if(h||(c=c.ownerDocument||c,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,h),(u=c.querySelector(Rh(e)))&&!u._p&&(h.instance=u,h.state.loading=5),wh.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},wh.set(e,n),u||(r=c,o=e,a=n,l=h.state,r.querySelector('link[rel="preload"][as="style"]['+o+"]")?l.loading=1:(o=r.createElement("link"),l.preload=o,o.addEventListener("load",function(){return l.loading|=1}),o.addEventListener("error",function(){return l.loading|=2}),eh(o,"link",a),We(o),r.head.appendChild(o))))),t&&null===i)throw Error(s(528,""));return h}if(t&&null!==i)throw Error(s(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Mh(n),(i=(n=He(c).hoistableScripts).get(t))||(i={type:"script",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function Ih(e){return'href="'+mt(e)+'"'}function Rh(e){return'link[rel="stylesheet"]['+e+"]"}function Ph(e){return d({},e,{"data-precedence":e.precedence,precedence:null})}function Mh(e){return'[src="'+mt(e)+'"]'}function Fh(e){return"script[async]"+e}function Lh(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+mt(n.href)+'"]');if(i)return t.instance=i,We(i),i;var r=d({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return We(i=(e.ownerDocument||e).createElement("style")),eh(i,"style",r),kh(i,n.precedence,e),t.instance=i;case"stylesheet":r=Ih(n.href);var o=e.querySelector(Rh(r));if(o)return t.state.loading|=4,t.instance=o,We(o),o;i=Ph(n),(r=wh.get(r))&&Oh(i,r),We(o=(e.ownerDocument||e).createElement("link"));var a=o;return a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),eh(o,"link",i),t.state.loading|=4,kh(o,n.precedence,e),t.instance=o;case"script":return o=Mh(n.src),(r=e.querySelector(Fh(o)))?(t.instance=r,We(r),r):(i=n,(r=wh.get(o))&&Bh(i=d({},n),r),We(r=(e=e.ownerDocument||e).createElement("script")),eh(r,"link",i),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(s(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(i=t.instance,t.state.loading|=4,kh(i,n.precedence,e));return t.instance}function kh(e,t,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=i.length?i[i.length-1]:null,o=r,s=0;s<i.length;s++){var a=i[s];if(a.dataset.precedence===t)o=a;else if(o!==r)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Oh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Bh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var zh=null;function Nh(e,t,n){if(null===zh){var i=new Map,r=zh=new Map;r.set(n,i)}else(i=(r=zh).get(n))||(i=new Map,r.set(n,i));if(i.has(e))return i;for(i.set(e,null),n=n.getElementsByTagName(e),r=0;r<n.length;r++){var o=n[r];if(!(o[Ne]||o[Me]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==o.namespaceURI){var s=o.getAttribute(t)||"";s=e+s;var a=i.get(s);a?a.push(o):i.set(s,[o])}}return i}function Uh(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Vh(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var jh=null;function Gh(){}function Hh(){if(this.count--,0===this.count)if(this.stylesheets)qh(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Wh=null;function qh(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Wh=new Map,t.forEach(Xh,e),Wh=null,Hh.call(e))}function Xh(e,t){if(!(4&t.state.loading)){var n=Wh.get(e);if(n)var i=n.get(null);else{n=new Map,Wh.set(e,n);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<r.length;o++){var s=r[o];"LINK"!==s.nodeName&&"not all"===s.getAttribute("media")||(n.set(s.dataset.precedence,s),i=s)}i&&n.set(null,i)}s=(r=t.instance).getAttribute("data-precedence"),(o=n.get(s)||i)===i&&n.set(null,r),n.set(s,r),this.count++,i=Hh.bind(this),r.addEventListener("load",i),r.addEventListener("error",i),o?o.parentNode.insertBefore(r,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(r,e.firstChild),t.state.loading|=4}}var Zh={$$typeof:b,Provider:null,Consumer:null,_currentValue:O,_currentValue2:O,_threadCount:0};function Yh(e,t,n,i,r,o,s,a){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Te(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Te(0),this.hiddenUpdates=Te(null),this.identifierPrefix=i,this.onUncaughtError=r,this.onCaughtError=o,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=a,this.incompleteTransitions=new Map}function Kh(e,t,n,i,r,o,s,a,l,c,u,h){return e=new Yh(e,t,n,s,a,l,c,h),t=1,!0===o&&(t|=24),o=Oi(3,null,null,t),e.current=o,o.stateNode=e,(t=Fr()).refCount++,e.pooledCache=t,t.refCount++,o.memoizedState={element:i,isDehydrated:n,cache:t},no(o),e}function Jh(e){return e?e=Li:Li}function Qh(e,t,n,i,r,o){r=Jh(r),null===i.context?i.context=r:i.pendingContext=r,(i=ro(t)).payload={element:n},null!==(o=void 0===o?null:o)&&(i.callback=o),null!==(n=oo(e,i,t))&&(Oc(n,0,t),so(n,e,t))}function $h(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ed(e,t){$h(e,t),(e=e.alternate)&&$h(e,t)}function td(e){if(13===e.tag){var t=Pi(e,67108864);null!==t&&Oc(t,0,67108864),ed(e,67108864)}}var nd=!0;function id(e,t,n,i){var r=L.T;L.T=null;var o=k.p;try{k.p=2,od(e,t,n,i)}finally{k.p=o,L.T=r}}function rd(e,t,n,i){var r=L.T;L.T=null;var o=k.p;try{k.p=8,od(e,t,n,i)}finally{k.p=o,L.T=r}}function od(e,t,n,i){if(nd){var r=sd(i);if(null===r)ju(e,t,i,ad,n),yd(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return hd=vd(hd,e,t,n,i,r),!0;case"dragenter":return dd=vd(dd,e,t,n,i,r),!0;case"mouseover":return fd=vd(fd,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return pd.set(o,vd(pd.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,md.set(o,vd(md.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(yd(e,i),4&t&&-1<_d.indexOf(e)){for(;null!==r;){var o=je(r);if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var s=ye(o.pendingLanes);if(0!==s){var a=o;for(a.pendingLanes|=2,a.entangledLanes|=2;s;){var l=1<<31-fe(s);a.entanglements[1]|=l,s&=~l}wu(o),0===(6&nc)&&(wc=te()+500,Eu(0,!1))}}break;case 13:null!==(a=Pi(o,2))&&Oc(a,0,2),Vc(),ed(o,2)}if(null===(o=sd(i))&&ju(e,t,i,ad,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else ju(e,t,i,null,n)}}function sd(e){return ld(e=Pt(e))}var ad=null;function ld(e){if(ad=null,null!==(e=Ve(e))){var t=l(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=c(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return ad=e,null}function cd(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case ie:return 2;case re:return 8;case oe:case se:return 32;case ae:return 268435456;default:return 32}default:return 32}}var ud=!1,hd=null,dd=null,fd=null,pd=new Map,md=new Map,gd=[],_d="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yd(e,t){switch(e){case"focusin":case"focusout":hd=null;break;case"dragenter":case"dragleave":dd=null;break;case"mouseover":case"mouseout":fd=null;break;case"pointerover":case"pointerout":pd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":md.delete(t.pointerId)}}function vd(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=je(t))&&td(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function xd(e){var t=Ve(e.target);if(null!==t){var n=l(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=c(n)))return e.blockedOn=t,void function(e,t){var n=k.p;try{return k.p=e,t()}finally{k.p=n}}(e.priority,function(){if(13===n.tag){var e=Lc();e=Ce(e);var t=Pi(n,e);null!==t&&Oc(t,0,e),ed(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function bd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=sd(e.nativeEvent);if(null!==n)return null!==(t=je(n))&&td(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);Rt=i,n.target.dispatchEvent(i),Rt=null,t.shift()}return!0}function wd(e,t,n){bd(e)&&n.delete(t)}function Ed(){ud=!1,null!==hd&&bd(hd)&&(hd=null),null!==dd&&bd(dd)&&(dd=null),null!==fd&&bd(fd)&&(fd=null),pd.forEach(wd),md.forEach(wd)}function Td(e,t){e.blockedOn===t&&(e.blockedOn=null,ud||(ud=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Ed)))}var Ad=null;function Sd(e){Ad!==e&&(Ad=e,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Ad===e&&(Ad=null);for(var t=0;t<e.length;t+=3){var n=e[t],i=e[t+1],r=e[t+2];if("function"!==typeof i){if(null===ld(i||n))continue;break}var o=je(n);null!==o&&(e.splice(t,3),t-=3,Ps(o,{pending:!0,data:r,method:n.method,action:i},i,r))}}))}function Dd(e){function t(t){return Td(t,e)}null!==hd&&Td(hd,e),null!==dd&&Td(dd,e),null!==fd&&Td(fd,e),pd.forEach(t),md.forEach(t);for(var n=0;n<gd.length;n++){var i=gd[n];i.blockedOn===e&&(i.blockedOn=null)}for(;0<gd.length&&null===(n=gd[0]).blockedOn;)xd(n),null===n.blockedOn&&gd.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(i=0;i<n.length;i+=3){var r=n[i],o=n[i+1],s=r[Fe]||null;if("function"===typeof o)s||Sd(n);else if(s){var a=null;if(o&&o.hasAttribute("formAction")){if(r=o,s=o[Fe]||null)a=s.formAction;else if(null!==ld(r))continue}else a=s.action;"function"===typeof a?n[i+1]=a:(n.splice(i,3),i-=3),Sd(n)}}}function Cd(e){this._internalRoot=e}function Id(e){this._internalRoot=e}Id.prototype.render=Cd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Qh(t.current,Lc(),e,t,null,null)},Id.prototype.unmount=Cd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Qh(e.current,2,null,e,null,null),Vc(),t[Le]=null}},Id.prototype.unstable_scheduleHydration=function(e){if(e){var t=Re();e={blockedOn:null,target:e,priority:t};for(var n=0;n<gd.length&&0!==t&&t<gd[n].priority;n++);gd.splice(n,0,e),0===n&&xd(e)}};var Rd=r.version;if("19.1.1"!==Rd)throw Error(s(527,Rd,"19.1.1"));k.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return u(r),e;if(o===i)return u(r),t;o=o.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,c=r.child;c;){if(c===n){a=!0,n=r,i=o;break}if(c===i){a=!0,i=r,n=o;break}c=c.sibling}if(!a){for(c=o.child;c;){if(c===n){a=!0,n=o,i=r;break}if(c===i){a=!0,i=o,n=r;break}c=c.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?h(e):null)?null:e.stateNode};var Pd={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.1.1"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Md=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Md.isDisabled&&Md.supportsFiber)try{ue=Md.inject(Pd),he=Md}catch(Ld){}}t.createRoot=function(e,t){if(!a(e))throw Error(s(299));var n=!1,i="",r=ya,o=va,l=xa;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onUncaughtError&&(r=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Kh(e,1,!1,null,0,n,i,r,o,l,0,null),e[Le]=t.current,Uu(e),new Cd(t)},t.hydrateRoot=function(e,t,n){if(!a(e))throw Error(s(299));var i=!1,r="",o=ya,l=va,c=xa,u=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(r=n.identifierPrefix),void 0!==n.onUncaughtError&&(o=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(u=n.formState)),(t=Kh(e,1,!0,t,0,i,r,o,l,c,0,u)).context=Jh(null),n=t.current,(r=ro(i=Ce(i=Lc()))).callback=null,oo(n,r,i),n=i,t.current.lanes=n,Ae(t,n),wu(t),e[Le]=t.current,Uu(e),new Id(t)},t.version="19.1.1"},43:(e,t,n)=>{"use strict";e.exports=n(288)},288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=_.prototype;var x=v.prototype=new y;x.constructor=v,m(x,_.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w={H:null,A:null,T:null,S:null,V:null},E=Object.prototype.hasOwnProperty;function T(e,t,i,r,o,s){return i=s.ref,{$$typeof:n,type:e,key:t,ref:void 0!==i?i:null,props:s}}function A(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var S=/\/+/g;function D(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function C(){}function I(e,t,r,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(a){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case i:u=!0;break;case d:return I((u=e._init)(e._payload),t,r,o,s)}}if(u)return s=s(e),u=""===o?"."+D(e,0):o,b(s)?(r="",null!=u&&(r=u.replace(S,"$&/")+"/"),I(s,t,r,"",function(e){return e})):null!=s&&(A(s)&&(l=s,c=r+(null==s.key||e&&e.key===s.key?"":(""+s.key).replace(S,"$&/")+"/")+u,s=T(l.type,c,void 0,0,0,l.props)),t.push(s)),1;u=0;var h,p=""===o?".":o+":";if(b(e))for(var m=0;m<e.length;m++)u+=I(o=e[m],t,r,a=p+D(o,m),s);else if("function"===typeof(m=null===(h=e)||"object"!==typeof h?null:"function"===typeof(h=f&&h[f]||h["@@iterator"])?h:null))for(e=m.call(e),m=0;!(o=e.next()).done;)u+=I(o=o.value,t,r,a=p+D(o,m++),s);else if("object"===a){if("function"===typeof e.then)return I(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(C,C):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,r,o,s);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function R(e,t,n){if(null==e)return e;var i=[],r=0;return I(e,i,"","",function(e){return t.call(n,e,r++)}),i}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var M="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function F(){}t.Children={map:R,forEach:function(e,t,n){R(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return R(e,function(){t++}),t},toArray:function(e){return R(e,function(e){return e})||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=r,t.Profiler=s,t.PureComponent=v,t.StrictMode=o,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return w.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var i=m({},e.props),r=e.key;if(null!=t)for(o in void 0!==t.ref&&void 0,void 0!==t.key&&(r=""+t.key),t)!E.call(t,o)||"key"===o||"__self"===o||"__source"===o||"ref"===o&&void 0===t.ref||(i[o]=t[o]);var o=arguments.length-2;if(1===o)i.children=n;else if(1<o){for(var s=Array(o),a=0;a<o;a++)s[a]=arguments[a+2];i.children=s}return T(e.type,r,void 0,0,0,i)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:a,_context:e},e},t.createElement=function(e,t,n){var i,r={},o=null;if(null!=t)for(i in void 0!==t.key&&(o=""+t.key),t)E.call(t,i)&&"key"!==i&&"__self"!==i&&"__source"!==i&&(r[i]=t[i]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var a=Array(s),l=0;l<s;l++)a[l]=arguments[l+2];r.children=a}if(e&&e.defaultProps)for(i in s=e.defaultProps)void 0===r[i]&&(r[i]=s[i]);return T(e,o,void 0,0,0,r)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=w.T,n={};w.T=n;try{var i=e(),r=w.S;null!==r&&r(n,i),"object"===typeof i&&null!==i&&"function"===typeof i.then&&i.then(F,M)}catch(o){M(o)}finally{w.T=t}},t.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},t.use=function(e){return w.H.use(e)},t.useActionState=function(e,t,n){return w.H.useActionState(e,t,n)},t.useCallback=function(e,t){return w.H.useCallback(e,t)},t.useContext=function(e){return w.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return w.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var i=w.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return i.useEffect(e,t)},t.useId=function(){return w.H.useId()},t.useImperativeHandle=function(e,t,n){return w.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return w.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return w.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return w.H.useMemo(e,t)},t.useOptimistic=function(e,t){return w.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return w.H.useReducer(e,t,n)},t.useRef=function(e){return w.H.useRef(e)},t.useState=function(e){return w.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return w.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return w.H.useTransition()},t.version="19.1.1"},391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4)},579:(e,t,n)=>{"use strict";e.exports=n(799)},672:(e,t,n)=>{"use strict";var i=n(43);function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var s={d:{f:o,r:function(){throw Error(r(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},a=Symbol.for("react.portal");var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(r(299));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:a,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=s.p;try{if(l.T=null,s.p=2,e)return e()}finally{l.T=t,s.p=n,s.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,s.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&s.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,i=c(n,t.crossOrigin),r="string"===typeof t.integrity?t.integrity:void 0,o="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?s.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:i,integrity:r,fetchPriority:o}):"script"===n&&s.d.X(e,{crossOrigin:i,integrity:r,fetchPriority:o,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);s.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&s.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,i=c(n,t.crossOrigin);s.d.L(e,n,{crossOrigin:i,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);s.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else s.d.m(e)},t.requestFormReset=function(e){s.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.1.1"},766:function(e,t){var n,i,r;i=[],n=function e(){var t,n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},i=!n.document&&!!n.postMessage,r=n.IS_PAPA_WORKER||!1,o={},s=0,a={};function l(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=v(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new f(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,t){var i=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<i){let t=this._config.newline;t||(o=this._config.quoteChar||'"',t=this._handle.guessLineEndings(e,o)),e=[...e.split(t).slice(i)].join(t)}this.isFirstChunk&&b(this._config.beforeFirstChunk)&&void 0!==(o=this._config.beforeFirstChunk(e))&&(e=o),this.isFirstChunk=!1,this._halted=!1,i=this._partialLine+e;var o=(this._partialLine="",this._handle.parse(i,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(e=o.meta.cursor,this._finished||(this._partialLine=i.substring(e-this._baseIndex),this._baseIndex=e),o&&o.data&&(this._rowCount+=o.data.length),i=this._finished||this._config.preview&&this._rowCount>=this._config.preview,r)n.postMessage({results:o,workerId:a.WORKER_ID,finished:i});else if(b(this._config.chunk)&&!t){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=o=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!i||!b(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),i||o&&o.meta.paused||this._nextChunk(),o}this._halted=!0},this._sendError=function(e){b(this._config.error)?this._config.error(e):r&&this._config.error&&n.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function c(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),l.call(this,e),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),i||(t.onload=x(this._chunkLoaded,this),t.onerror=x(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var e,n=this._config.downloadRequestHeaders;for(e in n)t.setRequestHeader(e,n[e])}var r;this._config.chunkSize&&(r=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+r));try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}i&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(e=>null!==(e=e.getResponseHeader("Content-Range"))?parseInt(e.substring(e.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){e=t.statusText||e,this._sendError(new Error(e))}}function u(e){(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),l.call(this,e);var t,n,i="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,i?((t=new FileReader).onload=x(this._chunkLoaded,this),t.onerror=x(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input,r=(this._config.chunkSize&&(r=Math.min(this._start+this._config.chunkSize,this._input.size),e=n.call(e,this._start,r)),t.readAsText(e,this._config.encoding));i||this._chunkLoaded({target:{result:r}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function h(e){var t;l.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){var e,n;if(!this._finished)return e=this._config.chunkSize,t=e?(n=t.substring(0,e),t.substring(e)):(n=t,""),this._finished=!t,this.parseChunk(n)}}function d(e){l.call(this,e=e||{});var t=[],n=!0,i=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){i&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=x(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}},this),this._streamError=x(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=x(function(){this._streamCleanUp(),i=!0,this._streamData("")},this),this._streamCleanUp=x(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function f(e){var t,n,i,r,o=Math.pow(2,53),s=-o,l=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,c=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,u=this,h=0,d=0,f=!1,g=!1,_=[],y={data:[],errors:[],meta:{}};function x(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function w(){if(y&&i&&(T("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),i=!1),e.skipEmptyLines&&(y.data=y.data.filter(function(e){return!x(e)})),E()){if(y)if(Array.isArray(y.data[0])){for(var t=0;E()&&t<y.data.length;t++)y.data[t].forEach(n);y.data.splice(0,1)}else y.data.forEach(n);function n(t,n){b(e.transformHeader)&&(t=e.transformHeader(t,n)),_.push(t)}}function r(t,n){for(var i=e.header?{}:[],r=0;r<t.length;r++){var a=r,u=t[r];u=((t,n)=>(t=>(e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)))(t)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&((e=>{if(l.test(e)&&(e=parseFloat(e),s<e&&e<o))return 1})(n)?parseFloat(n):c.test(n)?new Date(n):""===n?null:n):n)(a=e.header?r>=_.length?"__parsed_extra":_[r]:a,u=e.transform?e.transform(u,a):u),"__parsed_extra"===a?(i[a]=i[a]||[],i[a].push(u)):i[a]=u}return e.header&&(r>_.length?T("FieldMismatch","TooManyFields","Too many fields: expected "+_.length+" fields but parsed "+r,d+n):r<_.length&&T("FieldMismatch","TooFewFields","Too few fields: expected "+_.length+" fields but parsed "+r,d+n)),i}var u;y&&(e.header||e.dynamicTyping||e.transform)&&(u=1,!y.data.length||Array.isArray(y.data[0])?(y.data=y.data.map(r),u=y.data.length):y.data=r(y.data,0),e.header&&y.meta&&(y.meta.fields=_),d+=u)}function E(){return e.header&&0===_.length}function T(e,t,n,i){e={type:e,code:t,message:n},void 0!==i&&(e.row=i),y.errors.push(e)}b(e.step)&&(r=e.step,e.step=function(t){y=t,E()?w():(w(),0!==y.data.length&&(h+=t.data.length,e.preview&&h>e.preview?n.abort():(y.data=y.data[0],r(y,u))))}),this.parse=function(r,o,s){var l=e.quoteChar||'"';return e.newline||(e.newline=this.guessLineEndings(r,l)),i=!1,e.delimiter?b(e.delimiter)&&(e.delimiter=e.delimiter(r),y.meta.delimiter=e.delimiter):((l=((t,n,i,r,o)=>{var s,l,c,u;o=o||[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var h=0;h<o.length;h++){for(var d,f=o[h],p=0,g=0,_=0,y=(c=void 0,new m({comments:r,delimiter:f,newline:n,preview:10}).parse(t)),v=0;v<y.data.length;v++)i&&x(y.data[v])?_++:(g+=d=y.data[v].length,void 0===c?c=d:0<d&&(p+=Math.abs(d-c),c=d));0<y.data.length&&(g/=y.data.length-_),(void 0===l||p<=l)&&(void 0===u||u<g)&&1.99<g&&(l=p,s=f,u=g)}return{successful:!!(e.delimiter=s),bestDelimiter:s}})(r,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=l.bestDelimiter:(i=!0,e.delimiter=a.DefaultDelimiter),y.meta.delimiter=e.delimiter),l=v(e),e.preview&&e.header&&l.preview++,t=r,n=new m(l),y=n.parse(t,o,s),w(),f?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return f},this.pause=function(){f=!0,n.abort(),t=b(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){u.streamer._halted?(f=!1,u.streamer.parseChunk(t,!0)):setTimeout(u.resume,3)},this.aborted=function(){return g},this.abort=function(){g=!0,n.abort(),y.meta.aborted=!0,b(e.complete)&&e.complete(y),t=""},this.guessLineEndings=function(e,t){e=e.substring(0,1048576),t=new RegExp(p(t)+"([^]*?)"+p(t),"gm");var n=(e=e.replace(t,"")).split("\r");if(e=1<(t=e.split("\n")).length&&t[0].length<n[0].length,1===n.length||e)return"\n";for(var i=0,r=0;r<n.length;r++)"\n"===n[r][0]&&i++;return i>=n.length/2?"\r\n":"\r"}}function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function m(e){var t=(e=e||{}).delimiter,n=e.newline,i=e.comments,r=e.step,o=e.preview,s=e.fastMode,l=null,c=!1,u=null==e.quoteChar?'"':e.quoteChar,h=u;if(void 0!==e.escapeChar&&(h=e.escapeChar),("string"!=typeof t||-1<a.BAD_DELIMITERS.indexOf(t))&&(t=","),i===t)throw new Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||-1<a.BAD_DELIMITERS.indexOf(i))&&(i=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var d=0,f=!1;this.parse=function(a,m,g){if("string"!=typeof a)throw new Error("Input must be a string");var _=a.length,y=t.length,v=n.length,x=i.length,w=b(r),E=[],T=[],A=[],S=d=0;if(!a)return z();if(s||!1!==s&&-1===a.indexOf(u)){for(var D=a.split(n),C=0;C<D.length;C++){if(A=D[C],d+=A.length,C!==D.length-1)d+=n.length;else if(g)return z();if(!i||A.substring(0,x)!==i){if(w){if(E=[],L(A.split(t)),N(),f)return z()}else L(A.split(t));if(o&&o<=C)return E=E.slice(0,o),z(!0)}}return z()}for(var I=a.indexOf(t,d),R=a.indexOf(n,d),P=new RegExp(p(h)+p(u),"g"),M=a.indexOf(u,d);;)if(a[d]===u)for(M=d,d++;;){if(-1===(M=a.indexOf(u,M+1)))return g||T.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:E.length,index:d}),O();if(M===_-1)return O(a.substring(d,M).replace(P,u));if(u===h&&a[M+1]===h)M++;else if(u===h||0===M||a[M-1]!==h){-1!==I&&I<M+1&&(I=a.indexOf(t,M+1));var F=k(-1===(R=-1!==R&&R<M+1?a.indexOf(n,M+1):R)?I:Math.min(I,R));if(a.substr(M+1+F,y)===t){A.push(a.substring(d,M).replace(P,u)),a[d=M+1+F+y]!==u&&(M=a.indexOf(u,d)),I=a.indexOf(t,d),R=a.indexOf(n,d);break}if(F=k(R),a.substring(M+1+F,M+1+F+v)===n){if(A.push(a.substring(d,M).replace(P,u)),B(M+1+F+v),I=a.indexOf(t,d),M=a.indexOf(u,d),w&&(N(),f))return z();if(o&&E.length>=o)return z(!0);break}T.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:E.length,index:d}),M++}}else if(i&&0===A.length&&a.substring(d,d+x)===i){if(-1===R)return z();d=R+v,R=a.indexOf(n,d),I=a.indexOf(t,d)}else if(-1!==I&&(I<R||-1===R))A.push(a.substring(d,I)),d=I+y,I=a.indexOf(t,d);else{if(-1===R)break;if(A.push(a.substring(d,R)),B(R+v),w&&(N(),f))return z();if(o&&E.length>=o)return z(!0)}return O();function L(e){E.push(e),S=d}function k(e){var t=0;return-1!==e&&(e=a.substring(M+1,e))&&""===e.trim()?e.length:t}function O(e){return g||(void 0===e&&(e=a.substring(d)),A.push(e),d=_,L(A),w&&N()),z()}function B(e){d=e,L(A),A=[],R=a.indexOf(n,d)}function z(i){if(e.header&&!m&&E.length&&!c){var r=E[0],o=Object.create(null),s=new Set(r);let t=!1;for(let n=0;n<r.length;n++){let i=r[n];if(o[i=b(e.transformHeader)?e.transformHeader(i,n):i]){let e,a=o[i];for(;e=i+"_"+a,a++,s.has(e););s.add(e),r[n]=e,o[i]++,t=!0,(l=null===l?{}:l)[e]=i}else o[i]=1,r[n]=i;s.add(i)}t&&console.warn("Duplicate headers found and renamed."),c=!0}return{data:E,errors:T,meta:{delimiter:t,linebreak:n,aborted:f,truncated:!!i,cursor:S+(m||0),renamedHeaders:l}}}function N(){r(z()),E=[],T=[]}},this.abort=function(){f=!0},this.getCharIndex=function(){return d}}function g(e){var t=e.data,n=o[t.workerId],i=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var r={abort:function(){i=!0,_(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:y,resume:y};if(b(n.userStep)){for(var s=0;s<t.results.data.length&&(n.userStep({data:t.results.data[s],errors:t.results.errors,meta:t.results.meta},r),!i);s++);delete t.results}else b(n.userChunk)&&(n.userChunk(t.results,r,t.file),delete t.results)}t.finished&&!i&&_(t.workerId,t.results)}function _(e,t){var n=o[e];b(n.userComplete)&&n.userComplete(t),n.terminate(),delete o[e]}function y(){throw new Error("Not implemented.")}function v(e){if("object"!=typeof e||null===e)return e;var t,n=Array.isArray(e)?[]:{};for(t in e)n[t]=v(e[t]);return n}function x(e,t){return function(){e.apply(t,arguments)}}function b(e){return"function"==typeof e}return a.parse=function(t,i){var r=(i=i||{}).dynamicTyping||!1;if(b(r)&&(i.dynamicTypingFunction=r,r={}),i.dynamicTyping=r,i.transform=!!b(i.transform)&&i.transform,!i.worker||!a.WORKERS_SUPPORTED)return r=null,a.NODE_STREAM_INPUT,"string"==typeof t?(t=(e=>65279!==e.charCodeAt(0)?e:e.slice(1))(t),r=new(i.download?c:h)(i)):!0===t.readable&&b(t.read)&&b(t.on)?r=new d(i):(n.File&&t instanceof File||t instanceof Object)&&(r=new u(i)),r.stream(t);(r=(()=>{var t;return!!a.WORKERS_SUPPORTED&&(t=(()=>{var t=n.URL||n.webkitURL||null,i=e.toString();return a.BLOB_URL||(a.BLOB_URL=t.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",i,")();"],{type:"text/javascript"})))})(),(t=new n.Worker(t)).onmessage=g,t.id=s++,o[t.id]=t)})()).userStep=i.step,r.userChunk=i.chunk,r.userComplete=i.complete,r.userError=i.error,i.step=b(i.step),i.chunk=b(i.chunk),i.complete=b(i.complete),i.error=b(i.error),delete i.worker,r.postMessage({input:t,config:i,workerId:r.id})},a.unparse=function(e,t){var n=!1,i=!0,r=",",o="\r\n",s='"',l=s+s,c=!1,u=null,h=!1,d=((()=>{if("object"==typeof t){if("string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter(function(e){return-1!==t.delimiter.indexOf(e)}).length||(r=t.delimiter),"boolean"!=typeof t.quotes&&"function"!=typeof t.quotes&&!Array.isArray(t.quotes)||(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(c=t.skipEmptyLines),"string"==typeof t.newline&&(o=t.newline),"string"==typeof t.quoteChar&&(s=t.quoteChar),"boolean"==typeof t.header&&(i=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");u=t.columns}void 0!==t.escapeChar&&(l=t.escapeChar+s),t.escapeFormulae instanceof RegExp?h=t.escapeFormulae:"boolean"==typeof t.escapeFormulae&&t.escapeFormulae&&(h=/^[=+\-@\t\r].*$/)}})(),new RegExp(p(s),"g"));if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return f(null,e,c);if("object"==typeof e[0])return f(u||Object.keys(e[0]),e,c)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||u),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),f(e.fields||[],e.data||[],c);throw new Error("Unable to serialize unrecognized input");function f(e,t,n){var s="",a=("string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t)),Array.isArray(e)&&0<e.length),l=!Array.isArray(t[0]);if(a&&i){for(var c=0;c<e.length;c++)0<c&&(s+=r),s+=m(e[c],c);0<t.length&&(s+=o)}for(var u=0;u<t.length;u++){var h=(a?e:t[u]).length,d=!1,f=a?0===Object.keys(t[u]).length:0===t[u].length;if(n&&!a&&(d="greedy"===n?""===t[u].join("").trim():1===t[u].length&&0===t[u][0].length),"greedy"===n&&a){for(var p=[],g=0;g<h;g++){var _=l?e[g]:g;p.push(t[u][_])}d=""===p.join("").trim()}if(!d){for(var y=0;y<h;y++){0<y&&!f&&(s+=r);var v=a&&l?e[y]:y;s+=m(t[u][v],y)}u<t.length-1&&(!n||0<h&&!f)&&(s+=o)}}return s}function m(e,t){var i,o;return null==e?"":e.constructor===Date?JSON.stringify(e).slice(1,25):(o=!1,h&&"string"==typeof e&&h.test(e)&&(e="'"+e,o=!0),i=e.toString().replace(d,l),(o=o||!0===n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||((e,t)=>{for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1})(i,a.BAD_DELIMITERS)||-1<i.indexOf(r)||" "===i.charAt(0)||" "===i.charAt(i.length-1))?s+i+s:i)}},a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!i&&!!n.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=m,a.ParserHandle=f,a.NetworkStreamer=c,a.FileStreamer=u,a.StringStreamer=h,a.ReadableStreamStreamer=d,n.jQuery&&((t=n.jQuery).fn.parse=function(e){var i=e.config||{},r=[];return this.each(function(e){if("INPUT"!==t(this).prop("tagName").toUpperCase()||"file"!==t(this).attr("type").toLowerCase()||!n.FileReader||!this.files||0===this.files.length)return!0;for(var o=0;o<this.files.length;o++)r.push({file:this.files[o],inputElem:this,instanceConfig:t.extend({},i)})}),o(),this;function o(){if(0===r.length)b(e.complete)&&e.complete();else{var n,i,o,l,c=r[0];if(b(e.before)){var u=e.before(c.file,c.inputElem);if("object"==typeof u){if("abort"===u.action)return n="AbortError",i=c.file,o=c.inputElem,l=u.reason,void(b(e.error)&&e.error({name:n},i,o,l));if("skip"===u.action)return void s();"object"==typeof u.config&&(c.instanceConfig=t.extend(c.instanceConfig,u.config))}else if("skip"===u)return void s()}var h=c.instanceConfig.complete;c.instanceConfig.complete=function(e){b(h)&&h(e,c.file,c.inputElem),s()},a.parse(c.file,c.instanceConfig)}}function s(){r.splice(0,1),o()}}),r&&(n.onmessage=function(e){e=e.data,void 0===a.WORKER_ID&&e&&(a.WORKER_ID=e.workerId),"string"==typeof e.input?n.postMessage({workerId:a.WORKER_ID,results:a.parse(e.input,e.config),finished:!0}):(n.File&&e.input instanceof File||e.input instanceof Object)&&(e=a.parse(e.input,e.config))&&n.postMessage({workerId:a.WORKER_ID,results:e,finished:!0})}),(c.prototype=Object.create(l.prototype)).constructor=c,(u.prototype=Object.create(l.prototype)).constructor=u,(h.prototype=Object.create(h.prototype)).constructor=h,(d.prototype=Object.create(l.prototype)).constructor=d,a},void 0===(r="function"===typeof n?n.apply(t,i):n)||(e.exports=r)},799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function r(e,t,i){var r=null;if(void 0!==i&&(r=""+i),void 0!==t.key&&(r=""+t.key),"key"in t)for(var o in i={},t)"key"!==o&&(i[o]=t[o]);else i=t;return t=i.ref,{$$typeof:n,type:e,key:r,ref:void 0!==t?t:null,props:i}}t.Fragment=i,t.jsx=r,t.jsxs=r},847:(e,t,n)=>{var i=n(893);e.exports=function(e,t){if(null==e)return{};var n,r,o=i(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.__esModule=!0,e.exports.default=e.exports},853:(e,t,n)=>{"use strict";e.exports=n(896)},879:function(e,t,n){var i=n(847).default;const r=["data"],o=["data"];e.exports=function(){"use strict";var e,t,n;function s(i,r){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),n=r(s),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=r;else e=r}return s(["exports"],function(e){var t=1e-6,n="undefined"!=typeof Float32Array?Float32Array:Array;function i(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*o-r*i;return s?(e[0]=o*(s=1/s),e[1]=-i*s,e[2]=-r*s,e[3]=n*s,e):null}function r(){var e=new n(9);return n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function o(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=r*c-i*u,e[2]=i*a-r*s,e[3]=a*l-o*u,e[4]=n*u-r*l,e[5]=r*o-n*a,e[6]=o*c-s*l,e[7]=i*l-n*c,e[8]=n*s-i*o,e}function s(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],f=n[1],p=n[2],m=n[3],g=n[4],_=n[5],y=n[6],v=n[7],x=n[8];return e[0]=d*i+f*s+p*c,e[1]=d*r+f*a+p*u,e[2]=d*o+f*l+p*h,e[3]=m*i+g*s+_*c,e[4]=m*r+g*a+_*u,e[5]=m*o+g*l+_*h,e[6]=y*i+v*s+x*c,e[7]=y*r+v*a+x*u,e[8]=y*o+v*l+x*h,e}function a(){var e=new n(16);return n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function c(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=n*a-i*s,v=n*l-r*s,x=n*c-o*s,b=i*l-r*a,w=i*c-o*a,E=r*c-o*l,T=u*m-h*p,A=u*g-d*p,S=u*_-f*p,D=h*g-d*m,C=h*_-f*m,I=d*_-f*g,R=y*I-v*C+x*D+b*S-w*A+E*T;return R?(e[0]=(a*I-l*C+c*D)*(R=1/R),e[1]=(r*C-i*I-o*D)*R,e[2]=(m*E-g*w+_*b)*R,e[3]=(d*w-h*E-f*b)*R,e[4]=(l*S-s*I-c*A)*R,e[5]=(n*I-r*S+o*A)*R,e[6]=(g*x-p*E-_*v)*R,e[7]=(u*E-d*x+f*v)*R,e[8]=(s*C-a*S+c*T)*R,e[9]=(i*S-n*C-o*T)*R,e[10]=(p*w-m*x+_*y)*R,e[11]=(h*x-u*w-f*y)*R,e[12]=(a*A-s*D-l*T)*R,e[13]=(n*D-i*A+r*T)*R,e[14]=(m*v-p*b-g*y)*R,e[15]=(u*b-h*v+d*y)*R,e):null}function u(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15],v=n[0],x=n[1],b=n[2],w=n[3];return e[0]=v*i+x*a+b*h+w*m,e[1]=v*r+x*l+b*d+w*g,e[2]=v*o+x*c+b*f+w*_,e[3]=v*s+x*u+b*p+w*y,e[4]=(v=n[4])*i+(x=n[5])*a+(b=n[6])*h+(w=n[7])*m,e[5]=v*r+x*l+b*d+w*g,e[6]=v*o+x*c+b*f+w*_,e[7]=v*s+x*u+b*p+w*y,e[8]=(v=n[8])*i+(x=n[9])*a+(b=n[10])*h+(w=n[11])*m,e[9]=v*r+x*l+b*d+w*g,e[10]=v*o+x*c+b*f+w*_,e[11]=v*s+x*u+b*p+w*y,e[12]=(v=n[12])*i+(x=n[13])*a+(b=n[14])*h+(w=n[15])*m,e[13]=v*r+x*l+b*d+w*g,e[14]=v*o+x*c+b*f+w*_,e[15]=v*s+x*u+b*p+w*y,e}function h(e,t,n){var i,r,o,s,a,l,c,u,h,d,f,p,m=n[0],g=n[1],_=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],e[0]=i=t[0],e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=f,e[11]=p,e[12]=i*m+a*g+h*_+t[12],e[13]=r*m+l*g+d*_+t[13],e[14]=o*m+c*g+f*_+t[14],e[15]=s*m+u*g+p*_+t[15]),e}function d(e,t,n){var i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-s*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e}function p(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=s*r-u*i,e[2]=a*r-h*i,e[3]=l*r-d*i,e[8]=o*i+c*r,e[9]=s*i+u*r,e[10]=a*i+h*r,e[11]=l*i+d*r,e}function m(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-s*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e}function g(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _(e,n,i){var r,o,s,a=i[0],l=i[1],c=i[2],u=Math.hypot(a,l,c);return u<t?null:(a*=u=1/u,l*=u,c*=u,r=Math.sin(n),o=Math.cos(n),e[0]=a*a*(s=1-o)+o,e[1]=l*a*s+c*r,e[2]=c*a*s-l*r,e[3]=0,e[4]=a*l*s-c*r,e[5]=l*l*s+o,e[6]=c*l*s+a*r,e[7]=0,e[8]=a*c*s+l*r,e[9]=l*c*s-a*r,e[10]=c*c*s+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function y(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,f=r*a,p=r*l,m=o*s,g=o*a,_=o*l;return e[0]=1-h-p,e[1]=u+_,e[2]=d-g,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=f+m,e[7]=0,e[8]=d+g,e[9]=f-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var v=u;function x(){var e=new n(3);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function b(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function w(e){return Math.hypot(e[0],e[1],e[2])}function E(e,t,i){var r=new n(3);return r[0]=e,r[1]=t,r[2]=i,r}function T(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function A(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function S(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function D(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function C(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function I(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function R(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function P(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function M(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function F(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function L(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function k(e,t){var n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function O(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function B(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s,e}function z(e,t,n,i){var r=t[0],o=t[1],s=t[2];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e}function N(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/(s=s||1),e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e}function U(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8],e}function V(e,t,n){var i=n[0],r=n[1],o=n[2],s=t[0],a=t[1],l=t[2],c=r*l-o*a,u=o*s-i*l,h=i*a-r*s,d=r*h-o*u,f=o*c-i*h,p=i*u-r*c,m=2*n[3];return u*=m,h*=m,f*=2,p*=2,e[0]=s+(c*=m)+(d*=2),e[1]=a+u+f,e[2]=l+h+p,e}function j(e){return e[0]=0,e[1]=0,e[2]=0,e}function G(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var H=S,W=D,q=w;function X(){var e=new n(4);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Z(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Y(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=i*s,e[2]=r*s,e[3]=o*s,e}function K(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e}function J(){var e=new n(4);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Q(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function $(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+s*a,e[1]=r*l+o*a,e[2]=o*l-r*a,e[3]=s*l-i*a,e}function ee(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l-o*a,e[1]=r*l+s*a,e[2]=o*l+i*a,e[3]=s*l-r*a,e}x(),X();var te,ne,ie,re=Y,oe=(te=x(),ne=E(1,0,0),ie=E(0,1,0),function(e,t,n){var i=O(t,n);return i<-.999999?(B(te,ne,t),q(te)<1e-6&&B(te,ie,t),k(te,te),function(e,t,n){n*=.5;var i=Math.sin(n);e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n)}(e,te,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(B(te,t,n),e[0]=te[0],e[1]=te[1],e[2]=te[2],e[3]=1+i,re(e,e))});function se(){var e=new n(2);return n!=Float32Array&&(e[0]=0,e[1]=0),e}function ae(e,t){var i=new n(2);return i[0]=e,i[1]=t,i}function le(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function ce(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function ue(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function he(e){return Math.hypot(e[0],e[1])}function de(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e}function fe(e,t){return e[0]*t[0]+e[1]*t[1]}J(),J(),r();var pe,me,ge=ce;function _e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}se();var ye=function(){if(me)return pe;function e(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}return me=1,pe=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var r=this.sampleCurveX(n)-e;if(Math.abs(r)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=r/o}var s=0,a=1;for(n=e,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-e)<t));i++)e>r?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},pe}(),ve=_e(ye);function xe(e,t){this.x=e,this.y=t}function be(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!be(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!be(e[n],t[n]))return!1;return!0}return e===t}xe.prototype={clone(){return new xe(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround(e,t){const n=Math.cos(e),i=Math.sin(e),r=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=r,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:xe},xe.convert=function(e){if(e instanceof xe)return e;if(Array.isArray(e))return new xe(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new xe(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};const we=Math.PI/180,Ee=180/Math.PI;function Te(e){return e*we}function Ae(e){return e*Ee}const Se=[[0,0],[1,0],[1,1],[0,1]];function De(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Ce(e,t,n,i){const r=new ve(e,t,n,i);return function(e){return r.solve(e)}}const Ie=Ce(.25,.1,.25,1);function Re(e,t,n){return Math.min(n,Math.max(t,e))}function Pe(e,t,n){return(n=Re((n-e)/(t-e),0,1))*n*(3-2*n)}function Me(e,t,n){const i=n-t,r=((e-t)%i+i)%i+t;return r===t?n:r}function Fe(e,t,n){if(!e.length)return n(null,[]);let i=e.length;const r=new Array(e.length);let o=null;e.forEach((e,s)=>{t(e,(e,t)=>{e&&(o=e),r[s]=t,0==--i&&n(o,r)})})}function Le(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)for(const t in r)e[t]=r[t];return e}let ke=1;function Oe(){return ke++}function Be(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function ze(e,t){e.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function Ne(e,t,n){const i={};for(const r in e)i[r]=t.call(this,e[r],r,e);return i}function Ue(e,t,n){const i={};for(const r in e)t.call(this,e[r],r,e)&&(i[r]=e[r]);return i}function Ve(e){return Array.isArray(e)?e.map(Ve):"object"==typeof e&&e?Ne(e,Ve):e}function je(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}const Ge={};function He(e){Ge[e]||("undefined"!=typeof console&&console.warn(e),Ge[e]=!0)}function We(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function qe(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}function Xe(e){let[t,n,i]=e;const r=Te(n+90),o=Te(i);return{x:t*Math.cos(r)*Math.sin(o),y:t*Math.sin(r)*Math.sin(o),z:t*Math.cos(o),azimuthal:n,polar:i}}function Ze(e){return("undefined"!=typeof self||void 0!==e)&&"undefined"!=typeof WorkerGlobalScope&&(void 0!==e?e:self)instanceof WorkerGlobalScope}function Ye(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,n,i,r)=>{const o=i||r;return t[n]=!o||o.toLowerCase(),""}),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let Ke=null;function Je(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Qe(e,t,n,i){for(;t<n;){const r=t+n>>1;e[r]<i?t=r+1:n=r}return t}function $e(e,t,n,i){for(;t<n;){const r=t+n>>1;e[r]<=i?t=r+1:n=r}return t}function et(e){return e>0?1/(1.001-e):1+e}function tt(e){return e>0?1-1/(1.001-e):-e}function nt(e,t,n){return(e-t.min)*(n.max-n.min)/(t.max-t.min)+n.min}const it={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!it.API_URL)return null;try{const e=new URL(it.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function rt(e){return it.API_URL_REGEX.test(e)}function ot(e){return it.API_SPRITE_REGEX.test(e)}let st,at,lt,ct,ut,ht;function dt(){return null==st&&(st=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),st}const ft={now:()=>void 0!==ct?ct:performance.now(),setNow(e){ct=e},restoreNow(){ct=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:n,height:i}=e;ut||(ut=document.createElement("canvas"));const r=ut.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return(n>ut.width||i>ut.height)&&(ut.width=n,ut.height=i),r.clearRect(-t,-t,n+2*t,i+2*t),r.drawImage(e,0,0,n,i),r.getImageData(-t,-t,n+2*t,i+2*t)},resolveURL:e=>(at||(at=document.createElement("a")),at.href=e,at.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==lt&&(lt=window.matchMedia("(prefers-reduced-motion: reduce)")),lt.matches)},hasCanvasFingerprintNoise(){if(void 0!==ht)return ht;if(!dt())return ht=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let n=0;for(let r=0;r<e.width;++r)t.fillStyle="rgba(".concat(n++,",").concat(n++,",").concat(n++,", 255)"),t.fillRect(r,0,1,1);const i=t.getImageData(0,0,e.width,e.height);n=0;for(let r=0;r<i.data.length;++r)if(r%4!=3&&n++!==i.data[r])return ht=!0,!0;return ht=!1,!1}};function pt(e,t){const n=e.indexOf("?");if(n<0)return"".concat(e,"?").concat(new URLSearchParams(t).toString());const i=new URLSearchParams(e.slice(n));for(const r in t)i.set(r,t[r]);return"".concat(e.slice(0,n),"?").concat(i.toString())}function mt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{persistentParams:[]};const n=e.indexOf("?");if(n<0)return e;const i=new URLSearchParams,r=new URLSearchParams(e.slice(n));for(const s of t.persistentParams){const e=r.get(s);e&&i.set(s,e)}const o=i.toString();return"".concat(e.slice(0,n)).concat(o.length>0?"?".concat(o):"")}const gt="mapbox-tiles";let _t=500,yt=50;const vt=["language","worldview","jobid"];let xt,bt;function wt(){try{return caches}catch(e){}}function Et(){const e=wt();e&&null==xt&&(xt=e.open(gt))}let Tt=1/0;const At={supported:!1,testSupport:function(e){!Ct&&Dt&&(It?Pt(e):St=e)}};let St,Dt,Ct=!1,It=!1;const Rt="undefined"!=typeof self?self:{};function Pt(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Dt),e.isContextLost())return;At.supported=!0}catch(e){}e.deleteTexture(t),Ct=!0}Rt.document&&(Dt=Rt.document.createElement("img"),Dt.onload=function(){St&&Pt(St),St=null,It=!0},Dt.onerror=function(){Ct=!0,St=null},Dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Mt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Mt);class Ft extends Error{constructor(e,t,n){401===t&&rt(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}const Lt=Ze()?()=>self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,kt=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Lt())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const n=new AbortController,i=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Lt(),referrerPolicy:e.referrerPolicy,signal:n.signal});let r=!1,o=!1;const s=(a=i.url).indexOf("sku=")>0&&rt(a);var a;"json"===e.type&&i.headers.set("Accept","application/json");const l=(n,r,a)=>{if(o)return;if(n&&"SecurityError"!==n.message&&He(n.toString()),r&&a)return c(r);const l=Date.now();fetch(i).then(n=>{if(n.ok){const e=s?n.clone():null;return c(n,e,l)}return t(new Ft(n.statusText,n.status,e.url))}).catch(n=>{"AbortError"!==n.name&&t(new Error("".concat(n.message," ").concat(e.url)))})},c=(n,s,a)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then(e=>{o||(s&&a&&function(e,t,n){if(Et(),null==xt)return;const i=Ye(t.headers.get("Cache-Control")||"");if(i["no-store"])return;const r={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach((e,t)=>r.headers.set(t,e)),i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString());const o=r.headers.get("Expires");if(!o)return;if(new Date(o).getTime()-n<42e4)return;let s=mt(e.url,{persistentParams:vt});if(206===t.status){const t=e.headers.get("Range");if(!t)return;r.status=200,s=pt(s,{range:t})}!function(e,t){if(void 0===bt)try{new Response(new ReadableStream),bt=!0}catch(e){bt=!1}bt?t(e.body):e.blob().then(t).catch(e=>He(e.message))}(t,e=>{const n=new Response(200!==(i=t.status)&&404!==i&&[101,103,204,205,304].includes(i)?null:e,r);var i;Et(),null!=xt&&xt.then(e=>e.put(s,n)).catch(e=>He(e.message))})}(i,s,a),r=!0,t(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))}).catch(e=>{o||t(new Error(e.message))})};return s?function(e,t){if(Et(),null==xt)return t(null);xt.then(n=>{let i=mt(e.url,{persistentParams:vt});const r=e.headers.get("Range");r&&(i=pt(i,{range:r})),n.match(i).then(e=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),n=Ye(e.headers.get("Cache-Control")||"");return Number(t)>Date.now()&&!n["no-cache"]}(e);n.delete(i).catch(t),r&&n.put(i,e.clone()).catch(t),t(null,e,r)}).catch(t)}).catch(t)}(i,l):l(null,null),{cancel:()=>{o=!0,r||n.abort()}}}(e,t);if(Ze(self)&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(e,t){const n=new XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const i in e.headers)n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{t(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new Ft(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,t)},Ot=function(e,t){return kt(Le(e,{type:"arrayBuffer"}),t)};function Bt(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Nt,Ut;Nt=[],Ut=0;const Vt=function(e,t){if(At.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ut>=it.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Nt.push(n),n}Ut++;let n=!1;const i=()=>{if(!n)for(n=!0,Ut--;Nt.length&&Ut<it.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Nt.shift(),{requestParameters:t,callback:n,cancelled:i}=e;i||(e.cancel=Vt(t,n).cancel)}},r=Ot(e,(e,n,r,o)=>{i(),e?t(e):n&&(self.createImageBitmap?function(e,t){const n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then(e=>{t(null,e)}).catch(e=>{t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}(n,(e,n)=>t(e,n,r,o)):function(e,t){const n=new Image;n.onload=()=>{t(null,n),URL.revokeObjectURL(n.src),n.onload=null,requestAnimationFrame(()=>{n.src=zt})},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?URL.createObjectURL(i):zt}(n,(e,n)=>t(e,n,r,o)))});return{cancel:()=>{r.cancel(),i()}}};var jt,Gt,Ht,Wt={exports:{}},qt={exports:{}},Xt={exports:{}},Zt=function(){if(Ht)return Wt.exports;Ht=1;var e=(jt||(jt=1,qt.exports=function(e,t){var n,i,r,o,s,a,l,c;for(i=e.length-(n=3&e.length),r=t,s=3432918353,a=461845907,c=0;c<i;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}),qt.exports),t=(Gt||(Gt=1,Xt.exports=function(e,t){for(var n,i=e.length,r=t^i,o=0;i>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}),Xt.exports);return Wt.exports=e,Wt.exports.murmur3=e,Wt.exports.murmur2=t,Wt.exports}(),Yt=_e(Zt);class Kt{constructor(e){Le(this,(arguments.length<=1?void 0:arguments[1])||{}),this.type=e}}class Jt extends Kt{constructor(e){super("error",Le({error:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}function Qt(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function $t(e,t,n){if(n&&n[e]){const i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}class en{on(e,t){return this._listeners=this._listeners||{},Qt(e,t,this._listeners),this}off(e,t){return $t(e,t,this._listeners),$t(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Qt(e,t,this._oneTimeListeners),this):new Promise(t=>{this.once(e,t)})}fire(e,t){const n="string"==typeof e?new Kt(e,t):e,i=n.type;if(this.listens(i)){n.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,n);const t=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const o of t)$t(i,o,this._oneTimeListeners),o.call(this,n);const r=this._eventedParent;r&&(Le(n,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(n))}else n instanceof Jt&&console.error(n.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}class tn{constructor(e){"string"==typeof e?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new tn(e)}static toString(e){return e.iconsetId?"".concat(e.name,"\x1f").concat(e.iconsetId):e.name}static parse(e){const[t,n]=e.split("\x1f");return new tn({name:t,iconsetId:n})}static isEqual(e,t){return e.name===t.name&&e.iconsetId===t.iconsetId}toString(){return tn.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var nn,rn={},on=function(){if(nn)return rn;nn=1;var e={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return t("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function i(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function r(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{rn.parseCSSColor=function(o){var s,a=o.replace(/ /g,"").toLowerCase();if(a in e)return e[a].slice();if("#"===a[0])return 4===a.length?(s=parseInt(a.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:7===a.length&&(s=parseInt(a.substr(1),16))>=0&&s<=16777215?[(16711680&s)>>16,(65280&s)>>8,255&s,1]:null;var l=a.indexOf("("),c=a.indexOf(")");if(-1!==l&&c+1===a.length){var u=a.substr(0,l),h=a.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=i(h.pop());case"rgb":return 3!==h.length?null:[n(h[0]),n(h[1]),n(h[2]),d];case"hsla":if(4!==h.length)return null;d=i(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,p=i(h[1]),m=i(h[2]),g=m<=.5?m*(p+1):m+p-m*p,_=2*m-g;return[t(255*r(_,g,f+1/3)),t(255*r(_,g,f)),t(255*r(_,g,f-1/3)),d];default:return null}}return null}}catch(e){}return rn}();class sn{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=n,this.a=i}static parse(e){if(!e)return;if(e instanceof sn)return e;if("string"!=typeof e)return;const t=on.parseCSSColor(e);return t?new sn(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}toString(){const[e,t,n,i]=[this.r,this.g,this.b,this.a];return"rgba(".concat(Math.round(255*e),",").concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(i,")")}toNonPremultipliedRenderColor(e){const{r:t,g:n,b:i,a:r}=this;return new ln(e,t,n,i,r)}toPremultipliedRenderColor(e){const{r:t,g:n,b:i,a:r}=this;return new cn(e,t*r,n*r,i*r,r)}clone(){return new sn(this.r,this.g,this.b,this.a)}}class an{constructor(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(this.premultiplied=!1,this.premultiplied=o,e){const o=e.image.height,s=o*o;this.premultiplied?(t=0===r?0:t/r*(o-1),n=0===r?0:n/r*(o-1),i=0===r?0:i/r*(o-1)):(t*=o-1,n*=o-1,i*=o-1);const a=Math.floor(t),l=Math.floor(n),c=Math.floor(i),u=Math.ceil(t),h=Math.ceil(n),d=Math.ceil(i),f=t-a,p=n-l,m=i-c,g=e.image.data,_=4*(a+l*s+c*o),y=4*(a+l*s+d*o),v=4*(a+h*s+c*o),x=4*(a+h*s+d*o),b=4*(u+l*s+c*o),w=4*(u+l*s+d*o),E=4*(u+h*s+c*o),T=4*(u+h*s+d*o);if(_<0||T>=g.length)throw new Error("out of range");this.r=un(un(un(g[_],g[y],m),un(g[v],g[x],m),p),un(un(g[b],g[w],m),un(g[E],g[T],m),p),f)/255*(this.premultiplied?r:1),this.g=un(un(un(g[_+1],g[y+1],m),un(g[v+1],g[x+1],m),p),un(un(g[b+1],g[w+1],m),un(g[E+1],g[T+1],m),p),f)/255*(this.premultiplied?r:1),this.b=un(un(un(g[_+2],g[y+2],m),un(g[v+2],g[x+2],m),p),un(un(g[b+2],g[w+2],m),un(g[E+2],g[T+2],m),p),f)/255*(this.premultiplied?r:1),this.a=r}else this.r=t,this.g=n,this.b=i,this.a=r}toArray(){const{r:e,g:t,b:n,a:i}=this;return[255*e,255*t,255*n,i]}toHslaArray(){let{r:e,g:t,b:n,a:i}=this;if(this.premultiplied){if(0===i)return[0,0,0,0];e/=i,t/=i,n/=i}const r=Math.min(Math.max(e,0),1),o=Math.min(Math.max(t,0),1),s=Math.min(Math.max(n,0),1),a=Math.min(r,o,s),l=Math.max(r,o,s),c=(a+l)/2;if(a===l)return[0,0,100*c,i];const u=l-a,h=c>.5?u/(2-l-a):u/(l+a);let d=0;return l===r?d=(o-s)/u+(o<s?6:0):l===o?d=(s-r)/u+2:l===s&&(d=(r-o)/u+4),d*=60,[Math.min(Math.max(d,0),360),Math.min(Math.max(100*h,0),100),Math.min(Math.max(100*c,0),100),i]}toArray01(){const{r:e,g:t,b:n,a:i}=this;return[e,t,n,i]}toArray01Scaled(e){const{r:t,g:n,b:i}=this;return[t*e,n*e,i*e]}toArray01Linear(){const{r:e,g:t,b:n,a:i}=this;return[Math.pow(e,2.2),Math.pow(t,2.2),Math.pow(n,2.2),i]}}class ln extends an{constructor(e,t,n,i,r){super(e,t,n,i,r,!1)}}class cn extends an{constructor(e,t,n,i,r){super(e,t,n,i,r,!0)}}function un(e,t,n){return e*(1-n)+t*n}function hn(e,t,n){return e.map((e,i)=>un(e,t[i],n))}sn.black=new sn(0,0,0,1),sn.white=new sn(1,1,1,1),sn.transparent=new sn(0,0,0,0),sn.red=new sn(1,0,0,1),sn.blue=new sn(0,0,1,1);var dn=Object.freeze({__proto__:null,array:hn,color:function(e,t,n){return new sn(un(e.r,t.r,n),un(e.g,t.g,n),un(e.b,t.b,n),un(e.a,t.a,n))},number:un});function fn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)for(const t in r)e[t]=r[t];return e}class pn extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class mn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new mn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const gn={kind:"null"},_n={kind:"number"},yn={kind:"string"},vn={kind:"boolean"},xn={kind:"color"},bn={kind:"object"},wn={kind:"value"},En={kind:"collator"},Tn={kind:"formatted"},An={kind:"resolvedImage"};function Sn(e,t){return{kind:"array",itemType:e,N:t}}function Dn(e){if("array"===e.kind){const t=Dn(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}const Cn=[gn,_n,yn,vn,xn,Tn,bn,Sn(wn),An];function In(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!In(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Cn)if(!In(e,t))return null}return"Expected ".concat(Dn(e)," but found ").concat(Dn(t)," instead.")}function Rn(e,t){return t.some(t=>t.kind===e.kind)}function Pn(e,t){return t.some(t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e)}function Mn(e,t){return"array"===e.kind&&"array"===t.kind?e.N===t.N&&Mn(e.itemType,t.itemType):e.kind===t.kind}class Fn{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ln{constructor(e,t,n,i,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=r}}class kn{constructor(e){this.sections=e}static fromString(e){return new kn([new Ln(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof kn?e:kn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){const n=t.image.getPrimary().id.toString();e.push(["image",n]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(n)}return e}}class On{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.id=tn.from(e),this.options=Object.assign({},t),t.transform){const{a:e,b:n,c:i,d:r,e:o,f:s}=t.transform;this.options.transform=new DOMMatrix([e,n,i,r,o,s])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:t,c:n,d:i,e:r,f:o}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:t,c:n,d:i,e:r,f:o}})}static parse(e){let t,n,i,r;try{({name:t,iconsetId:n,params:i,transform:r}=JSON.parse(e)||{})}catch(e){return null}if(!t)return null;const{a:o,b:s,c:a,d:l,e:c,f:u}=r||{};return new On({name:t,iconsetId:n},{params:i,transform:new DOMMatrix([o,s,a,l,c,u])})}scaleSelf(e,t){return this.options.transform.scaleSelf(e,t),this}}class Bn{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.primaryId=tn.from(e),this.primaryOptions=t,n&&(this.secondaryId=tn.from(n)),this.secondaryOptions=i,this.available=r}toString(){return this.primaryId&&this.secondaryId?"[".concat(this.primaryId.name,",").concat(this.secondaryId.name,"]"):this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new On(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new On(this.secondaryId,this.secondaryOptions):null}static from(e){return"string"==typeof e?Bn.build({name:e}):e}static build(e,t,n,i){return!e||"object"==typeof e&&!("name"in e)?null:new Bn(e,n,t,i)}}function zn(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function Nn(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof sn)return!0;if(e instanceof Fn)return!0;if(e instanceof kn)return!0;if(e instanceof Bn)return!0;if(Array.isArray(e)){for(const t of e)if(!Nn(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Nn(e[t]))return!1;return!0}return!1}function Un(e){if(null===e)return gn;if("string"==typeof e)return yn;if("boolean"==typeof e)return vn;if("number"==typeof e)return _n;if(e instanceof sn)return xn;if(e instanceof Fn)return En;if(e instanceof kn)return Tn;if(e instanceof Bn)return An;if(Array.isArray(e)){const t=e.length;let n;for(const i of e){const e=Un(i);if(n){if(n===e)continue;n=wn;break}n=e}return Sn(n||wn,t)}return bn}function Vn(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof kn||e instanceof Bn||e instanceof sn?e.toString():JSON.stringify(e)}class jn{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(!Nn(e[1]))return t.error("invalid value");const n=e[1];let i=Un(n);const r=t.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new jn(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof sn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof kn?this.value.serialize():this.value}}class Gn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Hn={string:yn,number:_n,boolean:vn,object:bn};class Wn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in Hn)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=Hn[n],i++}else r=wn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],i++}n=Sn(r,o)}else n=Hn[r];const o=[];for(;i<e.length;i++){const n=t.parse(e[i],i,wn);if(!n)return null;o.push(n)}return new Wn(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!In(this.type,Un(n)))return n;if(t===this.args.length-1)throw new Gn("The expression ".concat(JSON.stringify(this.args[t].serialize())," evaluated to ").concat(Dn(Un(n))," but was expected to be of type ").concat(Dn(this.type),"."))}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);const i=e.N;("number"==typeof i||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map(e=>e.serialize()))}}class qn{constructor(e){this.type=Tn,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const i=[];let r=!1;for(let o=1;o<=e.length-1;++o){const n=e[o];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let e=null;if(n["font-scale"]&&(e=t.parseObjectValue(n["font-scale"],o,"font-scale",_n),!e))return null;let s=null;if(n["text-font"]&&(s=t.parseObjectValue(n["text-font"],o,"text-font",Sn(yn)),!s))return null;let a=null;if(n["text-color"]&&(a=t.parseObjectValue(n["text-color"],o,"text-color",xn),!a))return null;const l=i[i.length-1];l.scale=e,l.font=s,l.textColor=a}else{const n=t.parse(e[o],o,wn);if(!n)return null;const s=n.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null})}}return new qn(i)}evaluate(e){return new kn(this.sections.map(t=>{const n=t.content.evaluate(e);return Mn(Un(n),An)?new Ln("",n,null,null,null):new Ln(Vn(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class Xn{constructor(e,t,n,i){this._imageWarnHistory={},this.type=An,this.namePrimary=e,this.nameSecondary=t,n&&(this.paramsPrimary=n.params,this.iconsetIdPrimary=n.iconset?n.iconset.id:void 0),i&&(this.paramsSecondary=i.params,this.iconsetIdSecondary=i.iconset?i.iconset.id:void 0)}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");let n=1;const i=[];function r(){if(n<e.length){const r=t.parse(e[n],n++,yn);return r?(i.push({image:r,options:{}}),!0):(t.error(i.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function o(){if(n<e.length){const o=e[n];if(null===(r=o)||"object"!=typeof r||Array.isArray(r))return!0;const s=o.params,a=o.iconset,l=t.concat(n);if(!s&&!a)return n++,!0;if(s){if("object"!=typeof s||s.constructor!==Object)return l.error('Image options "params" should be an object'),!1;const e={},t=l.concat(void 0,"params");for(const n in s){if(!n)return t.error("Image parameter name should be non-empty"),!1;const i=t.concat(void 0,n).parse(s[n],void 0,xn,void 0,{typeAnnotation:"coerce"});if(!i)return!1;e[n]=i}i[i.length-1].options.params=e}if(a){if("object"!=typeof a||a.constructor!==Object)return l.error('Image options "iconset" should be an object'),!1;if(!a.id)return l.error('Image options "iconset" should have an "id" property'),!1;i[i.length-1].options.iconset=a}return n++,!0}var r;return!0}for(let s=0;s<2;s++)if(!r()||!o())return;return new Xn(i[0].image,i[1]?i[1].image:void 0,i[0].options,i[1]?i[1].options:void 0)}evaluateParams(e,t){const n={};if(t){for(const i in t)if(t[i])try{n[i]=t[i].evaluate(e)}catch(e){continue}if(0!==Object.keys(n).length)return{params:n}}}evaluate(e){const t={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},n=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,i=Bn.build(t,n,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(i&&e.availableImages){const t=i.getPrimary().id;if(i.available=e.availableImages.some(e=>tn.isEqual(e,t)),i.available){const t=i.getSecondary()?i.getSecondary().id:null;t&&(i.available=e.availableImages.some(e=>tn.isEqual(e,t)))}}return i}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const t in this.paramsPrimary)this.paramsPrimary[t]&&e(this.paramsPrimary[t]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const t in this.paramsSecondary)this.paramsSecondary[t]&&e(this.paramsSecondary[t])}outputDefined(){return!1}serializeOptions(e,t){const n={};if(t&&(n.iconset={id:t}),e){n.params={};for(const t in e)e[t]&&(n.params[t]=e[t].serialize())}return Object.keys(n).length>0?n:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const t=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);t&&e.push(t)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const t=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);t&&e.push(t)}return e}}function Zn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Yn={"to-boolean":vn,"to-color":xn,"to-number":_n,"to-string":yn};class Kn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0],i=[];let r=gn;if("to-array"===n){if(!Array.isArray(e[1]))return null;const n=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error("Expected ".concat(t.expectedType.kind," but found array."));r=Sn(t.expectedType.itemType,n)}else{if(!(n>0&&Nn(e[1][0])))return null;r=Sn(Un(e[1][0]),n)}for(let o=0;o<n;o++){const n=e[1][o];let s;if("array"===Zn(n))s=t.parse(n,void 0,r.itemType);else{const e=Zn(n);if(e!==r.itemType.kind)return t.error("Expected ".concat(r.itemType.kind," but found ").concat(e,"."));s=t.registry.literal.parse(["literal",void 0===n?null:n],t)}if(!s)return null;i.push(s)}}else{if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");r=Yn[n];for(let n=1;n<e.length;n++){const r=t.parse(e[n],n,wn);if(!r)return null;i.push(r)}}return new Kn(r,i)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof sn)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):zn(t[0],t[1],t[2],t[3]),!n))return new sn(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Gn(n||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new Gn("Could not convert ".concat(JSON.stringify(t)," to number."))}return"formatted"===this.type.kind?kn.fromString(Vn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Bn.build(Vn(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(t=>t.evaluate(e)):Vn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new qn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Xn(this.args[0]).serialize();const e="array"===this.type.kind?[]:["to-".concat(this.type.kind)];return this.eachChild(t=>{e.push(t.serialize())}),e}}const Jn=["Unknown","Point","LineString","Polygon"];class Qn{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Jn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=sn.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}}class $n{constructor(e,t,n,i,r){this.name=e,this.type=t,this._evaluate=n,this.args=i,this._overloadIndex=r}evaluate(e){if(!this._evaluate){const e=$n.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const n=e[0],i=$n.definitions[n];if(!i)return t.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);const r=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=[];let a=null,l=-1;for(const[c,u]of o){if(Array.isArray(c)&&c.length!==e.length-1)continue;s.push(c),l++,a=new xr(t.registry,t.path,null,t.scope,void 0,t._scope,t.options);const i=[];let o=!1;for(let t=1;t<e.length;t++){const n=e[t],r=Array.isArray(c)?c[t-1]:c.type,s=a.parse(n,1+i.length,r);if(!s){o=!0;break}i.push(s)}if(!o)if(Array.isArray(c)&&c.length!==i.length)a.error("Expected ".concat(c.length," arguments, but found ").concat(i.length," instead."));else{for(let e=0;e<i.length;e++){const t=Array.isArray(c)?c[e]:c.type,n=i[e];a.concat(e+1).checkSubtype(t,n.type)}if(0===a.errors.length)return new $n(n,r,u,i,l)}}if(1===s.length)t.errors.push(...a.errors);else{const n=(s.length?s:o.map(e=>{let[t]=e;return t})).map(ei).join(" | "),i=[];for(let r=1;r<e.length;r++){const n=t.parse(e[r],1+i.length);if(!n)return null;i.push(Dn(n.type))}t.error("Expected arguments of type ".concat(n,", but found (").concat(i.join(", "),") instead."))}return null}static register(e,t){$n.definitions=t;for(const n in t)e[n]=$n}}function ei(e){return Array.isArray(e)?"(".concat(e.map(Dn).join(", "),")"):"(".concat(Dn(e.type),"...)")}class ti{constructor(e,t,n){this.type=En,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=void 0===n["case-sensitive"]?t.parse(!1,1,vn):t.parseObjectValue(n["case-sensitive"],1,"case-sensitive",vn);if(!i)return null;const r=void 0===n["diacritic-sensitive"]?t.parse(!1,1,vn):t.parseObjectValue(n["diacritic-sensitive"],1,"diacritic-sensitive",vn);if(!r)return null;let o=null;return n.locale&&(o=t.parseObjectValue(n.locale,1,"locale",yn),!o)?null:new ti(i,r,o)}evaluate(e){return new Fn(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ni(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ri;for(;i>n;){if(i-n>600){const o=i-n+1,s=t-n+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);ni(e,t,Math.max(n,Math.floor(t-s*l/o+c)),Math.min(i,Math.floor(t+(o-s)*l/o+c)),r)}const o=e[t];let s=n,a=i;for(ii(e,n,t),r(e[i],o)>0&&ii(e,n,i);s<a;){for(ii(e,s,a),s++,a--;r(e[s],o)<0;)s++;for(;r(e[a],o)>0;)a--}0===r(e[n],o)?ii(e,n,a):(a++,ii(e,a,i)),a<=t&&(n=a+1),t<=a&&(i=a-1)}}function ii(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function ri(e,t){return e<t?-1:e>t?1:0}function oi(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}function si(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function ai(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function li(e,t,n){const i=e[0]-t[0],r=e[1]-t[1],o=e[0]-n[0],s=e[1]-n[1];return i*s-o*r==0&&i*o<=0&&r*s<=0}function ci(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;for(let a=0,l=t.length;a<l;a++){const l=t[a];for(let t=0,a=l.length,c=a-1;t<a;c=t++){const a=l[c],u=l[t];if(li(e,a,u))return n;(o=a)[1]>(r=e)[1]!=(s=u)[1]>r[1]&&r[0]<(s[0]-o[0])*(r[1]-o[1])/(s[1]-o[1])+o[0]&&(i=!i)}}var r,o,s;return i}function ui(e,t,n,i){const r=i[0]-n[0],o=i[1]-n[1],s=(e[0]-n[0])*o-r*(e[1]-n[1]),a=(t[0]-n[0])*o-r*(t[1]-n[1]);return s>0&&a<0||s<0&&a>0}function hi(e,t,n,i){return 0!=(r=[i[0]-n[0],i[1]-n[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-r[1]*o[0]&&!(!ui(e,t,n,i)||!ui(n,i,e,t));var r,o}function di(e){const t=new xe(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new xe(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const i of e[0])t.x>i.x&&(t.x=i.x),t.y>i.y&&(t.y=i.y),n.x<i.x&&(n.x=i.x),n.y<i.y&&(n.y=i.y);return{min:t,max:n}}const fi=8192;function pi(e,t){const n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(n*r*fi),Math.round(i*r*fi)]}function mi(e,t){for(let n=0;n<t.length;n++)if(ci(e,t[n]))return!0;return!1}function gi(e,t,n){for(const i of n)for(let n=0,r=i.length,o=r-1;n<r;o=n++)if(hi(e,t,i[o],i[n]))return!0;return!1}function _i(e,t){for(let n=0;n<e.length;++n)if(!ci(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(gi(e[n],e[n+1],t))return!1;return!0}function yi(e,t){for(let n=0;n<t.length;n++)if(_i(e,t[n]))return!0;return!1}function vi(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=[];for(let i=0;i<e[r].length;i++){const s=pi(e[r][i],n);si(t,s),o.push(s)}i.push(o)}return i}function xi(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=vi(e[r],t,n);i.push(o)}return i}function bi(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const t=.5*i;let r=e[0]-n[0]>t?-i:n[0]-e[0]>t?i:0;0===r&&(r=e[0]-n[2]>t?-i:n[2]-e[0]>t?i:0),e[0]+=r}si(t,e)}function wi(e,t,n,i){const r=Math.pow(2,i.z)*fi,o=[i.x*fi,i.y*fi],s=[];if(!e)return s;for(const a of e)for(const e of a){const i=[e.x+o[0],e.y+o[1]];bi(i,t,n,r),s.push(i)}return s}function Ei(e,t,n,i){const r=Math.pow(2,i.z)*fi,o=[i.x*fi,i.y*fi],s=[];if(!e)return s;for(const l of e){const e=[];for(const n of l){const i=[n.x+o[0],n.y+o[1]];si(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=r/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const i of e)bi(i,t,n,r)}var a;return s}class Ti{constructor(e,t){this.type=vn,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(Nn(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const n=t.features[e].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Ti(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Ti(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Ti(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=vi(t.coordinates,i,r),s=wi(e.geometry(),n,i,r);if(!ai(n,i))return!1;for(const e of s)if(!ci(e,o))return!1}if("MultiPolygon"===t.type){const o=xi(t.coordinates,i,r),s=wi(e.geometry(),n,i,r);if(!ai(n,i))return!1;for(const e of s)if(!mi(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=vi(t.coordinates,i,r),s=Ei(e.geometry(),n,i,r);if(!ai(n,i))return!1;for(const e of s)if(!_i(e,o))return!1}if("MultiPolygon"===t.type){const o=xi(t.coordinates,i,r),s=Ei(e.geometry(),n,i,r);if(!ai(n,i))return!1;for(const e of s)if(!yi(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ai={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Si=1/298.257223563,Di=Si*(2-Si),Ci=Math.PI/180;class Ii{static fromTile(e,t,n){const i=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),r=Math.atan(.5*(Math.exp(i)-Math.exp(-i)))/Ci;return new Ii(r,n)}static get units(){return Ai}constructor(e,t){if(void 0===e)throw new Error("No latitude given.");if(t&&!Ai[t])throw new Error("Unknown unit ".concat(t,". Use one of: ").concat(Object.keys(Ai).join(", ")));const n=6378.137*Ci*(t?Ai[t]:1),i=Math.cos(e*Ci),r=1/(1-Di*(1-i*i)),o=Math.sqrt(r);this.kx=n*o*i,this.ky=n*o*r*(1-Di)}distance(e,t){const n=Mi(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)}bearing(e,t){const n=Mi(t[0]-e[0])*this.kx;return Math.atan2(n,(t[1]-e[1])*this.ky)/Ci}destination(e,t,n){const i=n*Ci;return this.offset(e,Math.sin(i)*t,Math.cos(i)*t)}offset(e,t,n){return[e[0]+t/this.kx,e[1]+n/this.ky]}lineDistance(e){let t=0;for(let n=0;n<e.length-1;n++)t+=this.distance(e[n],e[n+1]);return t}area(e){let t=0;for(let n=0;n<e.length;n++){const i=e[n];for(let e=0,r=i.length,o=r-1;e<r;o=e++)t+=Mi(i[e][0]-i[o][0])*(i[e][1]+i[o][1])*(n?-1:1)}return Math.abs(t)/2*this.kx*this.ky}along(e,t){let n=0;if(t<=0)return e[0];for(let i=0;i<e.length-1;i++){const r=e[i],o=e[i+1],s=this.distance(r,o);if(n+=s,n>t)return Pi(r,o,(t-(n-s))/s)}return e[e.length-1]}pointToSegmentDistance(e,t,n){let[i,r]=t,o=Mi(n[0]-i)*this.kx,s=(n[1]-r)*this.ky;if(0!==o||0!==s){const t=(Mi(e[0]-i)*this.kx*o+(e[1]-r)*this.ky*s)/(o*o+s*s);t>1?(i=n[0],r=n[1]):t>0&&(i+=o/this.kx*t,r+=s/this.ky*t)}return o=Mi(e[0]-i)*this.kx,s=(e[1]-r)*this.ky,Math.sqrt(o*o+s*s)}pointOnLine(e,t){let n=1/0,i=e[0][0],r=e[0][1],o=0,s=0;for(let a=0;a<e.length-1;a++){let l=e[a][0],c=e[a][1],u=Mi(e[a+1][0]-l)*this.kx,h=(e[a+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(Mi(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=e[a+1][0],c=e[a+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=Mi(t[0]-l)*this.kx,h=(t[1]-c)*this.ky;const f=u*u+h*h;f<n&&(n=f,i=l,r=c,o=a,s=d)}return{point:[i,r],index:o,t:Math.max(0,Math.min(1,s))}}lineSlice(e,t,n){let i=this.pointOnLine(n,e),r=this.pointOnLine(n,t);if(i.index>r.index||i.index===r.index&&i.t>r.t){const e=i;i=r,r=e}const o=[i.point],s=i.index+1,a=r.index;!Ri(n[s],o[0])&&s<=a&&o.push(n[s]);for(let l=s+1;l<=a;l++)o.push(n[l]);return Ri(n[a],r.point)||o.push(r.point),o}lineSliceAlong(e,t,n){let i=0;const r=[];for(let o=0;o<n.length-1;o++){const s=n[o],a=n[o+1],l=this.distance(s,a);if(i+=l,i>e&&0===r.length&&r.push(Pi(s,a,(e-(i-l))/l)),i>=t)return r.push(Pi(s,a,(t-(i-l))/l)),r;i>e&&r.push(a)}return r}bufferPoint(e,t){const n=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-n,e[0]+i,e[1]+n]}bufferBBox(e,t){const n=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-n,e[2]+i,e[3]+n]}insideBBox(e,t){return Mi(e[0]-t[0])>=0&&Mi(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]}}function Ri(e,t){return e[0]===t[0]&&e[1]===t[1]}function Pi(e,t,n){const i=Mi(t[0]-e[0]);return[e[0]+i*n,e[1]+(t[1]-e[1])*n]}function Mi(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}class Fi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e<t?-1:e>t?1:0;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1);const o=i+1;if(o<this.length&&n(t[o],t[i])<0&&(i=o),n(t[i],r)>=0)break;t[e]=t[i],e=i}t[e]=r}}var Li=8192;function ki(e,t){return t.dist-e.dist}const Oi=100,Bi=50;function zi(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Ni(e){return e[1]-e[0]+1}function Ui(e,t){const n=e[1]>=e[0]&&e[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function Vi(e,t){if(e[0]>e[1])return[null,null];const n=Ni(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===n)return[e,null];const t=Math.floor(n/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function ji(e,t){const n=[1/0,1/0,-1/0,-1/0];if(!Ui(t,e.length))return n;for(let i=t[0];i<=t[1];++i)si(n,e[i]);return n}function Gi(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<e.length;++n)for(let i=0;i<e[n].length;++i)si(t,e[n][i]);return t}function Hi(e,t,n){if(zi(e)||zi(t))return NaN;let i=0,r=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(r=e[1]-t[3]),e[3]<t[1]&&(r=t[1]-e[3]),n.distance([0,0],[i,r])}function Wi(e){return 360*e-180}function qi(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Xi(e,t){const n=Math.pow(2,t.z),i=(e.y/Li+t.y)/n;return[Wi((e.x/Li+t.x)/n),qi(i)]}function Zi(e,t){const n=[];for(let i=0;i<e.length;++i)n.push(Xi(e[i],t));return n}function Yi(e,t,n){const i=n.pointOnLine(t,e).point;return n.distance(e,i)}function Ki(e,t,n,i,r){const o=n.slice(i[0],i[1]+1);let s=1/0;for(let a=t[0];a<=t[1];++a)if(0===(s=Math.min(s,Yi(e[a],o,r))))return 0;return s}function Ji(e,t,n,i,r){const o=Math.min(r.pointToSegmentDistance(e,n,i),r.pointToSegmentDistance(t,n,i)),s=Math.min(r.pointToSegmentDistance(n,e,t),r.pointToSegmentDistance(i,e,t));return Math.min(o,s)}function Qi(e,t,n,i,r){if(!Ui(t,e.length)||!Ui(i,n.length))return NaN;let o=1/0;for(let s=t[0];s<t[1];++s)for(let t=i[0];t<i[1];++t){if(hi(e[s],e[s+1],n[t],n[t+1]))return 0;o=Math.min(o,Ji(e[s],e[s+1],n[t],n[t+1],r))}return o}function $i(e,t,n,i,r){if(!Ui(t,e.length)||!Ui(i,n.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=i[0];t<=i[1];++t)if(0===(o=Math.min(o,r.distance(e[s],n[t]))))return o;return o}function er(e,t,n){if(ci(e,t,!0))return 0;let i=1/0;for(const r of t){const t=r.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(r[0]!==r[t-1]&&0===(i=Math.min(i,n.pointToSegmentDistance(e,r[t-1],r[0]))))return i;if(0===(i=Math.min(i,Yi(e,r,n))))return i}return i}function tr(e,t,n,i){if(!Ui(t,e.length))return NaN;for(let o=t[0];o<=t[1];++o)if(ci(e[o],n,!0))return 0;let r=1/0;for(let o=t[0];o<t[1];++o)for(const t of n)for(let n=0,s=t.length,a=s-1;n<s;a=n++){if(hi(e[o],e[o+1],t[a],t[n]))return 0;r=Math.min(r,Ji(e[o],e[o+1],t[a],t[n],i))}return r}function nr(e,t){for(const n of e)for(let e=0;e<=n.length-1;++e)if(ci(n[e],t,!0))return!0;return!1}function ir(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const r=Gi(e),o=Gi(t);if(i!==1/0&&Hi(r,o,n)>=i)return i;if(ai(r,o)){if(nr(e,t))return 0}else if(nr(t,e))return 0;let s=i;for(const a of e)for(let e=0,i=a.length,r=i-1;e<i;r=e++)for(const o of t)for(let t=0,i=o.length,l=i-1;t<i;l=t++){if(hi(a[r],a[e],o[l],o[t]))return 0;s=Math.min(s,Ji(a[r],a[e],o[l],o[t],n))}return s}function rr(e,t,n,i,r,o,s){if(null===o||null===s)return;const a=Hi(ji(i,o),ji(r,s),n);a<t&&e.push({dist:a,range1:o,range2:s})}function or(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=Math.min(i.distance(e[0],n[0][0]),r);if(0===o)return o;const s=new Fi([{dist:0,range1:[0,e.length-1],range2:[0,0]}],ki),a=t?Bi:Oi,l=Gi(n);for(;s.length;){const r=s.pop();if(r.dist>=o)continue;const c=r.range1;if(Ni(c)<=a){if(!Ui(c,e.length))return NaN;if(t){const t=tr(e,c,n,i);if(0===(o=Math.min(o,t)))return o}else for(let t=c[0];t<=c[1];++t){const r=er(e[t],n,i);if(0===(o=Math.min(o,r)))return o}}else{const n=Vi(c,t);if(null!==n[0]){const t=Hi(ji(e,n[0]),l,i);t<o&&s.push({dist:t,range1:n[0],range2:[0,0]})}if(null!==n[1]){const t=Hi(ji(e,n[1]),l,i);t<o&&s.push({dist:t,range1:n[1],range2:[0,0]})}}}return o}function sr(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,s=Math.min(o,r.distance(e[0],n[0]));if(0===s)return s;const a=new Fi([{dist:0,range1:[0,e.length-1],range2:[0,n.length-1]}],ki),l=t?Bi:Oi,c=i?Bi:Oi;for(;a.length;){const o=a.pop();if(o.dist>=s)continue;const u=o.range1,h=o.range2;if(Ni(u)<=l&&Ni(h)<=c){if(!Ui(u,e.length)||!Ui(h,n.length))return NaN;if(t&&i?s=Math.min(s,Qi(e,u,n,h,r)):t||i?t&&!i?s=Math.min(s,Ki(n,h,e,u,r)):!t&&i&&(s=Math.min(s,Ki(e,u,n,h,r))):s=Math.min(s,$i(e,u,n,h,r)),0===s)return s}else{const o=Vi(u,t),l=Vi(h,i);rr(a,s,r,e,n,o[0],l[0]),rr(a,s,r,e,n,o[0],l[1]),rr(a,s,r,e,n,o[1],l[0]),rr(a,s,r,e,n,o[1],l[1])}}return s}function ar(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=ji(e,[0,e.length-1]);for(const s of n)if(!(r!==1/0&&Hi(o,ji(s,[0,s.length-1]),i)>=r)&&(r=Math.min(r,sr(e,t,s,!0,i,r)),0===r))return r;return r}function lr(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=ji(e,[0,e.length-1]);for(const s of n){if(r!==1/0&&Hi(o,Gi(s),i)>=r)continue;const n=or(e,t,s,i,r);if(isNaN(n))return n;if(0===(r=Math.min(r,n)))return r}return r}function cr(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class ur{constructor(e,t){this.type=_n,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'distance' expression requires either one argument, but found ' ".concat(e.length-1," instead."));if(Nn(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(cr(t.features[e].geometry.type))return new ur(t,t.features[e].geometry)}else if("Feature"===t.type){if(cr(t.geometry.type))return new ur(t,t.geometry)}else if(cr(t.type))return new ur(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),n=e.canonicalID();if(null!=t&&null!=n){if("Point"===e.geometryType())return function(e,t,n){const i=[];for(const o of e)for(const e of o)i.push(Xi(e,t));const r=new Ii(i[0][1],"meters");return"Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type?sr(i,!1,"Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,r):"MultiLineString"===n.type?ar(i,!1,n.coordinates,r):"Polygon"===n.type||"MultiPolygon"===n.type?lr(i,!1,"Polygon"===n.type?[n.coordinates]:n.coordinates,r):null}(t,n,this.geometries);if("LineString"===e.geometryType())return function(e,t,n){const i=[];for(const o of e){const e=[];for(const n of o)e.push(Xi(n,t));i.push(e)}const r=new Ii(i[0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return ar("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i,r);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=ar(n.coordinates[t],!0,i,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}if("Polygon"===n.type||"MultiPolygon"===n.type){let e=1/0;for(let t=0;t<i.length;t++){const o=lr(i[t],!0,"Polygon"===n.type?[n.coordinates]:n.coordinates,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return null}(t,n,this.geometries);if("Polygon"===e.geometryType())return function(e,t,n){const i=[];for(const o of function(e){const t=e.length;if(t<=1)return[e];const n=[];let i,r;for(let o=0;o<t;o++){const t=oi(e[o]);0!==t&&(e[o].area=Math.abs(t),void 0===r&&(r=t<0),r===t<0?(i&&n.push(i),i=[e[o]]):i.push(e[o]))}return i&&n.push(i),n}(e)){const e=[];for(let n=0;n<o.length;++n)e.push(Zi(o[n],t));i.push(e)}const r=new Ii(i[0][0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return lr("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i,r);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=lr(n.coordinates[t],!0,i,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return"Polygon"===n.type||"MultiPolygon"===n.type?function(e,t,n){let i=1/0;for(const r of e)for(const e of t){const t=ir(r,e,n,i);if(isNaN(t))return t;if(0===(i=Math.min(i,t)))return i}return i}("Polygon"===n.type?[n.coordinates]:n.coordinates,i,r):null}(t,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function hr(e){if(e instanceof $n){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Ti)return!1;if(e instanceof ur)return!1;if(e instanceof yr)return e.featureConstant;let t=!0;return e.eachChild(e=>{t&&!hr(e)&&(t=!1)}),t}function dr(e){if(e instanceof $n&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!dr(e)&&(t=!1)}),t}function fr(e){if(e instanceof yr)return new Set([e.key]);let t=new Set;return e.eachChild(e=>{t=new Set([...t,...fr(e)])}),t}function pr(e,t){if(e instanceof $n&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(e=>{n&&!pr(e,t)&&(n=!1)}),n}function mr(e,t,n){return[e,t,n].filter(Boolean).join("\x1f")}function gr(e,t){switch(e){case"string":return Vn(t);case"number":return+t;case"boolean":return!!t;case"color":return sn.parse(t);case"formatted":return kn.fromString(Vn(t));case"resolvedImage":return Bn.build(Vn(t))}return t}function _r(e,t,n,i){return void 0!==i&&(e=i*Math.round(e/i)),void 0!==t&&e<t&&(e=t),void 0!==n&&e>n&&(e=n),e}class yr{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.type=e,this.key=t,this.scope=n,this.featureConstant=i}static parse(e,t){let n=t.expectedType;if(null==n&&(n=wn),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const i=t.parse(e[1],1);if(!(i instanceof jn))return t.error("Key name of 'config' expression must be a string literal.");let r,o=!0;const s=Vn(i.value);if(e.length>=3){const n=t.parse(e[2],2);if(!(n instanceof jn))return t.error("Scope of 'config' expression must be a string literal.");r=Vn(n.value)}if(t.options){const e=mr(s,r,t._scope),n=t.options.get(e);n&&(o=hr(n.value||n.default))}return new yr(n,s,r,o)}evaluate(e){const t=mr(this.key,this.scope,e.scope),n=e.getConfig(t);if(!n)return null;const{type:i,value:r,values:o,minValue:s,maxValue:a,stepValue:l}=n,c=n.default.evaluate(e);let u=c;if(r){const t=e.scope;e.scope=(t||"").split("\x1f").slice(1).join("\x1f"),u=r.evaluate(e),e.scope=t}return i&&(u=gr(i,u)),void 0===u||void 0===s&&void 0===a&&void 0===l||("number"==typeof u?u=_r(u,s,a,l):Array.isArray(u)&&(u=u.map(e=>"number"==typeof e?_r(e,s,a,l):e))),void 0!==r&&void 0!==u&&o&&!o.includes(u)&&(u=c,i&&(u=gr(i,u))),(i&&i!==this.type||void 0!==u&&!Mn(Un(u),this.type))&&(u=gr(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class vr{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new vr(n,t.scope.get(n)):t.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class xr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mn,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;this.registry=e,this.path=t,this.key=t.map(e=>"string"==typeof e?"['".concat(e,"']"):"[".concat(e,"]")).join(""),this.scope=i,this.errors=r,this.expectedType=n,this._scope=o,this.options=s}parse(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||n?this.concat(t,null,n,i)._parse(e,r):this._parse(e,r)}parseObjectValue(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.concat(t,n,i,r)._parse(e,o)}_parse(e,t){function n(e,t,n){return"assert"===n?new Wn(t,[e]):"coerce"===n?new Kn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i="string"==typeof e[0]?this.registry[e[0]]:void 0;if(i){let r=i.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,i=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(e,i))return null}else r=n(r,e,t.typeAnnotation||"coerce");else r=n(r,e,t.typeAnnotation||"assert")}if(!(r instanceof jn)&&"resolvedImage"!==r.type.kind&&br(r)){const t=new Qn(this._scope,this.options);try{r=new jn(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return Kn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}concat(e,t,n,i){let r="number"==typeof e?this.path.concat(e):this.path;r="string"==typeof t?r.concat(t):r;const o=i?this.scope.concat(i):this.scope;return new xr(this.registry,r,n||null,o,this.errors,this._scope,this.options)}error(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r="".concat(this.key).concat(n.map(e=>"[".concat(e,"]")).join(""));this.errors.push(new pn(r,e))}checkSubtype(e,t){const n=In(e,t);return n&&this.error(n),n}}function br(e){if(e instanceof vr)return br(e.boundExpression);if(e instanceof $n&&"error"===e.name)return!1;if(e instanceof ti)return!1;if(e instanceof Ti)return!1;if(e instanceof ur)return!1;if(e instanceof yr)return!1;const t=e instanceof Kn||e instanceof Wn;let n=!0;return e.eachChild(e=>{n=t?n&&br(e):n&&e instanceof jn}),!!n&&hr(e)&&pr(e,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function wr(e,t){const n=e.length-1;let i,r,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),i=e[a],r=e[a+1],i<=t){if(a===n||t<r)return a;o=a+1}else{if(!(i>t))throw new Gn("Input is not a number.");s=a-1}return 0}class Er{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,_n);if(!n)return null;const i=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let o=1;o<e.length;o+=2){const n=1===o?-1/0:e[o],s=e[o+1],a=o,l=o+1;if("number"!=typeof n)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=n)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new Er(r,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;return i>=t[r-1]?n[r-1].evaluate(e):n[wr(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}const Tr=.95047,Ar=1.08883,Sr=4/29,Dr=6/29,Cr=3*Dr*Dr,Ir=Dr*Dr*Dr,Rr=Math.PI/180,Pr=180/Math.PI;function Mr(e){return e>Ir?Math.pow(e,1/3):e/Cr+Sr}function Fr(e){return e>Dr?e*e*e:Cr*(e-Sr)}function Lr(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function kr(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Or(e){const t=kr(e.r),n=kr(e.g),i=kr(e.b),r=Mr((.4124564*t+.3575761*n+.1804375*i)/Tr),o=Mr((.2126729*t+.7151522*n+.072175*i)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-Mr((.0193339*t+.119192*n+.9503041*i)/Ar)),alpha:e.a}}function Br(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*Fr(t),n=Tr*Fr(n),i=Ar*Fr(i),new sn(Lr(3.2404542*n-1.5371385*t-.4985314*i),Lr(-.969266*n+1.8760108*t+.041556*i),Lr(.0556434*n-.2040259*t+1.0572252*i),e.alpha)}function zr(e,t,n){const i=t-e;return e+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const Nr={forward:Or,reverse:Br,interpolate:function(e,t,n){return{l:un(e.l,t.l,n),a:un(e.a,t.a,n),b:un(e.b,t.b,n),alpha:un(e.alpha,t.alpha,n)}}},Ur={forward:function(e){const{l:t,a:n,b:i}=Or(e),r=Math.atan2(i,n)*Pr;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Rr,n=e.c;return Br({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:zr(e.h,t.h,n),c:un(e.c,t.c,n),l:un(e.l,t.l,n),alpha:un(e.alpha,t.alpha,n)}}};var Vr=Object.freeze({__proto__:null,hcl:Ur,lab:Nr});class jr{constructor(e,t,n,i,r){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[o,s]of r)this.labels.push(o),this.outputs.push(s)}static interpolationFactor(e,t,n,i){let r=0;if("exponential"===e.name)r=Gr(t,e.base,n,i);else if("linear"===e.name)r=Gr(t,1,n,i);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new ve(o[0],o[1],o[2],o[3]).solve(Gr(t,1,n,i))}return r}static parse(e,t){let[n,i,r,...o]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error("Unknown interpolation type ".concat(String(i[0])),1,0);{const e=i.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length-1>3&&(e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,_n),!r)return null;const s=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=xn:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let l=0;l<o.length;l+=2){const e=o[l],n=o[l+1],i=l+3,r=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(s.length&&s[s.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=t.parse(n,r,a);if(!c)return null;a=a||c.type,s.push([e,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new jr(a,n,i,r,s):t.error("Type ".concat(Dn(a)," is not interpolatable."))}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;if(i>=t[r-1])return n[r-1].evaluate(e);const o=wr(t,i),s=jr.interpolationFactor(this.interpolation,i,t[o],t[o+1]),a=n[o].evaluate(e),l=n[o+1].evaluate(e);return"interpolate"===this.operator?dn[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?Ur.reverse(Ur.interpolate(Ur.forward(a),Ur.forward(l),s)):Nr.reverse(Nr.interpolate(Nr.forward(a),Nr.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function Gr(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}class Hr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const s of e.slice(1)){const e=t.parse(s,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,r.push(e)}const o=i&&r.some(e=>In(i,e.type));return new Hr(o?wn:n,r)}evaluate(e){let t,n=null,i=0;for(const r of this.args){if(i++,n=r.evaluate(e),n&&n instanceof Bn&&!n.available&&(t||(t=n),n=null,i===this.args.length))return t;if(null!==n)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class Wr{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found ".concat(e.length-1," instead."));const n=[];for(let r=1;r<e.length-1;r+=2){const i=e[r];if("string"!=typeof i)return t.error("Expected string, but found ".concat(typeof i," instead."),r);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;n.push([i,o])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new Wr(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}class qr{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,_n),i=t.parse(e[2],2,Sn(t.expectedType||wn));return n&&i?new qr(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Gn("Array index out of bounds: ".concat(t," < 0."));if(t>=n.length)throw new Gn("Array index out of bounds: ".concat(t," > ").concat(n.length-1,"."));if(t!==Math.floor(t))throw new Gn("Array index must be an integer, but found ".concat(t," instead. Use at-interpolated to retrieve interpolated result with a fractional index."));return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Xr{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,_n),i=t.parse(e[2],2,Sn(t.expectedType||wn));return n&&i?new Xr(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Gn("Array index out of bounds: ".concat(t," < 0."));if(t>n.length-1)throw new Gn("Array index out of bounds: ".concat(t," > ").concat(n.length-1,"."));if(t===Math.floor(t))return n[t];const i=Math.floor(t),r=Math.ceil(t),o=n[i],s=n[r];if("number"!=typeof o||"number"!=typeof s)throw new Gn("Cannot interpolate between non-number values at index ".concat(t,"."));const a=t-i;return o*(1-a)+s*a}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Zr{constructor(e,t){this.type=vn,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,wn),i=t.parse(e[2],2,wn);return n&&i?Rn(n.type,[vn,yn,_n,gn,wn])?new Zr(n,i):t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Dn(n.type)," instead")):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(null==n)return!1;if(!Pn(t,["boolean","string","number","null"]))throw new Gn("Expected first argument to be of type boolean, string, number or null, but found ".concat(Dn(Un(t))," instead."));if(!Pn(n,["string","array"]))throw new Gn("Expected second argument to be of type array or string, but found ".concat(Dn(Un(n))," instead."));return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Yr{constructor(e,t,n){this.type=_n,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,wn),i=t.parse(e[2],2,wn);if(!n||!i)return null;if(!Rn(n.type,[vn,yn,_n,gn,wn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Dn(n.type)," instead"));if(4===e.length){const r=t.parse(e[3],3,_n);return r?new Yr(n,i,r):null}return new Yr(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Pn(t,["boolean","string","number","null"]))throw new Gn("Expected first argument to be of type boolean, string, number or null, but found ".concat(Dn(Un(t))," instead."));if(!Pn(n,["string","array"]))throw new Gn("Expected second argument to be of type array or string, but found ".concat(Dn(Un(n))," instead."));if(this.fromIndex){const i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Kr{constructor(e,t,n,i,r,o){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r={},o=[];for(let l=2;l<e.length-1;l+=2){let s=e[l];const a=e[l+1];Array.isArray(s)||(s=[s]);const c=t.concat(l);if(0===s.length)return c.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,Un(e)))return null}else n=Un(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(a,l,i);if(!u)return null;i=i||u.type,o.push(u)}const s=t.parse(e[1],1,wn);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,i);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(n,s.type)?null:new Kr(n,i,s,r,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(Mn(Un(t),this.inputType)&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],i={};for(const o of t){const e=i[this.cases[o]];void 0===e?(i[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[e][1].push(o)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[o,s]of n)e.push(1===s.length?r(s[0]):s.map(r)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}class Jr{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const r=t.parse(e[o],o,vn);if(!r)return null;const s=t.parse(e[o+1],o+1,n);if(!s)return null;i.push([r,s]),n=n||s.type}const r=t.parse(e[e.length-1],e.length-1,n);return r?new Jr(n,i,r):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(e=>{let[t,n]=e;return n.outputDefined()})&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class Qr{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,wn),i=t.parse(e[2],2,_n);if(!n||!i)return null;if(!Rn(n.type,[Sn(wn),yn,wn]))return t.error("Expected first argument to be of type array or string, but found ".concat(Dn(n.type)," instead"));if(4===e.length){const r=t.parse(e[3],3,_n);return r?new Qr(n.type,n,i,r):null}return new Qr(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Pn(t,["string","array"]))throw new Gn("Expected first argument to be of type array or string, but found ".concat(Dn(Un(t))," instead."));if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class $r{constructor(e,t){this.type=Sn(yn),this.str=e,this.delimiter=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,yn),i=t.parse(e[2],2,yn);return n&&i?new $r(n,i):void 0}evaluate(e){const t=this.str.evaluate(e),n=this.delimiter.evaluate(e);return t.split(n)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function eo(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function to(e,t,n,i){return 0===i.compare(t,n)}function no(e,t,n){const i="=="!==e&&"!="!==e;return class r{constructor(e,t,n){this.type=vn,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let o=t.parse(e[1],1,wn);if(!o)return null;if(!eo(n,o.type))return t.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Dn(o.type),"'."));let s=t.parse(e[2],2,wn);if(!s)return null;if(!eo(n,s.type))return t.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Dn(s.type),"'."));if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot compare types '".concat(Dn(o.type),"' and '").concat(Dn(s.type),"'."));i&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Wn(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Wn(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,En),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const t=Un(o),n=Un(s);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new Gn('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(t.kind,", ").concat(n.kind,") instead."))}if(this.collator&&!i&&this.hasUntypedArgument){const e=Un(o),n=Un(s);if("string"!==e.kind||"string"!==n.kind)return t(r,o,s)}return this.collator?n(r,o,s,this.collator.evaluate(r)):t(r,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild(e=>{t.push(e.serialize())}),t}}}const io=no("==",function(e,t,n){return t===n},to),ro=no("!=",function(e,t,n){return t!==n},function(e,t,n,i){return!to(0,t,n,i)}),oo=no("<",function(e,t,n){return t<n},function(e,t,n,i){return i.compare(t,n)<0}),so=no(">",function(e,t,n){return t>n},function(e,t,n,i){return i.compare(t,n)>0}),ao=no("<=",function(e,t,n){return t<=n},function(e,t,n,i){return i.compare(t,n)<=0}),lo=no(">=",function(e,t,n){return t>=n},function(e,t,n,i){return i.compare(t,n)>=0});class co{constructor(e,t,n,i,r,o){this.type=yn,this.number=e,this.locale=t,this.currency=n,this.unit=i,this.minFractionDigits=r,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,_n);if(!n)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=t.parseObjectValue(i.locale,2,"locale",yn),!r))return null;let o=null;if(i.currency&&(o=t.parseObjectValue(i.currency,2,"currency",yn),!o))return null;let s=null;if(i.unit&&(s=t.parseObjectValue(i.unit,2,"unit",yn),!s))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parseObjectValue(i["min-fraction-digits"],2,"min-fraction-digits",_n),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parseObjectValue(i["max-fraction-digits"],2,"max-fraction-digits",_n),!l)?null:new co(n,r,o,s,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class uo{constructor(e){this.type=_n,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error("Expected argument of type string or array, but found ".concat(Dn(n.type)," instead.")):new uo(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Gn("Expected value to be of type string or array, but found ".concat(Dn(Un(t))," instead."))}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}function ho(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const fo={"==":io,"!=":ro,">":so,"<":oo,">=":lo,"<=":ao,array:Wn,at:qr,"at-interpolated":Xr,boolean:Wn,case:Jr,coalesce:Hr,collator:ti,format:qn,image:Xn,in:Zr,"index-of":Yr,interpolate:jr,"interpolate-hcl":jr,"interpolate-lab":jr,length:uo,let:Wr,literal:jn,match:Kr,number:Wn,"number-format":co,object:Wn,slice:Qr,step:Er,string:Wn,"to-boolean":Kn,"to-color":Kn,"to-number":Kn,"to-string":Kn,var:vr,within:Ti,distance:ur,config:yr,split:$r};function po(e,t){let[n,i,r,o]=t;n=n.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const s=o?o.evaluate(e):1,a=zn(n,i,r,s);if(a)throw new Gn(a);return new sn(n/255,i/255,r/255,s)}function mo(e,t){let[n,i,r,o]=t;n=n.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const s=o?o.evaluate(e):1,a=function(e,t,n,i){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof n&&n>=0&&n<=100?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid hsla value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid hsla value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 's', and 'l' must be between 0 and 100."):"Invalid hsla value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'h' must be between 0 and 360.")}(n,i,r,s);if(a)throw new Gn(a);const l="hsla(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(s,")"),c=sn.parse(l);if(!c)throw new Gn("Failed to parse HSLA color: ".concat(l));return c}function go(e,t){return e in t}function _o(e,t){const n=t[e];return void 0===n?null:n}function yo(e){return{type:e}}function vo(e){return{result:"success",value:e}}function xo(e){return{result:"error",value:e}}function bo(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function wo(e){return"data-driven"===e["property-type"]}function Eo(e){return bo(e.expression,"measure-light")}function To(e){return bo(e.expression,"zoom")}function Ao(e){return!!e.expression&&e.expression.interpolated}function So(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Do(e){return e}function Co(e,t){const n="color"===t.type,i=e.stops&&"object"==typeof e.stops[0][0],r=i||!(i||void 0!==e.property),o=e.type||(Ao(t)?"exponential":"interval");if(n&&((e=fn({},e)).stops&&(e.stops=e.stops.map(e=>[e[0],sn.parse(e[1])])),e.default=sn.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Vr[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));let s,a,l;if("exponential"===o)s=Mo;else if("interval"===o)s=Po;else if("categorical"===o){s=Ro,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error('Unknown function type "'.concat(o,'"'));s=Fo}if(i){const n={},i=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},i.push(o)),n[o].stops.push([r[0].value,r[1]])}const r=[];for(const e of i)r.push([n[e].zoom,Co(n[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:jr.interpolationFactor.bind(void 0,o),zoomStops:r.map(e=>e[0]),evaluate:(n,i)=>{let{zoom:o}=n;return Mo({stops:r,base:e.base},t,o).evaluate(o,i)}}}if(r){const n="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:jr.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map(e=>e[0]),evaluate:n=>{let{zoom:i}=n;return s(e,t,i,a,l)}}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[e.property]:void 0;return void 0===r?Io(e.default,t.default):s(e,t,r,a,l)}}}function Io(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function Ro(e,t,n,i,r){return Io(typeof n===r?i[n]:void 0,e.default,t.default)}function Po(e,t,n){if("number"!==Zn(n))return Io(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const r=wr(e.stops.map(e=>e[0]),n);return e.stops[r][1]}function Mo(e,t,n){const i=void 0!==e.base?e.base:1;if("number"!==Zn(n))return Io(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const o=wr(e.stops.map(e=>e[0]),n),s=function(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(n,i,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=dn[t.type]||Do;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Vr[e.colorSpace];c=(e,n)=>t.reverse(t.interpolate(t.forward(e),t.forward(n),s))}return"function"==typeof a.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=a.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==r)return c(i,r,s)}}:c(a,l,s)}function Fo(e,t,n){return"color"===t.type?n=sn.parse(n):"formatted"===t.type?n=kn.fromString(n.toString()):"resolvedImage"===t.type?n=Bn.build(n.toString()):Zn(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),Io(n,e.default,t.default)}$n.register(fo,{error:[{kind:"error"},[yn],(e,t)=>{let[n]=t;throw new Gn(n.evaluate(e))}],typeof:[yn,[wn],(e,t)=>{let[n]=t;return Dn(Un(n.evaluate(e)))}],"to-rgba":[Sn(_n,4),[xn],(e,t)=>{let[n]=t;return n.evaluate(e).toNonPremultipliedRenderColor(null).toArray()}],"to-hsla":[Sn(_n,4),[xn],(e,t)=>{let[n]=t;return n.evaluate(e).toNonPremultipliedRenderColor(null).toHslaArray()}],rgb:[xn,[_n,_n,_n],po],rgba:[xn,[_n,_n,_n,_n],po],hsl:[xn,[_n,_n,_n],mo],hsla:[xn,[_n,_n,_n,_n],mo],has:{type:vn,overloads:[[[yn],(e,t)=>{let[n]=t;return go(n.evaluate(e),e.properties())}],[[yn,bn],(e,t)=>{let[n,i]=t;return go(n.evaluate(e),i.evaluate(e))}]]},get:{type:wn,overloads:[[[yn],(e,t)=>{let[n]=t;return _o(n.evaluate(e),e.properties())}],[[yn,bn],(e,t)=>{let[n,i]=t;return _o(n.evaluate(e),i.evaluate(e))}]]},"feature-state":[wn,[yn],(e,t)=>{let[n]=t;return _o(n.evaluate(e),e.featureState||{})}],properties:[bn,[],e=>e.properties()],"geometry-type":[yn,[],e=>e.geometryType()],worldview:[yn,[],e=>e.globals.worldview||""],id:[wn,[],e=>e.id()],zoom:[_n,[],e=>e.globals.zoom],pitch:[_n,[],e=>e.globals.pitch||0],"distance-from-center":[_n,[],e=>e.distanceFromCenter()],"measure-light":[_n,[yn],(e,t)=>{let[n]=t;return e.measureLight(n.evaluate(e))}],"heatmap-density":[_n,[],e=>e.globals.heatmapDensity||0],"line-progress":[_n,[],e=>e.globals.lineProgress||0],"raster-value":[_n,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[_n,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[_n,[],e=>e.globals.skyRadialProgress||0],accumulated:[wn,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[_n,yo(_n),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[_n,yo(_n),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:_n,overloads:[[[_n,_n],(e,t)=>{let[n,i]=t;return n.evaluate(e)-i.evaluate(e)}],[[_n],(e,t)=>{let[n]=t;return-n.evaluate(e)}]]},"/":[_n,[_n,_n],(e,t)=>{let[n,i]=t;return n.evaluate(e)/i.evaluate(e)}],"%":[_n,[_n,_n],(e,t)=>{let[n,i]=t;return n.evaluate(e)%i.evaluate(e)}],ln2:[_n,[],()=>Math.LN2],pi:[_n,[],()=>Math.PI],e:[_n,[],()=>Math.E],"^":[_n,[_n,_n],(e,t)=>{let[n,i]=t;return Math.pow(n.evaluate(e),i.evaluate(e))}],sqrt:[_n,[_n],(e,t)=>{let[n]=t;return Math.sqrt(n.evaluate(e))}],log10:[_n,[_n],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN10}],ln:[_n,[_n],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))}],log2:[_n,[_n],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN2}],sin:[_n,[_n],(e,t)=>{let[n]=t;return Math.sin(n.evaluate(e))}],cos:[_n,[_n],(e,t)=>{let[n]=t;return Math.cos(n.evaluate(e))}],tan:[_n,[_n],(e,t)=>{let[n]=t;return Math.tan(n.evaluate(e))}],asin:[_n,[_n],(e,t)=>{let[n]=t;return Math.asin(n.evaluate(e))}],acos:[_n,[_n],(e,t)=>{let[n]=t;return Math.acos(n.evaluate(e))}],atan:[_n,[_n],(e,t)=>{let[n]=t;return Math.atan(n.evaluate(e))}],min:[_n,yo(_n),(e,t)=>Math.min(...t.map(t=>t.evaluate(e)))],max:[_n,yo(_n),(e,t)=>Math.max(...t.map(t=>t.evaluate(e)))],abs:[_n,[_n],(e,t)=>{let[n]=t;return Math.abs(n.evaluate(e))}],round:[_n,[_n],(e,t)=>{let[n]=t;const i=n.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[_n,[_n],(e,t)=>{let[n]=t;return Math.floor(n.evaluate(e))}],ceil:[_n,[_n],(e,t)=>{let[n]=t;return Math.ceil(n.evaluate(e))}],"filter-==":[vn,[yn,wn],(e,t)=>{let[n,i]=t;return e.properties()[n.value]===i.value}],"filter-id-==":[vn,[wn],(e,t)=>{let[n]=t;return e.id()===n.value}],"filter-type-==":[vn,[yn],(e,t)=>{let[n]=t;return e.geometryType()===n.value}],"filter-<":[vn,[yn,wn],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r<o}],"filter-id-<":[vn,[wn],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[vn,[yn,wn],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r>o}],"filter-id->":[vn,[wn],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[vn,[yn,wn],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[vn,[wn],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[vn,[yn,wn],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r>=o}],"filter-id->=":[vn,[wn],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[vn,[wn],(e,t)=>{let[n]=t;return n.value in e.properties()}],"filter-has-id":[vn,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[vn,[Sn(yn)],(e,t)=>{let[n]=t;return n.value.indexOf(e.geometryType())>=0}],"filter-id-in":[vn,[Sn(wn)],(e,t)=>{let[n]=t;return n.value.indexOf(e.id())>=0}],"filter-in-small":[vn,[yn,Sn(wn)],(e,t)=>{let[n,i]=t;return i.value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[vn,[yn,Sn(wn)],(e,t)=>{let[n,i]=t;return function(e,t,n,i){for(;n<=i;){const r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}(e.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:vn,overloads:[[[vn,vn],(e,t)=>{let[n,i]=t;return n.evaluate(e)&&i.evaluate(e)}],[yo(vn),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:vn,overloads:[[[vn,vn],(e,t)=>{let[n,i]=t;return n.evaluate(e)||i.evaluate(e)}],[yo(vn),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[vn,[vn],(e,t)=>{let[n]=t;return!n.evaluate(e)}],"is-supported-script":[vn,[yn],(e,t)=>{let[n]=t;const i=e.globals&&e.globals.isSupportedScript;return!i||i(n.evaluate(e))}],upcase:[yn,[yn],(e,t)=>{let[n]=t;return n.evaluate(e).toUpperCase()}],downcase:[yn,[yn],(e,t)=>{let[n]=t;return n.evaluate(e).toLowerCase()}],concat:[yn,yo(wn),(e,t)=>t.map(t=>Vn(t.evaluate(e))).join("")],"resolved-locale":[yn,[En],(e,t)=>{let[n]=t;return n.evaluate(e).resolvedLocale()}],random:[_n,[_n,_n,wn],(e,t)=>{const[n,i,r]=t.map(t=>t.evaluate(e));if(n>i)return n;if(n===i)return n;let o;if("string"==typeof r)o=function(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}(r);else{if("number"!=typeof r)throw new Gn("Invalid seed input: ".concat(r));o=r}return n+ho(o)()*(i-n)}]});class Lo{constructor(e,t,n,i){this.expression=e,this._warningHistory={},this._evaluator=new Qn(n,i),this._defaultValue=t?function(e){return"color"===e.type&&(So(e.default)||Array.isArray(e.default))?new sn(0,0,0,0):"color"===e.type?sn.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null,this.configDependencies=fr(e)}evaluateWithoutErrorHandling(e,t,n,i,r,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,r,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Gn("Expected value to be one of ".concat(Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", "),", but found ").concat(JSON.stringify(e)," instead."));return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn('Failed to evaluate expression "'.concat(JSON.stringify(this.expression.serialize()),'". ').concat(e.message))),this._defaultValue}}}function ko(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in fo}function Oo(e,t,n,i){const r=new xr(fo,[],t?function(e){const t={color:xn,string:yn,number:_n,enum:yn,boolean:vn,formatted:Tn,resolvedImage:An};return"array"===e.type?Sn(t[e.value]||wn,e.length):t[e.type]}(t):void 0,void 0,void 0,n,i),o=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return o?vo(new Lo(o,t,n,i)):xo(r.errors)}class Bo{constructor(e,t,n,i){this.kind=e,this._styleExpression=t,this.isLightConstant=n,this.isLineProgressConstant=i,this.isStateDependent="constant"!==e&&!dr(t.expression),this.configDependencies=fr(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}}class zo{constructor(e,t,n,i,r,o){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!dr(t.expression),this.isLightConstant=r,this.isLineProgressConstant=o,this.configDependencies=fr(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}interpolationFactor(e,t,n){return this.interpolationType?jr.interpolationFactor(this.interpolationType,e,t,n):0}}function No(e,t,n,i){if("error"===(e=Oo(e,t,n,i)).result)return e;const r=e.value.expression,o=hr(r);if(!o&&!wo(t))return xo([new pn("","data expressions not supported")]);const s=pr(r,["zoom","pitch","distance-from-center"]);if(!s&&!To(t))return xo([new pn("","zoom expressions not supported")]);const a=pr(r,["measure-light"]);if(!a&&!Eo(t))return xo([new pn("","measure-light expression not supported")]);const l=pr(r,["line-progress"]);if(!l&&!function(e){return bo(e.expression,"line-progress")}(t))return xo([new pn("","line-progress expression not supported")]);const c=t.expression&&t.expression.relaxZoomRestriction,u=Vo(r);return u||s||c?u instanceof pn?xo([u]):u instanceof jr&&!Ao(t)?xo([new pn("",'"interpolate" expressions cannot be used with this property')]):vo(u?new zo(o&&l?"camera":"composite",e.value,u.labels,u instanceof jr?u.interpolation:void 0,a,l):new Bo(o&&l?"constant":"source",e.value,a,l)):xo([new pn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Uo{constructor(e,t){this._parameters=e,this._specification=t,fn(this,Co(this._parameters,this._specification))}static deserialize(e){return new Uo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Vo(e){let t=null;if(e instanceof Wr)t=Vo(e.result);else if(e instanceof Hr){for(const n of e.args)if(t=Vo(n),t)break}else(e instanceof Er||e instanceof jr)&&e.input instanceof $n&&"zoom"===e.input.name&&(t=e);return t instanceof pn||e.eachChild(e=>{const n=Vo(e);n instanceof pn?t=n:t&&n&&t!==n&&(t=new pn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var jo,Go,Ho=function(){if(Go)return jo;Go=1,jo=t;var e=3;function t(t,n,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var o=new Int32Array(this.arrayBuffer);t=o[0],this.d=(n=o[1])+2*(i=o[2]);for(var s=0;s<this.d*this.d;s++){var a=o[e+s],l=o[e+s+1];r.push(a===l?null:o.subarray(a,l))}var c=o[e+r.length+1];this.keys=o.subarray(o[e+r.length],c),this.bboxes=o.subarray(c),this.insert=this._insertReadonly}else{this.d=n+2*i;for(var u=0;u<this.d*this.d;u++)r.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=i,this.scale=n/t,this.uid=0;var h=i/n*t;this.min=-h,this.max=t+h}return t.prototype.insert=function(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(e,t,n,i,r,o){this.cells[r].push(o)},t.prototype.query=function(e,t,n,i,r){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=n&&s<=i&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,n,i,this._queryCell,a,{},r),a},t.prototype._queryCell=function(e,t,n,i,r,o,s,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var f=4*d;(a?a(u[f+0],u[f+1],u[f+2],u[f+3]):e<=u[f+2]&&t<=u[f+3]&&n>=u[f+0]&&i>=u[f+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},t.prototype._forEachCell=function(e,t,n,i,r,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i),d=l;d<=u;d++)for(var f=c;f<=h;f++){var p=this.d*f+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(f),this._convertFromCellCoord(d+1),this._convertFromCellCoord(f+1)))&&r.call(this,e,t,n,i,p,o,s,a))return}},t.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},t.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,n=e+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var o=new Int32Array(n+i+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var s=n,a=0;a<t.length;a++){var l=t[a];o[e+a]=s,o.set(l,s),s+=l.length}return o[e+t.length]=s,o.set(this.keys,s),o[e+t.length+1]=s+=this.keys.length,o.set(this.bboxes,s),s+=this.bboxes.length,o.buffer},jo}(),Wo=_e(Ho);const qo={};function Xo(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writable:!1}),qo[t]={klass:e,omit:n.omit||[]}}Xo(Object,"Object"),Wo.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.add(n),{buffer:n}},Wo.deserialize=function(e){return new Wo(e.buffer)},Object.defineProperty(Wo,"name",{value:"Grid"}),Xo(Wo,"Grid"),delete xe.prototype.constructor,"undefined"!=typeof DOMMatrix&&Xo(DOMMatrix,"DOMMatrix"),Xo(sn,"Color"),Xo(Error,"Error"),Xo(kn,"Formatted"),Xo(Ln,"FormattedSection"),Xo(Ft,"AJAXError"),Xo(Bn,"ResolvedImage"),Xo(Uo,"StylePropertyFunction"),Xo(Lo,"StyleExpression",{omit:["_evaluator"]}),Xo(tn,"ImageId"),Xo(On,"ImageVariant"),Xo(zo,"ZoomDependentExpression"),Xo(Bo,"ZoomConstantExpression"),Xo($n,"CompoundExpression",{omit:["_evaluate"]});for(const xb in fo)qo[fo[xb]._classRegistryKey]||Xo(fo[xb],"Expression".concat(xb));function Zo(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Yo(e){return self.ImageBitmap&&e instanceof ImageBitmap}function Ko(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Zo(e)||Yo(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e))return t&&t.add(e.buffer),e;if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const i of e)n.push(Ko(i,t));return n}if(e instanceof Map){const n={$name:"Map",entries:[]};for(const[i,r]of e.entries())n.entries.push(Ko(i),Ko(r,t));return n}if(e instanceof Set){const t={$name:"Set"};let n=0;for(const i of e.values())t[++n]=Ko(i);return t}if(e instanceof DOMMatrix){const t={$name:"DOMMatrix"},n=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const i of n)t[i]=e[i];return t}if("bigint"==typeof e)return{$name:"BigInt",value:e.toString()};if("object"==typeof e){const n=e.constructor,i=n._classRegistryKey;if(!i)throw new Error("Can't serialize object of unregistered class \"".concat(n.name,'".'));const r=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const n in e)e.hasOwnProperty(n)&&(qo[i].omit.indexOf(n)>=0||(r[n]=Ko(e[n],t)));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof e)}function Jo(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Zo(e)||Yo(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(Jo);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=e.entries||[],n=new Map;for(let e=0;e<t.length;e+=2)n.set(Jo(t[e]),Jo(t[e+1]));return n}if("Set"===t){const t=new Set;for(const n of Object.keys(e))"$name"!==n&&t.add(Jo(e[n]));return t}if("DOMMatrix"===t){let t;return t=e.is2D?[e.a,e.b,e.c,e.d,e.e,e.f]:[e.m11,e.m12,e.m13,e.m14,e.m21,e.m22,e.m23,e.m24,e.m31,e.m32,e.m33,e.m34,e.m41,e.m42,e.m43,e.m44],new DOMMatrix(t)}if("BigInt"===t)return BigInt(e.value);const{klass:n}=qo[t];if(!n)throw new Error("Can't deserialize unregistered class \"".concat(t,'".'));if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const r of Object.keys(e))"$name"!==r&&(i[r]=Jo(e[r]));return i}throw new Error("can't deserialize object of type "+typeof e)}const Qo={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,Osage:e=>e>=66736&&e<=66815,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function $o(e){for(const t of e)if(ns(t.charCodeAt(0)))return!0;return!1}function es(e){for(const t of e)if(!ts(t.charCodeAt(0)))return!1;return!0}function ts(e){return!(Qo.Arabic(e)||Qo["Arabic Supplement"](e)||Qo["Arabic Extended-A"](e)||Qo["Arabic Presentation Forms-A"](e)||Qo["Arabic Presentation Forms-B"](e))}function ns(e){return!(746!==e&&747!==e&&(e<4352||!(Qo["Bopomofo Extended"](e)||Qo.Bopomofo(e)||Qo["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Qo["CJK Compatibility Ideographs"](e)||Qo["CJK Compatibility"](e)||Qo["CJK Radicals Supplement"](e)||Qo["CJK Strokes"](e)||!(!Qo["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Qo["CJK Unified Ideographs Extension A"](e)||Qo["CJK Unified Ideographs"](e)||Qo["Enclosed CJK Letters and Months"](e)||Qo["Hangul Compatibility Jamo"](e)||Qo["Hangul Jamo Extended-A"](e)||Qo["Hangul Jamo Extended-B"](e)||Qo["Hangul Jamo"](e)||Qo["Hangul Syllables"](e)||Qo.Hiragana(e)||Qo["Ideographic Description Characters"](e)||Qo.Kanbun(e)||Qo["Kangxi Radicals"](e)||Qo["Katakana Phonetic Extensions"](e)||Qo.Katakana(e)&&12540!==e||!(!Qo["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Qo["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Qo["Unified Canadian Aboriginal Syllabics"](e)||Qo["Unified Canadian Aboriginal Syllabics Extended"](e)||Qo["Vertical Forms"](e)||Qo["Yijing Hexagram Symbols"](e)||Qo["Yi Syllables"](e)||Qo["Yi Radicals"](e))))}function is(e){return!(ns(e)||function(e){return!!(Qo["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Qo["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Qo["Letterlike Symbols"](e)||Qo["Number Forms"](e)||Qo["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Qo["Control Pictures"](e)&&9251!==e||Qo["Optical Character Recognition"](e)||Qo["Enclosed Alphanumerics"](e)||Qo["Geometric Shapes"](e)||Qo["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Qo["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qo["CJK Symbols and Punctuation"](e)||Qo.Katakana(e)||Qo["Private Use Area"](e)||Qo["CJK Compatibility Forms"](e)||Qo["Small Form Variants"](e)||Qo["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function rs(e){return Qo.Arabic(e)||Qo["Arabic Supplement"](e)||Qo["Arabic Extended-A"](e)||Qo["Arabic Presentation Forms-A"](e)||Qo["Arabic Presentation Forms-B"](e)}function os(e){return e>=1424&&e<=2303||Qo["Arabic Presentation Forms-A"](e)||Qo["Arabic Presentation Forms-B"](e)}function ss(e,t){return!(!t&&os(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Qo.Khmer(e))}function as(e){for(const t of e)if(os(t.charCodeAt(0)))return!0;return!1}const ls={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let cs=null,us=ls.unavailable,hs=null;const ds=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(us=ls.error),cs&&cs(e)};function fs(){ps.fire(new Kt("pluginStateChange",{pluginStatus:us,pluginURL:hs}))}const ps=new en,ms=function(){return us},gs=function(){if(us!==ls.deferred||!hs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");us=ls.loading,fs(),hs&&Ot({url:hs},e=>{e?ds(e):(us=ls.loaded,fs())})},_s={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>us===ls.loaded||null!=_s.applyArabicShaping,isLoading:()=>us===ls.loading,setState(e){us=e.pluginStatus,hs=e.pluginURL},isParsing:()=>us===ls.parsing,isParsed:()=>us===ls.parsed,getPluginURL:()=>hs};class ys{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness,this.worldview=t.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const n of e)if(!ss(n.charCodeAt(0),t))return!1;return!0}(e,_s.isLoaded())}}class vs{constructor(e,t,n,i){this.property=e,this.value=t,this.expression=function(e,t,n,i){if(So(e))return new Uo(e,t);if(ko(e)||Array.isArray(e)&&e.length>0){const r=No(e,t,n,i);if("error"===r.result)throw new Error(r.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));return r.value}{let n=e;return"string"==typeof e&&"color"===t.type&&(n=sn.parse(e)),{kind:"constant",configDependencies:new Set,evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification,n,i)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class xs{constructor(e,t,n){this.property=e,this.value=new vs(e,void 0,t,n)}transitioned(e,t){return new ws(this.property,this.value,t,Le({},e.transition,this.transition),e.now)}untransitioned(){return new ws(this.property,this.value,null,{},0)}}class bs{constructor(e,t,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=n,this.configDependencies=new Set}getValue(e){return Ve(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new xs(this._values[e].property,this._scope,this._options)),this._values[e].value=new vs(this._values[e].property,null===t?void 0:Ve(t),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,t){t&&(this._options=t);const n=this._properties.properties;if(e)for(const i in e){const t=e[i];if(i.endsWith("-transition")){const e=i.slice(0,-11);n[e]&&this.setTransition(e,t)}else n.hasOwnProperty(i)&&this.setValue(i,t)}}getTransition(e){return Ve(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new xs(this._values[e].property)),this._values[e].transition=Ve(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const i=this.getTransition(t);void 0!==i&&(e["".concat(t,"-transition")]=i)}return e}transitioned(e,t){const n=new Es(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new Es(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class ws{constructor(e,t,n,i,r){const o=i.delay||0,s=i.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+o,this.end=this.begin+s,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,r=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return o.possiblyEvaluate(e,t,n);{const s=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),r,De(s))}}return r}}class Es{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new Ss(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ts{constructor(e,t,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=n,this.configDependencies=new Set}getValue(e){return Ve(this._values[e].value)}setValue(e,t){this._values[e]=new vs(this._values[e].property,null===t?void 0:Ve(t),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new Ss(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}}class As{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class Ss{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ds{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const i=dn[this.specification.type];return i?i(e,t,n):e}}class Cs{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new As(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new As(this,{kind:"constant",value:void 0},e.parameters);const i=dn[this.specification.type];return i?new As(this,{kind:"constant",value:i(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,i,r,o){return"constant"===e.kind?e.value:e.evaluate(t,n,i,r,o)}}class Is{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class Rs{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new ys(0,{});for(const n in e){const i=e[n];i.specification.overridable&&this.overridableProperties.push(n);const r=this.defaultPropertyValues[n]=new vs(i,void 0),o=this.defaultTransitionablePropertyValues[n]=new xs(i);this.defaultTransitioningPropertyValues[n]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=r.possiblyEvaluate(t)}}}Xo(Cs,"DataDrivenProperty"),Xo(Ds,"DataConstantProperty"),Xo(Is,"ColorRampProperty");var Ps=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Ms(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Fs(e){if(Array.isArray(e))return e.map(Fs);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Fs(e[n]);return t}return Ms(e)}function Ls(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Ls(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function ks(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ls(e)||(e=js(e));const r=e;let o=!0;try{o=function(e){if(!zs(e))return e;let t=Fs(e);return Bs(t),t=Os(t),t}(r)}catch(e){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(r,null,2),"\n        "))}let s=null,a=null;if("background"!==i&&"sky"!==i&&"slot"!==i){a=Ps["filter_".concat(i)];const e=Oo(o,a,t,n);if("error"===e.result)throw new Error(e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));s=(t,n,i)=>e.value.evaluate(t,n,{},i)}let l=null,c=null;if(o!==r){const e=Oo(r,a,t,n);if("error"===e.result)throw new Error(e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));l=(t,n,i,r,o)=>e.value.evaluate(t,n,{},i,void 0,void 0,r,o),c=!hr(e.value.expression)}return{filter:s,dynamicFilter:l||void 0,needGeometry:Vs(o),needFeature:!!c}}function Os(e){if(!Array.isArray(e))return e;const t=function(e){if(Ns.has(e[0]))for(let t=1;t<e.length;t++)if(zs(e[t]))return!0;return e}(e);return!0===t?t:t.map(e=>Os(e))}function Bs(e){let t=!1;const n=[];if("case"===e[0]){for(let i=1;i<e.length-1;i+=2)t=t||zs(e[i]),n.push(e[i+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||zs(e[1]);for(let t=2;t<e.length-1;t+=2)n.push(e[t+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||zs(e[1]);for(let t=1;t<e.length-1;t+=2)n.push(e[t+1])}t&&(e.length=0,e.push("any",...n));for(let i=1;i<e.length;i++)Bs(e[i])}function zs(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<e.length;n++)if(zs(e[n]))return!0;return!1}const Ns=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Us(e,t){return e<t?-1:e>t?1:0}function Vs(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Vs(e[t]))return!0;return!1}function js(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Gs(e[1],e[2],"=="):"!="===t?qs(Gs(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Gs(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(js))):"all"===t?["all"].concat(e.slice(1).map(js)):"none"===t?["all"].concat(e.slice(1).map(js).map(qs)):"in"===t?Hs(e[1],e.slice(2)):"!in"===t?qs(Hs(e[1],e.slice(2))):"has"===t?Ws(e[1]):"!has"!==t||qs(Ws(e[1]));var n}function Gs(e,t,n){switch(e){case"$type":return["filter-type-".concat(n),t];case"$id":return["filter-id-".concat(n),t];default:return["filter-".concat(n),e,t]}}function Hs(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Us)]]:["filter-in-small",e,["literal",t]]}}function Ws(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function qs(e){return["!",e]}const Xs="\x1f";function Zs(e,t){return t?"".concat(e).concat(Xs).concat(t):e}const Ys="-transition",Ks=new Set(["fill","line","background","hillshade","raster"]);class Js extends en{constructor(e,t,n,i,r){if(super(),this.id=e.id,this.fqid=Zs(this.id,n),this.type=e.type,this.scope=n,this.lut=i,this.options=r,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==e.type){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const t=Oo(this.filter,Ps["filter_".concat(e.type)]);"error"!==t.result&&(this.configDependencies=new Set([...this.configDependencies,...t.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new Ts(t.layout,this.scope,r),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),t.paint){this._transitionablePaint=new bs(t.paint,this.scope,r);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ss(t.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Ks.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const n=this._unevaluatedLayout;n._properties.properties[e]&&(n.setValue(e,t),this.configDependencies=new Set([...this.configDependencies,...n.configDependencies]),"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Ys)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){const n=this._transitionablePaint,i=n._properties.properties;if(e.endsWith(Ys)){const r=e.slice(0,-11);return i[r]&&n.setTransition(r,t||void 0),!1}if(!i[e])return!1;const r=n._values[e],o=r.value.isDataDriven(),s=r.value;n.setValue(e,t),this.configDependencies=new Set([...this.configDependencies,...n.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const a=n._values[e].value,l=a.isDataDriven(),c=e.endsWith("pattern")||"line-dasharray"===e;return l||o||c||this._handleOverridablePaintPropertyUpdate(e,s,a)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t,n){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return Ue({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof As&&wo(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=ks(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,t,n,i,r,o,s,a,l){}}const Qs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $s{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ea{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&t.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ta(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,i=0;return{members:e.map(e=>{const r=Qs[e.type].BYTES_PER_ELEMENT,o=n=na(n,Math.max(t,r)),s=e.components||1;return i=Math.max(i,r),n+=r*s,{name:e.name,type:e.type,components:s,offset:o}}),size:na(n,Math.max(i,t)),alignment:t}}function na(e,t){return Math.ceil(e/t)*t}class ia extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}ia.prototype.bytesPerElement=4,Xo(ia,"StructArrayLayout2i4");class ra extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}ra.prototype.bytesPerElement=6,Xo(ra,"StructArrayLayout3i6");class oa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=r,e}}oa.prototype.bytesPerElement=8,Xo(oa,"StructArrayLayout4i8");class sa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}sa.prototype.bytesPerElement=4,Xo(sa,"StructArrayLayout1f4");class aa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=4*e,o=2*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.float32[o+1]=i,e}}aa.prototype.bytesPerElement=8,Xo(aa,"StructArrayLayout2i1f8");class la extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=4*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}la.prototype.bytesPerElement=8,Xo(la,"StructArrayLayout3i8");class ca extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=5*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=o,e}}ca.prototype.bytesPerElement=10,Xo(ca,"StructArrayLayout5i10");class ua extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[c+4]=i,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}ua.prototype.bytesPerElement=12,Xo(ua,"StructArrayLayout2i4ub1f12");class ha extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}ha.prototype.bytesPerElement=12,Xo(ha,"StructArrayLayout3f12");class da extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=6*e,a=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=n,this.uint16[s+2]=i,this.uint16[s+3]=r,this.float32[a+2]=o,e}}da.prototype.bytesPerElement=12,Xo(da,"StructArrayLayout4ui1f12");class fa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=n,this.uint16[o+2]=i,this.uint16[o+3]=r,e}}fa.prototype.bytesPerElement=8,Xo(fa,"StructArrayLayout4ui8");class pa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,e}}pa.prototype.bytesPerElement=12,Xo(pa,"StructArrayLayout6i12");class ma extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,i,r,o,s,a,l,c,u,h)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d){const f=12*e;return this.int16[f+0]=t,this.int16[f+1]=n,this.int16[f+2]=i,this.int16[f+3]=r,this.uint16[f+4]=o,this.uint16[f+5]=s,this.uint16[f+6]=a,this.uint16[f+7]=l,this.int16[f+8]=c,this.int16[f+9]=u,this.int16[f+10]=h,this.int16[f+11]=d,e}}ma.prototype.bytesPerElement=24,Xo(ma,"StructArrayLayout4i4ui4i24");class ga extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.float32[l+2]=r,this.float32[l+3]=o,this.float32[l+4]=s,e}}ga.prototype.bytesPerElement=20,Xo(ga,"StructArrayLayout3i3f20");class _a extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,e}}_a.prototype.bytesPerElement=16,Xo(_a,"StructArrayLayout4f16");class ya extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}ya.prototype.bytesPerElement=4,Xo(ya,"StructArrayLayout1ul4");class va extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}va.prototype.bytesPerElement=4,Xo(va,"StructArrayLayout2ui4");class xa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,i,r,o,s,a,l,c,u,h,d)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,f){const p=20*e,m=10*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.int16[p+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[p+14]=u,this.uint32[m+8]=h,this.uint16[p+18]=d,this.uint16[p+19]=f,e}}xa.prototype.bytesPerElement=40,Xo(xa,"StructArrayLayout5i4f1i1ul2ui40");class ba extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+4]=r,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}ba.prototype.bytesPerElement=16,Xo(ba,"StructArrayLayout3i2i2i16");class wa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.int16[a+6]=r,this.int16[a+7]=o,e}}wa.prototype.bytesPerElement=16,Xo(wa,"StructArrayLayout2f1f2i16");class Ea extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=20*e,l=5*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[l+1]=i,this.float32[l+2]=r,this.float32[l+3]=o,this.float32[l+4]=s,e}}Ea.prototype.bytesPerElement=20,Xo(Ea,"StructArrayLayout2ub4f20");class Ta extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,this.uint16[r+2]=i,e}}Ta.prototype.bytesPerElement=6,Xo(Ta,"StructArrayLayout3ui6");class Aa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b){const w=30*e,E=15*e,T=60*e;return this.int16[w+0]=t,this.int16[w+1]=n,this.int16[w+2]=i,this.float32[E+2]=r,this.float32[E+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[E+5]=l,this.uint32[E+6]=c,this.uint32[E+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=f,this.float32[E+10]=p,this.float32[E+11]=m,this.uint8[T+48]=g,this.uint8[T+49]=_,this.uint8[T+50]=y,this.uint32[E+13]=v,this.int16[w+28]=x,this.uint8[T+58]=b,e}}Aa.prototype.bytesPerElement=60,Xo(Aa,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,E,T,A,S,D,C,I,R,P,M){const F=this.length;return this.resize(F+1),this.emplace(F,e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,E,T,A,S,D,C,I,R,P,M)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,E,T,A,S,D,C,I,R,P,M,F){const L=20*e,k=40*e,O=80*e;return this.float32[L+0]=t,this.float32[L+1]=n,this.int16[k+4]=i,this.int16[k+5]=r,this.int16[k+6]=o,this.int16[k+7]=s,this.int16[k+8]=a,this.int16[k+9]=l,this.int16[k+10]=c,this.int16[k+11]=u,this.int16[k+12]=h,this.uint16[k+13]=d,this.uint16[k+14]=f,this.uint16[k+15]=p,this.uint16[k+16]=m,this.uint16[k+17]=g,this.uint16[k+18]=_,this.uint16[k+19]=y,this.uint16[k+20]=v,this.uint16[k+21]=x,this.uint16[k+22]=b,this.uint16[k+23]=w,this.uint16[k+24]=E,this.uint16[k+25]=T,this.uint16[k+26]=A,this.uint16[k+27]=S,this.uint32[L+14]=D,this.float32[L+15]=C,this.float32[L+16]=I,this.float32[L+17]=R,this.float32[L+18]=P,this.uint8[O+76]=M,this.uint16[k+39]=F,e}}Sa.prototype.bytesPerElement=80,Xo(Sa,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Da extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=6*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=r,this.float32[a+4]=o,this.float32[a+5]=s,e}}Da.prototype.bytesPerElement=24,Xo(Da,"StructArrayLayout6f24");class Ca extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.float32[s+3]=r,this.float32[s+4]=o,e}}Ca.prototype.bytesPerElement=20,Xo(Ca,"StructArrayLayout5f20");class Ia extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=n,this.float32[l+2]=i,this.float32[l+3]=r,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,e}}Ia.prototype.bytesPerElement=28,Xo(Ia,"StructArrayLayout7f28");class Ra extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,n,i,r,o,s,a,l,c,u)}emplace(e,t,n,i,r,o,s,a,l,c,u,h){const d=11*e;return this.float32[d+0]=t,this.float32[d+1]=n,this.float32[d+2]=i,this.float32[d+3]=r,this.float32[d+4]=o,this.float32[d+5]=s,this.float32[d+6]=a,this.float32[d+7]=l,this.float32[d+8]=c,this.float32[d+9]=u,this.float32[d+10]=h,e}}Ra.prototype.bytesPerElement=44,Xo(Ra,"StructArrayLayout11f44");class Pa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,i,r,o,s,a,l)}emplace(e,t,n,i,r,o,s,a,l,c){const u=9*e;return this.float32[u+0]=t,this.float32[u+1]=n,this.float32[u+2]=i,this.float32[u+3]=r,this.float32[u+4]=o,this.float32[u+5]=s,this.float32[u+6]=a,this.float32[u+7]=l,this.float32[u+8]=c,e}}Pa.prototype.bytesPerElement=36,Xo(Pa,"StructArrayLayout9f36");class Ma extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}Ma.prototype.bytesPerElement=8,Xo(Ma,"StructArrayLayout2f8");class Fa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=n,this.uint16[o+3]=i,this.uint16[o+4]=r,e}}Fa.prototype.bytesPerElement=12,Xo(Fa,"StructArrayLayout1ul3ui12");class La extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}La.prototype.bytesPerElement=2,Xo(La,"StructArrayLayout1ui2");class ka extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g){const _=16*e;return this.float32[_+0]=t,this.float32[_+1]=n,this.float32[_+2]=i,this.float32[_+3]=r,this.float32[_+4]=o,this.float32[_+5]=s,this.float32[_+6]=a,this.float32[_+7]=l,this.float32[_+8]=c,this.float32[_+9]=u,this.float32[_+10]=h,this.float32[_+11]=d,this.float32[_+12]=f,this.float32[_+13]=p,this.float32[_+14]=m,this.float32[_+15]=g,e}}ka.prototype.bytesPerElement=64,Xo(ka,"StructArrayLayout16f64");class Oa extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=n,this.uint16[l+2]=i,this.uint16[l+3]=r,this.float32[c+2]=o,this.float32[c+3]=s,this.float32[c+4]=a,e}}Oa.prototype.bytesPerElement=20,Xo(Oa,"StructArrayLayout4ui3f20");class Ba extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.int16[1*e+0]=t,e}}Ba.prototype.bytesPerElement=2,Xo(Ba,"StructArrayLayout1i2");class za extends ea{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}za.prototype.bytesPerElement=1,Xo(za,"StructArrayLayout1ub1");class Na extends $s{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Na.prototype.size=40;class Ua extends xa{get(e){return new Na(this,e)}}Xo(Ua,"CollisionBoxArray");class Va extends $s{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Va.prototype.size=60;class ja extends Aa{get(e){return new Va(this,e)}}Xo(ja,"PlacedSymbolArray");class Ga extends $s{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Ga.prototype.size=80;class Ha extends Sa{get(e){return new Ga(this,e)}}Xo(Ha,"SymbolInstanceArray");class Wa extends sa{getoffsetX(e){return this.float32[1*e+0]}}Xo(Wa,"GlyphOffsetArray");class qa extends ia{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Xo(qa,"SymbolLineVertexArray");class Xa extends $s{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Xa.prototype.size=12;class Za extends Fa{get(e){return new Xa(this,e)}}Xo(Za,"FeatureIndexArray");class Ya extends va{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Xo(Ya,"FillExtrusionCentroidArray");class Ka extends $s{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Ka.prototype.size=6;class Ja extends ra{get(e){return new Ka(this,e)}}Xo(Ja,"FillExtrusionWallArray");const Qa=ta([{name:"a_pos",components:2,type:"Int16"}],4),$a=ta([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),el=ta([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class tl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,n,i){let r=this.segments[this.segments.length-1];return e>tl.MAX_VERTEX_ARRAY_LENGTH&&He("Max vertices per segment is ".concat(tl.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(e)),(!r||r.vertexLength+e>tl.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:t,primitiveOffset:n,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}prepareSegment(e,t,n,i){return this._prepareSegment(e,t.length,n.length,i)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new tl([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function nl(e,t){return 256*(e=Re(Math.floor(e),0,255))+Re(Math.floor(t),0,255)}tl.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xo(tl,"SegmentVector");const il=ta([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),rl=ta([{name:"a_pattern_b",components:4,type:"Uint16"}]),ol=ta([{name:"a_dash",components:4,type:"Uint16"}]);class sl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(al(e)),this.positions.push(t,n,i)}eachPosition(e,t){const n=al(e);let i=0,r=this.ids.length-1;for(;i<r;){const e=i+r>>1;this.ids[e]>=n?r=e:i=e+1}for(;this.ids[i]===n;)t(this.positions[3*i],this.positions[3*i+1],this.positions[3*i+2]),i++}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return ll(n,i,0,n.length-1),t&&(t.add(n.buffer),t.add(i.buffer)),{ids:n,positions:i}}static deserialize(e){const t=new sl;let n;t.ids=e.ids,t.positions=e.positions;for(const i of t.ids)i!==n&&t.uniqueIds.push(i),n=i;return t.indexed=!0,t}}function al(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Yt(String(e))}function ll(e,t,n,i){for(;n<i;){const r=e[n+i>>1];let o=n-1,s=i+1;for(;;){do{o++}while(e[o]<r);do{s--}while(e[s]>r);if(o>=s)break;cl(e,o,s),cl(t,3*o,3*s),cl(t,3*o+1,3*s+1),cl(t,3*o+2,3*s+2)}s-n<i-s?(ll(e,t,n,s),n=s+1):(ll(e,t,s+1,i),i=s)}}function cl(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}Xo(sl,"FeaturePositionMap");class ul{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}set(e,t,n){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class hl extends ul{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class dl extends ul{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class fl extends ul{constructor(e){super(e),this.current=[0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class pl extends ul{constructor(e){super(e),this.current=[0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class ml extends ul{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class gl extends ul{constructor(e){super(e),this.current=sn.transparent.toPremultipliedRenderColor(null)}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const _l=new Float32Array(16);class yl extends ul{constructor(e){super(e),this.current=_l}set(e,t,n){if(this.fetchUniformLocation(e,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const vl=new Float32Array(9),xl=new Float32Array(4);class bl extends ul{constructor(e){super(e),this.current=xl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let i=0;i<4;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}function wl(e){return[nl(255*e.r,255*e.g),nl(255*e.b,255*e.a)]}class El{constructor(e,t,n,i){this.value=e,this.uniformNames=t.map(e=>"u_".concat(e)),this.type=n,this.context=i}setUniform(e,t,n,i,r){const o=i.constantOr(this.value);t.set(e,r,o instanceof sn?o.toPremultipliedRenderColor(this.lutExpression&&"none"===this.lutExpression.value?null:this.context.lut):o)}getBinding(e,t){return"color"===this.type?new gl(e):new dl(e)}}class Tl{constructor(e,t){this.uniformNames=t.map(e=>"u_".concat(e)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,t){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=t?t.tl.concat(t.br):this.pattern}setUniform(e,t,n,i,r){let o=null;"u_pattern"!==r&&"u_dash"!==r||(o=this.pattern),"u_pattern_b"===r&&(o=this.patternTransition),"u_pixel_ratio"===r&&(o=this.pixelRatio),o&&t.set(e,r,o)}getBinding(e,t){return"u_pattern"===t||"u_pattern_b"===t||"u_dash"===t?new ml(e):new dl(e)}}class Al{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,r,o,s,a){const l=this.paintVertexArray.length,c="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new ys(0,{brightness:o,worldview:a}),t,{},r,i,s):"constant"===this.expression.kind&&this.expression.value,u=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new ys(0,{brightness:o,worldview:a}),t,{},r,i,s):this.lutExpression.value);this.paintVertexArray.resize(e),this._setPaintValue(l,e,c,u?null:this.context.lut)}updatePaintArray(e,t,n,i,r,o,s,a){const l="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:s,worldview:a},n,i,void 0,r):"constant"===this.expression.kind&&this.expression.value,c=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new ys(0,{brightness:s,worldview:a}),n,i,void 0,r):this.lutExpression.value);this._setPaintValue(e,t,l,c?null:this.context.lut)}_setPaintValue(e,t,n,i){if("color"===this.type){const r=wl(n.toPremultipliedRenderColor(i));for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sl{constructor(e,t,n,i,r,o){this.expression=e,this.uniformNames=t.map(e=>"u_".concat(e,"_t")),this.type=n,this.useIntegerZoom=i,this.context=r,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,t,n,i,r,o,s,a){const l=this.expression.evaluate(new ys(this.context.zoom,{brightness:o,worldview:a}),t,{},r,i,s),c=this.expression.evaluate(new ys(this.context.zoom+1,{brightness:o,worldview:a}),t,{},r,i,s),u=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new ys(0,{brightness:o,worldview:a}),t,{},r,i,s):this.lutExpression.value),h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(h,e,l,c,u?null:this.context.lut)}updatePaintArray(e,t,n,i,r,o,s,a){const l=this.expression.evaluate({zoom:this.context.zoom,brightness:s,worldview:a},n,i,void 0,r),c=this.expression.evaluate({zoom:this.context.zoom+1,brightness:s,worldview:a},n,i,void 0,r),u=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new ys(0,{brightness:s,worldview:a}),n,i,void 0,r):this.lutExpression.value);this._setPaintValue(e,t,l,c,u?null:this.context.lut)}_setPaintValue(e,t,n,i,r){if("color"===this.type){const i=wl(n.toPremultipliedRenderColor(r)),o=wl(n.toPremultipliedRenderColor(r));for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1],o[0],o[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,i,r){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,s=Re(this.expression.interpolationFactor(o,this.context.zoom,this.context.zoom+1),0,1);t.set(e,r,s)}getBinding(e,t){return new dl(e)}}class Dl{constructor(e,t,n,i,r){this.expression=e,this.layerId=r,this.paintVertexAttributes=("array"===n?ol:il).members;for(let o=0;o<t.length;++o);this.paintVertexArray=new i,this.paintTransitionVertexArray=new fa}populatePaintArray(e,t,n,i){const r=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,r,o,s){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],o)}_setPaintValues(e,t,n,i){if(!i||!n)return;const r=i[n[0]],o=i[n[1]];if(r){if(r){const{tl:n,br:i,pixelRatio:o}=r;for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n[0],n[1],i[0],i[1],o)}if(o){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:n,br:i}=o;for(let r=e;r<t;r++)this.paintTransitionVertexArray.emplace(r,n[0],n[1],i[0],i[1])}}}upload(e){const t=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,t)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,rl.members,t))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Cl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[],this.context=t;const i=[];for(const r in e.paint._values){const o=e.paint.get(r);if(r.endsWith("-use-theme"))continue;if(!n(r))continue;if(!(o instanceof As&&wo(o.property.specification)))continue;const s=Pl(r,e.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===r||r.endsWith("pattern"),h=e.paint.get("".concat(r,"-use-theme")),d="line-dasharray"===r&&"constant"!==e.layout.get("line-cap").value.kind||h&&"constant"!==h.value.kind;if("constant"!==a.kind||d)if("source"===a.kind||d||u){const t=Ll(r,l,"source");this.binders[r]=u?new Dl(a,s,l,t,e.id):new Al(a,s,l,t),i.push("/a_".concat(r))}else{const e=Ll(r,l,"composite");this.binders[r]=new Sl(a,s,l,c,t,e),i.push("/z_".concat(r))}else this.binders[r]=u?new Tl(a.value,s):new El(a.value,s,l,t),i.push("/u_".concat(r));h&&(this.binders[r].lutExpression=h.value)}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Al||t instanceof Sl?t.maxValue:0}populatePaintArrays(e,t,n,i,r,o,s,a){for(const l in this.binders){const c=this.binders[l];c.context=this.context,(c instanceof Al||c instanceof Sl||c instanceof Dl)&&c.populatePaintArray(e,t,n,i,r,o,s,a)}}setConstantPatternPositions(e,t){for(const n in this.binders){const i=this.binders[n];i instanceof Tl&&i.setConstantPatternPositions(e,t)}}getPatternTransitionVertexBuffer(e){const t=this.binders[e];return t instanceof Dl?t.paintTransitionVertexBuffer:null}updatePaintArrays(e,t,n,i,r,o,s,a,l,c){let u=!1;const h=Object.keys(e),d=0!==h.length&&!a,f=d?h:t.uniqueIds;this.context.lut=r.lut;for(const p in this.binders){const a=this.binders[p];if(a.context=this.context,(a instanceof Al||a instanceof Sl||a instanceof Dl)&&a.expression&&a.expression.kind&&"constant"!==a.expression.kind&&(!0===a.expression.isStateDependent||!1===a.expression.isLightConstant)){const h=r.paint.get(p);a.expression=h.value;for(const n of f){const r=e[n.toString()];t.eachPosition(n,(e,t,n)=>{const u=i.feature(e);a.updatePaintArray(t,n,u,r,o,s,l,c)})}if(!d)for(const t of n.uniqueIds){const r=e[t.toString()];n.eachPosition(t,(e,t,n)=>{const u=i.feature(e);a.updatePaintArray(t,n,u,r,o,s,l,c)})}u=!0}}return u}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof El||n instanceof Tl)&&e.push(...n.uniformNames.map(e=>"#define HAS_UNIFORM_".concat(e)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Al||n instanceof Sl||n instanceof Dl)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name);if(n instanceof Dl)for(let t=0;t<rl.members.length;t++)e.push(rl.members[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof El||n instanceof Tl||n instanceof Sl)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof El||i instanceof Tl||i instanceof Sl)for(const r of i.uniformNames)t.push({name:r,property:n,binding:i.getBinding(e,r)})}return t}setUniforms(e,t,n,i,r){for(const{name:o,property:s,binding:a}of n)this.binders[s].setUniform(e,a,r,i.get(s),o)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Al||t instanceof Sl||t instanceof Dl)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer),t instanceof Dl&&t.paintTransitionVertexBuffer&&this._buffers.push(t.paintTransitionVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Al||n instanceof Sl||n instanceof Dl)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Al||t instanceof Sl||t instanceof Dl)&&t.destroy()}}}class Il{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new Cl(i,t,n);this.needsUpload=!1,this._featureMap=new sl,this._featureMapWithoutIds=new sl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,n,i,r,o,s,a,l){for(const c in this.programConfigurations)this.programConfigurations[c].populatePaintArrays(e,t,i,r,o,s,a,l);void 0!==t.id?this._featureMap.add(t.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i,r,o,s,a){for(const l of n)this.needsUpload=this.programConfigurations[l.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,l,i,r,o,s||0,a)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Rl={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Pl(e,t){return Rl[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}const Ml={"line-pattern":{source:da,composite:da},"fill-pattern":{source:da,composite:da},"fill-extrusion-pattern":{source:da,composite:da},"line-dasharray":{source:fa,composite:fa}},Fl={color:{source:Ma,composite:_a},number:{source:sa,composite:Ma}};function Ll(e,t,n){const i=Ml[e];return i&&i[n]||Fl[t][n]}Xo(El,"ConstantBinder"),Xo(Tl,"PatternConstantBinder"),Xo(Al,"SourceExpressionBinder"),Xo(Dl,"PatternCompositeBinder"),Xo(Sl,"CompositeExpressionBinder"),Xo(Cl,"ProgramConfiguration",{omit:["_buffers"]}),Xo(Il,"ProgramConfigurationSet");const kl=Li/Math.PI/2,Ol=5,Bl=6,zl=16383,Nl=64,Ul=[Nl,32,16],Vl=-kl,jl=kl;function Gl(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:kl;return n=Te(n),[e*Math.sin(n)*i,-t*i,e*Math.cos(n)*i]}function Hl(e,t,n){return Gl(Math.cos(Te(e)),Math.sin(Te(e)),t,n)}const Wl=6371008.8,ql=2*Math.PI*Wl;class Xl{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(t,")"));if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xl(Me(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Wl*Math.acos(Math.min(r,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new Zl({lng:this.lng-t,lat:this.lat-e},{lng:this.lng+t,lat:this.lat+e})}toEcef(e){return Hl(this.lat,this.lng,kl+e*kl/Wl)}static convert(e){if(e instanceof Xl)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Xl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Xl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Zl{constructor(e,t){if(e)if(t)this.setSouthWest(e).setNorthEast(t);else if(4===e.length){const t=e;this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]])}else{const t=e;this.setSouthWest(t[0]).setNorthEast(t[1])}}setNorthEast(e){return this._ne=e instanceof Xl?new Xl(e.lng,e.lat):Xl.convert(e),this}setSouthWest(e){return this._sw=e instanceof Xl?new Xl(e.lng,e.lat):Xl.convert(e),this}extend(e){const t=this._sw,n=this._ne;let i,r;if(e instanceof Xl)i=e,r=e;else{if(!(e instanceof Zl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Zl.convert(e)):this.extend(Xl.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Xl.convert(e)):this;if(i=e._sw,r=e._ne,!i||!r)return this}return t||n?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Xl(i.lng,i.lat),this._ne=new Xl(r.lng,r.lat)),this}getCenter(){return new Xl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xl(this.getWest(),this.getNorth())}getSouthEast(){return new Xl(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=Xl.convert(e);let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(e){if(e)return e instanceof Zl?e:new Zl(e)}}const Yl=0,Kl=25.5;function Jl(e){return ql*Math.cos(e*Math.PI/180)}function Ql(e){return(180+e)/360}function $l(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ec(e,t){return e/Jl(t)}function tc(e){return 360*e-180}function nc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function ic(e,t){return e*Jl(nc(t))}const rc=85.051129;function oc(e){return Math.cos(Te(Re(e,-rc,rc)))}function sc(e,t){const n=Re(t,Yl,Kl),i=Math.pow(2,n);return oc(e)*ql/(512*i)}function ac(e){return 1/Math.cos(e*Math.PI/180)}function lc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Math.exp(Math.PI*(1-(e.y+t/Li)/(1<<e.z)*2));return 80150034*n/(n*n+1)/Li/(1<<e.z)}class cc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Xl.convert(e);return new cc(Ql(n.lng),$l(n.lat),ec(t,n.lat))}toLngLat(){return new Xl(tc(this.x),nc(this.y))}toAltitude(){return ic(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ql*ac(nc(this.y))}}function uc(e,t,n,i,r,o,s,a,l){const c=(t+i)/2,u=(n+r)/2,h=new xe(c,u);a(h),function(e,t,n,i,r,o){const s=n-r,a=i-o;return Math.abs((i-t)*s-(n-e)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(uc(e,t,n,c,u,o,h,a,l),uc(e,c,u,i,r,h,s,a,l)):e.push(s)}function hc(e,t,n){let i=e[0],r=i.x,o=i.y;t(i);const s=[i];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),uc(s,r,o,c,u,i,l,t,n),r=c,o=u,i=l}return s}function dc(e,t,n,i){if(i(t,n)){const r=t.add(n)._mult(.5);dc(e,t,r,i),dc(e,r,n,i)}else e.push(n)}function fc(e,t){let n=e[0];const i=[n];for(let r=1;r<e.length;r++){const o=e[r];dc(i,n,o,t),n=o}return i}const pc=Math.pow(2,14)-1,mc=-pc-1;function gc(e,t){const n=Math.round(e.x*t),i=Math.round(e.y*t);return e.x=Re(n,mc,pc),e.y=Re(i,mc,pc),(n<e.x||n>e.x+1||i<e.y||i>e.y+1)&&He("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function _c(e,t,n){const i=e.loadGeometry(),r=e.extent,o=Li/r;if(t&&n&&n.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:s,x:a,y:l,projection:c}=n,u=e=>{const n=tc((t.x+e.x/r)/o),i=nc((t.y+e.y/r)/o),u=c.project(n,i);e.x=(u.x*s-a)*r,e.y=(u.y*s-l)*r};for(let t=0;t<i.length;t++)if(1!==e.type)i[t]=hc(i[t],u,1);else{const e=[];for(const n of i[t])n.x<0||n.x>=r||n.y<0||n.y>=r||(u(n),e.push(n));i[t]=e}}for(const s of i)for(const e of s)gc(e,o);return i}function yc(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?_c(e):[]}}class vc{constructor(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields(xc,this,t)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos,n=[];let i,r=1,o=0,s=0,a=0;for(;e.pos<t;){if(o<=0){const t=e.readVarint();r=7&t,o=t>>3}if(o--,1===r||2===r)s+=e.readSVarint(),a+=e.readSVarint(),1===r&&(i&&n.push(i),i=[]),i&&i.push(new xe(s,a));else{if(7!==r)throw new Error("unknown command ".concat(r));i&&i.push(i[0].clone())}}return i&&n.push(i),n}bbox(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let n=1,i=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;for(;e.pos<t;){if(i<=0){const t=e.readVarint();n=7&t,i=t>>3}if(i--,1===n||2===n)r+=e.readSVarint(),o+=e.readSVarint(),r<s&&(s=r),r>a&&(a=r),o<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command ".concat(n))}return[s,l,a,c]}toGeoJSON(e,t,n){const i=this.extent*Math.pow(2,n),r=this.extent*e,o=this.extent*t,s=this.loadGeometry();function a(e){return[360*(e.x+r)/i-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/i)*Math.PI))-90]}function l(e){return e.map(a)}let c;if(1===this.type){const e=[];for(const n of s)e.push(n[0]);const t=l(e);c=1===e.length?{type:"Point",coordinates:t[0]}:{type:"MultiPoint",coordinates:t}}else if(2===this.type){const e=s.map(l);c=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}}else{if(3!==this.type)throw new Error("unknown feature type");{const e=function(e){const t=e.length;if(t<=1)return[e];const n=[];let i,r;for(let o=0;o<t;o++){const t=bc(e[o]);0!==t&&(void 0===r&&(r=t<0),r===t<0?(i&&n.push(i),i=[e[o]]):i&&i.push(e[o]))}return i&&n.push(i),n}(s),t=[];for(const n of e)t.push(n.map(l));c=1===t.length?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t}}}const u={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(u.id=this.id),u}}function xc(e,t,n){1===e?t.id=n.readVarint():2===e?function(e,t){const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}(n,t):3===e?t.type=n.readVarint():4===e&&(t._geometry=n.pos)}function bc(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}vc.types=["Unknown","Point","LineString","Polygon"];class wc{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Ec,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new vc(this._pbf,t,this.extent,this._keys,this._values)}}function Ec(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){let t=null;const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}if(null==t)throw new Error("unknown feature value");return t}(n))}class Tc{constructor(e,t){this.layers=e.readFields(Ac,{},t)}}function Ac(e,t,n){if(3===e){const e=new wc(n,n.readVarint()+n.pos);e.length&&(t[e.name]=e)}}const Sc="3d_elevation_id",Dc="level";class Cc{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(e,t){return this._valid&&e(t(this._geometry)),this}require(e,t,n){return this.get(e,!0,t,n)}optional(e,t,n){return this.get(e,!1,t,n)}success(){return this._valid}get(e,t,n,i){const r=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&void 0!==r&&!Number.isNaN(r)?n(i?i(r):r):t&&(this._valid=!1),this}}class Ic{constructor(e,t){this.featureFunc=e,this.vertexFunc=t}parseFeature(e,t,n){return this.featureFunc(e,t,n)}parseVertex(e,t,n){return this.vertexFunc(e,t,n)}}const Rc=new Ic((e,t,n)=>e.reset(t).require(Sc,e=>{n.id=e}).optional("fixed_height_relative",e=>{n.constantHeight=e},Mc.decodeRelativeHeight).geometry(e=>{n.bounds=e},di).success(),(e,t,n)=>e.reset(t).require(Sc,e=>{n.id=e}).require("elevation_idx",e=>{n.idx=e}).require("extent",e=>{n.extent=e}).require("height_relative",e=>{n.height=e},Mc.decodeRelativeHeight).geometry(e=>{n.position=e},Mc.getPoint).success()),Pc=new Ic((e,t,n)=>e.reset(t).require(Sc,e=>{n.id=e}).optional("fixed_height",e=>{n.constantHeight=e},Mc.decodeMetricHeight).geometry(e=>{n.bounds=e},di).success(),(e,t,n)=>e.reset(t).require(Sc,e=>{n.id=e}).require("elevation_idx",e=>{n.idx=e}).require("extent",e=>{n.extent=e}).require("height",e=>{n.height=e},Mc.decodeMetricHeight).geometry(e=>{n.position=e},Mc.getPoint).success());class Mc{static getPoint(e){return ae(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const t=[],n=[],i=e.length,r=new Cc;for(let s=0;s<i;s++){const i=e.feature(s),a=i.properties.version,l=(o=a)?"1.0.1"===o?Pc:void 0:Rc;if(void 0===l){He("Unknown elevation feature version number ".concat(a||"(unknown)"));continue}const c=i.properties.hasOwnProperty("type")?i.properties.type:void 0;if(c)if("Point"===vc.types[i.type]&&"curve_point"===c){const e={};l.parseVertex(r,i,e)&&t.push(e)}else if("Polygon"===vc.types[i.type]&&"curve_meta"===c){const e={};l.parseFeature(r,i,e)&&n.push(e)}}var o;return{vertices:t,features:n}}}class Fc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const i=fe(t,this.dir);if(Math.abs(i)<1e-6)return!1;const r=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1])/i;return n[0]=this.pos[0]+this.dir[0]*r,n[1]=this.pos[1]+this.dir[1]*r,!0}}class Lc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const i=O(t,this.dir);if(Math.abs(i)<1e-6)return!1;const r=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/i;return n[0]=this.pos[0]+this.dir[0]*r,n[1]=this.pos[1]+this.dir[1]*r,n[2]=this.pos[2]+this.dir[2]*r,!0}closestPointOnSphere(e,n,i){if(function(e,n){var i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],l=n[2];return Math.abs(i-s)<=t*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=t*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(o-l)<=t*Math.max(1,Math.abs(o),Math.abs(l))}(this.pos,e)||0===n)return i[0]=i[1]=i[2]=0,!1;const[r,o,s]=this.dir,a=this.pos[0]-e[0],l=this.pos[1]-e[1],c=this.pos[2]-e[2],u=r*r+o*o+s*s,h=2*(a*r+l*o+c*s),d=h*h-4*u*(a*a+l*l+c*c-n*n);if(d<0){const e=Math.max(-h/2,0),t=a+r*e,u=l+o*e,d=c+s*e,f=Math.hypot(t,u,d);return i[0]=t*n/f,i[1]=u*n/f,i[2]=d*n/f,!1}{const e=(-h-Math.sqrt(d))/(2*u);if(e<0){const e=Math.hypot(a,l,c);return i[0]=a*n/e,i[1]=l*n/e,i[2]=c*n/e,!1}return i[0]=a+r*e,i[1]=l+o*e,i[2]=c+s*e,!0}}}class kc{constructor(e,t,n,i,r){this.TL=e,this.TR=t,this.BR=n,this.BL=i,this.horizon=r}static fromInvProjectionMatrix(e,t,n){const i=[-1,1,1],r=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=N(i,i,e),l=N(r,r,e),c=N(o,o,e),u=N(s,s,e);return new kc(a,l,c,u,t/n)}}function Oc(e,t,n){let i=1/0,r=-1/0;const o=[];for(const s of e){H(o,s,t);const e=O(o,n);i=Math.min(i,e),r=Math.max(r,e)}return[i,r]}function Bc(e,t){let n=!0;for(let i=0;i<e.planes.length;i++){const r=e.planes[i];let o=0;for(let e=0;e<t.length;e++)o+=O(r,t[e])+r[3]>=0;if(0===o)return 0;o!==t.length&&(n=!1)}return n?2:1}function zc(e,t){for(const n of e.projections){const i=Oc(t,e.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function Nc(e,t){let n=0;const i=[0,0,0,0];for(let s=0;s<e.length;s++)i[0]=e[s][0],i[1]=e[s][1],i[2]=e[s][2],i[3]=1,(r=i)[0]*(o=t)[0]+r[1]*o[1]+r[2]*o[2]+r[3]*o[3]>=0&&n++;var r,o;return n}class Uc{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=Vc.fromPoints(this.points),this.projections=[],this.frustumEdges=[H([],this.points[2],this.points[3]),H([],this.points[0],this.points[3]),H([],this.points[4],this.points[0]),H([],this.points[5],this.points[1]),H([],this.points[6],this.points[2]),H([],this.points[7],this.points[3])];for(const n of this.frustumEdges){const e=[0,-n[2],n[1]],t=[n[2],0,-n[0]];this.projections.push({axis:e,projection:Oc(this.points,this.points[0],e)}),this.projections.push({axis:t,projection:Oc(this.points,this.points[0],t)})}}static fromInvProjectionMatrix(e,t,n,i){const r=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(n=>{const o=K([],n,e),s=1/o[3]/t*r;return(a=o)[0]=(l=o)[0]*(c=[s,s,i?1/o[3]:s,s])[0],a[1]=l[1]*c[1],a[2]=l[2]*c[2],a[3]=l[3]*c[3],a;var a,l,c}),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{const t=k([],B([],H([],o[e[0]],o[e[1]]),H([],o[e[2]],o[e[1]]))),n=-O(t,o[e[1]]);return t.concat(n)}),a=[];for(let l=0;l<o.length;l++)a.push([o[l][0],o[l][1],o[l][2]]);return new Uc(a,s)}intersectsPrecise(e,t,n){for(let i=0;i<t.length;i++)if(!Nc(e,t[i]))return 0;for(let i=0;i<this.planes.length;i++)if(!Nc(e,this.planes[i]))return 0;for(const i of n)for(const t of this.frustumEdges){const n=B([],i,t),r=w(n);if(0===r)continue;R(n,n,1/r);const o=Oc(this.points,this.points[0],n),s=Oc(e,this.points[0],n);if(o[0]>s[1]||s[0]>o[1])return 0}return 1}containsPoint(e){for(const t of this.planes){const n=t[3];if(O([t[0],t[1],t[2]],e)+n<0)return!1}return!0}}class Vc{static fromPoints(e){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const i of e)C(t,t,i),I(n,n,i);return new Vc(t,n)}static fromTileIdAndHeight(e,t,n){const i=1<<e.canonical.z,r=e.canonical.x,o=e.canonical.y;return new Vc([r/i,o/i,t],[(r+1)/i,(o+1)/i,n])}static applyTransform(e,t){const n=e.getCorners();for(let i=0;i<n.length;++i)N(n[i],n[i],t);return Vc.fromPoints(n)}static applyTransformFast(e,t){const n=[t[12],t[13],t[14]],i=[...n];for(let r=0;r<3;r++)for(let o=0;o<3;o++){const s=t[4*o+r],a=s*e.min[o],l=s*e.max[o];n[r]+=Math.min(a,l),i[r]+=Math.max(a,l)}return new Vc(n,i)}static projectAabbCorners(e,t){const n=e.getCorners();for(let i=0;i<n.length;++i)N(n[i],n[i],t);return n}constructor(e,t){this.min=e,this.max=t,this.center=R([],A([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=b(this.min),i=b(this.max);for(let r=0;r<t.length;r++)n[r]=t[r]?this.min[r]:this.center[r],i[r]=t[r]?this.center[r]:this.max[r];return i[2]=this.max[2],new Vc(n,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Bc(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Bc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?zc(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?zc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Xo(Vc,"Aabb");class jc{constructor(e,t){this.feature=e,this.metersToTile=t,this.index=0}get(){const e=this.feature.vertices[this.index],t=this.feature.vertexProps[this.index].dir,n=t[1],i=-t[0],r=(e.extent+1)*this.metersToTile;return[new xe(Math.trunc(e.position[0]+n*r),Math.trunc(e.position[1]+i*r)),new xe(Math.trunc(e.position[0]-n*r),Math.trunc(e.position[1]-i*r))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Gc{constructor(e,t,n,i,r,o){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:n,max:n},this.safeArea=t,this.constantHeight=n,null==this.constantHeight&&(null!=this.constantHeight||0!==i.length)){this.vertices=i,this.edges=r,this.edges=this.edges.filter(e=>{return e.a<this.vertices.length&&e.b<this.vertices.length&&!((t=this.vertices[e.a].position)[0]===(n=this.vertices[e.b].position)[0]&&t[1]===n[1]);var t,n}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const e of this.vertices)this.vertexProps.push({dir:ae(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,e.height),this.heightRange.max=Math.max(this.heightRange.max,e.height);for(const e of this.edges){const t=this.vertices[e.a].position,n=this.vertices[e.b].position,i=ce(se(),n,t),r=he(i),o=ue(se(),i,1/r);this.edgeProps.push({vec:i,dir:o,len:r});const s=this.vertexProps[e.a].dir,a=this.vertexProps[e.b].dir;le(s,s,o),le(a,a,o)}for(const e of this.vertexProps)0===e.dir[0]&&0===e.dir[1]||de(e.dir,e.dir);this.tessellate(o)}}pointElevation(e){if(null!=this.constantHeight)return this.constantHeight;const t=this.getClosestEdge(e);if(null==t)return 0;const[n,i]=t;return un(this.vertices[this.edges[n].a].height,this.vertices[this.edges[n].b].height,i)}computeSlopeNormal(e,t){const n=this.getClosestEdge(e);if(!n)return E(0,0,1);const i=n[0],r=this.edges[i],o=this.edgeProps[i].vec,s=E(o[0],o[1],(this.vertices[r.b].height-this.vertices[r.a].height)*t),a=E(s[1],-s[0],0);B(a,a,s);const l=w(a);return l>0?R(a,a,1/l):E(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(0===this.edges.length)return;let t=0,n=Number.POSITIVE_INFINITY,i=0;const r=ae(e.x,e.y);for(let o=0;o<this.edges.length;o++){const e=this.edges[o],s=this.edgeProps[o].dir,a=new Fc(r,this.edgeProps[o].dir),l=this.vertices[e.a].position,c=this.vertices[e.b].position,u=se(),h=se(),d=a.intersectsPlane(l,this.vertexProps[e.a].dir,u),f=a.intersectsPlane(c,this.vertexProps[e.b].dir,h);if(!d||!f)continue;const p=ce(se(),h,u),m=ce(se(),r,u),g=fe(p,p),_=g>0?fe(m,p)/g:0,y=Re(_,0,1),v=Math.abs((_-y)*this.edgeProps[o].len),x=ce(se(),r,l),b=v+Math.abs(fe(x,ae(s[1],-s[0])));b<n&&(t=o,n=b,i=y)}return[t,i]}tessellate(e){for(let t=this.edges.length-1;t>=0;--t){const n=this.edges[t].a,i=this.edges[t].b,{position:r,height:o,extent:s}=this.vertices[n],{position:a,height:l,extent:c}=this.vertices[i],u=this.vertexProps[n].dir,h=this.vertexProps[i].dir,d=E(r[0]/e,r[1]/e,o),f=E(a[0]/e,a[1]/e,l),p=E(u[1],-u[0],0);R(p,p,s);const m=E(h[1],-h[0],0);if(R(m,m,c),this.distSqLines(E(d[0]+.5*p[0],d[1]+.5*p[1],d[2]+.5*p[2]),E(f[0]-.5*m[0],f[1]-.5*m[1],f[2]-.5*m[2]),E(d[0]-.5*p[0],d[1]-.5*p[1],d[2]-.5*p[2]),E(f[0]+.5*m[0],f[1]+.5*m[1],f[2]+.5*m[2]))<=.0025000000000000005)continue;const g=this.vertices.length,_=le(se(),r,a);this.vertices.push({position:ue(_,_,.5),height:.5*(o+l),extent:.5*(s+c)});const y=le(se(),u,h);this.vertexProps.push({dir:de(y,y)}),this.edges.splice(t,1),this.edgeProps.splice(t,1),this.edges.push({a:n,b:g}),this.edges.push({a:g,b:i});const v=ce(se(),this.vertices[g].position,r),x=he(v),b={vec:v,dir:ue(se(),v,1/x),len:x};this.edgeProps.push(b),this.edgeProps.push(b)}}distSqLines(e,t,n,i){const r=S(x(),t,e),o=S(x(),i,n),s=S(x(),e,n),a=O(r,r),l=O(r,o),c=O(r,s),u=O(o,o),h=O(o,s),d=a*u-l*l;if(0===d){const t=O(s,o)/O(o,o);return M(z(x(),n,i,t),e)}const f=(l*h-c*u)/d,p=(a*h-l*c)/d;return M(z(x(),e,t,f),z(x(),n,i,p))}}class Hc{static parseFrom(e,t){const n=Mc.parse(e);if(!n)return[];let{vertices:i,features:r}=n;const o=1/lc(t);r.sort((e,t)=>e.id-t.id),i.sort((e,t)=>e.id-t.id||e.idx-t.idx),i=i.filter((e,t,n)=>t===n.findIndex(t=>t.id===e.id&&t.idx===e.idx));const s=new Array;let a=0;const l=i.length;for(const c of r){if(c.constantHeight){s.push(new Gc(c.id,c.bounds,c.constantHeight));continue}for(;a!==l&&i[a].id<c.id;)a++;if(a===l||i[a].id!==c.id)continue;const e=new Array,t=new Array,n=a;for(;a!==l&&i[a].id===c.id;){const r=i[a];if(e.push({position:r.position,height:r.height,extent:r.extent}),a!==n&&i[a-1].idx===r.idx-1){const e=a-n;t.push({a:e-1,b:e})}a++}s.push(new Gc(c.id,c.bounds,void 0,e,t,o))}return s}static getElevationFeature(e,t){if(!t)return;const n=+e.properties[Sc];return Number.isNaN(n)?void 0:t.find(e=>e.id===n)}}class Wc{constructor(e,t){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(t)||(this.zScale=Math.pow(2,t.z-e.z),this.xOffset=(e.x*this.zScale-t.x)*Li,this.yOffset=(e.y*this.zScale-t.y)*Li)}constantElevation(e,t){if(null!=e.constantHeight)return this.computeBiasedHeight(e.constantHeight,t)}pointElevation(e,t,n){const i=this.constantElevation(t,n);return null!=i?i:(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(t.pointElevation(e),n))}computeBiasedHeight(e,t){return t<=0?e:e+t*Pe(0,t,e>=0?e:Math.abs(.5*e))}}Xo(Gc,"ElevationFeature");class qc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ia,this.indexArray=new Ta,this.segments=new tl,this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,"none"!==this.elevationMode&&(this.elevatedLayoutVertexArray=new sa),this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,i){const r=this.layers[0],o=[];let s=null;"circle"===r.type&&(s=r.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:u,sourceLayerIndex:h}of e){const e=this.layers[0]._featureFilter.needGeometry,t=yc(l,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),t,n))continue;const r=s?s.evaluate(t,{},n):void 0,a={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:e?t.geometry:_c(l,n,i),patterns:{},sortKey:r};o.push(a)}s&&o.sort((e,t)=>e.sortKey-t.sortKey);let a=null;"globe"===i.projection.name&&(this.globeExtVertexArray=new pa,a=i.projection);for(const l of o){const{geometry:i,index:r,sourceLayerIndex:o}=l,s=e[r].feature;this.addFeature(l,i,r,t.availableImages,n,a,t.brightness,t.elevationFeatures),t.featureIndex.insert(s,i,r,o,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,t,n,i,r,o,s){this.programConfigurations.updatePaintArrays(e,t,r,n,i,o,s,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qa.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,el.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,$a.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,t,n,i,r,o,s,a){let l;"none"!==this.elevationMode&&(l=Hc.getElevationFeature(e,a));for(const c of t)for(const t of c){const n=t.x,i=t.y;if(n<0||n>=Li||i<0||i>=Li)continue;if(o){const e=o.projectTilePoint(n,i,r),t=o.upVector(r,n,i);this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=s.vertexLength;if(this.addCircleVertex(n,i,-1,-1),this.addCircleVertex(n,i,1,-1),this.addCircleVertex(n,i,1,1),this.addCircleVertex(n,i,-1,1),"none"!==this.elevationMode){const e=l?l.pointElevation(new xe(n,i)):0;this.hasElevation=this.hasElevation||0!==e;for(let t=0;t<4;t++)this.elevatedLayoutVertexArray.emplaceBack(e)}this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i,r,s,void 0,this.worldview)}addCircleVertex(e,t,n,i){this.layoutVertexArray.emplaceBack(2*e+(n+1)/2,2*t+(i+1)/2)}addGlobeExtVertex(e,t){const n=16384;this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,t[0]*n,t[1]*n,t[2]*n)}}function Xc(e,t){for(let n=0;n<e.length;n++)if(ru(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(ru(e,t[n]))return!0;return!!Jc(e,t)}function Zc(e,t,n){return!!ru(e,t)||!!tu(t,e,n)}function Yc(e,t){if(1===e.length)return iu(t,e[0]);for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++)if(ru(e,i[t]))return!0}for(let n=0;n<e.length;n++)if(iu(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Jc(e,t[n]))return!0;return!1}function Kc(e,t,n){if(e.length>1){if(Jc(e,t))return!0;for(let i=0;i<t.length;i++)if(tu(t[i],e,n))return!0}for(let i=0;i<e.length;i++)if(tu(e[i],t,n))return!0;return!1}function Jc(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)if(Qc(i,r,t[e],t[e+1]))return!0}return!1}function Qc(e,t,n,i){return We(e,n,i)!==We(t,n,i)&&We(e,t,n)!==We(e,t,i)}function $c(e,t,n){return(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x)}function eu(e,t,n,i){const r=$c(e,t,i),o=$c(e,t,n);if(Math.sign(r)===Math.sign(o))return;const s=$c(n,i,e),a=s+o-r;return Math.sign(s)!==Math.sign(a)?[s/(s-a),o/(o-r)]:void 0}function tu(e,t,n){const i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(let r=1;r<t.length;r++)if(nu(e,t[r-1],t[r])<i)return!0;return!1}function nu(e,t,n){const i=t.distSqr(n);if(0===i)return e.distSqr(t);const r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(r<0?t:r>1?n:n.sub(t)._mult(r)._add(t))}function iu(e,t){let n,i,r,o=!1;for(let s=0;s<e.length;s++){n=e[s];for(let e=0,s=n.length-1;e<n.length;s=e++)i=n[e],r=n[s],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(o=!o)}return o}function ru(e,t){let n=!1;for(let i=0,r=e.length-1;i<e.length;r=i++){const o=e[i],s=e[r];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function ou(e,t,n,i,r){for(const s of e)if(t<=s.x&&n<=s.y&&i>=s.x&&r>=s.y)return!0;const o=[new xe(t,n),new xe(t,r),new xe(i,r),new xe(i,n)];if(e.length>2)for(const s of o)if(ru(e,s))return!0;for(let s=0;s<e.length-1;s++)if(su(e[s],e[s+1],o))return!0;return!1}function su(e,t,n){const i=n[0],r=n[2];if(e.x<i.x&&t.x<i.x||e.x>r.x&&t.x>r.x||e.y<i.y&&t.y<i.y||e.y>r.y&&t.y>r.y)return!1;const o=We(e,t,n[0]);return o!==We(e,t,n[1])||o!==We(e,t,n[2])||o!==We(e,t,n[3])}function au(e,t,n,i,r,o){let s=t.y-e.y,a=e.x-t.x;if(o=o||0){const e=s*s+a*a;if(0===e)return!0;const t=Math.sqrt(e);s/=t,a/=t}return!((n.x-e.x)*s+(n.y-e.y)*a-o<0||(i.x-e.x)*s+(i.y-e.y)*a-o<0||(r.x-e.x)*s+(r.y-e.y)*a-o<0)}function lu(e,t,n,i,r,o,s){return!(au(e,t,i,r,o,s)||au(t,n,i,r,o,s)||au(n,e,i,r,o,s)||au(i,r,e,t,n,s)||au(r,o,e,t,n,s)||au(o,i,e,t,n,s))}function cu(e,t,n){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function uu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function hu(e,t,n,i,r){if(!t[0]&&!t[1])return e;const o=xe.convert(t)._mult(r);"viewport"===n&&o._rotate(-i);const s=[];for(let a=0;a<e.length;a++)s.push(e[a].sub(o));return s}function du(e,t,n,i){const r=xe.convert(e)._mult(i);return"viewport"===t&&r._rotate(-n),r}let fu,pu;function mu(e,t,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}Xo(qc,"CircleBucket",{omit:["layers"]});class gu{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=vu(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const t=this.z-e.z;return 0===e.z||e.z<this.z&&e.x===this.x>>t&&e.y===this.y>>t}url(e,t){const n=function(e,t,n){var i=mu(256*e,256*(t=Math.pow(2,n)-t-1),n),r=mu(256*(e+1),256*(t+1),n);return i[0]+","+i[1]+","+r[0]+","+r[1]}(this.x,this.y,this.z),i=function(e,t,n){let i,r="";for(let o=e;o>0;o--)i=1<<o-1,r+=(t&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",n)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class _u{constructor(e,t){this.wrap=e,this.canonical=t,this.key=vu(e,t.z,t.z,t.x,t.y)}}class yu{constructor(e,t,n,i,r){this.overscaledZ=e,this.wrap=t,this.canonical=new gu(n,+i,+r),this.key=0===t&&e===n?this.canonical.key:vu(t,e,n,i,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new yu(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yu(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return vu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return vu(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new yu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new yu(t,this.wrap,t,n,i),new yu(t,this.wrap,t,n+1,i),new yu(t,this.wrap,t,n,i+1),new yu(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new yu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new yu(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _u(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}function vu(e,t,n,i,r){const o=1<<Math.min(n,22);let s=o*(r%o)+i%o;return e&&n<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*s+n)+(t-n)}const xu=[e=>{let t=e.canonical.x-1,n=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,n--),new yu(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,n=e.wrap;return t===1<<e.canonical.z&&(t=0,n++),new yu(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>new yu(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new yu(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Xo(gu,"CanonicalTileID"),Xo(yu,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const bu=ta([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:wu}=bu,Eu=ta([{name:"a_pos_3",components:3,type:"Int16"}]);var Tu=ta([{name:"a_pos",type:"Int16",components:2}]);function Au(e){return e*kl/Wl}const Su=[new Vc([Vl,Vl,Vl],[jl,jl,jl]),new Vc([Vl,Vl,Vl],[0,0,jl]),new Vc([0,Vl,Vl],[jl,0,jl]),new Vc([Vl,0,Vl],[0,jl,jl]),new Vc([0,0,Vl],[jl,jl,jl])];function Du(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=R([],e._camera.position,e.worldSize),o=[t,n,1,1];K(o,o,e.pixelMatrixInverse),Z(o,o,1/o[3]);const s=k([],H([],o,r)),a=e.globeMatrix,l=[a[12],a[13],a[14]],c=H([],l,r),u=w(c),h=k([],c),d=e.worldSize/(2*Math.PI),f=O(h,s),p=Math.asin(d/u);if(p<Math.acos(f)){if(!i)return null;const e=[],t=[];R(e,s,u/f),k(t,H(t,e,c)),k(s,A(s,c,R(s,t,Math.tan(p)*u)))}const m=[];new Lc(r,s).closestPointOnSphere(l,d,m);const g=k([],Je(a,0)),_=k([],Je(a,1)),y=k([],Je(a,2)),v=O(g,m),x=O(_,m),b=O(y,m),E=Ae(Math.asin(-x/d));let T=Ae(Math.atan2(v,b));T=e.center.lng+function(e,t){const n=(t-e+180)%360-180;return n<-180?n+360:n}(e.center.lng,T);const S=Ql(T),D=Re($l(E),0,1);return new cc(S,D)}class Cu{constructor(e,t,n){this.a=H([],e,n),this.b=H([],t,n),this.center=n;const i=k([],this.a),r=k([],this.b);this.angle=Math.acos(O(i,r))}}function Iu(e,t){if(0===e.angle)return null;let n;return n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(e,t,n,i){const r=Math.sin(n);return e*(Math.sin((1-i)*n)/r)+t*(Math.sin(i*n)/r)}(e.a[t],e.b[t],e.angle,Re(n,0,1))+e.center[t]}function Ru(e){if(e.z<=1)return Su[e.z+2*e.y+e.x];const t=ku(Lu(e));return Vc.fromPoints(t)}function Pu(e,t,n){return R(e,e,1-n),P(e,e,t,n)}function Mu(e,t,n){for(const i of e)N(i,i,t),R(i,i,n)}function Fu(e,t,n,i){const r=t/e.worldSize,o=e.globeMatrix;if(n.z<=1){const e=Ru(n).getCorners();return Mu(e,o,r),Vc.fromPoints(e)}const s=Lu(n,i),a=ku(s,kl+Au(e._tileCoverLift));Mu(a,o,r);const l=Number.MAX_VALUE,c=[-l,-l,-l],u=[l,l,l];if(s.contains(e.center)){for(const e of a)C(u,u,e),I(c,c,e);c[2]=0;const t=e.point,n=[t.x*r,t.y*r,0];return C(u,u,n),I(c,c,n),new Vc(u,c)}if(e._tileCoverLift>0){for(const e of a)C(u,u,e),I(c,c,e);return new Vc(u,c)}const h=[o[12]*r,o[13]*r,o[14]*r],d=s.getCenter(),f=Re(e.center.lat,-rc,rc),p=Re(d.lat,-rc,rc),m=Ql(e.center.lng),g=$l(f);let _=m-Ql(d.lng);const y=g-$l(p);_>.5?_-=1:_<-.5&&(_+=1);let v=0;Math.abs(_)>Math.abs(y)?v=_>=0?1:3:(v=y>=0?0:2,P(h,h,[o[4]*r,o[5]*r,o[6]*r],-Math.sin(Te(y>=0?s.getSouth():s.getNorth()))*kl));const x=a[v],b=a[(v+1)%4],w=new Cu(x,b,h),E=[Iu(w,0)||x[0],Iu(w,1)||x[1],Iu(w,2)||x[2]],T=Hu(e.zoom);if(T>0){const i=function(e,t,n,i,r){let{x:o,y:s,z:a}=e;const l=1/(1<<a);let c=o*l,u=c+l,h=s*l,d=h+l,f=0;const p=(c+u)/2-i;return p>.5?f=-1:p<-.5&&(f=1),c=((c+f)*t-(i*=t))*n+i,u=((u+f)*t-i)*n+i,h=(h*t-(r*=t))*n+r,d=(d*t-r)*n+r,[[c,d,0],[u,d,0],[u,h,0],[c,h,0]]}(n,t,e._pixelsPerMercatorPixel,m,g);for(let e=0;e<a.length;e++)Pu(a[e],i[e],T);const r=A([],i[v],i[(v+1)%4]);R(r,r,.5),Pu(E,r,T)}for(const A of a)C(u,u,A),I(c,c,A);return u[2]=Math.min(x[2],b[2]),C(u,u,E),I(c,c,E),new Vc(u,c)}function Lu(e){let{x:t,y:n,z:i}=e,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=1/(1<<i),s=new Xl(tc(t*o),n===(1<<i)-1&&r?-90:nc((n+1)*o)),a=new Xl(tc((t+1)*o),0===n&&r?90:nc(n*o));return new Zl(s,a)}function ku(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kl;const n=Te(e.getNorth()),i=Te(e.getSouth()),r=Math.cos(n),o=Math.cos(i),s=Math.sin(n),a=Math.sin(i),l=e.getWest(),c=e.getEast();return[Gl(o,a,l,t),Gl(o,a,c,t),Gl(r,s,c,t),Gl(r,s,l,t)]}function Ou(e,t,n,i){const r=1<<n.z,o=(e/Li+n.x)/r;return Hl(nc((t/Li+n.y)/r),tc(o),i)}function Bu(e){let{min:t,max:n}=e;return zl/Math.max(n[0]-t[0],n[1]-t[1],n[2]-t[2])}const zu=new Float64Array(16);function Nu(e){const t=Bu(e),n=g(zu,[t,t,t]);return h(n,n,L([],e.min))}function Uu(e){const t=(i=e.min,(n=zu)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n);var n,i;const r=1/Bu(e);return d(t,t,[r,r,r])}function Vu(e){const t=Li/(2*Math.PI);return e/(2*Math.PI)/t}function ju(e,t){return Li/(512*Math.pow(2,e))*Bu(Ru(t))}function Gu(e,t,n,i,r){const o=Vu(n),s=[e,t,-n/(2*Math.PI)],a=l(new Float64Array(16));return h(a,a,s),d(a,a,[o,o,o]),f(a,a,Te(-r)),p(a,a,Te(-i)),a}function Hu(e){return Pe(Ol,Bl,e)}function Wu(e,t){const n=Hl(t.lat,t.lng),i=function(e){const t=Hl(e._center.lat,e._center.lng);let n=B([],E(0,1,0),t);const i=_([],-e.angle,t);n=N(n,n,i),_(i,-e._pitch,n);const r=k([],t);return R(r,r,Au(e.cameraToCenterDistance/e.pixelsPerMeter)),N(r,r,i),A([],t,r)}(e);return s=(r=S([],i,n))[0],a=r[1],l=r[2],c=(o=n)[0],u=o[1],h=o[2],f=(d=Math.sqrt(s*s+a*a+l*l)*Math.sqrt(c*c+u*u+h*h))&&O(r,o)/d,Math.acos(Math.min(Math.max(f,-1),1));var r,o,s,a,l,c,u,h,d,f}function qu(e,t){return Wu(e,t)>Math.PI/2*1.01}const Xu=Te(85),Zu=Math.cos(Xu),Yu=Math.sin(Xu),Ku=a(),Ju=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Qu(e,t,n,i,r,o,s,a,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=n.projection.upVectorScale(c,n.center.lat,n.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(a),d=r&&n.elevation?n.elevation.exaggeration()*r.getElevationAt(h.x,h.y,!0):0,f=n.projection.projectTilePoint(h.x,h.y,c);if(d>0){const e=n.projection.upVector(c,h.x,h.y);f.x+=e[0]*u*d,f.y+=e[1]*u*d,f.z+=e[2]*u*d}const p=o?h:$u(f.x,f.y,f.z,i),m=o?e.tilespaceRays.map(e=>nh(e,d)):e.queryGeometry.screenGeometry,g=K([],[f.x,f.y,f.z,1],i);if(!s&&o?l*=g[3]/n.cameraToCenterDistance:s&&!o&&(l*=n.cameraToCenterDistance/g[3]),o){const e=nc((t.y/Li+c.y)/(1<<c.z));l/=n.projection.pixelsPerMeter(e,1)/ec(1,e)}if(Zc(m,p,l))return!0}return!1}function $u(e,t,n,i){const r=K([],[e,t,n,1],i);return new xe(r[0]/r[3],r[1]/r[3])}const eh=E(0,0,0),th=E(0,0,1);function nh(e,t){const n=x();return eh[2]=t,e.intersectsPlane(eh,th,n),new xe(n[0],n[1])}class ih extends qc{}let rh,oh,sh,ah;function lh(e,t,n,i){let{width:r,height:o}=t;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*o*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(r*o*n);return e.width=r,e.height=o,e.data=i,e}function ch(e,t,n){const{width:i,height:r}=t;i===e.width&&r===e.height||(uh(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,i),height:Math.min(e.height,r)},n,null),e.width=i,e.height=r,e.data=t.data)}function uh(e,t,n,i,r,o,s,a){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const l=e.data,c=t.data,u=4===o&&a;for(let h=0;h<r.height;h++){const a=((n.y+h)*e.width+n.x)*o,d=((i.y+h)*t.width+i.x)*o;if(u)for(let e=0;e<r.width;e++){const t=a+e*o+3,n=d+e*o;c[n+0]=255,c[n+1]=255,c[n+2]=255,c[n+3]=l[t]}else if(s)for(let e=0;e<r.width;e++){const t=a+e*o,n=d+e*o,i=new sn(l[t+0]/255,l[t+1]/255,l[t+2]/255,l[t+3]).toNonPremultipliedRenderColor(s).toArray();c[n+0]=i[0],c[n+1]=i[1],c[n+2]=i[2],c[n+3]=i[3]}else for(let e=0;e<r.width*o;e++)c[d+e]=l[a+e]}return t}Xo(ih,"HeatmapBucket",{omit:["layers"]});class hh{constructor(e,t){lh(this,e,1,t)}resize(e){ch(this,new hh(e),1)}clone(){return new hh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){uh(e,t,n,i,r,1,null)}}class dh{constructor(e,t){lh(this,e,4,t)}resize(e){ch(this,new dh(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new dh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r,o,s){uh(e,t,n,i,r,4,o,s)}}class fh{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}function ph(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,r=e.image||new dh({width:n,height:i}),o=(n,i,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t),a=s?s.toNonPremultipliedRenderColor(null):null;a&&(r.data[n+i+0]=Math.floor(255*a.r),r.data[n+i+1]=Math.floor(255*a.g),r.data[n+i+2]=Math.floor(255*a.b),r.data[n+i+3]=Math.floor(255*a.a))};if(e.clips)for(let s=0,a=0;s<i;++s,a+=4*n)for(let t=0,i=0;t<n;t++,i+=4){const r=t/(n-1),{start:l,end:c}=e.clips[s];o(a,i,l*(1-r)+c*r)}else for(let s=0,a=0;s<n;s++,a+=4)o(0,a,s/(n-1));return r}Xo(hh,"AlphaImage"),Xo(dh,"RGBAImage");const mh=ta([{name:"a_pos",components:2,type:"Int16"}],4),gh=ta([{name:"a_road_z_offset",components:1,type:"Float32"}],4),_h=ta([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),yh=ta([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function vh(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=t&&t.length,r=i?t[0]*n:e.length;let o=xh(e,0,r,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c;if(i&&(o=function(e,t,n,i){const r=[];for(let o=0,s=t.length;o<s;o++){const n=xh(e,t[o]*i,o<s-1?t[o+1]*i:e.length,i,!1);n===n.next&&(n.steiner=!0),r.push(Ph(n))}r.sort(Dh);for(let o=0;o<r.length;o++)n=Ch(r[o],n);return n}(e,t,o,n)),e.length>80*n){a=e[0],l=e[1];let t=a,i=l;for(let o=n;o<r;o+=n){const n=e[o],r=e[o+1];n<a&&(a=n),r<l&&(l=r),n>t&&(t=n),r>i&&(i=r)}c=Math.max(t-a,i-l),c=0!==c?32767/c:0}return wh(o,s,n,a,l,c,0),s}function xh(e,t,n,i,r){let o;if(r===function(e,t,n,i){let r=0;for(let o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}(e,t,n,i)>0)for(let s=t;s<n;s+=i)o=jh(s/i|0,e[s],e[s+1],o);else for(let s=n-i;s>=t;s-=i)o=jh(s/i|0,e[s],e[s+1],o);return o&&Oh(o,o.next)&&(Gh(o),o=o.next),o}function bh(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!Oh(i,i.next)&&0!==kh(i.prev,i,i.next))i=i.next;else{if(Gh(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function wh(e,t,n,i,r,o,s){if(!e)return;!s&&o&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Rh(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n=1;do{let i,r=e;e=null;let o=null;for(t=0;r;){t++;let s=r,a=0;for(let e=0;e<n&&(a++,s=s.nextZ,s);e++);let l=n;for(;a>0||l>0&&s;)0!==a&&(0===l||!s||r.z<=s.z)?(i=r,r=r.nextZ,a--):(i=s,s=s.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=s}o.nextZ=null,n*=2}while(t>1)}(r)}(e,i,r,o);let a=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(o?Th(e,i,r,o):Eh(e))t.push(l.i,e.i,c.i),Gh(e),e=c.next,a=c.next;else if((e=c)===a){s?1===s?wh(e=Ah(bh(e),t),t,n,i,r,o,2):2===s&&Sh(e,t,n,i,r,o):wh(bh(e),t,n,i,r,o,1);break}}}function Eh(e){const t=e.prev,n=e,i=e.next;if(kh(t,n,i)>=0)return!1;const r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=Math.min(r,o,s),h=Math.min(a,l,c),d=Math.max(r,o,s),f=Math.max(a,l,c);let p=i.next;for(;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&Fh(r,a,o,l,s,c,p.x,p.y)&&kh(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Th(e,t,n,i){const r=e.prev,o=e,s=e.next;if(kh(r,o,s)>=0)return!1;const a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,f=Math.min(a,l,c),p=Math.min(u,h,d),m=Math.max(a,l,c),g=Math.max(u,h,d),_=Rh(f,p,t,n,i),y=Rh(m,g,t,n,i);let v=e.prevZ,x=e.nextZ;for(;v&&v.z>=_&&x&&x.z<=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==r&&v!==s&&Fh(a,u,l,h,c,d,v.x,v.y)&&kh(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==r&&x!==s&&Fh(a,u,l,h,c,d,x.x,x.y)&&kh(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=_;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==r&&v!==s&&Fh(a,u,l,h,c,d,v.x,v.y)&&kh(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==r&&x!==s&&Fh(a,u,l,h,c,d,x.x,x.y)&&kh(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Ah(e,t){let n=e;do{const i=n.prev,r=n.next.next;!Oh(i,r)&&Bh(i,n,n.next,r)&&Uh(i,r)&&Uh(r,i)&&(t.push(i.i,n.i,r.i),Gh(n),Gh(n.next),n=e=r),n=n.next}while(n!==e);return bh(n)}function Sh(e,t,n,i,r,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Lh(s,e)){let a=Vh(s,e);return s=bh(s,s.next),a=bh(a,a.next),wh(s,t,n,i,r,o,0),void wh(a,t,n,i,r,o,0)}e=e.next}s=s.next}while(s!==e)}function Dh(e,t){let n=e.x-t.x;return 0===n&&(n=e.y-t.y,0===n)&&(n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Ch(e,t){const n=function(e,t){let n=t;const i=e.x,r=e.y;let o,s=-1/0;if(Oh(e,n))return n;do{if(Oh(e,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const e=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>s&&(s=e,o=n.x<n.next.x?n:n.next,e===i))return o}n=n.next}while(n!==t);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;n=o;do{if(i>=n.x&&n.x>=l&&i!==n.x&&Mh(r<c?i:s,r,l,c,r<c?s:i,r,n.x,n.y)){const t=Math.abs(r-n.y)/(i-n.x);Uh(n,e)&&(t<u||t===u&&(n.x>o.x||n.x===o.x&&Ih(o,n)))&&(o=n,u=t)}n=n.next}while(n!==a);return o}(e,t);if(!n)return t;const i=Vh(n,e);return bh(i,i.next),bh(n,n.next)}function Ih(e,t){return kh(e.prev,e,t.prev)<0&&kh(t.next,e,e.next)<0}function Rh(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ph(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Mh(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function Fh(e,t,n,i,r,o,s,a){return!(e===s&&t===a)&&Mh(e,t,n,i,r,o,s,a)}function Lh(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Bh(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Uh(e,t)&&Uh(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(kh(e.prev,e,t.prev)||kh(e,t.prev,t))||Oh(e,t)&&kh(e.prev,e,e.next)>0&&kh(t.prev,t,t.next)>0)}function kh(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Oh(e,t){return e.x===t.x&&e.y===t.y}function Bh(e,t,n,i){const r=Nh(kh(e,t,n)),o=Nh(kh(e,t,i)),s=Nh(kh(n,i,e)),a=Nh(kh(n,i,t));return r!==o&&s!==a||!(0!==r||!zh(e,n,t))||!(0!==o||!zh(e,i,t))||!(0!==s||!zh(n,e,i))||!(0!==a||!zh(n,t,i))}function zh(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Nh(e){return e>0?1:e<0?-1:0}function Uh(e,t){return kh(e.prev,e,e.next)<0?kh(e,t,e.next)>=0&&kh(e,e.prev,t)>=0:kh(e,t,e.prev)<0||kh(e,e.next,t)<0}function Vh(e,t){const n=Hh(e.i,e.x,e.y),i=Hh(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function jh(e,t,n,i){const r=Hh(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Gh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Hh(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Wh(e,t){const n=e.length;if(n<=1)return[e];const i=[];let r,o;for(let s=0;s<n;s++){const t=qe(e[s]);0!==t&&(e[s].area=Math.abs(t),void 0===o&&(o=t<0),o===t<0?(r&&i.push(r),r=[e[s]]):r.push(e[s]))}if(r&&i.push(r),t>1)for(let s=0;s<i.length;s++)i[s].length<=t||(ni(i[s],t,1,i[s].length-1,qh),i[s]=i[s].slice(0,t));return i}function qh(e,t){return t.area-e.area}function Xh(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!e)return null;const i="string"==typeof e?Bn.from(e).getPrimary():e.getPrimary(),r="string"==typeof e?null:e.getSecondary();for(const o of[i,r]){if(!o)continue;const e=o.id.toString();t.has(e)||t.set(e,[]),o.scaleSelf(n),t.get(e).push(o)}return{primary:i.toString(),secondary:r?r.toString():null}}function Zh(e,t,n,i){const r=i.patternDependencies;let o=!1;for(const s of t){const t=s.paint.get("".concat(e,"-pattern"));t.isConstant()||(o=!0),Xh(t.constantOr(null),r,n)&&(o=!0)}return o}function Yh(e,t,n,i,r,o){const s=o.patternDependencies;for(const a of t){const t=a.paint.get("".concat(e,"-pattern")).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i},n,{},o.availableImages);e=e&&e.name?e.name:e;const l=Xh(e,s,r);if(!l)continue;const{primary:c,secondary:u}=l;c&&(n.patterns[a.id]=[c,u].filter(Boolean))}}return n}class Kh{constructor(){this.polygons=new Map}add(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.polygons.has(e)?this.polygons.get(e).push(...n):this.polygons.set(e,n)}merge(e){for(const[t,n]of e.polygons)this.add(t,...n)}}class Jh{constructor(){this.portals=[]}static evaluate(e){if(0===e.length)return new Jh;let t=[];for(const l of e)t.push(...l.portals);if(0===t.length)return new Jh;const n=(e,t)=>e<=0&&t<=0||e>=Li&&t>=Li;for(const l of t){const e=l.va,t=l.vb;(n(e.x,t.x)||n(e.y,t.y))&&(l.type="border")}const i=t.filter(e=>"unevaluated"!==e.type),r=t.filter(e=>"unevaluated"===e.type);if(0===r.length)return new Jh;r.sort((e,t)=>e.hash===t.hash?e.isTunnel===t.isTunnel?0:e.isTunnel?-1:1:e.hash<t.hash?1:-1),t=i.concat(r);let o=i.length,s=o,a=o;do{if(s++,s===t.length||t[o].hash!==t[s].hash){if(s-o==2){a<o&&(t[a]=t[o],t[o]=null);const e=t[a],n=t[s-1];e.type=e.isTunnel!==n.isTunnel?"tunnel":"polygon",e.connection={a:e.connection.a,b:n.connection.a},a++}o=s}}while(o!==t.length);return t.splice(a),t.sort((e,t)=>e.hash<t.hash?1:-1),{portals:t}}}Xo(Jh,"ElevationPortalGraph"),Xo(Kh,"ElevationPolygons");class Qh{constructor(e,t,n){this.outPositions=e,this.outNormals=t,this.outIndices=n,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,t,n){let i=e[2];null!=n&&(i*=n);const r=this.getVec3Bits(e)<<96n|this.getVec3Bits(t),o=this.vertexLookup.get(r);if(null!=o)return o;const s=this.outPositions.length;this.vertexLookup.set(r,s);const a=Math.trunc(16384*t[0]),l=Math.trunc(16384*t[1]),c=Math.trunc(16384*t[2]);return this.outPositions.emplaceBack(e[0],e[1],i),this.outNormals.emplaceBack(a,l,c),s}addTriangle(e,t,n){this.outIndices.emplaceBack(e,t,n)}addTriangles(e,t,n){if(0===e.length)return;const i=1===n.length,r=x(),o=x();for(let s=0;s<e.length;s+=3){const a=t[e[s+0]],l=t[e[s+1]],c=t[e[s+2]],u=i?n[0]:n[e[s+1]],h=i?n[0]:n[e[s+2]];T(r,a.x,a.y,i?n[0]:n[e[s+0]]);const d=this.addVertex(r,o);T(r,l.x,l.y,u);const f=this.addVertex(r,o);T(r,c.x,c.y,h);const p=this.addVertex(r,o);this.outIndices.emplaceBack(d,f,p)}}addQuad(e,t,n,i,r,o){const s=this.addVertex(e,r,o),a=this.addVertex(t,r,o),l=this.addVertex(n,r,o),c=this.addVertex(i,r,o);this.addTriangle(s,a,l),this.addTriangle(l,c,s)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class $h{constructor(e,t,n,i){this.unevaluatedPortals=new Jh,this.portalPolygons=new Kh,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new aa,this.vertexNormals=new la,this.indexArray=new Ta,this.tileToMeters=lc(e),this.bridgeProgramConfigurations=new Il(t,{zoom:n,lut:i},e=>"fill-tunnel-structure-color"!==e),this.tunnelProgramConfigurations=new Il(t,{zoom:n,lut:i},e=>"fill-bridge-guard-rail-color"!==e)}addVertices(e,t){const n=this.unevalVertices.length;for(let i=0;i<e.length;i++)this.unevalVertices.push(e[i]),this.unevalHeights.push(t[i]);return n}addTriangles(e,t,n){const i=n?this.unevalTunnelTriangles:this.unevalTriangles;for(const r of e)i.push(r+t)}addRenderableRing(e,t,n,i,r,o){const s=[new xe(r.min.x,r.min.y),new xe(r.max.x,r.min.y),new xe(r.max.x,r.max.y),new xe(r.min.x,r.max.y)];for(let a=0;a<n-1;a++){const n=t+a,l=n+1,c=this.unevalVertices[n],u=this.unevalVertices[l];if(!(c.x>=r.min.x&&c.x<=r.max.x&&c.y>=r.min.y&&c.y<=r.max.y||u.x>=r.min.x&&u.x<=r.max.x&&u.y>=r.min.y&&u.y<=r.max.y||su(c,u,s)))continue;if(this.isOnBorder(c.x,u.x)||this.isOnBorder(c.y,u.y))continue;const h=$h.computeEdgeHash(this.unevalVertices[n],this.unevalVertices[l]);let d,f=this.vertexHashLookup.get($h.computePosHash(c));null!=f?d=f.next:(f=this.vertexHashLookup.get($h.computePosHash(u)),d=null!=f?f.prev:h),this.unevalEdges.push({polygonIdx:e,a:n,b:l,hash:h,portalHash:d,isTunnel:i,type:"unevaluated",featureInfo:o})}}addPortalCandidates(e,t,n,i,r){if(0===t.length)return;this.portalPolygons.add(e,{geometry:t,zLevel:r});const o=t[0];this.vertexHashLookup.clear();let s=$h.computeEdgeHash(o[o.length-2],o[o.length-1]);for(let a=0;a<o.length-1;a++){const t=o[a+0],r=o[a+1],l=ae(r.x-t.x,r.y-t.y),c=he(l);if(0===c)continue;let u="unevaluated";const h=i.pointElevation(t),d=i.pointElevation(r);Math.abs(h)<.01&&Math.abs(d)<.01?u="entrance":(this.isOnBorder(t.x,r.x)||this.isOnBorder(t.y,r.y))&&(u="border");const f=$h.computeEdgeHash(t,r);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:t,vb:r,vab:l,length:c,hash:f,isTunnel:n,type:u});const p=$h.computePosHash(t);this.vertexHashLookup.set(p,{prev:s,next:f}),s=f}}construct(e){if(0===this.unevalVertices.length)return;const t=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),n=e=>{e.primitiveLength=this.indexArray.length-e.primitiveOffset},i=new Qh(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const r=t(),o=t(),s=t(),a=(e,t)=>{e.sort((e,n)=>e.type===t&&n.type!==t?-1:e.type!==t&&n.type===t?1:0);const n=e.findIndex(e=>e.type!==t);return n>=0?n:e.length};let l=0;this.unevalEdges.length>0&&(l=a(this.unevalEdges,"none"),this.constructBridgeStructures(i,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},this.tileToMeters)),n(s);const c=t(),u=t();if(this.unevalEdges.length>0){const e=this.unevalEdges.splice(l),t=a(e,"tunnel")+l;this.unevalEdges.push(...e),this.constructTunnelStructures(i,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},{min:l,max:t})}n(c),i.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),n(u),i.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),n(o),i.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),n(r),this.maskSegments=tl.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength),this.depthSegments=tl.simpleSegment(0,o.primitiveOffset,0,o.primitiveLength),this.renderableBridgeSegments=tl.simpleSegment(0,s.primitiveOffset,0,s.primitiveLength),this.renderableTunnelSegments=tl.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength),this.shadowCasterSegments=tl.simpleSegment(0,r.primitiveOffset,0,r.primitiveLength)}update(e,t,n,i,r,o,s,a){this.bridgeProgramConfigurations.updatePaintArrays(e,t,r,n,i,o,s,a),this.tunnelProgramConfigurations.updatePaintArrays(e,t,r,n,i,o,s,a)}upload(e){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,_h.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,yh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,t,n,i,r){const o=(o,s)=>{for(let a=0;a<s.length-1;a++){const l=s[a].featureIndex,c=s[a+1].vertexStart,u=e.feature(l);o.populatePaintArrays(c,u,l,{},n,t,i,void 0,r)}};o(this.bridgeProgramConfigurations,this.bridgeFeatureSections),o(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,t,n,i,r){const o=new Map;for(let s=i;s<r;s++){const i=n[s],r=i.a,a=i.b,l=$h.computePosHash(e[r]),c=$h.computePosHash(e[a]);let u=o.get(l);u||(u={},o.set(l,u));let h=o.get(c);h||(h={},o.set(c,h)),t[r]<=0&&t[a]<=0||(u.to=a,h.from=r)}return o}isTerminalVertex(e,t){const n=$h.computePosHash(this.unevalVertices[e]),i=t.get(n);return!i||!i.from||!i.to}constructBridgeStructures(e,t,n,i,r,o){e.clearVertexLookup();const s=this.computeVertexConnections(t,n,i,r.min,r.max),a=1/o,l=.5*a,c=(e,i)=>T(e,t[i].x,t[i].y,n[i]*a),u=x(),h=x(),d=x(),f=x(),p=x(),m=(e,n)=>{const i=s.get($h.computePosHash(t[n])),r=i.from,o=i.to;if(!r||!o)return;c(u,r),c(h,n),c(d,o),j(f),G(u,h)||(H(p,h,u),k(f,p)),G(d,h)||(H(p,d,h),A(f,f,k(p,p)));const a=q(f);return a>0?R(e,f,1/a):void 0};let g=Number.POSITIVE_INFINITY;this.sortSubarray(i,r.min,r.max,(e,t)=>e.featureInfo.featureIndex-t.featureInfo.featureIndex);const _=x(),y=x(),v=x(),b=x(),w=x(),E=x(),S=x(),D=x(),C=x(),I=[x(),x(),x(),x()],P=[x(),x(),x(),x()],M=[{coord:new xe(0,0),height:0},{coord:new xe(0,0),height:0}],F=(e,t)=>e>t;for(let x=r.min;x<r.max;x++){const r=i[x];if(!r.featureInfo.guardRailEnabled)continue;if(!this.prepareEdgePoints(M,t,n,r,F))continue;const[c,u]=M;if(T(_,c.coord.x,c.coord.y,a*c.height),T(y,u.coord.x,u.coord.y,a*u.height),G(_,y))continue;H(v,y,_),k(v,v);const h=m(D,r.a)||v,d=m(C,r.b)||v;T(b,h[1],-h[0],0),k(b,b),T(w,d[1],-d[0],0),k(w,w),B(D,b,h),k(E,D),B(D,w,d),k(S,D),A(I[0],_,R(D,H(D,b,E),l)),A(I[1],_,R(D,A(D,b,E),l)),A(I[2],_,R(D,E,l)),I[3]=_,A(P[0],y,R(D,H(D,w,S),l)),A(P[1],y,R(D,A(D,w,S),l)),A(P[2],y,R(D,S,l)),P[3]=y,g=this.addFeatureSection(r.featureInfo.featureIndex,g,this.bridgeFeatureSections,e);const f=e.addVertex(I[0],b,o),p=e.addVertex(I[1],b,o),O=e.addVertex(P[0],w,o),z=e.addVertex(P[1],w,o);e.addTriangle(f,p,O),e.addTriangle(p,z,O);const N=e.addVertex(I[1],E,o),U=e.addVertex(I[2],E,o),V=e.addVertex(P[1],S,o),j=e.addVertex(P[2],S,o);e.addTriangle(N,U,V),e.addTriangle(U,j,V),L(b,b),L(w,w);const W=e.addVertex(I[2],b,o),q=e.addVertex(I[3],b,o),X=e.addVertex(P[2],w,o),Z=e.addVertex(P[3],w,o);e.addTriangle(W,q,X),e.addTriangle(q,Z,X);const Y=this.isTerminalVertex(r.a,s),K=this.isTerminalVertex(r.b,s);c.height<.01&&Y&&e.addQuad(I[3],I[2],I[1],I[0],L(h,h),o),u.height<.01&&K&&e.addQuad(P[0],P[1],P[2],P[3],d,o)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,t,n,i,r,o){e.clearVertexLookup();let s=Number.POSITIVE_INFINITY;const a=(e,t)=>e.featureInfo.featureIndex-t.featureInfo.featureIndex;this.sortSubarray(i,r.min,r.max,a),this.sortSubarray(i,o.min,o.max,a);const l=e=>k(e,e),c=[{coord:new xe(0,0),height:0},{coord:new xe(0,0),height:0}],u=(e,t)=>e<t,h=x(),d=x(),f=x(),p=x(),m=x();for(let g=r.min;g<r.max;g++){if(!this.prepareEdgePoints(c,t,n,i[g],u))continue;const[r,o]=c,a=l(T(m,-(o.coord.y-r.coord.y),o.coord.x-r.coord.x,0));s=this.addFeatureSection(i[g].featureInfo.featureIndex,s,this.tunnelFeatureSections,e),e.addQuad(T(h,r.coord.x,r.coord.y,r.height),T(d,o.coord.x,o.coord.y,o.height),T(f,o.coord.x,o.coord.y,i[g].isTunnel?-.1:0),T(p,r.coord.x,r.coord.y,i[g].isTunnel?-.1:0),a)}for(let g=o.min;g<o.max;g++){const r=i[g];r.isTunnel&&([r.a,r.b]=[r.b,r.a]);const o=t[r.a],a=t[r.b],c=l(T(m,-(a.y-o.y),a.x-o.x,0));s=this.addFeatureSection(r.featureInfo.featureIndex,s,this.tunnelFeatureSections,e),e.addQuad(T(h,a.x,a.y,0),T(d,o.x,o.y,0),T(f,o.x,o.y,n[r.a]+4),T(p,a.x,a.y,n[r.b]+4),c),e.addQuad(T(h,o.x,o.y,0),T(d,a.x,a.y,0),T(f,a.x,a.y,n[r.b]+4),T(p,o.x,o.y,n[r.a]+4),c)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,t,n,i){e.coord.x=t,e.coord.y=n,e.height=i}prepareEdgePoints(e,t,n,i,r){let o=t[i.a].x,s=t[i.a].y,a=t[i.b].x,l=t[i.b].y,c=n[i.a],u=n[i.b];const h=r(c,0),d=r(u,0);if(h&&d)return this.setElevatedPoint(e[0],o,s,c),this.setElevatedPoint(e[1],a,l,u),!0;if(!h&&!d)return!1;if(h){if(!d){const e=u/(u-c);a=un(a,o,e),l=un(l,s,e),u=un(u,c,e)}}else{const e=c/(c-u);o=un(o,a,e),s=un(s,l,e),c=un(c,u,e)}return this.setElevatedPoint(e[0],o,s,c),this.setElevatedPoint(e[1],a,l,u),!0}prepareEdges(e,t){if(0===t.length)return;t.sort((e,t)=>e.hash===t.hash?t.polygonIdx-e.polygonIdx:t.hash>e.hash?1:-1);let n=0,i=0,r=0,o=t[n].polygonIdx;do{i++,(i===t.length||t[n].hash!==t[i].hash)&&((1==i-n||t[i-1].polygonIdx!==o)&&(r<n&&(t[r]=t[n],t[n]=null),t[r].type="none",r++),n=i,n!==t.length&&(o=t[n].polygonIdx))}while(n!==t.length);if(t.splice(r),0!==t.length&&0!==e.length){t.sort((e,t)=>e.portalHash<t.portalHash?1:-1);let n=0,i=0;for(;n!==t.length&&i!==e.length;){const r=t[n],o=e[i];r.portalHash>o.hash?n++:o.hash>r.portalHash?i++:(r.type=o.type,n++)}}}isOnBorder(e,t){return e<=0&&t<=0||e>=Li&&t>=Li}addFeatureSection(e,t,n,i){return e!==t&&(t=e,n.push({featureIndex:e,vertexStart:i.getVertexCount()}),i.clearVertexLookup()),t}sortSubarray(e,t,n,i){const r=e.slice(t,n);r.sort(i),e.splice(t,r.length,...r)}static computeEdgeHash(e,t){return(e.y===t.y&&e.x>t.x||e.y>t.y)&&([e,t]=[t,e]),BigInt($h.computePosHash(e))<<32n|BigInt($h.computePosHash(t))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var ed,td={exports:{}},nd=(ed||(ed=1,function(e,t){!function(e){function t(e,t){return e>t?1:e<t?-1:0}var n=function(e,n){void 0===e&&(e=t),void 0===n&&(n=!1),this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!n},i={size:{configurable:!0}};function r(e,t,n,i,o){var s=o-i;if(s>0){var a=i+Math.floor(s/2),l={key:t[a],data:n[a],parent:e};return l.left=r(l,t,n,i,a),l.right=r(l,t,n,a+1,o),l}return null}function o(e,t,n,i,r){if(!(n>=i)){for(var s=e[n+i>>1],a=n-1,l=i+1;;){do{a++}while(r(e[a],s)<0);do{l--}while(r(e[l],s)>0);if(a>=l)break;var c=e[a];e[a]=e[l],e[l]=c,c=t[a],t[a]=t[l],t[l]=c}o(e,t,n,l,r),o(e,t,l+1,i,r)}}n.prototype.rotateLeft=function(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t},n.prototype.rotateRight=function(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t},n.prototype._splay=function(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}},n.prototype.splay=function(e){for(var t,n,i,r,o;e.parent;)(n=(t=e.parent).parent)&&n.parent?((i=n.parent).left===n?i.left=e:i.right=e,e.parent=i):(e.parent=null,this._root=e),r=e.left,o=e.right,e===t.left?(n&&(n.left===t?(t.right?(n.left=t.right,n.left.parent=n):n.left=null,t.right=n,n.parent=t):(r?(n.right=r,r.parent=n):n.right=null,e.left=n,n.parent=e)),o?(t.left=o,o.parent=t):t.left=null,e.right=t,t.parent=e):(n&&(n.right===t?(t.left?(n.right=t.left,n.right.parent=n):n.right=null,t.left=n,n.parent=t):(o?(n.left=o,o.parent=n):n.left=null,e.right=n,n.parent=e)),r?(t.right=r,r.parent=t):t.right=null,e.left=t,t.parent=e)},n.prototype.replace=function(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)},n.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.insert=function(e,t){var n=this._root,i=null,r=this._compare;if(this._noDuplicates)for(;n;){if(i=n,0===r(n.key,e))return;n=r(n.key,e)<0?n.right:n.left}else for(;n;)i=n,n=r(n.key,e)<0?n.right:n.left;return n={key:e,data:t,left:null,right:null,parent:i},i?r(i.key,n.key)<0?i.right=n:i.left=n:this._root=n,this.splay(n),this._size++,n},n.prototype.find=function(e){for(var t=this._root,n=this._compare;t;){var i=n(t.key,e);if(i<0)t=t.right;else{if(!(i>0))return t;t=t.left}}return null},n.prototype.contains=function(e){for(var t=this._root,n=this._compare;t;){var i=n(e,t.key);if(0===i)return!0;t=i<0?t.left:t.right}return!1},n.prototype.remove=function(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),t.left)if(t.right){var n=this.minNode(t.right);n.parent!==t&&(this.replace(n,n.right),n.right=t.right,n.right.parent=n),this.replace(t,n),n.left=t.left,n.left.parent=n}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},n.prototype.removeNode=function(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},n.prototype.erase=function(e){var t=this.find(e);if(t){this.splay(t);var n=t.left,i=t.right,r=null;n&&(n.parent=null,r=this.maxNode(n),this.splay(r),this._root=r),i&&(n?r.right=i:this._root=i,i.parent=r),this._size--}},n.prototype.pop=function(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t},n.prototype.next=function(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t},n.prototype.prev=function(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t},n.prototype.forEach=function(e){for(var t=this._root,n=[],i=!1,r=0;!i;)t?(n.push(t),t=t.left):n.length>0?(e(t=n.pop(),r++),t=t.right):i=!0;return this},n.prototype.range=function(e,t,n,i){for(var r=[],o=this._compare,s=this._root;0!==r.length||s;)if(s)r.push(s),s=s.left;else{if(o((s=r.pop()).key,t)>0)break;if(o(s.key,e)>=0&&n.call(i,s))return this;s=s.right}return this},n.prototype.keys=function(){for(var e=this._root,t=[],n=[],i=!1;!i;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),n.push(e.key),e=e.right):i=!0;return n},n.prototype.values=function(){for(var e=this._root,t=[],n=[],i=!1;!i;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),n.push(e.data),e=e.right):i=!0;return n},n.prototype.at=function(e){for(var t=this._root,n=[],i=!1,r=0;!i;)if(t)n.push(t),t=t.left;else if(n.length>0){if(t=n.pop(),r===e)return t;r++,t=t.right}else i=!0;return null},n.prototype.load=function(e,t,n){if(void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var i=e.length;return n&&o(e,t,0,i-1,this._compare),this._root=r(null,e,t,0,i),this._size=i,this},n.prototype.min=function(){var e=this.minNode(this._root);return e?e.key:null},n.prototype.max=function(){var e=this.maxNode(this._root);return e?e.key:null},n.prototype.isEmpty=function(){return null===this._root},i.size.get=function(){return this._size},n.createTree=function(e,t,i,r,o){return new n(i,o).load(e,t,r)},Object.defineProperties(n.prototype,i);var s=0,a=1,l=2,c=3,u=0,h=1,d=2,f=3;function p(e,t,n){null===t?(e.inOut=!1,e.otherInOut=!0):(e.isSubject===t.isSubject?(e.inOut=!t.inOut,e.otherInOut=t.otherInOut):(e.inOut=!t.otherInOut,e.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(e.prevInResult=!m(t,n)||t.isVertical()?t.prevInResult:t));var i=m(e,n);e.resultTransition=i?function(e,t){var n,i=!e.inOut,r=!e.otherInOut;switch(t){case u:n=i&&r;break;case h:n=i||r;break;case f:n=i^r;break;case d:n=e.isSubject?i&&!r:r&&!i}return n?1:-1}(e,n):0}function m(e,t){switch(e.type){case s:switch(t){case u:return!e.otherInOut;case h:return e.otherInOut;case d:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case f:return!0}break;case l:return t===u||t===h;case c:return t===d;case a:return!1}return!1}var g=function(e,t,n,i,r){this.left=t,this.point=e,this.otherEvent=n,this.isSubject=i,this.type=r||s,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},_={inResult:{configurable:!0}};function y(e,t){return e[0]===t[0]&&e[1]===t[1]}g.prototype.isBelow=function(e){var t=this.point,n=this.otherEvent.point;return this.left?(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])>0:(n[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(n[1]-e[1])>0},g.prototype.isAbove=function(e){return!this.isBelow(e)},g.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},_.inResult.get=function(){return 0!==this.resultTransition},g.prototype.clone=function(){var e=new g(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e},Object.defineProperties(g.prototype,_);var v=11102230246251565e-32,x=134217729,b=(3+8*v)*v;function w(e,t,n,i,r){var o,s,a,l,c=t[0],u=i[0],h=0,d=0;u>c==u>-c?(o=c,c=t[++h]):(o=u,u=i[++d]);var f=0;if(h<e&&d<n)for(u>c==u>-c?(a=o-((s=c+o)-c),c=t[++h]):(a=o-((s=u+o)-u),u=i[++d]),o=s,0!==a&&(r[f++]=a);h<e&&d<n;)u>c==u>-c?(a=o-((s=o+c)-(l=s-o))+(c-l),c=t[++h]):(a=o-((s=o+u)-(l=s-o))+(u-l),u=i[++d]),o=s,0!==a&&(r[f++]=a);for(;h<e;)a=o-((s=o+c)-(l=s-o))+(c-l),c=t[++h],o=s,0!==a&&(r[f++]=a);for(;d<n;)a=o-((s=o+u)-(l=s-o))+(u-l),u=i[++d],o=s,0!==a&&(r[f++]=a);return 0===o&&0!==f||(r[f++]=o),f}function E(e){return new Float64Array(e)}var T=33306690738754716e-32,A=22204460492503146e-32,S=11093356479670487e-47,D=E(4),C=E(8),I=E(12),R=E(16),P=E(4);function M(e,t,n){var i=function(e,t,n,i,r,o){var s=(t-o)*(n-r),a=(e-r)*(i-o),l=s-a;if(0===s||0===a||s>0!=a>0)return l;var c=Math.abs(s+a);return Math.abs(l)>=T*c?l:-function(e,t,n,i,r,o,s){var a,l,c,u,h,d,f,p,m,g,_,y,v,E,T,M,F,L,k=e-r,O=n-r,B=t-o,z=i-o;D[0]=(T=(p=k-(f=(d=x*k)-(d-k)))*(g=z-(m=(d=x*z)-(d-z)))-((E=k*z)-f*m-p*m-f*g))-((_=T-(F=(p=B-(f=(d=x*B)-(d-B)))*(g=O-(m=(d=x*O)-(d-O)))-((M=B*O)-f*m-p*m-f*g)))+(h=T-_))+(h-F),D[1]=(v=E-((y=E+_)-(h=y-E))+(_-h))-((_=v-M)+(h=v-_))+(h-M),D[2]=y-((L=y+_)-(h=L-y))+(_-h),D[3]=L;var N=function(e,t){for(var n=t[0],i=1;i<4;i++)n+=t[i];return n}(0,D),U=A*s;if(N>=U||-N>=U)return N;if(a=e-(k+(h=e-k))+(h-r),c=n-(O+(h=n-O))+(h-r),l=t-(B+(h=t-B))+(h-o),u=i-(z+(h=i-z))+(h-o),0===a&&0===l&&0===c&&0===u)return N;if(U=S*s+b*Math.abs(N),(N+=k*u+z*a-(B*c+O*l))>=U||-N>=U)return N;P[0]=(T=(p=a-(f=(d=x*a)-(d-a)))*(g=z-(m=(d=x*z)-(d-z)))-((E=a*z)-f*m-p*m-f*g))-((_=T-(F=(p=l-(f=(d=x*l)-(d-l)))*(g=O-(m=(d=x*O)-(d-O)))-((M=l*O)-f*m-p*m-f*g)))+(h=T-_))+(h-F),P[1]=(v=E-((y=E+_)-(h=y-E))+(_-h))-((_=v-M)+(h=v-_))+(h-M),P[2]=y-((L=y+_)-(h=L-y))+(_-h),P[3]=L;var V=w(4,D,4,P,C);P[0]=(T=(p=k-(f=(d=x*k)-(d-k)))*(g=u-(m=(d=x*u)-(d-u)))-((E=k*u)-f*m-p*m-f*g))-((_=T-(F=(p=B-(f=(d=x*B)-(d-B)))*(g=c-(m=(d=x*c)-(d-c)))-((M=B*c)-f*m-p*m-f*g)))+(h=T-_))+(h-F),P[1]=(v=E-((y=E+_)-(h=y-E))+(_-h))-((_=v-M)+(h=v-_))+(h-M),P[2]=y-((L=y+_)-(h=L-y))+(_-h),P[3]=L;var j=w(V,C,4,P,I);P[0]=(T=(p=a-(f=(d=x*a)-(d-a)))*(g=u-(m=(d=x*u)-(d-u)))-((E=a*u)-f*m-p*m-f*g))-((_=T-(F=(p=l-(f=(d=x*l)-(d-l)))*(g=c-(m=(d=x*c)-(d-c)))-((M=l*c)-f*m-p*m-f*g)))+(h=T-_))+(h-F),P[1]=(v=E-((y=E+_)-(h=y-E))+(_-h))-((_=v-M)+(h=v-_))+(h-M),P[2]=y-((L=y+_)-(h=L-y))+(_-h),P[3]=L;var G=w(j,I,4,P,R);return R[G-1]}(e,t,n,i,r,o,c)}(e[0],e[1],t[0],t[1],n[0],n[1]);return i>0?-1:i<0?1:0}function F(e,t){var n=e.point,i=t.point;return n[0]>i[0]?1:n[0]<i[0]?-1:n[1]!==i[1]?n[1]>i[1]?1:-1:function(e,t,n){return e.left!==t.left?e.left?1:-1:0!==M(n,e.otherEvent.point,t.otherEvent.point)?e.isBelow(t.otherEvent.point)?-1:1:!e.isSubject&&t.isSubject?1:-1}(e,t,n)}function L(e,t,n){var i=new g(t,!1,e,e.isSubject),r=new g(t,!0,e.otherEvent,e.isSubject);return y(e.point,e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",e),i.contourId=r.contourId=e.contourId,F(r,e.otherEvent)>0&&(e.otherEvent.left=!0,r.left=!1),e.otherEvent.otherEvent=r,e.otherEvent=i,n.push(r),n.push(i),n}function k(e,t){return e[0]*t[1]-e[1]*t[0]}function O(e,t){return e[0]*t[0]+e[1]*t[1]}function B(e,t,n){var i=function(e,t,n,i){var r=[t[0]-e[0],t[1]-e[1]],o=[i[0]-n[0],i[1]-n[1]];function s(e,t,n){return[e[0]+t*n[0],e[1]+t*n[1]]}var a=[n[0]-e[0],n[1]-e[1]],l=k(r,o),c=l*l,u=O(r,r);if(c>0){var h=k(a,o)/l;if(h<0||h>1)return null;var d=k(a,r)/l;return d<0||d>1?null:0===h||1===h?[s(e,h,r)]:0===d||1===d?[s(n,d,o)]:[s(e,h,r)]}if((c=(l=k(a,r))*l)>0)return null;var f=O(r,a)/u,p=f+O(r,o)/u,m=Math.min(f,p),g=Math.max(f,p);return m<=1&&g>=0?1===m?[s(e,m>0?m:0,r)]:0===g?[s(e,g<1?g:1,r)]:[s(e,m>0?m:0,r),s(e,g<1?g:1,r)]:null}(e.point,e.otherEvent.point,t.point,t.otherEvent.point),r=i?i.length:0;if(0===r)return 0;if(1===r&&(y(e.point,t.point)||y(e.otherEvent.point,t.otherEvent.point)))return 0;if(2===r&&e.isSubject===t.isSubject)return 0;if(1===r)return y(e.point,i[0])||y(e.otherEvent.point,i[0])||L(e,i[0],n),y(t.point,i[0])||y(t.otherEvent.point,i[0])||L(t,i[0],n),1;var o=[],s=!1,u=!1;return y(e.point,t.point)?s=!0:1===F(e,t)?o.push(t,e):o.push(e,t),y(e.otherEvent.point,t.otherEvent.point)?u=!0:1===F(e.otherEvent,t.otherEvent)?o.push(t.otherEvent,e.otherEvent):o.push(e.otherEvent,t.otherEvent),s&&u||s?(t.type=a,e.type=t.inOut===e.inOut?l:c,s&&!u&&L(o[1].otherEvent,o[0].point,n),2):u?(L(o[0],o[1].point,n),3):o[0]!==o[3].otherEvent?(L(o[0],o[1].point,n),L(o[1],o[2].point,n),3):(L(o[0],o[1].point,n),L(o[3].otherEvent,o[2].point,n),3)}function z(e,t){if(e===t)return 0;if(0!==M(e.point,e.otherEvent.point,t.point)||0!==M(e.point,e.otherEvent.point,t.otherEvent.point))return y(e.point,t.point)?e.isBelow(t.otherEvent.point)?-1:1:e.point[0]===t.point[0]?e.point[1]<t.point[1]?-1:1:1===F(e,t)?t.isAbove(e.point)?-1:1:e.isBelow(t.point)?-1:1;if(e.isSubject!==t.isSubject)return e.isSubject?-1:1;var n=e.point,i=t.point;return n[0]===i[0]&&n[1]===i[1]?(n=e.otherEvent.point)[0]===(i=t.otherEvent.point)[0]&&n[1]===i[1]?0:e.contourId>t.contourId?1:-1:1===F(e,t)?1:-1}var N=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function U(e,t,n,i){var r,o=e+1,s=t[e].point,a=t.length;for(o<a&&(r=t[o].point);o<a&&r[0]===s[0]&&r[1]===s[1];){if(!n[o])return o;++o<a&&(r=t[o].point)}for(o=e-1;n[o]&&o>i;)o--;return o}N.prototype.isExterior=function(){return null==this.holeOf};var V=G,j=G;function G(e,t){if(!(this instanceof G))return new G(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||H,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function H(e,t){return e<t?-1:e>t?1:0}G.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i},_down:function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var o=1+(e<<1),s=o+1,a=t[o];if(s<this.length&&n(t[s],a)<0&&(o=s,a=t[s]),n(a,r)>=0)break;t[e]=a,e=o}t[e]=r}},V.default=j;var W=Math.max,q=Math.min,X=0;function Z(e,t,n,i,r,o){var s,a,l,c,u,h;for(s=0,a=e.length-1;s<a;s++)if(c=e[s+1],u=new g(l=e[s],!1,void 0,t),h=new g(c,!1,u,t),u.otherEvent=h,l[0]!==c[0]||l[1]!==c[1]){u.contourId=h.contourId=n,o||(u.isExteriorRing=!1,h.isExteriorRing=!1),F(u,h)>0?h.left=!0:u.left=!0;var d=l[0],f=l[1];r[0]=q(r[0],d),r[1]=q(r[1],f),r[2]=W(r[2],d),r[3]=W(r[3],f),i.push(u),i.push(h)}}var Y=[];function K(e,t,i){"number"==typeof e[0][0][0]&&(e=[e]),"number"==typeof t[0][0][0]&&(t=[t]);var r=function(e,t,n){var i=null;return e.length*t.length==0&&(n===u?i=Y:n===d?i=e:n!==h&&n!==f||(i=0===e.length?t:e)),i}(e,t,i);if(r)return r===Y?null:r;var o=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],a=function(e,t,n,i,r){var o,s,a,l,c,u,h=new V(null,F);for(a=0,l=e.length;a<l;a++)for(c=0,u=(o=e[a]).length;c<u;c++)(s=0===c)&&X++,Z(o[c],!0,X,h,n,s);for(a=0,l=t.length;a<l;a++)for(c=0,u=(o=t[a]).length;c<u;c++)s=0===c,r===d&&(s=!1),s&&X++,Z(o[c],!1,X,h,i,s);return h}(e,t,o,s,i);if(r=function(e,t,n,i,r){var o=null;return(n[0]>i[2]||i[0]>n[2]||n[1]>i[3]||i[1]>n[3])&&(r===u?o=Y:r===d?o=e:r!==h&&r!==f||(o=e.concat(t))),o}(e,t,o,s,i))return r===Y?null:r;for(var l=function(e){var t,n,i=function(e){var t,n,i,r,o=[];for(n=0,i=e.length;n<i;n++)((t=e[n]).left&&t.inResult||!t.left&&t.otherEvent.inResult)&&o.push(t);for(var s=!1;!s;)for(s=!0,n=0,i=o.length;n<i;n++)n+1<i&&1===F(o[n],o[n+1])&&(r=o[n],o[n]=o[n+1],o[n+1]=r,s=!1);for(n=0,i=o.length;n<i;n++)(t=o[n]).otherPos=n;for(n=0,i=o.length;n<i;n++)(t=o[n]).left||(r=t.otherPos,t.otherPos=t.otherEvent.otherPos,t.otherEvent.otherPos=r);return o}(e),r={},o=[],s=function(){if(!r[t]){var e=o.length,n=function(e,t,n){var i=new N;if(null!=e.prevInResult){var r=e.prevInResult,o=r.outputContourId;if(r.resultTransition>0){var s=t[o];if(null!=s.holeOf){var a=s.holeOf;t[a].holeIds.push(n),i.holeOf=a,i.depth=t[o].depth}else t[o].holeIds.push(n),i.holeOf=o,i.depth=t[o].depth+1}else i.holeOf=null,i.depth=t[o].depth}else i.holeOf=null,i.depth=0;return i}(i[t],o,e),s=function(t){r[t]=!0,t<i.length&&i[t]&&(i[t].outputContourId=e)},a=t,l=t;for(n.points.push(i[t].point);s(a),s(a=i[a].otherPos),n.points.push(i[a].point),!((a=U(a,i,r,l))==l||a>=i.length)&&i[a];);o.push(n)}};for(t=0,n=i.length;t<n;t++)s();return o}(function(e,t,i,r,o,s){for(var a,l,c,h=new n(z),f=[],m=Math.min(r[2],o[2]);0!==e.length;){var g=e.pop();if(f.push(g),s===u&&g.point[0]>m||s===d&&g.point[0]>r[2])break;if(g.left){l=a=h.insert(g),a=a!==(c=h.minNode())?h.prev(a):null,l=h.next(l);var _=a?a.key:null;if(p(g,_,s),l&&2===B(g,l.key,e)&&(p(g,_,s),p(l.key,g,s)),a&&2===B(a.key,g,e)){var y=a;p(_,(y=y!==c?h.prev(y):null)?y.key:null,s),p(g,_,s)}}else l=a=h.find(g=g.otherEvent),a&&l&&(a=a!==c?h.prev(a):null,l=h.next(l),h.remove(g),l&&a&&B(a.key,l.key,e))}return f}(a,0,0,o,s,i)),c=[],m=0;m<l.length;m++){var g=l[m];if(g.isExterior()){for(var _=[g.points],y=0;y<g.holeIds.length;y++)_.push(l[g.holeIds[y]].points);c.push(_)}}return c}var J={UNION:h,DIFFERENCE:d,INTERSECTION:u,XOR:f};e.diff=function(e,t){return K(e,t,d)},e.intersection=function(e,t){return K(e,t,u)},e.operations=J,e.union=function(e,t){return K(e,t,h)},e.xor=function(e,t){return K(e,t,f)},Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,td.exports)),td.exports);function id(e,t,n,i){const r=[],o=0===i?(e,t,n,i,r,o)=>{e.push(new xe(o,n+(o-t)/(i-t)*(r-n)))}:(e,t,n,i,r,o)=>{e.push(new xe(t+(o-n)/(r-n)*(i-t),o))};for(const s of e){const e=[];for(const r of s){if(r.length<=2)continue;const s=[];for(let e=0;e<r.length-1;e++){const a=r[e].x,l=r[e].y,c=r[e+1].x,u=r[e+1].y,h=0===i?a:l,d=0===i?c:u;h<t?d>t&&o(s,a,l,c,u,t):h>n?d<n&&o(s,a,l,c,u,n):s.push(r[e]),d<t&&h>=t&&o(s,a,l,c,u,t),d>n&&h<=n&&o(s,a,l,c,u,n)}let a=r[r.length-1];const l=0===i?a.x:a.y;l>=t&&l<=n&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),e.push(s))}e.length&&r.push(e)}return r}function rd(e,t){const n=sd(e),i=sd([t]),r=nd.intersection(n,i);return null==r?[]:ad(r)}function od(e,t){const n=65536;let i=sd(e,n);for(;t.valid();t.next()){const[e,r]=t.get(),o=e.x*n,s=e.y*n,a=r.x*n,l=r.y*n,c=a-o,u=l-s,h=Math.hypot(c,u),d=Math.trunc(u/h*3),f=-Math.trunc(c/h*3);i=nd.diff(i,[[[o,s],[a,l],[a+d,l+f],[o+d,s+f],[o,s]]])}return ad(i,1/n)}function sd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[e.map(e=>e.map(e=>[e.x*t,e.y*t]))]}function ad(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.map(e=>e.map((e,n)=>{const i=e.map(e=>new xe(e[0]*t,e[1]*t).round());return n>0&&i.reverse(),i}))}class ld{constructor(e,t){this.layoutVertexArray=new ia,this.indexArray=new Ta,this.lineIndexArray=new va,this.triangleSegments=new tl,this.lineSegments=new tl,this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,t&&(this.elevatedLayoutVertexArray=new sa)}update(e,t,n,i,r,o,s,a){this.programConfigurations.updatePaintArrays(e,t,r,n,i,o,s,a)}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,gh.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,t,n,i,r,o,s){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,t,n,i,r,o,void 0,s)}}class cd{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new ld(e,!1),this.elevationBufferData=new ld(e,!0),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,i){this.hasPattern=Zh("fill",this.layers,this.pixelRatio,t);const r=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=yc(s,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),u,n))continue;const h=r?r.evaluate(u,{},n,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:_c(s,n,i),patterns:{},sortKey:h};o.push(d)}r&&o.sort((e,t)=>e.sortKey-t.sortKey);for(const s of o){const{geometry:i,index:r,sourceLayerIndex:o}=s;if(this.hasPattern){const e=Yh("fill",this.layers,s,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(s,i,r,n,{},t.availableImages,t.brightness,t.elevationFeatures);t.featureIndex.insert(e[r].feature,i,r,o,this.index)}}update(e,t,n,i,r,o,s){this.bufferData.update(e,t,n,i,r,o,s,this.worldview),this.elevationBufferData.update(e,t,n,i,r,o,s,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,t,n,i,r,o,s,this.worldview)}addFeatures(e,t,n,i,r,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,t,n,i,o,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;const l=Wh(t,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(e,l,i,n,a):this.addGeometry(l,this.bufferData),this.bufferData.populatePaintArrays(e,n,r,o,i,s,this.worldview),this.elevationBufferData.populatePaintArrays(e,n,r,o,i,s,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,t,n,i,r){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(t,n,i,r,this.worldview))}addElevatedRoadFeature(e,t,n,i,r){const o=new Array,s=Hc.getElevationFeature(e,r);if(!s)return void this.addGeometry(t,this.bufferData);{const e=this.clipPolygonsToTile(t,1);e.length>0&&o.push({polygons:e,elevationFeature:s,elevationTileID:n})}const a={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},n),featureIndex:i};for(const l of o)if(l.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new $h(l.elevationTileID,this.layers,this.zoom,this.lut));const t=l.elevationFeature.isTunnel();let n=0;e.properties.hasOwnProperty(Dc)&&(n=+e.properties[Dc]);for(const e of l.polygons)this.elevatedStructures.addPortalCandidates(l.elevationFeature.id,e,t,l.elevationFeature,n)}null==l.elevationFeature.constantHeight&&(l.polygons=this.prepareElevatedPolygons(l.polygons,l.elevationFeature,l.elevationTileID));const t=new Wc(n,l.elevationTileID);this.addElevatedGeometry(l.polygons,t,l.elevationFeature,"hd-road-base"===this.elevationMode?0:.05,i,a)}}addElevatedGeometry(e,t,n,i,r,o){const s={elevation:n,elevationSampler:t,bias:i,index:r,featureInfo:o},[a,l]=this.addGeometry(e,this.elevationBufferData,s);null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:a,max:l}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,a),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,l))}addGeometry(e,t,n){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=null;n&&(o=n.elevationSampler.constantElevation(n.elevation,n.bias),null!=o&&(i=o,r=o));const s=(e,s,a)=>{if(null!=n)if(s.push(e),null!=o)t.elevatedLayoutVertexArray.emplaceBack(o),a.push(o);else{const o=n.elevationSampler.pointElevation(e,n.elevation,n.bias);t.elevatedLayoutVertexArray.emplaceBack(o),a.push(o),i=Math.min(i,o),r=Math.max(r,o)}};for(const a of e){let e=0;for(const t of a)e+=t.length;const i=t.triangleSegments.prepareSegment(e,t.layoutVertexArray,t.indexArray),r=i.vertexLength,o=[],l=[],c=[],u=[],h=[],d=t.layoutVertexArray.length;for(const p of a){if(0===p.length)continue;p!==a[0]&&l.push(o.length/2);const e=t.lineSegments.prepareSegment(p.length,t.layoutVertexArray,t.lineIndexArray),i=e.vertexLength;n&&h.push(t.layoutVertexArray.length-d),s(p[0],c,u),t.layoutVertexArray.emplaceBack(p[0].x,p[0].y),t.lineIndexArray.emplaceBack(i+p.length-1,i),o.push(p[0].x),o.push(p[0].y);for(let n=1;n<p.length;n++)s(p[n],c,u),t.layoutVertexArray.emplaceBack(p[n].x,p[n].y),t.lineIndexArray.emplaceBack(i+n-1,i+n),o.push(p[n].x),o.push(p[n].y);e.vertexLength+=p.length,e.primitiveLength+=p.length}const f=vh(o,l);for(let n=0;n<f.length;n+=3)t.indexArray.emplaceBack(r+f[n],r+f[n+1],r+f[n+2]);if(f.length>0&&n&&"hd-road-base"===this.elevationMode){const e=n.elevation.isTunnel(),t=n.elevation.safeArea,i=this.elevatedStructures.addVertices(c,u);this.elevatedStructures.addTriangles(f,i,e);const r=h.length;if(r>0){for(let o=0;o<r-1;o++)this.elevatedStructures.addRenderableRing(n.index,h[o]+i,h[o+1]-h[o],e,t,n.featureInfo);this.elevatedStructures.addRenderableRing(n.index,h[r-1]+i,c.length-h[r-1],e,t,n.featureInfo)}}i.vertexLength+=e,i.primitiveLength+=f.length/3}return[i,r]}prepareElevatedPolygons(e,t,n){const i=1/lc(n),r=[];for(const o of e){const e=od(o,new jc(t,i));r.push(...e)}return r}clipPolygonsToTile(e,t){const n=-t,i=-t,r=Li+t,o=Li+t;let s=0;const a=[],l=[];for(;s<e.length;s++){const t=e[s],c=di(t);(c.min.x>=n&&c.max.x<=r&&c.min.y>=i&&c.max.y<=o?a:l).push(t)}if(a.length===e.length)return e;const c=[new xe(n,i),new xe(r,i),new xe(r,o),new xe(n,o),new xe(n,i)],u=a;for(const h of l)u.push(...rd(h,c));return u}}let ud,hd,dd,fd;Xo(cd,"FillBucket",{omit:["layers","patternFeatures"]}),Xo(ld,"FillBufferData"),Xo($h,"ElevatedStructures");class pd{constructor(e,t,n,i){if(this.triangleCount=t.length/3,this.min=new xe(0,0),this.max=new xe(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;const[r,o]=[e[0].clone(),e[0].clone()];for(let u=1;u<e.length;++u){const t=e[u];r.x=Math.min(r.x,t.x),r.y=Math.min(r.y,t.y),o.x=Math.max(o.x,t.x),o.y=Math.max(o.y,t.y)}if(i){const e=Math.ceil(Math.max(o.x-r.x,o.y-r.y)/i);n=Math.max(n,e)}if(0===n)return;this.min=r,this.max=o;const s=this.max.sub(this.min);s.x=Math.max(s.x,1),s.y=Math.max(s.y,1);const a=Math.max(s.x,s.y)/n;this.cellsX=Math.max(1,Math.ceil(s.x/a)),this.cellsY=Math.max(1,Math.ceil(s.y/a)),this.xScale=1/a,this.yScale=1/a;const l=[];for(let u=0;u<this.triangleCount;u++){const n=e[t[3*u+0]].sub(this.min),i=e[t[3*u+1]].sub(this.min),r=e[t[3*u+2]].sub(this.min),o=md(Math.floor(Math.min(n.x,i.x,r.x)),this.xScale,this.cellsX),s=md(Math.floor(Math.max(n.x,i.x,r.x)),this.xScale,this.cellsX),c=md(Math.floor(Math.min(n.y,i.y,r.y)),this.yScale,this.cellsY),h=md(Math.floor(Math.max(n.y,i.y,r.y)),this.yScale,this.cellsY),d=new xe(0,0),f=new xe(0,0),p=new xe(0,0),m=new xe(0,0);for(let e=c;e<=h;++e){d.y=f.y=e*a,p.y=m.y=(e+1)*a;for(let t=o;t<=s;++t)d.x=p.x=t*a,f.x=m.x=(t+1)*a,(lu(n,i,r,d,f,m)||lu(n,i,r,d,m,p))&&l.push({cellIdx:e*this.cellsX+t,triIdx:u})}}if(0===l.length)return;l.sort((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx);let c=0;for(;c<l.length;){const e=l[c].cellIdx,t={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===e;)++t.len,this.payload.push(l[c++].triIdx);this.cells[e]=t}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,t){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const n=md(e.x-this.min.x,this.xScale,this.cellsX),i=md(e.y-this.min.y,this.yScale,this.cellsY),r=this.cells[i*this.cellsX+n];if(r){this._lazyInitLookup();for(let e=0;e<r.len;e++){const n=this.payload[r.start+e],i=Math.floor(n/8),o=1<<n%8;if(!(this.lookup[i]&o)&&(this.lookup[i]|=o,t.push(n),t.length===this.triangleCount))return}}}query(e,t,n){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this._lazyInitLookup();const i=md(e.x-this.min.x,this.xScale,this.cellsX),r=md(t.x-this.min.x,this.xScale,this.cellsX),o=md(e.y-this.min.y,this.yScale,this.cellsY),s=md(t.y-this.min.y,this.yScale,this.cellsY);for(let a=o;a<=s;a++)for(let e=i;e<=r;e++){const t=this.cells[a*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const i=this.payload[t.start+e],r=Math.floor(i/8),o=1<<i%8;if(!(this.lookup[r]&o)&&(this.lookup[r]|=o,n.push(i),n.length===this.triangleCount))return}}}}function md(e,t,n){return Math.max(0,Math.min(n-1,Math.floor(e*t)))}Xo(pd,"TriangleGridIndex");class gd{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,t){for(const n of this.footprints)t.push({footprint:n,id:e})}populate(e,t,n,i){const r=[];for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,t=yc(o,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),t,n))continue;const c={id:s,properties:o.properties,type:o.type,sourceLayerIndex:l,index:a,geometry:e?t.geometry:_c(o,n,i),patterns:{}};r.push(c)}for(const o of r){const{geometry:i,index:r,sourceLayerIndex:s}=o;this.addFeature(o,i,r,n,{},t.availableImages,t.brightness),t.featureIndex.insert(e[r].feature,i,r,s,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(e){}update(e,t,n,i,r,o,s){}destroy(){}addFeature(e,t,n,i,r){for(const o of Wh(t,2)){const e=[],t=[],n=[],i=new xe(1/0,1/0),r=new xe(-1/0,-1/0);for(const l of o)if(0!==l.length){l!==o[0]&&n.push(t.length/2);for(let n=0;n<l.length;n++)t.push(l[n].x),t.push(l[n].y),e.push(l[n]),i.x=Math.min(i.x,l[n].x),i.y=Math.min(i.y,l[n].y),r.x=Math.max(r.x,l[n].x),r.y=Math.max(r.y,l[n].y)}const s=vh(t,n),a=new pd(e,s,8,256);this.footprints.push({vertices:e,indices:s,grid:a,min:i,max:r})}}}Xo(gd,"ClipBucket",{omit:["layers"]});const _d=ta([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),yd=ta([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),vd=ta([{name:"a_centroid_pos",components:2,type:"Uint16"}]),xd=ta([{name:"a_join_normal_inside",components:3,type:"Int16"}]),bd=ta([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),wd=ta([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ed}=_d,Td=Number.MAX_SAFE_INTEGER,Ad=Td-1;function Sd(e,t,n,i){return e.order<t||e.order===Td||!(e.clipMask&n)||function(e,t){return 0!==t.length&&void 0===t.find(t=>t===e)}(i,e.clipScope)}function Dd(e,t){return e.x-t.x||e.y-t.y}function Cd(e,t){return 0===Dd(e.min,t.min)&&0===Dd(e.max,t.max)}function Id(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Rd(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n].sourceId!==t[n].sourceId||!Cd(e[n],t[n])||e[n].order!==t[n].order||e[n].clipMask!==t[n].clipMask||!be(e[n].clipScope,t[n].clipScope))return!1;return!0}function Pd(e,t,n){const i=1/Li,r=1/(1<<n.canonical.z),o=(t.x*i+n.canonical.x)*r+n.wrap,s=(t.y*i+n.canonical.y)*r;return{min:new xe((e.x*i+n.canonical.x)*r+n.wrap,(e.y*i+n.canonical.y)*r),max:new xe(o,s)}}function Md(e,t,n){const i=1<<n.canonical.z,r=((t.x-n.wrap)*i-n.canonical.x)*Li,o=(t.y*i-n.canonical.y)*Li;return{min:new xe(((e.x-n.wrap)*i-n.canonical.x)*Li,(e.y*i-n.canonical.y)*Li),max:new xe(r,o)}}function Fd(e,t,n,i,r,o,s){const a=e.indices,l=e.vertices,c=[];for(let u=i;u<i+r;u+=3){const i=t[n[u+0]+o],r=t[n[u+1]+o],h=t[n[u+2]+o],d=Math.min(i.x,r.x,h.x),f=Math.max(i.x,r.x,h.x),p=Math.min(i.y,r.y,h.y),m=Math.max(i.y,r.y,h.y);c.length=0,e.grid.query(new xe(d,p),new xe(f,m),c);for(let e=0;e<c.length;e++){const t=c[e];if(lu(l[a[3*t+0]],l[a[3*t+1]],l[a[3*t+2]],i,r,h,s))return!0}}return!1}function Ld(e,t,n,i){if(!e||!n)return!1;let r=e.vertices;if(!t.canonical.equals(i.canonical)||t.wrap!==i.wrap){if(n.vertices.length<e.vertices.length)return Ld(n,i,e,t);const o=t.canonical,s=i.canonical,a=Math.pow(2,s.z-o.z);r=e.vertices.map(e=>new xe((e.x+o.x*Li)*a-s.x*Li,(e.y+o.y*Li)*a-s.y*Li))}return Fd(n,r,e.indices,0,e.indices.length,0,0)}function kd(e,t,n,i){const r=Math.pow(2,i.z-n.z);return new xe((e+n.x*Li)*r-i.x*Li,(t+n.y*Li)*r-i.y*Li)}function Od(e,t){const n=[];t.grid.queryPoint(e,n);const i=t.indices,r=t.vertices;for(let o=0;o<n.length;o++){const t=n[o];if(ru([r[i[3*t+0]],r[i[3*t+1]],r[i[3*t+2]]],e))return!0}return!1}const Bd=[new xe(0,0),new xe(Li,0),new xe(Li,Li),new xe(0,Li)];function zd(e,t){const n=[];let i=[];if(!t||e.length<2)return[e];if(2===e.length)return su(e[0],e[1],Bd)?[e]:[];for(let r=0;r<e.length+2;r++){const t=e[r%e.length],o=e[(r+1)%e.length],s=su(0===r?e[e.length-1]:e[(r-1)%e.length],t,Bd),a=su(t,o,Bd),l=s||a;l&&i.push(t),l&&a||i.length>0&&(i.length>1&&n.push(i),i=[])}return i.length>1&&n.push(i),n}const Nd=vc.types,Ud=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Vd=["fill-extrusion-flood-light-ground-radius"],jd=Math.pow(2,13),Gd=Math.pow(2,15)-1,Hd=new xe(0,1),Wd=2147483648;function qd(e,t,n,i,r,o,s,a){e.emplaceBack((t<<1)+s,(n<<1)+o,(Math.floor(i*jd)<<1)+r,Math.round(a))}function Xd(e,t,n){e.emplaceBack(t.x*Li,t.y*Li,n?1:0)}function Zd(e,t,n,i,r,o){e.emplaceBack(t.x,t.y,(n.x<<1)+i,(n.y<<1)+r,o)}function Yd(e,t,n){const i=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*i,n[1]*i,n[2]*i)}class Kd{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Jd{constructor(){this.centroidXY=new xe(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new xe(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new xe(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new xe(this.max.x-this.min.x,this.max.y-this.min.y)}}class Qd{constructor(){this.acc=new xe(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,n){this.accCount++,this.acc._add(t);let i=!!this.borders;t.x<e.min.x?(e.min.x=t.x,i=!0):t.x>e.max.x&&(e.max.x=t.x,i=!0),t.y<e.min.y?(e.min.y=t.y,i=!0):t.y>e.max.y&&(e.max.y=t.y,i=!0),((0===t.x||t.x===Li)&&t.x===n.x)!=((0===t.y||t.y===Li)&&t.y===n.y)&&this.processBorderOverlap(t,n),i&&this.checkBorderIntersection(t,n)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,un(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Li!=e.x>Li&&this.addBorderIntersection(1,un(t.y,e.y,(Li-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,un(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Li!=e.y>Li&&this.addBorderIntersection(3,un(t.x,e.x,(Li-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){return 0===this.accCount?new xe(0,0):new xe(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0):0}}function $d(e,t){const n=e.add(t)._unit(),i=Re(e.x*n.x+e.y*n.y,-1,1);var r,o,s;return r=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(r)))/4*Gd*((o=e).x*(s=t).y-o.y*s.x<0?-1:1)}const ef=[e=>e.x<0,e=>e.x>Li,e=>e.y<0,e=>e.y>Li];function tf(e,t,n,i){const r=[4];if(0===i)return r;n._mult(i);const o=e.sub(n),s=t.sub(n),a=[e,t,o,s];for(let l=0;l<4;l++)for(const e of a)if(ef[l](e)){r.push(l);break}return r}class nf{constructor(e){this.vertexArray=new ca,this.indexArray=new Ta,this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut},e=>Vd.includes(e)),this._segments=new tl,this.hiddenByLandmarkVertexArray=new za,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new tl}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e.length;if(r>2){let o=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*r,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let a;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const t=e[0],n=e[1];a=$d(t.sub(e[r-1])._perp()._unit(),n.sub(t)._perp()._unit())}for(let l=0;l<r;l++){const c=l===r-1?0:l+1,u=e[l],h=e[c],d=e[c===r-1?0:c+1],f=h.sub(u)._perp()._unit(),p=$d(f,d.sub(h)._perp()._unit()),m=a,g=p;if(lf(u,h,t)||i&&cf(u,t)&&cf(h,t)){a=p;continue}const _=s.vertexLength;Zd(this.vertexArray,u,h,1,1,m),Zd(this.vertexArray,u,h,1,0,m),Zd(this.vertexArray,u,h,0,1,g),Zd(this.vertexArray,u,h,0,0,g),s.vertexLength+=4;const y=tf(u,h,f,n);for(const e of y)this._segmentToGroundQuads[o].push({id:_,region:e}),this._segmentToRegionTriCounts[o][e]+=2,s.primitiveLength+=2;a=p}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let n=0;n<t;n++)this._segmentToGroundQuads[n].sort((e,t)=>e.region-t.region);for(let n=0;n<t;n++){const t=this._segmentToGroundQuads[n],i=e[n],r=this._segmentToRegionTriCounts[n];r.reduce((e,t)=>e+t,0);let o=0;for(let e=0;e<=4;e++){const t=r[e];if(0!==t){let n=this.regionSegments[e];n||(n=this.regionSegments[e]=new tl);const r={vertexOffset:i.vertexOffset,primitiveOffset:i.primitiveOffset+o,vertexLength:i.vertexLength,primitiveLength:t};n.get().push(r)}o+=t}for(let e=0;e<t.length;e++){const n=t[e].id;this.indexArray.emplaceBack(n,n+1,n+3),this.indexArray.emplaceBack(n,n+3,n+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,n,i,r,o,s){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,n,i,r,o,void 0,s)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,yd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,n,i,r,o,s,a){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,n,i,r,o,s,a)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Wd))}updateHiddenByLandmarkRange(e,t,n){if(!this.hasData())return;const i=t+e;if(0!==t){for(let t=e;t<i;++t)this.hiddenByLandmarkVertexArray.emplace(t,n?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,bd.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class rf{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ta,this.footprintVertices=new ia,this.footprintSegments=[],this.layoutVertexArray=new oa,this.centroidVertexArray=new Ya,this.wallVertexArray=new Ja,this.indexArray=new Ta,this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut},e=>Ud.includes(e)),this.segments=new tl,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.groundEffect=new nf(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,i){this.features=[],this.hasPattern=Zh("fill-extrusion",this.layers,this.pixelRatio,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=lc(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:r,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=yc(r,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),l,n))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?l.geometry:_c(r,n,i),properties:r.properties,type:r.type,patterns:{}},u=this.layoutVertexArray.length,h="Polygon"===Nd[c.type];if(this.hasPattern)this.features.push({featureId:r.id,feature:Yh("fill-extrusion",this.layers,c,this.zoom,this.pixelRatio,t)});else if(this.wallMode)for(const o of c.geometry)for(const e of zd(o,h))this.addFeature(r.id,c,[e],s,n,{},t.availableImages,i,t.brightness);else this.addFeature(r.id,c,c.geometry,s,n,{},t.availableImages,i,t.brightness);t.featureIndex.insert(r,c.geometry,s,a,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,n,i,r,o){for(const{featureId:s,feature:a}of this.features){const e="Polygon"===Nd[a.type],{geometry:l}=a;if(this.wallMode)for(const c of l)for(const l of zd(c,e))this.addFeature(s,a,[l],a.index,t,n,i,r,o);else this.addFeature(s,a,l,a.index,t,n,i,r,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,n,i,r,o,s){this.programConfigurations.updatePaintArrays(e,t,r,n,i,o,s,this.worldview),this.groundEffect.update(e,t,r,n,i,o,s,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ed),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,xd.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,wd.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,vd.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i,r,o,s,a,l){const c=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,u=[new xe(0,0),new xe(Li,Li)],h=a.projection,d="globe"===h.name,f=this.wallMode||"Polygon"===Nd[t.type],p=new Qd;p.centroidDataIndex=this.centroidData.length;const m=new Jd;m.buildingId=e,t.properties&&t.properties.hasOwnProperty("building_id")&&(m.buildingId=t.properties.building_id);const g=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},r)<=0,_=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},r);let y;if(m.height=_,m.vertexArrayOffset=this.layoutVertexArray.length,m.groundVertexArrayOffset=this.groundEffect.vertexArray.length,d&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new pa),this.wallMode){if(d)return void He("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==n.length)return;y=function(e){const t=e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y,n=function(e){let t=0;const n=e.length;for(let i=0;i<n;i++)t+=(e[(i+1)%n].x-e[i].x)*(e[(i+1)%n].y+e[i].y);return t>=0}(e);n||(e=e.reverse());const i={geometry:[],joinNormals:[],indices:[]},r=[],o=[],s=[];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;if(a<(t?3:2))return i;let l,c,u,h,d,f=0;for(;f<a-1&&e[f].equals(e[f+1]);)f++;t&&(l=e[a-2],d=e[f].sub(l)._unit()._perp());for(let m=f;m<a;m++){if(u=m===a-1?t?e[f+1]:void 0:e[m+1],u&&e[m].equals(u))continue;d&&(h=d),l&&(c=l),l=e[m],d=u?u.sub(l)._unit()._perp():h,h=h||d;let n=h.add(d);0===n.x&&0===n.y||n._unit();const i=n.x*d.x+n.y*d.y,p=0!==i?1/i:1/0,g=h.x*d.y-h.y*d.x>0;let _="miter";const y=2;"miter"===_&&p>y&&(_="bevel"),"bevel"===_&&(p>100&&(_="flipbevel"),p<y&&(_="miter"));const v=(e,t,n,i)=>{const a=new xe(e.x,e.y),l=new xe(e.x,e.y);a.x+=t.x*i,a.y+=t.y*i,l.x-=t.x*Math.max(n,1),l.y-=t.y*Math.max(n,1),s.push(t),r.push(a),o.push(l)};if("miter"===_)n._mult(p),v(l,n,0,0);else if("flipbevel"===_)n=d.mult(-1),v(l,n,0,0),v(l,n.mult(-1),0,0);else{const e=-Math.sqrt(p*p-1),t=g?e:0,n=g?0:e;c&&v(l,h,t,n),u&&v(l,d,t,n)}}i.geometry=[...r,...o.reverse(),r[0]],i.joinNormals=[...s,...s.reverse(),s[s.length-1]];const p=i.geometry.length-1;for(let m=0;m<p/2;m++)if(m+1<p/2){let e=m,t=m+1,n=p-1-m,r=p-2-m;e=0===e?p-1:e-1,t=0===t?p-1:t-1,n=0===n?p-1:n-1,r=0===r?p-1:r-1,i.indices.push(n),i.indices.push(t),i.indices.push(e),i.indices.push(n),i.indices.push(r),i.indices.push(t)}return i}(n[0]),n=[y.geometry]}const v=(e,t)=>e<(t.length-1)/2||e===t.length-1,x=this.wallMode?[n]:Wh(n,500);for(let S=x.length-1;S>=0;S--){const e=x[S];(0===e.length||(b=e[0]).every(e=>e.x<=0)||b.every(e=>e.x>=Li)||b.every(e=>e.y<=0)||b.every(e=>e.y>=Li))&&x.splice(S,1)}var b;let w;if(d)w=ff(x,u,r);else{w=[];for(const e of x)w.push({polygon:e,bounds:u})}const E=f?this.edgeRadius:0,T=E>0&&this.zoom<17,A=(e,t)=>{if(0===e.length)return!1;const n=e[e.length-1];return t.x===n.x&&t.y===n.y};for(const{polygon:S,bounds:D}of w){let e=0,t=0;for(const r of S)f&&!r[0].equals(r[r.length-1])&&r.push(r[0]),t+=f?r.length-1:r.length;const n=this.segments.prepareSegment((f?5:4)*t,this.layoutVertexArray,this.indexArray);m.footprintSegIdx<0&&(m.footprintSegIdx=this.footprintSegments.length),m.polygonSegIdx<0&&(m.polygonSegIdx=this.polygonSegments.length);const i={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},o=new Kd;if(o.vertexOffset=this.footprintVertices.length,o.indexOffset=3*this.footprintIndices.length,o.ringIndices=[],f){const t=[],i=[];e=n.vertexLength;for(let e=0;e<S.length;e++){const s=S[e];s.length&&0!==e&&i.push(t.length/2);const a=[];let l,u;l=s[1].sub(s[0])._perp()._unit(),o.ringIndices.push(s.length-1);for(let e=1;e<s.length;e++){const i=s[e],o=s[e===s.length-1?1:e+1],c=i.clone();if(E){u=o.sub(i)._perp()._unit();const e=l.add(u)._unit(),t=E*Math.min(4,1/(l.x*e.x+l.y*e.y));c.x+=t*e.x,c.y+=t*e.y,c.x=Math.round(c.x),c.y=Math.round(c.y),l=u}if(!g||0!==E&&!T||A(a,c)||a.push(c),qd(this.layoutVertexArray,c.x,c.y,0,0,1,1,0),this.wallMode){const t=v(e,s);Xd(this.wallVertexArray,y.joinNormals[e],!t)}n.vertexLength++,this.footprintVertices.emplaceBack(i.x,i.y),t.push(i.x,i.y),d&&Yd(this.layoutVertexExtArray,h.projectTilePoint(c.x,c.y,r),h.upVector(r,c.x,c.y))}g&&(0===E||T)&&(0!==a.length&&A(a,a[0])&&a.pop(),this.groundEffect.addData(a,D,c))}const s=this.wallMode?y.indices:vh(t,i);for(let r=0;r<s.length;r+=3)this.footprintIndices.emplaceBack(o.vertexOffset+s[r+0],o.vertexOffset+s[r+1],o.vertexOffset+s[r+2]),this.indexArray.emplaceBack(e+s[r],e+s[r+2],e+s[r+1]),n.primitiveLength++;o.indexCount+=s.length,o.vertexCount+=this.footprintVertices.length-o.vertexOffset}for(let s=0;s<S.length;s++){const t=S[s];p.startRing(m,t[0]);let i=t.length>4&&uf(t[t.length-2],t[0],t[1]),o=E?sf(t[t.length-2],t[0],t[1],E):0;const a=[];let l,u,_;u=t[1].sub(t[0])._perp()._unit();let x=!0;for(let s=1,c=0;s<t.length;s++){let f=t[s-1],b=t[s];const w=t[s===t.length-1?1:s+1];if(p.appendEdge(m,b,f),lf(b,f,D)){E&&(u=w.sub(b)._perp()._unit(),x=!x);continue}const T=b.sub(f)._perp(),S=T.x/(Math.abs(T.x)+Math.abs(T.y)),C=T.y>0?1:0,I=f.dist(b);if(c+I>32768&&(c=0),E){_=w.sub(b)._perp()._unit();let e=af(f,b,w,of(u,_),E);isNaN(e)&&(e=0);const t=b.sub(f)._unit();f=f.add(t.mult(o))._round(),b=b.add(t.mult(-e))._round(),o=e,u=_,g&&this.zoom>=17&&(A(a,f)||a.push(f),A(a,b)||a.push(b))}const R=n.vertexLength,P=t.length>4&&uf(f,b,w);let M=hf(c,i,x);if(qd(this.layoutVertexArray,f.x,f.y,S,C,0,0,M),qd(this.layoutVertexArray,f.x,f.y,S,C,0,1,M),this.wallMode){const e=v(s-1,t),n=y.joinNormals[s-1];Xd(this.wallVertexArray,n,e),Xd(this.wallVertexArray,n,e)}if(c+=I,M=hf(c,P,!x),i=P,qd(this.layoutVertexArray,b.x,b.y,S,C,0,0,M),qd(this.layoutVertexArray,b.x,b.y,S,C,0,1,M),this.wallMode){const e=v(s,t),n=y.joinNormals[s];Xd(this.wallVertexArray,n,e),Xd(this.wallVertexArray,n,e)}if(n.vertexLength+=4,this.indexArray.emplaceBack(R+0,R+1,R+2),this.indexArray.emplaceBack(R+1,R+3,R+2),n.primitiveLength+=2,E){const i=e+(1===s?t.length-2:s-2),r=1===s?e:i+1;if(this.indexArray.emplaceBack(R+1,i,R+3),this.indexArray.emplaceBack(i,r,R+3),n.primitiveLength+=2,void 0===l&&(l=R),!lf(w,t[s],D)){const e=s===t.length-1?l:n.vertexLength;this.indexArray.emplaceBack(R+2,R+3,e),this.indexArray.emplaceBack(R+3,e+1,e),this.indexArray.emplaceBack(R+3,r,e+1),n.primitiveLength+=3}x=!x}if(d){const e=this.layoutVertexExtArray,t=h.projectTilePoint(f.x,f.y,r),n=h.projectTilePoint(b.x,b.y,r),i=h.upVector(r,f.x,f.y),o=h.upVector(r,b.x,b.y);Yd(e,t,i),Yd(e,t,i),Yd(e,n,o),Yd(e,n,o)}}f&&(e+=t.length-1),g&&E&&this.zoom>=17&&(0!==a.length&&A(a,a[0])&&a.pop(),this.groundEffect.addData(a,D,c,E>0))}this.footprintSegments.push(o),i.triangleCount=this.indexArray.length-i.triangleArrayOffset,this.polygonSegments.push(i),++m.footprintSegLen,++m.polygonSegLen}if(m.vertexCount=this.layoutVertexArray.length-m.vertexArrayOffset,m.groundVertexCount=this.groundEffect.vertexArray.length-m.groundVertexArrayOffset,0!==m.vertexCount){if(m.centroidXY=p.borders?Hd:this.encodeCentroid(p,m),this.centroidData.push(m),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,o,s,r,l,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(t,i,o,s,r,l,this.worldview),this.maxHeight=Math.max(this.maxHeight,_)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}splitToSubtiles(){const e=[];for(let s=0;s<this.centroidData.length;s++){const t=this.centroidData[s],n=+(t.min.y+t.max.y>Li),i=2*n+(+(t.min.x+t.max.x>Li)^n);for(let r=0;r<t.polygonSegLen;r++){const n=t.polygonSegIdx+r;e.push({centroidIdx:s,subtile:i,polygonSegmentIdx:n,triangleSegmentIdx:this.polygonSegments[n].triangleSegIdx})}}const t=new Ta;e.sort((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx);let n=0,i=0,r=0;for(const s of e){if(s.triangleSegmentIdx!==n)break;r++}const o=e.length;for(;i!==e.length;){n=e[i].triangleSegmentIdx;let s=0,a=i,l=i;for(let t=a;t<r&&e[t].subtile===s;t++)l++;for(;a!==r;){const i=e[a];s=i.subtile;const o=this.centroidData[i.centroidIdx].min.clone(),c=this.centroidData[i.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let n=a;n<l;n++){const i=e[n],r=this.polygonSegments[i.polygonSegmentIdx],s=this.centroidData[i.centroidIdx].min,a=this.centroidData[i.centroidIdx].max,l=this.indexArray.uint16;for(let e=r.triangleArrayOffset;e<r.triangleArrayOffset+r.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);u.primitiveLength+=r.triangleCount,o.x=Math.min(o.x,s.x),o.y=Math.min(o.y,s.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),a=l;for(let t=a;t<r&&e[t].subtile===e[a].subtile;t++)l++}i=r;for(let t=i;t<o&&e[t].triangleSegmentIdx===e[i].triangleSegmentIdx;t++)r++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,n){const i=new tl;if(this.wallMode){for(const e of this.triangleSubSegments)i.segments.push(e.segment);return i}let r=0,o=0;const s=1<<e.canonical.z;if(t){const n=t.getMinMaxForTile(e);n&&(r=n.min,o=n.max)}o+=this.maxHeight;const a=e.toUnwrapped();let l;const c=[a.canonical.x/s+a.wrap,a.canonical.y/s],u=[(a.canonical.x+1)/s+a.wrap,(a.canonical.y+1)/s],h=(e,t,n)=>[e[0]*(1-n[0])+t[0]*n[0],e[1]*(1-n[1])+t[1]*n[1]],d=[],f=[];for(const p of this.triangleSubSegments){d[0]=p.min.x/Li,d[1]=p.min.y/Li,f[0]=p.max.x/Li,f[1]=p.max.y/Li;const e=h(c,u,d),t=h(c,u,f);if(0===new Vc([e[0],e[1],r],[t[0],t[1],o]).intersectsPrecise(n)){l&&(i.segments.push(l),l=void 0);continue}const s=p.segment;l&&l.vertexOffset!==s.vertexOffset&&(i.segments.push(l),l=void 0),l?(l.vertexLength+=s.vertexLength,l.primitiveLength+=s.primitiveLength):l={vertexOffset:s.vertexOffset,primitiveLength:s.primitiveLength,vertexLength:s.vertexLength,primitiveOffset:s.primitiveOffset,sortKey:void 0,vaos:{}}}return l&&i.segments.push(l),i}encodeCentroid(e,t){const n=e.centroid(),i=t.span(),r=Math.min(7,Math.round(i.x*this.tileToMeter/10)),o=Math.min(7,Math.round(i.y*this.tileToMeter/10));return new xe(Re(n.x,1,Li-1)<<3|r,Re(n.y,1,Li-1)<<3|o)}encodeBorderCentroid(e){if(!e.borders)return new xe(0,0);const t=e.borders,n=Number.MAX_VALUE;if(t[0][0]!==n||t[1][0]!==n){const e=t[0][0]!==n?0:1;return new xe(6|(t[0][0]!==n?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==n?2:3;return new xe((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==n?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=2147483647,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,i=e.flags&Wd?Hd:e.centroidXY,r=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==i.y||r!==i.x){for(let e=t;e<n;++e)this.centroidVertexArray.emplace(e,i.x,i.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t,n){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped());if(Rd(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const o of this.centroidData)o.flags&=2147483647;const r=[];for(const o of this.activeReplacements){if(o.order<n)continue;const t=Math.max(1,Math.pow(2,o.footprintTileId.canonical.z-e.canonical.z));if(o.footprint.buildingId){const e=o.footprint.buildingId;for(const t of this.centroidData)t.buildingId===e&&(t.flags|=Wd)}else for(const n of this.centroidData)if(!(n.flags&Wd||o.min.x>n.max.x||n.min.x>o.max.x||o.min.y>n.max.y||n.min.y>o.max.y))for(let i=0;i<n.footprintSegLen;i++){const s=this.footprintSegments[n.footprintSegIdx+i];if(r.length=0,pf(this.footprintVertices,s.vertexOffset,s.vertexCount,o.footprintTileId.canonical,e.canonical,r),Fd(o.footprint,r,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-t)){n.flags|=Wd;break}}}for(const o of this.centroidData)this.writeCentroidToBuffer(o);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,n){let i=!1;for(let r=0;r<n.footprintSegLen;r++){const o=this.footprintSegments[n.footprintSegIdx+r];let s=0;for(const n of o.ringIndices){for(let r=s,a=n+s-1;r<n+s;a=r++){const n=this.footprintVertices.int16[2*(r+o.vertexOffset)+0],s=this.footprintVertices.int16[2*(r+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+o.vertexOffset)+1];s>t!=l>t&&e<(this.footprintVertices.int16[2*(a+o.vertexOffset)+0]-n)*(t-s)/(l-s)+n&&(i=!i)}s=n}}return i}getHeightAtTileCoord(e,t){let n=Number.NEGATIVE_INFINITY,i=!0;const r=4*(e+Li)*Li+(t+Li);if(this.partLookup.hasOwnProperty(r)){const e=this.partLookup[r];return e?{height:e.height,hidden:!!(e.flags&Wd)}:void 0}for(const o of this.centroidData)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||o.height<=n||this.footprintContainsPoint(e,t,o)&&(n=o.height,this.partLookup[r]=o,i=!!(o.flags&Wd));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:i};this.partLookup[r]=void 0}}function of(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function sf(e,t,n,i){const r=t.sub(e)._perp()._unit(),o=n.sub(t)._perp()._unit();return af(e,t,n,of(r,o),i)}function af(e,t,n,i,r){const o=Math.sqrt(1-i*i);return Math.min(e.dist(t)/3,t.dist(n)/3,r*o/i)}function lf(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function cf(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function uf(e,t,n){if(e.x<0||e.x>=Li||t.x<0||t.x>=Li||n.x<0||n.x>=Li)return!1;const i=n.sub(t),r=i.perp(),o=e.sub(t);return(i.x*o.x+i.y*o.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(o.x*o.x+o.y*o.y))>-.866&&r.x*o.x+r.y*o.y<0}function hf(e,t,n){const i=t?2|e:-3&e;return n?1|i:-2&i}function df(){const e=Math.PI/32,t=Math.tan(e),n=Wl;return n*Math.sqrt(1+2*t*t)-n}function ff(e,t,n){const i=1<<n.z,r=tc(n.x/i),o=tc((n.x+1)/i),s=nc(n.y/i),a=nc((n.y+1)/i);return function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;const s=[];if(!e.length||!n||!i)return s;const a=(e,t)=>{for(const n of e)s.push({polygon:n,bounds:t})},l=Math.ceil(Math.log2(n)),c=Math.ceil(Math.log2(i)),u=l-c,h=[];for(let p=0;p<Math.abs(u);p++)h.push(u>0?0:1);for(let p=0;p<Math.min(l,c);p++)h.push(0),h.push(1);let d=e;if(d=id(d,t[0].y-r,t[1].y+r,1),d=id(d,t[0].x-r,t[1].x+r,0),!d.length)return s;const f=[];for(h.length?f.push({polygons:d,bounds:t,depth:0}):a(d,t);f.length;){const e=f.pop(),t=e.depth,n=h[t],i=e.bounds[0],s=e.bounds[1],l=0===n?i.x:i.y,c=0===n?s.x:s.y,u=o?o(n,l,c):.5*(l+c),d=id(e.polygons,l-r,u+r,n),p=id(e.polygons,u-r,c+r,n);if(d.length){const e=[i,new xe(0===n?u:s.x,1===n?u:s.y)];h.length>t+1?f.push({polygons:d,bounds:e,depth:t+1}):a(d,e)}if(p.length){const e=[new xe(0===n?u:i.x,1===n?u:i.y),s];h.length>t+1?f.push({polygons:p,bounds:e,depth:t+1}):a(p,e)}}return s}(e,t,Math.ceil((o-r)/11.25),Math.ceil((s-a)/11.25),1,(e,t,r)=>{if(0===e)return.5*(t+r);{const e=nc((n.y+t/Li)/i);return($l(.5*(nc((n.y+r/Li)/i)+e))*i-n.y)*Li}})}function pf(e,t,n,i,r,o){const s=Math.pow(2,i.z-r.z);for(let a=0;a<n;a++){let n=e.int16[2*(a+t)+0],l=e.int16[2*(a+t)+1];n=(n+r.x*Li)*s-i.x*Li,l=(l+r.y*Li)*s-i.y*Li,o.push(new xe(n,l))}}let mf,gf;Xo(rf,"FillExtrusionBucket",{omit:["layers","features"]}),Xo(Jd,"PartData"),Xo(Kd,"FootprintSegment"),Xo(Qd,"BorderCentroidData"),Xo(nf,"GroundEffect");class _f extends xe{constructor(e,t,n){super(e,t),this.z=n}}class yf extends _f{constructor(e,t,n,i){super(e,t,n),this.w=i}}function vf(e,t,n,i){const r="x"===n?"y":"x",o=(i-e[n])/(t[n]-e[n]);e[r]=Math.round(e[r]+(t[r]-e[r])*o),e[n]=i,e.hasOwnProperty("z")&&(e.z=un(e.z,t.z,o)),e.hasOwnProperty("w")&&(e.w=un(e.w,t.w,o))}function xf(e,t,n,i){const r=n,o=i;for(const s of["x","y"]){let n=e,i=t;n[s]>=i[s]&&(n=t,i=e),n[s]<r&&i[s]>r&&vf(n,i,s,r),n[s]<o&&i[s]>o&&vf(i,n,s,o)}}function bf(e,t,n,i,r,o){const s=[];for(let a=0;a<e.length;a++){const l=e[a];let c;const u=s.length;let h=0;for(let e=0;e<l.length-1;e++){let u=l[e],d=l[e+1],f=0;const p=h;let m,g;o&&(f=Math.hypot(d.x-u.x,d.y-u.y),h+=f,m=u,g=d),u.x<t&&d.x<t||(u.x<t?u=new xe(t,u.y+(t-u.x)/(d.x-u.x)*(d.y-u.y))._round():d.x<t&&(d=new xe(t,u.y+(t-u.x)/(d.x-u.x)*(d.y-u.y))._round()),u.y<n&&d.y<n||(u.y<n?u=new xe(u.x+(n-u.y)/(d.y-u.y)*(d.x-u.x),n)._round():d.y<n&&(d=new xe(u.x+(n-u.y)/(d.y-u.y)*(d.x-u.x),n)._round()),u.x>=i&&d.x>=i||(u.x>=i?u=new xe(i,u.y+(i-u.x)/(d.x-u.x)*(d.y-u.y))._round():d.x>=i&&(d=new xe(i,u.y+(i-u.x)/(d.x-u.x)*(d.y-u.y))._round()),u.y>=r&&d.y>=r||(u.y>=r?u=new xe(u.x+(r-u.y)/(d.y-u.y)*(d.x-u.x),r)._round():d.y>=r&&(d=new xe(u.x+(r-u.y)/(d.y-u.y)*(d.x-u.x),r)._round()),c&&u.equals(c[c.length-1])||(c=[u],s.push(c),o&&o.push({progress:{min:p+Ef(m,g,u)*f,max:1},parentIndex:a,prevPoint:m,nextPoint:g})),c.push(d),o&&(o[o.length-1].progress.max=p+Ef(m,g,d)*f,o[o.length-1].nextPoint=g)))))}if(o&&h>0)for(let e=u;e<s.length;e++)o[e].progress.min/=h,o[e].progress.max/=h}return s}function wf(e,t,n,i,r){if(e.length<2)return void i.push(e);const o=[];for(;t.valid();){const[n,i]=t.get();for(let t=0;t<e.length-1;t++){const r=e[t],s=e[t+1],a=eu(r,s,n,i);if(a){const[e]=a,n=new xe(un(r.x,s.x,e),un(r.y,s.y,e));o.push({t:t+e,distance:0,point:n})}}t.next()}if(0===o.length)return void i.push(e);o.sort((e,t)=>e.t-t.t);let s=0,a=0,l=[];for(i.push(l);s!==e.length;){if(a===o.length){for(;s!==e.length;)0!==l.length&&l[l.length-1].equals(e[s])||l.push(e[s]),s++;break}o[a].t<=s?(0!==l.length&&l[l.length-1].equals(o[a].point)||l.push(o[a].point),Math.trunc(o[a].t),a++):(0!==l.length&&l[l.length-1].equals(e[s])||l.push(e[s]),s++)}}function Ef(e,t,n){return e.x!==t.x?(n.x-e.x)/(t.x-e.x):e.y!==t.y?(n.y-e.y)/(t.y-e.y):0}function Tf(e,t){return e.x*t.x+e.y*t.y}function Af(e,t){if(1===e.length){let n=0;const i=t[n++];let r;for(;!r||i.equals(r);)if(r=t[n++],!r)return 1/0;for(;n<t.length;n++){const o=t[n],s=e[0],a=r.sub(i),l=o.sub(i),c=s.sub(i),u=Tf(a,a),h=Tf(a,l),d=Tf(l,l),f=Tf(c,a),p=Tf(c,l),m=u*d-h*h,g=(d*f-h*p)/m,_=(u*p-h*f)/m,y=i.z*(1-g-_)+r.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}function Sf(e,t,n,i,r,o,s,a){const l=s*r.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,n){const i=Math.floor(t[0]/8),r=Math.floor(t[1]/8),o=10*(t[0]-8*i),s=10*(t[1]-8*r),a=e.getElevationAt(i,r,!0,!0),l=e.getMeterToDEM(n),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(i,r),d=2*c+1,f=2*u+1,p=function(e,t,n,i,r){return[e.getElevationAtPixel(t,n,!0),e.getElevationAtPixel(t+r,n,!0),e.getElevationAtPixel(t,n+r,!0),e.getElevationAtPixel(t+i,n+r,!0)]}(e,h.x-c,h.y-u,d,f),m=Math.abs(p[0]-p[1]),g=Math.abs(p[2]-p[3]),_=Math.abs(p[0]-p[2])+Math.abs(p[1]-p[3]),y=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*_/f);return a+Math.max(y*o,v*s)}(r,o,a):l;return{base:l+(0===n?-1:n),top:c?Math.max(u+i,l+n+2):l+i}}class Df{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Cf{constructor(){this.tasks={},this.taskQueue=[],ze(["process"],this),this.invoker=new Df(this.process),this.nextId=0}add(e,t){const n=this.nextId++,i=function(e){let{type:t,isSymbolTile:n,zoom:i}=e;return i=i||0,"message"===t?0:"maybePrepare"!==t||n?"parseTile"!==t||n?"parseTile"===t&&n?300-i:"maybePrepare"===t&&n?400-i:500:200-i:100-i}(t);if(0===i){try{e()}finally{}return null}return this.tasks[n]={fn:e,metadata:t,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(e=>!!this.tasks[e]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<t&&(t=n.priority,e=i)}if(null===e)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class If{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},ze(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Cf}send(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[s]=n);const a=new Set;return this.target.postMessage({id:s,type:e,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:Ko(t,a)},a),{cancel:()=>{n&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data;if(!t)return;const n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[n];delete this.cancelCallbacks[n],e&&e.cancel()}else if(t.mustQueue||Ze(self)){const e=this.callbacks[n],i=this.scheduler.add(()=>this.processTask(n,t),e&&e.metadata||{type:"message"});i&&(this.cancelCallbacks[n]=i)}else this.processTask(n,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(Jo(t.error)):n(null,Jo(t.data)))}else{const n=new Set,i=t.hasCallback?(t,i)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Ko(t):null,data:Ko(i,n)},n)}:()=>{},r=Jo(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,i);else if(this.parent.getWorkerSource){const e=t.type.split("."),{source:n,scope:o}=r;this.parent.getWorkerSource(t.sourceMapId,e[0],n,o)[e[1]](r,i)}else i(new Error("Could not find function ".concat(t.type)))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Rf={workerUrl:"",workerClass:null,workerParams:void 0};const Pf="mapboxgl_preloaded_worker_pool";class Mf{constructor(){this.active={}}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mf.workerCount;if(!this.workers)for(this.workers=[];this.workers.length<t;)this.workers.push(null!=Rf.workerClass?new Rf.workerClass:new self.Worker(Rf.workerUrl,Rf.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pf]}numActive(){return Object.keys(this.active).length}}Mf.workerCount=2;class Ff{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Worker",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mf.workerCount;this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Oe();const r=this.workerPool.acquire(this.id,i);for(let o=0;o<r.length;o++){const e=new Ff.Actor(r[o],t,this.id);e.name="".concat(n," ").concat(o),this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,t,n){Fe(this.actors,(n,i)=>{n.send(e,t,i)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Lf,kf;function Of(){return Lf||(Lf=new Mf),Lf}Ff.Actor=If;class Bf{constructor(e){this.module=e}createIntArray(e){const t=new Int32Array(e),n=this.module.malloc(t.length*t.BYTES_PER_ELEMENT);return this.module.heap32.set(t,n/t.BYTES_PER_ELEMENT),n}createFloatArray(e){const t=new Float32Array(e),n=this.module.malloc(t.length*t.BYTES_PER_ELEMENT);return this.module.heapF32.set(t,n/t.BYTES_PER_ELEMENT),n}createStringBuffer(e){const t=this.module.malloc(e.length+1);for(let n=0;n<e.length;++n)this.module.heapU8[t+n]=e.charCodeAt(n);return this.module.heapU8[t+e.length]=0,t}readStringBuffer(e){let t="";for(;0!==this.module.heapU8[e];)t+=String.fromCharCode(this.module.heapU8[e]),++e;return t}setStyle(e){const t=e.entranceColorRgb,n=e.facadeGlazingColorRgb,i=e.roofColorRgb,r=e.wallColorRgb,o=e.normalScale;this.module.setStyle(t[0],t[1],t[2],n[0],n[1],n[2],i[0],i[1],i[2],r[0],r[1],r[2],o[0],o[1],o[2],e.tileToMeters)}setAOOptions(e,t){this.module.setAOOptions(e?1:0,t)}setMetricOptions(e,t){this.module.setMetricOptions(e?1:0,t)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,t){this.module.setFacadeOptions(e,t?1:0)}setFauxFacadeOptions(e,t,n){this.module.setFauxFacadeOptions(e?1:0,t?1:0,n)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,t){for(const s of e){const e=this.createStringBuffer(s.roofType),t=[0],n=[];for(const o of s.coordinates)if(Array.isArray(o)){for(const e of o)n.push(e.x),n.push(e.y);t.push(n.length)}const i=this.createIntArray(t),r=this.createFloatArray(n);this.module.addFeature(s.id,s.sourceId,s.minHeight,s.height,e,s.roofType.length,r,i,t.length-1),this.module.free(e),this.module.free(i),this.module.free(r)}for(const s of t){let e;e=s.entrances?JSON.parse(s.entrances):[];const t=this.createFloatArray(e),n=[];for(const r of s.coordinates)n.push(r.x),n.push(r.y);const i=this.createFloatArray(n);this.module.addFacade(s.sourceId,s.crossPerc,s.distanceToRoad,t,e.length,i,n.length),this.module.free(t),this.module.free(i)}if(!this.module.generateMesh()){const e=this.module.getLastError();return this.readStringBuffer(e)}const n=this.module.getMeshCount(),i=new Array(n);for(let s=0;s<n;s++){const e=this.module.getPositionsPtr(s),t=this.module.getPositionsLength(s),n=new Float32Array(this.module.heapF32.buffer,e,t),r=this.module.getNormalsPtr(s),o=this.module.getNormalsLength(s),a=new Float32Array(this.module.heapF32.buffer,r,o),l=this.module.getColorsPtr(s),c=this.module.getColorsLength(s),u=new Uint8Array(this.module.heapU8.buffer,l,c),h=this.module.getAOPtr(s),d=this.module.getAOLength(s),f=new Float32Array(this.module.heapF32.buffer,h,d),p=this.module.getUVPtr(s),m=this.module.getUVLength(s),g=new Float32Array(this.module.heapF32.buffer,p,m),_=this.module.getFauxFacadePtr(s),y=this.module.getFauxFacadeLength(s),v=new Uint8Array(this.module.heapU8.buffer,_,y),x=this.module.getIndicesPtr(s),b=this.module.getIndicesLength(s),w=new Int32Array(this.module.heap32.buffer,x,b),E=this.module.getBuildingPart(s),T=this.readStringBuffer(E);i[s]={positions:n,normals:a,colors:u,ao:f,uv:g,isFauxFacade:v,indices:w,buildingPart:T}}const r=this.module.getRingCount(),o=[];for(let s=0;s<r;s++){const e=this.module.getRingPtr(s),t=this.module.getRingLength(s),n=new Float32Array(this.module.heapF32.buffer,e,t);o.push(n)}return{meshes:i,modifiedPolygonRings:o}}}let zf,Nf,Uf,Vf,jf,Gf=null,Hf=null,Wf=null,qf=null;function Xf(){return Ze(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Nf||it.DRACO_URL}function Zf(){if(Ze(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Vf)return Vf;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Vf=WebAssembly.validate(e)?it.MESHOPT_SIMD_URL:it.MESHOPT_URL,Vf}function Yf(){return qf}const Kf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Jf={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Qf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function $f(e,t,n){const i=n.json.bufferViews.length,r=n.buffers.length;t.bufferView=i,n.json.bufferViews[i]={buffer:r,byteLength:e.byteLength},n.buffers[r]=e}const ep="KHR_draco_mesh_compression";function tp(e,t){const n=e.extensions&&e.extensions[ep];if(!n)return;const i=new Uf.Decoder,r=lp(t,n.bufferView),o=new Uf.Mesh;if(!i.DecodeArrayToMesh(r,r.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=t.json.accessors[e.indices],a=Kf[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=Uf._malloc(l);a===Uint16Array?i.GetTrianglesUInt16Array(o,l,c):i.GetTrianglesUInt32Array(o,l,c),$f(Uf.memory.buffer.slice(c,c+l),s,t),Uf._free(c);for(const u of Object.keys(n.attributes)){const r=i.GetAttributeByUniqueId(o,n.attributes[u]),s=t.json.accessors[e.attributes[u]],a=Jf[s.componentType],l=s.count*Qf[s.type]*Kf[s.componentType].BYTES_PER_ELEMENT,c=Uf._malloc(l);i.GetAttributeDataArrayForAllPoints(o,r,Uf[a],l,c),$f(Uf.memory.buffer.slice(c,c+l),s,t),Uf._free(c)}i.destroy(),o.destroy(),delete e.extensions[ep]}const np="EXT_meshopt_compression";function ip(e,t){if(!e.extensions||!e.extensions[np])return;const n=e.extensions[np],i=new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),r=new Uint8Array(n.count*n.byteStride);jf.decodeGltfBuffer(r,n.count,n.byteStride,i,n.mode,n.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=r.buffer,delete e.extensions[np]}const rp=1179937895,op=new TextDecoder("utf8");function sp(e,t){return new URL(e,t).href}function ap(e,t,n,i){return fetch(sp(e.uri,i)).then(e=>e.arrayBuffer()).then(e=>{t.buffers[n]=e})}function lp(e,t){const n=e.json.bufferViews[t];return new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function cp(e,t,n,i){if(e.uri){const r=sp(e.uri,i);return fetch(r).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>{t.images[n]=e})}if(void 0!==e.bufferView){const i=lp(t,e.bufferView),r=new Blob([i],{type:e.mimeType});return createImageBitmap(r).then(e=>{t.images[n]=e})}}function up(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const i={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===rp){const n=new Uint32Array(e,t);let r=2;const o=(n[r++]>>2)-3,s=n[r++]>>2;if(r++,i.json=JSON.parse(op.decode(n.subarray(r,r+s))),r+=s,r<o){const o=n[r++];r++;const s=t+(r<<2);i.buffers[0]=e.slice(s,s+o)}}else i.json=JSON.parse(op.decode(new Uint8Array(e,t)));const{buffers:r,images:o,meshes:s,extensionsUsed:a,bufferViews:l}=i.json;let c=Promise.resolve();if(r){const e=[];for(let t=0;t<r.length;t++){const o=r[t];o.uri?e.push(ap(o,i,t,n)):i.buffers[t]||(i.buffers[t]=null)}c=Promise.all(e)}return c.then(()=>{const e=[],t=a&&a.includes(ep),r=a&&a.includes(np);if(t&&e.push(function(){if(!Uf)return null!=zf?zf:(zf=function(e){let t,n=null;function i(){t=new Uint8Array(n.buffer)}function r(){throw new Error("Unexpected Draco error.")}const o={a:{a:r,d:function(e,n,i){return t.copyWithin(e,n,n+i)},c:function(e){const r=t.length,o=Math.max(e>>>0,Math.ceil(1.2*r)),s=Math.ceil((o-r)/65536);try{return n.grow(s),i(),!0}catch(e){return!1}},b:r}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,o):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,o))).then(e=>{const{Rb:r,Qb:o,P:s,T:a,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:f,eb:p,jb:m,f:g,e:_,yb:y,zb:v,Ab:x,Bb:b,Db:w,Gb:E}=e.instance.exports;n=_;const T=(()=>{let e=0,n=0,i=0,s=0;return a=>{i&&(r(s),r(e),n+=i,i=e=0),e||(n+=128,e=o(n));const l=a.length+7&-8;let c=e;l>=n&&(i=l,c=s=o(l));for(let e=0;e<a.length;e++)t[c+e]=a[e];return c}})();return i(),g(),{memory:_,_free:r,_malloc:o,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,n){const i=T(e),r=u(this.ptr,i,t,n.ptr);return!!l(r)}GetAttributeByUniqueId(e,t){return{ptr:h(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,n){d(this.ptr,e.ptr,t,n)}GetTrianglesUInt32Array(e,t,n){f(this.ptr,e.ptr,t,n)}GetAttributeDataArrayForAllPoints(e,t,n,i,r){p(this.ptr,e.ptr,t.ptr,n,i,r)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:E()}})}(fetch(Xf())),zf.then(e=>{Uf=e,zf=void 0}))}()),r&&e.push(function(){if(jf)return;const e=function(e){let t;const n=WebAssembly.instantiateStreaming(e,{}).then(e=>{t=e.instance,t.exports.__wasm_call_ctors()}),i={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},r={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:n,supported:!0,decodeGltfBuffer(e,n,o,s,a,l){!function(e,t,n,i,r,o,s){const a=e.exports.sbrk,l=i+3&-4,c=a(l*r),u=a(o.length),h=new Uint8Array(e.exports.memory.buffer);h.set(o,u);const d=t(c,i,r,u,o.length);if(0===d&&s&&s(c,l,r),n.set(h.subarray(c,c+i*r)),a(c-a(0)),0!==d)throw new Error("Malformed buffer data: ".concat(d))}(t,t.exports[r[a]],e,n,o,s,t.exports[i[l]])}}}(fetch(Zf()));return e.ready.then(()=>{jf=e})}()),o)for(let s=0;s<o.length;s++)e.push(cp(o[s],i,s,n));return(e.length?Promise.all(e):Promise.resolve()).then(()=>{if(t&&s)for(const{primitives:e}of s)for(const t of e)tp(t,i);if(r&&s&&l)for(const e of l)ip(e,i);return i})})}function hp(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function dp(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class fp{constructor(e,t,n,i){this.context=e,this.format=n,this.useMipmap=i&&i.useMipmap,this.texture=e.gl.createTexture(),this.update(t,{premultiply:i&&i.premultiply})}update(e,t){const n=e&&e instanceof HTMLVideoElement&&0===e.width?e.videoWidth:e.width,i=e&&e instanceof HTMLVideoElement&&0===e.height?e.videoHeight:e.height,{context:r}=this,{gl:o}=r,{x:s,y:a}=t&&t.position?t.position:{x:0,y:0},l=s+n,c=a+i;!this.size||this.size[0]===l&&this.size[1]===c||(o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(this.texture),this.texture=o.createTexture(),this.size=null),o.bindTexture(o.TEXTURE_2D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA8&&(!t||!1!==t.premultiply));const u=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&l>0&&c>0){const e=this.useMipmap?Math.floor(Math.log2(Math.max(l,c)))+1:1;o.texStorage2D(o.TEXTURE_2D,e,this.format,l,c),this.size=[l,c]}if(this.size)if(u)o.texSubImage2D(o.TEXTURE_2D,0,s,a,hp(this.format),dp(this.format),e);else{const t=e.data;t&&o.texSubImage2D(o.TEXTURE_2D,0,s,a,n,i,hp(this.format),dp(this.format),t)}this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap&&!n?e===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,n,i,r){const{context:o}=this,{gl:s}=o;s.bindTexture(s.TEXTURE_2D,this.texture),t!==this.magFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap?e===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,n),this.wrapS=n),i!==this.wrapT&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,i),this.wrapT=i),r!==this.compareMode&&(r?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_FUNC,r)):s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_MODE,s.NONE),this.compareMode=r)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class pp{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}}const mp=ta([{name:"a_pos_3f",components:3,type:"Float32"}]),gp=ta([{name:"a_color_3f",components:3,type:"Float32"}]),_p=ta([{name:"a_color_4f",components:4,type:"Float32"}]),yp=ta([{name:"a_uv_2f",components:2,type:"Float32"}]),vp=ta([{name:"a_normal_3f",components:3,type:"Float32"}]),xp=ta([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),bp=ta([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function wp(e,t){const n=Tp(e.projection,e.zoom,e.width,e.height),i=function(e,t,n,i,r){const o=new Xl(n.lng-180*Ap,n.lat),s=new Xl(n.lng+180*Ap,n.lat),a=e.project(o.lng,o.lat),c=e.project(s.lng,s.lat),h=-Math.atan2(c.y-a.y,c.x-a.x),f=cc.fromLngLat(n);f.y=Re(f.y,-1+Ap,1-Ap);const p=f.toLngLat(),g=e.project(p.lng,p.lat),_=cc.fromLngLat(p);_.x+=Ap;const y=_.toLngLat(),v=e.project(y.lng,y.lat),x=Dp(v.x-g.x,v.y-g.y,h),b=cc.fromLngLat(p);b.y+=Ap;const w=b.toLngLat(),E=e.project(w.lng,w.lat),T=Dp(E.x-g.x,E.y-g.y,h),A=Math.abs(x.x)/Math.abs(T.y),S=l([]);m(S,S,-h*(1-(r?0:i)));const D=l([]);return d(D,D,[1,1-(1-A)*i,1]),D[4]=-T.x/T.y*i,m(D,D,h),u(D,S,D),D}(e.projection,0,e.center,n,t),r=Ep(e);return d(i,i,[r,r,1]),i}function Ep(e){const t=e.projection,n=Tp(e.projection,e.zoom,e.width,e.height),i=Sp(t,e.center),r=Sp(t,Xl.convert(t.center));return Math.pow(2,i*n+(1-n)*r)}function Tp(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=e.range;if(!o)return 0;const s=Math.min(r,Math.max(n,i)),a=Math.log(s/1024)/Math.LN2;return Pe(o[0]+a,o[1]+a,t)}const Ap=1/4e4;function Sp(e,t){const n=Re(t.lat,-rc,rc),i=new Xl(t.lng-180*Ap,n),r=new Xl(t.lng+180*Ap,n),o=e.project(i.lng,n),s=e.project(r.lng,n),a=cc.fromLngLat(i),l=cc.fromLngLat(r),c=s.x-o.x,u=s.y-o.y,h=l.x-a.x,d=l.y-a.y,f=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(f)/Math.LN2}function Dp(e,t,n){const i=Math.cos(n),r=Math.sin(n);return{x:e*i-t*r,y:e*r+t*i}}function Cp(e,t,n){l(e),m(e,e,Te(t[2])),f(e,e,Te(t[0])),p(e,e,Te(t[1])),d(e,e,n),u(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ip(e,t,n,i,r,o,s,a){const l=[n[0]-t[0],n[1]-t[1],0],c=[i[0]-t[0],i[1]-t[1],0];if(w(l)<1e-12||w(c)<1e-12)return Q(e);const u=B([],l,c);k(u,u),S(c,i,t),l[2]=(o-r)*a,c[2]=(s-r)*a;const h=l;return B(h,l,c),k(h,h),oe(e,u,h)}function Rp(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=Hu(t.zoom),r=function(e,t,n){const i=t.worldSize,r=[e[12],e[13],e[14]],o=nc(r[1]/i),s=tc(r[0]/i),a=l([]),c=ec(1,o)*i,f=ec(1,0)*i*sc(o,t.zoom),p=1/Vu(i);let m=f*p;if(n){const e=Tp(t.projection,t.zoom,t.width,t.height,1024);m=p*t.projection.pixelSpaceConversion(t.center.lat,i,e)}const g=Hl(o,s);A(g,g,R([],k([],g),c*m*r[2]));const _=function(e){const t=[e[0],e[1],e[2]];let n=[0,1,0];const i=B([],n,t);return B(n,t,i),0===F(n)&&(n=[0,1,0],B(i,t,n)),k(i,i),k(n,n),k(t,t),[i[0],i[1],i[2],0,n[0],n[1],n[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(g);d(a,a,[m,m,m*c]),h(a,a,[-r[0],-r[1],-r[2]]);const y=u([],t.globeMatrix,_);return u(y,y,a),u(y,y,e),y}(e,t,n);if(i>0){const n=function(e,t){const n=t.worldSize,i=ec(1,0)*n*sc(t.center.lat,t.zoom)/Vu(n),r=ec(1,t.center.lat)*n,o=l([]);return p(o,o,Te(t.center.lng)),f(o,o,Te(t.center.lat)),h(o,o,[0,0,kl]),d(o,o,[i,i,i*r]),h(o,o,[t.point.x-.5*n,t.point.y-.5*n,0]),u(o,o,e),u(o,t.globeMatrix,o)}(e,t);return function(e,t,n){const i=(e,t,n)=>{const i=w(e),r=w(t),o=Pu(e,t,n);return R(o,o,1/w(o)*un(i,r,n))},r=i([e[0],e[1],e[2]],[t[0],t[1],t[2]],n),o=i([e[4],e[5],e[6]],[t[4],t[5],t[6]],n),s=i([e[8],e[9],e[10]],[t[8],t[9],t[10]],n),a=Pu([e[12],e[13],e[14]],[t[12],t[13],t[14]],n);return[r[0],r[1],r[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],1]}(r,n,i)}return r}function Pp(e,t,n,i){const r=Vc.projectAabbCorners(i,n);let o=Number.MAX_VALUE,s=-1;for(let c=0;c<r.length;++c){const e=r[c];e[0]=(.5*e[0]+.5)*t.width,e[1]=(.5-.5*e[1])*t.height,e[2]<o&&(s=c,o=e[2])}const a=e=>new xe(r[e][0],r[e][1]);let l;switch(s){case 0:case 6:l=[a(1),a(5),a(4),a(7),a(3),a(2),a(1)];break;case 1:case 7:l=[a(0),a(4),a(5),a(6),a(2),a(3),a(0)];break;case 3:case 5:l=[a(1),a(0),a(4),a(7),a(6),a(2),a(1)];break;default:l=[a(1),a(5),a(6),a(7),a(3),a(0),a(1)]}if(Xc(e,l))return o}const Mp=64,Fp={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Lp(e,t,n,i,r,o,s,a,c){let f=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const p=n.zoom,m=n.project(i),g=sc(i.lat,p),_=1/g;l(e),h(e,e,[m.x+s[0]*_,m.y+s[1]*_,s[2]]);let v=1,x=1;const b=n.worldSize;if(f){if("mercator"===n.projection.name){let e=0;n.elevation&&(e=n.elevation.getAtPointOrZero(new cc(m.x/b,m.y/b),0));const t=K([],[m.x,m.y,e,1],n.projMatrix)[3]/n.cameraToCenterDistance;v=t,x=t*sc(n.center.lat,p)}else if("globe"===n.projection.name){const t=Rp(e,n),r=[0,0,0,1];K(r,r,u([],n.projMatrix,t));const o=r[3]/n.cameraToCenterDistance,s=Hu(p),a=n.projection.pixelsPerMeter(i.lat,b)*sc(i.lat,p),l=n.projection.pixelsPerMeter(n.center.lat,b)*sc(n.center.lat,p);v=o/un(a,oc(n.center.lat),s),x=o*g/a,v*=l,x*=l}}else v=_;d(e,e,[v,v,x]);const w=[...e],E=t.orientation,T=[];if(Cp(T,[E[0]+r[0],E[1]+r[1],E[2]+r[2]],o),u(e,w,T),a&&n.elevation){let r=0;const o=[];if(c&&n.elevation){r=function(e,t,n,i,r){const o=t.elevation;if(!o)return 0;const s=Vc.projectAabbCorners(n,i),a=ec(1,r.lat)*t.worldSize,l=function(e,t){const n=[0,0,1],i=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const r of i){const i=e[r.corners[0]],o=e[r.corners[1]],s=e[r.corners[2]],a=[o[0]-i[0],o[1]-i[1],t*(o[2]-i[2])],l=B(a,a,[s[0]-i[0],s[1]-i[1],t*(s[2]-i[2])]);k(l,l),r.dotProductWithUp=O(l,n)}return i.sort((e,t)=>e.dotProductWithUp-t.dotProductWithUp),i[0].corners}(s,a),c=s[l[0]],u=s[l[1]],h=s[l[2]],d=s[l[3]],f=o.getAtPointOrZero(new cc(c[0]/t.worldSize,c[1]/t.worldSize),0),p=o.getAtPointOrZero(new cc(u[0]/t.worldSize,u[1]/t.worldSize),0),m=o.getAtPointOrZero(new cc(h[0]/t.worldSize,h[1]/t.worldSize),0),g=o.getAtPointOrZero(new cc(d[0]/t.worldSize,d[1]/t.worldSize),0),_=(f+g)/2,y=(p+m)/2;return _>y?p<m?Ip(e,u,d,c,p,g,f,a):Ip(e,h,c,d,m,f,g,a):f<g?Ip(e,c,u,h,f,p,m,a):Ip(e,d,h,u,g,m,p,a),Math.max(_,y)}(o,n,t.aabb,e,i);const s=u([],y([],o),T);u(e,w,s)}else r=n.elevation.getAtPointOrZero(new cc(m.x/b,m.y/b),0);0!==r&&(e[14]+=r)}}function kp(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new fp(t,e.image,n?t.gl.R8:t.gl.RGBA8,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function Op(e,t,n){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,mp.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,vp.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,yp.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?gp:_p).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,bp.members,!0)),e.segments=tl.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const i=e.material;i.pbrMetallicRoughness.baseColorTexture&&kp(i.pbrMetallicRoughness.baseColorTexture,t),i.pbrMetallicRoughness.metallicRoughnessTexture&&kp(i.pbrMetallicRoughness.metallicRoughnessTexture,t),i.normalTexture&&kp(i.normalTexture,t),i.occlusionTexture&&kp(i.occlusionTexture,t,n),i.emissionTexture&&kp(i.emissionTexture,t)}function Bp(e,t,n){if(e.meshes)for(const i of e.meshes)Op(i,t,n);if(e.children)for(const i of e.children)Bp(i,t,n)}function zp(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)zp(t)}function Np(e){if(e.meshes)for(const n of e.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const n of e.children)Np(n)}function Up(e,t){const n=e.json.bufferViews[t.bufferView],i=Kf[t.componentType];return new i(e.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*(n.byteStride&&n.byteStride!==Qf[t.type]*i.BYTES_PER_ELEMENT?n.byteStride/i.BYTES_PER_ELEMENT:Qf[t.type]))}function Vp(e,t,n,i){const r=Kf[t.componentType],o=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(r),s=e.json.bufferViews[t.bufferView],a=s.byteStride?s.byteStride/r.BYTES_PER_ELEMENT:Qf[t.type],l=n.float32,c=l.length/n.capacity;for(let u=0,h=0;u<t.count*a;u+=a,h+=c)for(let e=0;e<c;e++)l[h+e]=i[u+e]*o;n._trim()}function jp(e,t,n){const i=e.indices,r=e.attributes,o={};o.indexArray=new Ta;const s=t.json.accessors[i],a=s.count/3;o.indexArray.reserve(a);const l=Up(t,s);for(let d=0;d<a;d++)o.indexArray.emplaceBack(l[3*d],l[3*d+1],l[3*d+2]);o.indexArray._trim(),o.vertexArray=new ha;const c=t.json.accessors[r.POSITION];o.vertexArray.reserve(c.count);const u=Up(t,c);for(let d=0;d<c.count;d++)o.vertexArray.emplaceBack(u[3*d],u[3*d+1],u[3*d+2]);if(o.vertexArray._trim(),o.aabb=new Vc(c.min,c.max),o.centroid=function(e,t){const n=[0,0,0],i=e.length;if(i>0){for(let r=0;r<i;r++){const i=3*e[r];n[0]+=t[i],n[1]+=t[i+1],n[2]+=t[i+2]}n[0]/=i,n[1]/=i,n[2]/=i}return n}(l,u),void 0!==r.COLOR_0){const e=t.json.accessors[r.COLOR_0],n=Qf[e.type],i=Up(t,e);o.colorArray=3===n?new ha:new _a,o.colorArray.resize(e.count),Vp(t,e,o.colorArray,i)}if(void 0!==r.NORMAL){o.normalArray=new ha;const e=t.json.accessors[r.NORMAL];o.normalArray.resize(e.count);const n=Up(t,e);Vp(t,e,o.normalArray,n)}if(void 0!==r.TEXCOORD_0&&n.length>0){o.texcoordArray=new Ma;const e=t.json.accessors[r.TEXCOORD_0];o.texcoordArray.resize(e.count);const n=Up(t,e);Vp(t,e,o.texcoordArray,n)}if(void 0!==r._FEATURE_ID_RGBA4444){const e=t.json.accessors[r._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(o.featureData=Up(t,e))}void 0!==r._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(Up(t,t.json.accessors[r._FEATURE_RGBA4444]).buffer));const h=e.material;return o.material=function(e,t){const{emissiveFactor:n=[0,0,0],alphaMode:i="OPAQUE",alphaCutoff:r=.5,normalTexture:o,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:f}=e.pbrMetallicRoughness||{},p=s?t[s.index]:void 0;if(s&&s.extensions&&s.extensions.KHR_texture_transform&&p){const e=s.extensions.KHR_texture_transform;p.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new sn(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:f?t[f.index]:void 0},doubleSided:l,emissiveFactor:new sn(...n),alphaMode:i,alphaCutoff:r,normalTexture:o?t[o.index]:void 0,occlusionTexture:p,emissionTexture:a?t[a.index]:void 0,defined:void 0===e.defined}}(void 0!==h?t.json.materials[h]:{defined:!1},n),o}function Gp(e,t,n){const{matrix:i,rotation:r,translation:o,scale:s,mesh:a,extras:l,children:c}=e,u={};if(u.matrix=i||function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3],l=r+r,c=o+o,u=s+s,h=r*l,d=r*c,f=r*u,p=o*c,m=o*u,g=s*u,_=a*l,y=a*c,v=a*u,x=i[0],b=i[1],w=i[2];return e[0]=(1-(p+g))*x,e[1]=(d+v)*x,e[2]=(f-y)*x,e[3]=0,e[4]=(d-v)*b,e[5]=(1-(h+g))*b,e[6]=(m+_)*b,e[7]=0,e[8]=(f+y)*w,e[9]=(m-_)*w,e[10]=(1-(h+p))*w,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}([],r||[0,0,0,1],o||[0,0,0],s||[1,1,1]),void 0!==a){u.meshes=n[a];const e=u.anchor=[0,0];for(const t of u.meshes){const{min:n,max:i}=t.aabb;e[0]+=n[0]+i[0],e[1]+=n[1]+i[1]}e[0]=Math.floor(e[0]/u.meshes.length/2),e[1]=Math.floor(e[1]/u.meshes.length/2)}if(l&&(l.id&&(u.id=l.id),l.lights&&(u.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.codePointAt(i);return n}(e),n=[],i=t.length/24,r=new Uint16Array(t.buffer),o=new Float32Array(t.buffer);for(let s=0;s<i;s++){const e=r[2*s*6]/30,t=r[2*s*6+1]/30,i=r[2*s*6+10]/100,a=o[6*s+1],l=o[6*s+2],c=o[6*s+3],u=o[6*s+4],h=c-a,d=u-l,f=Math.hypot(h,d);n.push({pos:[a+.5*h,l+.5*d,t],normal:[d/f,-h/f,0],width:f,height:e,depth:i,points:[a,l,c,u]})}return n}(l.lights))),c){const e=[];for(const i of c)e.push(Gp(t.json.nodes[i],t,n));u.children=e}return u}function Hp(e){if(0===e.vertices.length||0===e.indices.length)return null;const t=new pd(e.vertices,e.indices,8,256),[n,i]=[t.min.clone(),t.max.clone()];return{vertices:e.vertices,indices:e.indices,grid:t,min:n,max:i}}function Wp(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const n=t[0];if(!n||!Array.isArray(n)||0===n.length)return null;const i=[];for(const s of n){if(!Array.isArray(s)||2!==s.length)continue;const e=s[0],t=s[1];"number"==typeof e&&"number"==typeof t&&i.push(new xe(e,t))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let r=0;for(let s=0;s<i.length;s++){const e=i[s],t=i[(s+1)%i.length],n=i[(s+2)%i.length];r+=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}r>0&&i.reverse();const o=vh(i.flatMap(e=>[e.x,e.y]),[]);return 0===o.length?null:{vertices:i,indices:o}}function qp(e,t){const n=[],i=[];let r=0;const o=[];for(const s of e){r=n.length;const e=s.vertexArray.float32,a=s.indexArray.uint16;for(let i=0;i<s.vertexArray.length;i++)o[0]=e[3*i+0],o[1]=e[3*i+1],o[2]=e[3*i+2],N(o,o,t),n.push(new xe(o[0],o[1]));for(let t=0;t<3*s.indexArray.length;t++)i.push(a[t]+r)}if(i.length%3!=0)return null;for(let s=0;s<i.length;s+=3){const e=n[i[s+0]],t=n[i[s+1]],r=n[i[s+2]];(e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)>0&&([i[s+1],i[s+2]]=[i[s+2],i[s+1]])}return{vertices:n,indices:i}}function Xp(e){const t=function(e,t){const n=[],i=WebGL2RenderingContext;if(e.json.textures)for(const r of e.json.textures){const o={magFilter:i.LINEAR,minFilter:i.NEAREST,wrapS:i.REPEAT,wrapT:i.REPEAT};void 0!==r.sampler&&Object.assign(o,e.json.samplers[r.sampler]),n.push({image:t[r.source],sampler:o,uploaded:!1})}return n}(e,e.images),n=function(e,t){const n=[];for(const i of e.json.meshes){const r=[];for(const n of i.primitives)r.push(jp(n,e,t));n.push(r)}return n}(e,t),{scenes:i,scene:r,nodes:o}=e.json,s=i?i[r||0].nodes:o,a=[];for(const l of s)a.push(Gp(o[l],e,n));return function(e,t,n){const i={},r=new Set;for(let o=0;o<e.length;o++){const e=n[t[o]];if(!e.extras)continue;const s=e.extras["mapbox:footprint:version"],a=e.extras["mapbox:footprint:id"];(s||a)&&r.add(o),"1.0.0"===s&&a&&(i[a]=o)}for(let o=0;o<e.length;o++){if(r.has(o))continue;const s=e[o],a=n[t[o]];if(!a.extras)continue;let l=null;s.id in i&&(l=qp(e[i[s.id]].meshes,s.matrix)),l||(l=Wp(a)),l&&(s.footprint=Hp(l))}if(r.size>0){const t=Array.from(r.values()).sort((e,t)=>e-t);for(let n=t.length-1;n>=0;n--)e.splice(t[n],1)}}(a,s,e.json.nodes),a}function Zp(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,n=e.aabb.min[0]-1,i=e.aabb.min[1]-1,r=Mp/(e.aabb.max[0]-n+2),o=Mp/(e.aabb.max[1]-i+2);for(let s=0;s<t.length;s+=3){const a=t[s+2],l=(t[s+0]-n)*r|0,c=(t[s+1]-i)*o|0;a>e.heightmap[c*Mp+l]&&(e.heightmap[c*Mp+l]=a)}}function Yp(e,t,n,i,r){n.reserve(n.length+4*e.length),i.reserve(i.length+10*e.length),r.reserve(r.length+10*e.length);let o=i.length;for(const s of e){const e=Math.min(10,Math.max(4,1.3*s.height))*t,a=[-s.normal[1],s.normal[0],0],l=Math.min(.29,.1*s.width/s.depth),c=s.width-2*s.depth*t*(l+.01),u=P([],s.pos,a,c/2),h=P([],s.pos,a,-c/2),d=[u[0],u[1],u[2]+s.height],f=[h[0],h[1],h[2]+s.height],p=P([],s.normal,a,l);R(p,p,e);const m=P([],s.normal,a,-l);R(m,m,e),A(p,u,p),A(m,h,m),u[2]+=.1,h[2]+=.1,i.emplaceBack(p[0],p[1],p[2]),i.emplaceBack(m[0],m[1],m[2]),i.emplaceBack(u[0],u[1],u[2]),i.emplaceBack(h[0],h[1],h[2]),i.emplaceBack(d[0],d[1],d[2]),i.emplaceBack(f[0],f[1],f[2]),i.emplaceBack(u[0],u[1],u[2]),i.emplaceBack(h[0],h[1],h[2]),i.emplaceBack(p[0],p[1],p[2]),i.emplaceBack(m[0],m[1],m[2]);const g=c/e/2;r.emplaceBack(-g-l,-1,g,.8),r.emplaceBack(g+l,-1,g,.8),r.emplaceBack(-g,0,g,1.3),r.emplaceBack(g,0,g,1.3),r.emplaceBack(g+l,-.8,g,.7),r.emplaceBack(g+l,-.8,g,.7),r.emplaceBack(0,0,g,1.3),r.emplaceBack(0,0,g,1.3),r.emplaceBack(g+l,-1.2,g,.8),r.emplaceBack(g+l,-1.2,g,.8),n.emplaceBack(6+o,4+o,8+o),n.emplaceBack(7+o,9+o,5+o),n.emplaceBack(0+o,1+o,2+o),n.emplaceBack(1+o,3+o,2+o),o+=10}}function Kp(e,t){const n={};n.indexArray=new Ta,n.vertexArray=new ha,n.colorArray=new _a,Yp(e,t,n.indexArray,n.vertexArray,n.colorArray);const i={defined:!0};i.emissiveFactor=sn.black;const r={};return r.baseColorFactor=sn.white,i.pbrMetallicRoughness=r,n.material=i,n.aabb=new Vc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const Jp=ta([{name:"a_pos_3f",components:3,type:"Float32"}]),Qp=ta([{name:"a_normal_3",components:3,type:"Int16"}]),$p=ta([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),em=ta([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),tm=vc.types,nm=32767;function im(e,t){const n=Li+t;for(const i of e)for(const e of i)if(e.x<-t||e.x>n||e.y<-t||e.y>n)return!1;return!0}class rm{constructor(e){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.layoutVertexArray=new ha,this.layoutNormalArray=new ra,this.layoutColorArray=new va,this.indexArray=new Ta,this.indexArrayForConflation=new Ta,this.entranceBloom={layoutVertexArray:new ha,layoutVertexBuffer:null,layoutAttenuationArray:new _a,layoutAttenuationBuffer:null,layoutColorArray:new va,layoutColorBuffer:null,indexArray:new Ta,indexArrayForConflation:new Ta,indexBuffer:null,segmentsBucket:new tl},this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut}),this.segmentsBucket=new tl,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.groundEffect=new nf(e)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(e,t){for(const n of this.footprints)t.push({footprint:n,id:e})}prepare(){return function(){if(null!=qf||null!=Wf)return null;if(null!=Hf)return Hf;const e=fetch(it.BUILDING_GEN_URL);return Hf=function(e){let t,n,i,r;function o(){t=new Uint8Array(r.buffer),n=new Int32Array(r.buffer),i=new Float32Array(r.buffer)}function s(){throw new Error("Unexpected BuildingGen error.")}const a=()=>{},l={a:{a:s,f:function(e){const n=t.length,i=Math.max(e>>>0,Math.ceil(1.2*n)),s=Math.ceil((i-n)/65536);try{return r.grow(s),o(),!0}catch(e){return!1}},g:s,b:a,c:a,d:a,e:a}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,l):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,l))).then(e=>{const s=e.instance.exports;return(0,s.g)(),r=s.f,o(),new Bf({setStyle:s.h,setAOOptions:s.i,setMetricOptions:s.j,setStructuralOptions:s.k,setFacadeOptions:s.l,setFauxFacadeOptions:s.m,setFacadeClassifierOptions:s.n,addFeature:s.o,addFacade:s.p,generateMesh:s.q,getLastError:s.r,getMeshCount:s.s,getPositionsPtr:s.t,getPositionsLength:s.u,getNormalsPtr:s.v,getNormalsLength:s.w,getColorsPtr:s.x,getColorsLength:s.y,getAOPtr:s.z,getAOLength:s.A,getUVPtr:s.B,getUVLength:s.C,getFauxFacadePtr:s.D,getFauxFacadeLength:s.E,getIndicesPtr:s.F,getIndicesLength:s.G,getBuildingPart:s.H,getRingCount:s.I,getRingPtr:s.J,getRingLength:s.K,free:s.L,malloc:s.M,heapU8:t,heap32:n,heapF32:i})})}(e).then(e=>(Hf=null,qf=e,qf)).catch(e=>{He("Could not load building-gen"),Hf=null,Wf=e}),Hf}()}populate(e,t,n,i){const r=Yf();if(!r)return;const o=lc(n);this.tileToMeter=o,this.brightness=t.brightness,r.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,o],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:o,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),r.setAOOptions(!1,.3),r.setMetricOptions(!1,16),r.setStructuralOptions(!0),r.setFacadeOptions(4,!0),r.setFauxFacadeOptions(!1,!1,1),r.setFacadeClassifierOptions(3);const s=new Map;for(const{feature:a}of e){if("LineString"!==tm[a.type])continue;const e=this.layers[0]._featureFilter.needGeometry,t=yc(a,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom),t,n))continue;const r=e?t.geometry:_c(a,n,i),o=[];for(const n of r)for(const e of n)o.push({x:e.x,y:e.y});const l={coordinates:o,crossPerc:a.properties.cross_perc,distanceToRoad:a.properties.distance_to_road,entrances:a.properties.entrances,sourceId:0},c=a.properties.source_id;let u=s.get(c);u||(u=[],s.set(c,u)),u.push(l)}this.maxHeight=0;for(const{feature:a,index:l}of e){if("LineString"===tm[a.type])continue;const e=this.layers[0]._featureFilter.needGeometry,o=yc(a,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom),o,n))continue;const c=e?o.geometry:_c(a,n,i),u=Wh(c,500);if(!im(c,163))continue;const h=this.layers[0],d=h.layout.get("building-base").evaluate(a,{},n),f=h.layout.get("building-height").evaluate(a,{},n),p=h.layout.get("building-roof-shape").evaluate(a,{},n),m=h.paint.get("building-ambient-occlusion-intensity"),g=h.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if("flat"===p)continue;const _=a.properties.source_id;let y;y=s.has(_)?s.get(_):[];const v=[],x=new xe(1/0,1/0),b=new xe(-1/0,-1/0);for(const t of u)if(t.length>0){const e=[];for(const n of t){const t=[];for(let e=n.length-1;e>=0;e--){const i=n[e];t.push({x:i.x,y:i.y}),x.x=Math.min(x.x,i.x),x.y=Math.min(x.y,i.y),b.x=Math.max(b.x,i.x),b.y=Math.max(b.y,i.y)}e.push(t)}v.push({id:a.id,height:f,minHeight:d,sourceId:0,roofType:p,coordinates:e})}const w=r.generateMesh(v,y);if("string"==typeof w)continue;if(0===w.meshes.length||0===w.modifiedPolygonRings.length)continue;let E=0;for(const t of w.meshes)E+=t.positions.length/3;const T=this.segmentsBucket.prepareSegment(E,this.layoutVertexArray,this.indexArray),A=[];let S=null,D=0,C=-1;const I=this.indexArray.length;let R=0;for(const t of w.meshes){const e=this.layoutVertexArray.length;if("entrance"===t.buildingPart){const e=new Array;for(let o=0;o<t.indices.length;o+=12){const n=t.positions[o+0],i=t.positions[o+1],r=t.positions[o+3],s=t.positions[o+4],a=t.positions[o+2],l=t.positions[o+8]-a,c=1,u=r-n,h=s-i,d=Math.hypot(u,h);e.push({pos:[n+.5*u,i+.5*h,a],normal:[h/d,-u/d,0],width:d,height:l,depth:c,points:[n,i,r,s]})}const n=this.entranceBloom.segmentsBucket.prepareSegment(10*e.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),i=this.entranceBloom.layoutVertexArray.length;D=this.entranceBloom.indexArray.length,Yp(e,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const r=this.entranceBloom.layoutVertexArray.length-i;C=this.entranceBloom.indexArray.length-D;for(let t=0;t<r;t++){const e=65535;this.entranceBloom.layoutColorArray.emplaceBack(e,e)}n.vertexLength+=r,n.primitiveLength+=C,S={part:t.buildingPart,vertexOffset:i,vertexLength:r}}for(let i=0;i<t.positions.length;i+=3)R=Math.max(R,t.positions[i+2]),this.layoutVertexArray.emplaceBack(t.positions[i],t.positions[i+1],t.positions[i+2]);for(let i=0;i<t.normals.length;i+=3)this.layoutNormalArray.emplaceBack(t.normals[i+0]*nm,t.normals[i+1]*nm,t.normals[i+2]*nm);for(let i=0;i<t.ao.length;i++)this.layoutAOArray.push(t.ao[i]);for(let i=0;i<t.colors.length;i+=3){const e=1+(t.ao[i/3]-1)*m;this.layoutColorArray.emplaceBack(t.colors[i]*e<<8|t.colors[i+1]*e,t.colors[i+2]*e<<8)}const n=T.vertexLength;for(let i=0;i<t.indices.length;i+=3)this.indexArray.emplaceBack(n+t.indices[i],n+t.indices[i+1],n+t.indices[i+2]);T.vertexLength+=t.positions.length/3,T.primitiveLength+=t.indices.length/3,("roof"===t.buildingPart||"wall"===t.buildingPart||"facade_glazing"===t.buildingPart||"entrance"===t.buildingPart)&&A.push({part:t.buildingPart,vertexOffset:e,vertexLength:t.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,R),this.buildingFeatures.push({feature:o,segment:T,parts:A,buildingBloom:S});const P=this.indexArray.length-I,M=[],F=[],L=new xe(1/0,1/0),k=new xe(-1/0,-1/0),O=this.groundEffect.vertexArray.length;for(const t of w.modifiedPolygonRings){const e=[],n=new xe(1/0,1/0),i=new xe(-1/0,-1/0);for(let r=0;r<t.length;r+=2){const o=t.length-r-2;n.x=Math.min(n.x,t[o]),n.y=Math.min(n.y,t[o+1]),i.x=Math.max(i.x,t[o]),i.y=Math.max(i.y,t[o+1]);const s=new xe(t[o],t[o+1]);e.push(s),M.push(s.x,s.y),F.push(s.clone())}L.x=Math.min(L.x,n.x),L.y=Math.min(L.y,n.y),k.x=Math.max(k.x,i.x),k.y=Math.max(k.y,i.y),this.groundEffect.addData(e,[n,i],g)}const B=this.groundEffect.vertexArray.length-O;(x.x<0||b.x>Li||x.y<0||b.y>Li)&&this.featuresOnBorder.push({featureId:a.id,footprintIndex:this.footprints.length});{const e=vh(M,null,2),t=new pd(F,e,8,256);let n=a.id;a.properties&&a.properties.hasOwnProperty("building_id")&&(n=a.properties.building_id),this.footprints.push({vertices:F,indices:e,grid:t,min:L,max:k,buildingId:n,hiddenFlags:0,indicesOffset:I,indicesLength:P,bloomIndicesOffset:D,bloomIndicesLength:C,groundEffectVertexOffset:O,groundEffectVertexLength:B,segment:T,height:R})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,l,{},t.availableImages,n,t.brightness),this.groundEffect.addPaintPropertiesData(a,l,{},t.availableImages,n,t.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(e,t,n,i,r,o,s){this.programConfigurations.updatePaintArrays(e,t,r,n,i,o,s),this.groundEffect.update(e,t,r,n,i,o,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jp.members),this.layoutNormalBuffer=e.createVertexBuffer(this.layoutNormalArray,Qp.members),this.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(this.entranceBloom.layoutVertexArray,Jp.members),this.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,em.members),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!1;const r=n?t:0,o=0|(n?-1:~t);0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of e){const e=this.footprints[s],t=e.hiddenFlags&o|r;e.hiddenFlags!==t&&(e.hiddenFlags=t,i=!0,this.groundEffect.updateHiddenByLandmarkRange(e.groundEffectVertexOffset,e.groundEffectVertexLength,0!==e.hiddenFlags))}return i&&(this.indexArrayForConflationUploaded=!1),i}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),!this.indexArrayForConflationUploaded&&0!==this.indexArray.length){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const e of this.footprints){const t=e.indicesOffset+e.indicesLength;if(0!==e.hiddenFlags){for(let i=e.indicesOffset;i<t;i++)this.indexArrayForConflation.uint16[3*i+0]=0,this.indexArrayForConflation.uint16[3*i+1]=0,this.indexArrayForConflation.uint16[3*i+2]=0;const n=e.bloomIndicesOffset+e.bloomIndicesLength;for(let t=e.bloomIndicesOffset;t<n;t++)this.entranceBloom.indexArrayForConflation.uint16[3*t+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*t+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*t+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=e.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=e.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(e){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=e.createVertexBuffer(this.layoutColorArray,$p.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=e.createVertexBuffer(this.entranceBloom.layoutColorArray,$p.members,!0)}evaluate(e){const t=e.paint.get("building-ambient-occlusion-intensity");for(const n of this.buildingFeatures){const i=n.feature;i.properties["building-part"]="roof";const r=e.paint.get("building-color").evaluate(i,{},this.canonical),o=e.paint.get("building-emissive-strength").evaluate(i,{},this.canonical);i.properties["building-part"]="wall";const s=e.paint.get("building-color").evaluate(i,{},this.canonical),a=e.paint.get("building-emissive-strength").evaluate(i,{},this.canonical);i.properties["building-part"]="window";const l=e.paint.get("building-color").evaluate(i,{},this.canonical),c=e.paint.get("building-emissive-strength").evaluate(i,{},this.canonical);i.properties["building-part"]="door";const u=e.paint.get("building-color").evaluate(i,{},this.canonical),h=e.paint.get("building-emissive-strength").evaluate(i,{},this.canonical);for(const e of n.parts){let n,i=r;"roof"===e.part?(i=r,n=o):"wall"===e.part?(i=s,n=a):"facade_glazing"===e.part?(i=l,n=c):"entrance"===e.part&&(i=u,n=h),n=Re(n,0,1);for(let r=0;r<e.vertexLength;r++){const o=e.vertexOffset+r,s=1+(this.layoutAOArray[o]-1)*t;this.layoutColorArray.emplace(o,i.r*s*255<<8|i.g*s*255,i.b*s*255<<8|255*n)}}const d=n.buildingBloom;if(d)for(let e=0;e<d.vertexLength;e++)this.bloomGeometry.layoutColorArray.emplace(d.vertexOffset+e,255*u.r<<8|255*u.g,255*u.b<<8|51*h)}}needsEvaluation(e,t){const n=e.transform.projectionOptions,i=e.style.getBrightness();return!(this.uploaded&&n.name===this.projection.name&&this.brightness===i||(this.projection=n,this.brightness=i,0))}updateReplacement(e,t,n){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped());if(Rd(this.activeReplacements,i))return;this.activeReplacements=i;for(const o of this.footprints)o.hiddenFlags&=-2;const r=[];for(const o of this.activeReplacements){if(o.order<=Ad)continue;const t=Math.max(1,Math.pow(2,o.footprintTileId.canonical.z-e.canonical.z));for(const n of this.footprints)n.min.x>o.max.x||n.max.x<o.min.x||n.min.y>o.max.y||n.max.y<o.min.y||(r.length=0,om(n.vertices,0,n.vertices.length,o.footprintTileId.canonical,e.canonical,r),Fd(o.footprint,r,n.indices,0,n.indices.length,0,-t)&&(n.hiddenFlags|=1))}0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(o.groundEffectVertexOffset,o.groundEffectVertexLength,0!==o.hiddenFlags);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,t){let n=Number.NEGATIVE_INFINITY,i=!0;const r=4*(e+Li)*Li+(t+Li);if(this.footprintLookup.hasOwnProperty(r)){const e=this.footprintLookup[r];return e?{height:e.height,hidden:0!==e.hiddenFlags}:void 0}const o=new xe(e,t);for(const s of this.footprints)e>s.max.x||s.min.x>e||t>s.max.y||s.min.y>t||s.height<=n||Od(o,s)&&(n=s.height,this.footprintLookup[r]=s,i=0!==s.hiddenFlags);if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:i};this.footprintLookup[r]=void 0}}function om(e,t,n,i,r,o){const s=Math.pow(2,i.z-r.z);for(let a=0;a<n;a++){let n=e[a+t].x,l=e[a+t].y;n=(n+r.x*Li)*s-i.x*Li,l=(l+r.y*Li)*s-i.y*Li,o.push(new xe(n,l))}}let sm,am;Xo(rm,"BuildingBucket",{omit:["layers"]});const lm=ta([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),cm=ta([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:um}=lm,hm=ta([{name:"a_packed",components:3,type:"Float32"}]),{members:dm}=hm,fm=ta([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:pm}=fm;class mm{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new hh({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=Be(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const i=[];let r=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,s=!0;i.push({left:r,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let l=1;l<e.length;l++){s=!s;const t=e[l];r=a*n,a+=t,o=a*n,i.push({left:r,right:o,isDash:s,zeroLength:0===t})}return i}addRoundDash(e,t,n){const i=t/2;for(let r=-n;r<=n;r++){const t=this.width*(this.nextRow+n+r);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=r/n*(i+1);if(s.isDash){const e=i-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=i-Math.sqrt(u*u+d*d);this.image.data[t+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let a=e.length-1;a>=0;--a){const t=e[a],n=e[a+1];t.zeroLength?e.splice(a,1):n&&n.isDash===t.isDash&&(n.left=t.left,e.splice(a,1))}const n=e[0],i=e[e.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);const r=this.width*this.nextRow;let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const n=Math.abs(a-s.left),i=Math.abs(a-s.right),l=Math.min(n,i);this.image.data[r+a]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const i="round"===t,r=i?7:0,o=2*r+1;if(this.nextRow+o>this.height)return He("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let c=0;c<e.length;c++)e[c]<0&&(He("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),s+=e[c];if(0!==s){const n=this.width/s,o=this.getDashRanges(e,this.width,n);i?this.addRoundDash(o,n,r):this.addRegularDash(o,"square"===t?.5*n:0)}const a=this.nextRow+r;this.nextRow+=o;const l={tl:[a,r],br:[s,0]};return this.positions[n]=l,l}}Xo(mm,"LineAtlas");const gm=vc.types,_m=Math.cos(Math.PI/180*37.5),ym=Math.cos(Math.PI/180*5);class vm{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new ua,this.layoutVertexArray2=new ha,this.patternVertexArray=new ha,this.indexArray=new Ta,this.programConfigurations=new Il(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new tl,this.maxLineLength=0,this.zOffsetVertexArray=new ha,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Li/64,this.worldview=e.worldview}updateFootprints(e,t){}populate(e,t,n,i){this.hasPattern=Zh("line",this.layers,this.pixelRatio,t);const r=this.layers[0].layout.get("line-sort-key");this.tileToMeter=lc(n);const o=this.layers[0].layout.get("line-elevation-reference");if("hd-road-markup"===o)this.elevationType="road";else{const e=this.layers[0].layout.get("line-z-offset"),t=e.isConstant()&&!e.constantOr(0);this.elevationType="sea"!==o&&"ground"!==o&&t?"none":"offset","offset"===this.elevationType&&"none"===o&&He("line-elevation-reference: ground is used for the layer ".concat(this.layerIds[0]," because non-zero line-z-offset value was found."))}const s=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope="offset"===this.elevationType&&void 0!==s;const a=[];for(const{feature:h,id:d,index:f,sourceLayerIndex:p}of e){const e=this.layers[0]._featureFilter.needGeometry,t=yc(h,e);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),t,n))continue;const o=r?r.evaluate(t,{},n):void 0,s={id:d,properties:h.properties,type:h.type,sourceLayerIndex:p,index:f,geometry:e?t.geometry:_c(h,n,i),patterns:{},sortKey:o};a.push(s)}r&&a.sort((e,t)=>e.sortKey-t.sortKey);const{lineAtlas:l,featureIndex:c}=t,u=this.addConstantDashes(l);for(const h of a){const{geometry:i,index:r,sourceLayerIndex:o}=h;if(u&&this.addFeatureDashes(h,l),this.hasPattern){const e=Yh("line",this.layers,h,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(h,i,r,n,l.positions,t.availableImages,t.brightness,t.elevationFeatures);c.insert(e[r].feature,i,r,o,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==r.kind)t=!0;else{const t=r.value,n=i.value;if(!n)continue;e.addDash(n,t)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let s,a;if("constant"===r.kind){if(s=r.value,!s)continue}else s=r.evaluate({zoom:n},e);a="constant"===o.kind?o.value:o.evaluate({zoom:n},e),t.addDash(s,a),e.patterns[i.id]=[t.getKey(s,a)]}}update(e,t,n,i,r,o,s,a){this.programConfigurations.updatePaintArrays(e,t,r,n,i,o,s,a)}addFeatures(e,t,n,i,r,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,t,n,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,dm)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,pm)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,cm.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,um),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,r,o,s,a){const l=this.layers[0].layout,c=l.get("line-join").evaluate(e,{}),u=l.get("line-cap").evaluate(e,{}),h=l.get("line-miter-limit"),d=l.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=l.get("line-z-offset").value;const f=this.layers[0].paint.get("line-width").value;if("constant"!==f.kind&&!1===f.isLineProgressConstant&&(this.variableWidthValue=f),"road"===this.elevationType){const n=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,t,i,a,c,u,h,d)){const[r,o]=this.clipRuntimeLinesToTile(t,1);for(let t=0;t<r.length;t++){const n=r[t],s=o[t],a={progress:{min:s.progress.min,max:s.progress.max},nextDir:this.computeSegNextDir(s,n),prevDir:this.computeSegPrevDir(s,n)};this.addLine(n,e,i,c,u,h,d,a)}this.fillNonElevatedRoadSegment(n)}}else for(const p of t)this.addLine(p,e,i,c,u,h,d);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i,s,void 0,this.worldview)}computeSegNextDir(e,t){return e.nextPoint.sub(t.at(-2)).unit()}computeSegPrevDir(e,t){return t[1].sub(e.prevPoint).unit()}clipLinesToTile(e,t){return bf(e,-t,-t,Li+t,Li+t)}clipRuntimeLinesToTile(e,t){const n=[];return[bf(e,-t,-t,Li+t,Li+t,n),n]}addElevatedRoadFeature(e,t,n,i,r,o,s,a){const l=[],c=Hc.getElevationFeature(e,i);if(c){const e=this.clipLinesToTile(t,1),i=this.prepareElevatedLines(e,c,n);for(const t of i)l.push({geometry:t,elevation:c,elevationTileID:n,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(0===l.length)return!1;for(const u of l){const t=this.layoutVertexArray.length;this.addLine(u.geometry,e,n,r,o,s,a);const i=new Wc(n,u.elevationTileID);if(u.elevation)for(let e=t;e<this.layoutVertexArray.length;e++){const t=new xe(this.layoutVertexArray.int16[6*e]>>1,this.layoutVertexArray.int16[6*e+1]>>1),n=i.pointElevation(t,u.elevation,.05);this.updateHeightRange(n),this.zOffsetVertexArray.emplaceBack(n,0,0)}else this.fillNonElevatedRoadSegment(t)}return!0}prepareElevatedLines(e,t,n){if(null!=t.constantHeight)return e;const i=[],r=1/lc(n);for(const o of e)wf(o,new jc(t,r),0,i);return i}fillNonElevatedRoadSegment(e){for(let t=e;t<this.layoutVertexArray.length;t++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,t,n,i,r,o,s,a){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const l="none"===i;this.patternJoinNone=this.hasPattern&&l,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const c=a&&a.progress.min>0,u=a&&a.progress.max<1;if(this.lineClips){let n={min:this.lineClips.start,max:this.lineClips.end},i=1;if(a){const e=this.lineClips.end-this.lineClips.start;n=function(e,t,n){return{min:nt(e.min,t,n),max:nt(e.max,t,n)}}(a.progress,{min:0,max:1},n),e>0&&(i=(n.max-n.min)/e)}const r=+t.properties.mapbox_clip_feature_len,o=+t.properties.mapbox_clip_seg_len;if(Number.isNaN(r)||Number.isNaN(o)){for(let n=0;n<e.length-1;n++)this.totalDistance+=e[n].dist(e[n+1]);const t=this.totalDistance/(n.max-n.min);this.totalFeatureLength=Number.isFinite(t)?t:0,this.lineClips.start=n.min,this.lineClips.end=n.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=r,this.distance=o*i,this.lineClips.start=n.min,this.lineClips.end=n.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const h="Polygon"===gm[t.type];let d=e.length;for(;d>=2&&e[d-1].equals(e[d-2]);)d--;let f=0;for(;f<d-1&&e[f].equals(e[f+1]);)f++;if(d<(h?3:2))return;"bevel"===i&&(o=1.05);const p=this.segments.prepareSegment(10*d,this.layoutVertexArray,this.indexArray);let m,g,_,y,v,x,b,w;a&&a.prevDir&&(x=a.prevDir.perp()),a&&a.nextDir&&(b=a.nextDir.perp()),this.e1=this.e2=-1,h&&(m=e[d-2],v=e[f].sub(m)._unit()._perp());for(let E=f;E<d;E++){if(_=E===d-1?h?e[f+1]:void 0:e[E+1],_&&e[E].equals(_))continue;v&&(y=v),m&&(g=m),m=e[E],w=this.evaluateLineProgressFeatures(g?g.dist(m):0),v=_?_.sub(m)._unit()._perp():y,y=y||v;const t=g&&_;let n=t?i:h||l?"butt":r;const a=y.x*v.x+y.y*v.y;if(l){const e=function(e){if(e.patternJoinNone){const t=e.segmentPoints.length/2,n=e.lineSoFar-e.segmentStart;for(let i=0;i<t;++i){const t=e.segmentPoints[2*i+1],r=Math.round(e.segmentPoints[2*i])+.5+.25*t;e.patternVertexArray.emplaceBack(r,n,e.segmentStart),e.patternVertexArray.emplaceBack(r,n,e.segmentStart)}e.segmentPoints.length=0}e.e1=e.e2=-1};if(t&&a<ym){this.updateDistance(g,m),this.addCurrentVertex(m,y,1,1,p,w),e(this),this.addCurrentVertex(m,v,-1,-1,p,w);continue}if(g){if(!_){this.updateDistance(g,m),this.addCurrentVertex(m,y,1,1,p,w),e(this);continue}n="miter"}}let T=y.add(v);0===T.x&&0===T.y||T._unit();const A=T.x*v.x+T.y*v.y,S=0!==A?1/A:1/0,D=2*Math.sqrt(2-2*A),C=A<_m&&g&&_,I=y.x*v.y-y.y*v.x>0,R=this.overscaling<=16?15*Li/(512*this.overscaling):0;if(t&&"round"===n)if(S<s)n="miter";else if(S<=2){const e=xm(m,-10,Li+10);n="offset"===this.elevationType&&(e||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===n&&S>o&&(n="bevel"),"bevel"===n&&(S>2&&(n="flipbevel"),S<o&&(n="miter")),g&&!("miter"===n&&C)&&this.updateDistance(g,m),"miter"===n)if(C){const e=m.dist(g);if(e>2*R){const t=m.sub(m.sub(g)._mult(R/e)._round());this.updateDistance(g,t),this.addCurrentVertex(t,y,0,0,p,w),g=t}this.updateDistance(g,m),T._mult(S),this.addCurrentVertex(m,T,0,0,p,w);const t=m.dist(_);if(t>2*R){const e=m.add(_.sub(m)._mult(R/t)._round());this.updateDistance(m,e),this.addCurrentVertex(e,v,0,0,p,w),m=e}}else T._mult(S),this.addCurrentVertex(m,T,0,0,p,w);else if("flipbevel"===n){if(S>100)T=v.mult(-1);else{const e=S*y.add(v).mag()/y.sub(v).mag();T._perp()._mult(e*(I?-1:1))}this.addCurrentVertex(m,T,0,0,p,w),this.addCurrentVertex(m,T.mult(-1),0,0,p,w)}else if("bevel"===n||"fakeround"===n){null!=w&&g&&this.addCurrentVertex(m,b||y,-1,-1,p,w);const e=m.dist(g)<=2*R&&"bevel"!==n,t=T.mult(I?1:-1);t._mult(S);const i=v.mult(I?-1:1),r=y.mult(I?-1:1),o=this.evaluateLineProgressFeatures(this.distance);if(null==w&&(this.addHalfVertex(m,t.x,t.y,!1,!I,0,p,o),e||this.addHalfVertex(m,t.x+2*r.x,t.y+2*r.y,!1,I,0,p,o)),"fakeround"===n){const e=Math.round(180*D/Math.PI/20);this.addHalfVertex(m,r.x,r.y,!1,I,0,p,o);for(let t=0;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+a*(a*(3.55645-1.43519*a)-3.2452))*e*e+(.848013+a*(.215638*a-1.06021)))}const s=i.sub(r)._mult(n)._add(r)._unit();this.addHalfVertex(m,s.x,s.y,!1,I,0,p,o)}this.addHalfVertex(m,i.x,i.y,!1,I,0,p,o)}e||null!=w||this.addHalfVertex(m,t.x+2*i.x,t.y+2*i.y,!1,I,0,p,o),null!=w&&_&&this.addCurrentVertex(m,x||v,1,1,p,w)}else if("butt"===n)this.addCurrentVertex(m,T,0,0,p,w);else if("square"===n){if(!g){const e=c?0:-1;this.addCurrentVertex(m,T,e,e,p,w)}if(this.addCurrentVertex(m,T,0,0,p,w),g){const e=u?0:1;this.addCurrentVertex(m,T,e,e,p,w)}}else if("round"===n){if(g){const e=!t&&b?b:y;this.addCurrentVertex(m,e,0,0,p,w),!t&&u||this.addCurrentVertex(m,e,1,1,p,w,!0)}if(_){const e=!t&&x?x:v;!t&&c||this.addCurrentVertex(m,e,-1,-1,p,w,!0),this.addCurrentVertex(m,e,0,0,p,w)}}}}addVerticesTo(e,t,n,i,r,o,s,a,l,c){const u=(t.w-e.w)/this.tessellationStep|0;let h=0;const d=this.scaledDistance;if(u>1){this.lineSoFar=e.w;const d=(t.x-e.x)/u,f=(t.y-e.y)/u,p=(t.z-e.z)/u,m=(t.w-e.w)/u;for(let t=1;t<u;++t){e.x+=d,e.y+=f,e.z+=p,this.lineSoFar+=m,h+=m;const t=this.evaluateLineProgressFeatures(this.prevDistance+h);this.scaledDistance=(this.prevDistance+h)/this.totalDistance,this.addHalfVertex(e,n,i,c,!1,s,l,t),this.addHalfVertex(e,r,o,c,!0,-a,l,t)}}this.lineSoFar=t.w,this.scaledDistance=d;const f=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(t,n,i,c,!1,s,l,f),this.addHalfVertex(t,r,o,c,!0,-a,l,f)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&"offset"!==this.elevationType)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):He("line-progress evaluation for ".concat(this.layerIds[0]," requires enabling 'lineMetrics' for the source."));let t=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(t=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),"offset"!==this.elevationType?{zOffset:0,variableWidth:t}:"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:t}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:t}}addCurrentVertex(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const a=t.x+t.y*n,l=t.y-t.x*n,c=t.y*i-t.x,u=-t.y-t.x*i;if(null!=o){const t="offset"===this.elevationType,h=-10,d=Li+10,f=o.zOffset,p=new yf(e.x,e.y,f,this.lineSoFar),m=!!t&&xm(e,h,d),g=this.lineSoFar,_=this.distance;if(this.currentVertex)if(m){const t=this.currentVertexIsOutside,o=this.currentVertex,m=new yf(e.x,e.y,f,this.lineSoFar);if(xf(o,m,h,d),!xm(m,h,d)){if(t){this.e1=this.e2=-1,this.distance-=o.dist(p),this.lineSoFar=o.w;const e=this.evaluateLineProgressFeatures(o.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(o,a,l,s,!1,n,r,e),this.addHalfVertex(o,c,u,s,!0,-i,r,e),this.prevDistance=this.distance}this.distance=this.prevDistance+o.dist(m),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(o,m,a,l,c,u,n,i,r,s),this.distance=_,this.scaledDistance=this.distance/this.totalDistance}}else{const e=this.currentVertex;if(this.currentVertexIsOutside){xf(e,p,h,d),this.e1=this.e2=-1,this.distance-=e.dist(p),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e.w;const t=this.evaluateLineProgressFeatures(e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(e,a,l,s,!1,n,r,t),this.addHalfVertex(e,c,u,s,!0,-i,r,t),this.prevDistance=this.distance,this.distance=_,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(e,p,a,l,c,u,n,i,r,s)}else m||(this.addHalfVertex(e,a,l,s,!1,n,r,o),this.addHalfVertex(e,c,u,s,!0,-i,r,o));this.currentVertex=p,this.currentVertexIsOutside=m,this.lineSoFar=g}else this.addHalfVertex(e,a,l,s,!1,n,r,o),this.addHalfVertex(e,c,u,s,!0,-i,r,o)}addHalfVertex(e,t,n,i,r,o,s,a){let{x:l,y:c}=e;if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),r||this.segmentPoints.push(this.lineSoFar-this.segmentStart,o)),this.layoutVertexArray.emplaceBack((l<<1)+(i?1:0),(c<<1)+(r?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const e=un(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,e)}const u=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),s.primitiveLength++),r?this.e2=u:this.e1=u,null!=a&&this.zOffsetVertexArray.emplaceBack(a.zOffset,a.variableWidth,a.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,t){this.prevDistance=this.distance,this.distance+=e.dist(t),this.updateScaledDistance()}}function xm(e,t,n){return e.x<t||e.x>n||e.y<t||e.y>n}let bm,wm;function Em(e,t,n){return t*(Li/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}Xo(vm,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Tm=(e,t,n)=>(1-n)*e+n*t;function Am(e,t){return 1/Em(e,1,t.tileZoom)}function Sm(e,t,n,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Dm=e=>{const t=[];Cm(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=e.paint.get("line-trim-offset");0===n[0]&&0===n[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER");const i="none"===e.layout.get("line-join").constantOr("miter"),r=!!e.paint.get("line-pattern").constantOr(1);return i&&r&&t.push("LINE_JOIN_NONE"),t};function Cm(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}let Im;const Rm=()=>Im||(Im={layout:bm||(bm=new Rs({"line-cap":new Cs(Ps.layout_line["line-cap"]),"line-join":new Cs(Ps.layout_line["line-join"]),"line-miter-limit":new Ds(Ps.layout_line["line-miter-limit"]),"line-round-limit":new Ds(Ps.layout_line["line-round-limit"]),"line-sort-key":new Cs(Ps.layout_line["line-sort-key"]),"line-z-offset":new Cs(Ps.layout_line["line-z-offset"]),"line-elevation-reference":new Ds(Ps.layout_line["line-elevation-reference"]),"line-cross-slope":new Ds(Ps.layout_line["line-cross-slope"]),visibility:new Ds(Ps.layout_line.visibility),"line-width-unit":new Ds(Ps.layout_line["line-width-unit"])})),paint:wm||(wm=new Rs({"line-opacity":new Cs(Ps.paint_line["line-opacity"]),"line-color":new Cs(Ps.paint_line["line-color"]),"line-translate":new Ds(Ps.paint_line["line-translate"]),"line-translate-anchor":new Ds(Ps.paint_line["line-translate-anchor"]),"line-width":new Cs(Ps.paint_line["line-width"]),"line-gap-width":new Cs(Ps.paint_line["line-gap-width"]),"line-offset":new Cs(Ps.paint_line["line-offset"]),"line-blur":new Cs(Ps.paint_line["line-blur"]),"line-dasharray":new Cs(Ps.paint_line["line-dasharray"]),"line-pattern":new Cs(Ps.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ds(Ps.paint_line["line-pattern-cross-fade"]),"line-gradient":new Is(Ps.paint_line["line-gradient"]),"line-trim-offset":new Ds(Ps.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ds(Ps.paint_line["line-trim-fade-range"]),"line-trim-color":new Ds(Ps.paint_line["line-trim-color"]),"line-emissive-strength":new Ds(Ps.paint_line["line-emissive-strength"]),"line-border-width":new Cs(Ps.paint_line["line-border-width"]),"line-border-color":new Cs(Ps.paint_line["line-border-color"]),"line-occlusion-opacity":new Ds(Ps.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},Im);class Pm extends Cs{possiblyEvaluate(e,t){return t=new ys(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition,worldview:t.worldview}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=Le({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}let Mm;function Fm(e,t){return t>0?t+2*e:e}const Lm=ta([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),km=ta([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Om=ta([{name:"a_projected_pos",components:4,type:"Float32"}],4);ta([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Bm=ta([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),zm=ta([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Nm=ta([{name:"a_texb",components:2,type:"Uint16"}]),Um=ta([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Vm=ta([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ta([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jm=ta([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gm=ta([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ta([{name:"triangle",components:3,type:"Uint16"}]),ta([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ta([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ta([{type:"Float32",name:"offsetX"}]),ta([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Hm=24;function Wm(e,t,n){return e.sections.forEach(e=>{e.text=function(e,t,n){const i=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),_s.applyArabicShaping&&(e=_s.applyArabicShaping(e)),e}(e.text,t,n)}),e}const qm={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Xm(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function Zm(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const Ym=4294967296,Km=1/Ym,Jm="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");let Qm=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array(16);this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length;for(;this.pos<n;){const n=this.readVarint(),i=n>>3,r=this.pos;this.type=7&n,e(i,t,this),this.pos===r&&this.skip(n)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Ym;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Ym;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let n,i;return i=t[this.pos++],n=127&i,i<128?n:(i=t[this.pos++],n|=(127&i)<<7,i<128?n:(i=t[this.pos++],n|=(127&i)<<14,i<128?n:(i=t[this.pos++],n|=(127&i)<<21,i<128?n:(i=t[this.pos],n|=(15&i)<<28,function(e,t,n){const i=n.buf;let r,o;if(o=i[n.pos++],r=(112&o)>>4,o<128)return $m(e,r,t);if(o=i[n.pos++],r|=(127&o)<<3,o<128)return $m(e,r,t);if(o=i[n.pos++],r|=(127&o)<<10,o<128)return $m(e,r,t);if(o=i[n.pos++],r|=(127&o)<<17,o<128)return $m(e,r,t);if(o=i[n.pos++],r|=(127&o)<<24,o<128)return $m(e,r,t);if(o=i[n.pos++],r|=(1&o)<<31,o<128)return $m(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(n,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return Boolean(this.readVarint())}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Jm?Jm.decode(this.buf.subarray(t,e)):function(e,t,n){let i="",r=t;for(;r<n;){const t=e[r];let o,s,a,l=null,c=t>239?4:t>223?3:t>191?2:1;if(r+c>n)break;1===c?t<128&&(l=t):2===c?(o=e[r+1],128==(192&o)&&(l=(31&t)<<6|63&o,l<=127&&(l=null))):3===c?(o=e[r+1],s=e[r+2],128==(192&o)&&128==(192&s)&&(l=(15&t)<<12|(63&o)<<6|63&s,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(o=e[r+1],s=e[r+2],a=e[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&t)<<18|(63&o)<<12|(63&s)<<6|63&a,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readVarint(t));return e}readPackedSVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(e){const t=7&e;if(0===t)for(;this.buf[this.pos++]>127;);else if(2===t)this.pos=this.readVarint()+this.pos;else if(5===t)this.pos+=4;else{if(1!==t)throw new Error("Unimplemented type: ".concat(t));this.pos+=8}}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.dataView=new DataView(e.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Km),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Km),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(e,t){let n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(n=~(-e%4294967296),i=~(-e/4294967296),4294967295^n?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){const n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const t=this.pos;this.pos=function(e,t,n){for(let i,r,o=0;o<t.length;o++){if(i=t.charCodeAt(o),i>55295&&i<57344){if(!r){i>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);const n=this.pos-t;n>=128&&eg(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let n=0;n<t;n++)this.buf[this.pos++]=e[n]}writeRawMessage(e,t){this.pos++;const n=this.pos;e(t,this);const i=this.pos-n;i>=128&&eg(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i}writeMessage(e,t,n){this.writeTag(e,2),this.writeRawMessage(t,n)}writePackedVarint(e,t){t.length&&this.writeMessage(e,tg,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,ng,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,og,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,ig,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,rg,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,sg,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,ag,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,lg,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,cg,t)}writeBytesField(e,t){this.writeTag(e,2),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,5),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,5),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,1),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,1),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,0),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,0),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,2),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,5),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,1),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function $m(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function eg(e,t,n){const i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(let r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function tg(e,t){for(let n=0;n<e.length;n++)t.writeVarint(e[n])}function ng(e,t){for(let n=0;n<e.length;n++)t.writeSVarint(e[n])}function ig(e,t){for(let n=0;n<e.length;n++)t.writeFloat(e[n])}function rg(e,t){for(let n=0;n<e.length;n++)t.writeDouble(e[n])}function og(e,t){for(let n=0;n<e.length;n++)t.writeBoolean(e[n])}function sg(e,t){for(let n=0;n<e.length;n++)t.writeFixed32(e[n])}function ag(e,t){for(let n=0;n<e.length;n++)t.writeSFixed32(e[n])}function lg(e,t){for(let n=0;n<e.length;n++)t.writeFixed64(e[n])}function cg(e,t){for(let n=0;n<e.length;n++)t.writeSFixed64(e[n])}const ug=3;function hg(e,t,n){t.glyphs=[],1===e&&n.readMessage(dg,t)}function dg(e,t,n){if(3===e){const{id:e,bitmap:i,width:r,height:o,left:s,top:a,advance:l}=n.readMessage(fg,{});t.glyphs.push({id:e,bitmap:new hh({width:r+2*ug,height:o+2*ug},i),metrics:{width:r,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function fg(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}const pg=ug,mg={horizontal:1,vertical:2,horizontalOnly:3};class gg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,t){const n=new gg;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new gg;return t.image=e,t}}class _g{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t,n){const i=new _g;for(let r=0;r<e.sections.length;r++){const o=e.sections[r];o.image?i.addImageSection(o,n):i.addTextSection(o,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let n="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,o=e.charCodeAt(i-1)||null;n+=!t&&(r&&is(r)&&!qm[e[i+1]]||o&&is(o)&&!qm[e[i-1]])||!qm[e[i]]?e[i]:qm[e[i]]}return n}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&vg[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&vg[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new _g;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(gg.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(n)}addImageSection(e,t){const n=e.image?e.image.getPrimary():null;if(!n)return void He("Can't add FormattedSection with an empty image.");n.scaleSelf(t);const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(gg.forImage(n)),this.sectionIndex.push(this.sections.length-1)):He("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yg(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p){let m=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;const g=_g.fromFeature(e,r,m);h===mg.vertical&&g.verticalizePunctuation(d);let _=[];const y=function(e,t,n,i,r,o){if(!e)return[];const s=[],a=function(e,t,n,i,r,o){let s=0;for(let a=0;a<e.length();a++){const n=e.getSection(a);s+=bg(e.getCodePoint(a),n,i,r,t,o)}return s/Math.max(1,Math.ceil(s/n))}(e,t,n,i,r,o),l=e.text.indexOf("\u200b")>=0;let c=0;for(let h=0;h<e.length();h++){const n=e.getSection(h),d=e.getCodePoint(h);if(vg[d]||(c+=bg(d,n,i,r,t,o)),h<e.length()-1){const t=!((u=d)<11904||!(Qo["Bopomofo Extended"](u)||Qo.Bopomofo(u)||Qo["CJK Compatibility Forms"](u)||Qo["CJK Compatibility Ideographs"](u)||Qo["CJK Compatibility"](u)||Qo["CJK Radicals Supplement"](u)||Qo["CJK Strokes"](u)||Qo["CJK Symbols and Punctuation"](u)||Qo["CJK Unified Ideographs Extension A"](u)||Qo["CJK Unified Ideographs"](u)||Qo["Enclosed CJK Letters and Months"](u)||Qo["Halfwidth and Fullwidth Forms"](u)||Qo.Hiragana(u)||Qo["Ideographic Description Characters"](u)||Qo["Kangxi Radicals"](u)||Qo["Katakana Phonetic Extensions"](u)||Qo.Katakana(u)||Qo["Vertical Forms"](u)||Qo["Yi Radicals"](u)||Qo["Yi Syllables"](u)));(xg[d]||t||n.image)&&s.push(Tg(h+1,c,a,s,Eg(d,e.getCodePoint(h+1),t&&l),!1))}}var u;return Ag(Tg(e.length(),c,a,s,0,!0))}(g,c,o,t,i,f),{processBidirectionalText:v,processStyledBidirectionalText:x}=_s;if(v&&1===g.sections.length){const e=v(g.toString(),y);for(const t of e){const e=new _g;e.text=t,e.sections=g.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);_.push(e)}}else if(x){const e=x(g.text,g.sectionIndex,y);for(const t of e){const e=new _g;e.text=t[0],e.sectionIndex=t[1],e.sections=g.sections,_.push(e)}}else _=function(e,t){const n=[],i=e.text;let r=0;for(const o of t)n.push(e.substring(r,o)),r=o;return r<i.length&&n.push(e.substring(r,i.length)),n}(g,y);const b=[],w={positionedLines:b,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(e,t,n,i,r,o,s,a,l,c,u,h){let d=0,f=0,p=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const w of r){const e=w.getSections();for(const n of e){if(n.image)continue;const e=t[n.fontStack];if(e&&(g=void 0!==e.ascender&&void 0!==e.descender,!g))break}if(!g)break}let _=0;for(const w of r){w.trim();const r=w.getMaxScale(),s=(r-1)*Hm,a={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=a;const v=a.positionedGlyphs;let x=0;if(!w.length()){f+=o,++_;continue}let b=0,E=0;for(let o=0;o<w.length();o++){const s=w.getSection(o),a=w.getSectionIndex(o),p=w.getCodePoint(o);let m=s.scale,_=null,T=null,A=null,S=Hm,D=0,C=l;C===mg.vertical&&(12312===(y=p)||12313===y||12316===y||12540===y||12448===y)&&(C=mg.horizontal);const I=!(C===mg.horizontal||!u&&!ns(p)||u&&(vg[p]||rs(p)));if(s.image){const t=i.get(s.image.toString());if(!t)continue;A=s.image,e.iconsInText=e.iconsInText||!0,T=t.paddedRect;const n=t.displaySize;m=m*Hm/h,_={width:n[0],height:n[1],left:0,top:-pg,advance:I?n[1]:n[0],localGlyph:!1},D=g?-_.height*m:r*Hm-17-n[1]*m,S=_.advance;const o=(I?n[0]:n[1])*m-Hm*r;o>0&&o>x&&(x=o)}else{const e=n[s.fontStack];if(!e)continue;e[p]&&(T=e[p]);const i=t[s.fontStack];if(!i)continue;const o=i.glyphs[p];if(!o)continue;if(_=o.metrics,S=8203!==p?Hm:0,g){const e=void 0!==i.ascender?Math.abs(i.ascender):0,t=void 0!==i.descender?Math.abs(i.descender):0,n=(e+t)*m;b<n&&(b=n,E=(e-t)/2*m),D=-e*m}else D=(r-m)*Hm-17}I?(e.verticalizable=!0,v.push({glyph:p,image:A,x:d,y:f+D,vertical:I,scale:m,localGlyph:_.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:_,rect:T}),d+=S*m+c):(v.push({glyph:p,image:A,x:d,y:f+D,vertical:I,scale:m,localGlyph:_.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:_,rect:T}),d+=_.advance*m+c)}0!==v.length&&(p=Math.max(d-c,p),g?Dg(v,m,x,E,o*r/2):Dg(v,m,x,0,o/2)),d=0;const T=o*r+x;a.lineOffset=Math.max(x,s),f+=T,++_}var y;const v=f,{horizontalAlign:x,verticalAlign:b}=Sg(s);(function(e,t,n,i,r,o){const s=(t-n)*r,a=-o*i;for(const l of e)for(const e of l.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,m,x,b,p,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*p,e.right=e.left+p,e.hasBaseline=g}(w,t,n,i,_,s,a,l,h,c,d,p),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b))return w}const vg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bg(e,t,n,i,r,o){if(t.image){const e=i.get(t.image.toString());return e?e.displaySize[0]*t.scale*Hm/o+r:0}{const i=n[t.fontStack],o=i&&i.glyphs[e];return o?o.metrics.advance*t.scale+r:0}}function wg(e,t,n,i){const r=Math.pow(e-t,2);return i?e<t?r/2:2*r:r+Math.abs(n)*n}function Eg(e,t,n){let i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function Tg(e,t,n,i,r,o){let s=null,a=wg(t,n,r,o);for(const l of i){const e=wg(t-l.x,n,r,o)+l.badness;e<=a&&(s=l,a=e)}return{index:e,x:t,priorBreak:s,badness:a}}function Ag(e){return e?Ag(e.priorBreak).concat(e.index):[]}function Sg(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Dg(e,t,n,i,r){if(!(t||n||i||r))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let l=0;l<=o;l++)e[l].x-=a,e[l].y+=n+i+r}function Cg(e){return void 0!==e.imagePrimary&&void 0!==e.top&&void 0!==e.bottom&&void 0!==e.left&&void 0!==e.right}function Ig(e,t,n,i){const{horizontalAlign:r,verticalAlign:o}=Sg(i),s=n[0]-e.displaySize[0]*r,a=n[1]-e.displaySize[1]*o;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function Rg(e,t,n,i,r,o){const s=e.imagePrimary;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,f;"width"===n||"both"===n?(f=r[0]+l-i[3],h=r[0]+c+i[1]):(f=r[0]+(l+c-s.displaySize[0])/2,h=f+s.displaySize[0]);const p=t.top*o,m=t.bottom*o;return"height"===n||"both"===n?(u=r[1]+p-i[0],d=r[1]+m+i[2]):(u=r[1]+(p+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:h,bottom:d,left:f,collisionPadding:a}}function Pg(e){return!e.imagePrimary.stretchX}function Mg(e){return!e.imagePrimary.stretchY}function Fg(e){return{width:e.right-e.left,height:e.bottom-e.top}}const Lg=128;function kg(e,t,n){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new ys(e+1,{worldview:n}))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=i;let o=0;for(;o<t.length&&t[o]<=e;)o++;o=Math.max(0,o-1);let s=o;for(;s<t.length&&t[s]<e+1;)s++;s=Math.min(t.length-1,s);const a=t[o],l=t[s];return"composite"===i.kind?{kind:"composite",minZoom:a,maxZoom:l,interpolationType:r}:{kind:"camera",minZoom:a,maxZoom:l,minSize:i.evaluate(new ys(a,{worldview:n})),maxSize:i.evaluate(new ys(l,{worldview:n})),interpolationType:r}}}function Og(e,t,n){let{uSize:i,uSizeT:r}=t,{lowerSize:o,upperSize:s}=n;return"source"===e.kind?o/Lg:"composite"===e.kind?un(o/Lg,s/Lg,r):i}function Bg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=0,r=0;if("constant"===e.kind)r=e.layoutSize*n;else if("source"!==e.kind){const{interpolationType:o,minZoom:s,maxZoom:a}=e,l=o?Re(jr.interpolationFactor(o,t,s,a),0,1):0;"camera"===e.kind?r=un(e.minSize,e.maxSize,l)*n:i=l*n}return{uSizeT:i,uSize:r}}class zg extends xe{constructor(e,t,n,i,r){super(e,t),this.angle=i,this.z=n,void 0!==r&&(this.segment=r)}clone(){return new zg(this.x,this.y,this.z,this.angle,this.segment)}}function Ng(e,t,n,i,r){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<n/2;){const t=e[s],n=e[s+1];if(!n)return!1;let o=e[s-1].angleTo(t)-t.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=t.dist(n)}return!0}function Ug(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Vg(e,t,n){return e?.6*t*n:0}function jg(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Gg(e,t,n,i,r,o){const s=Vg(n,r,o),a=jg(n,i)*o;let l=0;const c=Ug(e)/2;for(let u=0;u<e.length-1;u++){const n=e[u],i=e[u+1],r=n.dist(i);if(l+r>c){const o=(c-l)/r,h=un(n.x,i.x,o),d=un(n.y,i.y,o),f=new zg(h,d,0,i.angleTo(n),u);return!s||Ng(e,f,a,s,t)?f:void 0}l+=r}}function Hg(e,t,n,i,r,o,s,a,l){const c=Vg(i,o,s),u=jg(i,r),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),Wg(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,n,h,d,!1,l)}function Wg(e,t,n,i,r,o,s,a,l){const c=o/2,u=Ug(e);let h=0,d=t-n,f=[];for(let p=0;p<e.length-1;p++){const t=e[p],s=e[p+1],a=t.dist(s),m=s.angleTo(t);for(;d+n<h+a;){d+=n;const g=(d-h)/a,_=un(t.x,s.x,g),y=un(t.y,s.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const t=new zg(_,y,0,m,p);i&&!Ng(e,t,o,i,r)||f.push(t)}}h+=a}return a||f.length||s||(f=Wg(e,h/2,n,i,r,o,s,!0,l)),f}function qg(e){let t=0,n=0;for(const s of e)t+=s.w*s.h,n=Math.max(n,s.w);e.sort((e,t)=>t.h-e.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let r=0,o=0;for(const s of e)for(let e=i.length-1;e>=0;e--){const t=i[e];if(!(s.w>t.w||s.h>t.h)){if(s.x=t.x,s.y=t.y,o=Math.max(o,s.y+s.h),r=Math.max(r,s.x+s.w),s.w===t.w&&s.h===t.h){const t=i.pop();t&&e<i.length&&(i[e]=t)}else s.h===t.h?(t.x+=s.w,t.w-=s.w):s.w===t.w?(t.y+=s.h,t.h-=s.h):(i.push({x:t.x+s.w,y:t.y,w:t.w-s.w,h:s.h}),t.y+=s.h,t.h-=s.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}Xo(zg,"Anchor");const Xg=1;class Zg{static getImagePositionScale(e,t,n){if(t&&e&&e.options&&e.options.transform){const t=e.options.transform;return{x:t.a,y:t.d}}return{x:n,y:n}}constructor(e,t,n,i){this.paddedRect=e;const{pixelRatio:r,version:o,stretchX:s,stretchY:a,content:l,sdf:c,usvg:u}=t;this.pixelRatio=r,this.stretchX=s,this.stretchY=a,this.content=l,this.version=o,this.padding=n,this.sdf=c,this.usvg=u,this.scale=Zg.getImagePositionScale(i,u,r)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Yg(e,t,n){const i=On.parse(e),r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1];return{x:0,y:0,w:(e.data?e.data.width:e.width*n[0])+2*t,h:(e.data?e.data.height:e.height*n[1])+2*t}}(t,n,[i.options.transform.a,i.options.transform.d]);return{bin:r,imagePosition:new Zg(r,t,n,i),imageVariant:i}}class Kg{constructor(e,t,n){const i=new Map,r=new Map;this.haveRenderCallbacks=[];const o=[];this.addImages(e,i,Xg,o),this.addImages(t,r,2,o);const{w:s,h:a}=qg(o),l=new dh({width:s||1,height:a||1});for(const[c,u]of e.entries()){const e=i.get(c).paddedRect;dh.copy(u.data,l,{x:0,y:0},{x:e.x+Xg,y:e.y+Xg},u.data,n,u.sdf)}for(const[c,u]of t.entries()){const e=r.get(c),t=e.paddedRect;let i=e.padding;const o=t.x+i,s=t.y+i,a=u.data.width,h=u.data.height;i=i>1?i-1:i,dh.copy(u.data,l,{x:0,y:0},{x:o,y:s},u.data,n),dh.copy(u.data,l,{x:0,y:h-i},{x:o,y:s-i},{width:a,height:i},n),dh.copy(u.data,l,{x:0,y:0},{x:o,y:s+h},{width:a,height:i},n),dh.copy(u.data,l,{x:a-i,y:0},{x:o-i,y:s},{width:i,height:h},n),dh.copy(u.data,l,{x:0,y:0},{x:o+a,y:s},{width:i,height:h},n),dh.copy(u.data,l,{x:a-i,y:h-i},{x:o-i,y:s-i},{width:i,height:i},n),dh.copy(u.data,l,{x:0,y:h-i},{x:o+a,y:s-i},{width:i,height:i},n),dh.copy(u.data,l,{x:0,y:0},{x:o+a,y:s+h},{width:i,height:i},n),dh.copy(u.data,l,{x:a-i,y:0},{x:o-i,y:s+h},{width:i,height:i},n)}this.lut=n,this.image=l,this.iconPositions=i,this.patternPositions=r}addImages(e,t,n,i){for(const[r,o]of e.entries()){const{bin:e,imagePosition:s,imageVariant:a}=Yg(r,o,n);t.set(r,s),i.push(e),o.hasRenderCallback&&this.haveRenderCallbacks.push(a.id)}}patchUpdatedImages(e,t,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(t=>e.hasImage(t,n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const i of e.getUpdatedImages(n)){for(const r of this.iconPositions.keys()){const o=On.parse(r);if(tn.isEqual(o.id,i)){const o=e.getImage(i,n);this.patchUpdatedImage(this.iconPositions.get(r),o,t)}}for(const r of this.patternPositions.keys()){const o=On.parse(r);if(tn.isEqual(o.id,i)){const o=e.getImage(i,n);this.patchUpdatedImage(this.patternPositions.get(r),o,t)}}}}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,r]=e.tl,o=e.sdf;if(this.lut||o){const e={width:t.data.width,height:t.data.height},s=new dh(e);dh.copy(t.data,s,{x:0,y:0},{x:0,y:0},e,this.lut,o),n.update(s,{position:{x:i,y:r}})}else n.update(t.data,{position:{x:i,y:r}})}}Xo(Zg,"ImagePosition"),Xo(Kg,"ImageAtlas");const Jg=1e20;function Qg(e,t,n,i,r,o,s,a,l){for(let c=t;c<t+i;c++)$g(e,n*o+c,o,r,s,a,l);for(let c=n;c<n+r;c++)$g(e,c*o+t,1,i,s,a,l)}function $g(e,t,n,i,r,o,s){o[0]=0,s[0]=-Jg,s[1]=Jg,r[0]=e[t];for(let a=1,l=0,c=0;a<i;a++){r[a]=e[t+a*n];const i=a*a;do{const e=o[l];c=(r[a]-r[e]+i-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=Jg}for(let a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;const i=o[l],c=a-i;e[t+a*n]=r[i]+c*c}}const e_=2,t_={none:0,ideographs:1,all:2};class n_{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const n=[],i=this.url||it.GLYPHS_URL;for(const r in e)for(const t of e[r])n.push({stack:r,id:t});Fe(n,(e,t)=>{let{stack:n,id:r}=e,o=this.entries[n];o||(o=this.entries[n]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let s=o.glyphs[r];if(void 0!==s)return void t(null,{stack:n,id:r,glyph:s});if(s=this._tinySDF(o,n,r),s)return o.glyphs[r]=s,void t(null,{stack:n,id:r,glyph:s});const a=Math.floor(r/256);if(256*a>65535)return He("glyphs > 65535 not supported"),void t(null,{stack:n,id:r,glyph:s});if(o.ranges[a])return void t(null,{stack:n,id:r,glyph:s});let l=o.requests[a];l||(l=o.requests[a]=[],n_.loadGlyphRange(n,a,i,this.requestManager,(e,t)=>{if(t){o.ascender=t.ascender,o.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(o.glyphs[+e]=t.glyphs[+e]);o.ranges[a]=!0}for(const n of l)n(e,t);delete o.requests[a]})),l.push((e,i)=>{e?t(e):i&&t(null,{stack:n,id:r,glyph:i.glyphs[r]||null})})},(e,n)=>{if(e)t(e);else if(n){const e={};for(const{stack:t,id:i,glyph:r}of n)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[i]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==t_.none&&(this.localGlyphMode===t_.all?!!this.localFontFamily:!!this.localFontFamily&&(Qo["CJK Unified Ideographs"](e)||Qo["Hangul Syllables"](e)||Qo.Hiragana(e)||Qo.Katakana(e)||Qo["CJK Symbols and Punctuation"](e)||Qo["CJK Unified Ideographs Extension A"](e)||Qo["CJK Unified Ideographs Extension B"](e)||Qo.Osage(e)))}_tinySDF(e,t,n){const i=this.localFontFamily;if(!i||!this._doesCharSupportLocalGlyph(n))return;let r=e.tinySDF;if(!r){let n="400";/bold/i.test(t)?n="900":/medium/i.test(t)?n="500":/light/i.test(t)&&(n="200"),r=e.tinySDF=new n_.TinySDF({fontFamily:i,fontWeight:n,fontSize:24*e_,buffer:3*e_,radius:8*e_}),r.fontWeight=n}if(this.localGlyphs[r.fontWeight][n])return this.localGlyphs[r.fontWeight][n];const o=String.fromCodePoint(n),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:f}=r.draw(o);return this.localGlyphs[r.fontWeight][n]={id:n,bitmap:new hh({width:a,height:l},s),metrics:{width:c/e_,height:u/e_,left:h/e_,top:d/e_-27,advance:f/e_,localGlyph:!0}}}}n_.loadGlyphRange=function(e,t,n,i,r){const o=256*t,s=o+255,a=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}","".concat(o,"-").concat(s)),Mt.Glyphs);Ot(a,(e,t)=>{if(e)r(e);else if(t){const e={},n=function(e){return new Qm(e).readFields(hg,{})}(t);for(const t of n.glyphs)e[t.id]=t;r(null,{glyphs:e,ascender:n.ascender,descender:n.descender})}})},n_.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=i,this.radius=n;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font="".concat(s," ").concat(o," ").concat(e,"px ").concat(r),c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),f={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return f;const{ctx:p,buffer:m,gridInner:g,gridOuter:_}=this;p.clearRect(m,m,a,l),p.fillText(e,m,m+s);const y=p.getImageData(m,m,a,l);_.fill(Jg,0,h),g.fill(0,0,h);for(let v=0;v<l;v++)for(let e=0;e<a;e++){const t=y.data[4*(v*a+e)+3]/255;if(0===t)continue;const n=(v+m)*c+e+m;if(1===t)_[n]=0,g[n]=Jg;else{const e=.5-t;_[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}Qg(_,0,0,c,u,c,this.f,this.v,this.z),Qg(g,m,m,a,l,c,this.f,this.v,this.z);for(let v=0;v<h;v++){const e=Math.sqrt(_[v])-Math.sqrt(g[v]);d[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return f}};const i_=Xg;function r_(e,t){return e+t[1]-t[0]}function o_(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const o=[],s=e.imagePrimary,a=s.pixelRatio,l=s.paddedRect.w-2*i_,c=s.paddedRect.h-2*i_,u=(e.right-e.left)*r,h=(e.bottom-e.top)*r,d=s.stretchX||[[0,l]],f=s.stretchY||[[0,c]],p=d.reduce(r_,0),m=f.reduce(r_,0),g=l-p,_=c-m;let y=0,v=p,x=0,b=m,w=0,E=g,T=0,A=_;if(s.content&&i){const e=s.content;y=s_(d,0,e[0]),x=s_(f,0,e[1]),v=s_(d,e[0],e[2]),b=s_(f,e[1],e[3]),w=e[0]-y,T=e[1]-x,E=e[2]-e[0]-v,A=e[3]-e[1]-b}const S=(i,o,l,c)=>{const d=l_(i.stretch-y,v,u,e.left*r),f=c_(i.fixed-w,E,i.stretch,p),g=l_(o.stretch-x,b,h,e.top*r),_=c_(o.fixed-T,A,o.stretch,m),S=l_(l.stretch-y,v,u,e.left*r),D=c_(l.fixed-w,E,l.stretch,p),C=l_(c.stretch-x,b,h,e.top*r),I=c_(c.fixed-T,A,c.stretch,m),R=new xe(d,g),P=new xe(S,g),M=new xe(S,C),F=new xe(d,C),L=new xe(f/a,_/a),k=new xe(D/a,I/a),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),n=[t,-e,e,t];R._matMult(n),P._matMult(n),F._matMult(n),M._matMult(n)}const B=i.stretch+i.fixed,z=l.stretch+l.fixed,N=o.stretch+o.fixed,U=c.stretch+c.fixed,V=e.imageSecondary;return{tl:R,tr:P,bl:F,br:M,texPrimary:{x:s.paddedRect.x+i_+B,y:s.paddedRect.y+i_+N,w:z-B,h:U-N},texSecondary:V?{x:V.paddedRect.x+i_+B,y:V.paddedRect.y+i_+N,w:z-B,h:U-N}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:k,minFontScaleX:E/a/u,minFontScaleY:A/a/h,isSDF:n}};if(i&&(s.stretchX||s.stretchY)){const e=a_(d,g,p),t=a_(f,_,m);for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)o.push(S(i,t[e],r,t[e+1]))}}else o.push(S({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function s_(e,t,n){let i=0;for(const r of e)i+=Math.max(t,Math.min(n,r[1]))-Math.max(t,Math.min(n,r[0]));return i}function a_(e,t,n){const i=[{fixed:-i_,stretch:0}];for(const[r,o]of e){const e=i[i.length-1];i.push({fixed:r-e.stretch,stretch:e.stretch}),i.push({fixed:r-e.stretch,stretch:e.stretch+(o-r)})}return i.push({fixed:t+i_,stretch:n}),i}function l_(e,t,n,i){return e/t*n+i}function c_(e,t,n,i){return e-t*n/i}function u_(e,t,n,i){const r=t+e.positionedLines[i].lineOffset;return 0===i?n+r/2:n+(r+(t+e.positionedLines[i-1].lineOffset))/2}function h_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1/0,r=1/0,o=-1/0,s=-1/0;const a=e[0];for(let f=0;f<a.length;f++){const e=a[f];(!f||e.x<i)&&(i=e.x),(!f||e.y<r)&&(r=e.y),(!f||e.x>o)&&(o=e.x),(!f||e.y>s)&&(s=e.y)}const l=Math.min(o-i,s-r);let c=l/2;const u=new Fi([],d_);if(0===l)return new xe(i,r);for(let f=i;f<o;f+=l)for(let t=r;t<s;t+=l)u.push(new f_(f+c,t+c,c,e));let h=function(e){let t=0,n=0,i=0;const r=e[0];for(let o=0,s=r.length,a=s-1;o<s;a=o++){const e=r[o],s=r[a],l=e.x*s.y-s.x*e.y;n+=(e.x+s.x)*l,i+=(e.y+s.y)*l,t+=3*l}return new f_(n/t,i/t,0,e)}(e),d=u.length;for(;u.length;){const i=u.pop();(i.d>h.d||!h.d)&&(h=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,d)),i.max-h.d<=t||(c=i.h/2,u.push(new f_(i.p.x-c,i.p.y-c,c,e)),u.push(new f_(i.p.x+c,i.p.y-c,c,e)),u.push(new f_(i.p.x-c,i.p.y+c,c,e)),u.push(new f_(i.p.x+c,i.p.y+c,c,e)),d+=4)}return n&&(console.log("num probes: ".concat(d)),console.log("best distance: ".concat(h.d))),h.p}function d_(e,t){return t.max-e.max}class f_{constructor(e,t,n,i){this.p=new xe(e,t),this.h=n,this.d=function(e,t){let n=!1,i=1/0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=0,r=o.length,s=r-1;t<r;s=t++){const r=o[t],a=o[s];r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,nu(e,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}}const p_=Object.keys,m_=Number.POSITIVE_INFINITY,g_=Math.sqrt(2);function __(e,t){let[n,i]=t,r=0,o=0;if(i===m_){n<0&&(n=0);const t=n/g_;switch(e){case"top-right":case"top-left":o=t-7;break;case"bottom-right":case"bottom-left":o=7-t;break;case"bottom":o=7-n;break;case"top":o=n-7}switch(e){case"top-right":case"bottom-right":r=-t;break;case"top-left":case"bottom-left":r=t;break;case"left":r=n;break;case"right":r=-n}}else{switch(n=Math.abs(n),i=Math.abs(i),e){case"top-right":case"top-left":case"top":o=i-7;break;case"bottom-right":case"bottom-left":case"bottom":o=7-i}switch(e){case"top-right":case"bottom-right":case"right":r=-n;break;case"top-left":case"bottom-left":case"left":r=n}}return[r,o]}function y_(e,t,n,i,r,o,s,a,l){if(!t||!t.usvg)return;const c=Fg(i),u=Fg(r),h="both"!==o&&"width"!==o||!Pg(i)?1:u.width/c.width,d="both"!==o&&"height"!==o||!Mg(i)?1:u.height/c.height;n.scaleSelf(h,d);const f=n.toString();s.set(f,n),a.set(f,t);const{imagePosition:p}=Yg(f,t,Xg);l.set(f,p)}function v_(e,t,n,i,r,o,s,a,l){if(!e)return;const c=function(e,t,n,i,r,o){if("camera"===e.kind)return e.maxSize;if("composite"===e.kind){const i=t.possiblyEvaluate(new ys(e.maxZoom,{worldview:o}),n).evaluate(r,{},n),s=t.possiblyEvaluate(new ys(e.minZoom,{worldview:o}),n).evaluate(r,{},n);return Math.max(i,s)}return t.possiblyEvaluate(new ys(i,{worldview:o})).evaluate(r,{},n)}(t,n,i,r,o,l);return e.scaleSelf(c*a*s)}function x_(e,t,n,i,r,o,s,a,l){return{iconPrimary:v_(e.getPrimary(),t,n,i,r,o,s,a,l),iconSecondary:v_(e.getSecondary(),t,n,i,r,o,s,a,l)}}function b_(e,t,n){if(!t)return;const i=n.get(e.toString()),r=n.get(t.toString());r&&(i.paddedRect.w===r.paddedRect.w&&i.paddedRect.h===r.paddedRect.h||He("Mismatch in icon variant sizes: ".concat(e.toString()," and ").concat(t.toString())),i.usvg!==r.usvg&&He("Mismatch in icon variant image types: ".concat(e.id," and ").concat(t.id)))}function w_(e,t,n,i){if(!e)return;const r=t.get(n.toString());if(e.imagePrimary=r,i){const n=t.get(i.toString());e.imageSecondary=n}}function E_(e,t){for(const n in e.horizontal)T_(e.horizontal[n],t);T_(e.vertical,t)}function T_(e,t){if(e)for(const n of e.positionedLines)for(const e of n.positionedGlyphs)if(null!==e.image){const n=e.image.toString();e.rect=t.get(n).paddedRect}}function A_(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function S_(e,t,n,i,r,o,s,a,l){const c=P_(o.horizontal)||o.vertical,u=n.get("icon-text-fit-padding").evaluate(i,{},r);let h,d=t;return t&&"none"!==l&&(e.allowVerticalPlacement&&o.vertical&&(h=Rg(t,o.vertical,l,u,a,s)),c&&(d=Rg(t,c,l,u,a,s))),{defaultShapedIcon:d,verticallyShapedIcon:h}}function D_(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v){let x=s.textMaxSize.evaluate(t,{},d);void 0===x?x=a*s.textScaleFactor:x*=s.textScaleFactor;const b=e.layers[0].layout,w=P_(n.horizontal)||n.vertical,E="globe"===f.name,T=Hm,A=e.tilePixelRatio*x/T,S=(M=e.overscaling,e.zoom>18&&M>2&&(M>>=1),Math.max(Li/(512*M),1)*b.get("symbol-spacing")),D=b.get("text-padding")*e.tilePixelRatio,C=b.get("icon-padding")*e.tilePixelRatio,I=Te(b.get("text-max-angle")),R="map"===b.get("icon-rotation-alignment")&&"point"!==v,P=S/2;var M;!1===e.hasAnyIconTextFit&&"none"!==g&&(e.hasAnyIconTextFit=!0);const F=t.properties?+t.properties[Sc]:null,L=F&&e.elevationFeatureIdToIndex?e.elevationFeatureIdToIndex.get(F):65535,k=(a,l,v)=>{if(l.x<0||l.x>=Li||l.y<0||l.y>=Li)return;let x=null;if(E){const{x:e,y:t,z:n}=f.projectTilePoint(l.x,l.y,v);x={anchor:new zg(e,t,n,0,void 0),up:f.upVector(v,l.x,l.y)}}!function(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,E,T,A,S,D,C){const I=e.addToLineVertexArray(t,i);let R,P,M,F,L,k,O,B=0,z=0,N=0,U=0,V=-1,j=-1;const G={};let H=Yt("");const W=n?n.anchor:t,q="none"!==D;let X=0,Z=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")){const e=l.layout.get("text-offset").evaluate(x,{},T);X=e[0]*Hm,Z=e[1]*Hm}else X=l.layout.get("text-radial-offset").evaluate(x,{},T)*Hm,Z=m_;if(e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(p)k=F_(e),a&&(O=F_(a));else{const n=l.layout.get("text-rotate").evaluate(x,{},T)+90;M=M_(c,W,t,u,h,d,e,f,n,m),a&&(F=M_(c,W,t,u,h,d,a,_,n))}}if(o){const i=e.iconSizeData,r=l.layout.get("icon-rotate").evaluate(x,{},T),s=o_(o,r,w,q,b.iconScaleFactor),f=a?o_(a,r,w,q,b.iconScaleFactor):void 0;P=M_(c,W,t,u,h,d,o,_,r,null),B=4*s.length;let p=null;"source"===i.kind?(p=[Lg*l.layout.get("icon-size").evaluate(x,{},T)*b.iconScaleFactor],p[0]>I_&&He("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(C_,'. Reduce your "icon-size".'))):"composite"===i.kind&&(p=[Lg*b.compositeIconSizes[0].evaluate(x,{},T)*b.iconScaleFactor,Lg*b.compositeIconSizes[1].evaluate(x,{},T)*b.iconScaleFactor],(p[0]>I_||p[1]>I_)&&He("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(C_,'. Reduce your "icon-size".'))),e.addSymbols(e.icon,s,p,v,y,x,void 0,n,t,I.lineStartIndex,I.lineLength,-1,E,T,A,S),V=e.icon.placedSymbolArray.length-1,f&&(z=4*f.length,e.addSymbols(e.icon,f,p,v,y,x,mg.vertical,n,t,I.lineStartIndex,I.lineLength,-1,E,T,A,S),j=e.icon.placedSymbolArray.length-1)}for(const Q in r.horizontal){const i=Q,o=r.horizontal[i];R||(H=Yt(o.text),p?L=F_(o):R=M_(c,W,t,u,h,d,o,f,l.layout.get("text-rotate").evaluate(x,{},T),m));const a=1===o.positionedLines.length;if(N+=R_(e,n,t,o,s,l,p,x,m,I,r.vertical?mg.horizontal:mg.horizontalOnly,a?p_(r.horizontal):[i],G,V,b,E,T,A),a)break}r.vertical&&(U+=R_(e,n,t,r.vertical,s,l,p,x,m,I,mg.vertical,["vertical"],G,j,b,E,T,A));let Y=-1;const K=(e,t)=>e?Math.max(e,t):t;Y=K(L,Y),Y=K(k,Y),Y=K(O,Y);const J=Y>-1?1:0;e.glyphOffsetArray.length>=65535&&He("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,W.x,W.y,W.z,G.right>=0?G.right:-1,G.center>=0?G.center:-1,G.left>=0?G.left:-1,G.vertical>=0?G.vertical:-1,V,j,H,void 0!==R?R:e.collisionBoxArray.length,void 0!==R?R+1:e.collisionBoxArray.length,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,F||e.collisionBoxArray.length,F?F+1:e.collisionBoxArray.length,u,N,U,B,z,J,0,X,Z,Y,0,q?1:0,C)}(e,l,x,a,n,i,o,r,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,D,y,c,0,C,R,_,t,s,u,h,d,p,m,g,L)};if("line"===v)for(const O of bf(t.geometry,0,0,Li,Li)){const t=Hg(O,S,I,n.vertical||w,i,T,A,e.overscaling,Li);for(const n of t)w&&L_(e,w.text,P,n)||k(O,n,d)}else if("line-center"===v){for(const O of t.geometry)if(O.length>1){const e=Gg(O,I,n.vertical||w,i,T,A);e&&k(O,e,d)}}else if("Polygon"===t.type)for(const O of Wh(t.geometry,0)){const e=h_(O,16);k(O[0],new zg(e.x,e.y,0,0,void 0),d)}else if("LineString"===t.type)for(const O of t.geometry)k(O,new zg(O[0].x,O[0].y,0,0,void 0),d);else if("Point"===t.type)for(const O of t.geometry)for(const e of O)k([e],new zg(e.x,e.y,0,0,void 0),d)}const C_=255,I_=C_*Lg;function R_(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_){const y=function(e,t,n,i,r,o,s,a){const l=[];if(0===t.positionedLines.length)return l;const c=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],n=e[1],i=t*n;return i>0?[t,-n]:i<0?[-t,n]:0===t?[n,t]:[n,-t]}(n);let h=Math.abs(t.top-t.bottom);for(const m of t.positionedLines)h-=m.lineOffset;const d=t.positionedLines.length,f=h/d;let p=t.top-n[1];for(let m=0;m<d;++m){const e=t.positionedLines[m];p=u_(t,f,p,m);for(const i of e.positionedGlyphs){if(!i.rect)continue;const e=i.rect||{};let o=pg+1,h=!0,d=1,f=0;if(i.image){const e=s.get(i.image.toString());if(!e)continue;if(e.sdf){He("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=e.pixelRatio,o=Xg/d}const m=(r||a)&&i.vertical,g=i.metrics.advance*i.scale/2,_=i.metrics,y=i.rect;if(null===y)continue;a&&t.verticalizable&&(f=i.image?g-i.metrics.width*i.scale/2:0);const v=r?[i.x+g,i.y]:[0,0];let x=[0,0],b=[0,0],w=!1;r||(m?(b=[i.x+g+u[0],i.y+u[1]-f],w=!0):x=[i.x+g+n[0],i.y+n[1]-f]);const E=y.w*i.scale/(d*(i.localGlyph?e_:1)),T=y.h*i.scale/(d*(i.localGlyph?e_:1));let A,S,D,C;if(m){const e=i.y-p,t=new xe(-g,g-e),n=-Math.PI/2,r=new xe(...b);A=new xe(-g+x[0],x[1]),A._rotateAround(n,t)._add(r),A.x+=-e+g,A.y-=(_.left-o)*i.scale;const s=i.image?_.advance*i.scale:Hm*i.scale,a=String.fromCodePoint(i.glyph);Xm(a)?A.x+=(1-o)*i.scale:Zm(a)?A.x+=s-_.height*i.scale+(-o-1)*i.scale:A.x+=i.image||_.width+2*o===y.w&&_.height+2*o===y.h?(s-T)/2:(s-(_.height+2*o)*i.scale)/2,S=new xe(A.x,A.y-E),D=new xe(A.x+T,A.y),C=new xe(A.x+T,A.y-E)}else{const e=(_.left-o)*i.scale-g+x[0],t=(-_.top-o)*i.scale+x[1],n=e+E,r=t+T;A=new xe(e,t),S=new xe(n,t),D=new xe(e,r),C=new xe(n,r)}if(c){let e;e=r?new xe(0,0):w?new xe(u[0],u[1]):new xe(n[0],n[1]),A._rotateAround(c,e),S._rotateAround(c,e),D._rotateAround(c,e),C._rotateAround(c,e)}const I=new xe(0,0),R=new xe(0,0);l.push({tl:A,tr:S,bl:D,br:C,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:v,sectionIndex:i.sectionIndex,isSDF:h,pixelOffsetTL:I,pixelOffsetBR:R,minFontScaleX:0,minFontScaleY:0})}}return l}(0,i,l,o,s,a,r,e.allowVerticalPlacement),v=e.textSizeData;let x=null;"source"===v.kind?(x=[Lg*o.layout.get("text-size").evaluate(a,{},g)*p.textScaleFactor],x[0]>I_&&He("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(C_,'. Reduce your "text-size".'))):"composite"===v.kind&&(x=[Lg*p.compositeTextSizes[0].evaluate(a,{},g)*p.textScaleFactor,Lg*p.compositeTextSizes[1].evaluate(a,{},g)*p.textScaleFactor],(x[0]>I_||x[1]>I_)&&He("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(C_,'. Reduce your "text-size".'))),e.addSymbols(e.text,y,x,l,s,a,u,t,n,c.lineStartIndex,c.lineLength,f,m,g,_,!1);for(const b of h)d[b]=e.text.placedSymbolArray.length-1;return 4*y.length}function P_(e){for(const t in e)return e[t];return null}function M_(e,t,n,i,r,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,f=s.right;if(Cg(s)&&s.collisionPadding){const e=s.collisionPadding;d-=e[0],u-=e[1],f+=e[2],h+=e[3]}if(l){const e=new xe(d,u),t=new xe(f,u),n=new xe(d,h),i=new xe(f,h),r=Te(l);let o=new xe(0,0);c&&(o=new xe(c[0],c[1])),e._rotateAround(r,o),t._rotateAround(r,o),n._rotateAround(r,o),i._rotateAround(r,o),d=Math.min(e.x,t.x,n.x,i.x),f=Math.max(e.x,t.x,n.x,i.x),u=Math.min(e.y,t.y,n.y,i.y),h=Math.max(e.y,t.y,n.y,i.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,d,u,f,h,a,i,r,o),e.length-1}function F_(e){Cg(e)&&e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function L_(e,t,n,i){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<n)return!0}else r[t]=[];return r[t].push(i),!1}function k_(e,t){const n=e.fovAboveCenter,i=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-i)/Math.cos(e._pitch),o=Math.sin(n)*r/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01));let s=Math.sin(e._pitch)*o+r;const a=r*(1/e._horizonShift);if(!e.elevation||0===e.elevation.exaggeration()){let t=Math.max(e.zoom-17,0);e.isOrthographic&&(t/=10),s*=1+t}return Math.min(1.01*s,a)}function O_(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),i=e.x*n,r=(e.x+1)*n,o=e.y*n,s=(e.y+1)*n,a=tc(i),l=tc(r),c=nc(o),u=nc(s),h=t.project(a,c),d=t.project(l,c),f=t.project(l,u),p=t.project(a,u);let m=Math.min(h.x,d.x,f.x,p.x),g=Math.min(h.y,d.y,f.y,p.y),_=Math.max(h.x,d.x,f.x,p.x),y=Math.max(h.y,d.y,f.y,p.y);const v=n/16;function x(e,n,i,r,o,s){const a=(i+o)/2,l=(r+s)/2,c=t.project(tc(a),nc(l)),u=Math.max(0,m-c.x,g-c.y,c.x-_,c.y-y);m=Math.min(m,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),u>v&&(x(e,c,i,r,a,l),x(c,n,a,l,o,s))}x(h,d,i,o,r,o),x(d,f,r,o,r,s),x(f,p,r,s,i,s),x(p,h,i,s,i,o),m-=v,g-=v,_+=v,y+=v;const b=1/Math.max(_-m,y-g);return{scale:b,x:m*b,y:g*b,x2:_*b,y2:y*b,projection:t}}function B_(e,t){let{x:n,y:i}=t;return new xe(((n-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*Li,(i*e.scale-e.y)*Li)}const z_=l(new Float32Array(16));class N_{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Xl(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._coordinatePoint(e.locationCoordinate(t,n),i)}pixelsPerMeter(e,t){return ec(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return k_(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,i){const r=e.horizonLineFromTop(!1),o=new xe(t,Math.max(r,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,i))}pointCoordinate3D(e,t,n){const i=new xe(t,n);if(e.elevation)return e.elevation.pointCoordinate(i);{const t=this.pointCoordinate(e,i.x,i.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return z_}createTileMatrix(e,t,n){let i,r,o;const s=n.canonical,a=l(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=O_(s,this);i=1,r=l.x+n.wrap*l.scale,o=l.y,d(a,a,[i/l.scale,i/l.scale,e.pixelsPerMeter/t])}else i=t/e.zoomScale(s.z),r=(s.x+Math.pow(2,s.z)*n.wrap)*i,o=s.y*i;return h(a,a,[r,o,0]),d(a,a,[i/Li,i/Li,1]),a}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class U_ extends N_{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],i=Math.sin(Te(t));this.n=(i+Math.sin(Te(n)))/2,this.c=1+i*(2*this.n-i),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:n,c:i,r0:r}=this,o=Te(e-this.center[0]),s=Te(t),a=Math.sqrt(i-2*n*Math.sin(s))/n;return{x:a*Math.sin(o*n),y:a*Math.cos(o*n)-r,z:0}}unproject(e,t){const{n:n,c:i,r0:r}=this,o=r+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*n<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=Te(this.center[0])*n;s=Me(s,-Math.PI-a,Math.PI-a);const l=Re(Ae(s/n)+this.center[0],-180,180),c=Math.asin(Re((i-(e*e+o*o)*n*n)/(2*n),-1,1)),u=Re(Ae(c),-rc,rc);return new Xl(l,u)}}const V_=1.340264,j_=-.081106,G_=893e-6,H_=.003796,W_=Math.sqrt(3)/2;class q_ extends N_{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(W_*Math.sin(t)),i=n*n,r=i*i*i;return{x:.5*(e*Math.cos(n)/(W_*(V_+3*j_*i+r*(7*G_+9*H_*i)))/Math.PI+.5),y:1-.5*(n*(V_+j_*i+r*(G_+H_*i))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=n*n,r=i*i*i;for(let c,u,h,d=0;d<12&&(u=n*(V_+j_*i+r*(G_+H_*i))-t,h=V_+3*j_*i+r*(7*G_+9*H_*i),c=u/h,n=Re(n-c,-Math.PI/3,Math.PI/3),i=n*n,r=i*i*i,!(Math.abs(c)<1e-12));++d);const o=W_*e*(V_+3*j_*i+r*(7*G_+9*H_*i))/Math.cos(n),s=Math.asin(Math.sin(n)/W_),a=Re(180*o/Math.PI,-180,180),l=Re(180*s/Math.PI,-rc,rc);return new Xl(a,l)}}class X_ extends N_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),i=Re(360*(.5-t),-rc,rc);return new Xl(n,i)}}const Z_=Math.PI/2;function Y_(e){return Math.tan((Z_+e)/2)}class K_ extends N_{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30];let i=Te(t),r=Te(n);this.southernCenter=i+r<0,this.southernCenter&&(i=-i,r=-r);const o=Math.cos(i),s=Y_(i);this.n=i===r?Math.sin(i):Math.log(o/Math.cos(r))/Math.log(Y_(r)/s),this.f=o*Math.pow(Y_(i),this.n)/this.n}project(e,t){t=Te(t),this.southernCenter&&(t=-t),e=Te(e-this.center[0]);const n=1e-6,{n:i,f:r}=this;r>0?t<-Z_+n&&(t=-Z_+n):t>Z_-n&&(t=Z_-n);const o=r/Math.pow(Y_(t),i);let s=o*Math.sin(i*e),a=r-o*Math.cos(i*e);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:n,f:i}=this,r=i-t,o=Math.sign(r),s=Math.sign(n)*Math.sqrt(e*e+r*r);let a=Math.atan2(e,Math.abs(r))*o;r*n<0&&(a-=Math.PI*Math.sign(e)*o);const l=Re(Ae(a/n)+this.center[0],-180,180),c=Re(Ae(2*Math.atan(Math.pow(i/s,1/n))-Z_),-rc,rc);return new Xl(l,this.southernCenter?-c:c)}}class J_ extends N_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Ql(e),y:$l(t),z:0}}unproject(e,t){const n=tc(e),i=nc(t);return new Xl(n,i)}}const Q_=Te(rc);class $_ extends N_{project(e,t){const n=(t=Te(t))*t,i=n*n;return{x:.5*((e=Te(e))*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=25,r=0,o=n*n;do{o=n*n;const e=o*o;r=(n*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),n=Re(n-r,-Q_,Q_)}while(Math.abs(r)>1e-6&&--i>0);o=n*n;const s=Re(Ae(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=Ae(n);return new Xl(s,a)}}const ey=Te(rc);class ty extends N_{project(e,t){t=Te(t),e=Te(e);const n=Math.cos(t),i=2/Math.PI,r=Math.acos(n*Math.cos(e/2)),o=Math.sin(r)/r,s=.5*(e*i+2*n*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,i=t=(2*(1-t)-1)*Math.PI,r=25;const o=1e-6;let s=0,a=0;do{const r=Math.cos(i),o=Math.sin(i),l=2*o*r,c=o*o,u=r*r,h=Math.cos(n/2),d=Math.sin(n/2),f=2*h*d,p=d*d,m=1-u*h*h,g=m?1/m:0,_=m?Math.acos(r*h)*Math.sqrt(1/m):0,y=.5*(2*_*r*d+2*n/Math.PI)-e,v=.5*(_*o+i)-t,x=.5*g*(u*p+_*r*h*c)+1/Math.PI,b=g*(f*l/4-_*o*d),w=.125*g*(l*d-_*o*u*f),E=.5*g*(c*h+_*p*r)+.5,T=b*w-E*x;s=(v*b-y*E)/T,a=(y*w-v*x)/T,n=Re(n-s,-Math.PI,Math.PI),i=Re(i-a,-ey,ey)}while((Math.abs(s)>o||Math.abs(a)>o)&&--r>0);return new Xl(Ae(n),Ae(i))}}class ny extends N_{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Te(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:i}=this;return{x:Te(e)*i*n+.5,y:-Math.sin(Te(t))/i*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:i}=this,r=-(t-.5)/n,o=Re(Ae((e-.5)/n)/i,-180,180),s=Math.asin(Re(r*i,-1,1)),a=Re(Ae(s),-rc,rc);return new Xl(o,a)}}class iy extends J_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,n){const i=Ou(e,t,n);return N(i,i,Nu(Ru(n))),{x:i[0],y:i[1],z:i[2]}}locationPoint(e,t,n){const i=Hl(t.lat,t.lng),r=k([],i),o=n?e._centerAltitude+n:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;P(i,i,r,ec(1,0)*Li*o);const s=l(new Float64Array(16));return u(s,e.pixelMatrix,e.globeMatrix),N(i,i,s),new xe(i[0],i[1])}pixelsPerMeter(e,t){return ec(1,0)*t}pixelSpaceConversion(e,t,n){const i=ec(1,e)*t,r=un(ec(1,45)*t,i,n);return this.pixelsPerMeter(e,t)/r}createTileMatrix(e,t,n){const i=Uu(Ru(n.canonical));return u(new Float64Array(16),e.globeMatrix,i)}createInversionMatrix(e,t){const{center:n}=e,i=Nu(Ru(t));return p(i,i,Te(n.lng)),f(i,i,Te(n.lat)),d(i,i,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(i)}pointCoordinate(e,t,n,i){return Du(e,t,n,!0)||new cc(0,0)}pointCoordinate3D(e,t,n){const i=this.pointCoordinate(e,t,n,0);return[i.x,i.y,i.z]}isPointAboveHorizon(e,t){return!Du(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const n=e.cameraToCenterDistance,i=e._centerAltitude*t,r=e._camera,o=e._camera.forward(),s=A([],R([],o,-n),[0,0,i]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),h=R([],r.up(),u),d=R([],r.right(),u*c),f=k([],A([],A([],o,h),d)),p=[];let m;if(new Lc(s,f).closestPointOnSphere(l,a,p)){const t=A([],p,l),n=H([],t,s);m=Math.cos(e.fovAboveCenter)*w(n)}else{const e=H([],s,l),t=H([],l,s);k(t,t);const n=w(e)-a;m=Math.sqrt(n*(n+2*a));const i=Math.acos(m/(a+n))-Math.acos(O(o,t));m*=Math.cos(i)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Hu(e.zoom);if(n>0){const i=k_(e,ec(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return un(t,i+r*(1-Math.cos(o)),Math.pow(n,10))}return t}upVector(e,t,n){return Ou(t,n,e,1)}upVectorScale(e){return{metersToTile:Au(Bu(Ru(e)))}}}function ry(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new J_(e);case"equirectangular":return new X_(e);case"naturalEarth":return new $_(e);case"equalEarth":return new q_(e);case"winkelTripel":return new ty(e);case"albers":return n?new ny(e):new U_(e);case"lambertConformalConic":return n?new ny(e):new K_(e);case"globe":return new iy(e)}throw new Error("Invalid projection name: ".concat(e.name))}const oy=vc.types,sy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ay(e,t,n,i,r,o,s,a,l,c,u,h,d){const f=a?Math.min(I_,Math.round(a[0])):0,p=a?Math.min(I_,Math.round(a[1])):0;e.emplaceBack(t,n,Math.round(32*i),Math.round(32*r),o,s,(f<<1)+(l?1:0),p,16*c,16*u,256*h,256*d)}function ly(e,t,n){e.emplaceBack(t,n)}function cy(e,t,n,i,r,o,s){e.emplaceBack(t,n,i,r,o,s)}const uy=(e,t,n,i)=>{for(let r=0;r<t;r++)e.emplaceBack(n[0],n[1],n[2],i[0],i[1],i[2])};function hy(e,t,n,i,r){e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r)}function dy(e){for(const t of e.sections)if(as(t.text))return!0;return!1}class fy{constructor(e){this.layoutVertexArray=new ma,this.indexArray=new Ta,this.programConfigurations=e,this.segments=new tl,this.dynamicLayoutVertexArray=new _a,this.opacityVertexArray=new ya,this.placedSymbolArray=new ja,this.iconTransitioningVertexArray=new va,this.globeExtVertexArray=new ga,this.zOffsetVertexArray=new sa,this.orientationVertexArray=new Da}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,n,i,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Om.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,sy,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Nm.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,km.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||r)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Bm.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,zm.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Xo(fy,"SymbolBuffers");class py{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new tl,this.collisionVertexArray=new Ea,this.collisionVertexArrayExt=new _a}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Um.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Vm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xo(py,"CollisionBuffers");class my{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=l([]),this.placementViewportMatrix=l([]);const t=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=kg(this.zoom,t["text-size"],this.worldview),this.iconSizeData=kg(this.zoom,t["icon-size"],this.worldview);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(e=>mg[e]),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new fy(new Il(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new fy(new Il(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Wa,this.lineVertexArray=new qa,this.symbolInstances=new Ha}calculateGlyphDependencies(e,t,n,i,r){for(const o of e){const e=o.codePointAt(0);if(void 0===e)break;if(t[e]=!0,i&&r&&e<=65535){const e=qm[o];e&&(t[e.charCodeAt(0)]=!0)}}}updateFootprints(e,t){}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Rd(this.activeReplacements,n)&&(this.activeReplacements=n,!0)}populate(e,t,n,i){const r=this.layers[0],o=r.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),[u,h]=o.get("icon-size-scale-range"),d=Re(t.scaleFactor||1,u,h),f=("constant"!==l.value.kind||l.value.value instanceof kn&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),p="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,m=o.get("symbol-sort-key");if(this.features=[],!f&&!p)return;const g=t.iconDependencies,_=t.glyphDependencies,y=t.availableImages,v=new ys(this.zoom,{worldview:this.worldview});for(const{feature:x,id:b,index:w,sourceLayerIndex:E}of e){const e=r._featureFilter.needGeometry,t=yc(x,e);if(!r._featureFilter.filter(v,t,n))continue;if(e||(t.geometry=_c(x,n,i)),s&&1!==x.type&&n.z<=5){const e=t.geometry,i=.98078528056,r=(e,t)=>O(Ou(e.x,e.y,n,1),Ou(t.x,t.y,n,1))<i;for(let t=0;t<e.length;t++)e[t]=fc(e[t],r)}let l,c;if(f){const e=r.getValueAndResolveTokens("text-field",t,n,y),i=kn.factory(e);dy(i)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ms()||this.hasRTLText&&_s.isParsed())&&(l=Wm(i,r,t))}if(p){const e=r.getValueAndResolveTokens("icon-image",t,n,y);c="string"==typeof e?Bn.build(e):e}if(!l&&!c)continue;const u=this.sortFeaturesByKey?m.evaluate(t,{},n):void 0,h={id:b,text:l,icon:c,index:w,sourceLayerIndex:E,geometry:t.geometry,properties:x.properties,type:oy[x.type],sortKey:u};if(this.features.push(h),c){const e=this.layers[0]._unevaluatedLayout._values,{iconPrimary:t,iconSecondary:i}=x_(c,this.iconSizeData,e["icon-size"],n,this.zoom,h,this.pixelRatio,d,this.worldview),r=t.id.toString();if(g.has(r)?g.get(r).push(t):g.set(r,[t]),i){this.hasAnySecondaryIcon=!0;const e=i.id.toString();g.has(e)?g.get(e).push(i):g.set(e,[i])}}if(l){const e=a.evaluate(t,{},n).join(","),i="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(mg.vertical)>=0;for(const t of l.sections)if(t.image){const e=t.image.getPrimary().scaleSelf(this.pixelRatio),n=e.id.toString(),i=g.get(n)||[];i.push(e),g.set(n,i)}else{const n=$o(l.toString()),r=t.fontStack||e,o=_[r]=_[r]||{};this.calculateGlyphDependencies(t.text,o,i,this.allowVerticalPlacement,n)}}}if("line"===o.get("symbol-placement")&&(this.features=function(e){const t={},n={},i=[];let r=0;function o(t){i.push(e[t]),r++}function s(e,t,r){const o=n[e];return delete n[e],n[t]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(r[0]),o}function a(e,n,r){const o=t[n];return delete t[n],t[e]=o,i[o].geometry[0].shift(),i[o].geometry[0]=r[0].concat(i[o].geometry[0]),o}function l(e,t,n){const i=n?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(i.x,":").concat(i.y)}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const f=l(d,h),p=l(d,h,!0);if(f in n&&p in t&&n[f]!==t[p]){const e=a(f,p,h),r=s(f,p,i[e].geometry);delete t[f],delete n[p],n[l(d,i[r].geometry,!0)]=r,i[e].geometry=null}else f in n?s(f,p,h):p in t?a(f,p,h):(o(c),t[f]=r-1,n[p]=r-1)}return i.filter(e=>e.geometry)}(this.features)),"hd-road-markup"===o.get("symbol-elevation-reference")){if(this.elevationType="road",t.elevationFeatures){!this.elevationFeatures&&t.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const e of t.elevationFeatures)this.elevationFeatureIdToIndex.set(e.id,this.elevationFeatures.length),this.elevationFeatures.push(e)}}else o.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}update(e,t,n,i,r,o,s){this.text.programConfigurations.updatePaintArrays(e,t,r,n,i,o,s,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,t,r,n,i,o,s,this.worldview)}updateRoadElevation(e){if("road"!==this.elevationType||!this.elevationFeatures)return;if(this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let t=!1;const n=lc(e),i=1/n;let r=!1,o=!1;for(let s=0;s<this.symbolInstances.length;s++){const e=this.symbolInstances.get(s),a=E(1,0,0),l=E(0,1,0),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:u,numIconVertices:h,numVerticalIconVertices:d}=e,f=c>0||u>0,p=h>0,m=this.elevationFeatures[e.elevationFeatureIndex];if(m){const s=new xe(e.tileAnchorX,e.tileAnchorY),c=.075+m.pointElevation(s);e.zOffset!==c&&(t=!0,e.zOffset=c);const u=m.computeSlopeNormal(s,i),h=oe(J(),E(0,0,1),u);V(a,a,h),V(l,l,h),a[2]*=n,l[2]*=n,1===a[0]&&0===a[1]&&0===a[2]&&0===l[0]&&1===l[1]&&0===l[2]||(r=r||f,o=o||p)}if(f&&(uy(this.text.orientationVertexArray,c,a,l),uy(this.text.orientationVertexArray,u,a,l)),p){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:n}=e;t>=0&&uy(this.icon.orientationVertexArray,h,a,l),n>=0&&uy(this.icon.orientationVertexArray,d,a,l)}}r||(this.text.orientationVertexArray=void 0),o||(this.icon.orientationVertexArray=void 0),t&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(e,t,i)=>{n+=t,n>e.length&&e.resize(n);for(let r=-t;r<0;r++)e.emplace(r+n,i)},t=(e,t,n)=>{i+=t,i>e.length&&e.resize(i);for(let r=-t;r<0;r++)e.emplace(r+i,n)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,i=0;for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:o,numIconVertices:s}=n,a=n.zOffset,l=s>0;if((i>0||o>0)&&(e(this.text.zOffsetVertexArray,i,a),e(this.text.zOffsetVertexArray,o,a)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:i}=n;e>=0&&t(this.icon.zOffsetVertexArray,s,a),i>=0&&t(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ry(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:i,y:r}of t)this.lineVertexArray.emplaceBack(i,r);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m){const g=e.indexArray,_=e.layoutVertexArray,y=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,_,g,this.canOverlap?o.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,w=this.allowVerticalPlacement&&s===mg.vertical?Math.PI/2:0,E=o.text&&o.text.sections;for(let A=0;A<t.length;A++){const{tl:i,tr:r,bl:s,br:c,texPrimary:u,texSecondary:h,pixelOffsetTL:x,pixelOffsetBR:b,minFontScaleX:T,minFontScaleY:S,glyphOffset:D,isSDF:C,sectionIndex:I}=t[A],R=v.vertexLength,P=D[1];if(ay(_,l.x,l.y,i.x,P+i.y,u.x,u.y,n,C,x.x,x.y,T,S),ay(_,l.x,l.y,r.x,P+r.y,u.x+u.w,u.y,n,C,b.x,x.y,T,S),ay(_,l.x,l.y,s.x,P+s.y,u.x,u.y+u.h,n,C,x.x,b.y,T,S),ay(_,l.x,l.y,c.x,P+c.y,u.x+u.w,u.y+u.h,n,C,b.x,b.y,T,S),a){const{x:t,y:n,z:i}=a.anchor,[r,o,s]=a.up;cy(y,t,n,i,r,o,s),cy(y,t,n,i,r,o,s),cy(y,t,n,i,r,o,s),cy(y,t,n,i,r,o,s),hy(e.dynamicLayoutVertexArray,t,n,i,w)}else hy(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const t=h||u;ly(e.iconTransitioningVertexArray,t.x,t.y),ly(e.iconTransitioningVertexArray,t.x+t.w,t.y),ly(e.iconTransitioningVertexArray,t.x,t.y+t.h),ly(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}g.emplaceBack(R,R+1,R+2),g.emplaceBack(R+1,R+2,R+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(D[0]),A!==t.length-1&&I===t[A+1].sectionIndex||e.programConfigurations.populatePaintArrays(_.length,o,o.index,{},d,f,p,E&&E[I],this.worldview)}const T=a?a.anchor:l;e.placedSymbolArray.emplaceBack(T.x,T.y,T.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,u,l.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],s,0,0,0,h,0)}_commitLayoutVertex(e,t,n,i,r,o,s){e.emplaceBack(t,n,i,r,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,n,i,r,o,s){const a=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let d=0;d<4;d++)n.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,t,e.padding,s.zOffset),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new xe(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new xe(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new xe(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new xe(e.x1,e.y2)),a.vertexLength+=4;const h=n.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(i,r,this.textCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(i,r,this.iconCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new py(ba,jm.members,va),this.iconCollisionBox=new py(ba,jm.members,va);const i=Bg(this.iconSizeData,e),r=Bg(this.textSizeData,e,n);for(let o=0;o<this.symbolInstances.length;o++){const n=this.symbolInstances.get(o);this._addTextDebugCollisionBoxes(r,e,t,n.textBoxStartIndex,n.textBoxEndIndex,n),this._addTextDebugCollisionBoxes(r,e,t,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n),this._addIconDebugCollisionBoxes(i,e,t,n.iconBoxStartIndex,n.iconBoxEndIndex,n),this._addIconDebugCollisionBoxes(i,e,t,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n)}}getSymbolInstanceTextSize(e,t,n,i){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),o=Og(this.textSizeData,e,r)/Hm;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,n){const i=this.icon.placedSymbolArray.get(n),r=Og(this.iconSizeData,e,i);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,n,i){e.emplaceBack(t,-n,-n,i),e.emplaceBack(t,n,-n,i),e.emplaceBack(t,n,n,i),e.emplaceBack(t,-n,n,i)}_updateTextDebugCollisionBoxes(e,t,n,i,r,o,s){for(let a=i;a<r;a++){const i=n.get(a),r=this.getSymbolInstanceTextSize(e,o,t,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,i.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(e,t,n,i,r,o,s){for(let a=i;a<r;a++){const i=n.get(a),r=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,i.padding,o.zOffset)}}updateCollisionDebugBuffers(e,t,n,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Bg(this.iconSizeData,e,i),o=Bg(this.textSizeData,e,n);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(o,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a,n),this._updateTextDebugCollisionBoxes(o,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,n),this._updateIconDebugCollisionBoxes(r,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a,i),this._updateIconDebugCollisionBoxes(r,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,i)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,i,r,o,s,a,l){const c={};if(t<n){const{x1:n,y1:i,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=e.get(t);c.textBox={x1:n,y1:i,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=f}if(i<r){const{x1:t,y1:n,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=e.get(i);c.verticalTextBox={x1:t,y1:n,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=f}if(o<s){const{x1:t,y1:n,x2:i,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=e.get(o);c.iconBox={x1:t,y1:n,x2:i,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=f}if(a<l){const{x1:t,y1:n,x2:i,y2:r,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:f}=e.get(a);c.verticalIconBox={x1:t,y1:n,x2:i,y2:r,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=f}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)e.indexArray.emplaceBack(r,r+1,r+2),e.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],r=[],o=[];for(let s=0;s<this.symbolInstances.length;++s){o.push(s);const e=this.symbolInstances.get(s);i.push(0|Math.round(t*e.tileAnchorX+n*e.tileAnchorY)),r.push(e.featureIndex)}return o.sort((e,t)=>i[e]-i[t]||r[t]-r[e]),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:i,leftJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=t;n>=0&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&i!==n&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&r!==n&&this.addIndicesForPlacedSymbol(this.text,r),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let gy,_y,yy;Xo(my,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),my.addDynamicAttributes=hy;class vy{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xo(vy,"FormatSectionOverride",{omit:["defaultValue"]});const xy=()=>yy||(yy={layout:gy||(gy=new Rs({"symbol-placement":new Ds(Ps.layout_symbol["symbol-placement"]),"symbol-spacing":new Ds(Ps.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ds(Ps.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Cs(Ps.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ds(Ps.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ds(Ps.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ds(Ps.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ds(Ps.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ds(Ps.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ds(Ps.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ds(Ps.layout_symbol["icon-rotation-alignment"]),"icon-size":new Cs(Ps.layout_symbol["icon-size"]),"icon-size-scale-range":new Ds(Ps.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Cs(Ps.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Cs(Ps.layout_symbol["icon-text-fit-padding"]),"icon-image":new Cs(Ps.layout_symbol["icon-image"]),"icon-rotate":new Cs(Ps.layout_symbol["icon-rotate"]),"icon-padding":new Ds(Ps.layout_symbol["icon-padding"]),"icon-keep-upright":new Ds(Ps.layout_symbol["icon-keep-upright"]),"icon-offset":new Cs(Ps.layout_symbol["icon-offset"]),"icon-anchor":new Cs(Ps.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ds(Ps.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ds(Ps.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ds(Ps.layout_symbol["text-rotation-alignment"]),"text-field":new Cs(Ps.layout_symbol["text-field"]),"text-font":new Cs(Ps.layout_symbol["text-font"]),"text-size":new Cs(Ps.layout_symbol["text-size"]),"text-size-scale-range":new Ds(Ps.layout_symbol["text-size-scale-range"]),"text-max-width":new Cs(Ps.layout_symbol["text-max-width"]),"text-line-height":new Cs(Ps.layout_symbol["text-line-height"]),"text-letter-spacing":new Cs(Ps.layout_symbol["text-letter-spacing"]),"text-justify":new Cs(Ps.layout_symbol["text-justify"]),"text-radial-offset":new Cs(Ps.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ds(Ps.layout_symbol["text-variable-anchor"]),"text-anchor":new Cs(Ps.layout_symbol["text-anchor"]),"text-max-angle":new Ds(Ps.layout_symbol["text-max-angle"]),"text-writing-mode":new Ds(Ps.layout_symbol["text-writing-mode"]),"text-rotate":new Cs(Ps.layout_symbol["text-rotate"]),"text-padding":new Ds(Ps.layout_symbol["text-padding"]),"text-keep-upright":new Ds(Ps.layout_symbol["text-keep-upright"]),"text-transform":new Cs(Ps.layout_symbol["text-transform"]),"text-offset":new Cs(Ps.layout_symbol["text-offset"]),"text-allow-overlap":new Ds(Ps.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ds(Ps.layout_symbol["text-ignore-placement"]),"text-optional":new Ds(Ps.layout_symbol["text-optional"]),visibility:new Ds(Ps.layout_symbol.visibility)})),paint:_y||(_y=new Rs({"icon-opacity":new Cs(Ps.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Cs(Ps.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Cs(Ps.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Cs(Ps.paint_symbol["text-emissive-strength"]),"icon-color":new Cs(Ps.paint_symbol["icon-color"]),"icon-halo-color":new Cs(Ps.paint_symbol["icon-halo-color"]),"icon-halo-width":new Cs(Ps.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Cs(Ps.paint_symbol["icon-halo-blur"]),"icon-translate":new Ds(Ps.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ds(Ps.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ds(Ps.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Cs(Ps.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Cs(Ps.paint_symbol["text-occlusion-opacity"]),"text-color":new Cs(Ps.paint_symbol["text-color"],{runtimeType:xn,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Cs(Ps.paint_symbol["text-halo-color"]),"text-halo-width":new Cs(Ps.paint_symbol["text-halo-width"]),"text-halo-blur":new Cs(Ps.paint_symbol["text-halo-blur"]),"text-translate":new Ds(Ps.paint_symbol["text-translate"]),"text-translate-anchor":new Ds(Ps.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ds(Ps.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ds(Ps.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ds(Ps.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ds(Ps.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Cs(Ps.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},yy);class by extends Js{constructor(e,t,n,i){super(e,xy(),t,n,i),this._colorAdjustmentMatrix=l([]),this.hasInitialOcclusionOpacityProperties=void 0!==e.paint&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const e=[];for(const t of n)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,t,n,i){return this._saturation===e&&this._contrast===t&&this._brightnessMin===n&&this._brightnessMax===i||(this._colorAdjustmentMatrix=function(e,t,n,i){e=tt(e),t=et(t);const r=a(),o=e/3,s=1-2*o,l=[s,o,o,0,o,s,o,0,o,o,s,0,0,0,0,1],c=.5-.5*t,h=i-n;return u(r,[h,0,0,0,0,h,0,0,0,0,h,0,n,n,n,1],[t,0,0,0,0,t,0,0,0,0,t,0,c,c,c,1]),u(r,r,l),r}(e,t,n,i),this._saturation=e,this._contrast=t,this._brightnessMin=n,this._brightnessMax=i),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,t,n,i){const r=this.layout.get(e).evaluate(t,{},n,i),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||ko(o.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,(t,n)=>n in e?String(e[n]):"")}(t.properties,r)}createBucket(e){return new my(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of xy().paint.overridableProperties){if(!by.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new vy(t),i=new Lo(n,t.property.specification,this.scope,this.options);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new Bo("source",i):new zo("composite",i,t.value.zoomStops,t.value.interpolationType),this.paint._values[e]=new As(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&by.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=xy().paint.properties[t];let r=!1;const o=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof kn)o(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{r||(t instanceof jn&&Un(t.value)===Tn?o(t.value.sections):t instanceof qn?o(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,t,n){return{config:new Cl(this,{zoom:t,lut:n}),overrideFog:!1}}hasElevation(){return this.layout&&"hd-road-markup"===this.layout.get("symbol-elevation-reference")}}let wy,Ey,Ty,Ay;var Sy=ta([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Dy(e,t,n,i,r,a,l,c){const u=[e,t,1,n,i,1,r,a,1],h=[l,c,1],d=o([],u),[f,p,m]=U(h,h,d);return s(u,u,[f,0,0,0,p,0,0,0,m])}function Cy(e,t,n,i,r,a,l,c){const u=function(e,t,n,i,r,a,l,c){const u=Dy(0,0,1,0,1,1,0,1),h=Dy(e,t,n,i,r,a,l,c);return s(h,h,o([],u))}(e,t,n,i,r,a,l,c);return[u[2]/u[8]/Li,u[5]/u[8]/Li]}function Iy(e){return[e[0],Math.min(Math.max(e[1],-rc),rc)]}class Ry extends en{constructor(e,t,n,i){super(),this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(i),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new Kt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Vt(this.map._requestManager.transformRequest(this.url,Mt.Image),(t,n)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new Jt(t)):n&&(this.image=n instanceof HTMLImageElement?ft.getImageData(n):n,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new pp(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Kt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof pp||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],n=e[0][1];for(const r of e)r[1]>n&&(n=r[1]),r[1]<t&&(t=r[1]);const i=(n+t)/2;if(i>rc?this.onNorthPole=!0:i<-rc&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(cc.fromLngLat);this.tileID=function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const c of e)t=Math.min(t,c.x),n=Math.min(n,c.y),i=Math.max(i,c.x),r=Math.max(r,c.y);const o=Math.max(i-t,r-n),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);let l=Math.floor((t+i)/2*a);return l>1&&(l-=1),new gu(s,l,Math.floor((n+r)/2*a))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Kt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof pp||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const o in this.tiles){const e=this.tiles[o];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const t=O_(new gu(0,0,0),this.map.transform.projection),n=[t.projection.project(this.coordinates[0][0],this.coordinates[0][1]),t.projection.project(this.coordinates[1][0],this.coordinates[1][1]),t.projection.project(this.coordinates[2][0],this.coordinates[2][1]),t.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,n=e[1].y-e[0].y,i=e[2].x-e[1].x,r=e[2].y-e[1].y,o=e[3].x-e[2].x,s=e[3].y-e[2].y,a=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*r-i*n,u=i*s-o*r,h=o*l-a*s,d=a*n-t*l;return c>0&&u>0&&h>0&&d>0||c<0&&u<0&&h<0&&d<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const i=O_(this.tileID,this.map.transform.projection),[r,a,l,c]=this.coordinates.map(e=>{const t=i.projection.project(e[0],e[1]);return B_(i,t)._round()});this.perspectiveTransform=Cy(r.x,r.y,a.x,a.y,l.x,l.y,c.x,c.y);const u=this._boundsArray=new oa;u.emplaceBack(r.x,r.y,0,0),u.emplaceBack(a.x,a.y,Li,0),u.emplaceBack(c.x,c.y,0,Li),u.emplaceBack(l.x,l.y,Li,Li),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(u,Sy.members),this.boundsSegments=tl.simpleSegment(0,0,4,2);const h=[],d=[Iy((f=this.coordinates)[0]),Iy(f[1]),Iy(f[2]),Iy(f[3])];var f;const[p,m,g,_]=function(e){let t=e[0][0],n=t,i=e[0][1],r=i;for(let o=1;o<e.length;o++)e[o][0]<t?t=e[o][0]:e[o][0]>n&&(n=e[o][0]),e[o][1]<i?i=e[o][1]:e[o][1]>r&&(r=e[o][1]);return[t,i,n-t,r-i]}(d);{const i=new oa,[r,a,l,c]=function(e){let t=e[0].x,n=t,i=e[0].y,r=i;for(let o=1;o<e.length;o++)e[o].x<t?t=e[o].x:e[o].x>n&&(n=e[o].x),e[o].y<i?i=e[o].y:e[o].y>r&&(r=e[o].y);return[t,i,n-t,r-i]}(n),u=e=>[(e.x-r)/l,(e.y-a)/c],[d,f,y,v]=n.map(u),x=function(e,t,n,i,r,a,l,c){const u=Dy(0,0,1,0,1,1,0,1);return s(u,u,o([],Dy(e,t,n,i,r,a,l,c)))}(d[0],d[1],f[0],f[1],y[0],y[1],v[0],v[1]);this.elevatedGlobePerspectiveTransform=Cy(d[0],d[1],f[0],f[1],y[0],y[1],v[0],v[1]);const b=(e,t)=>{h.push(e.lng);const n=Math.round((e.lng-p)/g*Li),r=Math.round((e.lat-m)/_*Li),o=u(t),s=U([],[o[0],o[1],1],x),a=Math.round(s[0]/s[2]*Li),l=Math.round(s[1]/s[2]*Li);i.emplaceBack(n,r,a,l)},w=n[3].x-n[0].x,E=n[3].y-n[0].y,T=n[2].x-n[1].x,A=n[2].y-n[1].y;for(let e=0;e<65;e++){const i=e/64,r=[n[0].x+i*w,n[0].y+i*E],o=[n[1].x+i*T,n[1].y+i*A],s=o[0]-r[0],a=o[1]-r[1];for(let e=0;e<65;e++){const n=e/64,i={x:r[0]+s*n,y:r[1]+a*n};b(t.projection.unproject(i.x,i.y),i)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(i,Sy.members)}{this.maxLongitudeTriangleSize=0;let t=[],n=new Ta;const i=(e,i,r)=>{n.emplaceBack(e,i,r);const o=h[e],s=h[i],a=h[r],l=Math.min(Math.min(o,s),a),c=Math.max(Math.max(o,s),a)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),t.push(l+c/2)};for(let e=0;e<64;e++)for(let t=0;t<64;t++){const n=65*e+t,r=n+1,o=n+65,s=o+1;i(n,o,r),i(r,o,s)}[t,n]=function(e,t){const n=Array.from({length:e.length},(e,t)=>t);n.sort((t,n)=>e[t]-e[n]);const i=[],r=new Ta;for(let o=0;o<n.length;o++){const s=n[o];i.push(e[s]);const a=3*s,l=a+1;r.emplaceBack(t.uint16[a],t.uint16[l],t.uint16[l+1])}return[i,r]}(t,n),this.elevatedGlobeTrianglesCenterLongitudes=t,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(n)}this.elevatedGlobeSegments=tl.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,g/Li,0,_/Li,0,0,m,p,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,n=t.gl;!this._dirty||this.texture instanceof pp||(this.texture?this.texture.update(this.image):(this.texture=new fp(t,this.image,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const n=this.elevatedGlobeTrianglesCenterLongitudes;let i=(r=e+180)+360*Math.round((n[0]-r)/360);var r;const o=new tl,s=(e,n)=>{o.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:n,sortKey:void 0,vaos:{}})},a=.51*this.maxLongitudeTriangleSize;if(Math.abs(n[0]-i)<=a){const e=$e(n,0,n.length,i+a);return e===n.length||s(e,Qe(n,e+1,n.length,i+360-a)-e),o}i<n[0]&&(i+=360);const l=Qe(n,0,n.length,i-a);if(l===n.length)return s(0,n.length),o;s(0,l-0);const c=$e(n,l+1,n.length,i+a);return c!==n.length&&s(c,n.length-c),o}}const Py=(Math.pow(256,2)-1)/16907520;class My extends Js{constructor(e,t,n,i){super(e,{layout:Ty||(Ty=new Rs({visibility:new Ds(Ps.layout_raster.visibility)})),paint:Ay||(Ay=new Rs({"raster-opacity":new Ds(Ps.paint_raster["raster-opacity"]),"raster-color":new Is(Ps.paint_raster["raster-color"]),"raster-color-mix":new Ds(Ps.paint_raster["raster-color-mix"]),"raster-color-range":new Ds(Ps.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ds(Ps.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ds(Ps.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ds(Ps.paint_raster["raster-brightness-max"]),"raster-saturation":new Ds(Ps.paint_raster["raster-saturation"]),"raster-contrast":new Ds(Ps.paint_raster["raster-contrast"]),"raster-resampling":new Ds(Ps.paint_raster["raster-resampling"]),"raster-fade-duration":new Ds(Ps.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ds(Ps.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ds(Ps.paint_raster["raster-array-band"]),"raster-elevation":new Ds(Ps.paint_raster["raster-elevation"]),"raster-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Ry&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[n,i]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(n)&&isNaN(i)||n===this._curRampRange[0]&&i===this._curRampRange[1]||(this.colorRamp=ph({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:n,end:i}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[n,i])}}let Fy,Ly,ky,Oy,By;class zy extends Js{constructor(e,t,n,i){super(e,{layout:Fy||(Fy=new Rs({visibility:new Ds(Ps["layout_raster-particle"].visibility)})),paint:Ly||(Ly=new Rs({"raster-particle-array-band":new Ds(Ps["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ds(Ps["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Is(Ps["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ds(Ps["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ds(Ps["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ds(Ps["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ds(Ps["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ds(Ps["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._updateColorRamp(),this.lastInvalidatedAt=ft.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ph({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ft.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Ny extends Js{constructor(e,t){super(e,{},t,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Uy(e,t,n){const i=[0,0,1],r=Q([]);return ee(r,r,n?-Te(e)+Math.PI:Te(e)),$(r,r,-Te(t)),V(i,i,r),k(i,i)}const Vy={None:0,Model:1,Symbol:2,FillExtrusion:4};class jy{constructor(e,t,n,i){this.message=(e?"".concat(e,": "):"")+n,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}function Gy(e,t){const n=-1===e.indexOf("://");try{return new URL(e,n&&t?"http://example.com":void 0),!0}catch(e){return!1}}class Hy{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Wy{constructor(){this.instancedDataArray=new ka,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class qy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,t){}populate(e,t,n,i){this.tileToMeter=lc(n);const r=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of e){const e=null!=s?s:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0,c=yc(o,r);if(!this.layers[0]._featureFilter.filter(new ys(this.zoom,{worldview:this.worldview}),c,n))continue;const u={id:e,sourceLayerIndex:l,index:a,geometry:r?c.geometry:_c(o,n,i),properties:o.properties,type:o.type,patterns:{}},h=this.addFeature(u,u.geometry,c);h&&t.featureIndex.insert(o,u.geometry,a,l,this.index,this.instancesPerModel[h].instancedDataArray.length,Li/32)}this.lookup=null}update(e,t,n,i){for(const r in this.instancesPerModel){const t=this.instancesPerModel[r];for(const n in e)t.idToFeaturesIndex.hasOwnProperty(n)&&(this.evaluate(t.features[t.idToFeaturesIndex[n]],e[n],t,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];for(const t of n.features){const i=this.layers[0],r=t.feature,o=this.canonical,s=i.paint.get("model-rotation").evaluate(r,{},o),a=i.paint.get("model-scale").evaluate(r,{},o),l=i.paint.get("model-translation").evaluate(r,{},o);G(t.rotation,s)&&G(t.scale,a)&&G(t.translation,l)||(this.evaluate(t,t.featureStates,n,!0),e=!0)}}return e}updateReplacement(e,t,n,i){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Rd(this.activeReplacements,r))return!1;this.activeReplacements=r;let o=!1;for(const s in this.instancesPerModel){const t=this.instancesPerModel[s],r=t.instancedDataArray;for(const s of t.features){const t=s.instancedDataOffset,a=s.instancedDataCount;for(let s=0;s<a;s++){const a=16*(s+t);let l=r.float32[a+0];const c=l>Li;l=c?l-Li:l;const u=Math.floor(l),h=r.float32[a+1];let d=!1;for(const t of this.activeReplacements)if(!Sd(t,n,Vy.Model,i)&&!(t.min.x>u||u>t.max.x||t.min.y>h||h>t.max.y)&&(d=Od(kd(u,h,e.canonical,t.footprintTileId.canonical),t.footprint),d))break;r.float32[a]=d?l+Li:l,o=o||d!==c}}}return o}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];n.instancedDataArray.length<0||0===n.instancedDataArray.length||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,xp.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const t of this.modelUris)e.removeModel(t,"",!0)}addFeature(e,t,n){const i=this.layers[0],r=i.layout.get("model-id").evaluate(n,{},this.canonical);if(!r)return He("modelId is not evaluated for layer ".concat(i.id," and it is not going to get rendered.")),r;(Gy(r,!1)||void 0!==this.styleDefinedModelURLs[r])&&(this.modelUris.includes(r)||this.modelUris.push(r)),this.instancesPerModel[r]||(this.instancesPerModel[r]=new Wy);const o=this.instancesPerModel[r],s=o.instancedDataArray,a=new Hy(n,s.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=Li||e.y<0||e.y>=Li)continue;const t=(this.lookupDim-1)/Li,n=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[n])continue;this.lookup[n]=1}this.instanceCount++;const i=s.length;s.resize(i+1),o.instancesEvaluatedElevation.push(0),s.float32[16*i]=e.x,s.float32[16*i+1]=e.y}return a.instancedDataCount=o.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(e.id&&(o.idToFeaturesIndex[e.id]=o.features.length),o.features.push(a),this.evaluate(a,{},o,!1)),r}getModelUris(){return this.modelUris}evaluate(e,t,n,i){const r=this.layers[0],o=e.feature,s=this.canonical,a=e.rotation=r.paint.get("model-rotation").evaluate(o,t,s),l=e.scale=r.paint.get("model-scale").evaluate(o,t,s),c=e.translation=r.paint.get("model-translation").evaluate(o,t,s),u=r.paint.get("model-color").evaluate(o,t,s);u.a=r.paint.get("model-color-mix-intensity").evaluate(o,t,s);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),Cp(h,a,l);const d=Math.round(100*u.a)+u.b/1.05;for(let f=0;f<e.instancedDataCount;++f){const t=e.instancedDataOffset+f,r=16*t,o=n.instancedDataArray.float32;let a=0;i&&(a=o[r+6]-n.instancesEvaluatedElevation[t]);const l=0|o[r+1];o[r]=(0|o[r])+u.r/1.05,o[r+1]=l+u.g/1.05,o[r+2]=d,o[r+3]=1/(s.z>10?this.tileToMeter:lc(s,l)),o[r+4]=c[0],o[r+5]=c[1],o[r+6]=c[2]+a,o[r+7]=h[0],o[r+8]=h[1],o[r+9]=h[2],o[r+10]=h[4],o[r+11]=h[5],o[r+12]=h[6],o[r+13]=h[8],o[r+14]=h[9],o[r+15]=h[10],n.instancesEvaluatedElevation[t]=c[2]}}}let Xy,Zy;Xo(qy,"ModelBucket",{omit:["layers"]}),Xo(Wy,"PerModelAttributes"),Xo(Hy,"ModelFeature");class Yy{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const i=n||e.findDEMTileFor(t);if(!i||!i.dem)return;const r=i.dem,o=i.tileID,s=1<<t.canonical.z-o.canonical.z;return new Yy(i,r.dim/Li/s,[(t.canonical.x/s-o.canonical.x)*r.dim,(t.canonical.y/s-o.canonical.y)*r.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1];return new xe(Math.floor(e*this._scale+this._offset[0]),Math.floor(n))}getElevationAt(e,t,n,i){const r=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(r),a=Math.floor(o),l=this._dem;return i=!!i,n?un(un(l.get(s,a,i),l.get(s,a+1,i),o-a),un(l.get(s+1,a,i),l.get(s+1,a+1,i),o-a),r-s):l.get(s,a,i)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ec(1,e)*this._dem.stride}}const Ky=new Float32Array(262144),Jy=new Uint8Array(262144);function Qy(e){let t=0;if(e.meshes)for(const n of e.meshes)t=Math.max(t,n.aabb.max[2]);if(e.children)for(const n of e.children)t=Math.max(t,Qy(n));return t}function $y(e,t,n){if(e.meshes)for(const i of e.meshes){if(i.aabb.min[0]===1/0)continue;const r=Vc.applyTransform(i.aabb,e.matrix);n.insert(t,r.min[0],r.min[1],r.max[0],r.max[1])}if(e.children)for(const i of e.children)$y(i,t,n)}const ev=["","wall","door","roof","window","lamp","logo"];class tv{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Qy(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Vc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new Vc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.node.meshes)this.node.lightMeshIndex!==e&&(n.transformedAabb=Vc.applyTransformFast(n.aabb,this.node.matrix),t.encapsulate(n.transformedAabb)),e++;this.aabb=t}return this.aabb}}class nv{constructor(e,t,n,i,r,o,s,a){this.id=n,this.layers=e,this.layerIds=this.layers.map(e=>e.fqid),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.modelTraits|=Fp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=Fp.HasMapboxMeshFeatures),r&&(this.modelTraits|=Fp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=o,this.worldview=a,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const l of t)this.nodesInfo.push(new tv(l)),$y(l,s.featureIndexArray.length,s.grid),s.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,s.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,t){for(const n of this.getNodesInfo()){const i=n.node;i.footprint&&t.push({footprint:i.footprint,id:e})}}update(e){const t=0!==Object.keys(e).length;if(t&&!this.stateDependentLayers.length)return;const n=t?this.stateDependentLayers:this.layers;if(!be(e,this.states))for(const i of n)this.evaluate(i,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const n of t){const t=n.node;this.uploaded?this.updatePbrBuffer(t):Bp(t,e,!0)}for(const n of t)zp(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),t=!0);return t}needsReEvaluation(e,t,n){const i=e.transform.projectionOptions,r=e.style.getBrightness(),o=this.brightness!==r;if(!this.uploaded||this.dirty||i.name!==this.projection.name||iv(n.paint.get("model-color").value,o)||iv(n.paint.get("model-color-mix-intensity").value,o)||iv(n.paint.get("model-roughness").value,o)||iv(n.paint.get("model-emissive-strength").value,o)||iv(n.paint.get("model-height-based-emissive-strength-multiplier").value,o)){this.projection=i,this.brightness=r;const e=this.getNodesInfo();for(const t of e)t.state=null;return!0}return!1}evaluateTransform(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),i=this.id.canonical;for(const r of n){const e=r.feature;r.evaluatedTranslation=t.paint.get("model-translation").evaluate(e,{},i),r.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},i)}}evaluate(e,t){const n=this.getNodesInfo();for(const i of n){if(!i.node.meshes)continue;const n=i.feature,r=t&&t[n.id];if(be(r,i.state))continue;i.state=structuredClone(r);const o=i.node.meshes&&i.node.meshes[0].featureData,s=i.evaluatedColor[2],a=i.evaluatedRMEA[2],l=this.id.canonical;if(i.hasTranslucentParts=!1,o){for(let t=0;t<ev.length;t++){const o=ev[t];o.length&&(n.properties.part=o);const s=e.paint.get("model-color").evaluate(n,r,l).toPremultipliedRenderColor(null),a=e.paint.get("model-color-mix-intensity").evaluate(n,r,l);i.evaluatedColor[t]=[s.r,s.g,s.b,a],i.evaluatedRMEA[t][0]=e.paint.get("model-roughness").evaluate(n,r,l),i.evaluatedRMEA[t][2]=e.paint.get("model-emissive-strength").evaluate(n,r,l),i.evaluatedRMEA[t][3]=s.a,i.emissionHeightBasedParams[t]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(n,r,l),!i.hasTranslucentParts&&s.a<1&&(i.hasTranslucentParts=!0)}delete n.properties.part,ov(i,s!==i.evaluatedColor[2]||a!==i.evaluatedRMEA[2],this.modelTraits)}else i.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(n,r,l);i.evaluatedTranslation=e.paint.get("model-translation").evaluate(n,r,l),i.evaluatedScale=e.paint.get("model-scale").evaluate(n,r,l),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,n,i){const r=e.findDEMTileFor(n);if(r&&(r.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(r.dem&&r.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=r.tileID.overscaledZ;const t=Yy.create(e,n,r);if(!t)return;this.modelTraits&Fp.HasMapboxMeshFeatures&&this.updateDEM(e,t,n,i);for(const e of this.getNodesInfo()){const n=e.node;if(!n.footprint||!n.footprint.vertices||!n.footprint.vertices.length)continue;const i=n.footprint.vertices;let r=t.getElevationAt(i[0].x,i[0].y,!0,!0);for(let e=1;e<i.length;e++)r=Math.min(r,t.getElevationAt(i[e].x,i[e].y,!0,!0));n.elevation=r}}this.terrainTile=r.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,n,i){let r=t._dem._modifiedForSources[i];if(void 0===r&&(t._dem._modifiedForSources[i]=[],r=t._dem._modifiedForSources[i]),r.includes(n.canonical))return;const o=t._dem.dim;r.push(n.canonical);let s=!1;for(const a of this.getNodesInfo()){const e=a.node;if(!e.footprint||!e.footprint.grid)continue;const n=e.footprint.grid,i=t.tileCoordToPixel(n.min.x,n.min.y),r=t.tileCoordToPixel(n.max.x,n.max.y),l=Math.min(Math.min(o-r.y,i.x),Math.min(i.y,o-r.x));if(l<0)continue;const c=Re(l,2,5);let u=Math.max(0,i.x-c),h=Math.max(0,i.y-c),d=Math.min(r.x+c,o-1),f=Math.min(r.y+c,o-1);for(let t=h;t<=f;++t)for(let e=u;e<=d;++e)Jy[t*o+e]=255;let p=0,m=0;for(let s=0;s<n.cellsY;++s)for(let e=0;e<n.cellsX;++e){if(!n.cells[s*n.cellsX+e])continue;const i=t.tileCoordToPixel(n.min.x+e/n.xScale,n.min.y+s/n.yScale),r=t.tileCoordToPixel(n.min.x+(e+1)/n.xScale,n.min.y+(s+1)/n.yScale);for(let e=i.y;e<=Math.min(r.y+1,o-1);++e)for(let n=i.x;n<=Math.min(r.x+1,o-1);++n)255===Jy[e*o+n]&&(Jy[e*o+n]=0,p+=t.getElevationAtPixel(n,e),m++)}const g=p/m;u=Math.max(1,i.x-c),h=Math.max(1,i.y-c),d=Math.min(r.x+c,o-2),f=Math.min(r.y+c,o-2),s=!0;for(let s=h;s<=f;++s)for(let e=u;e<=d;++e)0===Jy[s*o+e]&&(Ky[s*o+e]=t._dem.set(e,s,g));for(let s=1;s<c;++s){u=Math.max(1,i.x-s),h=Math.max(1,i.y-s),d=Math.min(r.x+s,o-2),f=Math.min(r.y+s,o-2);for(let e=h;e<=f;++e)for(let n=u;n<=d;++n){const i=e*o+n;if(255===Jy[i]){let r=0,a=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let i=-1;i<=1;++i){const c=(e+t)*o+n+i;if(Jy[c]>=s)continue;const h=Ky[c],d=Math.abs(h);d>a&&(r=h,a=d,l=i,u=t)}if(a>.1){const o=1-(s+.5*Math.abs(l*u))/c;let a=t._dem.get(n,e)+r*o;const h=t._dem.get(n+l,e+u),d=t._dem.get(n-l,e-u,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),Ky[i]=t._dem.set(n,e,a),Jy[i]=s}}}}}s&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=ft.now())}setFilter(e){this.filter=e?ks(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new ys(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)zp(t.node),Np(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());for(const i of this.getNodesInfo()){const e=i.node.footprint;i.hiddenByReplacement=!!e&&!n.find(t=>t.footprint===e)}}getHeightAtTileCoord(e,t){const n=[],i=[0,0,0],r=l([]);for(const o of this.getNodesInfo()){const s=o.node.meshes[0],a=s.transformedAabb;if(e<a.min[0]||t<a.min[1]||e>a.max[0]||t>a.max[1])continue;if(!0===o.node.hidden)return{height:1/0,maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]};c(r,o.node.matrix),i[0]=e,i[1]=t,N(i,i,r);const l=(i[0]-s.aabb.min[0])/(s.aabb.max[0]-s.aabb.min[0])*Mp|0,u=Math.min(63,(i[1]-s.aabb.min[1])/(s.aabb.max[1]-s.aabb.min[1])*Mp|0)*Mp+Math.min(63,l),h=s.heightmap[u];if(!(h<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:h,maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new xe(e,t),new xe(e,t),n),n.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function iv(e,t){return e instanceof Bo&&!e.isLightConstant&&t}function rv(e,t,n,i,r,o,s,a){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;n[3]>0&&(l=un(l,255*n[0],n[3]),c=un(c,255*n[1],n[3]),u=un(u,255*n[2],n[3]));const h=l<<8|c,d=u<<8|Math.floor(255*i[3]),f=function(e){const t=Re(e,0,2);return Math.min(Math.round(.5*t*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],p=Re(r[0],0,1),m=Re(r[1],0,1),g=Re(r[2],0,1),_=Re(r[3],0,1);let y,v,x,b;if(p!==m&&s!==o&&m!==p){const e=s-o;v=1/(e*(m-p)),x=-(o+e*p)/(e*(m-p));const t=Re(r[4],-1,1);b=Math.pow(10,t),y=255*g<<8|255*_}else y=65535,v=0,x=1,b=1;if(e.emplaceBack(h,d,f,y,v,x,b),a){const e=a.length;a.clear();for(let t=0;t<e;t++)a.emplaceBack(h,d,f,y,v,x,b)}}function ov(e,t,n){const i=e.node;let r=0;const o=n&Fp.HasMeshoptCompression;for(const s of i.meshes){if(i.lights&&i.lightMeshIndex===r)continue;if(!s.featureData)continue;s.featureArray=new Oa,s.featureArray.reserve(s.featureData.length);let n=t;for(const t of s.featureData){const r=o?65535&t:t>>16&65535,a=o?t>>16&65535:65535&t,l=(15&a)<8?15&a:0,c=e.evaluatedRMEA[l],u=e.evaluatedColor[l],h=e.emissionHeightBasedParams[l];let d;if(n&&2===l&&i.lights&&(d=new Oa,d.resize(10*i.lights.length)),rv(s.featureArray,r,u,c,h,s.aabb.min[2],s.aabb.max[2],d),d&&n){n=!1;const e=i.meshes[i.lightMeshIndex];e.featureArray=d,e.featureArray._trim()}}s.featureArray._trim(),r++}}function sv(e,t,n,i){const r=1<<e.z;t.lat=nc((i/Li+e.y)/r),t.lng=tc((n/Li+e.x)/r)}function av(e,t,n,i){const r=e.getNodesInfo()[t];if(!r||r.hiddenByReplacement||!r.node.meshes)return;let o=Number.MAX_VALUE;const s=r.node,a=n.tile,l=i.calculatePosMatrix(a.tileID.toUnwrapped(),i.worldSize),c=r.evaluatedScale;let f=0;i.elevation&&s.elevation&&(f=s.elevation*i.elevation.exaggeration()),h(l,l,[(s.anchor?s.anchor[0]:0)*(c[0]-1),(s.anchor?s.anchor[1]:0)*(c[1]-1),f]),d(l,l,c);const p=n.queryGeometry,m=p.isPointQuery()?p.screenBounds:p.screenGeometry,g=function(e){const t=u([],l,e.matrix);u(t,i.expandedFarZProjMatrix,t);for(let n=0;n<e.meshes.length;++n){const r=e.meshes[n];if(n===e.lightMeshIndex)continue;const s=Pp(m,i,t,r.aabb);null!=s&&(o=Math.min(s,o))}if(e.children)for(const n of e.children)g(n)};if(g(s),o===Number.MAX_VALUE)return;const _=new Xl(0,0);return sv(a.tileID.canonical,_,r.node.anchor[0],r.node.anchor[1]),{intersectionZ:o,position:_,feature:r.feature}}Xo(nv,"Tiled3dModelBucket",{omit:["layers"]}),Xo(tv,"Tiled3dModelFeature");const lv={circle:class extends Js{constructor(e,t,n,i){super(e,{layout:fu||(fu=new Rs({"circle-sort-key":new Cs(Ps.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ds(Ps.layout_circle["circle-elevation-reference"]),visibility:new Ds(Ps.layout_circle.visibility)})),paint:pu||(pu=new Rs({"circle-radius":new Cs(Ps.paint_circle["circle-radius"]),"circle-color":new Cs(Ps.paint_circle["circle-color"]),"circle-blur":new Cs(Ps.paint_circle["circle-blur"]),"circle-opacity":new Cs(Ps.paint_circle["circle-opacity"]),"circle-translate":new Ds(Ps.paint_circle["circle-translate"]),"circle-translate-anchor":new Ds(Ps.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ds(Ps.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ds(Ps.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Cs(Ps.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Cs(Ps.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Cs(Ps.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ds(Ps.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i)}createBucket(e){return new qc(e)}queryRadius(e){const t=e;return cu("circle-radius",this,t)+cu("circle-stroke-width",this,t)+uu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,r,o,s,a){const l=du(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Qu(e,i,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t,n){const i=Ju(this);return{config:new Cl(this,{zoom:t,lut:n}),defines:i,overrideFog:!1}}is3D(e){return!e&&!!this.layout&&"none"!==this.layout.get("circle-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("circle-elevation-reference")}},heatmap:class extends Js{createBucket(e){return new ih(e)}constructor(e,t,n,i){super(e,{layout:rh||(rh=new Rs({visibility:new Ds(Ps.layout_heatmap.visibility)})),paint:oh||(oh=new Rs({"heatmap-radius":new Cs(Ps.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Cs(Ps.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ds(Ps.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Is(Ps.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ds(Ps.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ph({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(e){return cu("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,i,r,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(t,n);return Qu(e,i,o,s,a,!0,!0,new xe(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t,n){return"heatmap"===e?{config:new Cl(this,{zoom:t,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Js{constructor(e,t,n,i){super(e,{layout:sh||(sh=new Rs({visibility:new Ds(Ps.layout_hillshade.visibility)})),paint:ah||(ah=new Rs({"hillshade-illumination-direction":new Ds(Ps.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ds(Ps.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ds(Ps.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ds(Ps.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ds(Ps.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ds(Ps.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ds(Ps.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t,n){return{overrideFog:!1}}},fill:class extends Js{constructor(e,t,n,i){super(e,{layout:ud||(ud=new Rs({"fill-sort-key":new Cs(Ps.layout_fill["fill-sort-key"]),visibility:new Ds(Ps.layout_fill.visibility),"fill-elevation-reference":new Ds(Ps.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Cs(Ps.layout_fill["fill-construct-bridge-guard-rail"])})),paint:hd||(hd=new Rs({"fill-antialias":new Ds(Ps.paint_fill["fill-antialias"]),"fill-opacity":new Cs(Ps.paint_fill["fill-opacity"]),"fill-color":new Cs(Ps.paint_fill["fill-color"]),"fill-outline-color":new Cs(Ps.paint_fill["fill-outline-color"]),"fill-translate":new Ds(Ps.paint_fill["fill-translate"]),"fill-translate-anchor":new Ds(Ps.paint_fill["fill-translate-anchor"]),"fill-pattern":new Cs(Ps.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ds(Ps.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ds(Ps.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Cs(Ps.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Cs(Ps.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Cs(Ps.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(e,t,n){return{config:new Cl(this,{zoom:t,lut:n}),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new cd(e)}queryRadius(){return uu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,r,o){return!e.queryGeometry.isAboveHorizon&&Yc(hu(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(e){if(0!==this.paint.get("fill-z-offset").constantOr(1))return!0;const t=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=e?t&&!e:t}hasElevation(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}hasShadowPass(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}},"fill-extrusion":class extends Js{constructor(e,t,n,i){super(e,{layout:mf||(mf=new Rs({visibility:new Ds(Ps["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ds(Ps["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:gf||(gf=new Rs({"fill-extrusion-opacity":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Cs(Ps["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Cs(Ps["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Cs(Ps["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Cs(Ps["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Cs(Ps["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Cs(Ps["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Cs(Ps["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Cs(Ps["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ds(Ps["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new rf(e)}queryRadius(){return uu(this.paint.get("fill-extrusion-translate"))}is3D(e){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,n,i,r,o,s,a,l){const c=du(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,n),h=this.paint.get("fill-extrusion-base").evaluate(t,n),d=[0,0],f=a&&o.elevation,p=o.elevation?o.elevation.exaggeration():1,m=e.tile.getBucket(this);if(f&&m instanceof rf){const e=m.centroidVertexArray,t=l+1;t<e.length&&(d[0]=e.geta_centroid_pos0(t),d[1]=e.geta_centroid_pos1(t))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(i=ff([i],[new xe(0,0),new xe(Li,Li)],e.tileID.canonical).map(e=>e.polygon).flat());const g=f?a:null,[_,y]=function(e,t,n,i,r,o,s,a,l,c,u){return"globe"===e.projection.name?function(e,t,n,i,r,o,s,a,l,c,u){const h=[],d=[],f=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,p=[0,0,0,1],m=[0,0,0,1],g=(e,t,n,i)=>{e[0]=t,e[1]=n,e[2]=i,e[3]=1},_=df();n>0&&(n+=_),i+=_;for(const y of t){const t=[],_=[];for(const h of y){const d=h.x+r.x,y=h.y+r.y,v=e.projection.projectTilePoint(d,y,u),x=e.projection.upVector(u,h.x,h.y);let b=n,w=i;if(s){const e=Sf(d,y,n,i,s,a,l,c);b+=e.base,w+=e.top}0!==n?g(p,v.x+x[0]*f*b,v.y+x[1]*f*b,v.z+x[2]*f*b):g(p,v.x,v.y,v.z),g(m,v.x+x[0]*f*w,v.y+x[1]*f*w,v.z+x[2]*f*w),N(p,p,o),N(m,m,o),t.push(new _f(p[0],p[1],p[2])),_.push(new _f(m[0],m[1],m[2]))}h.push(t),d.push(_)}return[h,d]}(e,t,n,i,r,o,s,a,l,c,u):s?function(e,t,n,i,r,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],f=[];for(const c of d){const u=c.x+i.x,d=c.y+i.y,p=Sf(u,d,t,n,o,s,a,l);h[0]=u,h[1]=d,h[2]=p.base,h[3]=1,K(h,h,r),h[3]=Math.max(h[3],1e-5);const m=new _f(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=u,h[1]=d,h[2]=p.top,h[3]=1,K(h,h,r),h[3]=Math.max(h[3],1e-5);const g=new _f(h[0]/h[3],h[1]/h[3],h[2]/h[3]);e.push(m),f.push(g)}c.push(e),u.push(f)}return[c,u]}(t,n,i,r,o,s,a,l,c):function(e,t,n,i,r){const o=[],s=[],a=r[8]*t,l=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*n,d=r[9]*n,f=r[10]*n,p=r[11]*n;for(const m of e){const e=[],t=[];for(const n of m){const o=n.x+i.x,s=n.y+i.y,m=r[0]*o+r[4]*s+r[12],g=r[1]*o+r[5]*s+r[13],_=r[2]*o+r[6]*s+r[14],y=r[3]*o+r[7]*s+r[15],v=m+a,x=g+l,b=_+c,w=Math.max(y+u,1e-5),E=m+h,T=g+d,A=_+f,S=Math.max(y+p,1e-5);e.push(new _f(v/w,x/w,b/w)),t.push(new _f(E/S,T/S,A/S))}o.push(e),s.push(t)}return[o,s]}(t,n,i,r,o)}(o,i,h,u,c,s,g,d,p,o.center.lat,e.tileID.canonical),v=e.queryGeometry;return function(e,t,n){let i=1/0;Yc(n,t)&&(i=Af(n,t[0]));for(let r=0;r<t.length;r++){const o=t[r],s=e[r];for(let e=0;e<o.length-1;e++){const t=o[e],r=[t,o[e+1],s[e+1],s[e],t];Xc(n,r)&&(i=Math.min(i,Af(n,r)))}}return i!==1/0&&i}(_,y,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},building:class extends Js{constructor(e,t,n,i){super(e,{layout:sm||(sm=new Rs({visibility:new Ds(Ps.layout_building.visibility),"building-facade":new Cs(Ps.layout_building["building-facade"]),"building-facade-floors":new Cs(Ps.layout_building["building-facade-floors"]),"building-facade-window":new Cs(Ps.layout_building["building-facade-window"]),"building-roof-shape":new Cs(Ps.layout_building["building-roof-shape"]),"building-height":new Cs(Ps.layout_building["building-height"]),"building-base":new Cs(Ps.layout_building["building-base"])})),paint:am||(am=new Rs({"building-opacity":new Ds(Ps.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Ds(Ps.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Ds(Ps.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Ds(Ps.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Ds(Ps.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Ds(Ps.paint_building["building-vertical-scale"]),"building-cast-shadows":new Ds(Ps.paint_building["building-cast-shadows"]),"building-color":new Cs(Ps.paint_building["building-color"]),"building-emissive-strength":new Cs(Ps.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Ds(Ps.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Ds(Ps.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new rm(e)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(e){return!0}},line:class extends Js{constructor(e,t,n,i){const r=Rm();super(e,r,t,n,i),r.layout&&(this.layout=new Ss(r.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Er,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=(()=>{if(Mm)return Mm;const e=Rm();return Mm=new Pm(e.paint.properties["line-width"].specification),Mm.useIntegerZoom=!0,Mm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new vm(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t,n){const i=Dm(this);return{config:new Cl(this,{zoom:t,lut:n}),defines:i,overrideFog:!1}}queryRadius(e){const t=e,n=Fm(cu("line-width",this,t),cu("line-gap-width",this,t)),i=cu("line-offset",this,t);return n/2+Math.abs(i)+uu(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,r,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=hu(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Fm(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),l=this.paint.get("line-offset").evaluate(t,n);return l&&(i=function(e,t){const n=[],i=new xe(0,0);for(let r=0;r<e.length;r++){const o=e[r],s=[];for(let e=0;e<o.length;e++){const n=o[e],r=o[e+1],a=0===e?i:n.sub(o[e-1])._unit()._perp(),l=e===o.length-1?i:r.sub(n)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(t)._add(n))}n.push(s)}return n}(i,l*e.pixelToTileUnitsFactor)),function(e,t,n){for(let i=0;i<t.length;i++){const r=t[i];if(e.length>=3)for(let t=0;t<r.length;t++)if(ru(e,r[t]))return!0;if(Kc(e,r,n))return!0}return!1}(s,i,a)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(e){return!this.hasElevatedBuckets||this.layout&&"hd-road-markup"===this.layout.get("line-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("line-elevation-reference")}},symbol:by,background:class extends Js{constructor(e,t,n,i){super(e,{layout:wy||(wy=new Rs({visibility:new Ds(Ps.layout_background.visibility)})),paint:Ey||(Ey=new Rs({"background-pitch-alignment":new Ds(Ps.paint_background["background-pitch-alignment"]),"background-color":new Ds(Ps.paint_background["background-color"]),"background-pattern":new Ds(Ps.paint_background["background-pattern"]),"background-opacity":new Ds(Ps.paint_background["background-opacity"]),"background-emissive-strength":new Ds(Ps.paint_background["background-emissive-strength"]),"background-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t,n){return{overrideFog:!1}}is3D(e){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:My,"raster-particle":zy,sky:class extends Js{constructor(e,t,n,i){super(e,{layout:ky||(ky=new Rs({visibility:new Ds(Ps.layout_sky.visibility)})),paint:Oy||(Oy=new Rs({"sky-type":new Ds(Ps.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ds(Ps.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ds(Ps.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ds(Ps.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ds(Ps.paint_sky["sky-gradient-radius"]),"sky-gradient":new Is(Ps.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ds(Ps.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ds(Ps.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ds(Ps.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ph({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const n=this.paint.get("sky-atmosphere-sun"),i=!n,r=e.style.light,o=r.properties.get("position");return i&&"viewport"===r.properties.get("anchor")&&He("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?Uy(o.azimuthal,90-o.polar,t):Uy(n[0],90-n[1],t)}const n=this.paint.get("sky-gradient-center");return Uy(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends Js{constructor(e,t,n,i){super(e,{paint:By||(By=new Rs({}))},t,null)}},model:class extends Js{constructor(e,t,n,i){super(e,{layout:Xy||(Xy=new Rs({visibility:new Ds(Ps.layout_model.visibility),"model-id":new Cs(Ps.layout_model["model-id"])})),paint:Zy||(Zy=new Rs({"model-opacity":new Cs(Ps.paint_model["model-opacity"]),"model-rotation":new Cs(Ps.paint_model["model-rotation"]),"model-scale":new Cs(Ps.paint_model["model-scale"]),"model-translation":new Cs(Ps.paint_model["model-translation"]),"model-color":new Cs(Ps.paint_model["model-color"]),"model-color-mix-intensity":new Cs(Ps.paint_model["model-color-mix-intensity"]),"model-type":new Ds(Ps.paint_model["model-type"]),"model-cast-shadows":new Ds(Ps.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ds(Ps.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ds(Ps.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Cs(Ps.paint_model["model-emissive-strength"]),"model-roughness":new Cs(Ps.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Cs(Ps.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ds(Ps.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ds(Ps.paint_model["model-front-cutoff"]),"model-color-use-theme":new Cs({type:"string",default:"default","property-type":"data-driven"})}))},t,n,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new qy(e)}getProgramIds(){return["model"]}is3D(e){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof nv?Li-1:0}queryIntersectsFeature(e,t,n,i,r,o){if(!this.modelManager)return!1;const s=this.modelManager,l=e.tile.getBucket(this);if(!(l&&l instanceof qy))return!1;for(const c in l.instancesPerModel){const n=l.instancesPerModel[c],i=void 0!==t.id?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(n.idToFeaturesIndex.hasOwnProperty(i)){const t=n.features[n.idToFeaturesIndex[i]],r=s.getModel(c,this.scope);if(!r)return!1;let h=a();const d=new Xl(0,0),f=l.canonical;let p=Number.MAX_VALUE;for(let i=0;i<t.instancedDataCount;++i){const s=16*(t.instancedDataOffset+i),a=n.instancedDataArray.float32,l=[a[s+4],a[s+5],a[s+6]];sv(f,d,a[s],0|a[s+1]),Lp(h,r,o,d,t.rotation,t.scale,l,!1,!1,!1),"globe"===o.projection.name&&(h=Rp(h,o));const c=u([],o.projMatrix,h),m=e.queryGeometry,g=Pp(m.isPointQuery()?m.screenBounds:m.screenGeometry,o,c,r.aabb);null!=g&&(p=Math.min(g,p))}return p!==Number.MAX_VALUE&&p}}return!1}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof zo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Js{constructor(e,t,n,i){super(e,{layout:dd||(dd=new Rs({"clip-layer-types":new Ds(Ps.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ds(Ps.layout_clip["clip-layer-scope"])})),paint:fd||(fd=new Rs({}))},t,n,i)}recalculate(e,t){super.recalculate(e,t)}createBucket(e){return new gd(e)}is3D(e){return!0}}},cv=new sn(0,0,0),uv={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},hv={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},dv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},fv={PAINT_ORDER_FILL_AND_STROKE:1},pv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},mv={MASK_TYPE_LUMINANCE:1};function gv(e,t,n){1===e&&t.icons.push(function(e,t){return function(e){if(e.usvg_tree.height||(e.usvg_tree.height=e.usvg_tree.width),!e.metadata)return e;const{metadata:t}=e;if(t.content_area){const{content_area:n}=t;null==n.top&&(n.top=n.left),null==n.width&&(n.width=e.usvg_tree.width),null==n.height&&(n.height=n.width)}return t.stretch_x&&t.stretch_x.length&&_v(t,"x"),t.stretch_y&&t.stretch_y.length&&_v(t,"y"),e}(e.readFields(yv,{name:void 0},t))}(n,n.readVarint()+n.pos))}function _v(e,t){const n=[],i=e["stretch_".concat(t)];let r=null;for(let o=0;o<i.length;o++)null===r?r=0===n.length?i[0]:n[n.length-1][1]+i[o]:(n.push([r,r+i[o]]),r=null);e["stretch_".concat(t,"_areas")]=n}function yv(e,t,n){1===e?t.name=n.readString():2===e?t.metadata=function(e,t){return e.readFields(vv,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},t)}(n,n.readVarint()+n.pos):3===e&&(t.usvg_tree=function(e,t){return e.readFields(wv,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},t)}(n,n.readVarint()+n.pos),t.data="usvg_tree")}function vv(e,t,n){1===e?t.stretch_x=n.readPackedVarint():2===e?t.stretch_y=n.readPackedVarint():3===e?t.content_area=function(e,t){return e.readFields(xv,{left:0},t)}(n,n.readVarint()+n.pos):4===e&&t.variables.push(function(e,t){return e.readFields(bv,{name:void 0},t)}(n,n.readVarint()+n.pos))}function xv(e,t,n){1===e?t.left=n.readVarint():2===e?t.width=n.readVarint():3===e?t.top=n.readVarint():4===e&&(t.height=n.readVarint())}function bv(e,t,n){1===e?t.name=n.readString():2===e&&(t.rgb_color=Rv(n.readVarint()),t.value="rgb_color")}function wv(e,t,n){1===e?t.width=t.height=n.readVarint():2===e?t.height=n.readVarint():3===e?t.children.push(Ev(n,n.readVarint()+n.pos)):4===e?t.linear_gradients.push(function(e,t){return e.readFields(Mv,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},t)}(n,n.readVarint()+n.pos)):5===e?t.radial_gradients.push(function(e,t){return e.readFields(kv,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},t)}(n,n.readVarint()+n.pos)):7===e?t.clip_paths.push(function(e,t){return e.readFields(Ov,{children:[]},t)}(n,n.readVarint()+n.pos)):8===e&&t.masks.push(function(e,t){const n=e.readFields(Bv,{left:0,width:20,mask_type:mv.MASK_TYPE_LUMINANCE,children:[]},t);return null==n.height&&(n.height=n.width),null==n.top&&(n.top=n.left),n}(n,n.readVarint()+n.pos))}function Ev(e,t){return e.readFields(Tv,{},t)}function Tv(e,t,n){1===e?(t.group=function(e,t){return e.readFields(Av,{opacity:255,children:[]},t)}(n,n.readVarint()+n.pos),t.node="group"):2===e&&(t.path=function(e,t){return e.readFields(Cv,{paint_order:1,commands:[],step:1,diffs:[],rule:uv.PATH_RULE_NON_ZERO},t)}(n,n.readVarint()+n.pos),t.node="path")}function Av(e,t,n){1===e?t.transform=Sv(n,n.readVarint()+n.pos):2===e?t.opacity=n.readVarint():5===e?t.clip_path_idx=n.readVarint():6===e?t.mask_idx=n.readVarint():7===e&&t.children.push(Ev(n,n.readVarint()+n.pos))}function Sv(e,t){return e.readFields(Dv,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function Dv(e,t,n){1===e?t.sx=n.readFloat():2===e?t.ky=n.readFloat():3===e?t.kx=n.readFloat():4===e?t.sy=n.readFloat():5===e?t.tx=n.readFloat():6===e&&(t.ty=n.readFloat())}function Cv(e,t,n){1===e?t.fill=function(e,t){return e.readFields(Iv,{rgb_color:cv,paint:"rgb_color",opacity:255},t)}(n,n.readVarint()+n.pos):2===e?t.stroke=function(e,t){return e.readFields(Pv,{rgb_color:cv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},t)}(n,n.readVarint()+n.pos):3===e?t.paint_order=n.readVarint():5===e?n.readPackedVarint(t.commands):6===e?t.step=n.readFloat():7===e?n.readPackedSVarint(t.diffs):8===e&&(t.rule=n.readVarint())}function Iv(e,t,n){1===e?(t.rgb_color=Rv(n.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=n.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=n.readVarint(),t.paint="radial_gradient_idx"):5===e&&(t.opacity=n.readVarint())}function Rv(e){return new sn((e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1)}function Pv(e,t,n){1===e?(t.rgb_color=Rv(n.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=n.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=n.readVarint(),t.paint="radial_gradient_idx"):5===e?n.readPackedFloat(t.dasharray):6===e?t.dashoffset=n.readFloat():7===e?t.miterlimit=n.readFloat():8===e?t.opacity=n.readVarint():9===e?t.width=n.readFloat():10===e?t.linecap=n.readVarint():11===e&&(t.linejoin=n.readVarint())}function Mv(e,t,n){1===e?t.transform=Sv(n,n.readVarint()+n.pos):2===e?t.spread_method=n.readVarint():3===e?t.stops.push(Fv(n,n.readVarint()+n.pos)):4===e?t.x1=n.readFloat():5===e?t.y1=n.readFloat():6===e?t.x2=n.readFloat():7===e&&(t.y2=n.readFloat())}function Fv(e,t){return e.readFields(Lv,{offset:0,opacity:255,rgb_color:cv},t)}function Lv(e,t,n){1===e?t.offset=n.readFloat():2===e?t.opacity=n.readVarint():3===e&&(t.rgb_color=Rv(n.readVarint()))}function kv(e,t,n){1===e?t.transform=Sv(n,n.readVarint()+n.pos):2===e?t.spread_method=n.readVarint():3===e?t.stops.push(Fv(n,n.readVarint()+n.pos)):4===e?t.cx=n.readFloat():5===e?t.cy=n.readFloat():6===e?t.r=n.readFloat():7===e?t.fx=n.readFloat():8===e?t.fy=n.readFloat():9===e&&(t.fr=n.readFloat())}function Ov(e,t,n){1===e?t.transform=Sv(n,n.readVarint()+n.pos):2===e?t.clip_path_idx=n.readVarint():3===e&&t.children.push(Ev(n,n.readVarint()+n.pos))}function Bv(e,t,n){1===e?t.left=t.top=n.readFloat():2===e?t.width=t.height=n.readFloat():3===e?t.top=n.readFloat():4===e?t.height=n.readFloat():5===e?t.mask_type=n.readVarint():6===e?t.mask_idx=n.readVarint():7===e&&t.children.push(Ev(n,n.readVarint()+n.pos))}class zv{static calculate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=new Map,i=new Map;if(0===Object.keys(e).length)return n;t.forEach(e=>{i.set(e.name,e.rgb_color||new sn(0,0,0))});for(const[r,o]of Object.entries(e))i.has(r)?n.set(i.get(r).toString(),o):console.warn('Ignoring unknown image variable "'.concat(r,'"'));return n}}function Nv(e){let t=arguments.length>2?arguments[2]:void 0;const n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:255)/255,i=e.toString(),r=t.has(i)?t.get(i).clone():e.clone();return r.a*=n,r.toString()}function Uv(e,t){if(!dt()){const n=document.createElement("canvas");return n.width=e,n.height=t,n}return new OffscreenCanvas(e,t)}function Vv(e,t){const n=zv.calculate(t.params,e.metadata?e.metadata.variables:[]),i=e.usvg_tree,r=i.width,o=i.height,s=t.transform?t.transform:new DOMMatrix,a=Math.max(1,Math.round(r*s.a)),l=Math.max(1,Math.round(o*s.d)),c=new DOMMatrix([a/r,0,0,l/o,0,0]),u=Uv(a,l).getContext("2d");return jv(u,c,i,i,n),u.getImageData(0,0,a,l)}function jv(e,t,n,i,r){for(const o of i.children)Gv(e,t,n,o,r)}function Gv(e,t,n,i,r){i.group?(e.save(),function(e,t,n,i,r){const o=null!=i.mask_idx?n.masks[i.mask_idx]:null,s=null!=i.clip_path_idx?n.clip_paths[i.clip_path_idx]:null;if(i.transform&&(t=Qv(i.transform).preMultiplySelf(t)),!function(e,t,n){return 255!==e.opacity||t||n}(i,null!=s,null!=o))return void jv(e,t,n,i,r);const a=Uv(e.canvas.width,e.canvas.height),l=a.getContext("2d");jv(l,t,n,i,r),s&&Kv(l,t,n,s),o&&Jv(l,t,n,o,r),e.globalAlpha=i.opacity/255,e.drawImage(a,0,0)}(e,t,n,i.group,r),e.restore()):i.path&&(e.save(),function(e,t,n,i,r){e.setTransform(t),i.paint_order===fv.PAINT_ORDER_FILL_AND_STROKE?(Hv(e,n,i,r),qv(e,n,i,r)):(qv(e,n,i,r),Hv(e,n,i,r))}(e,t,n,i.path,r),e.restore())}function Hv(e,t,n,i){const r=n.fill;if(!r)return;const o=r.opacity/255;switch(e.save(),e.beginPath(),$v(n,e),r.paint){case"rgb_color":e.fillStyle=Nv(r.rgb_color,r.opacity,i);break;case"linear_gradient_idx":{const n=t.linear_gradients[r.linear_gradient_idx];n.transform&&e.setTransform(Qv(n.transform).preMultiplySelf(e.getTransform())),e.fillStyle=Xv(e,n,o,i);break}case"radial_gradient_idx":{const n=t.radial_gradients[r.radial_gradient_idx];n.transform&&e.setTransform(Qv(n.transform).preMultiplySelf(e.getTransform())),e.fillStyle=Zv(e,n,o,i)}}e.fill(Wv(n)),e.restore()}function Wv(e){return e.rule===uv.PATH_RULE_NON_ZERO?"nonzero":e.rule===uv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function qv(e,t,n,i){const r=n.stroke;if(!r)return;const o=ex(n);e.lineWidth=r.width,e.miterLimit=r.miterlimit,e.setLineDash(r.dasharray),e.lineDashOffset=r.dashoffset;const s=r.opacity/255;switch(r.paint){case"rgb_color":e.strokeStyle=Nv(r.rgb_color,r.opacity,i);break;case"linear_gradient_idx":e.strokeStyle=Xv(e,t.linear_gradients[r.linear_gradient_idx],s,i,!0);break;case"radial_gradient_idx":e.strokeStyle=Zv(e,t.radial_gradients[r.radial_gradient_idx],s,i,!0)}switch(r.linejoin){case dv.LINE_JOIN_MITER_CLIP:case dv.LINE_JOIN_MITER:e.lineJoin="miter";break;case dv.LINE_JOIN_ROUND:e.lineJoin="round";break;case dv.LINE_JOIN_BEVEL:e.lineJoin="bevel"}switch(r.linecap){case hv.LINE_CAP_BUTT:e.lineCap="butt";break;case hv.LINE_CAP_ROUND:e.lineCap="round";break;case hv.LINE_CAP_SQUARE:e.lineCap="square"}e.stroke(o)}function Xv(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1===t.stops.length){const e=t.stops[0];return Nv(e.rgb_color,e.opacity*n,i)}const{x1:o,y1:s,x2:a,y2:l}=t;let c=new DOMPoint(o,s),u=new DOMPoint(a,l);if(r){const e=Qv(t.transform);c=e.transformPoint(c),u=e.transformPoint(u)}const h=e.createLinearGradient(c.x,c.y,u.x,u.y);for(const d of t.stops)h.addColorStop(d.offset,Nv(d.rgb_color,d.opacity*n,i));return h}function Zv(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1===t.stops.length){const e=t.stops[0];return Nv(e.rgb_color,e.opacity*n,i)}const o=Qv(t.transform),{fx:s,fy:a,fr:l,cx:c,cy:u,r:h}=t;let d=new DOMPoint(s,a),f=new DOMPoint(c,u),p=l,m=h;if(r){d=o.transformPoint(d),f=o.transformPoint(f);const e=(o.a+o.d)/2;p=l*e,m=t.r*e}const g=e.createRadialGradient(d.x,d.y,p,f.x,f.y,m);for(const _ of t.stops)g.addColorStop(_.offset,Nv(_.rgb_color,_.opacity*n,i));return g}function Yv(e,t,n,i){const r=i.transform?Qv(i.transform).preMultiplySelf(t):t,o=Uv(e.canvas.width,e.canvas.height),s=o.getContext("2d");for(const l of i.children)if(l.group)Yv(s,r,n,l.group);else if(l.path){const e=l.path,t=new Path2D;t.addPath(ex(e),r),s.fill(t,Wv(e))}const a=null!=i.clip_path_idx?n.clip_paths[i.clip_path_idx]:null;a&&Kv(s,r,n,a),e.globalCompositeOperation="source-over",e.drawImage(o,0,0)}function Kv(e,t,n,i){const r=Uv(e.canvas.width,e.canvas.height);Yv(r.getContext("2d"),t,n,i),e.globalCompositeOperation="destination-in",e.drawImage(r,0,0)}function Jv(e,t,n,i,r){if(0===i.children.length)return;const o=null!=i.mask_idx?n.masks[i.mask_idx]:null;o&&Jv(e,t,n,o,r);const s=e.canvas.width,a=e.canvas.height,l=Uv(s,a),c=l.getContext("2d"),u=i.width,h=i.height,d=i.left,f=i.top,p=new Path2D,m=new Path2D;m.rect(d,f,u,h),p.addPath(m,t),c.clip(p);for(const y of i.children)Gv(c,t,n,y,r);const g=c.getImageData(0,0,s,a),_=g.data;if(i.mask_type===mv.MASK_TYPE_LUMINANCE)for(let y=0;y<_.length;y+=4)_[y+3]=_[y+3]/255*(.2126*_[y]+.7152*_[y+1]+.0722*_[y+2]);c.putImageData(g,0,0),e.globalCompositeOperation="destination-in",e.drawImage(l,0,0)}function Qv(e){return e?new DOMMatrix([e.sx,e.ky,e.kx,e.sy,e.tx,e.ty]):new DOMMatrix}function $v(e,t){const n=e.step;let i=e.diffs[0]*n,r=e.diffs[1]*n;t.moveTo(i,r);for(let o=0,s=2;o<e.commands.length;o++)switch(e.commands[o]){case pv.PATH_COMMAND_MOVE:i+=e.diffs[s++]*n,r+=e.diffs[s++]*n,t.moveTo(i,r);break;case pv.PATH_COMMAND_LINE:i+=e.diffs[s++]*n,r+=e.diffs[s++]*n,t.lineTo(i,r);break;case pv.PATH_COMMAND_QUAD:{const o=i+e.diffs[s++]*n,a=r+e.diffs[s++]*n;i=o+e.diffs[s++]*n,r=a+e.diffs[s++]*n,t.quadraticCurveTo(o,a,i,r);break}case pv.PATH_COMMAND_CUBIC:{const o=i+e.diffs[s++]*n,a=r+e.diffs[s++]*n,l=o+e.diffs[s++]*n,c=a+e.diffs[s++]*n;i=l+e.diffs[s++]*n,r=c+e.diffs[s++]*n,t.bezierCurveTo(o,a,l,c,i,r);break}case pv.PATH_COMMAND_CLOSE:t.closePath()}return t}function ex(e){return $v(e,new Path2D)}class tx{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}put(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,t)}delete(e){this.cache.delete(e)}}Xo(tx,"LRUCache");class nx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new dh(e,e.data)}getFromCache(e,t,n){return this.cacheMap.has(n)||this.cacheMap.set(n,new tx(150)),this.cacheMap.get(n).get(Zs(e.toString(),t))}setInCache(e,t,n,i){this.cacheDependenciesMap.has(i)||this.cacheDependenciesMap.set(i,new Map),this.cacheMap.has(i)||this.cacheMap.set(i,new tx(150));const r=this.cacheDependenciesMap.get(i),o=Zs(e.id.toString(),n);r.get(o)||r.set(o,new Set);const s=this.cacheMap.get(i),a=e.toString();r.get(o).add(a),s.put(Zs(e.toString(),n),t)}removeImagesFromCacheByIds(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.cacheMap.has(n)||!this.cacheDependenciesMap.has(n))return;const i=this.cacheMap.get(n),r=this.cacheDependenciesMap.get(n);for(const o of e){const e=Zs(o.toString(),t);if(r.has(e)){for(const t of r.get(e))i.delete(t);r.delete(e)}}}rasterize(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Vv;const o=this.getFromCache(e,n,i);if(o)return o.clone();const s=r(t.icon,e.options),a=nx._getImage(s);return this.setInCache(e,a,n,i),a.clone()}}class ix{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function rx(e,t,n,i){let r=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(i[s])<1e-15){if(n[s]<e[s]||n[s]>t[s])return null}else{const a=1/i[s];let l=(e[s]-n[s])*a,c=(t[s]-n[s])*a;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function ox(e,t,n,i,r,o,s,a,l,c,u){const h=i-e,d=r-t,f=o-n,p=s-e,m=a-t,g=l-n,_=u[1]*g-u[2]*m,y=u[2]*p-u[0]*g,v=u[0]*m-u[1]*p,x=h*_+d*y+f*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,E=c[1]-t,T=c[2]-n,A=(w*_+E*y+T*v)*b;if(A<0||A>1)return null;const S=E*f-T*d,D=T*h-w*f,C=w*d-E*h,I=(u[0]*S+u[1]*D+u[2]*C)*b;return I<0||A+I>1?null:(p*S+m*D+g*C)*b}function sx(e,t,n){return(e-t)/(n-t)}function ax(e,t,n,i,r,o,s,a,l){const c=1<<n,u=o-i,h=s-r,d=(e+1)/c*u+i,f=(t+0)/c*h+r,p=(t+1)/c*h+r;a[0]=(e+0)/c*u+i,a[1]=f,l[0]=d,l[1]=p}class lx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),n=[];let i=Math.ceil(Math.pow(2,t));const r=1/i,o=(e,t,n,i,r)=>{const o=i?1:0,s=(e+1)*n-o,a=t*n,l=(t+1)*n-o;r[0]=e*n,r[1]=a,r[2]=s,r[3]=l};let s=new ix(i);const a=[];for(let l=0;l<i*i;l++){o(l%i,Math.floor(l/i),r,!1,a);const t=ux(a[0],a[1],e),n=ux(a[2],a[1],e),c=ux(a[2],a[3],e),u=ux(a[0],a[3],e);s.minimums.push(Math.min(t,n,c,u)),s.maximums.push(Math.max(t,n,c,u)),s.leaves.push(1)}for(n.push(s),i/=2;i>=1;i/=2){const e=n[n.length-1];s=new ix(i);for(let t=0;t<i*i;t++){o(t%i,Math.floor(t/i),2,!0,a);const n=e.getElevation(a[0],a[1]),r=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),f=e.isLeaf(a[0],a[3]),p=Math.min(n.min,r.min,l.min,c.min),m=Math.max(n.max,r.max,l.max,c.max),g=u&&h&&d&&f;s.maximums.push(m),s.minimums.push(p),s.leaves.push(m-p<=5&&g?1:0)}n.push(s)}return n}(this.dem),n=t.length-1,i=t[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return rx([e,t,-100],[n,i,this.maximums[0]*s],r,o)}raycast(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,n,i,r,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:f,nodex:p,nodey:m,depth:g}=d.pop();if(this.leaves[a]){ax(p,m,g,e,t,n,i,u,h);const a=1<<g,l=(p+0)/a,c=(p+1)/a,d=(m+0)/a,_=(m+1)/a,y=ux(l,d,this.dem)*s,v=ux(c,d,this.dem)*s,x=ux(c,_,this.dem)*s,b=ux(l,_,this.dem)*s,w=ox(u[0],u[1],y,h[0],u[1],v,h[0],h[1],x,r,o),E=ox(h[0],h[1],x,u[0],h[1],b,u[0],u[1],y,r,o),T=Math.min(null!==w?w:Number.MAX_VALUE,null!==E?E:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const e=P([],r,o,f);if(cx(y,v,b,x,sx(e[0],u[0],h[0]),sx(e[1],u[1],h[1]))>=e[2])return f}continue}let _=0;for(let d=0;d<this._siblingOffset.length;d++){ax((p<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,e,t,n,i,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const f=rx(u,h,r,o);if(null!=f){const e=f;l[d]=e;let t=!1;for(let n=0;n<_&&!t;n++)e>=l[c[n]]&&(c.splice(n,0,d),t=!0);t||(c[_]=d),_++}}for(let e=0;e<_;e++){const t=c[e];d.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(p<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,i,r){if(1===e[i].isLeaf(t,n))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=i-1,s=e[o];let a=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],i=2*n+this._siblingOffset[c][1],r=s.getElevation(e,i),o=s.isLeaf(e,i),u=this._addNode(r.min,r.max,o);o&&(a|=1<<c),l||(l=u)}for(let c=0;c<this._siblingOffset.length;c++)a&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],o,l+c)}}function cx(e,t,n,i,r,o){return un(un(e,n,o),un(t,i,o),r)}function ux(e,t,n){const i=n.dim,r=Re(e*i-.5,0,i-1),o=Re(t*i-.5,0,i-1),s=Math.floor(r),a=Math.floor(o),l=Math.min(s+1,i-1),c=Math.min(a+1,i-1);return cx(n.get(s,a),n.get(l,a),n.get(s,c),n.get(l,c),r-s,o-a)}const hx={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function dx(e,t,n){return(256*e*256+256*t+n)/10-1e4}function fx(e,t,n){return 256*e+t+n/256-32768}class px{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return void He('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=t.height;const r=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=i,this._modifiedForSources={},!i){for(let e=0;e<r;e++)o[this._idx(-1,e)]=o[this._idx(0,e)],o[this._idx(r,e)]=o[this._idx(r-1,e)],o[this._idx(e,-1)]=o[this._idx(e,0)],o[this._idx(e,r)]=o[this._idx(e,r-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(r,-1)]=o[this._idx(r-1,0)],o[this._idx(-1,r)]=o[this._idx(0,r-1)],o[this._idx(r,r)]=o[this._idx(r-1,r-1)]}const s="terrarium"===n?fx:dx;for(let a=0;a<o.length;++a){const e=4*a;this.floatView[a]=s(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=ft.now()}_buildQuadTree(){this._tree=new lx(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=Re(e,-1,this.dim),t=Re(t,-1,this.dim));const n=this._idx(e,t);return this.floatView[n]}set(e,t,n){const i=this._idx(e,t),r=this.floatView[i];return this.floatView[i]=n,n-r}static getUnpackVector(e){return hx[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const n=[0,0,0,0],i=px.getUnpackVector(t);let r=Math.floor((e+i[3])/i[2]);return n[2]=r%256,r=Math.floor(r/256),n[1]=r%256,r=Math.floor(r/256),n[0]=r,n}getPixels(){return new fh({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,r=t*this.dim+this.dim,o=n*this.dim,s=n*this.dim+this.dim;switch(t){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-n*this.dim;for(let c=o;c<s;c++)for(let t=i;t<r;t++){const n=4*this._idx(t,c),i=4*this._idx(t+a,c+l);this.pixels[n+0]=e.pixels[i+0],this.pixels[n+1]=e.pixels[i+1],this.pixels[n+2]=e.pixels[i+2],this.pixels[n+3]=e.pixels[i+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function mx(e,t,n){1===e?t.headerLength=n.readFixed32():2===e?t.x=n.readVarint():3===e?t.y=n.readVarint():4===e?t.z=n.readVarint():5===e&&t.layers.push(function(e,t){return e.readFields(xx,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},t)}(n,n.readVarint()+n.pos))}function gx(e,t,n){1===e?(t.delta_filter=function(e,t){return e.readFields(_x,{blockSize:0},t)}(n,n.readVarint()+n.pos),t.filter="delta_filter"):2===e?(n.readVarint(),t.filter="zigzag_filter"):3===e?(n.readVarint(),t.filter="bitshuffle_filter"):4===e&&(n.readVarint(),t.filter="byteshuffle_filter")}function _x(e,t,n){1===e&&(t.blockSize=n.readVarint())}function yx(e,t,n){1===e?(n.readVarint(),t.codec="gzip_data"):2===e?(n.readVarint(),t.codec="jpeg_image"):3===e?(n.readVarint(),t.codec="webp_image"):4===e&&(n.readVarint(),t.codec="png_image")}function vx(e,t,n){let i=0,r=0;1===e?t.firstByte=n.readFixed64():2===e?t.lastByte=n.readFixed64():3===e?t.filters.push(function(e,t){return e.readFields(gx,{},t)}(n,n.readVarint()+n.pos)):4===e?t.codec=function(e,t){return e.readFields(yx,{},t)}(n,n.readVarint()+n.pos):5===e?r=n.readFloat():6===e?i=n.readFloat():7===e?t.bands.push(n.readString()):8===e?t.offset=n.readDouble():9===e&&(t.scale=n.readDouble()),0===t.offset&&(t.offset=r),0===t.scale&&(t.scale=i)}function xx(e,t,n){1===e?t.version=n.readVarint():2===e?t.name=n.readString():3===e?t.units=n.readString():4===e?t.tileSize=n.readVarint():5===e?t.buffer=n.readVarint():6===e?t.pixelFormat=n.readVarint():7===e&&t.dataIndex.push(function(e,t){return e.readFields(vx,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)}(n,n.readVarint()+n.pos))}function bx(e,t,n){if(2===e)!function(e,t,n){e.readFields(wx,n,t)}(n,n.readVarint()+n.pos,t);else if(3===e)throw new Error("Not implemented")}function wx(e,t,n){if(1===e){let e=0;const i=n.readVarint()+n.pos;for(;n.pos<i;)t[e++]=n.readVarint()}}function Ex(e,t){if(4!==t.length)throw new Error("Expected data of dimension 4 but got ".concat(t.length,"."));let n=t[3];for(let i=2;i>=1;i--){const r=1===i?1:0,o=2===i?1:0;for(let i=0;i<t[0];i++){const s=t[1]*i;for(let i=r;i<t[1];i++){const r=t[2]*(i+s);for(let i=o;i<t[2];i++){const o=t[3]*(i+r);for(let i=0;i<t[3];i++){const t=o+i;e[t]+=e[t-n]}}}}n*=t[i]}return e}function Tx(e){for(let t=0,n=e.length;t<n;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function Ax(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const n=e[t],i=e[t+1];e[t]=(240&n)>>4|(61440&n)>>8|(240&i)<<4|61440&i,e[t+1]=15&n|(3840&n)>>4|(15&i)<<8|(3840&i)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const n=e[t],i=e[t+1],r=e[t+2],o=e[t+3];e[t+0]=(192&n)>>6|(192&i)>>4|(192&r)>>2|192&o,e[t+1]=(48&n)>>4|(48&i)>>2|48&r|(48&o)<<2,e[t+2]=(12&n)>>2|12&i|(12&r)<<2|(12&o)<<4,e[t+3]=3&n|(3&i)<<2|(3&r)<<4|(3&o)<<6}return e;default:throw new Error('Invalid pixel format, "'.concat(t,'"'))}}Xo(px,"DEMData"),Xo(lx,"DemMinMaxQuadTree",{omit:["dem"]});var Sx=Uint8Array,Dx=Uint16Array,Cx=Int32Array,Ix=new Sx([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Rx=new Sx([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Px=new Sx([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Mx=function(e,t){for(var n=new Dx(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new Cx(n[30]);for(i=1;i<30;++i)for(var o=n[i];o<n[i+1];++o)r[o]=o-n[i]<<5|i;return{b:n,r:r}},Fx=Mx(Ix,2),Lx=Fx.b,kx=Fx.r;Lx[28]=258,kx[258]=28;for(var Ox=Mx(Rx,0).b,Bx=new Dx(32768),zx=0;zx<32768;++zx){var Nx=(43690&zx)>>1|(21845&zx)<<1;Bx[zx]=((65280&(Nx=(61680&(Nx=(52428&Nx)>>2|(13107&Nx)<<2))>>4|(3855&Nx)<<4))>>8|(255&Nx)<<8)>>1}var Ux=function(e,t,n){for(var i=e.length,r=0,o=new Dx(t);r<i;++r)e[r]&&++o[e[r]-1];var s,a=new Dx(t);for(r=1;r<t;++r)a[r]=a[r-1]+o[r-1]<<1;s=new Dx(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],u=t-e[r],h=a[e[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)s[Bx[h]>>l]=c;return s},Vx=new Sx(288);for(zx=0;zx<144;++zx)Vx[zx]=8;for(zx=144;zx<256;++zx)Vx[zx]=9;for(zx=256;zx<280;++zx)Vx[zx]=7;for(zx=280;zx<288;++zx)Vx[zx]=8;var jx=new Sx(32);for(zx=0;zx<32;++zx)jx[zx]=5;var Gx=Ux(Vx,9),Hx=Ux(jx,5),Wx=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},qx=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},Xx=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Zx=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Yx=function(e,t,n){var i=new Error(t||Zx[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,Yx),!n)throw i;return i},Kx=new Sx(0),Jx="undefined"!=typeof TextDecoder&&new TextDecoder;try{Jx.decode(Kx,{stream:!0})}catch(e){}const Qx={gzip_data:"gzip"};class $x extends Error{constructor(e){super(e),this.name="MRTError"}}const eb={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},tb={uint32:1,uint16:2,uint8:4},nb={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let ib;class rb{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const t=this.layers[e];if(!t)throw new $x("Layer '".concat(e,"' not found"));return t}getHeaderLength(e){const t=new Uint8Array(e),n=new DataView(e);if(13!==t[0])throw new $x("File is not a valid MRT.");return n.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),n=this.getHeaderLength(e);if(t.length<n)throw new $x("Expected header with length >= ".concat(n," but got buffer of length ").concat(t.length));const i=new ib(t.subarray(0,n)).readFields(mx,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==i.x||this.y!==i.y||this.z!==i.z))throw new $x("Invalid attempt to parse header ".concat(i.z,"/").concat(i.x,"/").concat(i.y," for tile ").concat(this.z,"/").concat(this.x,"/").concat(this.y));this.x=i.x,this.y=i.y,this.z=i.z;for(const r of i.layers)this.layers[r.name]=new ob(r,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],n=this.getLayer(e.layerName);for(let i of e.blockIndices){const r=n.dataIndex[i],o=r.firstByte-e.firstByte,s=r.lastByte-e.firstByte;if(n._blocksInProgress.has(i))continue;const a={layerName:n.name,firstByte:o,lastByte:s,pixelFormat:n.pixelFormat,blockIndex:i,blockShape:[r.bands.length].concat(n.bandShape),buffer:n.buffer,codec:r.codec.codec,filters:r.filters.map(e=>e.filter)};n._blocksInProgress.add(i),t.push(a)}return new sb(t,()=>{t.forEach(e=>n._blocksInProgress.delete(e.blockIndex))},(e,i)=>{if(t.forEach(e=>n._blocksInProgress.delete(e.blockIndex)),e)throw e;i.forEach(e=>{this.getLayer(e.layerName).processDecodedData(e)})})}}class ob{constructor(e,t){let{version:n,name:i,units:r,tileSize:o,pixelFormat:s,buffer:a,dataIndex:l}=e;if(this.version=n,1!==this.version)throw new $x("Cannot parse raster layer encoded with MRT version ".concat(n));this.name=i,this.units=r,this.tileSize=o,this.buffer=a,this.pixelFormat=eb[s],this.dataIndex=l,this.bandShape=[o+2*a,o+2*a,tb[this.pixelFormat]],this._decodedBlocks=new tx(t?t.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return tb[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(e=>{let{bands:t}=e;return t}).flat()}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.put(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[n,i]of this.dataIndex.entries()){for(const[r,o]of i.bands.entries())if(o===e)return{bandIndex:t+r,blockIndex:n,blockBandIndex:r};t+=i.bands.length}break;case"number":for(const[n,i]of this.dataIndex.entries()){if(e>=t&&e<t+i.bands.length)return{bandIndex:e,blockIndex:n,blockBandIndex:e-t};t+=i.bands.length}break;default:throw new $x("Invalid band `".concat(JSON.stringify(e),"`. Expected string or integer."))}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let t=1/0,n=-1/0;const i=[],r=new Set;for(const o of e){const{blockIndex:e}=this.getBlockForBand(o);if(e<0)throw new $x("Invalid band: ".concat(JSON.stringify(o)));const s=this.dataIndex[e];i.includes(e)||i.push(e),r.add(e),t=Math.min(t,s.firstByte),n=Math.max(n,s.lastByte)}if(r.size>this.cacheSize)throw new $x("Number of blocks to decode (".concat(r.size,") exceeds cache size (").concat(this.cacheSize,")."));return{layerName:this.name,firstByte:t,lastByte:n,blockIndices:i}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:n}=this.getBlockForBand(e);if(t<0)throw new $x("Band not found: ".concat(JSON.stringify(e)));const i=this._decodedBlocks.get(t.toString());if(!i)throw new $x("Data for band ".concat(JSON.stringify(e),' of layer "').concat(this.name,'" not decoded.'));const r=this.dataIndex[t],o=this.bandShape.reduce((e,t)=>e*t,1),s=n*o,a=i.subarray(s,s+o);return{data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:r.offset,scale:r.scale}}}rb.setPbf=function(e){ib=e};class sb{constructor(e,t,n){this.tasks=e,this._onCancel=t,this._onComplete=n,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}rb.performDecoding=function(e,t){const n=new Uint8Array(e);return Promise.all(t.tasks.map(e=>{const{layerName:t,firstByte:i,lastByte:r,pixelFormat:o,blockShape:s,blockIndex:a,filters:l,codec:c}=e,u=n.subarray(i,r+1),h=new Uint32Array(s[0]*s[1]*s[2]);let d;if("gzip_data"!==c)throw new $x("Unhandled codec: ".concat(c));return d=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((o=function(e){31==e[0]&&139==e[1]&&8==e[2]||Yx(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=2+(e[10]|e[11]<<8));for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[n++]);return n+(2&t)}(r=e))+8>r.length&&Yx(6,"invalid gzip data"),function(e,t,n){var i=e.length;if(!i||t.f&&!t.l)return n||new Sx(0);var r=!n,o=r||2!=t.i,s=t.i;r&&(n=new Sx(3*i));var a,l,c=function(e){var t=n.length;if(e>t){var i=new Sx(Math.max(2*t,e));i.set(n),n=i}},u=t.f||0,h=t.p||0,d=t.b||0,f=t.l,p=t.d,m=t.m,g=t.n,_=8*i;do{if(!f){u=qx(e,h,1);var y=qx(e,h+1,3);if(h+=3,!y){var v=e[(R=4+((h+7)/8|0))-4]|e[R-3]<<8,x=R+v;if(x>i){s&&Yx(0);break}o&&c(d+v),n.set(e.subarray(R,x),d),t.b=d+=v,t.p=h=8*x,t.f=u;continue}if(1==y)f=Gx,p=Hx,m=9,g=5;else if(2==y){var b=qx(e,h,31)+257,w=qx(e,h+10,15)+4,E=b+qx(e,h+5,31)+1;h+=14;for(var T=new Sx(E),A=new Sx(19),S=0;S<w;++S)A[Px[S]]=qx(e,h+3*S,7);h+=3*w;var D=Wx(A),C=(1<<D)-1,I=Ux(A,D);for(S=0;S<E;){var R,P=I[qx(e,h,C)];if(h+=15&P,(R=P>>4)<16)T[S++]=R;else{var M=0,F=0;for(16==R?(F=3+qx(e,h,3),h+=2,M=T[S-1]):17==R?(F=3+qx(e,h,7),h+=3):18==R&&(F=11+qx(e,h,127),h+=7);F--;)T[S++]=M}}var L=T.subarray(0,b),k=T.subarray(b);m=Wx(L),g=Wx(k),f=Ux(L,m),p=Ux(k,g)}else Yx(1);if(h>_){s&&Yx(0);break}}o&&c(d+131072);for(var O=(1<<m)-1,B=(1<<g)-1,z=h;;z=h){var N=(M=f[Xx(e,h)&O])>>4;if((h+=15&M)>_){s&&Yx(0);break}if(M||Yx(2),N<256)n[d++]=N;else{if(256==N){z=h,f=null;break}var U=N-254;N>264&&(U=qx(e,h,(1<<(G=Ix[S=N-257]))-1)+Lx[S],h+=G);var V=p[Xx(e,h)&B],j=V>>4;if(V||Yx(3),h+=15&V,k=Ox[j],j>3){var G=Rx[j];k+=Xx(e,h)&(1<<G)-1,h+=G}if(h>_){s&&Yx(0);break}o&&c(d+131072);var H=d+U;if(d<k){var W=0-k,q=Math.min(k,H);for(W+d<0&&Yx(3);d<q;++d)n[d]=(void 0)[W+d]}for(;d<H;++d)n[d]=n[d-k]}}t.l=f,t.p=z,t.b=d,t.f=u,f&&(u=1,t.m=m,t.d=p,t.n=g)}while(!u);return d!=n.length&&r?(a=n,(null==(l=d)||l>a.length)&&(l=a.length),new Sx(a.subarray(0,l))):n.subarray(0,d)}(r.subarray(o,-8),{i:2},new Sx(((n=r)[(i=n.length)-4]|n[i-3]<<8|n[i-2]<<16|n[i-1]<<24)>>>0))));var n,i,r,o;const s=Qx[t];if(!s)throw new Error("Unhandled codec: ".concat(t));const a=new globalThis.DecompressionStream(s);return new Response(new Blob([e]).stream().pipeThrough(a)).arrayBuffer().then(e=>new Uint8Array(e))}(u,c).then(e=>(function(e,t){e.readFields(bx,t)}(new ib(e),h),new(0,nb[o])(h.buffer))),d.then(e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":Ex(e,s);break;case"zigzag_filter":Tx(e);break;case"bitshuffle_filter":Ax(e,o);break;default:throw new $x('Unhandled filter "'.concat(l[t],'"'))}return{layerName:t,blockIndex:a,data:e}}).catch(e=>{throw e})}))},Xo(sb,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Xo(rb,"MapboxRasterTile"),Xo(ob,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class ab{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const lb=["id","tile","layer","source","sourceLayer","state"];class cb{constructor(e,t,n,i,r){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=i,this.properties=e.properties,this.id=r}clone(){const e=new cb(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const t of lb)void 0!==this[t]&&(e[t]=this[t]);return e}}class ub{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Wo(Li,16,0),this.featureIndexArray=new Za,this.promoteId=t,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r,o);const l=this.grid;for(let c=0;c<t.length;c++){const e=t[c],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const i=e[t];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}0!==s&&(n[0]-=s,n[1]-=s,n[2]+=s,n[3]+=s),n[0]<Li&&n[1]<Li&&n[2]>=0&&n[3]>=0&&l.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Tc(new Qm(this.rawTileData)).layers,this.sourceLayerCoder=new ab(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t){var n=this;const{tilespaceGeometry:i,transform:r,tileTransform:o,pixelPosMatrix:s,availableImages:a,worldview:l}=t;this.loadVTLayers(),this.serializedLayersCache.clear();const c=i.bufferedTilespaceBounds,u=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,(e,t,n,r)=>ou(i.bufferedTilespaceGeometry,e,t,n,r));u.sort(db);let h=null;r.elevation&&u.length>0&&(h=Yy.create(r.elevation,this.tileID));const d={};let f;for(let p=0;p<u.length;p++){const t=u[p];if(t===f)continue;f=t;const c=this.featureIndexArray.get(t);let m=null;this.is3DTile?this.loadMatchingModelFeature(d,c,e,i,r,l):this.loadMatchingFeature(d,c,e,a,l,function(e,t,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return m||(m=_c(e,n.tileID.canonical,o)),t.queryIntersectsFeature(i,e,a,m,n.z,r,s,h,l)})}return d}loadMatchingFeature(e,t,n,i,r,o){const{featureIndex:s,bucketIndex:a,sourceLayerIndex:l,layoutVertexArrayOffset:c}=t,u=this.bucketLayerIDs[a],h=n.layers,d=Object.keys(h);if(d.length&&!je(d,u))return;const f=n.sourceCache,p=this.sourceLayerCoder.decode(l),m=this.vtLayers[p].feature(s),g=this.getId(m,p);for(let _=0;_<u.length;_++){const t=u[_];if(!h[t])continue;const{styleLayer:n,targets:a}=h[t];let l={};void 0!==g&&(l=f.getFeatureState(n.sourceLayer,g));const d=!o||o(m,n,l,c);if(!d)continue;const p=new cb(m,this.z,this.x,this.y,g);p.tile=this.tileID.canonical,p.state=l;let y=this.serializedLayersCache.get(t);y||(y=n.serialize(),y.id=t,this.serializedLayersCache.set(t,y)),p.source=y.source,p.sourceLayer=y["source-layer"],p.layer=Le({},y),p.layer.paint=hb(y.paint,n.paint,m,l,i),p.layer.layout=hb(y.layout,n.layout,m,l,i);let v=!1;for(const e of a){this.updateFeatureProperties(p,e);const{filter:t}=e;if(t)if(m.properties=p.properties,t.needGeometry){const e=yc(m,!0);if(!t.filter(new ys(this.tileID.overscaledZ,{worldview:r}),e,this.tileID.canonical))continue}else if(!t.filter(new ys(this.tileID.overscaledZ,{worldview:r}),m))continue;v=!0,e.targetId&&this.addFeatureVariant(p,e)}v&&this.appendToResult(e,t,s,p,d)}}loadMatchingModelFeature(e,t,n,i,r,o){const{featureIndex:s,bucketIndex:a}=t,l=this.bucketLayerIDs[a],c=n.layers,u=Object.keys(c);if(!u.length||je(u,l))for(let h=0;h<l.length;h++){const t=l[h],{styleLayer:a,targets:u}=c[t];if("model"!==a.type)continue;const d=i.tile,f=d.getBucket(a);if(!(f&&f instanceof nv))continue;const p=av(f,s,i,r);if(!p)continue;const{z:m,x:g,y:_}=d.tileID.canonical,{feature:y,intersectionZ:v,position:x}=p;let b={};void 0!==y.id&&(b=n.sourceCache.getFeatureState(a.sourceLayer,y.id));const w=new cb({},m,g,_,y.id);w.tile=this.tileID.canonical,w.state=b,w.properties=y.properties,w.geometry={type:"Point",coordinates:[x.lng,x.lat]};let E=this.serializedLayersCache.get(t);E||(E=a.serialize(),E.id=t,this.serializedLayersCache.set(t,E)),w.source=E.source,w.sourceLayer=E["source-layer"],w.layer=Le({},E);let T=!1;for(const e of u){this.updateFeatureProperties(w,e);const{filter:t}=e;if(t)if(y.properties=w.properties,t.needGeometry){if(!t.filter(new ys(this.tileID.overscaledZ,{worldview:o}),y,this.tileID.canonical))continue}else if(!t.filter(new ys(this.tileID.overscaledZ,{worldview:o}),y))continue;T=!0,e.targetId&&this.addFeatureVariant(w,e)}T&&this.appendToResult(e,t,s,w,v)}}updateFeatureProperties(e,t,n){if(t.properties){const i={};for(const r in t.properties){const o=t.properties[r].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,n);null!=o&&(i[r]=o)}e.properties=i}}addFeatureVariant(e,t,n){const i={target:t.target,namespace:t.namespace,uniqueFeatureID:t.uniqueFeatureID};t.properties&&(i.properties=e.properties),e.variants=e.variants||{},e.variants[t.targetId]=e.variants[t.targetId]||[],e.variants[t.targetId].push(i)}appendToResult(e,t,n,i,r){let o=e[t];void 0===o&&(o=e[t]=[]),o.push({featureIndex:n,feature:i,intersectionZ:r})}lookupSymbolFeatures(e,t,n,i,r,o){const s={};this.loadVTLayers();for(const a of e)this.loadMatchingFeature(s,{bucketIndex:t,sourceLayerIndex:n,featureIndex:a,layoutVertexArrayOffset:0},i,r,o);return s}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const i=this.sourceLayerCoder.decode(n),r=this.vtFeatures[i];if(r[t])return r[t];const o=this.vtLayers[i].feature(t);return r[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;if(this.promoteId){const i=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[t];if(null!=i)if(Array.isArray(i)){if(!this.promoteIdExpression){const e=Oo(i);if("success"!==e.result){const t=e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", ");return void He("Failed to create expression for promoteId: ".concat(t))}this.promoteIdExpression=e.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Qn),n=this.promoteIdExpression.evaluate({zoom:0},e)}else n=e.properties[i];"boolean"==typeof n&&(n=Number(n))}return n}}function hb(e,t,n,i,r){return Ne(e,(e,o)=>{const s=t instanceof Ss?t.get(o):null;return s&&s.evaluate?s.evaluate(n,i,void 0,r):s})}function db(e,t){return t-e}Xo(ub,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const fb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error("Got v".concat(i," data when expected v1."));const r=fb[15&n];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new pb(s,o,r,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,i=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=fb.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error("Unexpected typed array class: ".concat(n,"."));i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return mb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=n&&c>=t&&c<=i&&l.push(r[s])}continue}const d=h+u>>1,f=o[2*d],p=o[2*d+1];f>=e&&f<=n&&p>=t&&p<=i&&l.push(r[d]),(0===c?e<=f:t<=p)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?n>=f:i>=p)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:o}=this,s=[0,i.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)vb(r[2*n],r[2*n+1],e,t)<=l&&a.push(i[n]);continue}const d=h+u>>1,f=r[2*d],p=r[2*d+1];vb(f,p,e,t)<=l&&a.push(i[d]),(0===c?e-n<=f:t-n<=p)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+n>=f:t+n>=p)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function mb(e,t,n,i,r,o){if(r-i<=n)return;const s=i+r>>1;gb(e,t,s,i,r,o),mb(e,t,n,i,s-1,1-o),mb(e,t,n,s+1,r,1-o)}function gb(e,t,n,i,r,o){for(;r>i;){if(r-i>600){const s=r-i+1,a=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);gb(e,t,n,Math.max(i,Math.floor(n-a*c/s+u)),Math.min(r,Math.floor(n+(s-a)*c/s+u)),o)}const s=t[2*n+o];let a=i,l=r;for(_b(e,t,i,n),t[2*r+o]>s&&_b(e,t,i,r);a<l;){for(_b(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*i+o]===s?_b(e,t,i,l):(l++,_b(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function _b(e,t,n,i){yb(e,n,i),yb(t,2*n,2*i),yb(t,2*n+1,2*i+1)}function yb(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function vb(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}e.$=$n,e.A=Kt,e.B=On,e.C=Zs,e.D=Ff,e.E=en,e.F=2,e.G=Zg,e.H=qg,e.I=tn,e.J=Zn,e.K=class extends jy{},e.L=fn,e.M=Ms,e.N=Ao,e.O=wo,e.P=xe,e.Q=To,e.R=Mt,e.S=ko,e.T=fp,e.U=Fs,e.V=jy,e.W=No,e.X=Oo,e.Y=dr,e.Z=pr,e._=hr,e.a=function(e){return it.API_CDN_URL_REGEX.test(e)},e.a$=Oe,e.a0=on,e.a1=Ls,e.a2=So,e.a3=Eo,e.a4=function(e){const t=e.value;let n=[];if(!t)return n;const i=Zn(t);return"string"!==i?(n=n.concat([new jy(e.key,t,'string expected, "'.concat(i,'" found'))]),n):(Gy(t,!0)||(n=n.concat([new jy(e.key,t,'invalid url "'.concat(t,'"'))])),n)},e.a5=Ps,e.a6=bs,e.a7=Rs,e.a8=Ds,e.a9=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return Xe(e.expression.evaluate(t))}interpolate(e,t,n){return{x:un(e.x,t.x,n),y:un(e.y,t.y,n),z:un(e.z,t.z,n),azimuthal:un(e.azimuthal,t.azimuthal,n),polar:un(e.polar,t.polar,n)}}},e.aA=K,e.aB=kl,e.aC=ru,e.aD=Ql,e.aE=hc,e.aF=function(e,t){const n={};for(let i=0;i<t.length;i++){const r=t[i];r in e&&(n[r]=e[r])}return n},e.aG=Zl,e.aH=$l,e.aI=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,i){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,n]=r.result;return this.scheduler?this.scheduler.add(()=>{i(e,n)},t):i(e,n),()=>{}}return r.callbacks.push(i),r.cancel||(r.cancel=n((n,i)=>{r.result=[n,i];for(const e of r.callbacks)this.scheduler?this.scheduler.add(()=>{e(n,i)},t):e(n,i);setTimeout(()=>delete this.entries[e],3e3)})),()=>{r.result||(r.callbacks=r.callbacks.filter(e=>e!==i),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}},e.aJ=function(e,t,n){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},t=>{const i=Ot(e.request,(e,i,r,o)=>{e?t(e):i&&t(null,{vectorTile:n?void 0:new Tc(new Qm(i)),rawData:i,cacheControl:r,expires:o})});return()=>{i.cancel(),t()}},t)},e.aK=function(e){Tt++,Tt>yt&&(e.getActor().send("enforceCacheSizeLimit",_t),Tt=0)},e.aL=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.aM=yu,e.aN=My,e.aO=zy,e.aP=Ry,e.aQ=function(e,t){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let i=0;i<e.length;i++){const t=document.createElement("source");Bt(e[i])||(n.crossOrigin="Anonymous"),t.src=e[i],n.appendChild(t)}return{cancel:()=>{}}},e.aR=pp,e.aS=function(e){return fetch(e).then(e=>e.arrayBuffer()).then(t=>up(t,0,e))},e.aT=Xp,e.aU=class{constructor(e,t,n,i){this.id=e,this.position=null!=t?new Xl(t[0],t[1]):new Xl(0,0),this.orientation=null!=n?n:[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new Vc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(u(e.matrix,t,e.matrix),e.meshes)for(const n of e.meshes){const t=Vc.applyTransformFast(n.aabb,e.matrix);this.aabb.encapsulate(t)}if(e.children)for(const n of e.children)this._applyTransformations(n,e.matrix)}computeBoundsAndApplyParent(){const e=l([]);for(const t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Lp(this.matrix,this,e.transform,this.position,t,n,i,r,o,s)}upload(e){if(!this.uploaded){for(const t of this.nodes)Bp(t,e);for(const e of this.nodes)zp(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)Np(e)}},e.aV=ze,e.aW=O_,e.aX=tc,e.aY=nc,e.aZ=oa,e.a_=Ta,e.aa=ys,e.ab=zo,e.ac=cc,e.ad=N,e.ae=w,e.af=Pe,e.ag=Ss,e.ah=Hu,e.ai=un,e.aj=Li,e.ak=hn,e.al=Te,e.am=sn,e.an=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,n]=e;const i=Xe([1,t,n]);return{x:i.x,y:i.y,z:i.z}}(e.expression.evaluate(t))}interpolate(e,t,n){return{x:un(e.x,t.x,n),y:un(e.y,t.y,n),z:un(e.z,t.z,n)}}},e.ao=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=new xe(n,n),o=e.sub(r),s=t.add(r),a=[o,new xe(s.x,o.y),s,new xe(o.x,s.y)];return i&&a.push(o.clone()),a},e.ap=function(e,t){const n=[];for(let i=0;i<e.length;i++){const r=Me(i-1,-1,e.length-1),o=Me(i+1,-1,e.length-1),s=e[i],a=e[o],l=e[r].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));n.push(s.add(h))}return n},e.aq=B_,e.ar=ou,e.as=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return E(((t.x-n)*e.scale-e.x)*Li,(t.y*e.scale-e.y)*Li,ic(t.z,t.y))},e.at=H,e.au=k,e.av=Lc,e.aw=Em,e.ax=function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),i=Math.max(i,o.x),r=Math.max(r,o.y);return{min:new xe(t,n),max:new xe(i,r)}},e.ay=Re,e.az=u,e.b=function(e){return it.API_FONTS_REGEX.test(e)},e.b$=A_,e.b0=Ua,e.b1=my,e.b2=function(){_s.isLoading()||_s.isLoaded()||"deferred"!==ms()||gs()},e.b3=ks,e.b4=yc,e.b5=cb,e.b6=Ye,e.b7=vm,e.b8=cd,e.b9=_c,e.bA=function(e,t){const{x:n,y:i}=e.point,r=Gu(n,i,e.worldSize/e._pixelsPerMercatorPixel,0,0);return u(r,r,Uu(Ru(t)))},e.bB=i,e.bC=j,e.bD=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},e.bE=P,e.bF=B,e.bG=O,e.bH=Bg,e.bI=mg,e.bJ=Og,e.bK=function(e,t,n,i,r){const o=5*t+2;e.float32[o+0]=n,e.float32[o+1]=i,e.float32[o+2]=r},e.bL=hy,e.bM=ae,e.bN=ue,e.bO=le,e.bP=ge,e.bQ=Me,e.bR=function(e,t,i,r){var o=new n(4);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o},e.bS=bf,e.bT=Xc,e.bU=Hm,e.bV=Sd,e.bW=Vy,e.bX=kd,e.bY=Od,e.bZ=Sg,e.b_=__,e.ba=ia,e.bb=La,e.bc=Tu,e.bd=tl,e.be=vh,e.bf=Sy,e.bg=function(e,t){const n=Hu(t.zoom);if(0===n)return Ru(e);const i=Lu(e),r=ku(i),o=Ql(i.getWest())*t.worldSize,s=Ql(i.getEast())*t.worldSize,a=$l(i.getNorth())*t.worldSize,l=$l(i.getSouth())*t.worldSize,u=[o,a,0],h=[s,a,0],d=[o,l,0],f=[s,l,0],p=c([],t.globeMatrix);return N(u,u,p),N(h,h,p),N(d,d,p),N(f,f,p),r[0]=Pu(r[0],d,n),r[1]=Pu(r[1],f,n),r[2]=Pu(r[2],h,n),r[3]=Pu(r[3],u,n),Vc.fromPoints(r)},e.bh=Nu,e.bi=c,e.bj=Ou,e.bk=Pu,e.bl=ra,e.bm=Eu,e.bn=g,e.bo=h,e.bp=rb,e.bq=Qm,e.br=Ot,e.bs=function(e,t){const n=[];for(const i in e)i in t||n.push(i);return n},e.bt=Fe,e.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.bv=be,e.bw=function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.bx=l,e.by=m,e.bz=a,e.c=ot,e.c$=45,e.c0=pb,e.c1=R,e.c2=q,e.c3=Q,e.c4=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},e.c5=$,e.c6=Je,e.c7=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.c8=y,e.c9=function(e,t,n,i,r){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+i)*(o=1/(i-r)),e[14]=2*r*i*o):(e[10]=-1,e[14]=-2*i),e},e.cA=gu,e.cB=Fu,e.cC=function(e,t,n,i,r,o,s,a,l){if("globe"===l.name)return Fu(e,t,new gu(n,i,r),!1);const c=O_({z:n,x:i,y:r},l);return new Vc([(o+c.x/c.scale)*t,t*(c.y/c.scale),s],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),a])},e.cD=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},e.cE=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},e.cF=function(e){const t=Math.round((e+45+360)%360/90)%4;return Se[t]},e.cG=rc,e.cH=Z,e.cI=Bl,e.cJ=function(e){const t=l(new Float64Array(16));u(t,e.pixelMatrix,e.globeMatrix);const n=[0,Vl,0],i=[0,jl,0];return N(n,n,t),N(i,i,t),[n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!qu(e,new Xl(e.center.lat,90)),i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!qu(e,new Xl(e.center.lat,-90))]},e.cK=function(e,t){const{scale:n}=e.tileTransform,i=n*Li/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return function(e,t,n){var i=t[1],r=t[2],o=t[3],s=n[0],a=n[1];return e[0]=t[0]*s,e[1]=i*s,e[2]=r*a,e[3]=o*a,e}(new Float32Array(4),t.inverseAdjustmentMatrix,[i,i])},e.cL=Tp,e.cM=v,e.cN=wp,e.cO=function(e){const t=wp(e,!0);return i([],[t[0],t[1],t[4],t[5]])},e.cP=d,e.cQ=kc,e.cR=f,e.cS=function(e){const{x:t,y:n}=e.point,{lng:i,lat:r}=e._center;return Gu(t,n,e.worldSize,i,r)},e.cT=D,e.cU=Ae,e.cV=vu,e.cW=su,e.cX=Ol,e.cY=function(e,t,n){let i=0;for(let r=0;r<2;++r){const n=0;e[r]>n&&(i+=(e[r]-n)*(e[r]-n)),t[r]<n&&(i+=(n-t[r])*(n-t[r]))}return i},e.cZ=function(e){return e*e*e*e*e},e.c_=Jl,e.ca=function(e,t,n,i,r,o,s){var a=1/(t-n),l=1/(i-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1,e},e.cb=ec,e.cc=function(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},e.cd=hl,e.ce=pl,e.cf=dl,e.cg=fl,e.ch=yl,e.ci=Xl,e.cj=ry,e.ck=function(){var e=new n(4);return n!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.cl=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=i*-a+o*l,e[3]=r*-a+s*l,e},e.cm=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.cn=G,e.co=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.cp=re,e.cq=V,e.cr=_u,e.cs=3,e.ct=2,e.cu=7,e.cv=6,e.cw=z,e.cx=x,e.cy=Uc,e.cz=Ep,e.d=function(e){return it.API_TILEJSON_REGEX.test(e)},e.d$=(e,t,n,i,r,o,s,a,l,c)=>{const u=e.transform,h=u.calculatePixelsToTileUnitsMatrix(t),d="none"===n.paint.get("line-trim-color-use-theme").constantOr("default"),f=u.pitch<15?Tm(.07,.7,Re((14-u.zoom)/5,0,1)):.07;return{u_matrix:Sm(e,t,n,i),u_pixels_to_tile_units:h,u_device_pixel_ratio:o,u_width_scale:s,u_floor_width_scale:a,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:Cm(n)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Am(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:l,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(d?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:f,u_tile_to_meter:lc(t.tileID.canonical,0),u_ground_shadow_factor:c}},e.d0=ml,e.d1=function(e,t,n){const i=Math.sqrt(e*e+t*t+n*n),r=i>0?Math.acos(n/i)*Ee:0;let o=0!==e||0!==t?Math.atan2(-t,-e)*Ee+90:0;return o<0&&(o+=360),[i,o,r]},e.d2=E,e.d3=Xe,e.d4=lc,e.d5=A,e.d6=Vc,e.d7=S,e.d8=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.d9=Gy,e.dA=Lu,e.dB=function(e){const t=rc-5;e=Re(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(Te(e))),3);return Math.round(n*(Ul.length-1))},e.dC=function(e,t,n,i){const r=t.getNorth(),o=t.getSouth(),a=t.getWest(),l=t.getEast(),c=1<<e.z,u=l-a,h=r-o,d=u/Nl,f=-h/Ul[n],p=[0,d,0,f,0,0,r,a,0];if(e.z>0){const e=180/i;s(p,p,[e/u+1,0,0,0,e/h+1,0,-.5*e/d,.5*e/f,1])}return p[2]=c,p[5]=e.x,p[8]=e.y,p},e.dD=Ru,e.dE=function(e,t,n){const i=l(new Float64Array(16)),r=(t/(1<<e)-.5)*Math.PI*2;return p(i,n.globeMatrix,r),Float32Array.from(i)},e.dF=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const n=t.getSource().maxzoom,i=1<<n,r=Math.floor(e.x),o=Math.floor((e.x-r)*i),s=Math.floor(e.y*i),a=this.findDEMTileFor(new yu(n,r,n,o,s));return!(!a||!a.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const i=this._source();if(!i)return t;if(e.y<0||e.y>1)return t;const r=i.getSource().maxzoom,o=1<<r,s=Math.floor(e.x),a=e.x-s,l=new yu(r,s,r,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,f=(e.y*h-c.tileID.canonical.y)*u.dim,p=Math.floor(d),m=Math.floor(f);return(n?this.exaggeration():1)*un(un(u.get(p,m),u.get(p,m+1),f-m),un(u.get(p+1,m),u.get(p+1,m+1),f-m),d-p)}getAtTileOffset(e,t,n){const i=1<<e.canonical.z;return this.getAtPointOrZero(new cc(e.wrap+(e.canonical.x+t/Li)/i,(e.canonical.y+n/Li)/i))}getAtTileOffsetFunc(e,t,n,i){return r=>{const o=this.getAtTileOffset(e,r.x,r.y),s=i.upVector(e.canonical,r.x,r.y);return R(s,s,o*i.upVectorScale(e.canonical,t,n).metersToTile),s}}getForTilePoints(e,t,n,i){if(this.isUsingMockSource())return!1;const r=Yy.create(this,e,i);return!!r&&(t.forEach(e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],n)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,i=t.tileID,r=1<<e.canonical.z-i.canonical.z;let o=e.canonical.x/r-i.canonical.x,s=e.canonical.y/r-i.canonical.y,a=0;for(let l=0;l<e.canonical.z-i.canonical.z&&!n.leaves[a];l++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=n.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*n.minimums[a],max:this.exaggeration()*n.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,n=Number.MAX_VALUE,i=Number.MIN_VALUE;for(const r of e){const e=this.getMinMaxForTile(r.tileID);e&&(n=Math.min(n,e.min),i=Math.max(i,e.max),t=!0)}return t?{min:n,max:i}:null}},e.dG=fh,e.dH=Au,e.dI=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.dJ=r,e.dK=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.dL=U,e.dM=ju,e.dN=et,e.dO=tt,e.dP=256,e.dQ=function(e,t){const n=[0,0,0];return N(n,n,Nu(Ru(t.canonical))),N(n,n,e),n},e.dR=e=>({u_matrix:new yl(e),u_texsize:new fl(e),u_pixels_to_tile_units:new bl(e),u_device_pixel_ratio:new dl(e),u_width_scale:new dl(e),u_floor_width_scale:new dl(e),u_image:new hl(e),u_units_to_pixels:new fl(e),u_tile_units_to_pixels:new dl(e),u_alpha_discard_threshold:new dl(e),u_trim_offset:new fl(e),u_trim_fade_range:new fl(e),u_trim_color:new ml(e),u_emissive_strength:new dl(e),u_zbias_factor:new dl(e),u_tile_to_meter:new dl(e),u_ground_shadow_factor:new pl(e),u_pattern_transition:new dl(e)}),e.dS=e=>({u_matrix:new yl(e),u_pixels_to_tile_units:new bl(e),u_device_pixel_ratio:new dl(e),u_width_scale:new dl(e),u_floor_width_scale:new dl(e),u_units_to_pixels:new fl(e),u_dash_image:new hl(e),u_gradient_image:new hl(e),u_image_height:new dl(e),u_texsize:new fl(e),u_tile_units_to_pixels:new dl(e),u_alpha_discard_threshold:new dl(e),u_trim_offset:new fl(e),u_trim_fade_range:new fl(e),u_trim_color:new ml(e),u_emissive_strength:new dl(e),u_zbias_factor:new dl(e),u_tile_to_meter:new dl(e),u_ground_shadow_factor:new pl(e)}),e.dT=e=>({u_camera_to_center_distance:new dl(e),u_extrude_scale:new bl(e),u_device_pixel_ratio:new dl(e),u_matrix:new yl(e),u_inv_rot_matrix:new yl(e),u_merc_center:new fl(e),u_tile_id:new pl(e),u_zoom_transition:new dl(e),u_up_dir:new pl(e),u_emissive_strength:new dl(e)}),e.dU=wa,e.dV=Gm,e.dW=Ju,e.dX=(e,t,n,i,r,o)=>{const s=e.transform,a="globe"===s.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(a){const e=ju(s.zoom,t.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=s.calculatePixelsToTileUnitsMatrix(n);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(s.projection),u_matrix:e.translatePosMatrix(t.projMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ft.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Ku,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=i,c.u_merc_center=r,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=Hu(s.zoom);const e=r[0]*Li,n=r[1]*Li;c.u_up_dir=s.projection.upVector(new gu(0,0,0),e,n)}return c},e.dY=Dm,e.dZ=Bn,e.d_=(e,t,n,i,r,o,s,a,l,c)=>{const u=e.transform,h=u.pitch<15?Tm(.07,.7,Re((14-u.zoom)/5,0,1)):.07,d="none"===n.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:Sm(e,t,n,i),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:u.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:r,u_width_scale:o,u_floor_width_scale:s,u_image:0,u_tile_units_to_pixels:Am(t,u),u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:a,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(d?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:h,u_tile_to_meter:lc(t.tileID.canonical,0),u_ground_shadow_factor:l,u_pattern_transition:c}},e.da=function(e,t){return e.readFields(gv,{icons:[]},t)},e.db=Of,e.dc=n_,e.dd=t_,e.de=Lt,e.df=ds,e.dg=mt,e.dh=Yt,e.di=Ve,e.dj=function(e){const t=e.indexOf(Xs);return t>=0?e.slice(0,t):e},e.dk=function(e){return e.indexOf(Xs)>=0},e.dl=function(e){const t=e.lastIndexOf(Xs);return t>=0?e.slice(t+1):""},e.dm=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:"layers.".concat(n,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(n,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(n,': property "renderingMode" must be either "2d" or "3d"')}),t},e.dn=function(e,t,n,i){return"custom"===e.type?new Ny(e,t):new lv[e.type](e,t,n,i)},e.dp=Ue,e.dq=function(e){const t=e.indexOf(Xs);return t>=0?e.slice(t+1):""},e.dr=class extends cb{constructor(e,t){super(e._vectorTileFeature,e._z,e._x,e._y,e.id),e.state&&(this.state=Object.assign({},e.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=e.source,this.sourceLayer=e.sourceLayer,this.layer=e.layer)}toJSON(){const e=super.toJSON();return e.target=this.target,e.namespace=this.namespace,e}},e.ds=ps,e.dt=kt,e.du=function(e){return e({pluginStatus:us,pluginURL:hs}),ps.on("pluginStateChange",e),e},e.dv=gl,e.dw=class extends ul{constructor(e){super(e),this.current=vl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let i=0;i<9;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},e.dx=De,e.dy=function(e,t,n){const i=Hu(n.zoom),r=e.style.map._antialias,o=e.terrain&&e.terrain.exaggeration()>0;return 0===i&&!r&&!o},e.dz=function(e){const t=e.pixelsPerMeter,n=t/ec(1,e.center.lat),i=l(new Float64Array(16));return h(i,i,[e.point.x,e.point.y,0]),d(i,i,[n,n,t]),Float32Array.from(i)},e.e=it,e.e$=ms,e.e0=Be,e.e1=ph,e.e2=ic,e.e3=xu,e.e4=rf,e.e5=df,e.e6=Wd,e.e7=450,e.e8=7,e.e9=sc,e.eA=function(e,t,i,r,o,s,a,l,c,u,h,d,f,p,m,g){var _=new n(16);return _[0]=e,_[1]=t,_[2]=i,_[3]=r,_[4]=o,_[5]=s,_[6]=a,_[7]=l,_[8]=c,_[9]=u,_[10]=h,_[11]=d,_[12]=f,_[13]=p,_[14]=m,_[15]=g,_},e.eB=Wl,e.eC=Pa,e.eD=Ra,e.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new xe(1/0,1/0),max:new xe(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Pd(new xe(0,0),new xe(Li,Li),e),i=[];if(t&&!Id(n,this._globalClipBounds))return i;for(const r of this._activeRegions){if(r.hiddenByOverlap)continue;if(!Id(n,r))continue;const t=Md(r.min,r.max,e);i.push({min:t.min,max:t.max,sourceId:this._sourceIds[r.priority],footprint:r.footprint,footprintTileId:r.tileId,order:r.order,clipMask:r.clipMask,clipScope:r.clipScope})}return i}setSources(e){this._setSources(e.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const n of e.cache.getVisibleCoordinates()){const i=e.cache.getTile(n).buckets[e.layer];i&&i.updateFootprints(n.toUnwrapped(),t)}return t},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(e){const t=e.getFootprints();if(0===t.length)return;const n=e.getOrder(),i=e.getClipMask(),r=e.getClipScope();for(const o of t){if(!o.footprint)continue;const e=Pd(o.footprint.min,o.footprint.max,o.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:o.id,footprint:o.footprint,order:n,clipMask:i,clipScope:r})}this._sourceIds.push(e.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,t)=>e.priority-t.priority||Dd(e.min,t.min)||Dd(e.max,t.max)||e.order-t.order||e.clipMask-t.clipMask||function(e,t){const n=(e,t)=>e+t;return e.length-t.length||e.reduce(n,"").localeCompare(t.reduce(n,""))}(e.clipScope,t.clipScope));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0;for(;!e&&t!==this._activeRegions.length;){const n=this._activeRegions[t],i=this._prevRegions[t];e=n.priority!==i.priority||!Cd(n,i)||n.order!==i.order||n.clipMask!==i.clipMask||!be(n.clipScope,i.clipScope),++t}}if(e){++this._updateTime;for(const t of this._activeRegions)t.order!==Td&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,t.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,t.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,t.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,t.max.y));const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const n=t[e].priority;for(;e<t.length&&t[e].priority===n;)++e;return e};if(this._sourceIds.length>1){let t=0,n=e(t);for(;t!==n;){let i=t;const r=t;for(;i!==n;){const e=this._activeRegions[i];e.hiddenByOverlap=!1;for(let t=0;t<r;t++){const n=this._activeRegions[t];if(!n.hiddenByOverlap&&e.order===Td&&Id(e,n)&&(e.hiddenByOverlap=Ld(e.footprint,e.tileId,n.footprint,n.tileId),e.hiddenByOverlap))break}++i}t=n,n=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.eF=Td,e.eG=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const n=new ia,i=new Ta,r=[],o=e+1+2,s=t[0]+1,a=t[0]+1+(1+t.length),l=(e,t,n)=>{let i=e===o-1?e-2:0===e?e:e-1;return i+=n?24575:0,[i,t]};for(let c=0;c<o;++c)n.emplaceBack(...l(c,0,!0));for(let c=0;c<s;++c)for(let e=0;e<o;++e)n.emplaceBack(...l(e,c,(0===e||e===o-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<o;++t)n.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=i.length,s=t[c]+1+2,l=new Ta;for(let n=0;n<s-1;n++){const e=n===s-2,r=e?o*(a-t.length+c-n):o;for(let t=0;t<o-1;t++){const s=n*o+t;0===n||e||0===t||t===o-2?(l.emplaceBack(s+1,s,s+r),l.emplaceBack(s+r,s+r+1,s+1)):(i.emplaceBack(s+1,s,s+r),i.emplaceBack(s+r,s+r+1,s+1))}}const u=tl.simpleSegment(0,e,n.length,i.length-e);for(let t=0;t<l.uint16.length;t+=3)i.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const h=tl.simpleSegment(0,e,n.length,i.length-e);r.push({withoutSkirts:u,withSkirts:h})}return{vertices:n,indices:i,segments:r}}_createGrid(e){const t=this._fillGridMeshWithLods(Nl,Ul);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Tu.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Ta;for(let s=0;s<=Nl;s++)t.emplaceBack(0,s+1,s+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const n=new Ca,i=new Ca,r=new Ca,o=new Ca;this._poleSegments=[];for(let s=0,a=0;s<Ol;s++){const e=360/(1<<s);n.emplaceBack(0,-kl,0,.5,0),i.emplaceBack(0,-kl,0,.5,1),r.emplaceBack(0,-kl,0,.5,.5),o.emplaceBack(0,-kl,0,.5,.5);for(let t=0;t<=Nl;t++){let s=t/Nl,a=0;const l=un(0,e,s),[c,u,h]=Gl(Zu,Yu,l,kl);n.emplaceBack(c,u,h,s,a),i.emplaceBack(c,u,h,s,1-a);const d=Te(l);s=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),r.emplaceBack(c,u,h,s,a),o.emplaceBack(c,u,h,s,1-a)}this._poleSegments.push(tl.simpleSegment(a,0,66,64)),a+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(n,wu,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(i,wu,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(r,wu,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(o,wu,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.eH=Ad,e.eI=Ce,e.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.eK=Ie,e.eL=ac,e.eM=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.eN=W,e.eO=Hl,e.eP=F,e.eQ=T,e.eR=function(e){let[t,n,i]=e;const r=Math.hypot(t,n,i),o=Math.atan2(t,i),s=.5*Math.PI-Math.acos(-n/r);return new Xl(Ae(o),Ae(s))},e.eS=Y,e.eT=Sp,e.eU=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==Ke){const t=e.navigator?e.navigator.userAgent:null;Ke=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ke}(e)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},e.eV=function(e,t){_t=e,yt=t},e.eW=qu,e.eX=Wu,e.eY=function(e){const t=[0,0,0],n=l(new Float64Array(16));return u(n,e.pixelMatrix,e.globeMatrix),N(t,t,n),new xe(t[0],t[1])},e.eZ=function(){const e=Lf;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Pf),Lf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.e_=function(){Of().acquire(Pf)},e.ea=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},e.eb=Py,e.ec=ta,e.ed=Ba,e.ee=256,e.ef=Uu,e.eg=ha,e.eh=p,e.ei=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.ej=Ca,e.ek=Ia,e.el=ho,e.em=function(e,t,n,i,r){return Re((e-t)/(n-t)*(r-i)+i,i,r)},e.en=ee,e.eo=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*s-a*c,d=-u*o+a*l,f=c*o-s*l,p=n*h+i*d+r*f;return p?(e[0]=h*(p=1/p),e[1]=(-u*i+r*c)*p,e[2]=(a*i-r*s)*p,e[3]=d*p,e[4]=(u*n-r*l)*p,e[5]=(-a*n+r*o)*p,e[6]=f*p,e[7]=(-c*n+i*l)*p,e[8]=(s*n-i*o)*p,e):null},e.ep=2,e.eq=L,e.er=Rp,e.es=[1,1,1],e.et=class{constructor(e,t,n,i){this.context=e,this.format=i,this.size=n,this.texture=e.gl.createTexture();const[r,o,s]=this.size,{gl:a}=e;a.bindTexture(a.TEXTURE_3D,this.texture),e.pixelStoreUnpackFlipY.set(!1),e.pixelStoreUnpack.set(1),e.pixelStoreUnpackPremultiplyAlpha.set(!1),a.texImage3D(a.TEXTURE_3D,0,this.format,r,o,s,0,hp(this.format),dp(this.format),t.data)}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_3D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}},e.eu=Yy,e.ev=X,e.ew=function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e[3]=a+i*(n[3]-a),e},e.ex=Fp,e.ey=va,e.ez=Ma,e.f=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(Number("0x"+t))))},e.f0=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(us===ls.deferred||us===ls.loading||us===ls.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");hs=ft.resolveURL(e),us=ls.deferred,cs=t,fs(),n||gs()},e.f1=function(e){Vf=ft.resolveURL(e),Gf||(Gf=new Ff(Of(),new en)),Gf.broadcast("setMeshoptUrl",Vf)},e.f2=Zf,e.f3=function(e){Nf=ft.resolveURL(e),Gf||(Gf=new Ff(Of(),new en)),Gf.broadcast("setDracoUrl",Nf)},e.f4=Xf,e.f5=Rf,e.f6=function(e){const t=wt();if(!t)return;const n=t.delete(gt);e&&n.then(()=>e()).catch(e)},e.f7=Mf,e.f8=Xo,e.f9=hh,e.fa=e_,e.fb=ab,e.fc=ub,e.fd=mm,e.fe=Sc,e.ff="hd_road_elevation",e.fg=Hc,e.fh=Ne,e.fi=Jh,e.fj=Yg,e.fk=Xg,e.fl=function(e,t,n,i,r,o,s){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,u=arguments.length>10?arguments[10]:void 0;e.createArrays(),e.tilePixelRatio=Li/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const h=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,f={};f.scaleFactor=a,f.textSizeScaleRange=h.get("text-size-scale-range"),f.iconSizeScaleRange=h.get("icon-size-scale-range");const[p,m]=f.textSizeScaleRange,[g,_]=f.iconSizeScaleRange;f.textScaleFactor=Re(f.scaleFactor,p,m),f.iconScaleFactor=Re(f.scaleFactor,g,_);const y=d["text-size"],v=d["icon-size"];if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.textSizeData;f.compositeTextSizes=[y.possiblyEvaluate(new ys(t,{worldview:u}),o),y.possiblyEvaluate(new ys(n,{worldview:u}),o)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.iconSizeData;f.compositeIconSizes=[v.possiblyEvaluate(new ys(t,{worldview:u}),o),v.possiblyEvaluate(new ys(n,{worldview:u}),o)]}f.layoutTextSize=y.possiblyEvaluate(new ys(s+1,{worldview:u}),o),f.layoutIconSize=v.possiblyEvaluate(new ys(s+1,{worldview:u}),o),f.textMaxSize=y.possiblyEvaluate(new ys(18,{worldview:u}),o);const x=h.get("symbol-placement"),b="map"===h.get("text-rotation-alignment")&&"point"!==x,w=h.get("text-size");let E=!1;const T=[];for(const A of e.features){const s=h.get("text-font").evaluate(A,{},o).join(","),a=w.evaluate(A,{},o)*f.textScaleFactor,p=f.layoutTextSize.evaluate(A,{},o)*f.textScaleFactor,m=f.layoutIconSize.evaluate(A,{},o)*f.iconScaleFactor,g={horizontal:{},vertical:void 0},_=A.text;let y,v=[0,0];if(_){const i=_.toString(),c=h.get("text-letter-spacing").evaluate(A,{},o)*Hm,u=h.get("text-line-height").evaluate(A,{},o)*Hm,d=es(i)?c:0,f=h.get("text-anchor").evaluate(A,{},o),m=h.get("text-variable-anchor");if(!m){const e=h.get("text-radial-offset").evaluate(A,{},o);if(e)v=__(f,[e*Hm,m_]);else{const e=h.get("text-offset").evaluate(A,{},o);v=[e[0]*Hm,e[1]*Hm]}}let y=b?"center":h.get("text-justify").evaluate(A,{},o);const w="point"===x,E=w?h.get("text-max-width").evaluate(A,{},o)*Hm:1/0,T=o=>{e.allowVerticalPlacement&&$o(i)&&(g.vertical=yg(_,t,n,r,s,E,u,f,o,d,v,mg.vertical,!0,p,a,l))};if(!b&&m){const e="auto"===y?m.map(e=>A_(e)):[y];let i=!1;for(let o=0;o<e.length;o++){const c=e[o];if(!g.horizontal[c])if(i)g.horizontal[c]=g.horizontal[0];else{const e=yg(_,t,n,r,s,E,u,"center",c,d,v,mg.horizontal,!1,p,a,l);e&&(g.horizontal[c]=e,i=1===e.positionedLines.length)}}T("left")}else{if("auto"===y&&(y=A_(f)),w||h.get("text-writing-mode").indexOf("horizontal")>=0||!$o(i)){const e=yg(_,t,n,r,s,E,u,f,y,d,v,mg.horizontal,!1,p,a,l);e&&(g.horizontal[y]=e)}T(w?"left":y)}}let S,D,C,I,R,P,M=!1;const F=h.get("icon-text-fit").evaluate(A,{},o);if(A.icon&&A.icon.hasPrimary()){const t=x_(A.icon,e.iconSizeData,d["icon-size"],o,e.zoom,A,l,f.iconScaleFactor,u);S=t.iconPrimary,C=t.iconSecondary;const n=S.toString();if(D=i.get(n),D&&(R=h.get("icon-offset").evaluate(A,{},o),P=h.get("icon-anchor").evaluate(A,{},o),y=Ig(r.get(n),C?r.get(C.toString()):void 0,R,P),M=D.sdf,void 0===e.sdfIcons?e.sdfIcons=D.sdf:e.sdfIcons!==D.sdf&&He("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(D.pixelRatio!==e.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0)),C){const e=C.toString();I=i.get(e)}}E=E||!(!A.icon||!A.icon.hasSecondary());const L=P_(g.horizontal)||g.vertical;e.iconsInText||(e.iconsInText=!!L&&L.iconsInText);const k=p*f.textScaleFactor/Hm,{defaultShapedIcon:O,verticallyShapedIcon:B}=S_(e,y,h,A,o,g,k,R,F);"none"!==F&&y&&(Pg(y)||Mg(y))&&(y_(0,D,S,y,O,F,c,i,r),y_(0,I,C,y,O,F,c,i,r),B&&(y_(0,D,S,y,B,F,c,i,r),y_(0,I,C,y,B,F,c,i,r))),y=O,T.push({feature:A,shapedTextOrientations:g,shapedText:L,shapedIcon:y,iconPrimary:S,iconSecondary:C,iconOffset:R,iconAnchor:P,verticallyShapedIcon:B,layoutTextSize:p,layoutIconSize:m,textOffset:v,isSDFIcon:M,iconTextFit:F})}return{featureData:T,sizes:f,hasAnySecondaryIcon:E,textAlongLine:b,symbolPlacement:x}},e.fm=Kg,e.fn=function(e,t,n,i,r,o,s,a,l,c){const{featureData:u,hasAnySecondaryIcon:h,sizes:d,textAlongLine:f,symbolPlacement:p}=t;for(const m of u){const{shapedIcon:t,verticallyShapedIcon:n,feature:o,shapedTextOrientations:u,shapedText:g,layoutTextSize:_,textOffset:y,isSDFIcon:v,iconPrimary:x,iconSecondary:b,iconTextFit:w,iconOffset:E}=m;w_(t,c.iconPositions,x,b),w_(n,c.iconPositions,x,b),E_(u,c.iconPositions),b_(x,b,c.iconPositions),(g||t)&&D_(e,o,u,t,n,l,d,_,0,y,v,i,r,s,a,h,w,E,f,p)}n&&e.generateCollisionDebugBuffers(o,e.collisionBoxArray,d.textScaleFactor)},e.fo=Tc,e.fp=px,e.fq=vc,e.fr=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==rp){const n=new Uint32Array(e,0,7),[,,i,r,o,s]=n;t=n.byteLength+r+o+s+o,(i!==e.byteLength||t>=e.byteLength)&&He("Invalid b3dm header information.")}return up(e,t)},e.fs=function(e,t){const n=Xp(e);for(const i of n){for(const e of i.meshes)Zp(e);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(Kp(i.lights,t)))}return n},e.ft=nv,e.fu=Ze,e.fv=If,e.fw=_s,e.fx=ls,e.fy=function(e){Et(),null!=xt&&xt.then(t=>{t.keys().then(n=>{for(let i=0;i<n.length-e;i++)t.delete(n[i]).catch(e=>He(e.message))}).catch(e=>He(e.message))}).catch(e=>He(e.message))},e.g=function(e,t){return kt(Le(e,{method:"GET"}),t)},e.h=Le,e.i=function(e){return it.API_STYLE_REGEX.test(e)&&!ot(e)},e.j=function(e){return 0===e.indexOf("mapbox:")},e.k=rt,e.l=At,e.m=function(e){return decodeURIComponent(atob(e).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},e.n=function(e,t){return kt(Le(e,{type:"json"}),t)},e.o=Vt,e.p=function(e,t){return kt(Le(e,{method:"POST"}),t)},e.q=ft,e.r=dh,e.s=function(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}},e.t=dt,e.u=function(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()},e.v=function(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e.w=He,e.x=function(){return kf||(kf=new Mf),kf},e.y=nx,e.z=Jt}),s(["./shared"],function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function n(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const i of e)t+="".concat(n(i),",");return"".concat(t,"]")}let t="{";for(const i of Object.keys(e).sort())t+="".concat(i,":").concat(n(e[i]),",");return"".concat(t,"}")}function i(t){let i="";for(const r of e.bu)i+="/".concat(n(t[r]));return i}class r{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,r,o){this._options=o;for(const n of t)this._layerConfigs[n.id]=n,(this._layers[n.id]=e.dn(n,this.scope,null,this._options)).compileFilter(o),this.keyCache[n.id]&&delete this.keyCache[n.id];for(const e of r)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const s=function(e,t){const r={};for(let s=0;s<e.length;s++){const o=e[s];let a=t&&t[o.id];a||("symbol"===o.type?a=o.id:(a=i(o),"line"===o.type&&o.paint&&function e(t){return"string"==typeof t&&"line-progress"===t||(Array.isArray(t)?t.some(e):!(!t||"object"!=typeof t)&&Object.values(t).some(e))}(o.paint["line-width"])&&(a+="/".concat(n(o.paint["line-width"]))))),t&&(t[o.id]=a);let l=r[a];l||(l=r[a]=[]),l.push(o)}const o=[];for(const n in r)o.push(r[n]);return o}(Object.values(this._layerConfigs),this.keyCache);for(const e of s){const t=e.map(e=>this._layers[e.id]),n=t[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const o=n.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(t)}}}const o=1*e.fa;class s{constructor(t){const n={},i=[];for(const e in t){const r=t[e],s=n[e]={};for(const e in r.glyphs){const t=r.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n=t.metrics.localGlyph?o:1,a={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};i.push(a),s[e]=a}}const{w:r,h:s}=e.H(i),a=new e.f9({width:r||1,height:s||1});for(const l in t){const i=t[l];for(const t in i.glyphs){const r=i.glyphs[+t];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const s=n[l][t],c=r.metrics.localGlyph?o:1;e.f9.copy(r.bitmap,a,{x:0,y:0},{x:s.x+c,y:s.y+c},r.bitmap)}}this.image=a,this.positions=n}}e.f8(s,"GlyphAtlas");class a{constructor(t){this.tileID=new e.aM(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.lut=t.lut,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.request&&t.request.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.aW(t.tileID.canonical,t.projection),this.projection=t.projection,this.worldview=t.worldview,this.localizableLayerIds=t.localizableLayerIds,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster,this.tessellationStep=t.tessellationStep,this.scaleFactor=t.scaleFactor,this.worldview=t.worldview}parse(t,n,i,r,o,a){this.status="parsing",this.data=t,this.collisionBoxArray=new e.b0;const c=new e.fb(Object.keys(t.layers).sort()),u=new e.fc(this.tileID,this.promoteId);u.bucketLayerIDs=[];const h={},d=new e.fd(256,256),f={featureIndex:u,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:d,availableImages:i,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},p=[],m=n.familiesBySource[this.source];for(const s in m){const n=t.layers[s];if(!n)continue;let o=!1,a=!1,d=!1;for(const e of m[s])"symbol"===e[0].type?o=!0:a=!0,e[0].is3D()&&"model"!==e[0].type&&(d=!0);if(this.extraShadowCaster&&!d)continue;if(!0===this.isSymbolTile&&!o)continue;if(!1===this.isSymbolTile&&!a)continue;1===n.version&&e.w('Vector tile source "'.concat(this.source,'" layer "').concat(s,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const g=c.encode(s),_=[];let y=!1;for(let t=0,i=0;t<n.length;t++){const r=n.feature(t),o=u.getId(r,s);if(this.localizableLayerIds&&this.localizableLayerIds.has(s)){const e=r.properties?r.properties.worldview:null;if(this.worldview&&"string"==typeof e)if("all"===e)r.properties.$localized=!0;else{if(!e.split(",").includes(this.worldview))continue;r.properties.$localized=!0,r.properties.worldview=this.worldview}}!y&&r.properties&&r.properties.hasOwnProperty(e.fe)&&(y=!0),_.push({feature:r,id:o,index:i,sourceLayerIndex:g}),i++}y&&!f.elevationFeatures&&t.layers.hasOwnProperty(e.ff)&&(f.elevationFeatures=e.fg.parseFrom(t.layers[e.ff],this.canonical));for(const t of m[s]){const n=t[0];if(this.extraShadowCaster&&(!n.is3D()||"model"===n.type))continue;if(void 0!==this.isSymbolTile&&"symbol"===n.type!==this.isSymbolTile)continue;if(n.minzoom&&this.zoom<Math.floor(n.minzoom))continue;if(n.maxzoom&&this.zoom>=n.maxzoom)continue;if("none"===n.visibility)continue;l(t,this.zoom,f.brightness,i,this.worldview);const o=h[n.id]=n.createBucket({index:u.bucketLayerIDs.length,layers:t,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:g,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:r,worldview:this.worldview});u.bucketLayerIDs.push(t.map(t=>e.C(t.id,t.scope)));let s=o.prepare?o.prepare():null;null!=s?(s=s.then(()=>o.populate(_,f,this.tileID.canonical,this.tileTransform)),p.push(s)):o.populate(_,f,this.tileID.canonical,this.tileTransform)}}const g=()=>{let n,r,p,m,g,_;d.trim();const y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},v=()=>{if(n)return this.status="done",a(n);if(this.extraShadowCaster)this.status="done",a(null,{buckets:Object.values(h).filter(e=>!e.isEmpty()),featureIndex:u,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:f.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(r&&p&&m){const t=new s(r),n=new Map;for(const[i,r]of p.entries()){const{imagePosition:t}=e.fj(i,r,e.fk);n.set(i,t)}const a={};for(const o in h){const s=h[o];s instanceof e.b1&&(l(s.layers,this.zoom,f.brightness,i,this.worldview),a[o]=e.fl(s,r,t.positions,p,n,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,g,this.worldview))}const c={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(o,p,g,()=>{c.iconsPending=!1,x(a,t,c)}),this.rasterizeIfNeeded(o,m,_,()=>{c.patternsPending=!1,x(a,t,c)})}},x=(t,n,r,o)=>{if(r.iconsPending||r.patternsPending)return;const s=new e.fm(p,m,this.lut);for(const a in h){const n=h[a];if(a in t)e.fn(n,t[a],this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,p,s);else if(n.hasPattern&&(n instanceof e.b7||n instanceof e.b8||n instanceof e.e4)){l(n.layers,this.zoom,f.brightness,i,this.worldview);const e=Object.fromEntries(s.patternPositions);n.addFeatures(f,this.tileID.canonical,e,i,this.tileTransform,this.brightness)}}this.status="done",a(null,{buckets:Object.values(h).filter(e=>!e.isEmpty()),featureIndex:u,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:n.image,lineAtlas:d,imageAtlas:s,brightness:f.brightness})};if(!this.extraShadowCaster){const t=e.fh(f.glyphDependencies,e=>Object.keys(e).map(Number));Object.keys(t).length?o.send("getGlyphs",{uid:this.uid,stacks:t},(e,t)=>{n||(n=e,r=t,v())},void 0,!1,y):r={};const i=Array.from(f.iconDependencies.keys()).map(t=>e.I.parse(t));i.length?o.send("getImages",{images:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(e,t)=>{n||(n=e,p=new Map,g=this.updateImageMapAndGetImageTaskQueue(p,t,f.iconDependencies),v())},void 0,!1,y):(p=new Map,g=new Map);const s=Array.from(f.patternDependencies.keys()).map(t=>e.I.parse(t));s.length?o.send("getImages",{images:s,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(e,t)=>{n||(n=e,m=new Map,_=this.updateImageMapAndGetImageTaskQueue(m,t,f.patternDependencies),v())},void 0,!1,y):(m=new Map,_=new Map)}if(f.elevationFeatures&&f.elevationFeatures.length>0){const n=[];for(const t of Object.values(h))if(t instanceof e.b8){const e=t.getUnevaluatedPortalGraph();e&&n.push(e)}const i=e.fi.evaluate(n);for(const r of Object.values(h))if(r instanceof e.b8){const e=t.layers[c.decode(r.sourceLayerIndex)];r.setEvaluatedPortalGraph(i,e,this.tileID.canonical,f.availableImages,f.brightness)}}v()};p.length>0?Promise.allSettled(p).then(g).catch(a):g()}rasterizeIfNeeded(e,t,n,i){Array.from(t.values()).some(e=>e.usvg)?this.rasterize(e,t,n,i):i()}updateImageMapAndGetImageTaskQueue(e,t,n){const i=new Map;for(const r of t.keys()){const o=n.get(r)||[];for(const n of o){const r=n.toString(),o=t.get(n.id.toString());o.usvg?i.has(r)||(i.set(r,n),e.set(r,Object.assign({},o))):e.set(r,o)}}return i}rasterize(e,t,n,i){this.rasterizeTask=e.send("rasterizeImages",{scope:this.scope,tasks:n},(e,n)=>{if(!e)for(const[i,r]of n.entries()){const e=Object.assign(t.get(i),{data:r});t.set(i,e)}i()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function l(t,n,i,r,o){const s=new e.aa(n,{brightness:i,worldview:o});for(const e of t)e.recalculate(s,r)}class c extends e.E{constructor(t,n,i,r,o,s,a){super(),this.actor=t,this.layerIndex=n,this.availableImages=i,this.availableModels=r,this.loadVectorData=s||e.aJ,this.loading={},this.loaded={},this.deduped=new e.aI(t.scheduler),this.isSpriteLoaded=o,this.scheduler=t.scheduler,this.brightness=a}loadTile(n,i){const r=n.uid,o=n&&n.request,s=o&&o.collectResourceTiming,l=this.loading[r]=new a(n);l.abort=this.loadVectorData(n,(a,c)=>{const u=!this.loading[r];if(delete this.loading[r],l.cancelRasterize(),u||a||!c)return l.status="done",u||(this.loaded[r]=l),i(a);const h=c.rawData,d={};c.expires&&(d.expires=c.expires),c.cacheControl&&(d.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new e.fo(new e.bq(h));const f=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(n,r)=>{if(n||!r)return i(n);const a={};if(s){const e=t(o);e.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(e)))}i(null,e.h({rawTileData:h.slice(0)},r,d,a))})};this.isSpriteLoaded?f():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(f,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):f()}),this.loaded=this.loaded||{},this.loaded[r]=l})}reloadTile(t,n){const i=this.loaded,r=t.uid;if(i&&i[r]){const o=i[r];o.scaleFactor=t.scaleFactor,o.showCollisionBoxes=t.showCollisionBoxes,o.projection=t.projection,o.brightness=t.brightness,o.tileTransform=e.aW(t.tileID.canonical,t.projection),o.extraShadowCaster=t.extraShadowCaster,o.lut=t.lut,o.worldview=t.worldview;const s=(e,t)=>{const i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,i)),n(e,t)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,s):s())}else n(null,void 0)}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}}class u{loadTile(t,n){const{uid:i,encoding:r,rawImageData:o,padding:s}=t,a=ImageBitmap&&o instanceof ImageBitmap?this.getImageData(o,s):o;n(null,new e.fp(i,a,r,s<1))}reloadTile(e,t){t(null,null)}abortTile(e,t){t()}removeTile(e,t){t()}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}e.bp.setPbf(e.bq);class h{constructor(t){this._mrt=new e.bp(t.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=t.uid,this.tileID=t.tileID,this.source=t.source}parse(t,n){const i=this._mrt;this.status="parsing",this._entireBuffer=t;try{i.parseHeader(t),this._isHeaderLoaded=!0;const r=[];for(const n in i.layers){const o=i.getLayer(n),s=o.getDataRange(o.getBandList()),a=i.createDecodingTask(s),l=t.slice(s.firstByte,s.lastByte+1),c=e.bp.performDecoding(l,a).then(e=>a.complete(null,e)).catch(e=>a.complete(e,null));r.push(c)}Promise.allSettled(r).then(()=>n(null,i)).catch(e=>n(e))}catch(e){n(e)}}}class d{constructor(e){this.actor=e,this.loading={},this.loaded={}}loadTile(t,n){const i=t.uid,r=t.request,o=this.loading[i]=new h(t),{cancel:s}=e.br(r,(e,t,r,s)=>{const a=!this.loading[i];if(delete this.loading[i],a||e||!t)return o.status="done",a||(this.loaded[i]=o),n(e);o.parse(t,(e,t)=>{if(e||!t)return n(e);n(null,t,r,s)}),this.loaded[i]=o});o.abort=s}reloadTile(e,t){t(null,void 0)}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=e.uid;this.loaded[n]&&delete this.loaded[n],t()}decodeRasterArray(t,n){e.bp.performDecoding(t.buffer,t.task).then(e=>n(null,e)).catch(e=>n(e))}}const f=e.fq.prototype.toGeoJSON;class p{constructor(t){this._feature=t,this.extent=e.aj,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const n of this._feature.geometry)t.push([new e.P(n[0],n[1])]);return t}{const t=[];for(const n of this._feature.geometry){const i=[];for(const t of n)i.push(new e.P(t[0],t[1]));t.push(i)}return t}}toGeoJSON(e,t,n){return f.call(this,e,t,n)}}class m{constructor(t,n){this.name=t,this.extent=e.aj,this.length=n.length,this._jsonFeatures=n}feature(e){return new p(this._jsonFeatures[e])}}class g{constructor(t){this.layers={},this.extent=e.aj;for(const e of Object.keys(t))this.layers[e]=new m(e,t[e])}}const _=64/4096,y=128;class v{constructor(){this.features=new Map}clear(){this.features.clear()}load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;for(const n of e){const e=n.id;if(null==e)continue;let i=this.features.get(e);i&&this.updateCache(i,t),n.geometry?(i=b(n),this.updateCache(i,t),this.features.set(e,i)):this.features.delete(e),this.updateCache(i,t)}}updateCache(e,t){for(const{canonical:n,uid:i}of Object.values(t)){const{z:r,x:o,y:s}=n;x(e,Math.pow(2,r),o,s)&&delete t[i]}}getTile(e,t,n){const i=Math.pow(2,e),r=[];for(const o of this.features.values())x(o,i,t,n)&&r.push(A(o,i,t,n));return{features:r}}getFeatures(){return[...this.features.values()]}}function x(e,t,n,i){let{minX:r,minY:o,maxX:s,maxY:a}=e;return r<(n+1+_)/t&&o<(i+1+_)/t&&s>(n-_)/t&&a>(i-_)/t}function b(e){const{id:t,geometry:n,properties:i}=e;if(!n)return;if("GeometryCollection"===n.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:r,coordinates:o}=n,s={id:t,type:1,geometry:[],tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},a=s.geometry;if("Point"===r)w(o,a,s);else if("MultiPoint"===r)for(const l of o)w(l,a,s);else if("LineString"===r)s.type=2,E(o,a,s);else if("MultiLineString"===r)s.type=2,T(o,a,s);else if("Polygon"===r)s.type=3,T(o,a,s,!0);else{if("MultiPolygon"!==r)throw new Error("Input data is not a valid GeoJSON object.");s.type=3;for(const e of o)T(e,a,s,!0)}return s}function w(t,n,i){let[r,o]=t;const s=e.aD(r);let a=e.aH(o);a=a<0?0:a>1?1:a,n.push(s,a),i.minX=Math.min(i.minX,s),i.minY=Math.min(i.minY,a),i.maxX=Math.max(i.maxX,s),i.maxY=Math.max(i.maxY,a)}function E(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=[];for(const s of e)w(s,o,n);t.push(o),i&&function(e,t){let n=0;for(let i=0,r=e.length,o=r-2;i<r;o=i,i+=2)n+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(n>0===t)for(let i=0,r=e.length;i<r/2;i+=2){const t=e[i],n=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=t,e[r-1-i]=n}}(o,r)}function T(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];for(let r=0;r<e.length;r++)E(e[r],t,n,i,0===r)}function A(t,n,i,r){const{id:o,type:s,geometry:a,tags:l}=t,c=[];if(1===s)!function(t,n,i,r,o){for(let s=0;s<t.length;s+=2){const a=Math.round(e.aj*(t[s+0]*n-i)),l=Math.round(e.aj*(t[s+1]*n-r));o.push([a,l])}}(a,n,i,r,c);else for(const e of a)S(e,n,i,r,c);return{id:o,type:s,geometry:c,tags:l}}function S(t,n,i,r,o){const s=-y,a=e.aj+y;let l;for(let c=0;c<t.length-2;c+=2){let u=Math.round(e.aj*(t[c+0]*n-i)),h=Math.round(e.aj*(t[c+1]*n-r)),d=Math.round(e.aj*(t[c+2]*n-i)),f=Math.round(e.aj*(t[c+3]*n-r));const p=d-u,m=f-h;u<s&&d<s||(u<s?(h+=Math.round(m*((s-u)/p)),u=s):d<s&&(f=h+Math.round(m*((s-u)/p)),d=s),h<s&&f<s||(h<s?(u+=Math.round(p*((s-h)/m)),h=s):f<s&&(d=u+Math.round(p*((s-h)/m)),f=s),u>=a&&d>=a||(u>=a?(h+=Math.round(m*((a-u)/p)),u=a):d>=a&&(f=h+Math.round(m*((a-u)/p)),d=a),h>=a&&f>=a||(h>=a?(u+=Math.round(p*((a-h)/m)),h=a):f>=a&&(d=u+Math.round(p*((a-h)/m)),f=a),l&&u===l[l.length-1][0]&&h===l[l.length-1][1]||(l=[[u,h]],o.push(l)),l.push([d,f])))))}}function D(t,n){let{name:i,features:r}=t;n.writeStringField(1,i),n.writeVarintField(5,e.aj);const o=new Map,s=new Map,a={keys:o,values:s,feature:null};for(const e of r)a.feature=e,n.writeMessage(2,C,a);for(const e of o.keys())n.writeStringField(3,e);for(const e of s.keys())n.writeMessage(4,F,e)}function C(e,t){const n=e.feature;void 0===n.id||isNaN(+n.id)||t.writeVarintField(1,+n.id),n.tags&&t.writeMessage(2,I,e),t.writeVarintField(3,n.type),t.writeMessage(4,M,n)}function I(e,t){let{keys:n,values:i,feature:r}=e;for(const o of Object.keys(r.tags)){let e=r.tags[o];if(null===e)continue;let s=n.get(o);void 0===s&&(s=n.size,n.set(o,s)),t.writeVarint(s);const a=typeof e;"string"!==a&&"boolean"!==a&&"number"!==a&&(e=JSON.stringify(e));let l=i.get(e);void 0===l&&(l=i.size,i.set(e,l)),t.writeVarint(l)}}function R(e,t){return(t<<3)+(7&e)}function P(e){return e<<1^e>>31}function M(e,t){const{geometry:n,type:i}=e;let r=0,o=0;if(1===i){t.writeVarint(R(1,n.length));for(const e of n){const n=e[0]-r,i=e[1]-o;t.writeVarint(P(n)),t.writeVarint(P(i)),r+=n,o+=i}}else for(const s of n){t.writeVarint(R(1,1));const e=s.length-(3===i?1:0);for(let n=0;n<e;n++){1===n&&t.writeVarint(R(2,e-1));const i=s[n][0]-r,a=s[n][1]-o;t.writeVarint(P(i)),t.writeVarint(P(a)),r+=i,o+=a}3===i&&t.writeVarint(R(7,1))}}function F(e,t){const n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}const L={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},k=Math.fround||(O=new Float32Array(1),e=>(O[0]=+e,O[0]));var O;const B=3,z=5,N=6;class U{constructor(e){this.options=Object.assign(Object.create(L),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:i}=this.options;t&&console.time("total time");const r="prepare ".concat(e.length," points");t&&console.time(r),this.points=e;const o=[];for(let a=0;a<e.length;a++){const t=e[a];if(!t.geometry)continue;const[n,i]=t.geometry.coordinates,r=k(G(n)),s=k(H(i));o.push(r,s,1/0,a,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[i+1]=this._createTree(o);t&&console.timeEnd(r);for(let a=i;a>=n;a--){const e=+Date.now();s=this.trees[a]=this._createTree(this._cluster(s,a)),t&&console.log("z%d: %d clusters in %dms",a,s.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,o],t),s=this.getClusters([-180,i,r,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(G(n),H(o),G(r),H(i)),l=s.data,c=[];for(const u of a){const e=this.stride*u;c.push(l[e+z]>1?V(l,e,this.clusterProps):this.points[l[e+B]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.data;if(t*this.stride>=o.length)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=r.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const c of a){const t=c*this.stride;o[t+4]===e&&l.push(o[t+z]>1?V(o,t,this.clusterProps):this.points[o[t+B]])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((t-a)/r,l,(t+1+a)/r,c),i.data,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.data,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.data,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const o=this.getChildren(t);for(const s of o){const t=s.properties;if(t&&t.cluster?r+t.point_count<=i?r+=t.point_count:r=this._appendLeaves(e,t.cluster_id,n,i,r):r<i?r++:e.push(s),e.length===n)break}return r}_createTree(t){const n=new e.c0(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,i,r,o){for(const s of e){const e=s*this.stride,a=t[e+z]>1;let l,c,u;if(a)l=j(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+B]];l=n.properties;const[i,r]=n.geometry.coordinates;c=G(i),u=H(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;d=a||this.options.generateId?t[e+B]:this.points[t[e+B]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:i,reduce:r,minPoints:o}=this.options,s=n/(i*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let u=0;u<a.length;u+=c){if(a[u+2]<=t)continue;a[u+2]=t;const n=a[u],i=a[u+1],h=e.within(a[u],a[u+1],s),d=a[u+z];let f=d;for(const e of h){const n=e*c;a[n+2]>t&&(f+=a[n+z])}if(f>d&&f>=o){let e,o=n*d,s=i*d,p=-1;const m=(u/c<<5)+(t+1)+this.points.length;for(const n of h){const i=n*c;if(a[i+2]<=t)continue;a[i+2]=t;const l=a[i+z];o+=a[i]*l,s+=a[i+1]*l,a[i+4]=m,r&&(e||(e=this._map(a,u,!0),p=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(a,i)))}a[u+4]=m,l.push(o/f,s/f,1/0,m,-1,f),r&&l.push(p)}else{for(let e=0;e<c;e++)l.push(a[u+e]);if(f>1)for(const e of h){const n=e*c;if(!(a[n+2]<=t)){a[n+2]=t;for(let e=0;e<c;e++)l.push(a[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+z]>1){const i=this.clusterProps[e[t+N]];return n?Object.assign({},i):i}const i=this.points[e[t+B]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function V(e,t,n){return{type:"Feature",id:e[t+B],properties:j(e,t,n),geometry:{type:"Point",coordinates:[(i=e[t],360*(i-.5)),W(e[t+1])]}};var i}function j(e,t,n){const i=e[t+z],r=i>=1e4?"".concat(Math.round(i/1e3),"k"):i>=1e3?Math.round(i/100)/10+"k":i,o=e[t+N],s=-1===o?{}:Object.assign({},n[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+B],point_count:i,point_count_abbreviated:r})}function G(e){return e/360+.5}function H(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function W(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function q(e,t,n,i){let r=i;const o=t+(n-t>>1);let s,a=n-t;const l=e[t],c=e[t+1],u=e[n],h=e[n+1];for(let d=t+3;d<n;d+=3){const t=X(e[d],e[d+1],l,c,u,h);if(t>r)s=d,r=t;else if(t===r){const e=Math.abs(d-o);e<a&&(s=d,a=e)}}r>i&&(s-t>3&&q(e,t,s,i),e[s+2]=r,n-s>3&&q(e,s,n,i))}function X(e,t,n,i,r,o){let s=r-n,a=o-i;if(0!==s||0!==a){const l=((e-n)*s+(t-i)*a)/(s*s+a*a);l>1?(n=r,i=o):l>0&&(n+=s*l,i+=a*l)}return s=e-n,a=t-i,s*s+a*a}function Z(e,t,n,i){const r={id:null!==e&&void 0!==e?e:null,type:t,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)Y(r,n);else if("Polygon"===t)Y(r,n[0]);else if("MultiLineString"===t)for(const o of n)Y(r,o);else if("MultiPolygon"===t)for(const o of n)Y(r,o[0]);return r}function Y(e,t){for(let n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function K(e,t,n,i){if(!t.geometry)return;const r=t.geometry.coordinates;if(r&&0===r.length)return;const o=t.geometry.type,s=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let a=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===o)J(r,a);else if("MultiPoint"===o)for(const c of r)J(c,a);else if("LineString"===o)Q(r,a,s,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(const n of r)a=[],Q(n,a,s,!1),e.push(Z(l,"LineString",a,t.properties));return}$(r,a,s,!1)}else if("Polygon"===o)$(r,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const r of t.geometry.geometries)K(e,{id:l,geometry:r,properties:t.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of r){const t=[];$(e,t,s,!0),a.push(t)}}e.push(Z(l,o,a,t.properties))}function J(e,t){t.push(ee(e[0]),te(e[1]),0)}function Q(e,t,n,i){let r,o,s=0;for(let l=0;l<e.length;l++){const n=ee(e[l][0]),a=te(e[l][1]);t.push(n,a,0),l>0&&(s+=i?(r*a-n*o)/2:Math.sqrt(Math.pow(n-r,2)+Math.pow(a-o,2))),r=n,o=a}const a=t.length-3;t[2]=1,q(t,0,a,n),t[a+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function $(e,t,n,i){for(let r=0;r<e.length;r++){const o=[];Q(e[r],o,n,i),t.push(o)}}function ee(e){return e/360+.5}function te(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function ne(e,t,n,i,r,o,s,a){if(i/=t,o>=(n/=t)&&s<i)return e;if(s<n||o>=i)return null;const l=[];for(const c of e){const e=c.geometry;let t=c.type;const o=0===r?c.minX:c.minY,s=0===r?c.maxX:c.maxY;if(o>=n&&s<i){l.push(c);continue}if(s<n||o>=i)continue;let u=[];if("Point"===t||"MultiPoint"===t)ie(e,u,n,i,r);else if("LineString"===t)re(e,u,n,i,r,!1,a.lineMetrics);else if("MultiLineString"===t)se(e,u,n,i,r,!1);else if("Polygon"===t)se(e,u,n,i,r,!0);else if("MultiPolygon"===t)for(const a of e){const e=[];se(a,e,n,i,r,!0),e.length&&u.push(e)}if(u.length){if(a.lineMetrics&&"LineString"===t){for(const e of u)l.push(Z(c.id,t,e,c.tags));continue}"LineString"!==t&&"MultiLineString"!==t||(1===u.length?(t="LineString",u=u[0]):t="MultiLineString"),"Point"!==t&&"MultiPoint"!==t||(t=3===u.length?"Point":"MultiPoint"),l.push(Z(c.id,t,u,c.tags))}}return l.length?l:null}function ie(e,t,n,i,r){for(let o=0;o<e.length;o+=3){const s=e[o+r];s>=n&&s<=i&&ae(t,e[o],e[o+1],e[o+2])}}function re(e,t,n,i,r,o,s){let a=oe(e);const l=0===r?le:ce;let c,u,h=e.start;for(let g=0;g<e.length-3;g+=3){const d=e[g],f=e[g+1],p=e[g+2],m=e[g+3],_=e[g+4],y=0===r?d:f,v=0===r?m:_;let x=!1;s&&(c=Math.sqrt(Math.pow(d-m,2)+Math.pow(f-_,2))),y<n?v>n&&(u=l(a,d,f,m,_,n),s&&(a.start=h+c*u)):y>i?v<i&&(u=l(a,d,f,m,_,i),s&&(a.start=h+c*u)):ae(a,d,f,p),v<n&&y>=n&&(u=l(a,d,f,m,_,n),x=!0),v>i&&y<=i&&(u=l(a,d,f,m,_,i),x=!0),!o&&x&&(s&&(a.end=h+c*u),t.push(a),a=oe(e)),s&&(h+=c)}let d=e.length-3;const f=e[d],p=e[d+1],m=0===r?f:p;m>=n&&m<=i&&ae(a,f,p,e[d+2]),d=a.length-3,o&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&ae(a,a[0],a[1],a[2]),a.length&&t.push(a)}function oe(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function se(e,t,n,i,r,o){for(const s of e)re(s,t,n,i,r,o,!1)}function ae(e,t,n,i){e.push(t,n,i)}function le(e,t,n,i,r,o){const s=(o-t)/(i-t);return ae(e,o,n+(r-n)*s,1),s}function ce(e,t,n,i,r,o){const s=(o-n)/(r-n);return ae(e,t+(i-t)*s,o,1),s}function ue(e,t){const n=[];for(let i=0;i<e.length;i++){const r=e[i],o=r.type;let s;if("Point"===o||"MultiPoint"===o||"LineString"===o)s=he(r.geometry,t);else if("MultiLineString"===o||"Polygon"===o){s=[];for(const e of r.geometry)s.push(he(e,t))}else if("MultiPolygon"===o){s=[];for(const e of r.geometry){const n=[];for(const i of e)n.push(he(i,t));s.push(n)}}n.push(Z(r.id,o,s,r.tags))}return n}function he(e,t){const n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(let i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function de(e,t){if(e.transformed)return e;const n=1<<e.z,i=e.x,r=e.y;for(const o of e.features){const e=o.geometry,s=o.type;if(o.geometry=[],1===s)for(let a=0;a<e.length;a+=2)o.geometry.push(fe(e[a],e[a+1],t,n,i,r));else for(let a=0;a<e.length;a++){const s=[];for(let o=0;o<e[a].length;o+=2)s.push(fe(e[a][o],e[a][o+1],t,n,i,r));o.geometry.push(s)}}return e.transformed=!0,e}function fe(e,t,n,i,r,o){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-o))]}function pe(e,t,n,i,r){const o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const a of e)me(s,a,o,r);return s}function me(e,t,n,i){const r=t.geometry,o=t.type,s=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===o||"MultiPoint"===o)for(let a=0;a<r.length;a+=3)s.push(r[a],r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)ge(s,r,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let a=0;a<r.length;a++)ge(s,r[a],e,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(let a=0;a<r.length;a++){const t=r[a];for(let i=0;i<t.length;i++)ge(s,t[i],e,n,!0,0===i)}if(s.length){let n=t.tags||null;if("LineString"===o&&i.lineMetrics){n={};for(const e in t.tags)n[e]=t.tags[e];n.mapbox_clip_start=r.start/r.size,n.mapbox_clip_end=r.end/r.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:n};null!==t.id&&(a.id=t.id),e.features.push(a)}}function ge(e,t,n,i,r,o){const s=i*i;if(i>0&&t.size<(r?s:i))return void(n.numPoints+=t.length/3);const a=[];for(let l=0;l<t.length;l+=3)(0===i||t[l+2]>s)&&(n.numSimplified++,a.push(t[l],t[l+1])),n.numPoints++;r&&function(e,t){let n=0;for(let i=0,r=e.length,o=r-2;i<r;o=i,i+=2)n+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(n>0===t)for(let i=0,r=e.length;i<r/2;i+=2){const t=e[i],n=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=t,e[r-1-i]=n}}(a,o),e.push(a)}const _e={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ye{constructor(e,t){const n=(t=this.options=function(e,t){for(const n in t)e[n]=t[n];return e}(Object.create(_e),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=function(e,t){const n=[];if("FeatureCollection"===e.type)for(let i=0;i<e.features.length;i++)K(n,e.features[i],t,i);else K(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(e,t){const n=t.buffer/t.extent;let i=e;const r=ne(e,1,-1-n,n,0,-1,2,t),o=ne(e,1,1-n,2+n,0,-1,2,t);return(r||o)&&(i=ne(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=ue(r,1).concat(i)),o&&(i=i.concat(ue(o,-1)))),i}(i,t),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,n,i,r,o,s){const a=[e,t,n,i],l=this.options,c=l.debug;for(;a.length;){i=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();const u=1<<t,h=ve(t,n,i);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=pe(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const e="z".concat(t);this.stats[e]=(this.stats[e]||0)+1,this.total++}if(d.source=e,null==r){if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===r)continue;if(null!=r){const e=r-t;if(n!==o>>e||i!==s>>e)continue}}if(d.source=null,0===e.length)continue;c>1&&console.time("clipping");const f=.5*l.buffer/l.extent,p=.5-f,m=.5+f,g=1+f;let _=null,y=null,v=null,x=null,b=ne(e,u,n-f,n+m,0,d.minX,d.maxX,l),w=ne(e,u,n+p,n+g,0,d.minX,d.maxX,l);e=null,b&&(_=ne(b,u,i-f,i+m,1,d.minY,d.maxY,l),y=ne(b,u,i+p,i+g,1,d.minY,d.maxY,l),b=null),w&&(v=ne(w,u,i-f,i+m,1,d.minY,d.maxY,l),x=ne(w,u,i+p,i+g,1,d.minY,d.maxY,l),w=null),c>1&&console.timeEnd("clipping"),a.push(_||[],t+1,2*n,2*i),a.push(y||[],t+1,2*n,2*i+1),a.push(v||[],t+1,2*n+1,2*i),a.push(x||[],t+1,2*n+1,2*i+1)}}getTile(e,t,n){e=+e,t=+t,n=+n;const i=this.options,{extent:r,debug:o}=i;if(e<0||e>24)return null;const s=1<<e,a=ve(e,t=t+s&s-1,n);if(this.tiles[a])return de(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);let l,c=e,u=t,h=n;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[ve(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?de(this.tiles[a],r):null):null}}function ve(e,t,n){return 32*((1<<e)*n+t)+e}function xe(t,n){const i=t.tileID.canonical;if(!this._geoJSONIndex)return void n(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return void n(null,null);const o=e=>e.tags&&"3d_elevation_id"in e.tags&&"source"in e.tags&&"elevation"===e.tags.source,s=r.features.filter(e=>o(e));let a={_geojsonTileLayer:r.features};s.length>0&&(a={_geojsonTileLayer:r.features.filter(e=>!o(e)),hd_road_elevation:s});const l=new g(a),c=function(t){const n=new e.bq;for(const e of Object.keys(t))n.writeMessage(3,D,{name:e,features:t[e]});return n.finish()}(a).buffer;n(null,{vectorTile:l,rawData:c})}class be extends c{constructor(e,t,n,i,r,o,s){super(e,t,n,i,r,xe,s),o&&(this.loadGeoJSON=o),this._dynamicIndex=new v}loadData(n,i){const r=n&&n.request,o=r&&r.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(n,(s,a)=>{if(s||!a)return i(s);if("object"!=typeof a)return i(new Error("Input data given to '".concat(n.source,"' is not a valid GeoJSON object.")));{try{if(n.filter){const t=e.X(n.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));a.features=a.features.filter(e=>t.value.evaluate({zoom:0},e))}n.dynamic?("Feature"===a.type&&(a={type:"FeatureCollection",features:[a]}),n.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(a.features,this.loaded),n.cluster&&(a.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=n.cluster?new U(function(t){let{superclusterOptions:n,clusterProperties:i}=t;if(!i||!n)return n;const r={},o={},s={accumulated:null,zoom:0},a={properties:null},l=Object.keys(i);for(const c of l){const[t,n]=i[c],s=e.X(n),a=e.X("string"==typeof t?[t,["accumulated"],["get",c]]:t);r[c]=s.value,o[c]=a.value}return n.map=e=>{a.properties=e;const t={};for(const n of l)t[n]=r[n].evaluate(s,a);return t},n.reduce=(e,t)=>{a.properties=t;for(const n of l)s.accumulated=e[n],e[n]=o[n].evaluate(s,a)},n}(n)).load(a.features):n.dynamic?this._dynamicIndex:function(e,t){return new ye(e,t)}(a,n.geojsonVtOptions)}catch(e){return i(e)}const s={};if(o){const e=t(r);e&&(s.resourceTiming={},s.resourceTiming[n.source]=JSON.parse(JSON.stringify(e)))}i(null,s)}})}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?e.partial?t(null,void 0):super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,n){if(t.request)e.n(t.request,n);else{if("string"!=typeof t.data)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));setTimeout(()=>{try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")))}},0)}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class we{constructor(t,n,i){this.tileID=new e.aM(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=n,this.worldview=i}parse(t,n,i,r){this.status="parsing";const o=new e.aM(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),s=[],a=n.familiesBySource[i.source],l=new e.fc(o,i.promoteId);l.bucketLayerIDs=[],l.is3DTile=!0,e.fr(t).then(t=>{if(!t)return r(new Error("Could not parse tile"));const n=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),u=new e.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const r in a)for(const h of a[r]){const r=h[0];l.bucketLayerIDs.push(h.map(t=>e.C(t.id,t.scope))),r.recalculate(u,[]);const a=e.fs(t,1/e.d4(i.tileID.canonical)),d=new e.ft(h,a,o,n,c,this.brightness,l,this.worldview);n||(d.needsUpload=!0),s.push(d),d.evaluate(r)}this.status="done",r(null,{buckets:s,featureIndex:l,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(e=>r(new Error(e.message)))}}class Ee{constructor(e,t,n,i,r,o,s,a){this.actor=e,this.layerIndex=t,this.availableImages=n,this.availableModels=i,this.brightness=s,this.loading={},this.loaded={},this.worldview=a}loadTile(t,n){const i=t.uid,r=this.loading[i]=new we(t,this.brightness,this.worldview);e.br(t.request,(e,o)=>{const s=!this.loading[i];return delete this.loading[i],s||e?(r.status="done",s||(this.loaded[i]=r),n(e)):o&&0!==o.byteLength?void r.parse(o,this.layerIndex,t,(e,t)=>{r.status="done",this.loaded=this.loaded||{},this.loaded[i]=r,e||!t?n(e):n(null,t)}):(r.status="done",this.loaded[i]=r,n())})}reloadTile(e,t){const n=this.loaded,i=e.uid;if(n&&n[i]){const r=n[i];r.projection=e.projection,r.brightness=e.brightness;const o=(n,i)=>{r.reloadCallback&&(delete r.reloadCallback,this.loadTile(e,t)),t(n,i)};"parsing"===r.status?r.reloadCallback=o:"done"===r.status&&this.loadTile(e,t)}}abortTile(e,t){const n=e.uid;this.loading[n]&&delete this.loading[n],t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}}class Te{constructor(t){this.self=t,this.actor=new e.fv(t,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new e.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=e.cj({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:be,"raster-dem":u,"raster-array":d,"batched-model":Ee},this.workerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.fw.isParsed())throw new Error("RTL text plugin already registered.");e.fw.setState({pluginStatus:e.fx.parsed,pluginURL:e.fw.getPluginURL()}),e.fw.applyArabicShaping=t.applyArabicShaping,e.fw.processBidirectionalText=t.processBidirectionalText,e.fw.processStyledBidirectionalText=t.processStyledBidirectionalText;for(const e of this.rtlPluginParsingListeners)e(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(e,t,n){delete this.layerIndexes[e],delete this.availableImages[e],delete this.availableModels[e],delete this.workerSources[e],n()}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,n){this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={});const{scope:i,isLoaded:r}=n;if(this.isSpriteLoaded[t][i]=r,this.workerSources[t]&&this.workerSources[t][i])for(const o in this.workerSources[t][i]){const n=this.workerSources[t][i][o];for(const t in n){const i=n[t];i instanceof c&&(i.isSpriteLoaded=r,i.fire(new e.A("isSpriteLoaded")))}}}setImages(e,t,n){this.availableImages[e]||(this.availableImages[e]={});const{scope:i,images:r}=t;if(this.availableImages[e][i]=r,this.workerSources[e]&&this.workerSources[e][i]){for(const t in this.workerSources[e][i]){const n=this.workerSources[e][i][t];for(const e in n)n[e].availableImages=r}n()}else n()}setModels(e,t,n){let{scope:i,models:r}=t;if(this.availableModels[e]||(this.availableModels[e]={}),this.availableModels[e][i]=r,this.workerSources[e]&&this.workerSources[e][i]){for(const t in this.workerSources[e][i]){const n=this.workerSources[e][i][t];for(const e in n)n[e].availableModels=r}n()}else n()}setProjection(t,n){this.projections[t]=e.cj(n)}setBrightness(e,t,n){this.brightness=t,n()}setWorldview(e,t,n){this.worldview=t,n()}setLayers(e,t,n){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),n()}updateLayers(e,t,n){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),n()}loadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,n)}decodeRasterArray(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).decodeRasterArray(t,n)}reloadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,n)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,n)}removeSource(e,t,n){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const i=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}syncRTLPluginState(t,n,i){if(e.fw.isParsed())i(null,!0);else if(e.fw.isParsing())this.rtlPluginParsingListeners.push(i);else try{e.fw.setState(n);const t=e.fw.getPluginURL();!e.fw.isLoaded()||e.fw.isParsed()||e.fw.isParsing()||null==t||(e.fw.setState({pluginStatus:e.fx.parsing,pluginURL:e.fw.getPluginURL()}),this.self.importScripts(t),e.fw.isParsed()?i(null,!0):this.rtlPluginParsingListeners.push(i))}catch(e){i(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let n=this.availableImages[e][t];return n||(n=[]),n}getAvailableModels(e,t){this.availableModels[e]||(this.availableModels[e]={});let n=this.availableModels[e][t];return n||(n={}),n}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let n=this.layerIndexes[e][t];return n||(n=this.layerIndexes[e][t]=new r,n.scope=t),n}getWorkerSource(e,t,n,i){const r=this.workerSources;return r[e]||(r[e]={}),r[e][i]||(r[e][i]={}),r[e][i][t]||(r[e][i][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),r[e][i][t][n]||(r[e][i][t][n]=new this.workerSourceTypes[t]({send:(t,n,i,r,o,s)=>this.actor.send(t,n,i,e,o,s),scheduler:this.actor.scheduler},this.getLayerIndex(e,i),this.getAvailableImages(e,i),this.getAvailableModels(e,i),this.isSpriteLoaded[e][i],void 0,this.brightness,this.worldview)),r[e][i][t][n]}rasterizeImagesWorker(e,t,n){const i=new Map;for(const[r,{image:o,imageVariant:s}]of t.tasks.entries()){const n=this.imageRasterizer.rasterize(s,o,t.scope,e);i.set(r,n)}n(void 0,i)}removeRasterizedImages(e,t,n){this.imageRasterizer.removeImagesFromCacheByIds(t.imageIds,t.scope,e),n()}enforceCacheSizeLimit(t,n){e.fy(n)}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}return e.fu(self)&&(self.worker=new Te(self)),Te}),s(["./shared"],function(e){var t="3.14.0";const n={create:"create",load:"load",fullLoad:"fullLoad"},s={mark(e){performance.mark(e)},measure(e,t,n){performance.measure(e,t,n)}};function a(t){const n=t.name.split("?")[0];return e.a(n)&&n.includes("mapbox-gl.js")?"javascript":e.a(n)&&n.includes("mapbox-gl.css")?"css":e.b(n)?"fontRange":e.c(n)?"sprite":e.i(n)?"style":e.d(n)?"tilejson":"other"}var l,c={},u=function(){if(l)return c;function e(e){return!t(e)}function t(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{t=new Worker(i),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(i),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===n[i=t&&t.failIfMajorPerformanceCaveat]&&(n[i]=function(t){var n,i=function(t){var n=document.createElement("canvas"),i=Object.create(e.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,n.getContext("webgl2",i)}(t);if(!i)return!1;try{n=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!n||i.isContextLost())&&(i.shaderSource(n,"void main() {}"),i.compileShader(n),!0===i.getShaderParameter(n,i.COMPILE_STATUS))}(i)),n[i]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var i}l=1,c.supported=e,c.notSupportedReason=t;var n={};return e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},c}();function h(e,t,n){const i=document.createElement(e);return null!=t&&(i.className=t),n&&n.appendChild(i),i}function d(e,t,n){const i=document.createElementNS("http://www.w3.org/2000/svg",e);for(const r of Object.keys(t))i.setAttributeNS(null,r,String(t[r]));return n&&n.appendChild(i),i}const f="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,p=f&&void 0!==f.userSelect?"userSelect":"WebkitUserSelect";let m;function g(){f&&p&&(m=f[p],f[p]="none")}function _(){f&&p&&(f[p]=m)}function y(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",y,!0)}function v(){window.addEventListener("click",y,!0),window.setTimeout(()=>{window.removeEventListener("click",y,!0)},0)}function x(e,t){const n=e.getBoundingClientRect();return E(e,n,t)}function b(e,t){const n=e.getBoundingClientRect(),i=[];for(let r=0;r<t.length;r++)i.push(E(e,n,t[r]));return i}function w(e){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===e.button&&e.ctrlKey?0:e.button}function E(t,n,i){const r=t.offsetWidth===n.width?1:t.offsetWidth/n.width;return new e.P((i.clientX-n.left)*r,(i.clientY-n.top)*r)}const T="01",A="NO_ACCESS_TOKEN";class S{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",T,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(n,i){if(!e.j(n))return n;const r=C(n);return r.params.push("sdk=js-".concat(t)),r.path="/styles/v1".concat(r.path),this._makeAPIURL(r,this._customAccessToken||i)}normalizeGlyphsURL(t,n){if(!e.j(t))return t;const i=C(t);return i.path="/fonts/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||n)}normalizeModelURL(t,n){if(!e.j(t))return t;const i=C(t);return i.path="/models/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||n)}normalizeSourceURL(t,n,i,r){if(!e.j(t))return t;const o=C(t);return o.path="/v4/".concat(o.authority,".json"),o.params.push("secure"),i&&o.params.push("language=".concat(i)),r&&o.params.push("worldview=".concat(r)),this._makeAPIURL(o,this._customAccessToken||n)}normalizeIconsetURL(t,n){const i=C(t);return e.j(t)?(i.path="/styles/v1".concat(i.path,"/iconset.pbf"),this._makeAPIURL(i,this._customAccessToken||n)):I(i)}normalizeSpriteURL(t,n,i,r){const o=C(t);return e.j(t)?(o.path="/styles/v1".concat(o.path,"/sprite").concat(n).concat(i),this._makeAPIURL(o,this._customAccessToken||r)):(o.path+="".concat(n).concat(i),I(o))}normalizeTileURL(t,n,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!e.j(t))return t;const r=C(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(n||i&&"raster"!==r.authority&&512===i?"@2x":"").concat(e.l.supported?".webp":"$1")),"raster"===r.authority?r.path="/".concat(e.e.RASTER_URL_PREFIX).concat(r.path):"rasterarrays"===r.authority?r.path="/".concat(e.e.RASTERARRAYS_URL_PREFIX).concat(r.path):"3dtiles"===r.authority?r.path="/".concat(e.e.TILES3D_URL_PREFIX).concat(r.path):(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/".concat(e.e.TILE_URL_VERSION).concat(r.path));const o=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(r.params)||e.e.ACCESS_TOKEN;return e.e.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&r.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(r,o)}canonicalizeTileURL(t,n){const i=C(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+="raster/".concat(i.path.replace("/".concat(e.e.RASTER_URL_PREFIX,"/"),"")):i.path.match(/^\/rasterarrays\/v1\//)?r+="rasterarrays/".concat(i.path.replace("/".concat(e.e.RASTERARRAYS_URL_PREFIX,"/"),"")):r+="tiles/".concat(i.path.replace("/".concat(e.e.TILE_URL_VERSION,"/"),""));let o=i.params;return n&&(o=o.filter(e=>!e.match(/^access_token=/))),o.length&&(r+="?".concat(o.join("&"))),r}canonicalizeTileset(t,n){const i=!!n&&e.j(n),r=[];for(const o of t.tiles||[])e.k(o)?r.push(this.canonicalizeTileURL(o,i)):r.push(o);return r}_makeAPIURL(t,n){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=C(e.e.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==r.path&&(t.path="".concat(r.path).concat(t.path)),!e.e.REQUIRE_ACCESS_TOKEN)return I(t);if(n=n||e.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error("An API access token is required to use Mapbox GL. ".concat(i));if("s"===n[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(i))}return t.params=t.params.filter(e=>-1===e.indexOf("access_token")),t.params.push("access_token=".concat(n||"")),I(t)}}const D=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function C(e){const t=e.match(D);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function I(e){const t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}const R="mapbox.eventData";function P(t){if(!t)return null;const n=t.split(".");if(!n||3!==n.length)return null;try{return JSON.parse(e.m(n[1]))}catch(e){return null}}class M{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=P(e.e.ACCESS_TOKEN);let i="";return i=n&&n.u?e.f(n.u):e.e.ACCESS_TOKEN||"",t?"".concat(R,".").concat(t,":").concat(i):"".concat(R,":").concat(i)}fetchEventData(){const t=e.s("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{const e=localStorage.getItem(n);e&&(this.eventData=JSON.parse(e));const t=localStorage.getItem(i);t&&(this.anonId=t)}catch(t){e.w("Unable to read from LocalStorage")}}saveEventData(){const t=e.s("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid"),r=this.anonId;if(t&&r)try{localStorage.setItem(i,r),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch(t){e.w("Unable to write to LocalStorage")}}processRequests(e){}postEvent(t,n,i,r){if(!e.e.EVENTS_URL)return;const o=C(e.e.EVENTS_URL);o.params.push("access_token=".concat(r||e.e.ACCESS_TOKEN||""));const s={event:this.type,created:new Date(t).toISOString()},a=n?e.h(s,n):s,l={url:I(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=e.p(l,e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const F=new class extends M{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(t,n){e.e.EVENTS_URL&&e.e.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>e.j(t)||e.k(t))&&this.queueRequest(Date.now(),n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=P(e.e.ACCESS_TOKEN),r=i?i.u:e.e.ACCESS_TOKEN;let o=r!==this.eventData.tokenU;e.v(this.anonId)||(this.anonId=e.u(),o=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(s),n=(s-this.eventData.lastSuccess)/864e5;o=o||n>=1||n<-1||e.getDate()!==t.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:T,"enabled.telemetry":!1,userId:this.anonId},e=>{e||(this.eventData.lastSuccess=s,this.eventData.tokenU=r)},n):this.processRequests()}},L=F.postTurnstileEvent.bind(F),k=new class extends M{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,n,i,r){this.skuToken=n,this.errorCb=r,e.e.EVENTS_URL&&(i||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(A)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:r}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),e.v(this.anonId)||(this.anonId=e.u()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:T,skuToken:this.skuToken,userId:this.anonId},e=>{e?this.errorCb(e):i&&(this.success[i]=!0)},n))}remove(){this.errorCb=null}},O=k.postMapLoadEvent.bind(k),B=new class extends M{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let n=this.mapInstanceIdMap.get(t);return n||(n=e.u(),this.mapInstanceIdMap.set(t,n)),n}getEventId(e){const t=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,t+1),t}postStyleLoadEvent(t,n){const{map:i,style:r,importedStyles:o}=n;if(!e.e.EVENTS_URL||!t&&!e.e.ACCESS_TOKEN)return;const s=this.getMapInstanceId(i),a={mapInstanceId:s,eventId:this.getEventId(s),style:r};o.length&&(a.importedStyles=o),this.queueRequest({timestamp:Date.now(),payload:a},t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},e)}},z=B.postStyleLoadEvent.bind(B),N=new class extends M{constructor(){super("gljs.performance")}postPerformanceEvent(t,n){e.e.EVENTS_URL&&(t||e.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},t)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:o}=this.queue.shift(),s=function(i){const r=performance.getEntriesByType("resource"),o=performance.getEntriesByType("mark"),s=function(e){const t={};if(e)for(const n in e)if("other"!==n)for(const i of e[n]){const e="".concat(n,"ResolveRangeMin"),r="".concat(n,"ResolveRangeMax"),o="".concat(n,"RequestCount"),s="".concat(n,"RequestCachedCount");t[e]=Math.min(t[e]||1/0,i.startTime),t[r]=Math.max(t[r]||-1/0,i.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==i.transferSize&&0===i.transferSize&&a(s),a(o)}return t}(function(e,t){const n={};if(e)for(const i of e){const e=t(i);void 0===n[e]&&(n[e]=[]),n[e].push(i)}return n}(r,a)),l=window.devicePixelRatio,c=navigator.connection||navigator.mozConnection||navigator.webkitConnection,u=c?c.effectiveType:void 0,h={counters:[],metadata:[],attributes:[]},d=(e,t,n)=>{null!=n&&e.push({name:t,value:n.toString()})};for(const e in s)d(h.counters,e,s[e]);if(i.interactionRange[0]!==1/0&&i.interactionRange[1]!==-1/0&&(d(h.counters,"interactionRangeMin",i.interactionRange[0]),d(h.counters,"interactionRangeMax",i.interactionRange[1])),o)for(const e of Object.keys(n)){const t=n[e],i=o.find(e=>e.name===t);i&&d(h.counters,t,i.startTime)}return d(h.counters,"visibilityHidden",i.visibilityHidden),d(h.attributes,"style",function(t){if(t)for(const n of t){const t=n.name.split("?")[0];if(e.i(t)){const e=t.split("/").slice(-2);if(2===e.length)return"mapbox://styles/".concat(e[0],"/").concat(e[1])}}}(r)),d(h.attributes,"terrainEnabled",i.terrainEnabled?"true":"false"),d(h.attributes,"fogEnabled",i.fogEnabled?"true":"false"),d(h.attributes,"projection",i.projection),d(h.attributes,"zoom",i.zoom),d(h.metadata,"devicePixelRatio",l),d(h.metadata,"connectionEffectiveType",u),d(h.metadata,"navigatorUserAgent",navigator.userAgent),d(h.metadata,"screenWidth",window.screen.width),d(h.metadata,"screenHeight",window.screen.height),d(h.metadata,"windowWidth",window.innerWidth),d(h.metadata,"windowHeight",window.innerHeight),d(h.metadata,"mapWidth",i.width/l),d(h.metadata,"mapHeight",i.height/l),d(h.metadata,"webglRenderer",i.renderer),d(h.metadata,"webglVendor",i.vendor),d(h.metadata,"sdkVersion",t),d(h.metadata,"sdkIdentifier","mapbox-gl-js"),h}(o);for(const e of s.metadata);for(const e of s.counters);for(const e of s.attributes);this.postEvent(r,s,()=>{},i)}},U=N.postPerformanceEvent.bind(N),V=new class extends M{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,n,i,r){if(!e.e.API_URL||!e.e.SESSION_PATH)return;const o=C(e.e.API_URL+e.e.SESSION_PATH);o.params.push("sku=".concat(n||"")),o.params.push("access_token=".concat(r||e.e.ACCESS_TOKEN||""));const s={url:I(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=e.g(s,e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,n,i,r){this.skuToken=n,this.errorCb=r,e.e.SESSION_PATH&&e.e.API_URL&&(i||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(A)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e)}remove(){this.errorCb=null}},j=V.getSessionAPI.bind(V),G=new Set;function H(e,t){t?G.add(e):G.delete(e)}class W{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(e){return this._updatedImages[e]?Array.from(this._updatedImages[e].values()):[]}updateImage(t,n){this._updatedImages[n]=this._updatedImages[n]||new Set,this._updatedImages[n].add(e.I.toString(t)),this.setDirty()}resetUpdatedImages(e){this._updatedImages[e]&&this._updatedImages[e].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function q(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class X extends e.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,"raster"!==t&&e.t()&&(this.imageRasterizerDispatcher=new e.D(e.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new e.r({width:1,height:1}))}removeScope(e){this.loaded.delete(e),this.imageProviders.delete(e),this.images.delete(e),this.updatedImages.delete(e),this.callbackDispatchedThisFrame.delete(e),this.patterns.delete(e),this.atlasImage.delete(e);const t=this.atlasTexture.get(e);t&&(t.destroy(),this.atlasTexture.delete(e))}addImageProvider(e,t){this.imageProviders.has(t)||this.imageProviders.set(t,new Map),this.imageProviders.get(t).set(e.id,e)}removeImageProvider(e,t){this.imageProviders.has(t)&&this.imageProviders.get(t).delete(e)}getPendingImageProviders(){const e=[];for(const t of this.imageProviders.values())for(const n of t.values())n.hasPendingRequests()&&e.push(n);return e}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new e.y),this._imageRasterizer}isLoaded(){for(const e of this.loaded.keys())if(!this.loaded.get(e))return!1;return!0}setLoaded(e,t){if(this.loaded.get(t)!==e&&(this.loaded.set(t,e),e)){for(const{ids:e,callback:n}of this.requestors)this._notify(e,t,n);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images.get(t).get(e.toString())}addImage(e,t,n){this._validate(e,n)&&this.images.get(t).set(e.toString(),n)}_validate(t,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new e.z(new Error('Image "'.concat(t.name,'" has invalid "stretchX" value')))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new e.z(new Error('Image "'.concat(t.name,'" has invalid "stretchY" value')))),i=!1),this._validateContent(n.content,n)||(this.fire(new e.z(new Error('Image "'.concat(t.name,'" has invalid "content" value')))),i=!1),i}_validateStretch(e,t){if(!e)return!0;let n=0;for(const i of e){if(i[0]<n||i[1]<i[0]||t<i[1])return!1;n=i[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;if(!t.usvg){if(e[0]<0||t.data.width<e[0])return!1;if(e[1]<0||t.data.height<e[1])return!1;if(e[2]<0||t.data.width<e[2])return!1;if(e[3]<0||t.data.height<e[3])return!1}return!(e[2]<e[0]||e[3]<e[1])}updateImage(e,t,n){const i=this.images.get(t).get(e.toString());n.version=i.version+1,this.images.get(t).set(e.toString(),n),this.updatedImages.get(t).add(e),this.removeFromImageRasterizerCache(e,t)}clearUpdatedImages(e){this.updatedImages.get(e).clear()}removeFromImageRasterizerCache(t,n){"raster"!==this.spriteFormat&&(e.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([t],n))}removeImage(e,t){const n=this.images.get(t),i=n.get(e.toString());n.delete(e.toString()),this.patterns.get(t).delete(e.toString()),this.removeFromImageRasterizerCache(e,t),i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(t=>e.I.from(t))}getImages(e,t,n){const i=[],r=[],o=this.imageProviders.get(t);for(const c of e){if(!c.iconsetId){i.push(c);continue}const e=o.get(c.iconsetId);e&&(this.getImage(c,t)?r.push(c):e.addPendingRequest(c))}if(0===i.length)return void this._notify(r,t,n);let s=!0;const a=!!this.loaded.get(t),l=this.images.get(t);if(!a)for(const c of i)l.has(c.toString())||(s=!1);a||s?this._notify(i,t,n):this.requestors.push({ids:i,scope:t,callback:n})}rasterizeImages(e,t){const n=new Map,{tasks:i,scope:r}=e;for(const[o,s]of i.entries()){const e=this.getImage(s.id,r);e&&n.set(o,{image:e,imageVariant:s})}this._rasterizeImages(r,n,t)}_rasterizeImages(t,n,i){if(e.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:n,scope:t},i);else{const e=new Map;for(const[i,{image:r,imageVariant:o}]of n.entries())e.set(i,this.imageRasterizer.rasterize(o,r,t,0));i(void 0,e)}}getUpdatedImages(e){return this.updatedImages.get(e)||new Set}_notify(t,n,i){const r=this.images.get(n),o=new Map;for(const s of t){if(!r.get(s.toString())){if(s.iconsetId)continue;this.fire(new e.A("styleimagemissing",{id:s.name}))}const t=r.get(s.toString());if(!t){e.w('Image "'.concat(s.name,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'));continue}const n={data:t.usvg?null:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,usvg:t.usvg,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)};t.usvg&&Object.assign(n,{width:t.icon.usvg_tree.width,height:t.icon.usvg_tree.height}),o.set(e.I.toString(s),n)}i(null,o)}getPixelSize(e){const{width:t,height:n}=this.atlasImage.get(e);return{width:t,height:n}}getPattern(t,n,i){const r=t.toString(),o=this.patterns.get(n),s=o.get(r),a=this.getImage(t,n);if(!a)return null;if(s){if(s.position.version===a.version)return s.position;s.position.version=a.version}else{if(a.usvg&&!a.data){const o=this.getPatternInFlightId(r,n);if(this.patternsInFlight.has(o))return null;this.patternsInFlight.add(o);const s=new e.B(t).scaleSelf(e.q.devicePixelRatio),l=new Map([[s.toString(),{image:a,imageVariant:s}]]);return this._rasterizeImages(n,l,(e,t)=>this.storePatternImage(s,n,a,i,t)),null}this.storePattern(t,n,a)}return this._updatePatternAtlas(n,i),o.get(r).position}getPatternInFlightId(t,n){return e.C(t,n)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(e,t,n,i,r){const o=e.toString(),s=r?r.get(o):void 0;s&&(n.data=s,this.storePattern(e.id,t,n),this._updatePatternAtlas(t,i),this.patternsInFlight.delete(this.getPatternInFlightId(e.id.toString(),t)))}storePattern(t,n,i){const r={w:i.data.width+2*e.F,h:i.data.height+2*e.F,x:0,y:0},o=new e.G(r,i,e.F);this.patterns.get(n).set(t.toString(),{bin:r,position:o})}destroyAtlasTextures(){for(const e of this.atlasTexture.values())e&&e.destroy();this.atlasTexture.clear()}bind(t,n){const i=t.gl;let r=this.atlasTexture.get(n);r?this.dirty&&(r.update(this.atlasImage.get(n)),this.dirty=!1):(r=new e.T(t,this.atlasImage.get(n),i.RGBA8),this.atlasTexture.set(n,r)),r.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const i=this.patterns.get(t),r=Array.from(i.values()).map(e=>{let{bin:t}=e;return t}),{w:o,h:s}=e.H(r),a=this.atlasImage.get(t);a.resize({width:o||1,height:s||1});const l=this.images.get(t);for(const[c,{bin:u,position:h}]of i.entries()){let t=h.padding;const i=u.x+t,r=u.y+t,o=l.get(c).data,s=o.width,d=o.height;t=t>1?t-1:t,e.r.copy(o,a,{x:0,y:0},{x:i,y:r},{width:s,height:d},n),e.r.copy(o,a,{x:0,y:d-t},{x:i,y:r-t},{width:s,height:t},n),e.r.copy(o,a,{x:0,y:0},{x:i,y:r+d},{width:s,height:t},n),e.r.copy(o,a,{x:s-t,y:0},{x:i-t,y:r},{width:t,height:d},n),e.r.copy(o,a,{x:0,y:0},{x:i+s,y:r},{width:t,height:d},n),e.r.copy(o,a,{x:s-t,y:d-t},{x:i-t,y:r-t},{width:t,height:t},n),e.r.copy(o,a,{x:0,y:d-t},{x:i+s,y:r-t},{width:t,height:t},n),e.r.copy(o,a,{x:0,y:0},{x:i+s,y:r+d},{width:t,height:t},n),e.r.copy(o,a,{x:s-t,y:0},{x:i-t,y:r+d},{width:t,height:t},n)}this.dirty=!0}beginFrame(){for(const e of this.images.keys())this.callbackDispatchedThisFrame.set(e,new Set)}dispatchRenderCallbacks(e,t){const n=this.images.get(t);for(const i of e){if(this.callbackDispatchedThisFrame.get(t).has(i.toString()))continue;this.callbackDispatchedThisFrame.get(t).add(i.toString());const e=n.get(i.toString());q(e)&&this.updateImage(i,t,e)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Z(t){const n=t.key,i=t.value,r=t.valueSpec||{},o=t.objectElementValidators||{},s=t.style,a=t.styleSpec;let l=[];const c=e.J(i);if("object"!==c)return[new e.V(n,i,"object expected, ".concat(c," found"))];for(const u in i){const t=u.split(".")[0];let c;o[t]?c=o[t]:r[t]?c=ge:o["*"]?c=o["*"]:r["*"]&&(c=ge),c?l=l.concat(c({key:(n?"".concat(n,"."):n)+u,value:i[u],valueSpec:r[t]||r["*"],style:s,styleSpec:a,object:i,objectKey:u},i)):l.push(new e.K(n,i[u],'unknown property "'.concat(u,'"')))}for(const u in r)o[u]||r[u].required&&void 0===r[u].default&&void 0===i[u]&&l.push(new e.V(n,i,'missing required property "'.concat(u,'"')));return l}function Y(t){const n=t.value,i=t.valueSpec,r=t.style,o=t.styleSpec,s=t.key,a=t.arrayElementValidator||ge;if("array"!==e.J(n))return[new e.V(s,n,"array expected, ".concat(e.J(n)," found"))];if(i.length&&n.length!==i.length)return[new e.V(s,n,"array length ".concat(i.length," expected, length ").concat(n.length," found"))];if(i["min-length"]&&n.length<i["min-length"])return[new e.V(s,n,"array length at least ".concat(i["min-length"]," expected, length ").concat(n.length," found"))];let l={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};o.$version<7&&(l.function=i.function),"object"===e.J(i.value)&&(l=i.value);let c=[];for(let e=0;e<n.length;e++)c=c.concat(a({array:n,arrayIndex:e,value:n[e],valueSpec:l,style:r,styleSpec:o,key:"".concat(s,"[").concat(e,"]")},!0));return c}function K(t){const n=t.key,i=t.value,r=t.valueSpec;let o=e.J(i);if("number"===o&&i!=i&&(o="NaN"),"number"!==o)return[new e.V(n,i,"number expected, ".concat(o," found"))];if("minimum"in r){let o=r.minimum;if("array"===e.J(r.minimum)&&(o=r.minimum[t.arrayIndex]),i<o)return[new e.V(n,i,"".concat(i," is less than the minimum value ").concat(o))]}if("maximum"in r){let o=r.maximum;if("array"===e.J(r.maximum)&&(o=r.maximum[t.arrayIndex]),i>o)return[new e.V(n,i,"".concat(i," is greater than the maximum value ").concat(o))]}return[]}function J(t){const n=t.valueSpec,i=e.M(t.value.type);let r,o,s,a={};const l="categorical"!==i&&void 0===t.value.property,c=!l,u="array"===e.J(t.value.stops)&&"array"===e.J(t.value.stops[0])&&"object"===e.J(t.value.stops[0][0]),h=Z({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new e.V(t.key,t.value,'identity function may not have a "stops" property')];let n=[];const r=t.value;return n=n.concat(Y({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:d})),"array"===e.J(r)&&0===r.length&&n.push(new e.V(t.key,r,"array must have at least one stop")),n},default:function(e){return ge({key:e.key,value:e.value,valueSpec:n,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&l&&h.push(new e.V(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||h.push(new e.V(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!e.N(t.valueSpec)&&h.push(new e.V(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!e.O(t.valueSpec)?h.push(new e.V(t.key,t.value,"property functions not supported")):l&&!e.Q(t.valueSpec)&&h.push(new e.V(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!u||void 0!==t.value.property||h.push(new e.V(t.key,t.value,'"property" property is required')),h;function d(t){let i=[];const r=t.value,l=t.key;if("array"!==e.J(r))return[new e.V(l,r,"array expected, ".concat(e.J(r)," found"))];if(2!==r.length)return[new e.V(l,r,"array length 2 expected, length ".concat(r.length," found"))];if(u){if("object"!==e.J(r[0]))return[new e.V(l,r,"object expected, ".concat(e.J(r[0])," found"))];if(void 0===r[0].zoom)return[new e.V(l,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new e.V(l,r,"object stop key must have value")];const n=e.M(r[0].zoom);if("number"!=typeof n)return[new e.V(l,r[0].zoom,"stop zoom values must be numbers")];if(s&&s>n)return[new e.V(l,r[0].zoom,"stop zoom values must appear in ascending order")];n!==s&&(s=n,o=void 0,a={}),i=i.concat(Z({key:"".concat(l,"[0]"),value:r[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:K,value:f}}))}else i=i.concat(f({key:"".concat(l,"[0]"),value:r[0],style:t.style,styleSpec:t.styleSpec},r));return e.S(e.U(r[1]))?i.concat([new e.V("".concat(l,"[1]"),r[1],"expressions are not allowed in function stops.")]):i.concat(ge({key:"".concat(l,"[1]"),value:r[1],valueSpec:n,style:t.style,styleSpec:t.styleSpec}))}function f(t,s){const l=e.J(t.value),c=e.M(t.value),u=null!==t.value?t.value:s;if(r){if(l!==r)return[new e.V(t.key,u,"".concat(l," stop domain type must match previous stop domain type ").concat(r))]}else r=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new e.V(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==i){let r="number expected, ".concat(l," found");return e.O(n)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(t.key,u,r)]}return"categorical"!==i||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==i&&"number"===l&&"number"==typeof c&&"number"==typeof o&&void 0!==o&&c<o?[new e.V(t.key,u,"stop domain values must appear in ascending order")]:(o=c,"categorical"===i&&c in a?[new e.V(t.key,u,"stop domain values must be unique")]:(a[c]=!0,[])):[new e.V(t.key,u,"integer expected, found ".concat(String(c)))]}}function Q(t){const n=("property"===t.expressionContext?e.W:e.X)(e.U(t.value),t.valueSpec);if("error"===n.result)return n.value.map(n=>new e.V("".concat(t.key).concat(n.key),t.value,n.message));const i=n.value.expression||n.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new e.V(t.key,t.value,'Invalid data expression for "'.concat(t.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.Y(i))return[new e.V(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return $(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.Z(i,["zoom","feature-state"]))return[new e.V(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e._(i))return[new e.V(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $(t,n){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const e of n.valueSpec.expression.parameters)i.delete(e);if(0===i.size)return[];const r=[];return t instanceof e.$&&i.has(t.name)?[new e.V(n.key,n.value,'["'.concat(t.name,'"] expression is not supported in a filter for a ').concat(n.object.type," layer with id: ").concat(n.object.id))]:(t.eachChild(e=>{r.push(...$(e,n))}),r)}function ee(t){const n=t.key,i=t.value,r=t.valueSpec,o=[];return Array.isArray(r.values)?-1===r.values.indexOf(e.M(i))&&o.push(new e.V(n,i,"expected one of [".concat(r.values.join(", "),"], ").concat(JSON.stringify(i)," found"))):-1===Object.keys(r.values).indexOf(e.M(i))&&o.push(new e.V(n,i,"expected one of [".concat(Object.keys(r.values).join(", "),"], ").concat(JSON.stringify(i)," found"))),o}function te(t){return e.a1(e.U(t.value))?Q(e.L({},t,{expressionContext:"filter",valueSpec:t.styleSpec["filter_".concat(t.layerType||"fill")]})):ne(t)}function ne(t){const n=t.value,i=t.key;if("array"!==e.J(n))return[new e.V(i,n,"array expected, ".concat(e.J(n)," found"))];const r=t.styleSpec;let o,s=[];if(n.length<1)return[new e.V(i,n,"filter array must have at least 1 element")];switch(s=s.concat(ee({key:"".concat(i,"[0]"),value:n[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),e.M(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===e.M(n[1])&&s.push(new e.V(i,n,'"$type" cannot be use with operator "'.concat(n[0],'"')));case"==":case"!=":3!==n.length&&s.push(new e.V(i,n,'filter array for operator "'.concat(n[0],'" must have 3 elements')));case"in":case"!in":n.length>=2&&(o=e.J(n[1]),"string"!==o&&s.push(new e.V("".concat(i,"[1]"),n[1],"string expected, ".concat(o," found"))));for(let a=2;a<n.length;a++)o=e.J(n[a]),"$type"===e.M(n[1])?s=s.concat(ee({key:"".concat(i,"[").concat(a,"]"),value:n[a],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&s.push(new e.V("".concat(i,"[").concat(a,"]"),n[a],"string, number, or boolean expected, ".concat(o," found")));break;case"any":case"all":case"none":for(let e=1;e<n.length;e++)s=s.concat(ne({key:"".concat(i,"[").concat(e,"]"),value:n[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":o=e.J(n[1]),2!==n.length?s.push(new e.V(i,n,'filter array for "'.concat(n[0],'" operator must have 2 elements'))):"string"!==o&&s.push(new e.V("".concat(i,"[1]"),n[1],"string expected, ".concat(o," found")))}return s}function ie(t,n){const i=t.key,r=t.style,o=t.layer,s=t.styleSpec,a=t.value,l=t.objectKey,c=s["".concat(n,"_").concat(t.layerType)];if(!c)return[];const u=l.match(/^(.*)-use-theme$/);if("paint"===n&&u&&c[u[1]])return e.S(a)?[].concat(ge({key:t.key,value:a,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:r,styleSpec:s,expressionContext:"property",propertyType:n,propertyKey:l})):ge({key:i,value:a,valueSpec:{type:"string"},style:r,styleSpec:s});const h=l.match(/^(.*)-transition$/);if("paint"===n&&h&&c[h[1]]&&c[h[1]].transition)return ge({key:i,value:a,valueSpec:s.transition,style:r,styleSpec:s});const d=t.valueSpec||c[l];if(!d)return[new e.K(i,a,'unknown property "'.concat(l,'"'))];let f;if("string"===e.J(a)&&e.O(d)&&!d.tokens&&(f=/^{([^}]+)}$/.exec(a))){const t='`{ "type": "identity", "property": '.concat(f?JSON.stringify(f[1]):'"_"'," }`");return[new e.V(i,a,'"'.concat(l,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(t,"."))]}const p=[];if("symbol"===t.layerType)"text-field"!==l||!r||r.glyphs||r.imports||p.push(new e.V(i,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.a2(e.U(a))&&"identity"===e.M(a.type)&&p.push(new e.V(i,a,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===n&&o&&o.layout&&o.layout.hasOwnProperty("model-id")&&e.O(d)&&(e.a3(d)||e.Q(d))){const t=e.W(e.U(a),d),n=t.value.expression||t.value._styleExpression.expression;n&&!e.Z(n,["measure-light"])&&("model-emissive-strength"===l&&e._(n)&&e.Y(n)||p.push(new e.V(i,a,"".concat(l," does not support measure-light expressions when the model layer source is vector tile or GeoJSON."))))}return p.concat(ge({key:t.key,value:a,valueSpec:d,style:r,styleSpec:s,expressionContext:"property",propertyType:n,propertyKey:l}))}function re(e){return ie(e,"paint")}function oe(e){return ie(e,"layout")}function se(t){let n=[];const i=t.value,r=t.key,o=t.style,s=t.styleSpec;i.type||i.ref||n.push(new e.V(r,i,'either "type" or "ref" is required'));let a=e.M(i.type);const l=e.M(i.ref);if(i.id){const s=e.M(i.id);for(let a=0;a<t.arrayIndex;a++){const t=o.layers[a];e.M(t.id)===s&&n.push(new e.V(r,i.id,'duplicate layer id "'.concat(i.id,'", previously used at line ').concat(t.id.__line__)))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in i&&n.push(new e.V(r,i[t],'"'.concat(t,'" is prohibited for ref layers')))}),o.layers.forEach(n=>{e.M(n.id)===l&&(t=n)}),t?t.ref?n.push(new e.V(r,i.ref,"ref cannot reference another ref layer")):a=e.M(t.type):"string"==typeof l&&n.push(new e.V(r,i.ref,'ref layer "'.concat(l,'" not found')))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(i.source){const t=o.sources&&o.sources[i.source],s=t&&e.M(t.type);t?"vector"===s&&"raster"===a?n.push(new e.V(r,i.source,'layer "'.concat(i.id,'" requires a raster source'))):"raster"===s&&"raster"!==a?n.push(new e.V(r,i.source,'layer "'.concat(i.id,'" requires a vector source'))):"vector"!==s||i["source-layer"]?"raster-dem"===s&&"hillshade"!==a?n.push(new e.V(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==s||["raster","raster-particle"].includes(a)?"line"===a&&i.paint&&(i.paint["line-gradient"]||i.paint["line-trim-offset"])&&"geojson"===s&&!t.lineMetrics?n.push(new e.V(r,i,'layer "'.concat(i.id,'" specifies a line-gradient, which requires the GeoJSON source to have `lineMetrics` enabled.'))):"raster-particle"===a&&"raster-array"!==s&&n.push(new e.V(r,i.source,'layer "'.concat(i.id,"\" requires a 'raster-array' source."))):n.push(new e.V(r,i.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new e.V(r,i,'layer "'.concat(i.id,'" must specify a "source-layer"'))):n.push(new e.V(r,i.source,'source "'.concat(i.source,'" not found')))}else n.push(new e.V(r,i,'missing required property "source"'));return n=n.concat(Z({key:r,value:i,valueSpec:s.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ge({key:"".concat(r,".type"),value:i.type,valueSpec:s.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:t=>te(e.L({layerType:a},t)),layout:t=>Z({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>oe(e.L({layerType:a},t))}}),paint:t=>Z({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>re(e.L({layerType:a,layer:i},t))}})}})),n}function ae(t){const n=t.value,i=t.key,r=e.J(n);return"string"!==r?[new e.V(i,n,"string expected, ".concat(r," found"))]:[]}const le={promoteId:function t(n){let{key:i,value:r}=n;if("string"===e.J(r))return ae({key:i,value:r});if(Array.isArray(r)){const t=[],n=e.U(r),o=e.X(n);return"error"===o.result&&o.value.forEach(n=>{t.push(new e.V("".concat(i).concat(n.key),null,"".concat(n.message)))}),e.Z(o.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||t.push(new e.V("".concat(i),null,"promoteId expression should be only feature dependent")),t}{const e=[];for(const n in r)e.push(...t({key:"".concat(i,".").concat(n),value:r[n]}));return e}}};function ce(t){const n=t.value,i=t.key,r=t.styleSpec,o=t.style;if(!n.type)return[new e.V(i,n,'"type" is required')];const s=e.M(n.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(s)&&(n.url||n.tiles||a.push(new e.K(i,n,'Either "url" or "tiles" is required.'))),s){case"vector":case"raster":case"raster-dem":case"raster-array":return a=a.concat(Z({key:i,value:n,valueSpec:r["source_".concat(s.replace("-","_"))],style:t.style,styleSpec:r,objectElementValidators:le})),a;case"geojson":if(a=Z({key:i,value:n,valueSpec:r.source_geojson,style:o,styleSpec:r,objectElementValidators:le}),n.cluster)for(const e in n.clusterProperties){const[t,r]=n.clusterProperties[e],o="string"==typeof t?[t,["accumulated"],["get",e]]:t;a.push(...Q({key:"".concat(i,".").concat(e,".map"),value:r,expressionContext:"cluster-map"})),a.push(...Q({key:"".concat(i,".").concat(e,".reduce"),value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return Z({key:i,value:n,valueSpec:r.source_video,style:o,styleSpec:r});case"image":return Z({key:i,value:n,valueSpec:r.source_image,style:o,styleSpec:r});case"canvas":return[new e.V(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ee({key:"".concat(i,".type"),value:n.type,valueSpec:{values:ue(r)}})}}function ue(e){return e.source.reduce((t,n)=>{const i=e[n];return"enum"===i.type.type&&(t=t.concat(Object.keys(i.type.values))),t},[])}function he(t){const n=t.value,i=t.styleSpec,r=i.light,o=t.style;let s=[];const a=e.J(n);if(void 0===n)return s;if("object"!==a)return s=s.concat([new e.V("light",n,"object expected, ".concat(a," found"))]),s;for(const l in n){const t=l.match(/^(.*)-transition$/),a=l.match(/^(.*)-use-theme$/);s=s.concat(a&&r[a[1]]?ge({key:l,value:n[l],valueSpec:{type:"string"},style:o,styleSpec:i}):t&&r[t[1]]&&r[t[1]].transition?ge({key:l,value:n[l],valueSpec:i.transition,style:o,styleSpec:i}):r[l]?ge({key:l,value:n[l],valueSpec:r[l],style:o,styleSpec:i}):[new e.V(l,n[l],'unknown property "'.concat(l,'"'))])}return s}function de(t){const n=t.value;let i=[];if(!n)return i;const r=e.J(n);if("object"!==r)return i=i.concat([new e.V("light-3d",n,"object expected, ".concat(r," found"))]),i;const o=t.styleSpec,s=o["light-3d"],a=t.key,l=t.style,c=t.style.lights;for(const d of["type","id"])if(!(d in n))return i=i.concat([new e.V("light-3d",n,"missing property ".concat(d," on light"))]),i;if(n.type&&c)for(let d=0;d<t.arrayIndex;d++){const t=e.M(n.type),r=c[d];e.M(r.type)===t&&i.push(new e.V(a,n.id,'duplicate light type "'.concat(n.type,'", previously defined at line ').concat(r.id.__line__)))}const u="properties_light_".concat(n.type);if(!(u in o))return i=i.concat([new e.V("light-3d",n,"Invalid light type ".concat(n.type))]),i;const h=o[u];for(const d in n)if("properties"===d){const r=n[d],s=e.J(r);if("object"!==s)return i=i.concat([new e.V("properties",r,"object expected, ".concat(s," found"))]),i;for(const a in r){const s=a.match(/^(.*)-transition$/),c=a.match(/^(.*)-use-theme$/);i=i.concat(c&&h[c[1]]?ge({key:d,value:r[a],valueSpec:{type:"string"},style:l,styleSpec:o}):s&&h[s[1]]&&h[s[1]].transition?ge({key:d,value:n[d],valueSpec:o.transition,style:l,styleSpec:o}):h[a]?ge({key:a,value:r[a],valueSpec:h[a],style:l,styleSpec:o}):[new e.K(t.key,r[a],'unknown property "'.concat(a,'"'))])}}else i=i.concat(s[d]?ge({key:d,value:n[d],valueSpec:s[d],style:l,styleSpec:o}):[new e.K(d,n[d],'unknown property "'.concat(d,'"'))]);return i}function fe(t){const n=t.value,i=t.key,r=t.style,o=t.styleSpec,s=o.terrain;let a=[];const l=e.J(n);if(void 0===n)return a;if("null"===l)return a;if("object"!==l)return a=a.concat([new e.V("terrain",n,"object expected, ".concat(l," found"))]),a;for(const c in n){const t=c.match(/^(.*)-transition$/),i=c.match(/^(.*)-use-theme$/);a=a.concat(i&&s[i[1]]?ge({key:c,value:n[c],valueSpec:{type:"string"},style:r,styleSpec:o}):t&&s[t[1]]&&s[t[1]].transition?ge({key:c,value:n[c],valueSpec:o.transition,style:r,styleSpec:o}):s[c]?ge({key:c,value:n[c],valueSpec:s[c],style:r,styleSpec:o}):[new e.K(c,n[c],'unknown property "'.concat(c,'"'))])}if(n.source){const t=r.sources&&r.sources[n.source],o=t&&e.M(t.type);t?"raster-dem"!==o&&a.push(new e.V(i,n.source,"terrain cannot be used with a source of type ".concat(String(o),', it only be used with a "raster-dem" source type'))):a.push(new e.V(i,n.source,'source "'.concat(n.source,'" not found')))}else a.push(new e.V(i,n,'terrain is missing required property "source"'));return a}function pe(t){const n=t.value,i=t.style,r=t.styleSpec,o=r.fog;let s=[];const a=e.J(n);if(void 0===n)return s;if("object"!==a)return s=s.concat([new e.V("fog",n,"object expected, ".concat(a," found"))]),s;for(const l in n){const t=l.match(/^(.*)-transition$/),a=l.match(/^(.*)-use-theme$/);s=s.concat(a&&o[a[1]]?ge({key:l,value:n[l],valueSpec:{type:"string"},style:i,styleSpec:r}):t&&o[t[1]]&&o[t[1]].transition?ge({key:l,value:n[l],valueSpec:r.transition,style:i,styleSpec:r}):o[l]?ge({key:l,value:n[l],valueSpec:o[l],style:i,styleSpec:r}):[new e.K(l,n[l],'unknown property "'.concat(l,'"'))])}return s}const me={"*":()=>[],array:Y,boolean:function(t){const n=t.value,i=t.key,r=e.J(n);return"boolean"!==r?[new e.V(i,n,"boolean expected, ".concat(r," found"))]:[]},number:K,color:function(t){const n=t.key,i=t.value,r=e.J(i);return"string"!==r?[new e.V(n,i,"color expected, ".concat(r," found"))]:null===e.a0.parseCSSColor(i)?[new e.V(n,i,'color expected, "'.concat(i,'" found'))]:[]},enum:ee,filter:te,function:J,layer:se,object:Z,source:ce,model:e.a4,light:he,"light-3d":de,terrain:fe,fog:pe,string:ae,formatted:function(e){return 0===ae(e).length?[]:Q(e)},resolvedImage:function(e){return 0===ae(e).length?[]:Q(e)},projection:function(t){const n=t.value,i=t.styleSpec,r=i.projection,o=t.style;let s=[];const a=e.J(n);if("object"===a)for(const e in n)s=s.concat(ge({key:e,value:n[e],valueSpec:r[e],style:o,styleSpec:i}));else"string"!==a&&(s=s.concat([new e.V("projection",n,"object or string expected, ".concat(a," found"))]));return s},import:function(t){const{value:n,styleSpec:o}=t,{data:s}=n,a=i(n,r);Object.defineProperty(a,"__line__",{value:n.__line__,enumerable:!1});let l=Z(e.L({},t,{value:a,valueSpec:o.import}));return""===e.M(a.id)&&l.push(new e.V("".concat(t.key,".id"),a,"import id can't be an empty string")),s&&(l=l.concat(ye(s,o,{key:"".concat(t.key,".data")}))),l},iconset:function(t){const n=t.value,i=t.key,r=t.styleSpec,o=t.style;if(!n.type)return[new e.V(i,n,'"type" is required')];const s=e.M(n.type);let a=[];if(a=a.concat(Z({key:i,value:n,valueSpec:r["iconset_".concat(s)],style:o,styleSpec:r})),"source"===s&&n.source){const t=o.sources&&o.sources[n.source],r=t&&e.M(t.type);t?"raster-array"!==r&&a.push(new e.V(i,n.source,"iconset cannot be used with a source of type ".concat(String(r),', it only be used with a "raster-array" source type'))):a.push(new e.V(i,n.source,'source "'.concat(n.source,'" not found')))}return a}};function ge(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=t.value,r=t.valueSpec,o=t.styleSpec;if(r.expression&&e.a2(e.M(i)))return J(t);if(r.expression&&e.S(e.U(i)))return Q(t);if(r.type&&me[r.type]){const i=me[r.type](t);return!0===n&&i.length>0&&"array"===e.J(t.value)?Q(t):i}return Z(e.L({},t,{valueSpec:r.type?o[r.type]:r}))}function _e(t){const n=t.value,i=t.key,r=ae(t);return r.length||(-1===n.indexOf("{fontstack}")&&r.push(new e.V(i,n,'"glyphs" url must include a "{fontstack}" token')),-1===n.indexOf("{range}")&&r.push(new e.V(i,n,'"glyphs" url must include a "{range}" token'))),r}function ye(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.a5;return ge({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:t,valueSpec:n.$root,styleSpec:n,style:t,objectElementValidators:{glyphs:_e,"*":()=>[]}})}function ve(t){return Me(ye(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.a5))}const xe=e=>Me(ce(e)),be=e=>Me(he(e)),we=e=>Me(de(e)),Ee=e=>Me(fe(e)),Te=e=>Me(pe(e)),Ae=t=>Me(function(t){const n=t.value,i=t.style,r=t.styleSpec,o=r.snow;let s=[];const a=e.J(n);if(void 0===n)return s;if("object"!==a)return s=s.concat([new e.V("snow",n,"object expected, ".concat(a," found"))]),s;for(const l in n){const t=l.match(/^(.*)-transition$/);s=s.concat(t&&o[t[1]]&&o[t[1]].transition?ge({key:l,value:n[l],valueSpec:r.transition,style:i,styleSpec:r}):o[l]?ge({key:l,value:n[l],valueSpec:o[l],style:i,styleSpec:r}):[new e.K(l,n[l],'unknown property "'.concat(l,'"'))])}return s}(t)),Se=t=>Me(function(t){const n=t.value,i=t.style,r=t.styleSpec,o=r.rain;let s=[];const a=e.J(n);if(void 0===n)return s;if("object"!==a)return s=s.concat([new e.V("rain",n,"object expected, ".concat(a," found"))]),s;for(const l in n){const t=l.match(/^(.*)-transition$/);s=s.concat(t&&o[t[1]]&&o[t[1]].transition?ge({key:l,value:n[l],valueSpec:r.transition,style:i,styleSpec:r}):o[l]?ge({key:l,value:n[l],valueSpec:o[l],style:i,styleSpec:r}):[new e.K(l,n[l],'unknown property "'.concat(l,'"'))])}return s}(t)),De=e=>Me(se(e)),Ce=e=>Me(te(e)),Ie=e=>Me(re(e)),Re=e=>Me(oe(e)),Pe=t=>Me(e.a4(t));function Me(e){return e.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function Fe(t,n){let i=!1;if(n&&n.length)for(const r of n)r instanceof e.K?e.w(r.message):(t.fire(new e.z(new Error(r.message))),i=!0);return i}let Le;class ke extends e.E{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new e.a6(Le||(Le=new e.a7({anchor:new e.a8(e.a5.light.anchor),position:new e.a9(e.a5.light.position),color:new e.a8(e.a5.light.color),intensity:new e.a8(e.a5.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(be,e,n)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&Fe(this,t.call(ve,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let Oe=class extends e.E{constructor(t,n,i,r,o){super(),this.scope=i,this._transitionable=new e.a6(new e.a7({source:new e.a8(e.a5.terrain.source),exaggeration:new e.a8(e.a5.terrain.exaggeration)}),i,r),this._transitionable.setTransitionOrValue(t,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=o}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.aa(t,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const t=this._transitionable._values.exaggeration;if(!t)return null;const n=t.value.expression;if(!n)return null;let i=-1,r=-1,o=1;for(const s of n.zoomStops)o=n.evaluate(new e.aa(s,{worldview:this.worldview})),o>.01?(i=s,r=-1):r=s;return o<.01&&i>0&&r>i?[i,r]:null}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.ab}};const Be=45,ze=65,Ne=.05;function Ue(t,n,i,r){const o=e.af(Be,ze,i),[s,a]=Ve(t,r);let l=1-Math.min(1,Math.exp((n-s)/(a-s)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*o*t.alpha}function Ve(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}function je(t,n,i,r,o){const s=e.ad([],[n,i,r],o.mercatorFogMatrix);return Ue(t,e.ae(s),o.pitch,o._fov)}function Ge(t,n,i,r,o,s,a){const l=[[i,r,0],[o,r,0],[o,s,0],[i,s,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const h of l){const t=e.ad([],h,n),i=e.ae(t);c=Math.min(c,i),u=Math.max(u,i)}return[Ue(t,c,a.pitch,a._fov),Ue(t,u,a.pitch,a._fov)]}class He extends e.E{constructor(t,n,i,r){super();const o=new e.a7({range:new e.a8(e.a5.fog.range),color:new e.a8(e.a5.fog.color),"color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new e.a8(e.a5.fog["high-color"]),"high-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new e.a8(e.a5.fog["space-color"]),"space-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new e.a8(e.a5.fog["horizon-blend"]),"star-intensity":new e.a8(e.a5.fog["star-intensity"]),"vertical-range":new e.a8(e.a5.fog["vertical-range"])});this._transitionable=new e.a6(o,i,new Map(r)),this.set(t,r),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new e.ag(o),this.scope=i}get state(){const t=this._transform,n="globe"===t.projection.name,i=e.ah(t.zoom),r=this.properties.get("range"),o=[.5,3];return{range:n?[e.ai(o[0],r[0],i),e.ai(o[1],r[1],i)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Te,t,i))return;const r=e.h({},t);for(const o of Object.keys(e.a5.fog))void 0===r[o]&&(r[o]=e.a5.fog[o].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.af(Be,ze,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(t,n,i){const r=e.ac.fromLngLat(n),o=i.elevation?i.elevation.getAtPointOrZero(r):0;return je(t,r.x,r.y,o,i)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ge(this.state,n,0,0,e.aj,e.aj,this._transform)}getOpacityForBounds(e,t,n,i,r){return this._transform.projection.supportsFog?Ge(this.state,e,t,n,i,r,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?Ve(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const i of n){const n=t.points[i];let r;if(n[2]>=0)r=n;else{const o=t.points[i-4];r=e.ak(o,n,o[2]/(o[2]-n[2]))}if(je(this.state,r[0],r[1],0,this._transform)>=Ne)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&Fe(this,t.call(ve,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let We,qe,Xe,Ze,Ye=class extends e.E{constructor(t,n,i,r){super();const o=We||(We=new e.a7({density:new e.a8(e.a5.snow.density),intensity:new e.a8(e.a5.snow.intensity),color:new e.a8(e.a5.snow.color),opacity:new e.a8(e.a5.snow.opacity),vignette:new e.a8(e.a5.snow.vignette),"vignette-color":new e.a8(e.a5.snow["vignette-color"]),"center-thinning":new e.a8(e.a5.snow["center-thinning"]),direction:new e.a8(e.a5.snow.direction),"flake-size":new e.a8(e.a5.snow["flake-size"])}));this._transitionable=new e.a6(o,i,new Map(r)),this.set(t,r),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ag(o),this.scope=i}get state(){const t=this.properties.get("opacity"),n=this.properties.get("color"),i=this.properties.get("direction"),r=e.al(i[0]),o=-Math.max(e.al(i[1]),.01),s=[Math.cos(r)*Math.cos(o),Math.sin(r)*Math.cos(o),Math.sin(o)],a=this.properties.get("vignette"),l=this.properties.get("vignette-color");return l.a=a,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.am(n.r,n.g,n.b,n.a*t),direction:s,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:l}}get(){return this._transitionable.serialize()}set(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Ae,t,i))return;const r=e.h({},t);for(const o of Object.keys(e.a5.snow))void 0===r[o]&&(r[o]=e.a5.snow[o].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&Fe(this,t.call(ve,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}},Ke=class extends e.E{constructor(t,n,i,r){super();const o=qe||(qe=new e.a7({density:new e.a8(e.a5.rain.density),intensity:new e.a8(e.a5.rain.intensity),color:new e.a8(e.a5.rain.color),opacity:new e.a8(e.a5.rain.opacity),vignette:new e.a8(e.a5.rain.vignette),"vignette-color":new e.a8(e.a5.rain["vignette-color"]),"center-thinning":new e.a8(e.a5.rain["center-thinning"]),direction:new e.a8(e.a5.rain.direction),"droplet-size":new e.a8(e.a5.rain["droplet-size"]),"distortion-strength":new e.a8(e.a5.rain["distortion-strength"])}));this._transitionable=new e.a6(o,i,new Map(r)),this.set(t,r),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ag(o),this.scope=i}get state(){const t=this.properties.get("opacity"),n=this.properties.get("color"),i=this.properties.get("direction"),r=e.al(i[0]),o=-Math.max(e.al(i[1]),.01),s=[Math.cos(r)*Math.cos(o),Math.sin(r)*Math.cos(o),Math.sin(o)],a=this.properties.get("vignette-color");return a.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.am(n.r,n.g,n.b,n.a*t),direction:s,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:a}}get(){return this._transitionable.serialize()}set(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Se,t,i))return;const r=e.h({},t);for(const o of Object.keys(e.a5.rain))void 0===r[o]&&(r[o]=e.a5.rain[o].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&Fe(this,t.call(ve,e.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}};class Je extends e.E{constructor(t,n,i,r){super(),this.scope=i,this._options=t,this.properties=new e.ag(n),this._transitionable=new e.a6(n,i,new Map(r)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class Qe{constructor(e,t,n){this.screenBounds=e,this.cameraPoint=n.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=t,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(t,n){let i,r;if(t instanceof e.P||"number"==typeof t[0]){const o=e.P.convert(t);i=[o],r=n.isPointAboveHorizon(o)}else{const o=e.P.convert(t[0]),s=e.P.convert(t[1]),a=o.add(s)._div(2);i=[o,s],r=e.ao(o,s).every(e=>n.isPointAboveHorizon(e))&&n.isPointAboveHorizon(a)}return new Qe(i,r,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.ao(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],r=e.ao(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?r[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(r[3]=this.cameraPoint)),e.ap(r,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],r=e.ao(n,i,t),o=this.cameraPoint.clone();switch(3*((o.y>n.y)+(o.y>i.y))+((o.x>n.x)+(o.x>i.x))){case 0:r[0]=o,r[4]=o.clone();break;case 1:r.splice(1,0,o);break;case 2:r[1]=o;break;case 3:r.splice(4,0,o);break;case 5:r.splice(2,0,o);break;case 6:r[3]=o;break;case 7:r.splice(3,0,o);break;case 8:r[2]=o}return r}containsTile(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=t.queryPadding/n._pixelsPerMercatorPixel+1,s=i?this._bufferedCameraMercator(o,n):this._bufferedScreenMercator(o,n);let a=t.tileID.wrap+(s.unwrapped?r:0);const l=s.polygon.map(n=>e.aq(t.tileTransform,n,a));if(!e.ar(l,0,0,e.aj,e.aj))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const c=this.screenGeometryMercator.polygon.map(n=>e.as(t.tileTransform,n,a)),u=c.map(t=>new e.P(t[0],t[1])),h=n.getFreeCameraOptions().position||new e.ac(0,0,0),d=e.as(t.tileTransform,h,a),f=c.map(t=>{const n=e.at(t,t,d);return e.au(n,n),new e.av(d,n)}),p=e.aw(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:f,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.ax(l),m.min.x=e.ay(m.min.x,0,e.aj),m.min.y=e.ay(m.min.y,0,e.aj),m.max.x=e.ay(m.max.x,0,e.aj),m.max.y=e.ay(m.max.y,0,e.aj),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:p};var m}_bufferedScreenMercator(e,t){const n=tt(e);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._screenRaycastCache[n]=i,i}}_bufferedCameraMercator(e,t){const n=tt(e);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._cameraRaycastCache[n]=i,i}}_projectAndResample(t,n){const i=function(t,n){const i=e.az([],n.pixelMatrix,n.globeMatrix),r=[0,-e.aB,0,1],o=[0,e.aB,0,1],s=[0,0,0,1];e.aA(r,r,i),e.aA(o,o,i),e.aA(s,s,i);const a=new e.P(r[0]/r[3],r[1]/r[3]),l=new e.P(o[0]/o[3],o[1]/o[3]),c=e.aC(t,a)&&r[3]<s[3],u=e.aC(t,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(e,t,n){for(let i=1;i<e.length;i++){const r=et(t.pointCoordinate3D(e[i-1]).x),o=et(t.pointCoordinate3D(e[i]).x);if(n<0){if(r<o)return{idx:i,t:-r/(o-1-r)}}else if(o<r)return{idx:i,t:(1-r)/(o+1-r)}}return null}(t,n,c?-1:1);if(!h)return null;const{idx:d,t:f}=h;let p=d>1?$e(t.slice(0,d),n):[],m=d<t.length?$e(t.slice(d),n):[];p=p.map(t=>new e.P(et(t.x),t.y)),m=m.map(t=>new e.P(et(t.x),t.y));const g=[...p];0===g.length&&g.push(m[m.length-1]);const _=e.ai(g[g.length-1].y,(0===m.length?p[0]:m[0]).y,f);let y;return y=c?[new e.P(0,_),new e.P(0,0),new e.P(1,0),new e.P(1,_)]:[new e.P(1,_),new e.P(1,1),new e.P(0,1),new e.P(0,_)],g.push(...y),0===m.length?g.push(p[0]):g.push(...m),{polygon:g.map(t=>new e.ac(t.x,t.y)),unwrapped:!1}}(t,n);if(i)return i;const r=function(t,n){let i=!1,r=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>r&&(r=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const n=(o+e)%(t.length-1),r=t[n],s=t[n+1];Math.abs(r.x-s.x)>.5&&(r.x<s.x?(r.x+=1,0===n&&(t[t.length-1].x+=1)):(s.x+=1,n+1===t.length-1&&(t[0].x+=1)),i=!0)}const s=e.aD(n.center.lng);return i&&s<Math.abs(s-1)&&t.forEach(e=>{e.x-=1}),{polygon:t,unwrapped:i}}($e(t,n).map(t=>new e.P(et(t.x),t.y)),n);return{polygon:r.polygon.map(t=>new e.ac(t.x,t.y)),unwrapped:r.unwrapped}}}function $e(t,n){return e.aE(t,e=>{const t=n.pointCoordinate3D(e);e.x=t.x,e.y=t.y},1/256)}function et(e){return e<0?1+e%1:e%1}function tt(e){return 100*e|0}function nt(t,n,r,s,a){const l=function(i,r){if(i)return a(i);if(r){if(t.url&&r.tiles&&t.tiles&&delete t.tiles,r.variants){if(!Array.isArray(r.variants))return a(new Error("variants must be an array"));for(const t of r.variants){if(null==t||"object"!=typeof t||t.constructor!==Object)return a(new Error("variant must be an object"));if(!Array.isArray(t.capabilities))return a(new Error("capabilities must be an array"));if(1===t.capabilities.length&&"meshopt"===t.capabilities[0]){r=e.h(r,t);break}}}const i=e.aF(e.h({},r,t),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);i.tiles=n.canonicalizeTileset(i,t.url),a(null,i)}},c=function(e,t,n){if(!e)return null;if(!t&&!n)return e;n=n||e.worldview_default;const i=Object.values(e.language||{});if(0===i.length)return null;const r=Object.values(e.worldview||{});if(0===r.length)return null;const o=i.every(e=>e===t),s=r.every(e=>e===n);return o&&s?e:t in(e.language_options||{})||n in(e.worldview_options||{})?null:e.language_options&&e.worldview_options?e:null}(t.data,r,s);return c?e.q.frame(()=>l(null,c)):t.url?e.n(n.transformRequest(n.normalizeSourceURL(t.url,null,r,s),e.R.Source),l):e.q.frame(()=>{const{data:e}=t,n=i(t,o);l(null,n)})}function it(t,n){const i=Math.pow(2,n.z),r=Math.floor(e.aD(t.getWest())*i),o=Math.floor(e.aH(t.getNorth())*i),s=Math.ceil(e.aD(t.getEast())*i),a=Math.ceil(e.aH(t.getSouth())*i);return n.x>=r&&n.x<s&&n.y>=o&&n.y<a}class rt{constructor(t,n,i){this.bounds=t?e.aG.convert(this.validateBounds(t)):null,this.minzoom=n||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const n of t)this.extraBounds.push(e.aG.convert(this.validateBounds(n)))}}contains(e){if(e.z>this.maxzoom||e.z<this.minzoom)return!1;if(this.bounds&&!it(this.bounds,e))return!1;if(!this.extraBounds)return!0;for(const t of this.extraBounds)if(it(t,e))return!0;return!1}static fromTileJSON(e){if(!e.bounds&&!e.extra_bounds)return null;const t=new rt(e.bounds,e.minzoom,e.maxzoom);return t.addExtraBounds(e.extra_bounds),t}}class ot extends e.E{constructor(t,n,i,r){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.h(this,e.aF(n,["url","scheme","tileSize","promoteId"])),this._options=e.h({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new e.aI}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map.getWorldview();this._tileJSONRequest=nt(this._options,this.map._requestManager,n,i,(r,o)=>{if(this._tileJSONRequest=null,this._loaded=!0,r)n&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(n)),i&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(i)),this.fire(new e.z(r));else if(o){if(e.h(this,o),this.hasWorldviews=!!o.worldview_options,o.worldview_default&&(this.worldviewDefault=o.worldview_default),o.vector_layers){this.vectorLayers=o.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const e of o.vector_layers)this.vectorLayerIds.push(e.id),o.worldview&&o.worldview[e.source]&&this.localizableLayerIds.add(e.id)}this.tileBounds=rt.fromTileJSON(o),L(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(r)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.h({},this._options)}loadTile(t,n){const i=t.tileID.canonical.url(this.tiles,this.scheme),r=this.map._requestManager.normalizeTileURL(i),o=this.map._requestManager.transformRequest(r,e.R.Tile),s=this.map.style?this.map.style.getLut(this.scope):null,a=s?{image:s.image.clone()}:null,l={request:o,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:a,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&e.j(i)&&(l.localizableLayerIds=this.localizableLayerIds),l.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",l,c.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",l,c.bind(this),void 0,!0);else{const n=e.aJ.call({deduped:this._deduped},l,(e,n)=>{e||!n?c.call(this,e):(l.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},t.actor&&t.actor.send("loadTile",l,c.bind(this),void 0,!0))},!0);t.request={cancel:n}}function c(i,r){return delete t.request,t.aborted?n(null):i&&404!==i.status?n(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.aK(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class st extends e.E{constructor(t,n,i,r){super(),this.id=t,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.h({type:"raster"},n),e.h(this,e.aF(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const n=this.map.getWorldview();this._tileJSONRequest=nt(this._options,this.map._requestManager,null,n,(n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new e.z(n)):i&&(e.h(this,i),i.raster_layers&&(this.rasterLayers=i.raster_layers,this.rasterLayerIds=this.rasterLayers.map(e=>e.id)),this.tileBounds=rt.fromTileJSON(i),L(i.tiles),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.h({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,n){const i=e.q.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);t.request=e.o(this.map._requestManager.transformRequest(r,e.R.Tile),(i,r,o,s)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):i?(t.state="errored",n(i)):r?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s}),t.setTexture(r,this.map.painter),t.state="loaded",e.aK(this.dispatcher),void n(null)):n(null)))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t&&t()}unloadTile(t,n){t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class at extends st{constructor(t,n,i,r){super(t,n,i,r),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=e.h({type:"raster-array"},n)}triggerRepaint(e){const t=this.map.painter._terrain,n=this.map.style.getSourceCache(this.id);t&&t.enabled&&n&&t._clearRenderCacheForTile(n.id,e.tileID),this.map.triggerRepaint()}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),r=this.map._requestManager.transformRequest(i,e.R.Tile),o={request:r,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=r,t.actor||(t.actor=this.dispatcher.getActor());const s=(e,i,r,o)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(e){if("AbortError"===e.name)return;return t.state="errored",n(e)}if(this.map._refreshExpiredTiles&&i&&t.setExpiryData({cacheControl:r,expires:o}),this.partial)t.state="empty";else{if(!i)return n(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=i}n(null)};t.request=this.partial?t.fetchHeader(void 0,s.bind(this)):t.actor.send("loadTile",o,s.bind(this),void 0,!0)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){const n=e.texturePerLayer;if(e.flushAllQueues(),n.size){e.destroy(!0);for(const e of n.values())this.map.painter.saveTileTexture(e)}else e.destroy()}prepareTile(t,n,i,r){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBand(n,i,r,(n,r)=>{if(n)return t.state="errored",this.fire(new e.z(n)),void this.triggerRepaint(t);r&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(i,r,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find(t=>{let{id:n}=t;return n===e}),n=t&&t.fields,i=n&&n.bands&&n.bands;return i?i[0]:0}getTextureDescriptor(t,n,i){if(!t)return;const r=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!r)return;let o=null;n instanceof e.aN?o=n.paint.get("raster-array-band"):n instanceof e.aO&&(o=n.paint.get("raster-particle-array-band"));const s=o||this.getInitialBand(r);if(null==s)return;if(!t.textureDescriptorPerLayer.get(n.id))return void this.prepareTile(t,r,n.id,s);if(t.updateNeeded(n.id,s)&&!i)return;const a=t.textureDescriptorPerLayer.get(n.id);return Object.assign({},a,{texture:t.texturePerLayer.get(n.id)})}getImages(t,n){const i=new Map;for(const r of t)for(const t of n){const[n,o]=t.split("/"),s=r.getLayer(n);if(!s)continue;if(!s.hasBand(o)||!s.hasDataForBand(o))continue;const{bytes:a,tileSize:l,buffer:c}=s.getBandView(o),u=l+2*c,h={data:new e.r({width:u,height:u},a),pixelRatio:2,sdf:!1,usvg:!1,version:0};i.set(t,h)}return i}}const lt={vector:ot,raster:st,"raster-dem":class extends st{constructor(t,n,i,r){super(t,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=e.h({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,i){e&&(t.state="errored",n(e)),i&&(t.dem=i,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",n(null))}t.request=e.o(this.map._requestManager.transformRequest(i,e.R.Tile),function(i,o,s,a){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(i)t.state="errored",n(i);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:a});const n=ImageBitmap&&o instanceof ImageBitmap&&e.t(),i=1-(o.width-e.aL(o.width))/2;i<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=n?o:e.q.getImageData(o,i),c={uid:t.uid,tileID:t.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:i};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const n=t.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,o=0===n.x?t.wrap-1:t.wrap,s=(n.x+1+i)%i,a=n.x+1===i?t.wrap+1:t.wrap,l={};return l[new e.aM(t.overscaledZ,o,n.z,r,n.y).key]={backfilled:!1},l[new e.aM(t.overscaledZ,a,n.z,s,n.y).key]={backfilled:!1},n.y>0&&(l[new e.aM(t.overscaledZ,o,n.z,r,n.y-1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,a,n.z,s,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new e.aM(t.overscaledZ,o,n.z,r,n.y+1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,a,n.z,s,n.y+1).key]={backfilled:!1}),l}},"raster-array":at,geojson:class extends e.E{constructor(t,n,i,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=e.h({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),void 0!==n.minzoom&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const o=e.aj/this.tileSize;this.workerOptions=e.h({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*o,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*o,extent:e.aj,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:e.aj,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*o,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(t){if(!this._options.dynamic)return this.fire(new e.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof t&&("Feature"===t.type&&(t={type:"FeatureCollection",features:[t]}),"FeatureCollection"!==t.type))return this.fire(new e.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof t&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const e=new Map;for(const t of this._data.features)e.set(t.id,t);for(const n of t.features)e.set(n.id,n);this._data.features=[...e.values()]}else this._data=t;return this._updateWorkerData(!0),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:n},i),this}_updateWorkerData(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.A("dataloading",{dataType:"source"})),this._loaded=!1;const n=e.h({append:t},this.workerOptions);n.scope=this.scope;const i=this._data;"string"==typeof i?(n.request=this.map._requestManager.transformRequest(e.q.resolveURL(i),e.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(i),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),n,(n,i)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new e.z(n));else{const n={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(n.resourceTiming=i.resourceTiming[this.id]),t&&(this._partialReload=!0),this.fire(new e.A("data",n)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(t),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const t=e.C(this.id,this.scope);this.map.style.clearSource(t),this._updateWorkerData()}loadTile(t,n){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const r=this.map.style?this.map.style.getLut(this.scope):null,o=r?{image:r.image.clone()}:null,s=this._partialReload,a={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:o,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:s,worldview:this.map.getWorldview()};t.request=this.actor.send(i,a,(e,r)=>s&&!r?(t.state="loaded",n(null)):(delete t.request,t.destroy(),t.aborted?n(null):e?n(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===i),n(null))),void 0,"loadTile"===i)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e,t){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(e){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.aP{constructor(e,t,n,i){super(e,t,n,i),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,e.R.Source).url);e.aQ(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new e.z(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.z(new e.V("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(n.start(0)," and ").concat(n.end(0),"-second mark.")))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.aP,model:class extends e.E{constructor(e,t,n,i){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const t=[];for(const n in this._options.models){const i=this._options.models[n],r=e.aS(this.map._requestManager.transformRequest(i.uri,e.R.Model).url).then(t=>{if(!t)return;const r=e.aT(t),o=new e.aU(n,i.position,i.orientation,r);o.computeBoundsAndApplyParent(),this.models.push(o)}).catch(t=>{this.fire(new e.z(new Error("Could not load model ".concat(n," from ").concat(i.uri,": ").concat(t.message))))});t.push(r)}Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new e.z(new Error("Could not load models: ".concat(t.message))))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return this._options}},"batched-model":class extends e.E{constructor(e,t,n,i){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map.getWorldview();this._tileJSONRequest=nt(this._options,this.map._requestManager,n,i,(r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(n&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(n)),i&&2!==i.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(i)),this.fire(new e.z(r))):o&&(e.h(this,o),o.bounds&&(this.tileBounds=new rt(o.bounds,this.minzoom,this.maxzoom)),L(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:e.q.devicePixelRatio,promoteId:this.promoteId};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=n;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",r,o.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",r,o.bind(this),void 0,!0);function o(e,i){return t.aborted?n(null):e&&404!==e.status?n(e):(this.map._refreshExpiredTiles&&i&&t.setExpiryData(i),t.loadModelData(i,this.map.painter),t.state="loaded",void n(null))}}serialize(){return e.h({},this._options)}},canvas:class extends e.aP{constructor(t,n,i,r){super(t,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new e.z(new e.V("sources.".concat(t),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.z(new e.V("sources.".concat(t),null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new e.z(new e.V("sources.".concat(t),null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new e.z(new e.V("sources.".concat(t),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.z(new e.V("sources.".concat(t),null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(e){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,n,i,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=n,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.z(new Error("Missing implementation for ".concat(this.id," custom source")))),this._implementation.loadTile||this.fire(new e.z(new Error("Missing loadTile implementation for ".concat(this.id," custom source")))),this._implementation.bounds&&(this.tileBounds=new rt(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),e.h(this,e.aF(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this.map=t,this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:n,z:i}=e.canonical;return this._implementation.hasTile({x:t,y:n,z:i})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:n,y:i,z:r}=e.tileID.canonical,o=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:n,y:i,z:r},{signal:o.signal})).then(function(n){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===n?(e.state="errored",t(null)):null===n?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(n)?(this.loadTileData(e,n),e.state="loaded",void t(null)):(e.state="errored",t(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}.bind(this)).catch(n=>{"AbortError"!==n.name&&(e.state="errored",t(n))}),e.request.cancel=()=>o.abort()}loadTileData(e,t){e.setTexture(t,this.map.painter)}unloadTile(t,n){if(t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:n,z:i}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:n,z:i})}n&&n()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const t=e.C(this.id,this.scope);this.map.style.clearSource(t)}_update(){this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}}},ct=function(t,n,i,r){const o=new lt[n.type](t,n,i,r);if(o.id!==t)throw new Error("Expected Source id to be ".concat(t," instead of ").concat(o.id));return e.aV(["load","abort","unload","serialize","prepare"],o),o};function ut(e,t){return"".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",":").concat(t.id||"",":").concat(t.layer.id,":").concat(function(e){if("layerId"in e)return"layer:".concat(e.layerId);{const{featuresetId:t,importId:n}=e;return"featureset:".concat(t).concat(n?":import:".concat(n):"")}}(e.target))}function ht(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(e.uniqueFeatureID){const r=ut(e,t,i);if(n.has(r))return!0;n.add(r)}return!1}function dt(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=t.sourceCache.transform,s=t.sourceCache.tilesIn(e,t.has3DLayers,r);s.sort(mt);const a=[];for(const l of s){const e=l.tile.queryRenderedFeatures(t,l,n,i,o,r);Object.keys(e).length&&a.push({wrappedTileID:l.tile.tileID.wrapped().key,queryResults:e})}return 0===a.length?{}:function(e){const t={},n={};for(const i of e){const e=i.queryResults,r=i.wrappedTileID,o=n[r]=n[r]||{};for(const n in e){const i=e[n],r=o[n]=o[n]||{},s=t[n]=t[n]||[];for(const e of i)r[e.featureIndex]||(r[e.featureIndex]=!0,s.push(e))}}return t}(a)}function ft(e,t,n,i,r,o){const s={},a=i.queryRenderedSymbols(e),l=[];for(const c of Object.keys(a).map(Number))l.push(r[c]);l.sort(mt);for(const c of l){const e=c.featureIndex.lookupSymbolFeatures(a[c.bucketInstanceId],c.bucketIndex,c.sourceLayerIndex,t,n,o);for(const t in e){const n=s[t]=s[t]||[],i=e[t];i.sort((e,t)=>{const n=c.featureSortOrder;if(n){const i=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex});for(const e of i)n.push(e)}}return s}function pt(e,t){const n=e.getRenderableIds().map(t=>e.getTileByID(t)),i=[],r={};for(let o=0;o<n.length;o++){const e=n[o],s=e.tileID.canonical.key;r[s]||(r[s]=!0,e.querySourceFeatures(i,t))}return i}function mt(e,t){const n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function gt(e,t){const n={};if(!t)return n;for(const i of e){const e=i.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)n[t.fqid]=i}}return n}const _t=32,yt=33,vt=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,t=0,n=0,r=0,o=0,s=0,a=0;for(1&e?r=o=s=_t:t=n=a=_t;(e>>=1)>1;){const i=t+r>>1,l=n+o>>1;1&e?(r=t,o=n,t=s,n=a):(t=r,n=o,r=s,o=a),s=i,a=l}const l=4*i;vt[l+0]=t,vt[l+1]=n,vt[l+2]=r,vt[l+3]=o}const xt=new Uint16Array(2178),bt=new Uint8Array(1089),wt=new Uint16Array(1089);function Et(e){return 0===e?-.03125:32===e?.03125:0}const Tt={type:2,extent:e.aj,loadGeometry:()=>[[new e.P(0,0),new e.P(e.aj+1,0),new e.P(e.aj+1,e.aj+1),new e.P(0,e.aj+1),new e.P(0,0)]]};class At{constructor(t,n,i,r,o,s){this.tileID=t,this.uid=e.a$(),this.uses=0,this.tileSize=n,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=o,r&&r.style&&(this._lastUpdatedBrightness=r.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection),this.worldview=s}registerFadeDuration(t){const n=t+this.timeAdded;n<e.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,i){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=gt(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const n=this.buckets[t];if(n instanceof e.b1){if(this.hasSymbolBuckets=!0,!i)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const n=this.buckets[t];if(n instanceof e.b1&&n.hasRTLText){this.hasRTLText=!0,e.b2();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],i=n.style.getOwnLayer(e);if(!i)continue;const r=i.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,r)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new e.b0}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(e,t,n){e&&(e.resourceTiming&&(this.resourceTiming=e.resourceTiming),this.buckets=Object.assign({},this.buckets,gt(e.buckets,t.style)),e.featureIndex&&(this.latestFeatureIndex=e.featureIndex))}getBucket(e){return this.buckets[e.fqid]}upload(t){for(const e in this.buckets){const n=this.buckets[e];n.uploadPending()&&n.upload(t)}const n=t.gl,i=this.imageAtlas;i&&!i.uploaded&&(this.imageAtlasTexture=new e.T(t,i.image,n.RGBA8,{useMipmap:!!i.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,n){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,n),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const i=t.style.getBrightness();(this._lastUpdatedBrightness||i)&&(this._lastUpdatedBrightness&&i&&Math.abs(this._lastUpdatedBrightness-i)<.001||(this.updateBuckets(t,this._lastUpdatedBrightness!==i),this._lastUpdatedBrightness=i))}queryRenderedFeatures(t,n,i,r,o,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const a=function(t,n){const i=e.bn([],[.5*t.width,.5*-t.height,1]);return e.bo(i,i,[1,-1,0]),e.az(i,i,t.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(i)}(o,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:a,transform:r,availableImages:i,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),o=n?n.sourceLayer:"",s=r._geojsonTileLayer||r[o];if(!s)return;const a=e.b3(n&&n.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let d=0;d<s.length;d++){const n=s.feature(d);if(a.needGeometry){const t=e.b4(n,!0);if(!a.filter(new e.aa(this.tileID.overscaledZ,{worldview:this.worldview}),t,this.tileID.canonical))continue}else if(!a.filter(new e.aa(this.tileID.overscaledZ,{worldview:this.worldview}),n))continue;const r=i.getId(n,o),f=new e.b5(n,l,c,u,r);f.tile=h,t.push(f)}}loaded(){return"loaded"===this.state||"errored"===this.state}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const n=e.b6(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(n)if(this.expirationTime<n)t=!0;else{const i=this.expirationTime-n;i?this.expirationTime=e+Math.max(i,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(e){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&e&&this.updateBuckets(e)}updateBuckets(t,n){if(!this.latestFeatureIndex)return;if(!t.style)return;const i=this.latestFeatureIndex.loadVTLayers(),r=t.style.listImages(),o=t.style.getBrightness();for(const s in this.buckets){if(!t.style.hasLayer(s))continue;const a=this.buckets[s],l=a.layers[0],c=l.sourceLayer||"_geojsonTileLayer",u=i[c],h=t.style.getLayerSourceCache(l);let d={};h&&(d=h._state.getState(c,void 0));const f=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},p=Object.keys(d).length>0&&!n;p&&!a.stateDependentLayers.length&&!n||a.update(d,u,r,f,p?a.stateDependentLayers:a.layers,n,o),(a instanceof e.b7||a instanceof e.b8)&&t._terrain&&t._terrain.enabled&&h&&a.uploadPending()&&t._terrain._clearRenderCacheForTile(h.id,this.tileID);const m=t&&t.style&&t.style.getOwnLayer(s);m&&(this.queryPadding=Math.max(this.queryPadding,m.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.q.now()+t}setTexture(t,n){const i=n.context,r=i.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t):(this.texture=new e.T(i,t,r.RGBA8,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE))}setDependencies(e,t){const n={};for(const i of t)n[i]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const i=e.b9(Tt,this.tileID.canonical,this.tileTransform)[0],r=new e.ba,o=new e.bb;for(let e=0;e<i.length;e++){const{x:t,y:n}=i[e];r.emplaceBack(t,n),o.emplaceBack(e)}o.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(o),this._tileDebugBuffer=t.createVertexBuffer(r,e.bc.members),this._tileDebugSegments=e.bd.simpleSegment(0,0,r.length,o.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const i=e.b9(Tt,this.tileID.canonical,this.tileTransform)[0];let r,o;if(this.isRaster){const t=function(t,n){const i=e.aW(t,n),r=Math.pow(2,t.z);for(let u=0;u<yt;u++)for(let o=0;o<yt;o++){const s=e.aX((t.x+(o+Et(o))/_t)/r),a=e.aY((t.y+(u+Et(u))/_t)/r),l=n.project(s,a),c=u*yt+o;xt[2*c+0]=Math.round((l.x*i.scale-i.x)*e.aj),xt[2*c+1]=Math.round((l.y*i.scale-i.y)*e.aj)}bt.fill(0),wt.fill(0);for(let e=2045;e>=0;e--){const t=4*e,n=vt[t+0],i=vt[t+1],r=vt[t+2],o=vt[t+3],s=n+r>>1,a=i+o>>1,l=s+a-i,c=a+n-s,u=i*yt+n,h=o*yt+r,d=a*yt+s,f=Math.hypot((xt[2*u+0]+xt[2*h+0])/2-xt[2*d+0],(xt[2*u+1]+xt[2*h+1])/2-xt[2*d+1])>=16;bt[d]=bt[d]||(f?1:0),e<1022&&(bt[d]=bt[d]||bt[(i+c>>1)*yt+(n+l>>1)]||bt[(o+c>>1)*yt+(r+l>>1)])}const o=new e.aZ,s=new e.a_;let a=0;function l(t,n){const i=n*yt+t;return 0===wt[i]&&(o.emplaceBack(xt[2*i+0],xt[2*i+1],t*e.aj/_t,n*e.aj/_t),wt[i]=++a),wt[i]-1}function c(e,t,n,i,r,o){const a=e+n>>1,u=t+i>>1;if(Math.abs(e-r)+Math.abs(t-o)>1&&bt[u*yt+a])c(r,o,e,t,a,u),c(n,i,r,o,a,u);else{const a=l(e,t),c=l(n,i),u=l(r,o);s.emplaceBack(a,c,u)}}return c(0,0,_t,_t,_t,0),c(_t,_t,0,0,0,_t),{vertices:o,indices:s}}(this.tileID.canonical,n);r=t.vertices,o=t.indices}else{r=new e.aZ,o=new e.a_;for(const{x:e,y:n}of i)r.emplaceBack(e,n,0,0);const t=e.be(r.int16.subarray(0,4*r.length),void 0,4);for(let e=0;e<t.length;e+=3)o.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(r,e.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(o),this._tileBoundsSegments=e.bd.simpleSegment(0,0,r.length,o.length)}_makeGlobeTileDebugBuffers(t,n){const i=n.projection;if(!i||"globe"!==i.name||n.freezeTileCoverage)return;const r=this.tileID.canonical,o=e.bg(r,n),s=e.bh(o),a=e.ah(n.zoom);let l;a>0&&(l=e.bi(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,r,n,s,l,a),this._makeGlobeTileDebugTextBuffer(t,r,n,s,l,a)}_globePoint(t,n,i,r,o,s,a){let l=e.bj(t,n,i);if(s){const o=1<<i.z,c=e.aD(r.center.lng),u=e.aH(r.center.lat),h=(i.x+.5)/o-c;let d=0;h>.5?d=-1:h<-.5&&(d=1);let f=(t/e.aj+i.x)/o+d,p=(n/e.aj+i.y)/o;f=(f-c)*r._pixelsPerMercatorPixel+c,p=(p-u)*r._pixelsPerMercatorPixel+u;const m=[f*r.worldSize,p*r.worldSize,0];e.ad(m,m,s),l=e.bk(l,m,a)}return e.ad(l,l,o)}_makeGlobeTileDebugBorderBuffer(t,n,i,r,o,s){const a=new e.ba,l=new e.bb,c=new e.bl,u=(e,t,u,h,d)=>{const f=(u-e)/(d-1),p=(h-t)/(d-1),m=a.length;for(let g=0;g<d;g++){const u=e+g*f,h=t+g*p;a.emplaceBack(u,h);const d=this._globePoint(u,h,n,i,r,o,s);c.emplaceBack(d[0],d[1],d[2]),l.emplaceBack(m+g)}},h=e.aj;u(0,0,h,0,16),u(h,0,h,h,16),u(h,h,0,h,16),u(0,h,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(a,e.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.bm.members),this._tileDebugSegments=e.bd.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugTextBuffer(t,n,i,r,o,s){const a=e.aj/4,l=new e.ba,c=new e.a_,u=new e.bl,h=25;c.reserve(32),l.reserve(h),u.reserve(h);const d=(e,t)=>h*e+t;for(let e=0;e<h;e++){const t=e*a;for(let e=0;e<h;e++){const c=e*a;l.emplaceBack(c,t);const h=this._globePoint(c,t,n,i,r,o,s);u.emplaceBack(h[0],h[1],h[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const n=d(e,t),i=d(e,t+1),r=d(e+1,t),o=d(e+1,t+1);c.emplaceBack(n,i,r),c.emplaceBack(r,i,o)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(u,e.bm.members),this._tileDebugTextSegments=e.bd.simpleSegment(0,0,h,32)}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}e.bp.setPbf(e.bq);class St extends At{constructor(e,t,n,i,r){super(e,t,n,i,r),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(e){return this._mrt&&this._mrt.getLayer(e)}setTexturePerLayer(t,n,i){const r=i.context,o=r.gl;let s=this.texturePerLayer.get(t)||i.getTileTexture(n.width);s&&s instanceof e.T?s.update(n,{premultiply:!1}):s=new e.T(r,n,o.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,s)}flushQueues(e){const t=this._workQueuePerLayer.get(e)||[],n=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()();for(;n.length;)n.pop()()}flushAllQueues(){for(const e of this._workQueuePerLayer.keys()){const t=this._workQueuePerLayer.get(e)||[];for(;t.length;)t.pop()()}for(const e of this._fetchQueuePerLayer.keys()){const t=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()()}}fetchHeader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16384,n=arguments.length>1?arguments[1]:void 0;const i=this._mrt=new e.bp(30),r=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.br(r,(e,r,o,s)=>{if(e)n(e);else try{const e=i.getHeaderLength(r);if(e>t)return void(this.request=this.fetchHeader(e,n));i.parseHeader(r),this._isHeaderLoaded=!0;let a=0;for(const t of Object.values(i.layers))a=Math.max(a,t.dataIndex[t.dataIndex.length-1].lastByte);r.byteLength>=a&&(this.entireBuffer=r),n(null,this.entireBuffer||r,o,s)}catch(e){n(e)}}),this.request}fetchBand(t,n,i,r){const o=this._mrt;if(!this._isHeaderLoaded||!o)return void r(new Error("Tile header is not ready"));const s=this.actor;if(!s)return void r(new Error("Can't fetch tile band without an actor"));let a;const l=(e,o)=>{if(a.complete(e,o),e)return void r(e);this.updateTextureDescriptor(t,n,i);const s=this.textureDescriptorPerLayer.get(n);r(null,s&&s.img)},c=(e,t)=>{if(e)return r(e);const i=s.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:t,task:a},l,void 0,!0),o=this._workQueuePerLayer.get(n)||[];o.push(()=>{i&&i.cancel(),a.cancel()}),this._workQueuePerLayer.has(n)||this._workQueuePerLayer.set(n,o)},u=o.getLayer(t);if(!u)return void r(new Error('Unknown sourceLayer "'.concat(t,'"')));if(u.hasDataForBand(i)){this.updateTextureDescriptor(t,n,i);const e=this.textureDescriptorPerLayer.get(n);return void r(null,e?e.img:null)}const h=u.getDataRange([i]);if(a=o.createDecodingTask(h),!a||a.tasks.length)if(this.flushQueues(n),this.entireBuffer)c(null,this.entireBuffer.slice(h.firstByte,h.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:"bytes=".concat(h.firstByte,"-").concat(h.lastByte)}}),i=e.br(t,c),r=this._fetchQueuePerLayer.get(n)||[];r.push(()=>{i.cancel(),a.cancel()}),this._fetchQueuePerLayer.has(n)||this._fetchQueuePerLayer.set(n,r)}else r(null)}updateNeeded(e,t){return(!this.textureDescriptorPerLayer.get(e)||this.textureDescriptorPerLayer.get(e).band!==t)&&"errored"!==this.state}updateTextureDescriptor(t,n,i){if(!this._mrt)return;const r=this._mrt.getLayer(t);if(!r||!r.hasBand(i)||!r.hasDataForBand(i))return;const{bytes:o,tileSize:s,buffer:a,offset:l,scale:c}=r.getBandView(i),u=s+2*a,h=new e.r({width:u,height:u},o),d=this.texturePerLayer.get(n);d&&d instanceof e.T&&d.update(h,{premultiply:!1}),this.textureDescriptorPerLayer.set(n,{layer:t,band:i,img:h,buffer:a,offset:l,tileSize:s,format:r.pixelFormat,mix:[c,256*c,65536*c,16777216*c]})}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(super.destroy(t),delete this._mrt,!t)for(const n of this.texturePerLayer.values())n&&n instanceof e.T&&n.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Dt{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:t,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout(()=>{this.remove(e,r)},n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const n of t)this.remove(n.value.tileID,n)}}class Ct{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,i){const r=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},e.h(this.stateChanges[t][r],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])i[e]||(this.deletedStates[t][r][e]=null)}else for(const e in i)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(t,n){const i=this.state[t]||{},r=this.stateChanges[t]||{},o=this.deletedStates[t];if(null===o)return{};if(void 0!==n){const t=String(n),s=e.h({},i[t],r[t]);if(o){const e=o[n];if(null===e)return{};for(const t in e)delete s[t]}return s}const s=e.h({},i,r);if(o)for(const e in o)delete s[e];return s}initializeTileState(e,t){e.refreshFeatureState(t)}coalesceChanges(t,n){const i={};for(const r in this.stateChanges){this.state[r]=this.state[r]||{};const t={};for(const n in this.stateChanges[r])this.state[r][n]||(this.state[r][n]={}),e.h(this.state[r][n],this.stateChanges[r][n]),t[n]=this.state[r][n];i[r]=t}for(const r in this.deletedStates){this.state[r]=this.state[r]||{};const t={};if(null===this.deletedStates[r])for(const e in this.state[r])t[e]={},this.state[r][e]={};else for(const e in this.deletedStates[r]){if(null===this.deletedStates[r][e])this.state[r][e]={};else if(this.state[r][e])for(const t of Object.keys(this.deletedStates[r][e]))delete this.state[r][e][t];t[e]=this.state[r][e]}i[r]=i[r]||{},e.h(i[r],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const e in t)t[e].refreshFeatureState(n)}}class It extends e.E{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new Dt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ct,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles)if(!this._tiles[e].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Rt).map(e=>e.key)}getRenderableIds(t,n){const i=[];for(const e in this._tiles)this._isIdRenderable(+e,t,n)&&i.push(this._tiles[e]);return t?i.sort((t,n)=>{const i=t.tileID,r=n.tileID,o=new e.P(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),s=new e.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-r.overscaledZ||s.y-o.y||s.x-o.x}).map(e=>e.tileID.key):i.map(e=>e.tileID).sort(Rt).map(e=>e.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(n||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(t,n,i,r){if(r)if(t.state="errored",404!==r.status)this._source.fire(new e.z(r,{tile:t}));else{if(this._source.fire(new e.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=e.q.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const r=t[i];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);n(e,t),n(t,e)}}function n(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,i),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const r in this._tiles){let o=this._tiles[r];if(i[r]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>n)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){i[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),i=this._getLoadedTile(t);if(i)return i}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,r=Math.floor(n*i*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,n,i,r,o){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;this.updateCacheSize(t,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const s="batched-model"===this._source.type;let a,l=this._source.maxzoom;const c=this.map&&this.map.painter?this.map.painter._terrain:null;if(c&&c.sourceCache===this&&c.attenuationRange()){const e=c.attenuationRange()[0],t=Math.floor(e)-Math.log2(c.getDemUpscale());l>t&&(l=t)}if(this.used||this.usedForTerrain){if(this._source.tileID)a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new e.aM(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y));else if(0!==this.tileCoverLift){const r=t.clone();r.tileCoverLift=this.tileCoverLift,a=r.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:s}),this._source.minzoom<=1&&"globe"===t.projection.name&&(a.push(new e.aM(1,0,1,0,0)),a.push(new e.aM(1,0,1,1,0)),a.push(new e.aM(1,0,1,0,1)),a.push(new e.aM(1,0,1,1,1)))}else if(a=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:s}),this._source.hasTile){const e=this._source.hasTile.bind(this._source);a=a.filter(t=>e(t))}}else a=[];if(a.length>0&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Pt(this._source.type)){const e=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),l=Math.min(e,this._source.maxzoom);if(s){const e=t.extendTileCover(a,l);for(const t of e)a.push(t)}else if(o){const e=t.extendTileCoverToNearPlane(a,this.transform.getFrustum(l),l);for(const t of e)a.push(t)}else if(this.castsShadows&&r){const e=t.extendTileCover(a,l,r);for(const t of e)this._shadowCasterTiles[t.key]=!0,a.push(t)}}const u=this._updateRetainedTiles(a);if(Pt(this._source.type)&&0!==a.length){const t={},n={},i=Object.keys(u);for(const o of i){const i=u[o],r=this._tiles[o];if(!r||r.fadeEndTime&&r.fadeEndTime<=e.q.now())continue;const s=this.findLoadedParent(i,Math.max(i.overscaledZ-It.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),n[o]=i}const r=a[a.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(u[e]||!t.hasData())continue;let i=t.tileID;for(;i.overscaledZ>r;){i=i.scaledTo(i.overscaledZ-1);const r=this._tiles[i.key];if(r&&r.hasData()&&n[i.key]){u[e]=t.tileID;break}}}for(const e in t)u[e]||(this._coveredTiles[e]=!0,u[e]=t[e])}for(const e in u)this._tiles[e].clearFadeHold();const h=e.bs(this._tiles,u);for(const e of h){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const n={},i=e.reduce((e,t)=>Math.min(e,t.overscaledZ),1/0),r=e[0].overscaledZ,o=Math.max(r-It.maxOverzooming,this._source.minzoom),s=Math.max(r+It.maxUnderzooming,this._source.minzoom),a={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||i<this._source.maxzoom&&(a[l.key]=l)}this._retainLoadedChildren(a,i,s,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let r=l.overscaledZ-1;r>=o;--r){const o=l.scaledTo(r);if(n[o.key])break;if(n[o.key]=!0,e=this.getTile(o),!e&&i&&(e=this._addTile(o)),e&&(t[o.key]=o,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const e=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;i=e}for(const e of t)this._loadedParentTiles[e]=n}}_addTile(t){let n=this._tiles[t.key];if(n)return!0!==n.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const i=Boolean(n);if(!i){const e=this.map?this.map.painter:null,i=this._source.tileSize*t.overscaleFactor();n="raster-array"===this._source.type?new St(t,i,this.transform.tileZoom,e,this._isRaster):new At(t,i,this.transform.tileZoom,e,this._isRaster,this._source.worldview),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n.uses++,this._tiles[t.key]=n,i||this._source.fire(new e.A("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,i){const r=[],o=this.transform;if(!o)return r;const s="globe"===o.projection.name,a=e.aD(o.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(i&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(s){const t=c.tileID.canonical;if(0===t.z){const n=[Math.abs(e.ay(a,...Mt(t,-1))-a),Math.abs(e.ay(a,...Mt(t,1))-a)];u=[0,2*n.indexOf(Math.min(...n))-1]}else{const n=[Math.abs(e.ay(a,...Mt(t,-1))-a),Math.abs(e.ay(a,...Mt(t,0))-a),Math.abs(e.ay(a,...Mt(t,1))-a)];u=[n.indexOf(Math.min(...n))-1]}}else u=[0];for(const e of u){const i=t.containsTile(c,o,n,e);i&&r.push(i)}}return r}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const n=this.getRenderableIds(e,t).map(e=>this._tiles[e].tileID),i="globe"===this.transform.projection.name;for(const r of n)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped()),r.expandedProjMatrix=i?this.transform.calculateProjMatrix(r.toUnwrapped(),!1,!0):r.projMatrix;return n}sortCoordinatesByDistance(e){const t=e.slice(),n=this.transform._camera.position,i=this.transform._camera.forward(),r={};for(const o of t){const e=1/(1<<o.canonical.z);r[o.key]=((o.canonical.x+.5)*e+o.wrap-n[0])*i[0]+((o.canonical.y+.5)*e-n[1])*i[1]-n[2]*i[2]}return t.sort((e,t)=>r[e.key]-r[t.key]),t}hasTransition(){if(this._source.hasTransition())return!0;if(Pt(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=e.q.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,t))}_preloadTiles(t,n){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,n))};return void this._source.on("data",e)}const i=new Map,r=Array.isArray(t)?t:[t],o=this.map.painter.terrain,s=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize;for(const e of r){const t=e.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)i.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}const a=Array.from(i.values());e.bt(a,(e,t)=>{const n=new At(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(n,e=>{"raster-dem"===this._source.type&&n.dem&&this._backfillDEM(n),t(e,n)})},n)}}function Rt(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Pt(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Mt(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}It.maxOverzooming=10,It.maxUnderzooming=3;class Ft{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const n in this.style._mergedLayers){const i=this.style._mergedLayers[n];if("fill-extrusion"===i.type||"building"===i.type)this.layers.push({layer:i,visible:e,visibilityChanged:t});else if("model"===i.type){const n=this.style.getLayerSource(i);n&&"batched-model"===n.type&&this.layers.push({layer:i,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const n=t.layer;let i=!1;"fill-extrusion"===n.type?i=!n.isHidden(e)&&n.paint.get("fill-extrusion-opacity")>0:"building"===n.type?i=!n.isHidden(e)&&n.paint.get("building-opacity")>0:"model"===n.type&&(i=!n.isHidden(e)&&n.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!i&&t.visible,t.visible=i}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const i of this.layers){const e=i.layer,n=this.style.getLayerSourceCache(e);let r=1;"fill-extrusion"===e.type?r=i.visible?e.paint.get("fill-extrusion-vertical-scale"):0:"building"===e.type&&(r=i.visible?e.paint.get("building-vertical-scale"):0);let o=n?n.getTile(t):null;if(!o&&n)for(const i in n._tiles){const e=n._tiles[i];if(t.canonical.isChildOf(e.tileID.canonical)){o=e;break}}this.currentBuildingBuckets.push({bucket:o?o.getBucket(e):null,tileID:o?o.tileID:t,verticalScale:r})}e.hasAnyZOffset=!1;let n=!1;for(let i=0;i<e.symbolInstances.length;i++){const r=e.symbolInstances.get(i),o=r.zOffset,s=this._getHeightAtTileOffset(t,r.tileAnchorX,r.tileAnchorY);r.zOffset=s!==Number.NEGATIVE_INFINITY?s:o,n||o===r.zOffset||(n=!0),e.hasAnyZOffset||0===r.zOffset||(e.hasAnyZOffset=!0)}n&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,i,r){let o=n,s=i;if(t.canonical.z!==r.canonical.z){const a=r.canonical,l=1/(1<<t.canonical.z-a.z);o=(n+t.canonical.x*e.aj)*l-a.x*e.aj|0,s=(i+t.canonical.y*e.aj)*l-a.y*e.aj|0}return{tileX:o,tileY:s}}_getHeightAtTileOffset(e,t,n){let i,r;for(let o=0;o<this.layers.length;++o){const s=this.layers[o].layer;if("fill-extrusion"!==s.type&&"building"!==s.type)continue;const{bucket:a,tileID:l,verticalScale:c}=this.currentBuildingBuckets[o];if(!a)continue;const{tileX:u,tileY:h}=this._mapCoordToOverlappingTile(e,t,n,l),d=a.getHeightAtTileCoord(u,h);d&&void 0!==d.height&&(d.hidden?i=d.height:r=Math.max(d.height*c,r||0))}if(void 0!==r)return r;for(let o=0;o<this.layers.length;++o){const r=this.layers[o];if("model"!==r.layer.type||!r.visible)continue;const{bucket:s,tileID:a}=this.currentBuildingBuckets[o];if(!s)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,n,a),u=s.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==i?Math.min(u.maxHeight,i)*u.verticalScale:u.height?u.height*u.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Lt(t,n){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return e.bu.forEach(e=>{e in n&&(i[e]=n[e])}),i}function kt(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=Lt(e[n],t[e[n].ref]));return e}const Ot={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Bt(e,t,n){n.push({command:Ot.addSource,args:[e,t[e]]})}function zt(e,t,n){t.push({command:Ot.removeSource,args:[e]}),n[e]=!0}function Nt(e,t,n,i){zt(e,n,i),Bt(e,t,n)}function Ut(t,n,i){let r;for(r in t[i])if(t[i].hasOwnProperty(r)&&"data"!==r&&!e.bv(t[i][r],n[i][r]))return!1;for(r in n[i])if(n[i].hasOwnProperty(r)&&"data"!==r&&!e.bv(t[i][r],n[i][r]))return!1;return!0}function Vt(t,n,i,r,o,s){let a;for(a in n=n||{},t=t||{})t.hasOwnProperty(a)&&(e.bv(t[a],n[a])||i.push({command:s,args:[r,a,n[a],o]}));for(a in n)n.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(e.bv(t[a],n[a])||i.push({command:s,args:[r,a,n[a],o]}))}function jt(e){return e.id}function Gt(e,t){return e[t.id]=t,e}function Ht(t,n,i){const r=n.createTileMatrix(t,t.worldSize,i.toUnwrapped());return e.az(new Float32Array(16),t.projMatrix,r)}function Wt(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;const i=n.clone();return i.setProjection(t.projection),Ht(i,t.getProjection(),e)}function qt(e,t,n){return t.name===n.projection.name?e.projMatrix:Ht(n,t,e)}class Xt{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ay(t,0,1);let n=1,i=this._distances[n];const r=t*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const o=n-1,s=this._distances[o],a=i-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[n].mult(l))}}class Zt{constructor(e,t,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(e,t,n,i){this._forEachCell(t-i,n-i,t+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(i)}_insertBoxCell(e,t,n,i,r,o){this.boxCells[r].push(o)}_insertCircleCell(e,t,n,i,r,o){this.circleCells[r].push(o)}_query(e,t,n,i,r,o){if(n<0||e>this.width||i<0||t>this.height)return!r&&[];const s=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],i=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-i,y1:n-i,x2:t+i,y2:n+i})}return o?s.filter(o):s}return this._forEachCell(e,t,n,i,this._queryCell,s,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?s.length>0:s}_queryCircle(e,t,n,i,r){const o=e-n,s=e+n,a=t-n,l=t+n;if(s<0||o>this.width||l<0||a>this.height)return!i&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:i,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},r),i?c.length>0:c}query(e,t,n,i,r){return this._query(e,t,n,i,!1,r)}hitTest(e,t,n,i,r){return this._query(e,t,n,i,!0,r)}hitTestCircle(e,t,n,i){return this._queryCircle(e,t,n,!0,i)}_queryCell(e,t,n,i,r,o,s,a){const l=s.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=r[c+2]&&t<=r[c+3]&&n>=r[c+0]&&i>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],e,t,n,i)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=r[u],t=r[u+1],n=r[u+2];o.push({key:this.circleKeys[c],x1:e-n,y1:t-n,x2:e+n,y2:t+n})}}}}}_queryCellCircle(e,t,n,i,r,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[r];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const n=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const n=3*t;if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,n,i,r,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,n,i,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,i,r,o){const s=i-e,a=r-t,l=n+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,n,i,r,o,s){const a=(o-i)/2,l=Math.abs(e-(i+a));if(l>a+n)return!1;const c=(s-r)/2,u=Math.abs(t-(r+c));if(u>c+n)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=n*n}}const Yt={unknown:0,flipRequired:1,flipNotRequired:2},Kt=Math.tan(85*Math.PI/180);function Jt(t,n,i,r,o,s,a){const l=e.bz();if(i)if("globe"===s.name){const t=e.bA(o,n);e.az(l,l,t)}else{const t=e.bB([],a);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],r||e.by(l,l,o.angle)}else e.az(l,o.labelPlaneMatrix,t);return l}function Qt(e,t,n,i,r,o,s){const a=Jt(e,t,n,i,r,o,s);return"globe"===o.name&&n||(a[2]=a[6]=a[10]=a[14]=0),a}function $t(t,n,i,r,o,s,a){if(i){if("globe"===s.name){const l=Jt(t,n,i,r,o,s,a);return e.bi(l,l),e.az(l,t,l),l}{const n=e.bw(t),i=e.bx([]);return i[0]=a[0],i[1]=a[1],i[4]=a[2],i[5]=a[3],e.az(n,n,i),r||e.by(n,n,-o.angle),n}}return o.glCoordMatrix}function en(t,n,i,r){const o=[t,n,i,1];i?e.aA(o,o,r):dn(o,o,r);const s=o[3];return o[0]/=s,o[1]/=s,o[2]/=s,o}function tn(e,t){return Math.min(.5+e/t*.5,1.5)}function nn(e,t){const n=e[0]/e[3],i=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&i>=-t[1]&&i<=t[1]}function rn(t,n,i,r,o,s,a,l,c,u){const h=i.transform,d=r?t.textSizeData:t.iconSizeData,f=e.bH(d,i.transform.zoom),p="globe"===h.projection.name,m=[256/i.width*2+1,256/i.height*2+1],g=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let _=null;p&&(_=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,v=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=i.transform.width/i.transform.height;let b,w=!1;for(let E=0;E<v.length;E++){const r=v.get(E),{numGlyphs:p,writingMode:T}=r;if(T!==e.bI.vertical||w||b===e.bI.horizontal||(w=!0),b=T,(r.hidden||T===e.bI.vertical)&&!w){hn(p,g);continue}w=!1;const A=new e.P(r.tileAnchorX,r.tileAnchorY);let{x:S,y:D,z:C}=h.projection.projectTilePoint(A.x,A.y,u.canonical);if(c){const[e,t,n]=c(A);S+=e,D+=t,C+=n}const I=[S,D,C,1];if(e.aA(I,I,n),!nn(I,m)){hn(p,g);continue}const R=I[3],P=tn(i.transform.getCameraToCenterDistance(h.projection),R),M=e.bJ(d,f,r),F=a?M/P:M*P,L=en(S,D,C,o);if(L[3]<=0){hn(p,g);continue}let k={};const O=e.al(t.layers[0].layout.get("text-max-angle")),B=Math.cos(O),z=a?null:c,N=an(r,F,!1,l,n,o,s,t.glyphOffsetArray,y,g,_,L,A,k,x,z,h.projection,u,a,B);w=N.useVertical,z&&N.needsFlipping&&(k={}),(N.notEnoughRoom||w||N.needsFlipping&&an(r,F,!0,l,n,o,s,t.glyphOffsetArray,y,g,_,L,A,k,x,z,h.projection,u,a,B).notEnoughRoom)&&hn(p,g)}r?(t.text.dynamicLayoutVertexBuffer.updateData(g),_&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(_)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),_&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(_))}function on(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g){const{lineStartIndex:_,glyphStartIndex:y,segment:v}=a,x=y+a.numGlyphs,b=_+a.lineLength,w=t.getoffsetX(y),E=t.getoffsetX(x-1),T=un(e*w,n,i,r,o,s,v,_,b,l,c,u,h,d,!0,f,p,m,g);if(!T)return null;const A=un(e*E,n,i,r,o,s,v,_,b,l,c,u,h,d,!0,f,p,m,g);return A?{first:T,last:A}:null}function sn(t,n,i,r){return t===e.bI.horizontal&&Math.abs(r)>Math.abs(i)?{useVertical:!0}:t===e.bI.vertical?r>0?{needsFlipping:!0}:null:n!==Yt.unknown&&function(e,t){return 0===e||Math.abs(t/e)>Kt}(i,r)?n===Yt.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function an(t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x){const b=n/24,w=t.lineOffsetX*b,E=t.lineOffsetY*b,{lineStartIndex:T,glyphStartIndex:A,numGlyphs:S,segment:D,writingMode:C,flipState:I}=t,R=T+t.lineLength,P=t=>{if(h){const[n,i,r]=t.up,o=u.length;e.bK(h,o+0,n,i,r),e.bK(h,o+1,n,i,r),e.bK(h,o+2,n,i,r),e.bK(h,o+3,n,i,r)}const[n,i,r]=t.point;e.bL(u,n,i,r,t.angle)};if(S>1){const e=on(b,l,w,E,i,d,f,t,c,s,p,g,!1,_,y,v,x);if(!e)return{notEnoughRoom:!0};if(r&&!i){let[n,i,r]=e.first.point,[o,s,l]=e.last.point;[n,i]=en(n,i,r,a),[o,s]=en(o,s,l,a);const c=sn(C,I,(o-n)*m,s-i);if(t.flipState=c&&c.needsFlipping?Yt.flipRequired:Yt.flipNotRequired,c)return c}P(e.first);for(let t=A+1;t<A+S-1;t++){const e=un(b*l.getoffsetX(t),w,E,i,d,f,D,T,R,c,s,p,g,!1,!1,_,y,v,x);if(!e)return u.length-=4*(t-A),{notEnoughRoom:!0};P(e)}P(e.last)}else{if(r&&!i){const n=en(f.x,f.y,0,o),i=T+D+1,r=new e.P(c.getx(i),c.gety(i)),s=en(r.x,r.y,0,o),a=s[3]>0?s:cn(f,r,n,1,o,void 0,_,y.canonical),l=sn(C,I,(a[0]-n[0])*m,a[1]-n[1]);if(t.flipState=l&&l.needsFlipping?Yt.flipRequired:Yt.flipNotRequired,l)return l}const n=un(b*l.getoffsetX(A),w,E,i,d,f,D,T,R,c,s,p,g,!1,!1,_,y,v,x);if(!n)return{notEnoughRoom:!0};P(n)}return{}}function ln(e,t,n,i,r){const{x:o,y:s,z:a}=i.projectTilePoint(e.x,e.y,t);if(!r)return en(o,s,a,n);const[l,c,u]=r(e);return en(o+l,s+c,a+u,n)}function cn(t,n,i,r,o,s,a,l){const c=ln(t.sub(n)._unit()._add(t),l,o,a,s);return e.at(c,i,c),e.au(c,c),e.bE(c,i,c,r)}function un(t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v){const x=r?t-n:t+n;let b=x>0?1:-1,w=0;r&&(b*=-1,w=Math.PI),b<0&&(w+=Math.PI);let E=l+a+(b>0?0:1)|0,T=o,A=o,S=0,D=0;const C=Math.abs(x),I=[],R=[];let P=s,M=P,F=e.bC([]);const L=()=>cn(M,P,A,C-S+1,h,f,g,_.canonical);for(;S+D<=C;){if(E+=b,E<l||E>=c)return null;if(A=T,M=P,I.push(A),p&&R.push(M),P=new e.P(u.getx(E),u.gety(E)),T=d[E],!T){const e=ln(P,_.canonical,h,g,f);T=e[3]>0?d[E]=e:L()}S+=D;const t=e.at([],T,A),n=e.bD(A,T);if(i&&n>0&&D>0&&e.bG(F,t)/(D*n)<v)return null;D=n,F=t}m&&f&&(d[E]&&(T=L(),D=e.bD(A,T),F=e.at([],T,A)),d[E]=T);const k=(C-S)/D,O=P.sub(M)._mult(k)._add(M),B=e.bE([],A,F,k);let z=[0,0,1],N=F[0],U=F[1];if(y&&(z=g.upVector(_.canonical,O.x,O.y),0!==z[0]||0!==z[1]||1!==z[2])){const t=[z[2],0,-z[0]],n=e.bF([],z,t);e.au(t,t),e.au(n,n),N=e.bG(F,t),U=e.bG(F,n)}if(i){const t=e.bF([],z,F);e.au(t,t),e.bE(B,B,t,i*b)}const V=w+Math.atan2(U,N);return I.push(B),p&&R.push(O),{point:B,angle:V,path:I,tilePath:R,up:z}}function hn(e,t){const n=t.length,i=n+4*e;t.resize(i),t.float32.fill(-1/0,4*n,4*i)}function dn(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e[3]=n[3]*i+n[7]*r+n[15],e}const fn=100;class pn{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Zt(e.width+200,e.height+200,25),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Zt(e.width+200,e.height+200,25);this.transform=e,this.grid=n,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+fn,this.screenBottomBoundary=e.height+fn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(t,n,i,r,o,s,a,l,c,u,h){let d=i.projectedAnchorX,f=i.projectedAnchorY,p=i.projectedAnchorZ;const m=i.tileAnchorX,g=i.tileAnchorY,_=i.elevation,y=i.tileID,v=t.getProjection();if(_&&y){const[e,t,n]=v.upVector(y.canonical,i.tileAnchorX,i.tileAnchorY),r=v.upVectorScale(y.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;d+=e*_*r,f+=t*_*r,p+=n*_*r}const x="globe"===t.projection.name,b="globe"===t.projection.name?e.ah(this.transform.zoom):0;if(y&&x&&b<1&&!s){const t=1<<y.canonical.z,n=e.bM(m,g);e.bN(n,n,1/e.aj),e.bO(n,n,e.bM(y.canonical.x,y.canonical.y)),e.bN(n,n,1/t),e.bP(n,n,e.bM(r[0],r[1])),n[0]=e.bQ(n[0],-.5,.5),e.bN(n,n,e.aj);const i=e.bR(n[0],n[1],e.aj/(2*Math.PI),1);e.aA(i,i,o),d=e.ai(d,i[0],b),f=e.ai(f,i[1],b),p=e.ai(p,i[2],b)}const w=this.projectAndGetPerspectiveRatio(u,d,f,p,i.tileID,"globe"===v.name||!!_||this.transform.pitch>0,v),E=c*w.perspectiveRatio,T=(i.x1*n+a.x-i.padding)*E+w.point.x,A=(i.y1*n+a.y-i.padding)*E+w.point.y,S=(i.x2*n+a.x+i.padding)*E+w.point.x,D=(i.y2*n+a.y+i.padding)*E+w.point.y,C=w.perspectiveRatio<=.55||w.occluded;return!this.isInsideGrid(T,A,S,D)||!l&&this.grid.hitTest(T,A,S,D,h)||C?{box:[],offscreen:!1,occluded:w.occluded}:{box:[T,A,S,D],offscreen:this.isOffscreen(T,A,S,D),occluded:!1}}placeCollisionCircles(t,n,i,r,o,s,a,l,c,u,h,d,f,p,m){const g=[],_=this.transform.elevation,y=t.getProjection(),v=_?_.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,x=new e.P(i.tileAnchorX,i.tileAnchorY);let{x:b,y:w,z:E}=y.projectTilePoint(x.x,x.y,m.canonical);if(v){const[e,t,n]=v(x);b+=e,w+=t,E+=n}const T="globe"===y.name,A=this.projectAndGetPerspectiveRatio(a,b,w,E,m,T||!!_||this.transform.pitch>0,y),{perspectiveRatio:S}=A,D=(h?s/S:s*S)/e.bU,C=en(b,w,E,l),I=i.lineOffsetX*D,R=i.lineOffsetY*D,P=e.al(t.layers[0].layout.get("text-max-angle")),M=Math.cos(P),F=A.signedDistanceFromCamera>0?on(D,o,I,R,!1,C,x,i,r,l,{},_&&!h?v:null,h&&!!_,y,m,h,M):null;let L=!1,k=!1,O=!0;if(F&&!A.occluded){const t=.5*f*S+p,i=new e.P(-100,-100),r=new e.P(this.screenRightBoundary,this.screenBottomBoundary),o=new Xt,{first:s,last:a}=F,l=s.path.length;let h=[];for(let e=l-1;e>=1;e--)h.push(s.path[e]);for(let e=1;e<a.path.length;e++)h.push(a.path[e]);const m=2.5*t;c&&(h=h.map((e,t)=>{let[n,i,r]=e;return v&&!T&&(r=v(t<l-1?s.tilePath[l-1-t]:a.tilePath[t-l+2])[2]),en(n,i,r,c)}),h.some(e=>e[3]<=0)&&(h=[]));let _=[];if(h.length>0){let t=1/0,n=-1/0,o=1/0,s=-1/0;for(const e of h)t=Math.min(t,e[0]),o=Math.min(o,e[1]),n=Math.max(n,e[0]),s=Math.max(s,e[1]);n>=i.x&&t<=r.x&&s>=i.y&&o<=r.y&&(_=[h.map(t=>new e.P(t[0],t[1]))],(t<i.x||n>r.x||o<i.y||s>r.y)&&(_=e.bS(_,i.x,i.y,r.x,r.y)))}for(const e of _){o.reset(e,.25*t);let i=0;i=o.length<=.5*t?1:Math.ceil(o.paddedLength/m)+1;for(let e=0;e<i;e++){const r=e/Math.max(i-1,1),s=o.lerp(r),a=s.x+fn,l=s.y+fn;g.push(a,l,t,0);const c=a-t,h=l-t,f=a+t,p=l+t;if(O=O&&this.isOffscreen(c,h,f,p),k=k||this.isInsideGrid(c,h,f,p),!n&&this.grid.hitTestCircle(a,l,t,d)&&(L=!0,!u))return{circles:[],offscreen:!1,collisionDetected:L,occluded:!1}}}}return{circles:!u&&L||!k?[]:g,offscreen:O,collisionDetected:L,occluded:A.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,r=1/0,o=-1/0,s=-1/0;for(const u of t){const t=new e.P(u.x+fn,u.y+fn);i=Math.min(i,t.x),r=Math.min(r,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),n.push(t)}const a=this.grid.query(i,r,o,s).concat(this.ignoredGrid.query(i,r,o,s)),l={},c={};for(const u of a){const t=u.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const i=[new e.P(u.x1,u.y1),new e.P(u.x2,u.y1),new e.P(u.x2,u.y2),new e.P(u.x1,u.y2)];e.bT(n,i)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,n,i,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:i,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,i,r){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:n,featureIndex:i,collisionGroupID:r};for(let a=0;a<e.length;a+=4)o.insertCircle(s,e[a],e[a+1],e[a+2])}projectAndGetPerspectiveRatio(t,n,i,r,o,s,a){const l=[n,i,r,1];let c=!1;if(r||this.transform.pitch>0){if(e.aA(l,l,t),this.fogState&&o&&"globe"!==a.name){const t=function(t,n,i,r,o,s){const a=s.calculateFogTileMatrix(o),l=[n,i,r];return e.ad(l,l,a),Ue(t,e.ae(l),s.pitch,s._fov)}(this.fogState,n,i,r,o.toUnwrapped(),this.transform);c=t>.9}}else dn(l,l,t);const u=l[3];return{point:new e.P((l[0]/u+1)/2*this.transform.width+fn,(-l[1]/u+1)/2*this.transform.height+fn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:s&&l[2]>u||c}}isOffscreen(e,t,n,i){return n<fn||e>=this.screenRightBoundary||i<fn||t>this.screenBottomBoundary}isInsideGrid(e,t,n,i){return n>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.bx([]);return e.bo(t,t,[-100,-100,0]),t}}class mn{constructor(e,t,n,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class gn{constructor(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new mn(e?e.text:null,t,n,r),this.icon=new mn(e?e.icon:null,t,i,r),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _n{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=n,this.clipped=i}}class yn{constructor(){this.invProjMatrix=e.bz(),this.viewportMatrix=e.bz(),this.circles=[]}}class vn{constructor(e,t,n,i,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class xn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function bn(t,n,i,r,o){const{horizontalAlign:s,verticalAlign:a}=e.bZ(t),l=-(s-.5)*n,c=-(a-.5)*i,u=e.b_(t,r);return new e.P(l+u[0]*o,c+u[1]*o)}function wn(t,n,i,r,o){const s=new e.P(t,n);return i&&s._rotate(r?o:-o),s}class En{constructor(e,t,n,i,r,o){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new pn(this.transform,r),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new xn(n),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,i,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=i.getBucket(n),a=i.latestFeatureIndex;if(!s||!a||n.fqid!==s.layerIds[0])return;const l=s.layers[0].layout,c=s.layers[0].paint,u=i.collisionBoxArray,h=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),d=i.tileSize/e.aj,f=i.tileID.toUnwrapped();this.transform.setProjection(s.projection);const p=(m=i.tileID,g=s.getProjection(),_=this.transform,g.name===this.projection?_.calculateProjMatrix(m.toUnwrapped()):Ht(_,g,m));var m,g,_;const y="map"===l.get("text-pitch-alignment"),v="map"===l.get("text-rotation-alignment");n.compileFilter(n.options);const x=n.dynamicFilter(),b=n.dynamicFilterNeedsFeature(),w=this.transform.calculatePixelsToTileUnitsMatrix(i),E=Qt(p,i.tileID.canonical,y,v,this.transform,s.getProjection(),w);let T=null;const A=s.getProjection().createInversionMatrix(this.transform,i.tileID.canonical);if(y){const t=$t(p,i.tileID.canonical,y,v,this.transform,s.getProjection(),w);T=e.az([],this.transform.labelPlaneMatrix,t)}let S=null;x&&i.latestFeatureIndex&&(S={unwrappedTileID:f,dynamicFilter:x,dynamicFilterNeedsFeature:b}),this.retainedQueryData[s.bucketInstanceId]=new vn(s.bucketInstanceId,a,s.sourceLayerIndex,s.index,i.tileID);const[D,C]=s.layers[0].layout.get("text-size-scale-range"),I=e.ay(o,D,C),[R,P]=l.get("icon-size-scale-range"),M=e.ay(o,R,P),F={bucket:s,layout:l,paint:c,posMatrix:p,invMatrix:A,mercatorCenter:[e.aD(this.transform.center.lng),e.aH(this.transform.center.lat)],textLabelPlaneMatrix:E,labelToScreenMatrix:T,clippingData:S,scale:h,textPixelRatio:d,holdingForFade:i.holdingForFade(),collisionBoxArray:u,partiallyEvaluatedTextSize:e.bH(s.textSizeData,this.transform.zoom,I),partiallyEvaluatedIconSize:e.bH(s.iconSizeData,this.transform.zoom,M),collisionGroup:this.collisionGroups.get(s.sourceID),latestFeatureIndex:i.latestFeatureIndex};if(r)for(const e of s.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=e;t.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:F})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:s.symbolInstances.length,parameters:F})}attemptAnchorPlacement(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x){const{textOffset0:b,textOffset1:w,crossTileID:E}=p,T=[b,w],A=bn(e,o,s,T,a),S=this.collisionIndex.placeCollisionBox(g,a,t,n,i,r,wn(A.x,A.y,l,c,this.transform.angle),f,u,h,d.predicate);if(y){const e=g.getSymbolInstanceIconSize(x,this.transform.zoom,p.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(g,e,y,n,i,r,wn(A.x,A.y,l,c,this.transform.angle),f,u,h,d.predicate).box.length)return}if(S.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[E]&&this.prevPlacement.placements[E]&&this.prevPlacement.placements[E].text&&(t=this.prevPlacement.variableOffsets[E].anchor),this.variableOffsets[E]={textOffset:T,width:o,height:s,anchor:e,textScale:a,prevAnchor:t},this.markUsedJustification(g,e,p,_),g.allowVerticalPlacement&&(this.markUsedOrientation(g,_,p),this.placedOrientations[E]=_),{shift:A,placedGlyphBoxes:S}}}placeLayerBucketPart(t,n,i,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const{bucket:s,layout:a,paint:l,posMatrix:c,textLabelPlaneMatrix:u,labelToScreenMatrix:h,clippingData:d,textPixelRatio:f,mercatorCenter:p,invMatrix:m,holdingForFade:g,collisionBoxArray:_,partiallyEvaluatedTextSize:y,partiallyEvaluatedIconSize:v,collisionGroup:x,latestFeatureIndex:b}=t.parameters,w=a.get("text-optional"),E=a.get("icon-optional"),T=a.get("text-allow-overlap"),A=a.get("icon-allow-overlap"),S="map"===a.get("text-rotation-alignment"),D="map"===a.get("icon-rotation-alignment"),C="map"===a.get("text-pitch-alignment"),I=l.get("symbol-z-offset"),R="sea"===a.get("symbol-elevation-reference"),P=a.get("symbol-placement"),[M,F]=a.get("text-size-scale-range"),[L,k]=a.get("icon-size-scale-range"),O=e.ay(o,M,F),B=e.ay(o,L,k),z=a.get("text-variable-anchor"),N=S&&"point"!==P,U=D&&"point"!==P,V=z&&s.hasTextData(),j=s.hasIconTextFit()&&V&&s.hasIconData();this.transform.setProjection(s.projection);const G=V||N,H=U||j;let W=T&&(A||!s.hasIconData()||E),q=A&&(T||!s.hasTextData()||w);const X=!I.isConstant();!s.collisionArrays&&_&&s.deserializeCollisionBoxes(_),i&&r&&s.updateCollisionDebugBuffers(this.transform.zoom,_,O,B);const Z=(t,r,l)=>{const{crossTileID:_,numVerticalGlyphVertices:D}=t;let P=null;if(d&&d.dynamicFilterNeedsFeature||X){const e=this.retainedQueryData[s.bucketInstanceId];P=b.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(d&&!(0,d.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},P,this.retainedQueryData[s.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(d.unwrappedTileID)))return this.placements[_]=new _n(!1,!1,!1,!0),void n.add(_);const M=I.evaluate(P,{});if(n.has(_))return;if(g)return void(this.placements[_]=new _n(!1,!1,!1));let F=!1,L=!1,k=!0,O=!1,B=!1,N=null,U={box:null,offscreen:null,occluded:null},V={box:null},j=null,Z=null,Y=null,K=0,J=0,Q=0;l.textFeatureIndex?K=l.textFeatureIndex:t.useRuntimeCollisionCircles&&(K=t.featureIndex),l.verticalTextFeatureIndex&&(J=l.verticalTextFeatureIndex);const $=e=>{e.tileID=this.retainedQueryData[s.bucketInstanceId].tileID;const n=this.transform.elevation;e.elevation=R?M:M+(n?n.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0),e.elevation+=t.zOffset},ee=l.textBox;if(ee){$(ee);const n=n=>{let i=e.bI.horizontal;if(s.allowVerticalPlacement&&!n&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[_];e&&(this.placedOrientations[_]=e,i=e,this.markUsedOrientation(s,i,t))}return i},i=(t,n)=>{if(s.allowVerticalPlacement&&D>0&&l.verticalTextBox){for(const i of s.writingModes)if(i===e.bI.vertical?(U=n(),V=U):U=t(),U&&U.box&&U.box.length)break}else U=t()};if(z){let o=z;if(this.prevPlacement&&this.prevPlacement.variableOffsets[_]){const e=this.prevPlacement.variableOffsets[_];o.indexOf(e.anchor)>0&&(o=o.filter(t=>t!==e.anchor),o.unshift(e.anchor))}const a=(e,n,i)=>{const a=s.getSymbolInstanceTextSize(y,t,this.transform.zoom,r),l=(e.x2-e.x1)*a+2*e.padding,u=(e.y2-e.y1)*a+2*e.padding,h=t.hasIconTextFit&&!A?n:null;h&&$(h);let d={box:[],offscreen:!1,occluded:!1};const g=T?2*o.length:o.length;for(let _=0;_<g;++_){const n=this.attemptAnchorPlacement(o[_%o.length],e,p,m,G,l,u,a,S,C,f,c,x,_>=o.length,t,r,s,i,h,y,v);if(n&&(d=n.placedGlyphBoxes,d&&d.box&&d.box.length)){F=!0,N=n.shift;break}}return d};i(()=>a(ee,l.iconBox,e.bI.horizontal),()=>{const t=l.verticalTextBox;return t&&$(t),s.allowVerticalPlacement&&!(U&&U.box&&U.box.length)&&D>0&&t?a(t,l.verticalIconBox,e.bI.vertical):{box:null,offscreen:null,occluded:null}}),U&&(F=U.box,k=U.offscreen,O=U.occluded);const u=n(!(!U||!U.box));if(!F&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[_];e&&(this.variableOffsets[_]=e,this.markUsedJustification(s,e.anchor,t,u))}}else{const a=(n,i)=>{const a=s.getSymbolInstanceTextSize(y,t,this.transform.zoom,r,o),l=this.collisionIndex.placeCollisionBox(s,a,n,p,m,G,new e.P(0,0),T,f,c,x.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(s,i,t),this.placedOrientations[_]=i),l};i(()=>a(ee,e.bI.horizontal),()=>{const t=l.verticalTextBox;return s.allowVerticalPlacement&&D>0&&t?($(t),a(t,e.bI.vertical)):{box:null,offscreen:null,occluded:null}}),n(!!(U&&U.box&&U.box.length))}}if(j=U,F=j&&j.box&&j.box.length>0,k=j&&j.offscreen,O=j&&j.occluded,t.useRuntimeCollisionCircles){const n=s.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),r=e.bJ(s.textSizeData,y,n),o=a.get("text-padding");Z=this.collisionIndex.placeCollisionCircles(s,T,n,s.lineVertexArray,s.glyphOffsetArray,r,c,u,h,i,C,x.predicate,t.collisionCircleDiameter*r/e.bU,o,this.retainedQueryData[s.bucketInstanceId].tileID),F=T||Z.circles.length>0&&!Z.collisionDetected,k=k&&Z.offscreen,O=Z.occluded}if(l.iconFeatureIndex&&(Q=l.iconFeatureIndex),l.iconBox){const n=n=>{$(n);const i=t.hasIconTextFit&&N?wn(N.x,N.y,S,C,this.transform.angle):new e.P(0,0),r=s.getSymbolInstanceIconSize(v,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(s,r,n,p,m,H,i,A,f,c,x.predicate)};V&&V.box&&V.box.length&&l.verticalIconBox?(Y=n(l.verticalIconBox),L=Y.box.length>0):(Y=n(l.iconBox),L=Y.box.length>0),k=k&&Y.offscreen,B=Y.occluded}const te=w||0===t.numHorizontalGlyphVertices&&0===D,ne=E||0===t.numIconVertices;if(te||ne?ne?te||(L=L&&F):F=L&&F:L=F=L&&F,F&&j&&j.box&&this.collisionIndex.insertCollisionBox(j.box,a.get("text-ignore-placement"),s.bucketInstanceId,V&&V.box&&J?J:K,x.ID),L&&Y&&this.collisionIndex.insertCollisionBox(Y.box,a.get("icon-ignore-placement"),s.bucketInstanceId,Q,x.ID),Z&&(F&&this.collisionIndex.insertCollisionCircles(Z.circles,a.get("text-ignore-placement"),s.bucketInstanceId,K,x.ID),i)){const e=s.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new yn);for(let n=0;n<Z.circles.length;n+=4)t.circles.push(Z.circles[n+0]),t.circles.push(Z.circles[n+1]),t.circles.push(Z.circles[n+2]),t.circles.push(Z.collisionDetected?1:0)}const ie="globe"!==s.projection.name;W=W&&(ie||!O),q=q&&(ie||!B),this.placements[_]=new _n(F||W,L||q,k||s.justReloaded),n.add(_)},Y=this.retainedQueryData[s.bucketInstanceId].tileID;if("offset"===s.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(s,Y),"road"===s.elevationType&&s.updateRoadElevation(Y.canonical),s.updateZOffset(),s.sortFeaturesByY){const t=s.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const n=t[e];Z(s.symbolInstances.get(n),n,s.collisionArrays[n])}s.hasAnyZOffset&&e.w("".concat(s.layerIds[0]," layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y"))}else if(s.hasAnyZOffset){const e=s.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const n=e[t];Z(s.symbolInstances.get(n),n,s.collisionArrays[n])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)Z(s.symbolInstances.get(e),e,s.collisionArrays[e]);if(i&&s.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[s.bucketInstanceId];e.bi(t.invProjMatrix,c),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}markUsedJustification(t,n,i,r){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=i,u=e.b$(n),h=r===e.bI.vertical?l:"left"===u?o:"center"===u?s:"right"===u?a:-1;o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(t,n,i){const r=n===e.bI.horizontal||n===e.bI.horizontalOnly?n:0,o=n===e.bI.vertical?n:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=i,u=t.text.placedSymbolArray;s>=0&&(u.get(s).placedOrientation=r),a>=0&&(u.get(a).placedOrientation=r),l>=0&&(u.get(l).placedOrientation=r),c>=0&&(u.get(c).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const a in this.placements){const e=this.placements[a],t=r[a];t?(this.opacities[a]=new gn(t,i,e.text,e.icon,null,e.clipped),n=n||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[a]=new gn(null,i,e.text,e.icon,e.skipFade,e.clipped),n=n||e.text||e.icon)}for(const a in r){const e=r[a];if(!this.opacities[a]){const t=new gn(e,i,!1,!1);t.isHidden()||(this.opacities[a]=t,n=n||e.text.placed||e.icon.placed)}}for(const a in o)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=o[a]);for(const a in s)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=s[a]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t,n,i){const r=new Set;for(const o of t){const t=o.getBucket(e);t&&o.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,r,o,o.collisionBoxArray,n,i,o.tileID,e.scope),"offset"===t.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(t,o.tileID),"road"===t.elevationType&&t.updateRoadElevation(o.tileID.canonical),t.updateZOffset())}}updateBucketOpacities(t,n,i,r,o,s,a,l){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0].layout,u=t.layers[0].paint,h=!!t.layers[0].dynamicFilter(),d=new gn(null,0,!1,!1,!0),f=c.get("text-allow-overlap"),p=c.get("icon-allow-overlap"),m=c.get("text-variable-anchor"),g="map"===c.get("text-rotation-alignment"),_="map"===c.get("text-pitch-alignment"),y=u.get("symbol-z-offset"),v="sea"===c.get("symbol-elevation-reference"),x=!y.isConstant(),b=new gn(null,0,f&&(p||!t.hasIconData()||c.get("icon-optional")),p&&(f||!t.hasTextData()||c.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const w=(e,t,n)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(n)};let E=0;s&&t.updateReplacement(a,s);for(let T=0;T<t.symbolInstances.length;T++){const r=t.symbolInstances.get(T),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:u,crossTileID:f,numIconVertices:p,tileAnchorX:A,tileAnchorY:S}=r;let D=null;const C=this.retainedQueryData[t.bucketInstanceId];x&&r&&C&&(D=i.latestFeatureIndex.loadFeature({featureIndex:r.featureIndex,bucketIndex:C.bucketIndex,sourceLayerIndex:C.sourceLayerIndex,layoutVertexArrayOffset:0}));const I=y.evaluate(D,{}),R=n.has(f);let P=this.opacities[f];R?P=d:P||(P=b,this.opacities[f]=P),n.add(f);const M=c>0||u>0,F=p>0,L=this.placedOrientations[f],k=L===e.bI.vertical,O=L===e.bI.horizontal||L===e.bI.horizontalOnly;!M&&!F||P.isHidden()||E++;let B=!1;if((M||F)&&s)for(const n of t.activeReplacements){if(e.bV(n,o,e.bW.Symbol,l))continue;if(n.min.x>A||A>n.max.x||n.min.y>S||S>n.max.y)continue;const t=e.bX(A,S,a.canonical,n.footprintTileId.canonical);if(B=e.bY(t,n.footprint),B)break}if(M){const e=B?Fn:Mn(P.text);w(t.text,c,k?Fn:e),w(t.text,u,O?Fn:e);const n=P.text.isHidden(),{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:a}=r,l=t.text.placedSymbolArray,h=n||k?1:0;i>=0&&(l.get(i).hidden=h),o>=0&&(l.get(o).hidden=h),s>=0&&(l.get(s).hidden=h),a>=0&&(l.get(a).hidden=n||O?1:0);const d=this.variableOffsets[f];d&&this.markUsedJustification(t,d.anchor,r,L);const p=this.placedOrientations[f];p&&(this.markUsedJustification(t,"left",r,p),this.markUsedOrientation(t,p,r))}if(F){const e=B?Fn:Mn(P.icon),{placedIconSymbolIndex:n,verticalPlacedIconSymbolIndex:i}=r,o=t.icon.placedSymbolArray,s=P.icon.isHidden()?1:0;n>=0&&(w(t.icon,p,k?Fn:e),o.get(n).hidden=s),i>=0&&(w(t.icon,r.numVerticalIconVertices,O?Fn:e),o.get(i).hidden=s)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const n=t.collisionArrays[T];if(n){let i=new e.P(0,0),o=!0;if(n.textBox||n.verticalTextBox){if(m){const e=this.variableOffsets[f];e?(i=bn(e.anchor,e.width,e.height,e.textOffset,e.textScale),g&&i._rotate(_?this.transform.angle:-this.transform.angle)):o=!1}h&&(o=!P.clipped),n.textBox&&Tn(t.textCollisionBox.collisionVertexArray,P.text.placed,!o||k,I,v,i.x,i.y),n.verticalTextBox&&Tn(t.textCollisionBox.collisionVertexArray,P.text.placed,!o||O,I,v,i.x,i.y)}const s=o&&Boolean(!O&&n.verticalIconBox);n.iconBox&&Tn(t.iconCollisionBox.collisionVertexArray,P.icon.placed,s,I,v,r.hasIconTextFit?i.x:0,r.hasIconTextFit?i.y:0),n.verticalIconBox&&Tn(t.iconCollisionBox.collisionVertexArray,P.icon.placed,!s,I,v,r.hasIconTextFit?i.x:0,r.hasIconTextFit?i.y:0)}}}if(t.fullyClipped=0===E,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function Tn(e,t,n,i,r,o,s){e.emplaceBack(t?1:0,n?1:0,o||0,s||0,i,r?1:0),e.emplaceBack(t?1:0,n?1:0,o||0,s||0,i,r?1:0),e.emplaceBack(t?1:0,n?1:0,o||0,s||0,i,r?1:0),e.emplaceBack(t?1:0,n?1:0,o||0,s||0,i,r?1:0)}const An=Math.pow(2,25),Sn=Math.pow(2,24),Dn=Math.pow(2,17),Cn=Math.pow(2,16),In=Math.pow(2,9),Rn=Math.pow(2,8),Pn=Math.pow(2,1);function Mn(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*An+t*Sn+n*Dn+t*Cn+n*In+t*Rn+n*Pn+t}const Fn=0;class Ln{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,n,i,r,o){const s=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(s,i,e[this._currentTileIndex],this._sortAcrossTiles,o),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,s.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<s.length;){const e=s[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,n,0===e.symbolInstanceStart,o),this._currentPartIndex++,r())return!0}return!1}}class kn{constructor(e,t,n,i,r,o,s,a,l){this.placement=new En(e,r,o,s,a,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(t,n,i,r,o){const s=e.q.now(),a=()=>{const t=e.q.now()-s;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const s=n[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){const t=s,n=t.layout.get("symbol-z-elevate"),l=void 0!==t.layout.get("symbol-sort-key").constantOr(1),c=t.layout.get("symbol-z-order"),u="viewport-y"===c||"auto"===c&&!("viewport-y"!==c&&l),h=t.layout.get("text-allow-overlap")||t.layout.get("icon-allow-overlap")||t.layout.get("text-ignore-placement")||t.layout.get("icon-ignore-placement"),d=u&&h,f=this._inProgressLayer=this._inProgressLayer||new Ln(t),p=e.C(s.source,s.scope);if(f.continuePlacement(n||d?r[p]:i[p],this.placement,this._showCollisionBoxes,s,a,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const On=512/e.aj/2;class Bn{constructor(t,n,i){this.tileID=t,this.bucketInstanceId=i,this.index=new e.c0(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const r=t.canonical.x*e.aj,o=t.canonical.y*e.aj;for(let e=0;e<n.length;e++){const{key:t,crossTileID:i,tileAnchorX:s,tileAnchorY:a}=n.get(e),l=Math.floor((r+s)*On),c=Math.floor((o+a)*On);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(i)}this.index.finish()}findMatches(t,n,i){const r=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),o=On/Math.pow(2,n.canonical.z-this.tileID.canonical.z),s=n.canonical.x*e.aj,a=n.canonical.y*e.aj;for(let e=0;e<t.length;e++){const n=t.get(e);if(n.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=n,h=Math.floor((s+c)*o),d=Math.floor((a+u)*o),f=this.index.range(h-r,d-r,h+r,d+r).sort((e,t)=>e-t);for(const e of f){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!i.has(t)){i.add(t),n.crossTileID=t;break}}}}}class zn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Nn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const n in this.indexes){const e=this.indexes[n],i={};for(const n in e){const r=e[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),i[r.tileID.key]=r}this.indexes[n]=i}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let r=0;r<t.symbolInstances.length;r++)t.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const i=this.usedCrossTileIDs[e.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>e.overscaledZ)for(const r in n){const o=n[r];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,i)}else{const o=n[e.scaledTo(Number(r)).key];o&&o.findMatches(t.symbolInstances,e,i)}}for(let r=0;r<t.symbolInstances.length;r++){const e=t.symbolInstances.get(r);e.crossTileID||(e.crossTileID=n.generate(),i.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Bn(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.crossTileIDs)this.usedCrossTileIDs[e].delete(n)}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)e[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],t=!0)}return t}}class Un{constructor(){this.layerIndexes={},this.crossTileIDs=new zn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n,i){let r=this.layerIndexes[e.fqid];void 0===r&&(r=this.layerIndexes[e.fqid]=new Nn);let o=!1;const s={};"globe"!==i.name&&r.handleWrapJump(n);for(const a of t){const t=a.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(a.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const n in this.layerIndexes)t[n]||delete this.layerIndexes[n]}}const Vn=771;class jn{constructor(e,t,n,i){this.blendFunction=e,this.blendColor=t.toNonPremultipliedRenderColor(null),this.mask=n,this.blendEquation=i}}jn.Replace=[1,0,1,0],jn.disabled=new jn(jn.Replace,e.am.transparent,[!1,!1,!1,!1]),jn.unblended=new jn(jn.Replace,e.am.transparent,[!0,!0,!0,!0]),jn.alphaBlended=new jn([1,Vn,1,Vn],e.am.transparent,[!0,!0,!0,!0]),jn.alphaBlendedNonPremultiplied=new jn([770,Vn,770,Vn],e.am.transparent,[!0,!0,!0,!0]),jn.multiply=new jn([774,0,774,0],e.am.transparent,[!0,!0,!0,!0]);class Gn{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}Gn.ReadOnly=!1,Gn.ReadWrite=!0,Gn.disabled=new Gn(519,Gn.ReadOnly,[0,1]);const Hn=7680;class Wn{constructor(e,t,n,i,r,o){this.test=e,this.ref=t,this.mask=n,this.fail=i,this.depthFail=r,this.pass=o}}Wn.disabled=new Wn({func:519,mask:0},0,0,Hn,Hn,Hn);const qn=1029,Xn=2305;class Zn{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}function Yn(t,n){const i=e.c6(t,3);e.c8(t,n),e.cc(t,3,i)}function Kn(t,n){const i=e.c3([]);return e.c4(i,i,-n),e.c5(i,i,-t),i}function Jn(t,n){const i=[t[0],t[1],0],r=[n[0],n[1],0];if(e.ae(i)>=1e-15){const t=e.au([],i);e.c1(r,t,e.bG(r,t)),n[0]=r[0],n[1]=r[1]}const o=e.bF([],n,t);if(e.c2(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return Kn(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}Zn.disabled=new Zn(!1,qn,Xn),Zn.backCCW=new Zn(!0,qn,Xn),Zn.backCW=new Zn(!0,qn,2304),Zn.frontCW=new Zn(!0,1028,2304),Zn.frontCCW=new Zn(!0,1028,Xn);class Qn{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const n=t instanceof e.ac?t:new e.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=e.bQ(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const i=this.position,r=this._elevation?this._elevation.getAtPointOrZero(e.ac.fromLngLat(t)):0,o=e.ac.fromLngLat(t,r),s=[o.x-i.x,o.y-i.y,o.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Jn(s,n)}setPitchBearing(t,n){this.orientation=Kn(e.al(t),e.al(-n))}}class $n{constructor(t,n){this._transform=e.bx([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new e.ac(t[0],t[1],t[2])}get position(){const t=e.c6(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&e.cc(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.c3([]),t&&Yn(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Kn(e,t),Yn(this._transform,this._orientation)}forward(){const t=e.c6(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.c6(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.c6(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const i=new Float64Array(16);return e.bi(i,this.getWorldToCamera(t,n)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,i){const r=this.position;e.c1(r,r,-t);const o=new Float64Array(16);return e.bn(o,[i,i,i]),e.bo(o,o,r),o[10]*=n,o}getWorldToCamera(t,n){const i=new Float64Array(16),r=new Float64Array(4),o=this.position;return e.c7(r,this._orientation),e.c1(o,o,-t),e.c8(i,r),e.bo(i,i,o),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(t,n,i,r){const o=new Float64Array(16);return e.c9(o,t,n,i,r),o}getCameraToClipOrthographic(t,n,i,r,o,s){const a=new Float64Array(16);return e.ca(a,t,n,i,r,o,s),a}getDistanceToElevation(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=0===t?0:e.cb(t,n?e.aY(this.position[1]):this.position[1]),r=this.forward();return(i-this.position[2])/r[2]}clone(){return new $n([...this.position],[...this.orientation])}}const ei={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ti{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=i}interpolate(t,n,i){return null!=n.top&&null!=t.top&&(this.top=e.ai(t.top,n.top,i)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.ai(t.bottom,n.bottom,i)),null!=n.left&&null!=t.left&&(this.left=e.ai(t.left,n.left,i)),null!=n.right&&null!=t.right&&(this.right=e.ai(t.right,n.right,i)),this}getCenter(t,n){const i=e.ay((this.left+t-this.right)/2,0,t),r=e.ay((this.top+n-this.bottom)/2,0,n);return new e.P(i,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ti(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ni=15;class ii{constructor(t,n,i,r,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null!==i&&void 0!==i?i:0,this._maxPitch=null!==r&&void 0!==r?r:60,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new e.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ti,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new $n,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const e=new ii(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e._allowWorldUnderZoom=this._allowWorldUnderZoom,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<ni}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||n)&&this._updateCameraOnTerrain(),(e||n)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=e.cj(this.projectionOptions);const i=this.getProjection(),r=!e.bv(n,i);return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.cj({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bQ(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=e.ck(),e.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=e.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&n.exaggeration()&&this._centerAltitudeValidForExaggeration!==n.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*n.exaggeration(),this._centerAltitudeValidForExaggeration=n.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=n.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(void 0===this._centerAltitudeValidForExaggeration)return;const e=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(e)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let r=0,o=0;for(let s=0;s<n.length;s++){const a=new e.P(n[s][0]*this.width,i+n[s][1]*(this.height-i)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,o+=c}return 0===o?NaN:r/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),n=this.pixelsPerMeter/this.worldSize*t,i=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),o=Math.max(i-n,r);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let i;i=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const r=e.ae(e.at([],this._camera.position,i));return e.ay(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!e.cm(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const i=[t.position.x,t.position.y,t.position.z];e.cn(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new Qn;return n.position=new e.ac(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!e.co(t))return!1;e.cp(t,t);const n=e.cq([],[0,0,-1],t),i=e.cq([],[0,-1,0],t);if(i[2]<0)return!1;const r=Jn(n,i);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.ay(t[2],r/i,r/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const n=[new e.cr(0,t)];if(this.renderWorldCopies){const i=this.pointCoordinate(new e.P(0,0)),r=this.pointCoordinate(new e.P(this.width,0)),o=this.pointCoordinate(new e.P(this.width,this.height)),s=this.pointCoordinate(new e.P(0,this.height)),a=Math.floor(Math.min(i.x,r.x,o.x,s.x)),l=Math.floor(Math.max(i.x,r.x,o.x,s.x)),c=1;for(let u=a-c;u<=l+c;u++)0!==u&&n.push(new e.cr(u,t))}return n}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,i){let r=[];const o=null!=i,s=!o;if(s&&this.zoom<n)return r;if(o&&0===i[0]&&0===i[1])return r;const a=new Set,l=(t,n,i,o,s)=>{const l=e.cV(n,t,i,o,s);a.has(l)||(r.push(new e.aM(t,n,i,o,s)),a.add(l))};for(let e=0;e<t.length;e++){const r=t[e];if(s&&r.canonical.z!==n)continue;const a=r.canonical,c=r.overscaledZ,u=r.wrap,h=1<<a.z,d=a.x+1<h,f=a.x>0,p=a.y+1<h,m=a.y>0,g=r.wrap-(f?0:1),_=r.wrap+(d?0:1),y=f?a.x-1:h-1,v=d?a.x+1:0;if(o)i[0]<0?(l(c,_,a.z,v,a.y),i[1]<0&&p&&(l(c,u,a.z,a.x,a.y+1),l(c,_,a.z,v,a.y+1)),i[1]>0&&m&&(l(c,u,a.z,a.x,a.y-1),l(c,_,a.z,v,a.y-1))):i[0]>0?(l(c,g,a.z,y,a.y),i[1]<0&&p&&(l(c,u,a.z,a.x,a.y+1),l(c,g,a.z,y,a.y+1)),i[1]>0&&m&&(l(c,u,a.z,a.x,a.y-1),l(c,g,a.z,y,a.y-1))):i[1]<0&&p?l(c,u,a.z,a.x,a.y+1):m&&l(c,u,a.z,a.x,a.y-1);else{const e=r.visibleQuadrants;1&e&&(l(c,g,a.z,y,a.y),m&&(l(c,u,a.z,a.x,a.y-1),l(c,g,a.z,y,a.y-1))),2&e&&(l(c,_,a.z,v,a.y),m&&(l(c,u,a.z,a.x,a.y-1),l(c,_,a.z,v,a.y-1))),4&e&&(l(c,g,a.z,y,a.y),p&&(l(c,u,a.z,a.x,a.y+1),l(c,g,a.z,y,a.y+1))),8&e&&(l(c,_,a.z,v,a.y),p&&(l(c,u,a.z,a.x,a.y+1),l(c,_,a.z,v,a.y+1)))}}const c=[];for(const e of r)r.some(t=>e.isChildOf(t))||c.push(e);if(r=c.filter(e=>!t.some(t=>!!(e.overscaledZ<n&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))),s){const e=1<<n,t="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),i=[e*t.x,e*t.y],o=4,s=o*o;r=r.filter(e=>{const t=e.canonical.x+.5-i[0],n=e.canonical.y+.5-i[1];return t*t+n*n<s})}return r}extendTileCoverToNearPlane(t,n,i){const r=[],o=new Set;for(const e of t)o.add(e.key);const s=(t,n,i,s,a)=>{const l=e.cV(n,t,i,s,a);o.has(l)||(r.push(new e.aM(t,n,i,s,a)),o.add(l))},a=t.reduce((e,t)=>Math.max(e,t.overscaledZ),i),l=1<<i,c=[new e.P(0,0),new e.P(e.aj,0),new e.P(e.aj,e.aj),new e.P(0,e.aj)],u=new e.P(0,0),h=new e.P(0,0),d=(t,n)=>{const r=Math.floor(t[0]),o=Math.floor(t[1]),d=(t[0]-r)*e.aj,f=(t[1]-o)*e.aj,p=Math.floor(n[0]),m=Math.floor(n[1]),g=(n[0]-p)*e.aj,_=(n[1]-m)*e.aj;for(let y=-1;y<=1;y++){const t=r+y;if(!(t<0||t>=l)){u.x=d-y*e.aj,h.x=g-(t-p)*e.aj;for(let n=-1;n<=1;n++){const r=o+n;u.y=f-n*e.aj,h.y=_-(r-m)*e.aj,e.cW(u,h,c)&&s(a,0,i,t,r)}}}},f=n.points,p=f[e.cs],m=f[e.ct],g=this._projectToGround(p,f[e.cu]),_=this._projectToGround(m,f[e.cv]);return d(p,g),d(m,_),r}_projectToGround(t,n){return e.cw(e.cx(),t,n,t[2]/(t[2]-n[2]))}coveringTiles(t){let n=this.coveringZoomLevel(t);const i=n,r=this.elevation&&this.elevation.exaggeration(),o=r&&!t.isTerrainDEM,s="mercator"===this.projection.name;if(void 0!==t.minzoom&&n<t.minzoom)return[];void 0!==t.maxzoom&&n>t.maxzoom&&(n=t.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,c=1<<n,u=[c*a.x,c*a.y,0],h="globe"===this.projection.name,d=!h,f=e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,d),p=h?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=c*e.cb(1,this.center.lat),g=this._camera.position[2]/e.cb(1,this.center.lat),_=[c*p.x,c*p.y,g*(d?1:m)],y=h||r,v=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),x=this.isLODDisabled(!0)?n:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude}else b=this._centerAltitude;const w=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,E=this.projection.isReprojectedInTileSpace?e.cz(this):1,T=t=>{const n=1/4e4,i=new e.ac(t.x+n,t.y,t.z),r=new e.ac(t.x,t.y+n,t.z),o=t.toLngLat(),s=i.toLngLat(),a=r.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*E/n},A=t=>{const n=b,i=w;return{aabb:e.cC(this,c,0,0,0,t,i,n,this.projection),zoom:0,x:0,y:0,minZ:i,maxZ:n,wrap:t,fullyVisible:!1}},S=[];let D=[];const C=n,I=t.reparseOverscaled?i:n,R=(g-this._centerAltitude)*m,P=e=>{if(!this._elevation||!e.tileID||!s)return;const t=this._elevation.getMinMaxForTile(e.tileID),n=e.aabb;t?(n.min[2]=t.min,n.max[2]=t.max,n.center[2]=(n.min[2]+n.max[2])/2):(e.shouldSplit=F(e),e.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},M=(e,t)=>{if(.707*t<e)return 1;const n=t/e;return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)},F=t=>{if(t.zoom<x)return!0;if(t.zoom===C)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const n=t.aabb.distanceX(_),r=t.aabb.distanceY(_);let a=R,c=1;if(h){a=t.aabb.distanceZ(_);const n=Math.pow(2,t.zoom),i=e.aY((t.y+1)/n),r=e.aY(t.y/n),o=Math.min(Math.max(l,i),r),s=e.c_(o)/e.c_(l);if(c=o===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,s/this._mercatorScaleRatio),this.zoom<=e.cX&&t.zoom===C-1&&s>=.9)return!0}else if(o&&(a=t.aabb.distanceZ(_)*m),this.projection.isReprojectedInTileSpace&&i<=5){const n=Math.pow(2,t.zoom),i=T(new e.ac((t.x+.5)/n,(t.y+.5)/n));c=i>.85?1:i}if(!s){const e=Math.sqrt(n*n+r*r+a*a);let i=(1<<C-t.zoom)*v*c;return i*=M(Math.max(a,R),e),e<i}let d=Number.MAX_VALUE,f=0;const p=t.aabb.getCorners(),g=[];for(const i of p){e.at(g,i,_),h||(o?g[2]*=m:g[2]=R);const t=e.bG(g,this._camera.forward());t<d&&(d=t,f=Math.abs(g[2]))}let y=(1<<C-t.zoom)*v*c;if(y*=M(Math.max(f,R),d),d<y)return!0;const b=t.aabb.closestPoint(u);return b[0]===u[0]&&b[1]===u[1]};if(this.renderWorldCopies)for(let e=1;e<=3;e++)S.push(A(-e)),S.push(A(e));for(S.push(A(0));S.length>0;){const i=S.pop(),r=i.x,a=i.y;let l=i.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===i.y||i.y===(1<<i.zoom)-1);if(!l){let t=y?i.aabb.intersects(f):i.aabb.intersectsFlat(f);if(0===t&&d()){const n=new e.cA(i.zoom,r,a);t=e.cB(this,c,n,!0).intersects(f)}if(0===t)continue;l=2===t}if(i.zoom!==C&&F(i))for(let t=0;t<4;t++){const n=(r<<1)+t%2,u=(a<<1)+(t>>1),d={aabb:s?i.aabb.quadrant(t):e.cC(this,c,i.zoom+1,n,u,i.wrap,i.minZ,i.maxZ,this.projection),zoom:i.zoom+1,x:n,y:u,wrap:i.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:i.minZ,maxZ:i.maxZ};o&&!h&&(d.tileID=new e.aM(i.zoom+1===C?I:i.zoom+1,i.wrap,i.zoom+1,n,u),P(d)),S.push(d)}else{const o=i.zoom===C?I:i.zoom;if(t.minzoom&&t.minzoom>o)continue;let s=0;if(!l){let n=y?i.aabb.intersectsPrecise(f):i.aabb.intersectsPreciseFlat(f);if(0===n&&d()){const t=new e.cA(i.zoom,r,a);n=e.cB(this,c,t,!0).intersectsPrecise(f)}if(0===n)continue;if(t.calculateQuadrantVisibility)if(f.containsPoint(i.aabb.center))s=15;else for(let e=0;e<4;e++)0!==i.aabb.quadrant(e).intersects(f)&&(s|=1<<e)}const h=u[0]-(.5+r+(i.wrap<<i.zoom))*(1<<n-i.zoom),p=u[1]-.5-a,m=i.tileID?i.tileID:new e.aM(o,i.wrap,i.zoom,r,a);t.calculateQuadrantVisibility&&(m.visibleQuadrants=s),D.push({tileID:m,distanceSq:h*h+p*p})}}if(this.fogCullDistSq){const n=this.fogCullDistSq,i=this.horizonLineFromTop();D=D.filter(r=>{const o=[0,0,0,1],s=[e.aj,e.aj,0,1],a=this.calculateFogTileMatrix(r.tileID.toUnwrapped());e.aA(o,o,a),e.aA(s,s,a);const l=e.cD([],o,s),c=e.cE([],o,s),u=e.cY(l,c);if(0===u)return!0;let h=!1;const d=this._elevation;if(d&&u>n&&0!==i){const n=this.calculateProjMatrix(r.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=d.getMinMaxForTile(r.tileID)),o||(o={min:w,max:b});const s=e.cF(this.rotation),a=[s[0]*e.aj,s[1]*e.aj,o.max];e.ad(a,a,n),h=(1-a[1])*this.height*.5<i}return u<n||h})}return D.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const n=e.ay(t.lat,-e.cG,e.cG),i=this.projection.project(t.lng,n);return new e.P(i.x*this.worldSize,i.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let i,r;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;i=(n.x-o.x)/e,r=(n.y-o.y)/e}else{const e=this.pointCoordinate(n),t=this.pointCoordinate(o);i=e.x-t.x,r=e.y-t.y}const s=this.locationCoordinate(t);this.setLocation(new e.ac(s.x-i,s.y-r))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e,t){return this.projection.locationPoint(this,e,t)}locationPoint3D(e,t){return this.projection.locationPoint(this,e,t,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e,t){return this.coordinateLocation(this.pointCoordinate3D(e,t))}locationCoordinate(t,n){const i=n?e.cb(n,t.lat):void 0,r=this.projection.project(t.lng,t.lat);return new e.ac(r.x,r.y,i)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,n){const i=null!=n?n:this._centerAltitude,r=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.aA(r,r,this.pixelMatrixInverse),e.aA(o,o,this.pixelMatrixInverse);const s=o[3];e.cH(r,r,1/r[3]),e.cH(o,o,1/s);const a=r[2],l=o[2];return{p0:r,p1:o,t:a===l?0:(i-a)/(l-a)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];return e.aA(n,n,this.pixelMatrixInverse),e.aA(i,i,this.pixelMatrixInverse),e.cH(n,n,1/n[3]),e.cH(i,i,1/i[3]),n[2]=e.cb(n[2],this._center.lat)*this.worldSize,i[2]=e.cb(i[2],this._center.lat)*this.worldSize,e.cH(n,n,1/this.worldSize),e.cH(i,i,1/this.worldSize),new e.av([n[0],n[1],n[2]],e.au([],e.at([],i,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:i,t:r}=t,o=e.cb(n[2],this._center.lat),s=e.cb(i[2],this._center.lat);return new e.ac(e.ai(n[0],i[0],r)/this.worldSize,e.ai(n[1],i[1],r)/this.worldSize,e.ai(o,s,r))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t,n){if(!this.elevation)return this.pointCoordinate(t,n);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new e.ac(i[0],i[1],i[2]);let r=0,o=this.horizonLineFromTop();if(t.y>o)return this.pointCoordinate(t,n);const s=.02*o,a=t.clone();for(let l=0;l<10&&o-r>s;l++){a.y=e.ai(r,o,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(o=a.y,i=t):r=a.y}return i?new e.ac(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.cI)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const i=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,i+t.toAltitude(),1];return e.aA(r,r,this.pixelMatrix),r[3]>0?new e.P(r[0]/r[3],r[1]/r[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,o=this.pointLocation3D(new e.P(n,t)),s=this.pointLocation3D(new e.P(r,t)),a=this.pointLocation3D(new e.P(r,i)),l=this.pointLocation3D(new e.P(n,i));let c=Math.min(o.lng,s.lng,a.lng,l.lng),u=Math.max(o.lng,s.lng,a.lng,l.lng),h=Math.min(o.lat,s.lat,a.lat,l.lat),d=Math.max(o.lat,s.lat,a.lat,l.lat);const f=Math.pow(2,-this.zoom)/16*270,p="globe"===this.projection.name?1:4,m=(t,n,i,r,o)=>{const s=(t+i)/2,a=(n+r)/2,l=new e.P(s,a),{lng:g,lat:_}=this.pointLocation3D(l),y=Math.max(0,c-g,h-_,g-u,_-d);c=Math.min(c,g),u=Math.max(u,g),h=Math.min(h,_),d=Math.max(d,_),(o<p||y>f)&&(m(t,n,s,a,o+1),m(s,a,i,r,o+1))};if(m(n,t,r,t,1),m(r,t,r,i,1),m(r,i,n,i,1),m(n,i,n,t,1),"globe"===this.projection.name){const[t,n]=e.cJ(this);t?(d=90,u=180,c=-180):n&&(h=-90,u=180,c=-180)}return new e.aG(new e.ci(c,h),new e.ci(u,d))}_getBoundsRectangular(t,n){const{top:i,left:r}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new e.P(r,i),l=new e.P(s,i),c=new e.P(s,o),u=new e.P(r,o);let h=this.pointCoordinate(a,t),d=this.pointCoordinate(l,t);const f=this.pointCoordinate(c,n),p=this.pointCoordinate(u,n),m=(e,t)=>(t.y-e.y)/(t.x-e.x);return h.y>1&&d.y>=0?h=new e.ac((1-p.y)/m(p,h)+p.x,1):h.y<0&&d.y<=1&&(h=new e.ac(-p.y/m(p,h)+p.x,0)),d.y>1&&h.y>=0?d=new e.ac((1-f.y)/m(f,d)+f.x,1):d.y<0&&h.y<=1&&(d=new e.ac(-f.y/m(f,d)+f.x,0)),(new e.aG).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(f))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce((e,t)=>{if(t.dem){const n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,n=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,n):n}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.cG,this.maxLat=e.cG,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.aD(this.minLng)*this.tileSize,this.worldMaxX=e.aD(this.maxLng)*this.tileSize,this.worldMinY=e.aH(this.maxLat)*this.tileSize,this.worldMaxY=e.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const n=t.key,i=this._distanceTileDataCache;if(i[n])return i[n];const r=t.canonical,o=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(r.z),l=(r.x+Math.pow(2,r.z)*t.wrap)*a,c=r.y*a,u=this.point;u.x*=s/this.worldSize,u.y*=s/this.worldSize;const h=this.angle,d=Math.sin(-h),f=-Math.cos(-h);return i[n]={bearing:[d,f],center:[(u.x-l)*o,(u.y-c)*o],scale:a/e.aj*o},i[n]}calculateFogTileMatrix(t){const n=t.key,i=this._fogTileMatrixCache;if(i[n])return i[n];const r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.az(r,this.worldToFogMatrix,r),i[n]=new Float32Array(r),i[n]}calculateProjMatrix(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t.key;let o;if(o=i?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,o[r])return o[r];const s=this.calculatePosMatrix(t,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,e.az(s,a,s),o[r]=new Float32Array(s),o[r]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,i=this._pixelsToTileUnitsCache;if(i[n])return i[n];const r=e.cK(t,this);return i[n]=r,i[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,n=e.bn([],[t,t,t]);return e.az(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const n=e.cb(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),r=this._camera.forward(),o=e.cb(1,this._center.lat);i[2]/=o,r[2]/=o,e.au(r,r);const s=t.raycast(i,r,t.exaggeration());if(s){const t=e.bE([],i,r,s),n=new e.ac(t[0],t[1],e.cb(t[2],e.aY(t[1]))),a=(n.z+e.ae([n.x-i[0],n.y-i[1],n.z-i[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=n.toAltitude(),this._center=this.coordinateLocation(n),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const n=this._elevation,i=e.cb(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),o=n.getAtPointOrZero(new e.ac(...r)),s=this.pixelsPerMeter/this.worldSize*o,a=this._minimumHeightOverTerrain(),l=r[2]-s;if(l<=a)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),n=[r[0],r[1],t.z-r[2]],i=e.ae(n);n[2]-=(a-l)/this._pixelsPerMercatorPixel;const o=e.ae(n);if(0===o)return;e.c1(n,n,i/o*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],t.z*this._pixelsPerMercatorPixel-n[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const n=this.center;return n.lat=e.ay(n.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(n.lng=e.ay(n.lng,this.minLng,this.maxLng)),this.center=n,void(this._constraining=!1)}const n=this._unmodified,{x:i,y:r}=this.point;let o=0,s=i,a=r;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(r-c<u&&(a=u+c),r+c>h&&(a=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),a=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,n=this.worldSize/2-(e+t)/2;s=(i+n+this.worldSize)%this.worldSize-n,s-l<e&&(s=e+l),s+l>t&&(s=t-l),t-e<this.width&&(o=Math.max(o,this.width/(t-e)),s=(t+e)/2)}s===i&&a===r||this._allowWorldUnderZoom||(this.center=this.unproject(new e.P(s,a))),o&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n="globe"===this.projection.name,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.cb(1,this.center.lat)/e.cb(1,e.c$));const r=e.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const o="meters"===this.projection.zAxisUnit?i:1,s=this._camera.getWorldToCamera(this.worldSize,o);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let n=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),i=n*this.aspect,r=-i,o=-n;i-=t.x,r-=t.x,n+=t.y,o+=t.y,a=this._camera.getCameraToClipOrthographic(r,i,o,n,this._nearZ,this._farZ),((t,n,i,r)=>{for(let o=0;o<16;o++)t[o]=e.ai(n[o],i[o],r)})(a,a,l,e.cZ(this.pitch>=ni?1:this.pitch/ni))}else a=l;const c=e.cM([],l,s);let u=e.cM([],a,s);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),n=e.bx([]);e.bo(n,n,[t.x*this.worldSize,t.y*this.worldSize,0]),e.az(n,n,e.cN(this)),e.bo(n,n,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.az(u,u,n),e.az(c,c,n),this.inverseAdjustmentMatrix=e.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.cP([],u,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=u,this.invProjMatrix=e.bi(new Float64Array(16),this.projMatrix),n){const n=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);n[8]=2*-t.x/this.width,n[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.cM([],n,s)}else this.expandedFarZProjMatrix=this.projMatrix;const h=e.bi([],a);this.frustumCorners=e.cQ.fromInvProjectionMatrix(h,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const d=new Float32Array(16);e.bx(d),e.cP(d,d,[1,-1,1]),e.cR(d,d,this._pitch),e.by(d,d,this.angle);const f=e.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.bw(f);const p=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;f[8]=2*-t.x/this.width,f[9]=2*(t.y+p)/this.height,this.skyboxMatrix=e.az(d,f,d);const m=this.point,g=m.x,_=m.y,y=this.width%2/2,v=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),w=g-Math.round(g)+x*y+b*v,E=_-Math.round(_)+x*v+b*y,T=new Float64Array(u);if(e.bo(T,T,[w>.5?w-1:w,E>.5?E-1:E,0]),this.alignedProjMatrix=T,u=e.bz(),e.cP(u,u,[this.width/2,-this.height/2,1]),e.bo(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.bz(),e.cP(u,u,[1,-1,1]),e.bo(u,u,[-1,-1,0]),e.cP(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.az(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=e.bi(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.cS(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.ad(t,t,s),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,i=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,o=[t,t,n];e.c1(o,o,r),e.c1(i,i,-1),e.cT(i,i,o);const s=e.bz();e.bo(s,s,i),e.cP(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,r)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,n=this._camera.forward(),i=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[i.x/this.worldSize-n[0]*r,i.y/this.worldSize-n[1]*r,e/this.worldSize*this._centerAltitude-n[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],r=t[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(o=Math.min((n-i)/r,1)),this._camera.position=e.bE([],this._camera.position,t,o),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:r}=this._camera.getPitchBearing(),o=e.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.al(this._maxPitch)),a=Math.max((t[2]-o)/Math.cos(i),s),l=this._zoomFromMercatorZ(a);e.bE(t,t,n,a),this._pitch=e.ay(i,e.al(this.minPitch),e.al(this.maxPitch)),this.angle=e.bQ(r,-Math.PI,Math.PI),this._setZoom(e.ay(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,e)*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,i=e.cI,r=0,o=1/0;for(;i-n>1e-6&&i>n;){const e=n+.5*(i-n),s=this.tileSize*Math.pow(2,e),a=this.getCameraToCenterDistance(this.projection,e,s),l=this.scaleZoom(a/(Math.max(0,t)*this.tileSize)),c=Math.abs(e-l);c<o&&(o=c,r=e),e<l?n=e:i=e}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const i=Math.min(t.x,n.x),r=Math.max(t.x,n.x),o=Math.min(t.y,n.y),s=Math.max(t.y,n.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new e.P(i,o),new e.P(r,s),new e.P(i,s),new e.P(r,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const n=this.rayIntersectionCoordinate(t);if(n.x<l||n.y<0||n.x>c||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,n){const i=e.ae(e.at([],this._camera.position,t)),r=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,n){let[i,r,o]=t;const s=[i,r,o,1];e.aA(s,s,n);const a=s[3]=Math.max(s[3],1e-6);return s[0]/=a,s[1]/=a,s[2]/=a,s}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const r=e.cL(t,n,this.width,this.height,1024),o=t.pixelSpaceConversion(this.center.lat,i,r);let s=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(s=e.ai(1,s,e.cZ(this.pitch>=ni?1:this.pitch/ni))),s}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.az(t,t,this.globeMatrix),t}getFrustum(t){return e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const ri=(t,n)=>{if(n>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),n<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const i=t.transform,r=Math.max(Math.abs(i._zoom-(t.minCutoffZoom-1)),1),o=i.isLODDisabled(!1)?e.af(60,45,i.pitch):e.af(30,15,i.pitch),s=i._farZ-i._nearZ,a=n*i.height,l=((1-(c=o))*i.cameraToCenterDistance+c*(i._farZ+a))*r;var c;return{shouldRenderCutoff:o<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(l-i._nearZ)/s,(l-a-i._nearZ)/s]}}},oi={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class si{constructor(e,t){this.aabb=e,this.lastCascade=t}}class ai{add(e,t){const n=this.receivers[e.key];void 0!==n?(n.aabb.min[0]=Math.min(n.aabb.min[0],t.min[0]),n.aabb.min[1]=Math.min(n.aabb.min[1],t.min[1]),n.aabb.min[2]=Math.min(n.aabb.min[2],t.min[2]),n.aabb.max[0]=Math.max(n.aabb.max[0],t.max[0]),n.aabb.max[1]=Math.max(n.aabb.max[1],t.max[1]),n.aabb.max[2]=Math.max(n.aabb.max[2],t.max[2])):this.receivers[e.key]=new si(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,n,i){const r=e.d6.fromPoints(t.points);let o=0;for(const s in this.receivers){const t=this.receivers[s];if(!t)continue;if(!r.intersectsAabb(t.aabb))continue;t.aabb.min=r.closestPoint(t.aabb.min),t.aabb.max=r.closestPoint(t.aabb.max);const a=t.aabb.getCorners();for(let r=0;r<i.length;r++){let s=!0;for(const t of a){const o=[t[0]*n,t[1]*n,t[2]];if(e.ad(o,o,i[r].matrix),o[0]<-1||o[0]>1||o[1]<-1||o[1]>1){s=!1;break}}if(t.lastCascade=r,o=Math.max(o,r),s)break}}return o+1}}class li{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ai,this._depthMode=new Gn(e.context.gl.LEQUAL,Gn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,e.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),e.tp.registerParameter(oi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(oi,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),e.tp.registerParameter(oi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),e.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const r=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||r<=0)return;if(this._shadowLayerCount=i.style.order.reduce((e,n)=>{const r=i.style._mergedLayers[n];return e+(r.hasShadowPass()&&!r.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const o=i.context,s=oi.shadowMapResolution,a=oi.shadowMapResolution;if(0===this._cascades.length||oi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<oi.cascadeCount;++t){const t=i._shadowMapDebug,n=o.gl,r=o.createFramebuffer(s,a,t,"texture"),l=new e.T(o,{width:s,height:a,data:null},n.DEPTH_COMPONENT16);if(r.depthAttachment.set(l.texture),t){const t=new e.T(o,{width:s,height:a,data:null},n.RGBA8);r.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:r,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.cy,scale:0})}}this.shadowDirection=ui(n);let l=0;if(t.elevation){const e=t.elevation,n=[1e4,-1e4];e.visibleDemTiles.filter(e=>e.dem).forEach(e=>{const t=e.dem.tree;n[0]=Math.min(n[0],t.minimums[0]),n[1]=Math.max(n[1],t.maximums[0])}),1e4!==n[0]&&(l=(n[1]-n[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,u=3*c,h=new Float64Array(16);for(let p=0;p<this._cascades.length;++p){const n=this._cascades[p];let i=t.height/50,r=1;1===oi.cascadeCount?r=u:0===p?r=c:(i=c,r=u);const[o,s]=di(t,this.shadowDirection,i,r,oi.shadowMapResolution,l);n.scale=t.scale,n.matrix=o,n.boundingSphereRadius=s,e.bi(h,n.matrix),n.frustum=e.cy.fromInvProjectionMatrix(h,1,0,!0),n.far=r}const d=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[d].far,this._cascades[d].far],this._uniformValues.u_shadow_intensity=r,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/oi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=oi.shadowMapResolution,this._uniformValues.u_shadowmap_0=ei.ShadowMap0,this._uniformValues.u_shadowmap_1=ei.ShadowMap0+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const f=i.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(f){const n=f.getMinMaxForTile(e);n&&(t=n)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e}drawShadowPass(t,n){if(!this.enabled)return;const i=this.painter,r=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),r.viewport.set([0,0,oi.shadowMapResolution,oi.shadowMapResolution]);for(let o=0;o<this._numCascadesToRender;++o){i.currentShadowCascade=o,r.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),r.clear({color:e.am.white,depth:1});for(const e of t.order){const r=t._mergedLayers[e];if(!r.hasShadowPass()||r.isHidden(i.transform.zoom))continue;const o=t.getLayerSourceCache(r),s=o?n[o.id]:void 0;("model"===r.type||s&&s.length)&&i.renderLayer(i,o,r,s)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,t=e.style,n=e.context,i=n.gl,r=t.directionalLight,o=t.ambientLight;if(!r||!o)return;const s=[],a=ri(e,e.longestCutoffRange);a.shouldRenderCutoff&&s.push("RENDER_CUTOFF"),s.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&s.push("NORMAL_OFFSET");const l=hi(t,r,o),c=new Gn(i.LEQUAL,Gn.ReadOnly,e.depthRangeFor3D),u=new Wn({func:i.EQUAL,mask:255},0,255,i.KEEP,i.KEEP,i.KEEP);for(const h of this._groundShadowTiles){const t=h.toUnwrapped(),r=e.isTileAffectedByFog(h),o=e.getOrCreateProgram("groundShadow",{defines:s,overrideFog:r});this.setupShadows(t,o),e.uploadCommonUniforms(n,o,t,null,a);const d={u_matrix:e.transform.calculateProjMatrix(t),u_ground_shadow_factor:l};o.draw(e,i.TRIANGLES,c,u,jn.multiply,Zn.disabled,d,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,null,e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?jn.unblended:jn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,i=n.calculatePosMatrix(t,n.worldSize);return e.az(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(t){return e.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,i){if(!this.enabled)return;const r=this.painter.transform,o=this.painter.context,s=o.gl,a=this._uniformValues,l=new Float64Array(16),c=r.calculatePosMatrix(t,r.worldSize);for(let u=0;u<this._cascades.length;u++)e.az(l,this._cascades[u].matrix,c),a[0===u?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),o.activeTexture.set(s.TEXTURE0+ei.ShadowMap0+u),this._cascades[u].texture.bindExtraParam(s.LINEAR,s.LINEAR,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE,s.GREATER);if(this.useNormalOffset=!!i,this.useNormalOffset){const n=e.d4(t.canonical),o=2/r.tileSize*e.aj/oi.shadowMapResolution,s=o*this._cascades[0].boundingSphereRadius,l=o*this._cascades[this._cascades.length-1].boundingSphereRadius,c=("vector-tile"===i?1:3)*function(t){const n=e.ay((t-22)/-22,0,1);return.125*(1-n)+4*n}(r.zoom);a.u_shadow_normal_offset=[n,s*c,l*c],a.u_shadow_bias=[1e-4,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(o,a)}setupShadowsFromMatrix(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.enabled)return;const r=this.painter.context,o=r.gl,s=this._uniformValues,a=new Float64Array(16);for(let l=0;l<oi.cascadeCount;l++)e.az(a,this._cascades[l].matrix,t),s[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),r.activeTexture.set(o.TEXTURE0+ei.ShadowMap0+l),this._cascades[l].texture.bindExtraParam(o.LINEAR,o.LINEAR,o.CLAMP_TO_EDGE,o.CLAMP_TO_EDGE,o.GREATER);if(this.useNormalOffset=i,i){const e=oi.normalOffset;s.u_shadow_normal_offset=[1,e,e],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(r,s)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,i,r){if(r[2]>=0)return{};const o=function(t,n,i){const r=i/(1<<t.canonical.z);return new e.d6([t.canonical.x*r+t.wrap*i,t.canonical.y*r+t.wrap*i,0],[(t.canonical.x+1)*r+t.wrap*i,(t.canonical.y+1)*r+t.wrap*i,n])}(t,n,i).getCorners(),s=n/-r[2];r[0]<0?(e.d5(o[0],o[0],[r[0]*s,0,0]),e.d5(o[3],o[3],[r[0]*s,0,0])):r[0]>0&&(e.d5(o[1],o[1],[r[0]*s,0,0]),e.d5(o[2],o[2],[r[0]*s,0,0])),r[1]<0?(e.d5(o[0],o[0],[0,r[1]*s,0]),e.d5(o[1],o[1],[0,r[1]*s,0])):r[1]>0&&(e.d5(o[2],o[2],[0,r[1]*s,0]),e.d5(o[3],o[3],[0,r[1]*s,0]));const a={};return a.vertices=o,a.planes=[ci(o[1],o[0],o[4]),ci(o[2],o[1],o[5]),ci(o[3],o[2],o[6]),ci(o[0],o[3],o[7])],a}addShadowReceiver(t,n,i){this._receivers.add(t,e.d6.fromTileIdAndHeight(t,n,i))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function ci(t,n,i){const r=e.at([],i,n),o=e.at([],t,n),s=e.bF([],r,o),a=e.ae(s);return 0===a?[0,0,1,0]:(e.c1(s,s,1/a),[s[0],s[1],s[2],-e.bG(s,n)])}function ui(t){const n=t.properties.get("direction"),i=e.d1(n.x,n.y,n.z);i[2]=e.ay(i[2],0,75);const r=e.d3([i[0],i[1],i[2]]);return e.d2(r.x,r.y,r.z)}function hi(t,n,i){const r="none"===n.properties.get("color-use-theme"),o=n.properties.get("color"),s=n.properties.get("intensity"),a=n.properties.get("direction"),l=[a.x,a.y,a.z],c="none"===i.properties.get("color-use-theme"),u=i.properties.get("color"),h=i.properties.get("intensity"),d=Math.max(e.bG([0,0,1],l),0),f=[0,0,0];e.c1(f,u.toPremultipliedRenderColor(c?null:t.getLut(n.scope)).toArray01Linear().slice(0,3),h);const p=[0,0,0];return e.c1(p,o.toPremultipliedRenderColor(r?null:t.getLut(i.scope)).toArray01Linear().slice(0,3),d*s),e.d8([f[0]>0?f[0]/(f[0]+p[0]):0,f[1]>0?f[1]/(f[1]+p[1]):0,f[2]>0?f[2]/(f[2]+p[2]):0])}function di(t,n,i,r,o,s){const a=t.zoom,l=t.scale,c=t.worldSize,u=1/c,h=t.aspect,d=Math.sqrt(1+h*h)*Math.tan(.5*t.fovX),f=d*d,p=r-i,m=r+i;let g,_;f>p/m?(g=r,_=r*d):(g=.5*m*(1+f),_=.5*Math.sqrt(p*p+2*(r*r+i*i)*f+m*m*f*f));const y=t.projection.pixelsPerMeter(t.center.lat,c),v=t._camera.getCameraToWorldMercator(),x=[0,0,-g*u];e.ad(x,x,v);let b=_*u;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const n=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?y:1),o=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,i,r);o[8]=2*-t.centerOffset.x/t.width,o[9]=2*t.centerOffset.y/t.height;const s=new Float64Array(16);e.cM(s,o,n);const u=new Float64Array(16);e.bi(u,s);const h=e.cy.fromInvProjectionMatrix(u,c,a,!0);for(const i of h.points){const n=((E=i)[0]/=l,E[1]/=l,E[2]=e.cb(E[2],t._center.lat),E);b=Math.max(b,e.c2(e.d7([],x,n)))}}var E;b*=o/(o-1);const T=Math.acos(n[2]),A=Math.atan2(-n[0],-n[1]),S=new $n;S.position=x,S.setPitchBearing(T,A);const D=S.getWorldToCamera(c,y),C=b*c,I=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*C),R=S.getCameraToClipOrthographic(-C,C,-C,C,I,(C+s*y)/n[2]),P=new Float64Array(16);e.az(P,R,D);const M=e.d2(Math.floor(1e6*x[0])/1e6*c,Math.floor(1e6*x[1])/1e6*c,0),F=.5*o,L=[0,0,0];e.ad(L,M,P),e.c1(L,L,F);const k=[Math.floor(L[0]),Math.floor(L[1]),Math.floor(L[2])],O=[0,0,0];e.at(O,L,k),e.c1(O,O,-1/F);const B=new Float64Array(16);return e.bx(B),e.bo(B,B,O),e.az(P,B,P),[P,C]}class fi extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,n){return e.aS(this.requestManager.transformRequest(n,e.R.Model).url).then(n=>{if(!n)return;const i=e.aT(n),r=new e.aU(t,void 0,void 0,i);return r.computeBoundsAndApplyParent(),r}).catch(i=>{if(i&&404===i.status)return null;this.fire(new e.z(new Error("Could not load model ".concat(t," from ").concat(n,": ").concat(i.message))))})}load(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{forceReload:!1};this.models[n]||(this.models[n]={});const r=Object.keys(t),o=[],s=[];for(const e of r){const r=t[e];this.hasURLBeenRequested(r)&&!i.forceReload||(this.modelByURL[r]={modelId:e,scope:n},o.push(this.loadModel(e,r)),s.push(e)),this.models[n][e]||(this.models[n][e]={model:null,numReferences:1})}this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+s.length,Promise.allSettled(o).then(t=>{for(let e=0;e<t.length;e++){const{status:i}=t[e];if("rejected"===i)continue;const{value:r}=t[e];this.models[n][s[e]]||(this.models[n][s[e]]={model:null,numReferences:1}),this.models[n][s[e]].model=r}this.numModelsLoading[n]-=s.length,this.fire(new e.A("data",{dataType:"style"}))}).catch(t=>{this.fire(new e.z(new Error("Could not load models: ".concat(t.message))))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!((arguments.length>2&&void 0!==arguments[2]?arguments[2]:{exactIdMatch:!1}).exactIdMatch?this.getModel(e,t):this.getModelByURL(this.modelUris[t][e]))}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]?this.models[t][e].model:void 0}getModelByURL(e){if(!e)return null;const t=this.modelByURL[e];return t?this.models[t.scope][t.modelId].model:null}hasModelBeenAdded(e,t){return this.models[t]&&void 0!==this.models[t][e]}getModelURIs(e){return this.modelUris[e]||{}}addModel(e,t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const i=this.requestManager.normalizeModelURL(t);if((this.hasModel(e,n,{exactIdMatch:!0})||this.hasModelBeenAdded(e,n))&&this.modelUris[n][e]===i)this.models[n][e].numReferences++;else if(this.hasURLBeenRequested(i)){const{scope:e,modelId:t}=this.modelByURL[i];this.models[e][t].numReferences++}else this.modelUris[n][e]=i,this.load({[e]:this.modelUris[n][e]},n)}addModelURLs(e,t){this.models[t]||(this.models[t]={}),this.modelUris[t]||(this.modelUris[t]={});const n=this.modelUris[t];for(const i in e)n[i]=this.requestManager.normalizeModelURL(e[i])}reloadModels(e){this.load(this.modelUris[e],e,{forceReload:!0})}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const i={};for(const r of t)this.hasModel(r,n,{exactIdMatch:!0})||this.hasURLBeenRequested(r)?this.models[n][r].numReferences++:this.modelUris[n][r]&&!this.hasURLBeenRequested(r)?i[r]=this.modelUris[n][r]:!this.hasURLBeenRequested(r)&&e.d9(r,!1)&&(this.modelUris[n][r]=this.requestManager.normalizeModelURL(r),i[r]=this.modelUris[n][r]);this.load(i,n)}hasURLBeenRequested(e){return void 0!==this.modelByURL[e]}removeModel(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.models[t]&&this.models[t][e]&&(this.models[t][e].numReferences--,0===this.models[t][e].numReferences||i)){const i=this.modelUris[t][e];n||delete this.modelUris[t][e],delete this.modelByURL[i];const r=this.models[t][e].model;if(!r)return;delete this.models[t][e],r.destroy()}}destroy(){for(const e of Object.keys(this.models))for(const t of Object.keys(this.models[e])){const n=this.models[e][t].model;delete this.models[e][t],n&&n.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const n in this.models[t])this.models[t][n].model&&this.models[t][n].model.upload(e.context)}}const pi=new e.a7({data:new e.a8(e.a5.colorTheme.data)});class mi{constructor(e){this._scope=e,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(e){const t=this._makeBuildingsQueryArea(e),n=this._makeFloorsQueryArea(e),i=e.queryRenderedFeatures(t,this._buildingQueryParams).filter(e=>"building"===e.properties.shape_type).reduce((e,t)=>{const n=t.properties.id;return"building"!==t.properties.shape_type||e.some(e=>e.properties.id===n)||e.push(t),e},[]),r=e.queryRenderedFeatures(n,this._floorQueryParams).filter(e=>"floor"===e.properties.shape_type).reduce((e,t)=>{const n=t.properties.id;return"floor"!==t.properties.shape_type||e.some(e=>e.properties.id===n)||e.push(t),e},[]),o=[e.getCenter().lng,e.getCenter().lat];return{floors:r,building:this._findBuildingAtCenter(o,i)||(i.length>0?i[0]:null)}}_makeBuildingsQueryArea(t){const n=t.transform.width,i=t.transform.height,r=Math.min(n,i),o=r*(1/8),s=r*(1/8),a=.5*(n-o),l=.5*(i-s);return[new e.P(a,l),new e.P(a+o,l+s)]}_makeFloorsQueryArea(t){const n=t.transform.width,i=t.transform.height,r=n*(2/3),o=i*(2/3),s=.5*(n-r),a=.5*(i-o);return[new e.P(s,a),new e.P(s+r,a+o)]}_findBuildingAtCenter(e,t){for(const n of t)if("Polygon"===n.geometry.type&&this._pointInPolygon(e,n.geometry.coordinates[0]))return n;return null}_pointInPolygon(e,t){let n=!1;for(let i=0,r=t.length-1;i<t.length;r=i++){const o=t[i][0],s=t[i][1],a=t[r][1];s>e[1]!=a>e[1]&&e[0]<(t[r][0]-o)*(e[1]-s)/(a-s)+o&&(n=!n)}return n}}class gi{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(e){this._selectedBuildingId=e}setFloors(e){if(this._floors=e.filter(e=>e.properties.building_id===this._selectedBuildingId),!this._selectedFloorId||!this._floors.map(e=>e.properties.id).includes(this._selectedFloorId)){const e=this._floors.map(e=>({id:e.properties.id,level:e.properties.floor_level})).reduce((e,t)=>{const n=Math.abs(e.level-1),i=Math.abs(t.level-1);return i<n||i===n&&t.level>e.level?t:e});this._selectedFloorId=e.id}}setFloorId(e){this._selectedFloorId=e}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const _i={"mbx-indoor-level-selected":{default:["literal",[]]}};function yi(e){return e=e||{},Object.assign(e,_i)}class vi extends e.E{constructor(t){super(),e.aV(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new gi,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new e.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new mi(this._scope)))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const e=this._indoorDataQuery.execute(this._map);e&&0!==e.floors.length?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(e)):this._clearIndoorData()}_selectFloors(e){if(e.building)this._floorSelectionState.setBuildingId(e.building.properties.id),this._floorSelectionState.setFloors(e.floors),this._updateUI();else{const t=this._floorSelectionState.getSelectedFloorId();if(t&&e.floors.some(e=>e.properties.id===t))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const t=this._floorSelectionState.getCurrentBuildingFloors().map(e=>({id:e.properties.id,name:e.properties.name,shortName:e.properties.floor_level,levelOrder:e.properties.floor_level})),n=this._floorSelectionState.getSelectedFloorId();n?(this._updateIndoorConfig(),this.fire(new e.A("indoorupdate",{selectedFloorId:n,floors:t}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const e=this._floorSelectionState.getSelectedFloorId();e?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[e]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(e){this._floorSelectionState.setFloorId(e),this._updateIndoorConfig()}}function xi(t){if(!t.metadata||!t.metadata.content_area)return;const n=e.q.devicePixelRatio,{left:i,top:r,width:o,height:s}=t.metadata.content_area,a=i*n,l=r*n;return[a,l,a+o*n,l+s*n]}function bi(t){if(t)return t.map(t=>{let[n,i]=t;return[n*e.q.devicePixelRatio,i*e.q.devicePixelRatio]})}class wi{constructor(e,t,n){this.id=e,this.scope=t,this.sourceCache=n,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(e){this.missingRequests.has(e.name)||this.pendingRequests.has(e.name)||this.pendingRequests.add(e.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const n=this.sourceCache.getVisibleCoordinates();if(0===n.length)return t;const i=this.sourceCache.getSource();if(!(i instanceof at))return t;const r=n.map(e=>this.sourceCache.getTile(e)),o=i.getImages(r,Array.from(this.pendingRequests));for(const[s,a]of o)t.set(e.I.from({name:s,iconsetId:this.id}),a),this.pendingRequests.delete(s);for(const e of this.pendingRequests)this.missingRequests.add(e);return this.pendingRequests.clear(),t}}const Ei=(e,t)=>Fe(e,t&&t.filter(e=>"source.canvas"!==e.identifier)),Ti=e.aF(Ot,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ai=e.aF(Ot,["setCenter","setZoom","setBearing","setPitch"]),Si=new Set(["background","sky","slot","custom"]),Di={version:8,layers:[],sources:{}},Ci={duration:300,delay:0};class Ii extends e.E{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=e.h({},Ci),this._buildingIndex=new Ft(this),this.crossTileSymbolIndex=new Un,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new W,this.dispatcher=n.dispatcher?n.dispatcher:new e.D(e.db(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new X(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new e.dc(t._requestManager,n.localFontFamily?e.dd.all:n.localIdeographFontFamily?e.dd.ideographs:e.dd.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new fi(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",e.de());const i=this;this._rtlTextPluginCallback=Ii.registerForPluginStateChange(t=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(t,n)=>{if(e.df(t),n&&n.every(e=>e))for(const e in i._sourceCaches){const t=i._sourceCaches[e],n=t.getSource().type;"vector"!==n&&"geojson"!==n||t.reload()}})}),this.on("data",e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const n in this._layers){const e=this._layers[n];e.source===t.id&&this._validateLayer(e)}})}load(e){return e?("string"==typeof e?this.loadURL(e):this.loadJSON(e),this):this}_getGlobalId(t){if(!t)return null;if("string"==typeof t){if(e.j(t))return t;const n=e.dg(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch(e){return n}return n}return"json://".concat(e.dh(JSON.stringify(t)))}_diffStyle(t,n,i){this.globalId=this._getGlobalId(t);const r=(e,t)=>{try{t(null,this.setState(e,i))}catch(e){t(e,!1)}};if("string"==typeof t){const i=this.map._requestManager.normalizeStyleURL(t),o=this.map._requestManager.transformRequest(i,e.R.Style);e.n(o,(t,i)=>{t?this.fire(new e.z(t)):i&&r(i,n)})}else"object"==typeof t&&r(t,n)}loadURL(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.A("dataloading",{dataType:"style"}));const i="boolean"==typeof n.validate?n.validate:!e.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const r=this.importsCache.get(t);if(r)return this._load(r,i);const o=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.n(o,(n,r)=>{if(this._request=null,n)this.fire(new e.z(n));else if(r)return this.importsCache.set(t,r),this._load(r,i)})}loadJSON(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=e.q.frame(()=>{this._request=null,this._load(t,!1!==n.validate)})}loadEmpty(){this.fire(new e.A("dataloading",{dataType:"style"})),this._load(Di,!1)}_loadImports(t,n,i){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const r=[];for(const e of t){const t=this._createFragmentStyle(e),o=new Promise(e=>{t.once("style.import.load",e),t.once("error",e)}).then(()=>this.mergeAll());if(r.push(o),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const s=e.data||this.importsCache.get(e.url);s?(t.loadJSON(s,{validate:n}),this._isInternalStyle(s)&&(t.globalId=null)):e.url?t.loadURL(e.url,{validate:n}):t.loadEmpty();const a={style:t,id:e.id,config:e.config};if(i){const e=this.fragments.findIndex(e=>{let{id:t}=e;return t===i});this.fragments=this.fragments.slice(0,e).concat(a).concat(this.fragments.slice(e))}else this.fragments.push(a)}return Promise.allSettled(r)}getImportGlobalIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;for(const n of e.fragments)n.style.globalId&&t.add(n.style.globalId),this.getImportGlobalIds(n.style,t);return[...t.values()]}_createFragmentStyle(t){const n=this.scope?e.C(t.id,this.scope):t.id;let i;const r=this._initialConfig&&this._initialConfig[n];(t.config||r)&&(i=e.h({},t.config,r));const o=new Ii(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:i,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return o.setEventedParent(this.map,{style:o}),o}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(t,n){const i=t.indoor?yi(t.schema):t.schema;if(this._isInternalStyle(t)){const i=e.h({},Di,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(i,n)}if(this.updateConfig(this._config,i),n&&Ei(this,ve(t)))return;this._loaded=!0,this.stylesheet=e.di(t);const r=()=>{for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const e in t.iconsets)this.addIconset(e,t.iconsets[e]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const i=kt(this.stylesheet.layers);if(this._order=i.map(e=>e.id),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new ke(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ke(this.stylesheet.light)),this._layers={};for(const t of i){const n=e.dn(t,this.scope,this._styleColorTheme.lut,this.options);0!==n.configDependencies.size&&this._configDependentLayers.add(n.fqid),n.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=n;const i=this.getOwnLayerSourceCache(n),r=!!this.directionalLight&&this.directionalLight.shadowsEnabled();i&&n.canCastShadows()&&r&&(i.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const r=this.stylesheet.terrain;r&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(r,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.A("data",{dataType:"style"}));const o=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new e.A(o?"style.load":"style.import.load"))}).catch(t=>{this.fire(new e.z(new Error("Failed to load imports",t))),this.fire(new e.A(o?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new e.A(o?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(o){const t=this._evaluateColorThemeData(o);this._loadColorTheme(t).then(()=>{r()}).catch(t=>{e.w("Couldn't load color theme from the stylesheet: ".concat(t)),r()})}else this._styleColorTheme.lut=null,r()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,n,i,r,o,s,a,l,c,u;const h={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(n=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(i=e.directionalLight);r=this._prioritizeTerrain(r,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(o=e.fog),e.stylesheet.snow&&null!=e.snow&&(s=e.snow),e.stylesheet.rain&&null!=e.rain&&(a=e.rain),null!=e.stylesheet.camera&&(u=e.stylesheet.camera),null!=e.stylesheet.projection&&(l=e.stylesheet.projection),null!=e.stylesheet.transition&&(c=e.stylesheet.transition),h[e.scope]=e._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=i,this.fog=o,this.snow=s,this.rain=a,this._styleColorThemeForScope=h,null===r?delete this.terrain:this.terrain=r,this.camera=u||{"camera-projection":"perspective"},this.projection=l||{name:"mercator"},this.transition=e.h({},Ci,c),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=n=>{for(const e of n.fragments)t(e.style);e(n)};t(this)}_prioritizeTerrain(e,t,n){const i=e&&0===e.drapeRenderMode;return null===n?t&&0===t.drapeRenderMode?t:i?e:null:null!=t&&(!e||i||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)}),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const t={},n={},i={};this.forEachFragmentStyle(r=>{for(const n in r._sourceCaches){const i=e.C(n,r.scope);t[i]=r._sourceCaches[n]}for(const t in r._otherSourceCaches){const i=e.C(t,r.scope);n[i]=r._otherSourceCaches[t]}for(const t in r._symbolSourceCaches){const n=e.C(t,r.scope);i[n]=r._symbolSourceCaches[t]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=i}mergeLayers(){var t=this;const n={},i=[],r={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(t=>{for(const r of t._order){const o=t._layers[r];if("slot"===o.type){const t=e.dj(r);if(n[t])continue;n[t]=[]}o.slot&&n[o.slot]?n[o.slot].push(o):i.push(o)}}),this._mergedOrder=[];const o=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const s of i)if("slot"===s.type){const i=e.dj(s.id);n[i]&&o(n[i]),t._mergedSlots.push(i)}else{const n=e.C(s.id,s.scope);t._mergedOrder.push(n),r[n]=s,s.is3D(!!t.terrain)&&(t._has3DLayers=!0),"circle"===s.type&&(t._hasCircleLayers=!0),"symbol"===s.type&&(t._hasSymbolLayers=!0),"clip"===s.type&&(t._clipLayerPresent=!0)}};o(i),this._mergedOrder.sort((e,t)=>{const n=r[e],i=r[t];return n.hasInitialOcclusionOpacityProperties?i.is3D(!!this.terrain)?1:0:n.is3D(!!this.terrain)&&i.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=r,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(t,n,i){const r=e.h({},n);for(const s of Object.keys(e.a5.colorTheme))void 0===r[s]&&(r[s]=e.a5.colorTheme[s].default);const o=new e.a6(pi,t,new Map(i));return o.setTransitionOrValue(r,i),o.untransitioned().possiblyEvaluate(new e.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((i,r)=>{const o="data:image/png;base64,";if(!t||0===t.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void i();let s=t;s.startsWith(o)||(s=o+s);const a=e.I.from("mapbox-reserved-lut"),l=new Image;l.src=s,l.onerror=()=>{this._styleColorTheme.lutLoading=!1,r(new Error("Failed to load image data"))},l.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void i();this._styleColorTheme.lutLoading=!1;const{width:o,height:s,data:c}=e.q.getImageData(l);if(s>32)return void r(new Error("The height of the image must be less than or equal to 32 pixels."));if(o!==s*s)return void r(new Error("The width of the image must be equal to the height squared."));this.getImage(a)&&this.removeImage(a),this.addImage(a,{data:new e.r({width:o,height:s},c),pixelRatio:1,sdf:!1,usvg:!1,version:0});const u=this.imageManager.getImage(a,this.scope);u?(this._styleColorTheme.lut={image:u.data,data:t},i()):r(new Error("Missing LUT image."))}})}getLut(e){const t=this._styleColorThemeForScope[e];return t?t.lut:null}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,n,i){let r,o,s;const a=e.q.devicePixelRatio>1?"@2x":"";let l=e.n(n.transformRequest(n.normalizeSpriteURL(t,a,".json"),e.R.SpriteJSON),(e,t)=>{l=null,s||(s=e,r=t,u())}),c=e.o(n.transformRequest(n.normalizeSpriteURL(t,a,".png"),e.R.SpriteImage),(e,t)=>{c=null,s||(s=e,o=t,u())});function u(){if(s)i(s);else if(r&&o){const t=e.q.getImageData(o),n={};for(const i in r){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:f}=r[i],p=new e.r({width:o,height:s});e.r.copy(t,p,{x:a,y:l},{x:0,y:0},{width:o,height:s},null),n[i]={data:p,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:f,usvg:!1}}i(null,n)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,(t,n)=>{if(this._spriteRequest=null,t)this.fire(new e.z(t));else if(n){const t=new Map;for(const i in n)t.set(e.I.from(i),n[i]);this.addImages(t)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}))})}addIconset(t,n){if("sprite"===n.type)return void this._loadSprite(n.url);const i=this.getOwnSourceCache(n.source);if(!i)return void this.fire(new e.z(new Error('Source "'.concat(n.source,'" as specified by iconset "').concat(t,'" does not exist and cannot be used as an iconset source'))));const r=i.getSource();if("raster-array"!==r.type)return void this.fire(new e.z(new Error('Source "'.concat(n.source,'" as specified by iconset "').concat(t,'" is not a "raster-array" source and cannot be used as an iconset source'))));r.partial=!1;const o=new wi(t,this.scope,i);this.imageManager.addImageProvider(o,this.scope)}removeIconset(e){this.imageManager.removeImageProvider(e,this.scope)}_loadIconset(t){if(!e.j(t)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(t);const n="auto"===this.map._spriteFormat;var i,r;this._spriteRequest=(r=(i,r)=>{if(this._spriteRequest=null,i)n?this._loadSprite(t):this.fire(new e.z(i));else if(r){const t=new Map;for(const n in r)t.set(e.I.from(n),r[n]);this.addImages(t)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}))},e.br((i=this.map._requestManager).transformRequest(i.normalizeIconsetURL(t),e.R.Iconset),(t,n)=>{if(t)return void r(t);const i={},o=e.da(new e.bq(n));for(const r of o.icons){const t={version:1,pixelRatio:e.q.devicePixelRatio,content:xi(r),stretchX:r.metadata?bi(r.metadata.stretch_x_areas):void 0,stretchY:r.metadata?bi(r.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:r};i[r.name]=t}r(null,i)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const i=t.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new e.z(new Error('Source layer "'.concat(i,'" does not exist on source "').concat(n.id,'" as specified by style layer "').concat(t.id,'"'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(this.imageManager.hasPatternsInFlight())return!1;if(!this.modelManager.isLoaded())return!1;if(this._styleColorTheme.lutLoading)return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,t)=>{const n=this.fragments[t];return n&&n.style&&(e.data=n.style.serialize()),e})}_serializeSources(){const e={};for(const t in this._sourceCaches){const n=this._sourceCaches[t].getSource();e[n.id]||(e[n.id]=n.serialize())}return e}_serializeLayers(e){const t=[];for(const n of e){const e=this._layers[n];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;if(this.hasSnowTransition())return!0;if(this.hasRainTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(e){return e?this.order:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new e.z(new Error("The layer '".concat(t,"' does not exist in the map's style."))))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new e.z(new Error("The source '".concat(t,"' does not exist in the map's style."))))}precompilePrograms(e,t){const n=this.map.painter;if(n)for(let i=e.minzoom||0;i<(e.maxzoom||25.5);i++){const i=e.getProgramIds();if(i)for(const r of i){const i=e.getDefaultProgramParams(r,t.zoom,this._styleColorTheme.lut);i&&(n.style=this,this.fog&&(n._fogVisible=!0,i.overrideFog=!0,n.getOrCreateProgram(r,i)),n._fogVisible=!1,i.overrideFog=!1,n.getOrCreateProgram(r,i),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(i.overrideRtt=!0,n.getOrCreateProgram(r,i)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const i=this._changes.isDirty();let r=!1;if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:n,removedIds:i}=e[t];(n||i)&&(this._updateWorkerLayers(t,n,i),r=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const o={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];o[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const n=this._mergedLayers[e];if(n.recalculate(t,this._availableImages),!n.isHidden(t.zoom)){const e=this.getLayerSourceCache(n);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,n.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(n,t)}):this.precompilePrograms(n,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&r&&this.mergeLayers();const s=this.imageManager.getPendingImageProviders();for(const e of s)e.sourceCache.used=!0;for(const a in o){const t=this._mergedSourceCaches[a];o[a]!==t.used&&t.getSource().fire(new e.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),i&&this.fire(new e.A("data",{dataType:"style"}))}updateImageProviders(){const e=this.imageManager.getPendingImageProviders();for(const t of e){const e=t.resolvePendingRequests(),n=this.getFragmentStyle(t.scope);n&&n.addImages(e)}}_updateTilesForChangedImages(){const e={};for(const t in this._mergedSourceCaches){const n=this._mergedSourceCaches[t].getSource().scope;e[n]=e[n]||this._changes.getUpdatedImages(n),0!==e[n].length&&this._mergedSourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e[n])}for(const t in e)this._changes.resetUpdatedImages(t)}_updateWorkerLayers(e,t,n){const i=this.getFragmentStyle(e);i&&this.dispatcher.broadcast("updateLayers",{layers:t?i._serializeLayers(t):[],scope:e,removedIds:n||[],options:i.options})}setState(t,n){if(this._checkLoaded(),Ei(this,ve(t)))return!1;(t=e.di(t)).layers=kt(t.layers);const i=function(t,n){if(!t)return[{command:Ot.setStyle,args:[n]}];let i=[];try{if(!e.bv(t.version,n.version))return[{command:Ot.setStyle,args:[n]}];if(e.bv(t.center,n.center)||i.push({command:Ot.setCenter,args:[n.center]}),e.bv(t.zoom,n.zoom)||i.push({command:Ot.setZoom,args:[n.zoom]}),e.bv(t.bearing,n.bearing)||i.push({command:Ot.setBearing,args:[n.bearing]}),e.bv(t.pitch,n.pitch)||i.push({command:Ot.setPitch,args:[n.pitch]}),e.bv(t.sprite,n.sprite)||i.push({command:Ot.setSprite,args:[n.sprite]}),e.bv(t.glyphs,n.glyphs)||i.push({command:Ot.setGlyphs,args:[n.glyphs]}),e.bv(t.imports,n.imports)||function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0;n=n||[];const r=(t=t||[]).map(jt),o=n.map(jt),s=t.reduce(Gt,{}),a=n.reduce(Gt,{}),l=r.slice();let c,u,h,d;for(c=0,u=0;c<r.length;c++)h=r[c],a.hasOwnProperty(h)?u++:(i.push({command:Ot.removeImport,args:[h]}),l.splice(l.indexOf(h,u),1));for(c=0,u=0;c<o.length;c++)h=o[o.length-1-c],l[l.length-1-c]!==h&&(s.hasOwnProperty(h)?(i.push({command:Ot.removeImport,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,d=l[l.length-c],i.push({command:Ot.addImport,args:[a[h],d]}),l.splice(l.length-c,0,h));for(const f of n){const t=s[f.id];t&&(delete t.data,e.bv(t,f)||i.push({command:Ot.updateImport,args:[f.id,f]}))}}(t.imports,n.imports,i),e.bv(t.transition,n.transition)||i.push({command:Ot.setTransition,args:[n.transition]}),e.bv(t.light,n.light)||i.push({command:Ot.setLight,args:[n.light]}),e.bv(t.fog,n.fog)||i.push({command:Ot.setFog,args:[n.fog]}),e.bv(t.snow,n.snow)||i.push({command:Ot.setSnow,args:[n.snow]}),e.bv(t.rain,n.rain)||i.push({command:Ot.setRain,args:[n.rain]}),e.bv(t.projection,n.projection)||i.push({command:Ot.setProjection,args:[n.projection]}),e.bv(t.lights,n.lights)||i.push({command:Ot.setLights,args:[n.lights]}),e.bv(t.camera,n.camera)||i.push({command:Ot.setCamera,args:[n.camera]}),e.bv(t.iconsets,n.iconsets)||function(t,n,i){let r;for(r in n=n||{},t=t||{})t.hasOwnProperty(r)&&(n.hasOwnProperty(r)||i.push({command:Ot.removeIconset,args:[r]}));for(r in n){if(!n.hasOwnProperty(r))continue;const o=n[r];t.hasOwnProperty(r)?e.bv(t[r],o)||(i.push({command:Ot.removeIconset,args:[r]}),i.push({command:Ot.addIconset,args:[r,o]})):i.push({command:Ot.addIconset,args:[r,o]})}}(t.iconsets,n.iconsets,i),!e.bv(t["color-theme"],n["color-theme"]))return[{command:Ot.setStyle,args:[n]}];const r={},o=[];!function(t,n,i,r){let o;for(o in n=n||{},t=t||{})t.hasOwnProperty(o)&&(n.hasOwnProperty(o)||zt(o,i,r));for(o in n){if(!n.hasOwnProperty(o))continue;const s=n[o];t.hasOwnProperty(o)?e.bv(t[o],s)||("geojson"===t[o].type&&"geojson"===s.type&&Ut(t,n,o)?i.push({command:Ot.setGeoJSONSourceData,args:[o,s.data]}):Nt(o,n,i,r)):Bt(o,n,i)}}(t.sources,n.sources,o,r);const s=[];t.layers&&t.layers.forEach(e=>{e.source&&r[e.source]?i.push({command:Ot.removeLayer,args:[e.id]}):s.push(e)});let a=t.terrain;a&&r[a.source]&&(i.push({command:Ot.setTerrain,args:[void 0]}),a=void 0),i=i.concat(o),e.bv(a,n.terrain)||i.push({command:Ot.setTerrain,args:[n.terrain]}),function(t,n,i){n=n||[];const r=(t=t||[]).map(jt),o=n.map(jt),s=t.reduce(Gt,{}),a=n.reduce(Gt,{}),l=r.slice(),c=Object.create(null);let u,h,d,f,p,m,g;for(u=0,h=0;u<r.length;u++)d=r[u],a.hasOwnProperty(d)?h++:(i.push({command:Ot.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(i.push({command:Ot.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],i.push({command:Ot.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],f=s[d],p=a[d],!c[d]&&!e.bv(f,p))if(e.bv(f.source,p.source)&&e.bv(f["source-layer"],p["source-layer"])&&e.bv(f.type,p.type)){for(g in Vt(f.layout,p.layout,i,d,null,Ot.setLayoutProperty),Vt(f.paint,p.paint,i,d,null,Ot.setPaintProperty),e.bv(f.slot,p.slot)||i.push({command:Ot.setSlot,args:[d,p.slot]}),e.bv(f.filter,p.filter)||i.push({command:Ot.setFilter,args:[d,p.filter]}),e.bv(f.minzoom,p.minzoom)&&e.bv(f.maxzoom,p.maxzoom)||i.push({command:Ot.setLayerZoomRange,args:[d,p.minzoom,p.maxzoom]}),f)f.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Vt(f[g],p[g],i,d,g.slice(6),Ot.setPaintProperty):e.bv(f[g],p[g])||i.push({command:Ot.setLayerProperty,args:[d,g,p[g]]}));for(g in p)p.hasOwnProperty(g)&&!f.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Vt(f[g],p[g],i,d,g.slice(6),Ot.setPaintProperty):e.bv(f[g],p[g])||i.push({command:Ot.setLayerProperty,args:[d,g,p[g]]}))}else i.push({command:Ot.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],i.push({command:Ot.addLayer,args:[p,m]})}(s,n.layers,i)}catch(e){console.warn("Unable to compute style diff:",e),i=[{command:Ot.setStyle,args:[n]}]}return i}(this.serialize(),t).filter(e=>!(e.command in Ai));if(0===i.length)return!1;const r=i.filter(e=>!(e.command in Ti));if(r.length>0)throw new Error("Unimplemented: ".concat(r.map(e=>e.command).join(", "),"."));const o=[];return i.forEach(e=>{o.push(this[e.command](...e.args))}),n&&Promise.all(o).then(n).catch(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(0===t.size)return this;for(const[n,i]of t.entries()){if(this.getImage(n))return this.fire(new e.z(new Error('An image with the name "'.concat(n.name,'" already exists.'))));this.imageManager.addImage(n,this.scope,i),this._changes.updateImage(n,this.scope)}return this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this}addImage(t,n){return this.getImage(t)?this.fire(new e.z(new Error('An image with the name "'.concat(t.name,'" already exists.')))):(this.imageManager.addImage(t,this.scope,n),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this)}updateImage(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.imageManager.updateImage(t,this.scope,n),i&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})))}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new e.A("data",{dataType:"style"})),this}addModel(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(Pe,"models.".concat(t),n,null,i)||(this.modelManager.addModel(t,n,this.scope),this.fire(new e.A("data",{dataType:"style"}))),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error('There is already a source with ID "'.concat(t,'".'));if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(n).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(xe,"sources.".concat(t),n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=ct(t,n,this.dispatcher,this);r.scope=this.scope,r.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r.id),source:r.serialize(),sourceId:r.id}));const o=t=>{const n=(t?"symbol:":"other:")+r.id,i=e.C(n,this.scope),o=this._sourceCaches[n]=new It(i,r,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[r.id]=o,o.onAdd(this.map)};o(!1),"vector"!==n.type&&"geojson"!==n.type||o(!0),r.onAdd&&r.onAdd(this.map),i.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const r in this._layers)if(this._layers[r].source===t)return this.fire(new e.z(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(r,'" is using it.'))));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.z(new Error('Source "'.concat(t,'" cannot be removed while terrain is using it.'))));if(this.stylesheet.iconsets){const n=Object.entries(this.stylesheet.iconsets).find(e=>{let[n,i]=e;return"source"===i.type&&i.source===t});if(n)return this.fire(new e.z(new Error('Source "'.concat(t,'" cannot be removed while iconset "').concat(n[0],'" is using it.'))))}const i=this.getOwnSourceCaches(t);for(const r of i){const t=e.dj(r.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(r.id),r.fire(new e.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:r.getSource().id})),r.setEventedParent(null),r.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const n=this.getOwnSourceCache(t);n&&e.push(n.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const o of t){if(this._validate(we,"lights",o))return;switch(o.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(o),e.updateTransitions(n)}else this.ambientLight=new Je(o,Xe||(Xe=new e.a7({color:new e.a8(e.a5.properties_light_ambient.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(o),e.updateTransitions(n)}else this.directionalLight=new Je(o,Ze||(Ze=new e.a7({direction:new e.an(e.a5.properties_light_directional.direction),color:new e.a8(e.a5.properties_light_directional.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_directional.intensity),"cast-shadows":new e.a8(e.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new e.a8(e.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new e.a8(e.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const i=Object.assign(n,{worldview:this.map.getWorldview()}),r=new e.aa(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const i=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),r=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),o=t.properties.get("intensity"),s=t.properties.get("direction"),a=1-e.d1(s.x,s.y,s.z)[2]/90,l=i(r)*o*a,c=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),u=n.properties.get("intensity"),h=i(c)*u;return Number(((l+h)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(null==t||""===t&&this.isRootStyle())return this;if(e.dk(t)){const n=e.dl(t),i=this.fragments.find(e=>{let{id:t}=e;return t===n});if(!i)return;const r=e.dj(t);return i.style.getFragmentStyle(r)}{const e=this.fragments.find(e=>{let{id:n}=e;return n===t});return e?e.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"".concat(e,"::").concat(t)};this._featuresetSelectors={};for(const r in t){const o=this._featuresetSelectors[r]=[];for(const s of t[r].selectors){if(s.featureNamespace){const t=this.getOwnLayer(s.layer);if(!t){e.w("Layer is undefined for selector: ".concat(s.layer));continue}const o=i(t.source,t.sourceLayer);if(o in n&&n[o]!==s.featureNamespace){e.w('"featureNamespace '.concat(s.featureNamespace," of featureset ").concat(r,"'s selector is not associated to the same source, skip this selector"));continue}n[o]=s.featureNamespace}let t;if(s.properties)for(const n in s.properties){const i=e.X(s.properties[n]);"success"===i.result&&(t=t||{},t[n]=i.value)}o.push({layerId:s.layer,namespace:s.featureNamespace,properties:t,uniqueFeatureID:s._uniqueFeatureID})}}}getFeaturesetDescriptors(e){const t=this.getFragmentStyle(e);if(!t||!t.stylesheet.featuresets)return[];const n=[];for(const i in t.stylesheet.featuresets)n.push({featuresetId:i,importId:t.scope?t.scope:void 0});return n}getFeaturesetLayers(t,n){const i=this.getFragmentStyle(n),r=i.stylesheet.featuresets;if(!r||!r[t])return this.fire(new e.z(new Error("The featureset '".concat(t,"' does not exist in the map's style and cannot be queried.")))),[];const o=[];for(const e of r[t].selectors){const t=i.getOwnLayer(e.layer);t&&o.push(t)}return o}getConfigProperty(t,n){const i=this.getFragmentStyle(t);if(!i)return null;const r=e.C(n,i.scope),o=i.options.get(r),s=o?o.value||o.default:null;return s?s.serialize():null}setConfigProperty(t,n,i){const r=this.getFragmentStyle(t);if(!r)return;const o=r.stylesheet.indoor?yi(r.stylesheet.schema):r.stylesheet.schema;if(!o||!o[n])return;const s=e.X(i);if("success"!==s.result)return void Ei(this,s.value);const a=s.value.expression,l=e.C(n,r.scope),c=r.options.get(l);if(!c)return;let u;const{minValue:h,maxValue:d,stepValue:f,type:p,values:m}=o[n],g=e.X(o[n].default);"success"===g.result&&(u=g.value.expression),u?(this.options.set(l,Object.assign({},c,{value:a,default:u,minValue:h,maxValue:d,stepValue:f,type:p,values:m})),this.updateConfigDependencies(n)):this.fire(new e.z(new Error('No schema defined for the config option "'.concat(n,'" in the "').concat(t,'" fragment.'))))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const i=n.stylesheet.schema;if(!i)return null;const r={};for(const o in i){const t=e.C(o,n.scope),i=n.options.get(t),s=i?i.value||i.default:null;r[o]=s?s.serialize():null}return r}setConfig(e,t){const n=this.getFragmentStyle(e);n&&(n.updateConfig(t,n.stylesheet.schema),this.updateConfigDependencies())}getSchema(e){const t=this.getFragmentStyle(e);return t?t.stylesheet.schema:null}setSchema(e,t){const n=this.getFragmentStyle(e);n&&(n.stylesheet.schema=t,n.updateConfig(n._config,t),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const i in n){let r,o;const s=e.X(n[i].default);if("success"===s.result&&(r=s.value.expression),t&&void 0!==t[i]){const n=e.X(t[i]);"success"===n.result&&(o=n.value.expression)}const{minValue:a,maxValue:l,stepValue:c,type:u,values:h}=n[i];if(r){const t=e.C(i,this.scope);this.options.set(t,{default:r,value:o,minValue:a,maxValue:l,stepValue:c,type:u,values:h})}else this.fire(new e.z(new Error('No schema defined for config option "'.concat(i,'".'))))}else this.fire(new e.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(e){for(const t of this._configDependentLayers){const n=this.getLayer(t);if(n){if(e&&!n.configDependencies.has(e))continue;n.possiblyEvaluateVisibility(),this._updateLayer(n)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(e=>{const t=e._styleColorTheme.colorThemeOverride?e._styleColorTheme.colorThemeOverride:e._styleColorTheme.colorTheme;if(t){const n=e._evaluateColorThemeData(t);(!e._styleColorTheme.lut&&""!==n||e._styleColorTheme.lut&&n!==e._styleColorTheme.lut.data)&&e.setColorTheme(t)}}),this._changes.setDirty()}addLayer(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=t.id;if(this._layers[r])return void this.fire(new e.z(new Error('Layer with id "'.concat(r,'" already exists on this map'))));let o;if("custom"===t.type){if(Ei(this,e.dm(t)))return;o=e.dn(t,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.di(t),t=e.h(t,{source:r})),this._validate(De,"layers.".concat(r),t,{arrayIndex:-1},i))return;o=e.dn(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}})}0!==o.configDependencies.size&&this._configDependentLayers.add(o.fqid);let s=this._order.length;if(n){const t=this._order.indexOf(n);if(-1===t)return void this.fire(new e.z(new Error('Layer with id "'.concat(n,'" does not exist on this map.'))));o.slot===this._layers[n].slot?s=t:e.w('Layer with id "'.concat(n,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o;const a=this.getOwnLayerSourceCache(o),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&o.canCastShadows()&&l&&(a.castsShadows=!0);const c=this._changes.getRemovedLayer(o);if(c&&o.source&&a&&"custom"!==o.type){this._changes.discardLayerRemoval(o);const t=e.C(o.source,o.scope);c.type!==o.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const i=this._checkLayer(t);if(!i)return;if(t===n)return;const r=this._order.indexOf(t);this._order.splice(r,1);let o=this._order.length;if(n){const t=this._order.indexOf(n);if(-1===t)return void this.fire(new e.z(new Error('Layer with id "'.concat(n,'" does not exist on this map.'))));i.slot===this._layers[n].slot?o=t:e.w('Layer with id "'.concat(n,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(o,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const n=this._order.indexOf(e);this._order.splice(n,1),delete this._layers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const i=this.getOwnLayerSourceCache(t);if(i&&i.castsShadows){let e=!1;for(const n in this._layers)if(this._layers[n].source===t.source&&this._layers[n].canCastShadows()){e=!0;break}i.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,n){this._checkLoaded();const i=this._checkLayer(e);i&&(i.minzoom===t&&i.maxzoom===n||(null!=t&&(i.minzoom=t),null!=n&&(i.maxzoom=n),this._updateLayer(i)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(e,t){this._checkLoaded();const n=this._checkLayer(e);n&&n.slot!==t&&(n.slot=t,this._updateLayer(n))}setFilter(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=this._checkLayer(t);if(r&&!e.bv(r.filter,n))return null==n?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(Ce,"layers.".concat(r.id,".filter"),n,{layerType:r.type},i)||(r.filter=e.di(n),this._updateLayer(r)))}getFilter(t){const n=this._checkLayer(t);if(n)return e.di(n.filter)}setLayoutProperty(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this._checkLayer(t);if(o&&!e.bv(o.getLayoutProperty(n),i)){if(null!=i&&(!r||!1!==r.validate)&&Ei(o,Re.call(ve,{key:"layers.".concat(t,".layout.").concat(n),layerType:o.type,objectKey:n,value:i,styleSpec:e.a5,style:{glyphs:!0,sprite:!0}})))return;o.setLayoutProperty(n,i),0!==o.configDependencies.size&&this._configDependentLayers.add(o.fqid),this._updateLayer(o)}}getLayoutProperty(e,t){const n=this._checkLayer(e);if(n)return n.getLayoutProperty(t)}setPaintProperty(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this._checkLayer(t);if(!o)return;if(e.bv(o.getPaintProperty(n),i))return;if(null!=i&&(!r||!1!==r.validate)&&Ei(o,Ie.call(ve,{key:"layers.".concat(t,".paint.").concat(n),layerType:o.type,objectKey:n,value:i,styleSpec:e.a5})))return;const s=o.setPaintProperty(n,i);0!==o.configDependencies.size&&this._configDependentLayers.add(o.fqid),s&&this._updateLayer(o),this._changes.updatePaintProperties(o)}getPaintProperty(e,t){const n=this._checkLayer(e);if(n)return n.getPaintProperty(t)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:i}=t.target,r=this.getFragmentStyle(i),o=r.getFeaturesetLayers(e);for(const{source:s,sourceLayer:a}of o)r.setFeatureState({id:t.id,source:s,sourceLayer:a},n)}else if("layerId"in t.target){const{layerId:e}=t.target,i=this.getLayer(e);this.setFeatureState({id:t.id,source:i.source,sourceLayer:i.sourceLayer},n)}return}const i=t.source,r=t.sourceLayer,o=this._checkSource(i);if(!o)return;const s=o.type;if("geojson"===s&&r)return void this.fire(new e.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!r)return void this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.z(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(i);for(const e of a)e.setFeatureState(r,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:i}=t.target,r=this.getFragmentStyle(i),o=r.getFeaturesetLayers(e);for(const{source:s,sourceLayer:a}of o)r.removeFeatureState({id:t.id,source:s,sourceLayer:a},n)}else if("layerId"in t.target){const{layerId:e}=t.target,i=this.getLayer(e);this.removeFeatureState({id:t.id,source:i.source,sourceLayer:i.sourceLayer},n)}return}const i=t.source,r=this._checkSource(i);if(!r)return;const o=r.type,s="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.z(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(i);for(const e of a)e.removeFeatureState(s,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let n;if("featuresetId"in t.target){const{featuresetId:i,importId:r}=t.target,o=this.getFragmentStyle(r),s=o.getFeaturesetLayers(i);for(const{source:a,sourceLayer:l}of s){const i=o.getFeatureState({id:t.id,source:a,sourceLayer:l});if(i&&!n)n=i;else if(!e.bv(n,i))return void this.fire(new e.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:e}=t.target,i=this.getLayer(e);n=this.getFeatureState({id:t.id,source:i.source,sourceLayer:i.sourceLayer})}return n}const n=t.source,i=t.sourceLayer,r=this._checkSource(n);if(r){if("vector"!==r.type||i)return void 0===t.id&&this.fire(new e.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(i,t.id);this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=e.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},e=>void 0!==e)}_updateFilteredLayers(e){for(const t of Object.values(this._mergedLayers))e(t)&&this._updateLayer(t)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),i=e.C(t.source,t.scope),r=this._changes.getUpdatedSourceCaches();t.source&&!r[i]&&n&&"raster"!==n.getSource().type&&(this._changes.updateSourceCache(i,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>this._mergedLayers[e].is3D(!!this.terrain),n=this.order,i={},r=[];for(let s=n.length-1;s>=0;s--){const o=n[s];if(t(o)){i[o]=s;for(const t of e){const e=t[o];if(e)for(const t of e)r.push(t)}}}r.sort((e,t)=>t.intersectionZ-e.intersectionZ);const o=[];for(let s=n.length-1;s>=0;s--){const a=n[s];if(t(a))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(t.layer&&i[t.layer.id]<s)break;o.push(t),r.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)o.push(t.feature)}}return o}queryRenderedFeatures(t,n,i){let r;n&&!Array.isArray(n)&&n.filter&&(this._validate(Ce,"queryRenderedFeatures.filter",n.filter,null,n),r=e.b3(n.filter));const o={},s=e=>{if(Si.has(e.type))return;const t=this.getOwnLayerSourceCache(e),n=o[t.id]=o[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};e.is3D(!!this.terrain)&&(n.has3DLayers=!0),n.layers[e.fqid]=n.layers[e.fqid]||{styleLayer:e,targets:[]},n.layers[e.fqid].targets.push({filter:r})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.z(new Error("parameters.layers must be an Array."))),[];for(const t of n.layers){const n=this._layers[t];if(!n)return this.fire(new e.z(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be queried for features.")))),[];s(n)}}else for(const e in this._layers)s(this._layers[e]);const a=this._queryRenderedFeatures(t,o,i),l=this._flattenAndSortRenderedFeatures(a),c=[];for(const u of l)e.dq(u.layer.id)===this.scope&&c.push(u);return c}queryRenderedFeatureset(t,n,i){let r;n&&!Array.isArray(n)&&n.filter&&(this._validate(Ce,"queryRenderedFeatures.filter",n.filter,null,n),r=e.b3(n.filter));const o="mock",s=[];if(n&&n.target)s.push(Object.assign({},n,{targetId:o,filter:r}));else{const e=this.getFeaturesetDescriptors();for(const t of e)s.push({targetId:o,filter:r,target:t});for(const{style:t}of this.fragments){const e=t.getFeaturesetDescriptors();for(const t of e)s.push({targetId:o,filter:r,target:t})}}const a=this.queryRenderedTargets(t,s,i),l=[],c=new Set;for(const u of a)for(const t of u.variants[o])ht(t,u,c)||l.push(new e.dr(u,t));return l}queryRenderedTargets(t,n,i){const r={},o=(e,t,n,i)=>{const o=r[t.id]=r[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};if(o.layers[e.fqid]=o.layers[e.fqid]||{styleLayer:e,targets:[]},e.is3D(!!this.terrain)&&(o.has3DLayers=!0),!i)return n.uniqueFeatureID=!1,void o.layers[e.fqid].targets.push(n);o.layers[e.fqid].targets.push(Object.assign({},n,{namespace:i.namespace,properties:i.properties,uniqueFeatureID:i.uniqueFeatureID}))};for(const a of n)if("featuresetId"in a.target){const{featuresetId:t,importId:n}=a.target,i=this.getFragmentStyle(n);if(!i||!i._featuresetSelectors)continue;const r=i._featuresetSelectors[t];if(!r){this.fire(new e.z(new Error("The featureset '".concat(t,"' does not exist in the map's style and cannot be queried for features."))));continue}for(const e of r){const t=i.getOwnLayer(e.layerId);t&&!Si.has(t.type)&&o(t,i.getOwnLayerSourceCache(t),a,e)}}else if("layerId"in a.target){const{layerId:e}=a.target,t=this.getLayer(e);if(!t||Si.has(t.type))continue;o(t,this.getLayerSourceCache(t),a)}const s=this._queryRenderedFeatures(t,r,i);return this._flattenAndSortRenderedFeatures(s)}_queryRenderedFeatures(e,t,n){const i=[],r=!!this.map._showQueryGeometry,o=Qe.createFromScreenPoints(e,n);for(const s in t){const e=dt(o,t[s],this._availableImages,n,r);Object.keys(e).length&&i.push(e)}if(this.placement)for(const s in t){if(!t[s].sourceCache._onlySymbols)continue;const e=ft(o.screenGeometry,t[s],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(e).length&&i.push(e)}return i}querySourceFeatures(e,t){const n=t&&t.filter;n&&this._validate(Ce,"querySourceFeatures.filter",n,null,t);let i=[];const r=this.getOwnSourceCaches(e);for(const o of r)i=i.concat(pt(o,t));return i}addSourceType(e,t,n){return Ii.getSourceType(e)?n(new Error('A source type called "'.concat(e,'" already exists.'))):(Ii.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=this.light.getLight();let o=!1;for(const a in t)if(!e.bv(t[a],r[a])){o=!0;break}if(!o)return;const s=this._getTransitionParameters();this.light.setLight(t,n,i),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===n&&delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let i=t;const r=null==t.source;if(1===n){if(this.disableElevatedTerrain)return;if("object"==typeof i.source){const t="terrain-dem-src";this.addSource(t,i.source),i=e.di(i),i=e.h(i,{source:t})}const t=e.h({},i),n={};if(this.terrain&&r){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(n.style=e.serialize())}if(this._validate(Ee,"terrain",t,n))return}if(!this.terrain||this.terrain.scope!==this.scope&&!r||this.terrain&&n!==this.terrain.drapeRenderMode){if(!i)return;this._createTerrain(i,n),this.fire(new e.A("data",{dataType:"style"}))}else{const n=this.terrain,r=n.get();for(const t of Object.keys(e.a5.terrain))!i.hasOwnProperty(t)&&e.a5.terrain[t].default&&(i[t]=e.a5.terrain[t].default);for(const i in t)if(!e.bv(t[i],r[i])){n.set(t,this.options),this.stylesheet.terrain=t;const i=this._getTransitionParameters({duration:0});n.updateTransitions(i),this.fire(new e.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new He(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_createSnow(e){const t=this.snow=new Ye(e,this.map.transform,this.scope,this.options);this.stylesheet.snow=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_createRain(e){const t=this.rain=new Ke(e,this.map.transform,this.scope,this.options);this.stylesheet.rain=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!e.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const e=this._getTransitionParameters({duration:0});n.updateTransitions(e)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!e.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const e=this._getTransitionParameters({duration:0});n.updateTransitions(e)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!e.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const e=this._getTransitionParameters({duration:0});n.updateTransitions(e)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const e in this._layers)this._layers[e].lut=this._styleColorTheme.lut;for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const i=this._evaluateColorThemeData(n);this._loadColorTheme(i).then(()=>{this.fire(new e.A("colorthemeset")),t()}).catch(t=>{e.w("Couldn't set color theme: ".concat(t))})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&e.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(e,t){const n=this.getFragmentStyle(e);n&&(n._styleColorTheme.colorThemeOverride=t,n._reloadColorTheme())}_getTransitionParameters(t){return{now:e.q.now(),transition:e.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const n of this._mergedOrder)this.isLayerDraped(this._mergedLayers[n])?e.push(n):t.push(n);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const n=this.terrain=new Oe(e,t,this.scope,this.options,this.map.getWorldview());1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,n,i,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(o&&!1===o.validate)return!1;const s=e.h({},this.serialize());return Ei(this,t.call(ve,e.h({key:n,style:s,value:i,styleSpec:e.a5},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const n of t)n.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}clearLayers(){for(const e in this._mergedLayers){const t=this._mergedLayers[e];t._clear&&t._clear()}}reloadSource(e){const t=this.getSourceCaches(e);for(const n of t)n.resume(),n.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(e=>{e.modelManager.reloadModels(e.scope)})}updateSources(e){let t;this.directionalLight&&(t=ui(this.directionalLight));const n=new Set;for(const i in this._mergedLayers){const e=this._mergedLayers[i];e.hasElevation()&&!n.has(e.source)&&n.add(e.source)}for(const i in this._mergedSourceCaches){const r=this._mergedSourceCaches[i],o=n.has(r._source.id);r.update(e,void 0,void 0,t,o)}}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,n,i,r,o,s){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!1,c=!1;const u={},h={};for(const d of this._mergedOrder){const t=this._mergedLayers[d];if("symbol"!==t.type)continue;const i=e.C(t.source,t.scope);let r=u[i];if(!r){const e=this.getLayerSourceCache(t);if(!e)continue;const n=e.getRenderableIds(!0).map(t=>e.getTileByID(t));h[i]=n.slice(),r=u[i]=n.sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const o=this.crossTileSymbolIndex.addLayer(t,r,n.center.lng,n.projection);l=l||o}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),a=a||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new e.A("neworder")),(a||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.q.now(),n.zoom))&&(this.pauseablePlacement=new kn(n,this._mergedOrder,a,i,r,o,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,u,h,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.q.now()),c=!0),l&&this.pauseablePlacement.placement.setStale()),c||l){this._buildingIndex.onNewFrame(n.zoom);for(let t=0;t<this._mergedOrder.length;t++){const n=this._mergedLayers[this._mergedOrder[t]];if("symbol"!==n.type)continue;const i=this.isLayerClipped(n);this.placement.updateLayerOpacities(n,u[e.C(n.source,n.scope)],t,i?s:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.q.now())}}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const i=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==i.findIndex(e=>{let{id:n}=e;return n===t.id}))return void this.fire(new e.z(new Error("Import with id '".concat(t.id,"' already exists in the map's style."))));if(!n)return i.push(t),this._loadImports([t],!0);const r=i.findIndex(e=>{let{id:t}=e;return t===n});return-1===r&&this.fire(new e.z(new Error('Import with id "'.concat(n,'" does not exist on this map.')))),this.stylesheet.imports=i.slice(0,r).concat(t).concat(i.slice(r)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const i=this.stylesheet.imports||[],r=this.getImportIndex(t);return-1===r?this:"string"==typeof n?(this.setImportUrl(t,n),this):(n.url&&n.url!==i[r].url&&this.setImportUrl(t,n.url),e.bv(n.config,i[r].config)||this.setImportConfig(t,n.config,n.data.schema),e.bv(n.data,i[r].data)||this.setImportData(t,n.data),this)}moveImport(e,t){this._checkLoaded();let n=this.stylesheet.imports||[];const i=this.getImportIndex(e);if(-1===i)return this;const r=this.getImportIndex(t);if(-1===r)return this;const o=n[i],s=this.fragments[i];return n=n.filter(t=>{let{id:n}=t;return n!==e}),this.fragments=this.fragments.filter(t=>{let{id:n}=t;return n!==e}),this.stylesheet.imports=n.slice(0,r).concat(o).concat(n.slice(r)),this.fragments=this.fragments.slice(0,r).concat(s).concat(this.fragments.slice(r)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(e);if(-1===i)return this;n[i].url=t;const r=this.fragments[i];return r.style=this._createFragmentStyle(n[i]),r.style.on("style.import.load",()=>this.mergeAll()),r.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const n=this.getImportIndex(e),i=this.stylesheet.imports||[];return-1===n?this:t?(this.fragments[n].style.setState(t),this._reloadImports(),this):(delete i[n].data,this.setImportUrl(e,i[n].url))}setImportConfig(e,t,n){this._checkLoaded();const i=this.getImportIndex(e),r=this.stylesheet.imports||[];if(-1===i)return this;t?r[i].config=t:delete r[i].config;const o=this.fragments[i];n&&o.style.stylesheet&&(o.style.stylesheet.schema=n);const s=o.style.stylesheet&&o.style.stylesheet.schema;return o.config=t,o.style.updateConfig(t,s),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],n=this.getImportIndex(e);-1!==n&&(t.splice(n,1),this.fragments[n].style._remove(),this.fragments.splice(n,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(e=>e.id===t);return-1===n&&this.fire(new e.z(new Error("Import '".concat(t,"' does not exist in the map's style and cannot be updated.")))),n}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const n=this._mergedOtherSourceCaches[t];n&&e.push(n.getSource())}return e}getSource(e,t){const n=this.getSourceCache(e,t);return n&&n.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,n){const i=e.C(t,n);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(t){const n=e.C(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const n=e[t];"reload"===n?this.reloadSource(t):"clear"===n&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const n of t){const t=this.getLayer(n);t&&t.updateTransitions(e)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(e){this.stylesheet.glyphs=e,this.glyphManager.setURL(e)}getImages(t,n,i){this.imageManager.getImages(n.images,n.scope,i),this._updateTilesForChangedImages();const r=t=>{if(t){const i=n.images.map(t=>e.I.toString(t));t.setDependencies(n.tileID.key,n.type,i)}},o=e.C(n.source,n.scope);r(this._mergedOtherSourceCaches[o]),r(this._mergedSymbolSourceCaches[o]),n.images.some(e=>e.iconsetId)&&this.fire(new e.A("data",{dataType:"style"}))}rasterizeImages(e,t,n){this.imageManager.rasterizeImages(t,n)}getGlyphs(e,t,n){this.glyphManager.getGlyphs(t.stacks,n)}getResource(t,n,i){return e.dt(n,i)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return 0===n.length?(this.fire(new e.z(new Error("There is no source with ID '".concat(t,"'")))),!1):n.every(e=>e.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(e,t){if(!this._clipLayerPresent&&"fill-extrusion"!==e.type&&"building"!==e.type)return!1;const n="fill-extrusion"===e.type&&("building"===e.sourceLayer||"procedural_buildings"===e.sourceLayer),i="building"===e.type;if(e.is3D(!!this.terrain)){if(n||i||t&&"batched-model"===t.type)return!0;if("model"===e.type)return!0}else if("symbol"===e.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(e=>{e.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ii.getSourceType=function(e){return lt[e]},Ii.setSourceType=function(e,t){lt[e]=t},Ii.registerForPluginStateChange=e.du;var Ri="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Pi="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Mi="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Fi="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Li="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",ki="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Oi="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Bi="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",zi="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Ni="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Ui="#ifdef RENDER_SHADOWS\nprecision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {\n#ifdef CLIP_ZERO_TO_ONE\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);\n#else\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);\n#endif\nreturn texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;\n#ifdef SHADOWS_SINGLE_CASCADE\nvec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);\n#else\nlight_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Vi=[];Xi(Ri,Vi),Xi(Mi,Vi),Xi(Pi,Vi);const ji={"_prelude_fog.vertex.glsl":ki,"_prelude_terrain.vertex.glsl":Li,"_prelude_shadow.vertex.glsl":Ni,"_prelude_fog.fragment.glsl":Oi,"_prelude_shadow.fragment.glsl":Ui,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Bi,"_prelude_raster_particle.glsl":zi},Gi={};Zi("",Li),Zi(Oi,ki),Zi(Ui,Ni),Zi(Bi,""),Zi(zi,"");const Hi=Zi(Pi,Mi),Wi=Ri;var qi={background:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),building:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nconst float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nin lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;\n#endif\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\nuniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}\n#ifdef BUILDING_FAUX_FACADE\nfloat hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;\n#if 0\nif (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;\n#else\nif (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;\n#endif\nreturn out_color;}\n#endif\nvec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;\n#ifdef BUILDING_FAUX_FACADE\nif (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}\n#endif\nvec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;\n#ifdef RENDER_SHADOWS\nshadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nshadowed_lighting_factor=dot(normal,u_lighting_directional_dir);\n#endif\ncolor.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));\n#endif\ncolor.rgb=linearTosRGB(color.rgb);color*=u_opacity;\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_pos.z);\n#endif\nglFragColor=color; \n#ifdef DEBUG_SHOW_NORMALS\ncolor.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nout lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nconst float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#ifdef BUILDING_FAUX_FACADE\nmat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}\n#endif\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive\nvoid main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;\n#ifdef BUILDING_FAUX_FACADE\nv_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}\n#endif\nv_pos=a_pos_3f;\n#ifdef RENDER_CUTOFF\nvec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=v_pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(v_pos);\n#endif\ngl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}'),buildingBloom:Zi("in vec4 v_color_emissive;\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\nfloat saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;\n#ifdef HAS_ATTRIBUTE_a_bloom_attenuation\nfloat distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);\n#endif\nglFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}","in vec3 a_pos_3f;\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\nout vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\n#ifdef HAS_ATTRIBUTE_a_part_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);\n#else\nv_color_emissive=vec4(1.0);\n#endif\ngl_Position=u_matrix*vec4(a_pos_3f,1.0);}"),buildingDepth:Zi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Zi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zi('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Zi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Zi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;\n#endif\nout float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);\n#ifdef PROJECTION_GLOBE_VIEW\n#ifndef PROJECTED_POS_ON_VIEWPORT\nvec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);\n#endif\n#endif\nvec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Zi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:Zi("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Zi("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)\n{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nvec3 color=structure_color.xyz;\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,transformed_normal);\n#endif\ncolor=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nv_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef FLIP_Y\nv_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FLIP_Y\nv_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\n#ifdef FEATURE_CUTOUT\ncolor=apply_feature_cutout(color,gl_FragCoord);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);\n#ifdef CLIP_ZERO_TO_ONE\ncutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);\n#else\ncutoff=cutoff_opacity(u_cutoff_params,ground.z);\n#endif\nif (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Zi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Zi('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Zi("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Zi("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nfloat left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;\n#ifdef LINE_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LINE_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Zi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Zi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Zi('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Zi('#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nin highp float v_z_offset;\n#endif\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef TERRAIN\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#else\nout_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef ELEVATED_ROADS\nin vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nout highp float v_z_offset;\n#endif\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;\n#else\nz+=u_pitch_with_map ? z_offset : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\n#ifdef ELEVATED_ROADS\nvec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\npos=vec3(projected_pos.xy/projected_pos.w+offset,z);\n#endif\n#endif\ngl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#else\n#ifdef RENDER_SHADOWS\nv_z_offset=e;\n#endif\n#endif\n}'),terrainRaster:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Zi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Zi('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Fi),skyboxGradient:Zi('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Fi),skyboxCapture:Zi("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Zi('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Zi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;\n#ifdef FLIP_Y\nT=-T;B=-B;\n#endif\nhighp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));\n#ifdef FLIP_Y\nn=normalize(cross(fdx,fdy));\n#else\nn=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\n#ifdef FEATURE_CUTOUT\nfinalColor=apply_feature_cutout(finalColor,gl_FragCoord);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Zi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Zi("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:Zi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:Zi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:Zi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Zi("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function Xi(e,t){const n=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let i of n)if(i=i.trim(),"#"===i[0]&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const e=i.split(" ");for(const n of e)t.includes(n)||t.push(n)}}function Zi(e,t){const n=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let r=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);r&&(r=r.map(e=>{const t=e.split(" ");return t[t.length-1]}),r=[...new Set(r)]);const o={},s=[],a=[];if(e=e.replace(n,(e,t)=>(a.push(t),"")),(t=t.replace(n,(e,t)=>(s.push(t),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...Vi];Xi(e,l),Xi(t,l);for(const c of[...s,...a])ji[c]||console.error("Undefined include: ".concat(c)),Gi[c]||(Gi[c]=[],Xi(ji[c],Gi[c])),l=[...l,...Gi[c]];return{fragmentSource:e=e.replace(i,(e,t,n,i,r)=>(o[r]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nin ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize"===t?"\n#ifdef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    in ").concat(n," ").concat(i," ").concat(r,";\n#endif\n"):"initialize-attribute"===t?"":void 0)),vertexSource:t=t.replace(i,(e,t,n,i,r)=>{const s="float"===i?"vec2":i,a=r.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\nin ").concat(n," ").concat(i," a_").concat(r,";\n#endif\n"):o[r]?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(s," a_").concat(r,";\nout ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize"===t?"vec4"===a?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = unpack_mix_").concat(a,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    in ").concat(n," ").concat(i," a_").concat(r,";\n    out ").concat(n," ").concat(i," ").concat(r,";\n#endif\n"):"initialize-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#endif\n"):void 0:"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(s," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"define-instanced"===t?"mat4"===a?"\n#ifdef INSTANCED_ARRAYS\nin vec4 a_".concat(r,"0;\nin vec4 a_").concat(r,"1;\nin vec4 a_").concat(r,"2;\nin vec4 a_").concat(r,"3;\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"\n#ifdef INSTANCED_ARRAYS\nin ".concat(n," ").concat(s," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize-attribute-custom"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#endif\n"):"vec4"===a?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = unpack_mix_").concat(a,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n")}),staticAttributes:r,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class Yi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,n,i,r,o,s,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==i.length;for(let u=0;!l&&u<i.length;u++)this.boundPaintVertexBuffers[u]!==i[u]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==s.length;for(let u=0;!c&&u<s.length;u++)this.boundDynamicVertexBuffers[u]!==s[u]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||l||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==o)this.freshBind(t,n,i,r,o,s,a);else{e.bindVertexArrayOES.set(this.vao);for(const n of s)n&&(n.bind(),a&&n.instanceCount&&n.setVertexAttribDivisor(e.gl,t,a));r&&r.dynamicDraw&&r.bind()}}freshBind(e,t,n,i,r,o,s){const a=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=o,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const u of n)u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,r);for(const u of o)u&&(u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,r),s&&u.instanceCount&&u.setVertexAttribDivisor(c,e,s));i&&i.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Ki(t,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new e.ac(0,r/i).toLngLat().lat,new e.ac(0,(r+1)/i).toLngLat().lat]}function Ji(t,n,i,r,o,s,a){const l=t.context,c=l.gl,u=i.hillshadeFBO;if(!u)return;t.prepareDrawTile();const h=t.isTileAffectedByFog(n),d=t.getOrCreateProgram("hillshade",{overrideFog:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const f=((t,n,i,r)=>{const o=i.paint.get("hillshade-shadow-color"),s="none"===i.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),a=i.paint.get("hillshade-highlight-color"),l="none"===i.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),c=i.paint.get("hillshade-accent-color"),u="none"===i.paint.get("hillshade-accent-color-use-theme").constantOr("default"),h=i.paint.get("hillshade-emissive-strength");let d=e.al(i.paint.get("hillshade-illumination-direction"));if("viewport"===i.paint.get("hillshade-illumination-anchor"))d-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const n=t.style.directionalLight.properties.get("direction"),i=e.d1(n.x,n.y,n.z);d=e.al(i[1])}const f=!t.options.moving;return{u_matrix:r||t.transform.calculateProjMatrix(n.tileID.toUnwrapped(),f),u_image:0,u_latrange:Ki(0,n.tileID),u_light:[i.paint.get("hillshade-exaggeration"),d],u_shadow:o.toPremultipliedRenderColor(s?null:i.lut),u_highlight:a.toPremultipliedRenderColor(l?null:i.lut),u_emissive_strength:h,u_accent:c.toPremultipliedRenderColor(u?null:i.lut)}})(t,i,r,t.terrain?n.projMatrix:null);t.uploadCommonUniforms(l,d,n.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:m,tileBoundsSegments:g}=t.getTileBoundsBuffers(i);d.draw(t,c.TRIANGLES,o,s,a,Zn.disabled,f,r.id,p,m,g)}function Qi(t,n,i){if(!n.needsDEMTextureUpload)return;const r=t.context,o=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(i.stride);const s=i.getPixels();n.demTexture?n.demTexture.update(s,{premultiply:!1}):n.demTexture=new e.T(r,s,o.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function $i(t,n,i){const r=t.context,o=r.gl;if(!n.dem)return;const s=n.dem;if(r.activeTexture.set(o.TEXTURE1),Qi(t,n,s),!n.demTexture)return;n.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE);const a=s.dim;r.activeTexture.set(o.TEXTURE0);let l=n.hillshadeFBO;if(!l){const t=new e.T(r,{width:a,height:a,data:null},o.RGBA8);t.bind(o.LINEAR,o.CLAMP_TO_EDGE),l=n.hillshadeFBO=r.createFramebuffer(a,a,!0,"renderbuffer"),l.colorAttachment.set(t.texture)}r.bindFramebuffer.set(l.framebuffer),r.viewport.set([0,0,a,a]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:h}=t.getMercatorTileBoundsBuffers(),d=[];t.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(t,o.TRIANGLES,Gn.disabled,Wn.disabled,jn.unblended,Zn.disabled,((t,n)=>{const i=n.stride,r=e.bz();return e.ca(r,0,e.aj,-e.aj,0,0,1),e.bo(r,r,[0,-e.aj,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ}})(n.tileID,s),i.id,c,u,h),n.needsHillshadePrepare=!1}class er{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class tr extends er{getDefault(){return e.am.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class nr extends er{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ir extends er{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class rr extends er{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class or extends er{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class sr extends er{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ar extends er{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class lr extends er{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class cr extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class ur extends er{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class hr extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class dr extends er{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class fr extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class pr extends er{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class mr extends er{getDefault(){return e.am.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class gr extends er{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class _r extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class yr extends er{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class vr extends er{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let xr=class extends er{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class br extends er{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class wr extends er{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Er extends er{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Tr extends er{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ar extends er{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Sr extends er{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Dr extends er{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Cr extends er{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class Ir extends er{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Rr extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Pr extends er{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Mr extends er{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Fr extends Mr{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Lr extends Mr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class kr extends Mr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Or extends Lr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Br=(e,t,n)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),zr=(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:r,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:f,u_far_z_cutoff:p});function Nr(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const Ur=new class{constructor(){this.operations={}}newMorphing(e,t,n,i,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==n.tileID.key&&(t.queued=n)}else this.operations[e]={startTime:i,phase:0,duration:r,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},Vr={0:null,1:"TERRAIN_VERTEX_MORPHING"};function jr(e,t,n){if(0===t)return 0;const i=t<1&&514===n?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*i}function Gr(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const Hr=e=>({u_matrix:e});function Wr(t,n,i,r,o){if(o>0){const s=e.q.now(),a=(s-t.timeAdded)/o,l=n?(s-n.timeAdded)/o:-1,c=i.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.ay(h?a:1-l,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class qr extends It{constructor(e){const t=ct("mock-dem",{type:"raster-dem",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("mock-dem",t,!1),t.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Xr extends It{constructor(e){const t=ct("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,n){if(e.freezeTileCoverage)return;this.transform=e;const i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((t,n)=>{if(t[n.key]="",!this._tiles[n.key]){const t=new At(n,this._source.tileSize*n.overscaleFactor(),e.tileZoom,void 0,void 0,this._source.worldview);t.state="loaded",this._tiles[n.key]=t}return t},{});for(const r in this._tiles)r in i||(this.freeFBO(r),this._tiles[r].unloadVectorData(),delete this._tiles[r])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const n=Object.values(t);this.renderCachePool.push(...n),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zr extends e.aM{constructor(e,t,n){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=n}}class Yr extends e.dF{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,r,o]=function(){const t=new e.ba,n=new e.a_,i=131;t.reserve(17161),n.reserve(33800);const r=e.aj/128,o=e.aj+r/2,s=o+r;for(let l=-r;l<s;l+=r)for(let n=-r;n<s;n+=r){const i=n<0||n>o||l<0||l>o?24575:0,r=e.ay(Math.round(n),0,e.aj),s=e.ay(Math.round(l),0,e.aj);t.emplaceBack(r+i,s)}const a=(e,t)=>{const r=t*i+e;n.emplaceBack(r+1,r,r+i),n.emplaceBack(r+i,r+i+1,r+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)a(t,e);return[0,129].forEach(e=>{for(let t=0;t<130;t++)a(t,e),a(e,t)}),[t,n,32768]}(),s=t.context;this.gridBuffer=s.createVertexBuffer(i,e.bc.members),this.gridIndexBuffer=s.createIndexBuffer(r),this.gridSegments=e.bd.simpleSegment(0,0,i.length,r.length),this.gridNoSkirtSegments=e.bd.simpleSegment(0,0,i.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Xr(n.map),this.orthoMatrix=e.bz(),e.ca(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.aj,0,e.aj,0,1);const a=s.gl;this._overlapStencilMode=new Wn({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new qr(n.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,i){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const r=t.terrain.properties,o=0===t.terrain.drapeRenderMode,s=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.q.now();const a=t.terrain&&t.terrain.scope,l=r.get("source"),c=o?this._mockSourceCache:t.getSourceCache(l,a);if(!c)return void e.w("Couldn't find terrain source \"".concat(l,'".'));if(this.sourceCache=c,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=s?this.calculateExaggeration(n):r.get("exaggeration"),!n.projection.requiresDraping&&s&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&e.w("Raster DEM source '".concat(this.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));const t=this.getScaledDemTileSize();this.sourceCache.update(n,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),n.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,i=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=i;const r=null!=n?i-n:Number.MAX_VALUE;if(Math.abs(r)<2)return this._exaggeration;const o=t.zoom,s=this._style.terrain;if(!this._previousUpdateTimestamp)return s.getExaggeration(o);let a=o-this._previousZoom;const l=this._previousUpdateTimestamp;let c=o;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(o-c)>.5&&(a=.5*(o-c+a)),a*r<0&&(c+=a)),this._evaluationZoom=c;const u=s.getExaggeration(c),h=u===s.getExaggeration(Math.max(0,c-.1));if(h&&Math.abs(u-this._exaggeration)<.01)return u;let d=Math.min(.1,.00375*(this._updateTimestamp-l));return(h||u<.1||Math.abs(a)<1e-4)&&(d=Math.min(.2,4*d)),e.ai(this._exaggeration,u,d)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(e.ac.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=n.getIds().map(e=>{const t=n.getTileByID(e).tileID;return t.projMatrix=i.calculateProjMatrix(t.toUnwrapped()),t});!function(t,n){const i=n.transform.pointCoordinate(n.transform.getCameraPoint()),r=new e.P(i.x,i.y);t.sort((t,n)=>{if(n.overscaledZ-t.overscaledZ)return n.overscaledZ-t.overscaledZ;const i=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.P(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),s=r.mult(1<<t.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(i)-s.distSqr(o)})}(r,this.painter);const o=this.proxyToSource||{};this.proxyToSource={},r.forEach(e=>{this.proxyToSource[e.key]={}}),this.terrainTileForTile={};const s=this._style._mergedSourceCaches;for(const e in s){const n=s[e];if(!n.used)continue;if(n!==this.sourceCache&&this.resetTileLookupCache(n.id),this._setupProxiedCoordsForOrtho(n,t[e],o),n.usedForTerrain)continue;const i=t[e];n.getSource().reparseOverscaled&&this._assignTerrainTiles(i)}this.proxiedCoords[n.id]=r.map(e=>new Zr(e,e.key,this.orthoMatrix)),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const n=t.tileID.key;n in a||(this._visibleDemTiles.push(t),a[n]=n)}}_assignTerrainTiles(e){this._initializing||e.forEach(e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)})}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){const i=this.terrainTileForTile[n],r=i.dem;!r||i.demTexture&&!i.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Qi(this.painter,i,r))}}_prepareDemTileUniforms(e,t,n,i){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-r.z),s=i||"";return n["u_dem_tl".concat(s)]=[r.x*o%1,r.y*o%1],n["u_dem_scale".concat(s)]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let e=0;const t=this._visibleDemTiles.reduce((t,n)=>{if(!n.dem)return t;const i=n.dem.tree.minimums[0];return i>0&&e++,t+i},0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const i=this._getLoadedAreaMinimum(),r=new e.dG({width:1,height:1},new Float32Array([i]));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(r,{premultiply:!1}):o=this._emptyDEMTexture=new e.T(t,r,n.R32F,{premultiply:!1}),o}setupElevationDraw(t,n,i){const r=this.painter.context,o=r.gl,s={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};s.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(i&&i.morphing&&this._useVertexMorphing){const e=i.morphing.srcDemTile,n=i.morphing.dstDemTile;c=i.morphing.phase,e&&n&&(this._prepareDemTileUniforms(t,e,s,"_prev")&&(l=e),this._prepareDemTileUniforms(t,n,s)&&(a=n))}const u=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST;let h=null;var d;if(this.enabled?l&&a?(h=a.demTexture,r.activeTexture.set(o.TEXTURE4),l.demTexture.bind(u(l),o.CLAMP_TO_EDGE),s.u_dem_lerp=c):(a=this.terrainTileForTile[t.tileID.key],h=this._prepareDemTileUniforms(t,a,s)?a.demTexture:this.emptyDEMTexture):h=this.emptyDEMTexture,r.activeTexture.set(o.TEXTURE2),h&&(s.u_dem_size=1===(d=h).size[0]?1:d.size[0]-2,h.bind(u(a),o.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(i&&i.useDepthForOcclusion,n,s),i&&i.useMeterToDem&&a){const t=(1<<a.tileID.canonical.z)*e.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=t}if(i&&i.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(r,s),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,i&&i.useDenormalizedUpVectorScale);n.setGlobeUniformValues(r,e)}}globeUniformValues(t,n,i){const r=t.projection;return{u_tile_tl_up:r.upVector(n,0,0),u_tile_tr_up:r.upVector(n,e.aj,0),u_tile_br_up:r.upVector(n,e.aj,e.aj),u_tile_bl_up:r.upVector(n,0,e.aj),u_tile_up_scale:i?e.dH(1):r.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,i=this.painter.context;0!==t.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,n,i,r,o){if("globe"===t.transform.projection.name)!function(t,n,i,r,o){const s=t.context,a=s.gl;let l,c;const u=t.transform,h=e.dy(t,s,u),d=(e,n)=>{if(c===n)return;const i=[Vr[n],"PROJECTION_GLOBE_VIEW"];h&&i.push("CUSTOM_ANTIALIASING");const r=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:i,overrideFog:r}),c=n},f=t.colorModeForRenderPass(),p=new Gn(a.LEQUAL,Gn.ReadWrite,t.depthRangeFor3D);Ur.update(o);const m=e.dz(u),g=[e.aD(u.center.lng),e.aH(u.center.lat)],_=t.globeSharedBuffers,y=[u.width*e.q.devicePixelRatio,u.height*e.q.devicePixelRatio],v=Float32Array.from(u.globeMatrix),x={useDenormalizedUpVectorScale:!0};{const u=t.transform,h=jr(u.zoom,n.exaggeration(),n.sourceCache._source.tileSize);c=-1;const b=a.TRIANGLES;for(const c of r){const r=i.getTile(c),w=Wn.disabled,E=n.prevTerrainTileForTile[c.key],T=n.terrainTileForTile[c.key];Nr(E,T)&&Ur.newMorphing(c.key,E,T,o,250),s.activeTexture.set(a.TEXTURE0),r.texture&&r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const A=Ur.getMorphValuesForProxy(c.key),S=A?1:0;A&&e.L(x,{morphing:{srcDemTile:A.from,dstDemTile:A.to,phase:e.dx(A.phase)}});const D=e.dA(c.canonical),C=e.dB(D.getCenter().lat),I=e.dC(c.canonical,D,C,u.worldSize/u._pixelsPerMercatorPixel),R=e.bh(e.dD(c.canonical)),P=zr(u.expandedFarZProjMatrix,v,m,R,e.ah(u.zoom),g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,h,u._farZ,I);if(d(c,S),l&&(n.setupElevationDraw(r,l,x),t.uploadCommonUniforms(s,l,c.toUnwrapped()),_)){const[e,n,i]=_.getGridBuffers(C,0!==h);l.draw(t,b,p,w,f,Zn.backCCW,P,"globe_raster",e,n,i)}}}if(_&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&o.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:o});for(const c of r){const{x:r,y:o,z:h}=c.canonical,d=0===o,m=o===(1<<h)-1,[v,b,w,E]=_.getPoleBuffers(h,!1);if(E&&(d||m)){const o=i.getTile(c);s.activeTexture.set(a.TEXTURE0),o.texture&&o.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let _=e.dE(h,r,u);const T=e.bh(e.dD(c.canonical)),A=(e,n)=>e.draw(t,a.TRIANGLES,p,Wn.disabled,f,Zn.disabled,zr(u.expandedFarZProjMatrix,_,_,T,0,g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,0,u._farZ),"globe_pole_raster",n,w,E);n.setupElevationDraw(o,l,x),t.uploadCommonUniforms(s,l,c.toUnwrapped()),d&&t.renderDefaultNorthPole&&A(l,v),m&&t.renderDefaultSouthPole&&(_=e.cP(e.bz(),_,[1,-1,1]),A(l,b))}}}}(t,n,i,r,o);else{const s=t.context,a=s.gl;let l,c;const u=t.shadowRenderer,h=ri(t,t.longestCutoffRange),d=e=>{if(c===e)return;const n=[];n.push(Vr[e]),h.shouldRenderCutoff&&n.push("RENDER_CUTOFF"),u&&(n.push("RENDER_SHADOWS","DEPTH_TEXTURE"),u.useNormalOffset&&n.push("NORMAL_OFFSET")),l=t.getOrCreateProgram("terrainRaster",{defines:n}),c=e},f=t.colorModeForRenderPass(),p=new Gn(a.LEQUAL,Gn.ReadWrite,t.depthRangeFor3D);Ur.update(o);const m=t.transform,g=jr(m.zoom,n.exaggeration(),n.sourceCache._source.tileSize);let _=[0,0,0];if(u){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(_=hi(t.style,e,n))}{c=-1;const y=a.TRIANGLES,[v,x]=[n.gridIndexBuffer,n.gridSegments];for(const c of r){const r=i.getTile(c),b=Wn.disabled,w=n.prevTerrainTileForTile[c.key],E=n.terrainTileForTile[c.key];Nr(w,E)&&Ur.newMorphing(c.key,w,E,o,250),s.activeTexture.set(a.TEXTURE0),r.texture&&r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=Ur.getMorphValuesForProxy(c.key),A=T?1:0;let S;T&&(S={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.dx(T.phase)}});const D=Br(c.projMatrix,Gr(c.canonical,m.renderWorldCopies)?g/10:g,_);if(d(A),!l)continue;n.setupElevationDraw(r,l,S);const C=c.toUnwrapped();u&&u.setupShadows(C,l),t.uploadCommonUniforms(s,l,C,null,h),l.draw(t,y,p,b,f,Zn.backCCW,D,"terrain_raster",n.gridBuffer,v,x)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,r=this.proxySourceCache,o=this.proxiedCoords[r.id],s=this._drapedRenderBatches.shift(),a=n.style.order,l=[];let c=0;for(const u of o){const o=r.getTileByID(u.proxyTileKey),h=r.proxyCachedFBO[u.key]?r.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?r.renderCache[h]:this.pool[c++],f=void 0!==h;if(o.texture=d.tex,f&&!d.dirty){l.push(o.tileID);continue}let p;i.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(i.clear({color:e.am.transparent,stencil:0}),d.dirty=!1);for(let e=s.start;e<=s.end;++e){const t=n.style._mergedLayers[a[e]];if(t.isHidden(n.transform.zoom))continue;const r=n.style.getLayerSourceCache(t),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const s=o;i.viewport.set([0,0,d.fb.width,d.fb.height]),p!==(r?r.id:null)&&(this._setupStencil(d,o,t,r),p=r?r.id:null),n.renderLayer(n,r,t,s)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=n.style._mergedLayers[a[e]];if(t.isHidden(n.transform.zoom))continue;const r=n.style.getLayerSourceCache(t),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const s=o;i.viewport.set([0,0,d.fb.width,d.fb.height]),p!==(r?r.id:null)&&(this._setupStencil(d,o,t,r),p=r?r.id:null),n.renderLayer(n,r,t,s)}this.renderedToTile?(d.dirty=!0,l.push(o.tileID)):f||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),s.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let n=-1,i=t;for(let r=0;r<t;++r)this._style.isLayerDraped(e._mergedLayers[e.order[r]])?n=Math.max(n,r):i=Math.min(i,r);return i>n}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(e=>e.dem).forEach(t=>{e=Math.min(e,t.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(e,t,n){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter(e=>e.dem).map(i=>{const r=i.tileID,o=1<<r.overscaledZ,{x:s,y:a}=r.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:i.dem.tree.raycastRoot(l,u,c,h,e,t,n),tile:i}});i.sort((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE));for(const r of i){if(null==r.t)return null;const i=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,n);if(null!=i)return i}return null}_createFBO(){const t=this.painter.context,n=t.gl,i=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const r=new e.T(t,{width:i[0],height:i[1],data:null},n.RGBA8);r.bind(n.LINEAR,n.CLAMP_TO_EDGE);const o=t.createFramebuffer(i[0],i[1],!0,null);return o.colorAttachment.set(r.texture),o.depthAttachment=new Or(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const t=this._style._mergedLayers[e],n=t.isHidden(this.painter.transform.zoom);return"hillshade"===t.type||"custom"===t.type?!n&&t.shouldRedrape():!n&&t.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof ot){t=!0;break}if(!t)return;const n={};for(let i=0;i<this._style.order.length;++i){const t=this._style._mergedLayers[this._style.order[i]],r=this._style.getLayerSourceCache(t);if(r&&!n[r.id]&&!t.isHidden(this.painter.transform.zoom)&&"line"===t.type&&t.widthExpression()instanceof e.ab){n[r.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t)this._clearRenderCacheForTile(r.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n]._source instanceof st){e=!0;break}if(!e)return;const t={};for(let n=0;n<this._style.order.length;++n){const e=this._style._mergedLayers[this._style.order[n]],i=this._style.getLayerSourceCache(e);if(!i||t[i.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const r=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][i.id];if(e)for(const t of e){const e=Wr(i.getTile(t),i.findLoadedParent(t,0),i,this.painter.transform,r);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(i.id,t)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(0===n)return;const i=[];this._pendingGroundEffectLayers=[];let r,o=0,s=this._style._mergedLayers[t[o]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++o<n;)s=this._style._mergedLayers[t[o]];for(;o<n;++o){const e=this._style._mergedLayers[t[o]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===r&&(r=o):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(o),void 0!==r&&(i.push({start:r,end:o-1}),r=void 0)))}if(void 0!==r&&i.push({start:r,end:o-1}),0!==i.length){const t=i[i.length-1];this._pendingGroundEffectLayers.every(e=>e>t.end)||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let n=0;n<e.length;++n){const i=Object.values(e[n]);t.renderCachePool.push(...i)}}return}this._clearRasterLayersFromRenderCache();const n=this.proxyCoords,i=this._tilesDirty;for(let o=n.length-1;o>=0;o--){const r=n[o];if(t.getTileByID(r.key),void 0!==t.proxyCachedFBO[r.key]){const n=e[r.key],o=this.proxyToSource[r.key];let s=0;for(const e in o){const t=o[e],r=n[e];if(!r||r.length!==t.length||t.some((t,n)=>t!==r[n]||i[e]&&i[e].hasOwnProperty(t.key))){s=-1;break}++s}for(const e in t.proxyCachedFBO[r.key])t.renderCache[t.proxyCachedFBO[r.key][e]].dirty=s<0||s!==Object.values(n).length}}const r=[...this._drapedRenderBatches];r.sort((e,t)=>t.end-t.start-(e.end-e.start));for(const o of r)for(const e of n){if(t.proxyCachedFBO[e.key])continue;let n=t.renderCachePool.pop();void 0===n&&t.renderCache.length<50&&(n=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==n&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][o.start]=n,t.renderCache[n].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,n,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(n.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Wn.disabled}_renderTileClippingMasks(e,t){const n=this.painter,i=this.painter.context,r=i.gl;n._tileClippingMaskIDs={},i.setColorMode(jn.disabled),i.setDepthMode(Gn.disabled);const o=n.getOrCreateProgram("clippingMask");for(const s of e){const e=n._tileClippingMaskIDs[s.key]=--t;o.draw(n,r.TRIANGLES,Gn.disabled,new Wn({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),jn.disabled,Zn.disabled,Hr(s.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const i=[t.x,t.y,1,1];e.aA(i,i,n.pixelMatrixInverse),e.cH(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;const r=n._camera.position,o=e.cb(1,n.center.lat),s=[r[0],r[1],r[2]/o,0],a=e.d7([],i.slice(0,3),s);e.au(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(e.bE(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}_setupProxiedCoordsForOrtho(t,n,i){if(t.getSource()instanceof e.aP)return this._setupProxiedCoordsForImageSource(t,n,i);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const r=this.proxiedCoords[t.id]=[],o=this.proxyCoords;for(let e=0;e<o.length;e++){const n=o[e],s=this._findTileCoveringTileID(n,t);if(s){const e=this._createProxiedId(n,s,i[n.key]&&i[n.key][t.id]);r.push(e),this.proxyToSource[n.key][t.id]=[e]}}let s=!1;const a=new Set;for(let e=0;e<n.length;e++){const o=t.getTile(n[e]);if(!o||!o.hasData())continue;const l=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==o.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],n=this._createProxiedId(l.tileID,o,i[l.tileID.key]&&i[l.tileID.key][t.id]);e?e.splice(e.length-1,0,n):this.proxyToSource[l.tileID.key][t.id]=[n];const c=this.proxyToSource[l.tileID.key][t.id];a.has(c)||a.add(c),r.push(n),s=!0}}if(this._sourceTilesOverlap[t.id]=s,s&&this._debugParams.sortTilesHiZFirst)for(const e of a)e.sort((e,t)=>t.overscaledZ-e.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,i){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],o=this.proxyCoords,s=t.getSource(),a=s.tileID;if(!a)return;const l=new e.P(a.x,a.y)._div(1<<a.z),c=s.coordinates.map(e.ac.fromLngLat).reduce((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(t,n)=>{const i=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),o=e.aj/(1<<t.canonical.z),s=n.wrap+n.canonical.x/(1<<n.canonical.z),a=n.canonical.y/(1<<n.canonical.z);return i+o<s+c.min.x||i>s+c.max.x||r+o<a+c.min.y||r>a+c.max.y};for(let e=0;e<o.length;e++){const s=o[e];for(let e=0;e<n.length;e++){const o=t.getTile(n[e]);if(!o||!o.hasData())continue;if(u(s,o.tileID))continue;const a=this._createProxiedId(s,o,i[s.key]&&i[s.key][t.id]),l=this.proxyToSource[s.key][t.id];l?l.push(a):this.proxyToSource[s.key][t.id]=[a],r.push(a)}}}_createProxiedId(t,n,i){let r=this.orthoMatrix;if(i){const e=i.find(e=>e.key===n.tileID.key);if(e)return e}if(n.tileID.key!==t.key){const i=t.canonical.z-n.tileID.canonical.z;let o,s,a;r=e.bz();const l=n.tileID.wrap-t.wrap<<t.overscaledZ;i>0?(o=e.aj>>i,s=o*((n.tileID.canonical.x<<i)-t.canonical.x+l),a=o*((n.tileID.canonical.y<<i)-t.canonical.y)):(o=e.aj<<-i,s=e.aj*(n.tileID.canonical.x-(t.canonical.x+l<<-i)),a=e.aj*(n.tileID.canonical.y-(t.canonical.y<<-i))),e.ca(r,0,o,0,o,0,1),e.bo(r,r,[s,a,0])}return new Zr(n.tileID,t.key,r)}_findTileCoveringTileID(t,n){let i=n.getTile(t);if(i&&i.hasData())return i;const r=this._findCoveringTileCache[n.id],o=r[t.key];if(i=o?n.getTileByID(o):null,i&&i.hasData()||null===o)return i;let s=i?i.tileID:t,a=s.overscaledZ;const l=n.getSource().minzoom,c=[];if(!o){const r=n.getSource().maxzoom;if(t.canonical.z>=r){const i=t.canonical.z-r;n.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,n.transform.tileZoom),s=new e.aM(a,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i)):0!==i&&(a=r,s=new e.aM(a,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i))}s.key!==t.key&&(c.push(s.key),i=n.getTile(s))}const u=e=>{c.forEach(t=>{r[t]=e}),c.length=0};for(a-=1;a>=l&&(!i||!i.hasData());a--){i&&u(i.tileID.key);const e=s.calculateScaledKey(a);if(i=n.getTileByID(e),i&&i.hasData())break;const t=r[e];if(null===t)break;void 0===t?c.push(e):i=n.getTileByID(t)}return u(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}}function Kr(t,n,i){const r=function(t,n,i){const r=e.bG(n,t),o=e.bG(i,[.2126,.7152,.0722]),s=(e,t,n)=>(1-n)*e+n*t,a=s(1-.3*Math.min(o,1),1,Math.min(r+1,1));return s(.92,1,Math.asin(e.ay(n[2],-1,1))/Math.PI+.5)*a}(t,[0,0,1],n),o=[0,0,0];e.c1(o,i.slice(0,3),r);const s=[0,0,0];e.c1(s,n.slice(0,3),t[2]);const a=[0,0,0];return e.d5(a,o,s),e.d8(a)}const Jr=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Qr=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class $r{static cacheKey(e,t,n,i){let r="".concat(t).concat(i?i.cacheKey:"");for(const o of n)e.usedDefines.includes(o)&&(r+="/".concat(o));return r}constructor(t,n,i,r,o,s){const a=t.gl;this.program=a.createProgram(),this.configuration=r,this.name=n,this.fixedDefines=[...s];const l=r?r.getBinderAttributes():[],c=(i.staticAttributes||[]).concat(l);let u=r?r.defines():[];u=u.concat(s.map(e=>"#define ".concat(e)));const h="#version 300 es\n";let d=h+u.concat("precision mediump float;",Wi,Hi.fragmentSource).join("\n");for(const e of i.fragmentIncludes)d+="\n".concat(ji[e]);d+="\n".concat(i.fragmentSource);let f=h+u.concat("precision highp float;",Wi,Hi.vertexSource).join("\n");for(const e of i.vertexIncludes)f+="\n".concat(ji[e]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&-1!==i.vertexSource.indexOf("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&(f+="\nuniform int u_instanceID;\n"),f+="\n".concat(i.vertexSource),this.forceManualRenderingForInstanceIDShaders&&(f=f.replaceAll("gl_InstanceID","u_instanceID"));const p=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(p,d),a.compileShader(p),a.attachShader(this.program,p);const m=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(m,f),a.compileShader(m),a.attachShader(this.program,m),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:"a_".concat(c[e]);a.bindAttribLocation(this.program,e,t),this.attributes[t]=e}a.linkProgram(this.program),a.deleteShader(m),a.deleteShader(p),this.fixedUniforms=o(t),this.binderUniforms=r?r.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(t=>({u_instanceID:new e.cd(t)}))(t)),(s.includes("TERRAIN")||-1!==n.indexOf("symbol")||-1!==n.indexOf("circle"))&&(this.terrainUniforms=(t=>({u_dem:new e.cd(t),u_dem_prev:new e.cd(t),u_dem_tl:new e.cg(t),u_dem_scale:new e.cf(t),u_dem_tl_prev:new e.cg(t),u_dem_scale_prev:new e.cf(t),u_dem_size:new e.cf(t),u_dem_lerp:new e.cf(t),u_exaggeration:new e.cf(t),u_depth:new e.cd(t),u_depth_size_inv:new e.cg(t),u_depth_range_unpack:new e.cg(t),u_occluder_half_size:new e.cf(t),u_occlusion_depth_offset:new e.cf(t),u_meter_to_dem:new e.cf(t),u_label_plane_matrix_inv:new e.ch(t)}))(t)),s.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.ce(t),u_tile_tr_up:new e.ce(t),u_tile_br_up:new e.ce(t),u_tile_bl_up:new e.ce(t),u_tile_up_scale:new e.cf(t)}))(t)),s.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.ch(t),u_fog_range:new e.cg(t),u_fog_color:new e.d0(t),u_fog_horizon_blend:new e.cf(t),u_fog_vertical_limit:new e.cg(t),u_fog_temporal_offset:new e.cf(t),u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_globe_pos:new e.ce(t),u_globe_radius:new e.cf(t),u_globe_transition:new e.cf(t),u_is_globe:new e.cd(t),u_viewport:new e.cg(t)}))(t)),s.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.d0(t)}))(t)),s.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.ce(t),u_lighting_directional_dir:new e.ce(t),u_lighting_directional_color:new e.ce(t),u_ground_radiance:new e.ce(t)}))(t)),s.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.ch(t),u_light_matrix_1:new e.ch(t),u_fade_range:new e.cg(t),u_shadow_normal_offset:new e.ce(t),u_shadow_intensity:new e.cf(t),u_shadow_texel_size:new e.cf(t),u_shadow_map_resolution:new e.cf(t),u_shadow_direction:new e.ce(t),u_shadow_bias:new e.ce(t),u_shadowmap_0:new e.cd(t),u_shadowmap_1:new e.cd(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const n=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const n=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const n=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const n=this.shadowUniforms;e.program.set(this.program);for(const i in t)n[i].set(this.program,i,t[i])}_drawDebugWireframe(t,n,i,r,o,s,a,l,c,u){const h=t.options.wireframe;if(!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D)return;const d=t.context;if(!(()=>!(!h.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!h.layers2D||t._terrain&&t._terrain.renderingToTexture||!Jr.includes(this.name))||!(!h.layers3D||!Qr.includes(this.name)))())return;const f=d.gl,p=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,o,d);if(!p)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const g=t.getOrCreateProgram(this.name,{config:this.configuration,defines:m});d.program.set(g.program);const _=(e,t,n)=>{if(t[e]&&n[e])for(const i in t[e])n[e][i]&&n[e][i].set(n.program,i,t[e][i].current)};c&&c.setUniforms(g.program,d,g.binderUniforms,a,{zoom:l}),_("fixedUniforms",this,g),_("terrainUniforms",this,g),_("globeUniforms",this,g),_("fogUniforms",this,g),_("lightsUniforms",this,g),_("shadowUniforms",this,g),p.bind(),d.setColorMode(new jn([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ZERO,f.ONE],e.am.transparent,[!0,!0,!0,!1])),d.setDepthMode(new Gn(n.func===f.LESS?f.LEQUAL:n.func,Gn.ReadOnly,n.range)),d.setStencilMode(Wn.disabled);const y=3*s.primitiveLength*2,v=3*s.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const e=u||1;for(let t=0;t<e;++t)g.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",t),f.drawElements(f.LINES,y,f.UNSIGNED_SHORT,v)}else u&&u>1?f.drawElementsInstanced(f.LINES,y,f.UNSIGNED_SHORT,v,u):f.drawElements(f.LINES,y,f.UNSIGNED_SHORT,v);o.bind(),d.program.set(this.program),d.setDepthMode(n),d.setStencilMode(i),d.setColorMode(r)}checkUniforms(e,t,n){if(this.fixedDefines.includes(t))for(const i of Object.keys(n))if(!n[i].initialized)throw new Error("Program '".concat(this.name,"', from draw '").concat(e,"': uniform ").concat(i," not set but required by ").concat(t," being defined"))}draw(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m){const g=e.context,_=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(n),g.setStencilMode(i),g.setColorMode(r),g.setCullFace(o);for(const x of Object.keys(this.fixedUniforms))this.fixedUniforms[x].set(this.program,x,s[x]);f&&f.setUniforms(this.program,g,this.binderUniforms,h,{zoom:d});const y={[_.POINTS]:1,[_.LINES]:2,[_.TRIANGLES]:3,[_.LINE_STRIP]:1}[t];this.checkUniforms(a,"RENDER_SHADOWS",this.shadowUniforms);const v=m&&m>0?1:void 0;for(const x of u.get()){const o=x.vaos||(x.vaos={});if((o[a]||(o[a]=new Yi)).bind(g,this,l,f?f.getPaintVertexBuffers():[],c,x.vertexOffset,p||[],v),this.forceManualRenderingForInstanceIDShaders){const e=m||1;for(let n=0;n<e;++n)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",n),c?_.drawElements(t,x.primitiveLength*y,_.UNSIGNED_SHORT,x.primitiveOffset*y*2):_.drawArrays(t,x.vertexOffset,x.vertexLength)}else m&&m>1?_.drawElementsInstanced(t,x.primitiveLength*y,_.UNSIGNED_SHORT,x.primitiveOffset*y*2,m):c?_.drawElements(t,x.primitiveLength*y,_.UNSIGNED_SHORT,x.primitiveOffset*y*2):_.drawArrays(t,x.vertexOffset,x.vertexLength);t===_.TRIANGLES&&c&&this._drawDebugWireframe(e,n,i,r,c,x,h,d,f,m)}}}function eo(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,t.transform.tileZoom)/r,s=o*(n.tileID.canonical.x+n.tileID.wrap*r),a=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.aw(n,1,t.transform.tileZoom),u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a],u_pattern_transition:i}}const to={terrain:0,flat:1},no=e.bz(),io=(t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y)=>{const v=n.style.light,x=v.properties.get("position"),b=[x.x,x.y,x.z],w=e.dJ();"viewport"===v.properties.get("anchor")&&(e.dK(w,-n.transform.angle),e.dL(b,b,w));const E=v.properties.get("color").toPremultipliedRenderColor(null),T=n.transform,A={u_matrix:t,u_lightpos:b,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+i,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:no,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:to[u],u_base_type:to[h],u_ao:o,u_edge_radius:s,u_width_scale:a,u_flood_light_color:m,u_vertical_scale:g,u_flood_light_intensity:_,u_ground_shadow_factor:y};return"globe"===T.projection.name&&(A.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],A.u_zoom_transition=d,A.u_inv_rot_matrix=p,A.u_merc_center=f,A.u_up_dir=T.projection.upVector(new e.cA(0,0,0),f[0]*e.aj,f[1]*e.aj),A.u_height_lift=c),A},ro=(e,t,n,i,r,o)=>({u_matrix:e,u_edge_radius:t,u_width_scale:n,u_vertical_scale:i,u_height_type:to[r],u_base_type:to[o]}),oo=(t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y)=>{const v=io(t,n,i,r,o,s,a,l,u,h,d,f,p,m,g,_,1,[0,0,0]),x={u_height_factor:-Math.pow(2,l.overscaledZ)/c.tileSize/8};return e.h(v,eo(n,c,y),x)},so=(e,t,n)=>({u_matrix:e,u_emissive_strength:t,u_ground_shadow_factor:n}),ao=function(t,n,i,r,o){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return e.h(so(t,n,o),eo(i,r,s))},lo=(e,t,n,i)=>({u_matrix:e,u_world:n,u_emissive_strength:t,u_ground_shadow_factor:i}),co=function(t,n,i,r,o,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return e.h(ao(t,n,i,r,s,a),{u_world:o})},uo=(e,t)=>({u_matrix:e,u_ground_shadow_factor:t}),ho=(e,t,n,i,r)=>({u_matrix:e,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:n,u_height_scale:i,u_reset_depth:r}),fo=(e,t)=>({u_matrix:e,u_normal_matrix:t,u_opacity:1}),po=e=>({u_matrix:e}),mo=e=>({u_matrix:e}),go=(t,n,i,r,o,s,a,l)=>{const c=e.aj/s.tileSize;return{u_matrix:t,u_inv_rot_matrix:n,u_camera_to_center_distance:i.getCameraToCenterDistance(l),u_extrude_scale:[i.pixelsToGLUnits[0]/c,i.pixelsToGLUnits[1]/c],u_zoom_transition:r,u_tile_id:a,u_merc_center:o}},_o=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},yo=e.bz(),vo=(t,n,i,r,o,s,a)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.dM(l.zoom,n.canonical)*l._pixelsPerMercatorPixel:e.aw(i,1,s),h={u_matrix:n.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:yo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=r,h.u_merc_center=o,h.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],h.u_zoom_transition=e.ah(l.zoom);const t=o[0]*e.aj,i=o[1]*e.aj;h.u_up_dir=l.projection.upVector(new e.cA(0,0,0),t,i)}return h};function xo(e,t,n){let[i,r,o,s]=t,[a,l]=n;if(a===l)return[0,0,0,0];const c=255*(e-1)/(e*(l-a));return[i*c,r*c,o*c,s*c]}function bo(e,t,n){let[i,r]=n;return i===r?0:.5/e+(t-i)*(e-1)/(e*(r-i))}const wo=(t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b)=>({u_matrix:t,u_normalize_matrix:n,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:o,u_tl_parent:s,u_scale_parent:u,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:e.dO(d.paint.get("raster-saturation")),u_contrast_factor:e.dN(d.paint.get("raster-contrast")),u_spin_weights:Eo(d.paint.get("raster-hue-rotate")),u_perspective_transform:f,u_raster_elevation:p,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:xo(e.dP,g,y),u_colorization_offset:bo(e.dP,_,y),u_color_ramp:m,u_texture_offset:[x/(v+2*x),v/(v+2*x)],u_texture_res:[v+2*x,v+2*x],u_emissive_strength:b});function Eo(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const To=.05,Ao=(e,t,n,i,r,o,s,a,l,c,u,h)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:i,u_grid_matrix:r,u_tl_parent:o,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:h,u_zoom_transition:s,u_merc_center:a,u_cutoff_params:l}),So=(e,t,n,i,r,o,s,a,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:i,u_color_ramp:o,u_velocity_res:r,u_max_speed:s,u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[To,To]}),Do=(e,t,n,i,r,o,s,a,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:i,u_max_speed:r,u_speed_factor:o,u_reset_rate:s,u_rand_seed:Math.random(),u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[To,To]}),Co=e.bz(),Io=(t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,E,T)=>{const A=o.transform,S={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:A.getCameraToCenterDistance(v),u_rotate_symbol:+i,u_aspect_ratio:A.width/A.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+u,u_elevation_from_sea:c?1:0,u_pitch_with_map:+r,u_texsize:h,u_texsize_icon:d,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Co,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Co,u_up_vector:[0,-1,0],u_color_adj_mat:w,u_icon_transition:E||0,u_gamma_scale:r?o.transform.getCameraToCenterDistance(v)*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.q.devicePixelRatio,u_is_halo:1,u_scale_factor:T||1,u_ground_shadow_factor:x,u_inv_matrix:e.bi(e.bz(),a),u_normal_scale:b};return"globe"===v.name&&(S.u_tile_id=[p.canonical.x,p.canonical.y,1<<p.canonical.z],S.u_zoom_transition=m,S.u_inv_rot_matrix=_,S.u_merc_center=g,S.u_camera_forward=A._camera.forward(),S.u_ecef_origin=e.dQ(A.globeMatrix,p.toUnwrapped()),S.u_tile_matrix=Float32Array.from(A.globeMatrix),S.u_up_vector=y),S},Ro=(e,t,n,i)=>({u_matrix:e,u_emissive_strength:t,u_opacity:n,u_color:i}),Po=(t,n,i,r,o,s,a,l,c)=>e.h(function(t,n,i,r,o,s){const{width:a,height:l}=r.imageManager.getPixelSize(n),c=Math.pow(2,s.tileID.overscaledZ),u=s.tileSize*Math.pow(2,r.transform.tileZoom)/c,h=u*(s.tileID.canonical.x+s.tileID.wrap*c),d=u*s.tileID.canonical.y;return{u_image:0,u_pattern_tl:i.tl,u_pattern_br:i.br,u_texsize:[a,l],u_pattern_size:i.displaySize,u_pattern_units_to_pixels:o?[r.transform.width,-1*r.transform.height]:[1/e.aw(s,1,r.transform.tileZoom),1/e.aw(s,1,r.transform.tileZoom)],u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(0,s,a,r,l,c),{u_matrix:t,u_emissive_strength:n,u_opacity:i}),Mo=new Float32Array(e.bx([])),Fo=function(t,n,i,r,o,s,a,l,c,u,h,d,f){let p=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[0,0,0],m=arguments.length>14?arguments[14]:void 0;const g=o.style.light,_=g.properties.get("position"),y=[-_.x,-_.y,_.z],v=e.dJ();"viewport"===g.properties.get("anchor")&&(e.dK(v,-o.transform.angle),e.dL(y,y,v));const x="MASK"===h.alphaMode,b=g.properties.get("color").toNonPremultipliedRenderColor(null),w=f.paint.get("model-ambient-occlusion-intensity"),E=f.paint.get("model-color").constantOr(e.am.white).toNonPremultipliedRenderColor(null);return E.a=f.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:t,u_lighting_matrix:n,u_normal_matrix:i,u_node_matrix:r||Mo,u_lightpos:y,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_camera_pos:p,u_opacity:s,u_baseTextureIsAlpha:0,u_alphaMask:+x,u_alphaCutoff:h.alphaCutoff,u_baseColorFactor:a.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:l.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:c,u_roughnessFactor:u,u_baseColorTexture:ei.BaseColor,u_metallicRoughnessTexture:ei.MetallicRoughness,u_normalTexture:ei.Normal,u_occlusionTexture:ei.Occlusion,u_emissionTexture:ei.Emission,u_lutTexture:ei.LUT,u_color_mix:E.toArray01(),u_aoIntensity:w,u_emissive_strength:d,u_occlusionTextureTransform:m||[0,0,0,0]}},Lo=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mo,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:Mo}},ko={fillExtrusion:t=>({u_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_vertical_gradient:new e.cf(t),u_opacity:new e.cf(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_ao:new e.cg(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_up_dir:new e.ce(t),u_height_lift:new e.cf(t),u_flood_light_color:new e.ce(t),u_vertical_scale:new e.cf(t),u_flood_light_intensity:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),fillExtrusionDepth:t=>({u_matrix:new e.ch(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_vertical_scale:new e.cf(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t)}),fillExtrusionPattern:t=>({u_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_vertical_gradient:new e.cf(t),u_height_factor:new e.cf(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_ao:new e.cg(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_up_dir:new e.ce(t),u_height_lift:new e.cf(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_opacity:new e.cf(t),u_pattern_transition:new e.cf(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.ch(t),u_opacity:new e.cf(t),u_ao_pass:new e.cf(t),u_meter_to_tile:new e.cf(t),u_ao:new e.cg(t),u_flood_light_intensity:new e.cf(t),u_flood_light_color:new e.ce(t),u_attenuation:new e.cf(t),u_edge_radius:new e.cf(t),u_fb:new e.cd(t),u_fb_size:new e.cf(t),u_dynamic_offset:new e.cf(t)}),fill:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),fillPattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_pattern_transition:new e.cf(t)}),fillOutline:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_world:new e.cg(t),u_ground_shadow_factor:new e.ce(t)}),fillOutlinePattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_world:new e.cg(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_pattern_transition:new e.cf(t)}),building:t=>({u_matrix:new e.ch(t),u_normal_matrix:new e.ch(t),u_opacity:new e.cf(t)}),buildingBloom:t=>({u_matrix:new e.ch(t)}),buildingDepth:t=>({u_matrix:new e.ch(t)}),elevatedStructuresDepth:t=>({u_matrix:new e.ch(t),u_depth_bias:new e.cf(t)}),elevatedStructures:t=>({u_matrix:new e.ch(t),u_ground_shadow_factor:new e.ce(t)}),elevatedStructuresDepthReconstruct:t=>({u_matrix:new e.ch(t),u_camera_pos:new e.ce(t),u_depth_bias:new e.cf(t),u_height_scale:new e.cf(t),u_reset_depth:new e.cf(t)}),circle:e.dT,collisionBox:t=>({u_matrix:new e.ch(t),u_inv_rot_matrix:new e.ch(t),u_camera_to_center_distance:new e.cf(t),u_extrude_scale:new e.cg(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_tile_id:new e.ce(t)}),collisionCircle:t=>({u_matrix:new e.ch(t),u_inv_matrix:new e.ch(t),u_camera_to_center_distance:new e.cf(t),u_viewport_size:new e.cg(t)}),debug:t=>({u_color:new e.dv(t),u_matrix:new e.ch(t),u_overlay:new e.cd(t),u_overlay_scale:new e.cf(t)}),clippingMask:t=>({u_matrix:new e.ch(t)}),heatmap:t=>({u_extrude_scale:new e.cf(t),u_intensity:new e.cf(t),u_matrix:new e.ch(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_up_dir:new e.ce(t)}),heatmapTexture:t=>({u_image:new e.cd(t),u_color_ramp:new e.cd(t),u_opacity:new e.cf(t)}),hillshade:t=>({u_matrix:new e.ch(t),u_image:new e.cd(t),u_latrange:new e.cg(t),u_light:new e.cg(t),u_shadow:new e.dv(t),u_highlight:new e.dv(t),u_emissive_strength:new e.cf(t),u_accent:new e.dv(t)}),hillshadePrepare:t=>({u_matrix:new e.ch(t),u_image:new e.cd(t),u_dimension:new e.cg(t),u_zoom:new e.cf(t)}),line:e.dS,linePattern:e.dR,raster:t=>({u_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_grid_matrix:new e.dw(t),u_tl_parent:new e.cg(t),u_scale_parent:new e.cf(t),u_fade_t:new e.cf(t),u_opacity:new e.cf(t),u_image0:new e.cd(t),u_image1:new e.cd(t),u_brightness_low:new e.cf(t),u_brightness_high:new e.cf(t),u_saturation_factor:new e.cf(t),u_contrast_factor:new e.cf(t),u_spin_weights:new e.ce(t),u_perspective_transform:new e.cg(t),u_raster_elevation:new e.cf(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_cutoff_params:new e.d0(t),u_colorization_mix:new e.d0(t),u_colorization_offset:new e.cf(t),u_color_ramp:new e.cd(t),u_texture_offset:new e.cg(t),u_texture_res:new e.cg(t),u_emissive_strength:new e.cf(t)}),rasterParticle:t=>({u_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_grid_matrix:new e.dw(t),u_tl_parent:new e.cg(t),u_scale_parent:new e.cf(t),u_fade_t:new e.cf(t),u_opacity:new e.cf(t),u_image0:new e.cd(t),u_image1:new e.cd(t),u_raster_elevation:new e.cf(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_cutoff_params:new e.d0(t)}),rasterParticleTexture:t=>({u_texture:new e.cd(t),u_opacity:new e.cf(t)}),rasterParticleDraw:t=>({u_particle_texture:new e.cd(t),u_particle_texture_side_len:new e.cf(t),u_tile_offset:new e.cg(t),u_velocity:new e.cd(t),u_color_ramp:new e.cd(t),u_velocity_res:new e.cg(t),u_max_speed:new e.cf(t),u_uv_offset:new e.cg(t),u_data_scale:new e.cg(t),u_data_offset:new e.cf(t),u_particle_pos_scale:new e.cf(t),u_particle_pos_offset:new e.cg(t)}),rasterParticleUpdate:t=>({u_particle_texture:new e.cd(t),u_particle_texture_side_len:new e.cf(t),u_velocity:new e.cd(t),u_velocity_res:new e.cg(t),u_max_speed:new e.cf(t),u_speed_factor:new e.cf(t),u_reset_rate:new e.cf(t),u_rand_seed:new e.cf(t),u_uv_offset:new e.cg(t),u_data_scale:new e.cg(t),u_data_offset:new e.cf(t),u_particle_pos_scale:new e.cf(t),u_particle_pos_offset:new e.cg(t)}),symbol:t=>({u_is_size_zoom_constant:new e.cd(t),u_is_size_feature_constant:new e.cd(t),u_size_t:new e.cf(t),u_size:new e.cf(t),u_camera_to_center_distance:new e.cf(t),u_rotate_symbol:new e.cd(t),u_aspect_ratio:new e.cf(t),u_fade_change:new e.cf(t),u_matrix:new e.ch(t),u_label_plane_matrix:new e.ch(t),u_coord_matrix:new e.ch(t),u_is_text:new e.cd(t),u_elevation_from_sea:new e.cd(t),u_pitch_with_map:new e.cd(t),u_texsize:new e.cg(t),u_texsize_icon:new e.cg(t),u_texture:new e.cd(t),u_texture_icon:new e.cd(t),u_gamma_scale:new e.cf(t),u_device_pixel_ratio:new e.cf(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_camera_forward:new e.ce(t),u_tile_matrix:new e.ch(t),u_up_vector:new e.ce(t),u_ecef_origin:new e.ce(t),u_is_halo:new e.cd(t),u_icon_transition:new e.cf(t),u_color_adj_mat:new e.ch(t),u_scale_factor:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_inv_matrix:new e.ch(t),u_normal_scale:new e.cf(t)}),background:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_opacity:new e.cf(t),u_color:new e.dv(t)}),backgroundPattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_opacity:new e.cf(t),u_image:new e.cd(t),u_pattern_tl:new e.cg(t),u_pattern_br:new e.cg(t),u_texsize:new e.cg(t),u_pattern_size:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_pattern_units_to_pixels:new e.cg(t)}),terrainRaster:t=>({u_matrix:new e.ch(t),u_image0:new e.cd(t),u_skirt_height:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),skybox:t=>({u_matrix:new e.ch(t),u_sun_direction:new e.ce(t),u_cubemap:new e.cd(t),u_opacity:new e.cf(t),u_temporal_offset:new e.cf(t)}),skyboxGradient:t=>({u_matrix:new e.ch(t),u_color_ramp:new e.cd(t),u_center_direction:new e.ce(t),u_radius:new e.cf(t),u_opacity:new e.cf(t),u_temporal_offset:new e.cf(t)}),skyboxCapture:t=>({u_matrix_3f:new e.dw(t),u_sun_direction:new e.ce(t),u_sun_intensity:new e.cf(t),u_color_tint_r:new e.d0(t),u_color_tint_m:new e.d0(t),u_luminance:new e.cf(t)}),globeRaster:t=>({u_proj_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_image0:new e.cd(t),u_grid_matrix:new e.dw(t),u_skirt_height:new e.cf(t),u_far_z_cutoff:new e.cf(t),u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_globe_pos:new e.ce(t),u_globe_radius:new e.cf(t),u_viewport:new e.cg(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_horizon:new e.cf(t),u_transition:new e.cf(t),u_fadeout_range:new e.cf(t),u_color:new e.d0(t),u_high_color:new e.d0(t),u_space_color:new e.d0(t),u_temporal_offset:new e.cf(t),u_horizon_angle:new e.cf(t)}),model:t=>({u_matrix:new e.ch(t),u_lighting_matrix:new e.ch(t),u_normal_matrix:new e.ch(t),u_node_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_camera_pos:new e.ce(t),u_opacity:new e.cf(t),u_baseColorFactor:new e.d0(t),u_emissiveFactor:new e.d0(t),u_metallicFactor:new e.cf(t),u_roughnessFactor:new e.cf(t),u_baseTextureIsAlpha:new e.cd(t),u_alphaMask:new e.cd(t),u_alphaCutoff:new e.cf(t),u_baseColorTexture:new e.cd(t),u_metallicRoughnessTexture:new e.cd(t),u_normalTexture:new e.cd(t),u_occlusionTexture:new e.cd(t),u_emissionTexture:new e.cd(t),u_lutTexture:new e.cd(t),u_color_mix:new e.d0(t),u_aoIntensity:new e.cf(t),u_emissive_strength:new e.cf(t),u_occlusionTextureTransform:new e.d0(t)}),modelDepth:t=>({u_matrix:new e.ch(t),u_instance:new e.ch(t),u_node_matrix:new e.ch(t)}),groundShadow:t=>({u_matrix:new e.ch(t),u_ground_shadow_factor:new e.ce(t)}),stars:t=>({u_matrix:new e.ch(t),u_up:new e.ce(t),u_right:new e.ce(t),u_intensity_multiplier:new e.cf(t)}),snowParticle:t=>({u_modelview:new e.ch(t),u_projection:new e.ch(t),u_time:new e.cf(t),u_cam_pos:new e.ce(t),u_velocityConeAperture:new e.cf(t),u_velocity:new e.cf(t),u_horizontalOscillationRadius:new e.cf(t),u_horizontalOscillationRate:new e.cf(t),u_boxSize:new e.cf(t),u_billboardSize:new e.cf(t),u_simpleShapeParameters:new e.cg(t),u_screenSize:new e.cg(t),u_thinningCenterPos:new e.cg(t),u_thinningShape:new e.ce(t),u_thinningAffectedRatio:new e.cf(t),u_thinningParticleOffset:new e.cf(t),u_particleColor:new e.d0(t),u_direction:new e.ce(t)}),rainParticle:t=>({u_modelview:new e.ch(t),u_projection:new e.ch(t),u_time:new e.cf(t),u_cam_pos:new e.ce(t),u_texScreen:new e.cd(t),u_velocityConeAperture:new e.cf(t),u_velocity:new e.cf(t),u_boxSize:new e.cf(t),u_rainDropletSize:new e.cg(t),u_distortionStrength:new e.cf(t),u_rainDirection:new e.ce(t),u_color:new e.d0(t),u_screenSize:new e.cg(t),u_thinningCenterPos:new e.cg(t),u_thinningShape:new e.ce(t),u_thinningAffectedRatio:new e.cf(t),u_thinningParticleOffset:new e.cf(t),u_shapeDirectionalPower:new e.cf(t),u_shapeNormalPower:new e.cf(t),u_mode:new e.cf(t)}),vignette:t=>({u_vignetteShape:new e.ce(t),u_vignetteColor:new e.d0(t)}),occlusion:t=>({u_matrix:new e.ch(t),u_anchorPos:new e.ce(t),u_screenSizePx:new e.cg(t),u_occluderSizePx:new e.cg(t),u_color:new e.d0(t)})};class Oo{constructor(e,t,n,i){this.id=Oo.uniqueIdxCounter,Oo.uniqueIdxCounter++,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Oo.uniqueIdxCounter,Oo.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Oo.uniqueIdxCounter=0;const Bo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zo{constructor(e,t,n,i,r,o){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.instanceCount=o,this.context=e;const s=e.gl;this.buffer=s.createBuffer(),e.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const i=t.attributes[this.attributes[n].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],o=t.attributes[r.name];void 0!==o&&e.vertexAttribPointer(o,r.components,e[Bo[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}setVertexAttribDivisor(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(r,n)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class No{constructor(e,t,n,i,r){this.context=e,this.width=t,this.height=n;const o=this.framebuffer=e.gl.createFramebuffer();i&&(this.colorAttachment=new Fr(e,o)),r&&(this.depthAttachmentType=r,this.depthAttachment="renderbuffer"===r?new Lr(e,o):new kr(e,o))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class Uo{constructor(e,t){this.gl=e,this.clearColor=new tr(this),this.clearDepth=new nr(this),this.clearStencil=new ir(this),this.colorMask=new rr(this),this.depthMask=new or(this),this.stencilMask=new sr(this),this.stencilFunc=new ar(this),this.stencilOp=new lr(this),this.stencilTest=new cr(this),this.depthRange=new ur(this),this.depthTest=new hr(this),this.depthFunc=new dr(this),this.blend=new fr(this),this.blendFunc=new pr(this),this.blendColor=new mr(this),this.blendEquation=new gr(this),this.cullFace=new _r(this),this.cullFaceSide=new yr(this),this.frontFace=new vr(this),this.program=new xr(this),this.activeTexture=new br(this),this.viewport=new wr(this),this.bindFramebuffer=new Er(this),this.bindRenderbuffer=new Tr(this),this.bindTexture=new Ar(this),this.bindVertexBuffer=new Sr(this),this.bindElementBuffer=new Dr(this),this.bindVertexArrayOES=new Cr(this),this.pixelStoreUnpack=new Ir(this),this.pixelStoreUnpackPremultiplyAlpha=new Rr(this),this.pixelStoreUnpackFlipY=new Pr(this),this.options=t?Object.assign({},t):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=t&&!!t.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,n){return new Oo(this,e,t,n)}createVertexBuffer(e,t,n,i,r){return new zo(this,e,t,n,i,r)}createRenderbuffer(e,t,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,n,i){return new No(this,e,t,n,i)}clear(e){let{color:t,depth:n,stencil:i,colorMask:r}=e;const o=this.gl;let s=0;t&&(s|=o.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(r||[!0,!0,!0,!0])),void 0!==n&&(s|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(s|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),o.clear(s)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.bv(t.blendFunction,jn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Vo;function jo(t,n,i,r,o,s,a){const l=t.context,c=l.gl,u=t.transform,h=[e.aD(u.center.lng),e.aH(u.center.lat)],d=i.layout.get("symbol-placement"),f=i.layout.get("text-variable-anchor"),p="map"===i.layout.get("icon-rotation-alignment"),m="map"===i.layout.get("text-rotation-alignment"),g="point"!==d,_=[];let y=0,v=0;for(let S=0;S<r.length;S++){const l=r[S],d=n.getTile(l),x=d.getBucket(i);if(!x)continue;const b=x.getProjection().createInversionMatrix(u,l.canonical),w=[],E=Wt(l,x,u),T=!a&&p&&g,A=a&&m&&g,D=f&&x.hasTextData(),C=x.hasIconTextFit()&&D&&x.hasIconData(),I=T||A||a&&D||C,R="globe"===x.projection.name,P=R?e.ah(u.zoom):0;R&&(w.push("PROJECTION_GLOBE_VIEW"),I&&w.push("PROJECTED_POS_ON_VIEWPORT"));const M=t.getOrCreateProgram("collisionBox",{defines:w});let F=E;0===o[0]&&0===o[1]||(F=t.translatePosMatrix(E,d,o,s));const L=a?x.textCollisionBox:x.iconCollisionBox,k=x.collisionCircleArray;if(k.length>0){const t=e.bz(),n=F;e.cM(t,x.placementInvProjMatrix,u.glCoordMatrix),e.cM(t,t,x.placementViewportMatrix),_.push({circleArray:k,circleOffset:v,transform:n,invTransform:t,projection:x.getProjection()}),y+=k.length/4,v=y}if(!L)continue;t.terrain&&t.terrain.setupElevationDraw(d,M);const O=R?[l.canonical.x,l.canonical.y,1<<l.canonical.z]:[0,0,0];M.draw(t,c.LINES,Gn.disabled,Wn.disabled,t.colorModeForRenderPass(),Zn.disabled,go(F,b,u,P,h,d,O,x.getProjection()),i.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,null,u.zoom,null,[L.collisionVertexBuffer,L.collisionVertexBufferExt])}if(!a||!_.length)return;const x=t.getOrCreateProgram("collisionCircle"),b=new e.dU;b.resize(4*y),b._trim();let w=0;for(const e of _)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,i=e.circleArray[n+0],r=e.circleArray[n+1],o=e.circleArray[n+2],s=e.circleArray[n+3];b.emplace(w++,i,r,o,s,0),b.emplace(w++,i,r,o,s,1),b.emplace(w++,i,r,o,s,2),b.emplace(w++,i,r,o,s,3)}(!Vo||Vo.length<2*y)&&(Vo=function(t){const n=2*t,i=new e.a_;i.resize(n),i._trim();for(let e=0;e<n;e++){const t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(y));const E=l.createIndexBuffer(Vo,!0),T=l.createVertexBuffer(b,e.dV.members,!0);for(const S of _){const n={u_matrix:S.transform,u_inv_matrix:S.invTransform,u_camera_to_center_distance:(A=u).getCameraToCenterDistance(S.projection),u_viewport_size:[A.width,A.height]};x.draw(t,c.TRIANGLES,Gn.disabled,Wn.disabled,t.colorModeForRenderPass(),Zn.disabled,n,i.id,T,E,e.bd.simpleSegment(0,2*S.circleOffset,S.circleArray.length,S.circleArray.length/2),null,u.zoom)}var A;T.destroy(),E.destroy()}const Go=e.bz();function Ho(t){const n=t._camera.getWorldToCamera(t.worldSize,1),i=e.az([],n,t.globeMatrix);e.bi(i,i);const r=[0,0,0],o=[0,1,0,0];return e.aA(o,o,i),r[0]=o[0],r[1]=o[1],r[2]=o[2],e.au(r,r),r}function Wo(t,n){let{width:i,height:r,anchor:o,textOffset:s,textScale:a}=t;const{horizontalAlign:l,verticalAlign:c}=e.bZ(o),u=-(l-.5)*i,h=-(c-.5)*r,d=e.b_(o,s);return new e.P((u/a+d[0])*n,(h/a+d[1])*n)}function qo(t,n,i,r,o,s,a,l,c,u){const h=t.text.placedSymbolArray,d=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,p={},m=t.getProjection(),g=qt(a,m,o),_=o.elevation,y=m.upVectorScale(a.canonical,o.center.lat,o.worldSize).metersToTile;d.clear();for(let v=0;v<h.length;v++){const f=h.get(v),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=f,E=f.hidden||!f.crossTileID||t.allowVerticalPlacement&&!f.placedOrientation?null:r[f.crossTileID];if(E){let r=0,h=0,v=0;if(_){const e=_?_.getAtTileOffset(a,x,b):0,[t,n,i]=m.upVector(a.canonical,x,b);r=e*t*y,h=e*n*y,v=e*i*y}let[T,A,S,D]=en(f.projectedAnchorX+r,f.projectedAnchorY+h,f.projectedAnchorZ+v,i?g:s);const C=tn(o.getCameraToCenterDistance(m),D);let I=e.bJ(t.textSizeData,c,f)*C/e.bU;i&&(I*=t.tilePixelRatio/l);const R=Wo(E,I);i?(({x:T,y:A,z:S}=m.projectTilePoint(x+R.x,b+R.y,a.canonical)),[T,A,S]=en(T+r,A+h,S+v,s)):(n&&R._rotate(-o.angle),T+=R.x,A+=R.y,S=0);const P=t.allowVerticalPlacement&&f.placedOrientation===e.bI.vertical?Math.PI/2:0;for(let t=0;t<w;t++)e.bL(d,T,A,S,P);u&&f.associatedIconIndex>=0&&(p[f.associatedIconIndex]={x:T,y:A,z:S,angle:P})}else hn(w,d)}if(u){f.clear();const n=t.icon.placedSymbolArray;for(let t=0;t<n.length;t++){const i=n.get(t),{numGlyphs:r}=i,o=p[t];if(i.hidden||!o)hn(r,f);else{const{x:t,y:n,z:i,angle:s}=o;for(let o=0;o<r;o++)e.bL(f,t,n,i,s)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(d)}function Xo(t,n,i,r,o,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};const l=i.paint.get("icon-translate"),c=i.paint.get("text-translate"),u=i.paint.get("icon-translate-anchor"),h=i.paint.get("text-translate-anchor"),d=i.layout.get("icon-rotation-alignment"),f=i.layout.get("text-rotation-alignment"),p=i.layout.get("icon-pitch-alignment"),m=i.layout.get("text-pitch-alignment"),g=i.layout.get("icon-keep-upright"),_=i.layout.get("text-keep-upright"),y=i.paint.get("icon-color-saturation"),v=i.paint.get("icon-color-contrast"),x=i.paint.get("icon-color-brightness-min"),b=i.paint.get("icon-color-brightness-max"),w="sea"===i.layout.get("symbol-elevation-reference"),E=t.context,T=E.gl,A=t.transform,S="map"===d,D="map"===f,C="map"===p,I="map"===m,R=void 0!==i.layout.get("symbol-sort-key").constantOr(1);let P=!1;const M=t.depthModeForSublayer(0,Gn.ReadOnly),F=new Gn(t.context.gl.LEQUAL,Gn.ReadOnly,t.depthRangeFor3D),L=[e.aD(A.center.lng),e.aH(A.center.lat)],k=i.layout.get("text-variable-anchor"),O="globe"===A.projection.name,B=[],z=[0,-1,0];for(const N of r){const r=n.getTile(N),o=r.getBucket(i);if(!o)continue;if("mercator"===o.projection.name&&O)continue;if(o.fullyClipped)continue;const s="globe"===o.projection.name,d=s?e.ah(A.zoom):0,f=qt(N,o.getProjection(),A),p=A.calculatePixelsToTileUnitsMatrix(r),m=k&&o.hasTextData(),E=o.hasIconTextFit()&&m&&o.hasIconData(),U=o.getProjection().createInversionMatrix(A,N.canonical),V=(1<<r.tileID.canonical.z)*e.aj/t.transform.worldSize,j=e=>{let n=[0,0,0];if(e){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(n=hi(t.style,e,i))}return n},G=e=>{A.depthOcclusionForSymbolsAndCircles&&(i.hasInitialOcclusionOpacityProperties||t.terrain)&&(e.push("DEPTH_D24"),e.push("DEPTH_OCCLUSION"))},H=()=>{const n=S&&"point"!==i.layout.get("symbol-placement"),a=[];G(a);const c=n||E,h="road"===o.elevationType,m=t.shadowRenderer,_=h&&C&&!!m&&m.enabled,D=j(_),I=h&&C&&!t.terrain?F:M,R=i.paint.get("icon-image-cross-fade");t.terrainRenderModeElevated()&&C&&a.push("PITCH_WITH_MAP_TERRAIN"),s&&(a.push("PROJECTION_GLOBE_VIEW"),c&&a.push("PROJECTED_POS_ON_VIEWPORT")),R>0&&o.hasAnySecondaryIcon&&a.push("ICON_TRANSITION"),!o.icon.zOffsetVertexBuffer||h&&t.terrain||a.push("Z_OFFSET"),0===y&&0===v&&0===x&&1===b||a.push("COLOR_ADJUSTMENT"),o.sdfIcons&&a.push("RENDER_SDF"),_&&a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),h&&C&&!t.terrain&&o.icon.orientationVertexBuffer&&a.push("ELEVATED_ROADS");const P=o.icon.programConfigurations.get(i.id),k=t.getOrCreateProgram("symbol",{config:P,defines:a}),B=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],H=o.iconSizeData,W=e.bH(H,A.zoom),q=C||!A.isOrthographic,X=Jt(f,r.tileID.canonical,C,S,A,o.getProjection(),p),Z=$t(f,r.tileID.canonical,C,S,A,o.getProjection(),p),Y=t.translatePosMatrix(Z,r,l,u,!0),K=t.translatePosMatrix(f,r,l,u),J=c?Go:X,Q=S&&!C&&!n;let $=z;!O&&!A.mercatorFromTransition||S||($=Ho(A));const ee=s?$:z,te=i.getColorAdjustmentMatrix(y,v,x,b),ne=Io(H.kind,W,Q,C,t,K,J,Y,w,!1,B,[0,0],0,N,d,L,U,ee,o.getProjection(),D,V,te,R,null),ie=r.imageAtlasTexture?r.imageAtlasTexture:null,re=1!==i.layout.get("icon-size").constantOr(0)||o.iconsNeedLinear,oe=o.sdfIcons||t.options.rotating||t.options.zooming||re||q?T.LINEAR:T.NEAREST,se=o.sdfIcons&&0!==i.paint.get("icon-halo-width").constantOr(1),ae=t.terrain&&C&&n?e.bi(e.bz(),X):Go;if(n&&o.icon){const e=A.elevation,n=e?e.getAtTileOffsetFunc(N,A.center.lat,A.worldSize,o.getProjection()):null,i=Qt(f,r.tileID.canonical,C,S,A,o.getProjection(),p);rn(o,f,t,!1,i,Z,C,g,n,N)}return{program:k,buffers:o.icon,uniformValues:ne,atlasTexture:ie,atlasTextureIcon:null,atlasInterpolation:oe,atlasInterpolationIcon:null,isSDF:o.sdfIcons,hasHalo:se,depthMode:I,tile:r,renderWithShadows:_,labelPlaneMatrixInv:ae}},W=()=>{const n=D&&"point"!==i.layout.get("symbol-placement"),a=[],l=n||k||E,u="road"===o.elevationType,m=t.shadowRenderer,g=u&&I&&!!m&&m.enabled,y=j(g),v=u&&I&&!t.terrain?F:M;t.terrainRenderModeElevated()&&I&&a.push("PITCH_WITH_MAP_TERRAIN"),s&&(a.push("PROJECTION_GLOBE_VIEW"),l&&a.push("PROJECTED_POS_ON_VIEWPORT")),!o.text.zOffsetVertexBuffer||u&&t.terrain||a.push("Z_OFFSET"),o.iconsInText&&a.push("RENDER_TEXT_AND_SYMBOL"),a.push("RENDER_SDF"),g&&a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),u&&I&&!t.terrain&&o.text.orientationVertexBuffer&&a.push("ELEVATED_ROADS"),G(a);const x=o.text.programConfigurations.get(i.id),b=t.getOrCreateProgram("symbol",{config:x,defines:a});let S,C=[0,0],R=null;const P=o.textSizeData;o.iconsInText&&(C=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],R=r.imageAtlasTexture?r.imageAtlasTexture:null,S=I||!A.isOrthographic||t.options.rotating||t.options.zooming||"composite"===P.kind||"camera"===P.kind?T.LINEAR:T.NEAREST);const B=r.glyphAtlasTexture?r.glyphAtlasTexture.size:[0,0],H=i.layout.get("text-size-scale-range"),W=e.ay(t.scaleFactor,H[0],H[1]),q=e.bH(P,A.zoom,W),X=Jt(f,r.tileID.canonical,I,D,A,o.getProjection(),p),Z=$t(f,r.tileID.canonical,I,D,A,o.getProjection(),p),Y=t.translatePosMatrix(Z,r,c,h,!0),K=t.translatePosMatrix(f,r,c,h),J=l?Go:X,Q=D&&!I&&!n;let $=z;!O&&!A.mercatorFromTransition||D||($=Ho(A));const ee=Io(P.kind,q,Q,I,t,K,J,Y,w,!0,B,C,0,N,d,L,U,s?$:z,o.getProjection(),y,V,null,null,W),te=r.glyphAtlasTexture?r.glyphAtlasTexture:null,ne=T.LINEAR,ie=0!==i.paint.get("text-halo-width").constantOr(1),re=t.terrain&&I&&n?e.bi(e.bz(),X):Go;if(n&&o.text){const e=A.elevation,n=e?e.getAtTileOffsetFunc(N,A.center.lat,A.worldSize,o.getProjection()):null,i=Qt(f,r.tileID.canonical,I,D,A,o.getProjection(),p);rn(o,f,t,!0,i,Z,I,_,n,N)}return{program:b,buffers:o.text,uniformValues:ee,atlasTexture:te,atlasTextureIcon:R,atlasInterpolation:ne,atlasInterpolationIcon:S,isSDF:!0,hasHalo:ie,depthMode:v,tile:r,renderWithShadows:g,labelPlaneMatrixInv:re}},q=o.icon.segments.get().length,X=o.text.segments.get().length,Z=q&&!a.onlyText?H():null,Y=X&&!a.onlyIcons?W():null,K=i.paint.get("icon-opacity").constantOr(1),J=i.paint.get("text-opacity").constantOr(1);if(R&&o.canOverlap){P=!0;const t=K&&!a.onlyText?o.icon.segments.get():[],n=J&&!a.onlyIcons?o.text.segments.get():[];for(const i of t)B.push({segments:new e.bd([i]),sortKey:i.sortKey,state:Z});for(const i of n)B.push({segments:new e.bd([i]),sortKey:i.sortKey,state:Y})}else a.onlyText||B.push({segments:K?o.icon.segments:new e.bd([]),sortKey:0,state:Z}),a.onlyIcons||B.push({segments:J?o.text.segments:new e.bd([]),sortKey:0,state:Y})}P&&B.sort((e,t)=>e.sortKey-t.sortKey);for(const e of B){const n=e.state;if(n)if(t.terrain?t.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:A.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:n.labelPlaneMatrixInv}):t.setupDepthForOcclusion(A.depthOcclusionForSymbolsAndCircles,n.program),E.activeTexture.set(T.TEXTURE0),n.atlasTexture&&n.atlasTexture.bind(n.atlasInterpolation,T.CLAMP_TO_EDGE,!0),n.atlasTextureIcon&&(E.activeTexture.set(T.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,T.CLAMP_TO_EDGE,!0)),n.renderWithShadows&&t.shadowRenderer.setupShadows(n.tile.tileID.toUnwrapped(),n.program,"vector-tile"),t.uploadCommonLightUniforms(t.context,n.program),n.hasHalo){const r=n.uniformValues;r.u_is_halo=1,Zo(n.buffers,e.segments,i,t,n.program,n.depthMode,o,s,r,2),r.u_is_halo=0}else{if(n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,Zo(n.buffers,e.segments,i,t,n.program,n.depthMode,o,s,r,1)),r.u_is_halo=0}Zo(n.buffers,e.segments,i,t,n.program,n.depthMode,o,s,n.uniformValues,1)}}}function Zo(e,t,n,i,r,o,s,a,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer,e.orientationVertexBuffer];r.draw(i,i.context.gl.TRIANGLES,o,s,a,Zn.disabled,l,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,i.transform.zoom,e.programConfigurations.get(n.id),u,c)}function Yo(t,n){const i=1<<t.canonical.z,r=(n.x*i-t.canonical.x-t.wrap*i)*e.aj,o=(n.y*i-t.canonical.y)*e.aj,s=e.e2(n.z,n.y);return e.d2(r,o,s)}function Ko(t,n,i,r,o){if(!i.layout||"none"===i.layout.get("fill-elevation-reference"))return;const s=t.context.gl,a=new Gn(t.context.gl.LEQUAL,Gn.ReadWrite,t.depthRangeFor3D),l=new Gn(t.context.gl.GREATER,Gn.ReadWrite,t.depthRangeFor3D),c=function(t){const n=e.cU(t.pitch);let i=.01;return t.isOrthographic&&(i=e.ai(1e-4,i,e.cZ(n>=ni?1:n/ni))),2*i}(t.transform),u=t.transform.getFreeCameraOptions().position,h="elevatedStructuresDepthReconstruct",d=t.getOrCreateProgram(h,{defines:["DEPTH_RECONSTRUCTION"]}),f=t.getOrCreateProgram(h);for(const e of r){const r=n.getTile(e),h=r.getBucket(i);if(!h)continue;const p=h.elevatedStructures;if(!p)continue;const m=h.elevationBufferData.heightRange,g=Yo(e.toUnwrapped(),u),_=t.translatePosMatrix(e.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));let y,v,x,b;if("initialize"===o){if(!m||m.min>=1||0===p.depthSegments.segments[0].primitiveLength)continue;y=ho(_,g,c,1,0),v=a,x=p.depthSegments,b=d}else if("reset"===o){if(!m||m.min>=0||0===p.maskSegments.segments[0].primitiveLength)continue;y=ho(_,g,0,0,1),v=l,x=p.maskSegments,b=d}else if("geometry"===o){if(0===p.depthSegments.segments[0].primitiveLength)continue;y=ho(_,g,c,1,0),v=a,x=p.depthSegments,b=f}b.draw(t,s.TRIANGLES,v,Wn.disabled,jn.disabled,Zn.disabled,y,i.id,p.vertexBuffer,p.indexBuffer,x,i.paint,t.transform.zoom)}}function Jo(t,n,i){const{painter:r,sourceCache:o,layer:s,coords:a,colorMode:l,elevationType:c,terrainEnabled:u,pass:h}=t,d=r.context.gl,f=s.paint.get("fill-pattern"),p=s.paint.get("fill-pattern-cross-fade"),m=f.constantOr(null);let g=c;"road"!==c||n&&!u||(g="none");const _="road"===g,y=t.painter.shadowRenderer,v=_&&!!y&&y.enabled,x=new Gn(r.context.gl.LEQUAL,Gn.ReadOnly,r.depthRangeFor3D);let b=[0,0,0];if(v){const e=r.style.directionalLight,t=r.style.ambientLight;e&&t&&(b=hi(r.style,e,t))}const w=f&&f.constantOr(1),E=(t,h)=>{let f,g,E,T,A;h?(f=w&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",E=d.LINES):(f=w?"fillPattern":"fill",E=d.TRIANGLES);for(const S of a){const a=o.getTile(S);if(w&&!a.patternsLoaded())continue;const D=a.getBucket(s);if(!D)continue;const C=n?D.elevationBufferData:D.bufferData;if(C.isEmpty())continue;r.prepareDrawTile();const I=C.programConfigurations.get(s.id),R=r.isTileAffectedByFog(S),P=[],M=[];_&&(P.push("ELEVATED_ROADS"),M.push(C.elevatedLayoutVertexBuffer)),v&&P.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),w&&(r.context.activeTexture.set(d.TEXTURE0),a.imageAtlasTexture&&a.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),I.updatePaintBuffers());let F=!1;if(m&&a.imageAtlas){const t=a.imageAtlas,n=e.dZ.from(m),i=n.getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),r=n.getSecondary(),o=t.patternPositions.get(i),s=r?t.patternPositions.get(r.scaleSelf(e.q.devicePixelRatio).toString()):null;F=!!o&&!!s,o&&I.setConstantPatternPositions(o,s)}p>0&&(F||I.getPatternTransitionVertexBuffer("fill-pattern"))&&P.push("FILL_PATTERN_TRANSITION");const L=r.getOrCreateProgram(f,{config:I,overrideFog:R,defines:P}),k=r.translatePosMatrix(S.projMatrix,a,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));v&&y.setupShadows(a.tileID.toUnwrapped(),L,"vector-tile");const O=s.paint.get("fill-emissive-strength");if(h){T=C.lineIndexBuffer,A=C.lineSegments;const e=r.terrain&&r.terrain.renderingToTexture?r.terrain.drapeBufferSize:[d.drawingBufferWidth,d.drawingBufferHeight];g="fillOutlinePattern"===f&&w?co(k,O,r,a,e,b,p):lo(k,O,e,b)}else T=C.indexBuffer,A=C.triangleSegments,g=w?ao(k,O,r,a,b,p):so(k,O,b);r.uploadCommonUniforms(r.context,L,S.toUnwrapped());let B=t;("road"===c&&!u||"offset"===c)&&(B=x),L.draw(r,E,B,i||r.stencilModeForClipping(S),l,Zn.disabled,g,s.id,C.layoutVertexBuffer,T,A,s.paint,r.transform.zoom,I,M)}};r.renderPass===h&&E(r.depthModeForSublayer(1,"opaque"===r.renderPass?Gn.ReadWrite:Gn.ReadOnly),!1),"none"===g&&"translucent"===r.renderPass&&s.paint.get("fill-antialias")&&E(r.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Gn.ReadOnly),!0)}function Qo(t,n,i,r,o,s,a,l){i.resetLayerRenderingStats(t);const c=t.context,u=c.gl,h=t.transform,d=i.paint.get("fill-extrusion-pattern"),f=i.paint.get("fill-extrusion-pattern-cross-fade"),p=d.constantOr(null),m=d.constantOr(1),g=i.paint.get("fill-extrusion-opacity"),_=t.style.enable3dLights(),y=i.paint.get(_&&!m?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),v=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),y],x=i.layout.get("fill-extrusion-edge-radius"),b=x>0&&!i.paint.get("fill-extrusion-rounded-roof"),w=b?0:x,E="globe"===h.projection.name?e.e5():0,T="globe"===h.projection.name,A=T?e.ah(h.zoom):0,S=[e.aD(h.center.lng),e.aH(h.center.lat)],D="none"===i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),C=i.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(D?null:i.lut).toArray01().slice(0,3),I=i.paint.get("fill-extrusion-flood-light-intensity"),R=i.paint.get("fill-extrusion-vertical-scale"),P=0!==i.paint.get("fill-extrusion-line-width").constantOr(1),M=i.paint.get("fill-extrusion-height-alignment"),F=i.paint.get("fill-extrusion-base-alignment"),L=ri(t,i.paint.get("fill-extrusion-cutoff-fade-range")),k=[];let O;T&&k.push("PROJECTION_GLOBE_VIEW"),v[0]>0&&k.push("FAUX_AO"),b&&k.push("ZERO_ROOF_RADIUS"),l&&k.push("HAS_CENTROID"),I>0&&k.push("FLOOD_LIGHT"),L.shouldRenderCutoff&&k.push("RENDER_CUTOFF"),P&&k.push("RENDER_WALL_MODE");const B="shadow"===t.renderPass,z=t.shadowRenderer,N=B&&!!z,U=B?Zn.disabled:Zn.backCCW;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let V=[0,0,0];if(z){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(V=hi(t.style,e,n)),B||(k.push("RENDER_SHADOWS","DEPTH_TEXTURE"),z.useNormalOffset&&k.push("NORMAL_OFFSET")),O=k.concat(["SHADOWS_SINGLE_CASCADE"])}const j=N?"fillExtrusionDepth":m?"fillExtrusionPattern":"fillExtrusion",G=i.getLayerRenderingStats();for(const H of r){const r=n.getTile(H),d=r.getBucket(i);if(!d||d.projection.name!==h.projection.name)continue;let _=!1;z&&(_=0===z.getMaxCascadeForTile(H.toUnwrapped()));const y=t.isTileAffectedByFog(H),x=d.programConfigurations.get(i.id);let b=!1;if(p&&r.imageAtlas){const t=r.imageAtlas,n=e.dZ.from(p),i=n.getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),o=n.getSecondary(),s=t.patternPositions.get(i),a=o?t.patternPositions.get(o.scaleSelf(e.q.devicePixelRatio).toString()):null;b=!!s&&!!a,s&&x.setConstantPatternPositions(s,a)}f>0&&(b||x.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&k.push("FILL_EXTRUSION_PATTERN_TRANSITION");const D=t.getOrCreateProgram(j,{config:x,defines:_?O:k,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(r,D,{useMeterToDem:!0}),!d.centroidVertexBuffer){const e=D.attributes.a_centroid_pos;void 0!==e&&u.vertexAttrib2f(e,0,0)}!B&&z&&z.setupShadows(r.tileID.toUnwrapped(),D,"vector-tile"),m&&(t.context.activeTexture.set(u.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),x.updatePaintBuffers());const N=i.paint.get("fill-extrusion-vertical-gradient"),W=1/d.tileToMeter;let q;if(B&&z){if(os(r.tileID,d.maxHeight,t))continue;const e=z.calculateShadowPassMatrixFromTile(r.tileID.toUnwrapped());q=ro(e,w,W,R,M,F)}else{const e=t.translatePosMatrix(H.expandedProjMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),n=h.projection.createInversionMatrix(h,H.canonical);q=m?oo(e,t,N,g,v,w,W,H,r,E,M,F,A,S,n,C,R,f):io(e,t,N,g,v,w,W,H,E,M,F,A,S,n,C,R,I,V)}t.uploadCommonUniforms(c,D,H.toUnwrapped(),null,L);let X=d.segments;if("mercator"===h.projection.name&&!B&&(X=d.getVisibleSegments(r.tileID,t.terrain,t.transform.getFrustum(0)),!X.get().length))continue;if(G)if(B)for(const e of X.get())G.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of X.get())G.numRenderedVerticesInTransparentPass+=e.primitiveLength;const Z=[];(t.terrain||l)&&Z.push(d.centroidVertexBuffer),T&&Z.push(d.layoutVertexExtBuffer),P&&Z.push(d.wallVertexBuffer),D.draw(t,c.gl.TRIANGLES,o,s,a,U,q,i.id,d.layoutVertexBuffer,d.indexBuffer,X,i.paint,t.transform.zoom,x,Z)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}class $o{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function es(t,n,i,r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x){const b=n.context,w=b.gl,E=n.transform,T=n.transform.zoom,A=[],S=t.translate,D=t.translateAnchor,C=t.edgeRadius,I=ri(n,t.cutoffFadeRange);"clear"===h?(A.push("CLEAR_SUBPASS"),x&&(A.push("CLEAR_FROM_TEXTURE"),b.activeTexture.set(w.TEXTURE0),x.bind(w.LINEAR,w.CLAMP_TO_EDGE))):"sdf"===h&&A.push("SDF_SUBPASS"),y&&A.push("HAS_CENTROID"),I.shouldRenderCutoff&&A.push("RENDER_CUTOFF");const R=(e,t,i,o,h)=>{const v=t.programConfigurations.get(r.id),w=n.isTileAffectedByFog(e),E=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:v,defines:A,overrideFog:w}),S=((e,t,n,i,r,o,s,a,l,c,u)=>({u_matrix:t,u_opacity:n,u_ao_pass:i?1:0,u_meter_to_tile:r,u_ao:o,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u,u_dynamic_offset:1}))(0,o,d,u,h,[f,p*h],m,g,_,T>=17?0:C*h,x?x.size[0]:0),D=[];y&&D.push(t.hiddenByLandmarkVertexBuffer),n.uploadCommonUniforms(b,E,e.toUnwrapped(),null,I),E.draw(n,b.gl.TRIANGLES,s,a,l,c,S,r.id,t.vertexBuffer,t.indexBuffer,i,r.paint,T,v,D)};for(const P of o){const t=i.getTile(P),o=t.getBucket(r);if(!o||o.projection.name!==E.projection.name||!o.groundEffect||o.groundEffect&&!o.groundEffect.hasData())continue;const s=o.groundEffect,a=1/o.tileToMeter;{const e=n.translatePosMatrix(P.projMatrix,t,S,D),i=s.getDefaultSegment();R(P,s,i,e,a)}if(v)for(let l=0;l<4;l++){const o=e.e3[l](P),s=i.getTile(o);if(!s)continue;const c=s.getBucket(r);if(!c||c.projection.name!==E.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const u=c.groundEffect;let h,d;0===l?(h=[-e.aj,0,0],d=1):1===l?(h=[e.aj,0,0],d=0):2===l?(h=[0,-e.aj,0],d=3):(h=[0,e.aj,0],d=2);const f=u.regionSegments[d];if(!f)continue;const p=new Float32Array(16);e.bo(p,P.projMatrix,h),R(P,u,f,n.translatePosMatrix(p,t,S,D),a)}}}function ts(t,n,i,r,o,s,a){0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const l=s?s.findDEMTileFor(i):null;if(!(l&&l.dem||a))return;s&&l&&l.dem&&r.selfDEMTileTimestamp!==l.dem._timestamp&&(r.borderDoneWithNeighborZ=[-1,-1,-1,-1],r.selfDEMTileTimestamp=l.dem._timestamp);const c=t=>new e.P(Math.ceil((t+e.e7)*e.e8),0),u=e=>{const t=n.getSource().minzoom,i=e=>{const t=n.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},r=[0,-1,1];for(const n of r){if(e.overscaledZ+n<t)continue;const r=i(e.calculateScaledKey(e.overscaledZ+n));if(r)return r}},h=[0,0,0],d=(t,n)=>(h[0]=Math.min(t.min.y,n.min.y),h[1]=Math.max(t.max.y,n.max.y),h[2]=e.aj-n.min.x>t.max.x?n.min.x-e.aj:t.max.x,h),f=(t,n)=>(h[0]=Math.min(t.min.x,n.min.x),h[1]=Math.max(t.max.x,n.max.x),h[2]=e.aj-n.min.y>t.max.y?n.min.y-e.aj:t.max.y,h),p=[(e,t)=>d(e,t),(e,t)=>d(t,e),(e,t)=>f(e,t),(e,t)=>f(t,e)],m=(t,n,r,o,a,c,u)=>{if(!s)return 0;const h=[[c?r:t,c?t:r,0],[c?r:n,c?n:r,0]],d=u<0?e.aj+u:u,f=[c?d:(t+n)/2,c?(t+n)/2:d,0];return 0===r&&u<0||0!==r&&u>0?s.getForTilePoints(a,[f],!0,o):h.push(f),s.getForTilePoints(i,h,!0,l),Math.max(h[0][2],h[1][2],f[2])/s.exaggeration()};for(let y=0;y<4;y++){const t=r.borderFeatureIndices[y];if(0===t.length)continue;const n=e.e3[y](i),o=u(n);if(!(o&&o instanceof e.e4))continue;const l=s?s.findDEMTileFor(n):null;if(!(l&&l.dem||a))continue;if(s&&l&&l.dem&&r.borderDEMTileTimestamp[y]!==l.dem._timestamp&&(r.borderDoneWithNeighborZ[y]=-1,r.borderDEMTileTimestamp[y]=l.dem._timestamp),r.borderDoneWithNeighborZ[y]===o.canonical.z)continue;0===o.centroidVertexArray.length&&o.createCentroidsBuffer();const h=(y<2?1:5)-y,d=o.borderDoneWithNeighborZ[h]!==r.canonical.z,f=o.borderFeatureIndices[h];let v=0;if(r.canonical.z!==o.canonical.z){for(const e of t)r.showCentroid(r.featuresOnBorder[e]);if(d)for(const e of f)o.showCentroid(o.featuresOnBorder[e]);r.borderDoneWithNeighborZ[y]=o.canonical.z,o.borderDoneWithNeighborZ[h]=r.canonical.z}for(const i of t){const t=r.featuresOnBorder[i],s=r.centroidData[t.centroidDataIndex],u=t.borders[y];let d;for(;v<f.length;){d=o.featuresOnBorder[f[v]];const e=d.borders[h];if(e[1]>u[0]+3||e[0]>u[0]-3)break;o.showCentroid(d),v++}if(d&&v<f.length){const i=v;let x=0;for(;!(d.borders[h][0]>u[1]-3)&&(x++,++v!==f.length);)d=o.featuresOnBorder[f[v]];d=o.featuresOnBorder[f[i]];let b=!1;if(x>=1){const e=d.borders[h];Math.abs(u[0]-e[0])<3&&Math.abs(u[1]-e[1])<3&&(x=1,b=!0,v=i+1)}else if(0===x){r.showCentroid(t);continue}const w=o.centroidData[d.centroidDataIndex];a&&b&&(((g=s).flags|(_=w).flags)&e.e6?(g.flags|=e.e6,_.flags|=e.e6):(g.flags&=~e.e6,_.flags&=~e.e6));const E=t.intersectsCount()>1||d.intersectsCount()>1;if(x>1)v=i,s.centroidXY=w.centroidXY=new e.P(0,0);else if(l&&l.dem&&!E){const t=p[y](s,w),i=y%2?e.aj-1:0,r=m(t[0],Math.min(e.aj-1,t[1]),i,l,n,y<2,t[2]);s.centroidXY=w.centroidXY=c(r)}else E?s.centroidXY=w.centroidXY=new e.P(0,0):(s.centroidXY=r.encodeBorderCentroid(t),w.centroidXY=o.encodeBorderCentroid(d));r.writeCentroidToBuffer(s),o.writeCentroidToBuffer(w)}else r.showCentroid(t)}r.borderDoneWithNeighborZ[y]=o.canonical.z,o.borderDoneWithNeighborZ[h]=r.canonical.z}var g,_;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const ns=[1,0,0],is=[0,1,0],rs=[0,0,1];function os(t,n,i){const r=i.transform,o=i.shadowRenderer;if(!o)return!0;const s=t.toUnwrapped(),a=r.tileSize*o._cascades[i.currentShadowCascade].scale;let l=n;if(r.elevation){const e=r.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...o.shadowDirection];c[2]=-c[2];const u=o.computeSimplifiedTileShadowVolume(s,l,a,c);if(!u)return!1;const h=[ns,is,rs,c,[c[0],0,c[2]],[0,c[1],c[2]]],d="globe"===r.projection.name,f=r.scaleZoom(a),p=e.cy.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,f,!d),m=o.getCurrentCascadeFrustum();return 0===p.intersectsPrecise(u.vertices,u.planes,h)||0===m.intersectsPrecise(u.vertices,u.planes,h)}function ss(t){const{painter:n,source:i,layer:r,coords:o}=t,s=t.defines,a=n.context,l="shadow"===n.renderPass,c="light-beam"===n.renderPass,u=n.shadowRenderer;let h;u&&(h=s.concat(["SHADOWS_SINGLE_CASCADE"]));const d=e.e9(n.transform.center.lat,n.transform.zoom);for(const f of o){const o=i.getTile(f),p=o.getBucket(r);if(!p)continue;let m=!1;u&&(m=0===u.getMaxCascadeForTile(f.toUnwrapped()));const g=p.programConfigurations.get(r.id);let _,y,v=n.translatePosMatrix(f.expandedProjMatrix,o,[0,0],"map");if(v=e.cP(e.bz(),v,[1,1,t.verticalScale]),l&&u){if(os(o.tileID,p.maxHeight*d,n))continue;let i=u.calculateShadowPassMatrixFromTile(o.tileID.toUnwrapped());i=e.cP(e.bz(),i,[1,1,t.verticalScale]),y=mo(i),_=n.getOrCreateProgram("buildingDepth",{config:g,defines:m?h:s,overrideFog:!1})}else if(c)_=n.getOrCreateProgram("buildingBloom",{config:g,defines:m?h:s,overrideFog:!1}),y=po(v);else{const i=n.transform.calculatePosMatrix(f.toUnwrapped(),n.transform.worldSize);e.cP(i,i,[1,1,t.verticalScale]);const r=e.bz();e.cP(r,i,[1,-1,1/d]),e.bi(r,r),e.ea(r,r),y=fo(v,r),_=n.getOrCreateProgram("building",{config:g,defines:m?h:s,overrideFog:!1}),u&&u.setupShadowsFromMatrix(i,_,!0)}if(n.uploadCommonUniforms(a,_,f.toUnwrapped(),null,null),c){const e=p.bloomGeometry;_.draw(n,a.gl.TRIANGLES,t.depthMode,Wn.disabled,t.blendMode,Zn.disabled,y,r.id,e.layoutVertexBuffer,e.indexBuffer,e.segmentsBucket,r.paint,n.transform.zoom,g,[e.layoutAttenuationBuffer,e.layoutColorBuffer])}else _.draw(n,a.gl.TRIANGLES,t.depthMode,Wn.disabled,t.blendMode,l?Zn.disabled:Zn.backCW,y,r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,r.paint,n.transform.zoom,g,[p.layoutNormalBuffer,p.layoutColorBuffer])}}function as(t){return[t[0]*e.eb,t[1]*e.eb,t[2]*e.eb,0]}function ls(t,n,i,r,o,s,a,l,c){const u=r.getSource(),h=i.globeSharedBuffers;if(!h)return;let d,f,p;if(n&&(d=r.getTile(n)),u instanceof e.aP?(f=u.texture,p=e.dE(0,0,i.transform)):d&&n&&(f=d.texture,p=e.dE(n.canonical.z,n.canonical.x,i.transform)),!f||!p)return;t||(p=e.cP(e.bz(),p,[1,-1,1]));const m=i.context,g=m.gl,_="nearest"===o.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,y=i.colorModeForDrapableLayerRenderPass(s),v=a.defines;v.push("GLOBE_POLES");const x=new Gn(g.LEQUAL,Gn.ReadWrite,i.depthRangeFor3D),b=Float32Array.from(i.transform.expandedFarZProjMatrix),w=Float32Array.from(e.bh(e.dD(new e.cA(0,0,0))));i.terrain&&i.terrain.prepareDrawTile(),m.activeTexture.set(g.TEXTURE0),f.bind(_,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE1),f.bind(_,g.CLAMP_TO_EDGE),"useMipmap"in f&&m.extTextureFilterAnisotropic&&i.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax);const[E,T,A,S]=n?h.getPoleBuffers(n.canonical.z,!1):h.getPoleBuffers(0,!0),D=o.paint.get("raster-elevation");let C;t?(C=E,i.renderDefaultNorthPole=0!==D):(C=T,i.renderDefaultSouthPole=0!==D);const I=as(a.mix),R=((e,t,n,i,r,o,s,a,l,c,u,h,d)=>wo(e,t,n,new Float32Array(16),new Float32Array(9),[0,0],i,[0,0],[0,0,0,0],1,{opacity:1,mix:0},o,[0,0]||0,a,2,c,u,h,1,0,d))(b,w,p,e.ah(i.transform.zoom),0,o,0,D,0,I,a.offset,a.range,s),P=i.getOrCreateProgram("raster",{defines:v});i.uploadCommonUniforms(m,P,null),P.draw(i,g.TRIANGLES,x,c,y,l,R,o.id,C,A,S)}function cs(e){const t=e._nearZ,n=e.projection.farthestPixelDistance(e),i=n-t,r=.2*e.height,o=t+r;return[t,n,(o-r-t)/i,(o-t)/i]}function us(e,t,n,i){if(e)return t instanceof at&&e instanceof St?t.getTextureDescriptor(e,n,!0):{texture:e.texture,mix:as(i.mix),offset:i.offset,buffer:0,tileSize:1}}var hs=e.ec([{name:"a_index",type:"Int16",components:1}]);class ds{constructor(t,n,i,r){const o={width:i[0],height:i[1],data:null},s=t.gl;this.targetColorTexture=new e.T(t,o,s.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,o,s.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,r),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const i=this.context.gl,r=n.width*n.height;this.particleTexture0=new e.T(this.context,n,i.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,n,i.RGBA8,{premultiply:!1,useMipmap:!1});const o=new e.ed;o.reserve(r);for(let e=0;e<r;e++)o.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(o,hs.members,!0),this.particleSegment=e.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function fs(t,n,i){if(!t)return null;const r=n.getTextureDescriptor(t,i,!0);if(!r)return null;let{texture:o,mix:s,offset:a,tileSize:l,buffer:c,format:u}=r;if(!o||!u)return null;let h=!1;return"uint32"===u&&(h=!0,s[3]=0,s=xo(e.ee,s,[0,i.paint.get("raster-particle-max-speed")]),a=bo(e.ee,a,[0,i.paint.get("raster-particle-max-speed")])),{texture:o,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:h,scale:s,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function ps(e){const t=e._nearZ,n=e.projection.farthestPixelDistance(e),i=n-t,r=.2*e.height,o=t+r;return[t,n,(o-r-t)/i,(o-t)/i]}const ms=new e.am(1,0,0,1),gs=new e.am(0,1,0,1),_s=new e.am(0,0,1,1),ys=new e.am(1,0,1,1),vs=new e.am(0,1,1,1);function xs(t,n,i,r,o,s){for(let a=0;a<i.length;a++)if(o){const o=1,l=.8,c=new e.am(r.r*l,r.g*l,r.b*l,1);bs(t,n,i[a],r,-o,-o,s),bs(t,n,i[a],r,-o,o,s),bs(t,n,i[a],r,o,o,s),bs(t,n,i[a],r,o,-o,s),bs(t,n,i[a],c,0,0,s)}else bs(t,n,i[a],r,0,0,s)}function bs(t,n,i,r,o,s,a){const l=t.context,c=t.transform,u=l.gl,h="globe"===c.projection.name,d=h?["PROJECTION_GLOBE_VIEW"]:[];let f=e.bw(i.projMatrix);if(h&&e.ah(c.zoom)>0){const t=e.bg(i.canonical,c),n=e.ef(t);f=e.az(new Float32Array(16),c.globeMatrix,n),e.az(f,c.projMatrix,f)}const p=e.bz();p[12]+=2*o/(e.q.devicePixelRatio*c.width),p[13]+=2*s/(e.q.devicePixelRatio*c.height),e.az(f,p,f);const m=t.getOrCreateProgram("debug",{defines:d}),g=n.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(g,m);const _=Gn.disabled,y=Wn.disabled,v=t.colorModeForRenderPass(),x="$debug";l.activeTexture.set(u.TEXTURE0),t.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),h?g._makeGlobeTileDebugBuffers(t.context,c):g._makeDebugTileBoundsBuffers(t.context,c.projection);const b=g._tileDebugBuffer||t.debugBuffer,w=g._tileDebugIndexBuffer||t.debugIndexBuffer,E=g._tileDebugSegments||t.debugSegments;if(m.draw(t,u.LINE_STRIP,_,y,v,Zn.disabled,_o(f,r.toPremultipliedRenderColor(null)),x,b,w,E,null,null,null,[g._globeTileDebugBorderBuffer]),a){const e=g.latestRawTileData,n=Math.floor((e&&e.byteLength||0)/1024);let r=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(r+=" => ".concat(i.overscaledZ)),r+=" ".concat(g.state),r+=" ".concat(n,"kb"),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,i=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(t,r)}const T=n.getTile(i).tileSize,A=512/Math.min(T,512)*(i.overscaledZ/c.zoom)*.5,S=g._tileDebugTextBuffer||t.debugBuffer,D=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,C=g._tileDebugTextSegments||t.debugSegments;m.draw(t,u.TRIANGLES,_,y,jn.alphaBlended,Zn.disabled,_o(f,e.am.transparent.toPremultipliedRenderColor(null),A),x,S,D,C,null,null,null,[g._globeTileDebugTextBuffer])}function ws(e,t,n,i){Ts(e,0,t+n/2,e.transform.width,n,i)}function Es(e,t,n,i){Ts(e,t-n/2,0,n,e.transform.height,i)}function Ts(t,n,i,r,o,s){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(n*e.q.devicePixelRatio,i*e.q.devicePixelRatio,r*e.q.devicePixelRatio,o*e.q.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}const As=e.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ss}=As;function Ds(e,t,n,i){e.emplaceBack(t,n,i)}class Cs{constructor(t){this.vertexArray=new e.eg,this.indices=new e.a_,Ds(this.vertexArray,-1,-1,1),Ds(this.vertexArray,1,-1,1),Ds(this.vertexArray,-1,1,1),Ds(this.vertexArray,1,1,1),Ds(this.vertexArray,-1,-1,-1),Ds(this.vertexArray,1,-1,-1),Ds(this.vertexArray,-1,1,-1),Ds(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Ss),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.bd.simpleSegment(0,0,36,12)}}function Is(t,n,i,r,o,s){const a=t.context.gl,l=n.paint.get("sky-atmosphere-color"),c=n.paint.get("sky-atmosphere-halo-color"),u=n.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,n,i,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[i.r,i.g,i.b,i.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(e.ei(e.dJ(),r),o,u,l.toPremultipliedRenderColor(null),c.toPremultipliedRenderColor(null));a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,n.skyboxTexture,0),i.draw(t,a.TRIANGLES,Gn.disabled,Wn.disabled,jn.unblended,Zn.frontCW,h,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Rs=e.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ps{constructor(t){const n=new e.ej;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const i=new e.a_;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,Rs.members),this.indexBuffer=t.createIndexBuffer(i),this.segments=e.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ms=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Fs{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ls{constructor(t){this.colorModeAlphaBlendedWriteRGB=new jn([1,Vn,1,Vn],e.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new jn([1,0,1,0],e.am.transparent,[!1,!1,!1,!0]),this.params=new Fs,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ps(n);const t=this.params.sizeRange,i=this.params.intensityRange,r=function(t){const n=e.el(30),i=[];for(let r=0;r<t;++r){const t=2*Math.PI*n(),r=Math.acos(1-2*n())-.5*Math.PI;i.push(e.d2(Math.cos(r)*Math.cos(t),Math.cos(r)*Math.sin(t),Math.sin(r)))}return i}(this.params.starsCount),o=e.el(300),s=new e.ek,a=new e.a_;let l=0;for(let n=0;n<r.length;++n){const c=e.c1([],r[n],200),u=Math.max(0,1+.01*t*(1*o()-.5)),h=Math.max(0,1+.01*i*(1*o()-.5));s.emplaceBack(c[0],c[1],c[2],-1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,1,u,h),s.emplaceBack(c[0],c[1],c[2],-1,1,u,h),a.emplaceBack(l+0,l+1,l+2),a.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=n.createVertexBuffer(s,Ms.members),this.starsIdx=n.createIndexBuffer(a),this.starsSegments=e.bd.simpleSegment(0,0,s.length,a.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const i=t.context,r=i.gl,o=t.transform,s=new Gn(r.LEQUAL,Gn.ReadOnly,[0,1]),a=e.ah(o.zoom),l=t.style.getLut(n.scope),c="none"===n.properties.get("color-use-theme"),u=n.properties.get("color").toNonPremultipliedRenderColor(c?null:l).toArray01(),h="none"===n.properties.get("high-color-use-theme"),d=n.properties.get("high-color").toNonPremultipliedRenderColor(h?null:l).toArray01(),f="none"===n.properties.get("space-color-use-theme"),p=n.properties.get("space-color").toNonPremultipliedRenderColor(f?null:l).toArray01(),m=5e-4,g=e.em(n.properties.get("horizon-blend"),0,1,m,.25),_=e.dy(t,i,o)&&g===m?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,y=t.frameCounter/1e3%1,v=e.ae(o.globeCenterInViewSpace),x=Math.sqrt(Math.pow(v,2)-Math.pow(_,2)),b=Math.acos(x/v),w=e=>{const n="globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&n.push("ALPHA_PASS");const l=t.getOrCreateProgram("globeAtmosphere",{defines:n}),c=((e,t,n,i,r,o,s,a,l,c,u,h)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:n,u_frustum_bl:i,u_horizon:r,u_transition:o,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,a,g,u,d,p,y,b);t.uploadCommonUniforms(i,l);const h=this.atmosphereBuffer;h&&l.draw(t,r.TRIANGLES,s,Wn.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Zn.backCW,c,e?"atmosphere_glow_alpha":"atmosphere_glow",h.vertexBuffer,h.indexBuffer,h.segments)};w(!1),w(!0)}drawStars(t,n){const i=e.ay(n.properties.get("star-intensity"),0,1);if(0===i)return;const r=t.context,o=r.gl,s=t.transform,a=t.getOrCreateProgram("stars"),l=e.c3([]);e.c5(l,l,-s._pitch),e.c4(l,l,-s.angle),e.c5(l,l,e.al(s._center.lat)),e.en(l,l,-e.al(s._center.lng));const c=e.c8(new Float32Array(16),l),u=e.az([],s.starsProjMatrix,c),h=e.ei([],c),d=e.eo([],h),f=[0,1,0];e.dL(f,f,d),e.c1(f,f,this.params.sizeMultiplier);const p=[1,0,0];e.dL(p,p,d),e.c1(p,p,this.params.sizeMultiplier);const m=(g=f,_=p,y=i,{u_matrix:Float32Array.from(u),u_up:g,u_right:_,u_intensity_multiplier:y});var g,_,y;t.uploadCommonUniforms(r,a),this.starsVx&&this.starsIdx&&a.draw(t,o.TRIANGLES,Gn.disabled,Wn.disabled,this.colorModeAlphaBlendedWriteRGB,Zn.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class ks{constructor(){this.visibleTiles=[]}updateBorders(t,n){const i=[],r=[],o=t._getRenderableCoordinates(!1,!0);for(const e of o){const o=t.getTile(e);if(!o.hasData())continue;const s=o.getBucket(n);s&&(s.isEmpty()||(i.push(e.key),r.push({bucket:s,tileID:e.canonical})))}let s=i.length!==this.visibleTiles.length;if(!s){i.sort();for(let e=0;e<i.length;e++)if(i[e]!==this.visibleTiles[e]){s=!0;break}}if(!s)return;const a=new Set;this.visibleTiles=i,r.sort((e,t)=>e.tileID.z-t.tileID.z||e.tileID.x-t.tileID.x||e.tileID.y-t.tileID.y);for(const l of r){const t=new Array,n=new Array,i=l.bucket;for(const e of i.featuresOnBorder)a.has(e.featureId)?n.push(e.footprintIndex):(a.add(e.featureId),t.push(e.footprintIndex));i.updateFootprintHiddenFlags(t,e.ep,!1),i.updateFootprintHiddenFlags(n,e.ep,!0)}}}function Os(t,n){const i=[...t],r=n.cameraWorldSizeForFog/n.worldSize,o=e.bx([]);return e.cP(o,o,[r,r,1]),e.az(i,o,i),e.az(i,n.worldToFogMatrix,i),i}function Bs(t,n,i,r,o){const s=i.material,a=r.context,{baseColorTexture:l,metallicRoughnessTexture:c}=s.pbrMetallicRoughness,{normalTexture:u,occlusionTexture:h,emissionTexture:d}=s;function f(e,n,i){if(e&&(t.push(n),a.activeTexture.set(a.gl.TEXTURE0+i),e.gfxTexture)){const{minFilter:t,magFilter:n,wrapS:i,wrapT:r}=e.sampler;e.gfxTexture.bindExtraParam(t,n,i,r)}}f(l,"HAS_TEXTURE_u_baseColorTexture",ei.BaseColor),f(c,"HAS_TEXTURE_u_metallicRoughnessTexture",ei.MetallicRoughness),f(u,"HAS_TEXTURE_u_normalTexture",ei.Normal),f(h,"HAS_TEXTURE_u_occlusionTexture",ei.Occlusion),f(d,"HAS_TEXTURE_u_emissionTexture",ei.Emission),o&&(o.texture||(o.texture=new e.et(r.context,o.image,[o.image.height,o.image.height,o.image.height],a.gl.RGBA8)),a.activeTexture.set(a.gl.TEXTURE0+ei.LUT),o.texture&&o.texture.bind(a.gl.LINEAR,a.gl.CLAMP_TO_EDGE),t.push("APPLY_LUT_ON_GPU")),i.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(i.texcoordBuffer)),i.colorBuffer&&(t.push(12===i.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(i.colorBuffer)),i.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(i.normalBuffer)),i.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(i.pbrBuffer)),"OPAQUE"!==s.alphaMode&&"MASK"!==s.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),s.defined||t.push("DIFFUSE_SHADED");const p=r.shadowRenderer;p&&(t.push("RENDER_SHADOWS","DEPTH_TEXTURE"),p.useNormalOffset&&t.push("NORMAL_OFFSET"))}function zs(t,n,i,r,o,s){const a=i.paint.get("model-opacity").constantOr(1),l=n.context,c=new Gn(n.context.gl.LEQUAL,Gn.ReadWrite,n.depthRangeFor3D),u=n.transform,h=t.mesh,d=h.material,f=d.pbrMetallicRoughness,p=n.style.fog;let m;m="pixels"===n.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.az([],r.zScaleMatrix,t.nodeModelMatrix),e.az(m,r.negCameraPosMatrix,m);const g=e.bi([],m);e.ea(g,g);const _="none"===i.paint.get("model-color-use-theme").constantOr("default"),y=i.paint.get("model-emissive-strength").constantOr(0),v=Fo(new Float32Array(t.worldViewProjection),new Float32Array(m),new Float32Array(g),null,n,a,f.baseColorFactor,d.emissiveFactor,f.metallicFactor,f.roughnessFactor,d,y,i),x={defines:[]},b=[],w=n.shadowRenderer;w&&(w.useNormalOffset=!1),Bs(x.defines,b,h,n,_?null:i.lut);let E=null;if(p){const e=Os(t.nodeModelMatrix,n.transform);if(E=new Float32Array(e),"globe"!==u.projection.name){const t=h.aabb.min,n=h.aabb.max,[i,r]=p.getOpacityForBounds(e,t[0],t[1],n[0],n[1]);x.overrideFog=i>=Ne||r>=Ne}}const T=ri(n,i.paint.get("model-cutoff-fade-range"));T.shouldRenderCutoff&&x.defines.push("RENDER_CUTOFF");const A=n.getOrCreateProgram("model",x);n.uploadCommonUniforms(l,A,null,E,T),"shadow"!==n.renderPass&&w&&w.setupShadowsFromMatrix(t.nodeModelMatrix,A),A.draw(n,l.gl.TRIANGLES,c,o,s,h.material.doubleSided?Zn.disabled:Zn.backCCW,v,i.id,h.vertexBuffer,h.indexBuffer,h.segments,i.paint,n.transform.zoom,void 0,b)}function Ns(t,n,i,r,o,s,a){let l;l="globe"===t.projection.name?e.er(i,t):[...i],e.az(l,l,n.matrix);const c=e.az([],r,l);if(n.meshes)for(const u of n.meshes){if("BLEND"!==u.material.alphaMode){a.push({mesh:u,depth:0,modelIndex:o,worldViewProjection:c,nodeModelMatrix:l});continue}const n=e.ad([],u.centroid,c);!t.isOrthographic&&n[2]<=0||s.push({mesh:u,depth:n[2],modelIndex:o,worldViewProjection:c,nodeModelMatrix:l})}if(n.children)for(const e of n.children)Ns(t,e,i,r,o,s,a)}function Us(e,t,n,i){const r=n.shadowRenderer;if(!r)return;const o=r.getShadowPassDepthMode(),s=r.getShadowPassColorMode(),a=r.calculateShadowPassMatrixFromMatrix(t),l=Lo(a);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,o,Wn.disabled,s,Zn.backCCW,l,i.id,e.vertexBuffer,e.indexBuffer,e.segments,i.paint,n.transform.zoom,void 0,void 0)}function Vs(t,n,i){const r=n.updateZoomBasedPaintProperties(),o=function(t,n,i){let r,o,s,a=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&a>0){const n=t.terrain,o=n.findDEMTileFor(i);o&&o.dem?r=e.eu.create(n,i,o):a=0}if(0===a&&(n.terrainElevationMin=0,n.terrainElevationMax=0),a===n.validForExaggeration&&(0===a||r&&r._demTile&&r._demTile.tileID===n.validForDEMTile.id&&r._dem._timestamp===n.validForDEMTile.timestamp))return!1;for(const e in n.instancesPerModel){const t=n.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const i=(r?a*r.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=i,o=o?Math.min(n.terrainElevationMin,i):i,s=s?Math.max(n.terrainElevationMax,i):i}}return n.terrainElevationMin=o||0,n.terrainElevationMax=s||0,n.validForExaggeration=a,n.validForDEMTile=r&&r._demTile?{id:r._demTile.tileID,timestamp:r._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,n,i);(r||o)&&(n.uploaded=!1,n.upload(t.context))}const js={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.d6([0,0,0],[e.aj,e.aj,0])};function Gs(t,n){const i=1<<t.canonical.z,r=n.getFreeCameraOptions().position,o=n.elevation,s=t.canonical.x/i,a=(t.canonical.x+1)/i,l=t.canonical.y/i,c=(t.canonical.y+1)/i;let u=n._centerAltitude;if(o){const e=o.getMinMaxForTile(t);e&&e.max>u&&(u=e.max)}const h=e.ay(r.x,s,a)-r.x,d=e.ay(r.y,l,c)-r.y,f=e.cb(u,n.center.lat)-r.z;return n._zoomFromMercatorZ(Math.sqrt(h*h+d*d+f*f))}function Hs(e,t,n,i,r,o,s){const a=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new Gn(a.gl.LEQUAL,Gn.ReadWrite,e.depthRangeFor3D),h=e.isTileAffectedByFog(o);if(n.meshes)for(const d of n.meshes){const f=["MODEL_POSITION_ON_GPU"],p=[];let m,g,_;i.instancedDataArray.length>20&&f.push("INSTANCED_ARRAYS");const y=ri(e,t.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&f.push("RENDER_CUTOFF"),l&&c)m=e.getOrCreateProgram("modelDepth",{defines:f}),g=Lo(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(n.matrix)),_=c.getShadowPassColorMode();else{Bs(f,p,d,e,"none"===t.paint.get("model-color-use-theme").constantOr("default")?null:t.lut),m=e.getOrCreateProgram("model",{defines:f,overrideFog:h});const i=d.material,l=i.pbrMetallicRoughness,u=t.paint.get("model-opacity").constantOr(1),v=t.paint.get("model-emissive-strength").constantOr(0);g=Fo(o.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,e,u,l.baseColorFactor,i.emissiveFactor,l.metallicFactor,l.roughnessFactor,i,v,t,r),c&&(s.shadowUniformsInitialized?m.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),m,"model-tile"),s.shadowUniformsInitialized=!0)),_=y.shouldRenderCutoff||u<1||"OPAQUE"!==i.alphaMode?jn.alphaBlended:jn.unblended}e.uploadCommonUniforms(a,m,o.toUnwrapped(),null,y);const v=d.material.doubleSided?Zn.disabled:Zn.backCCW;if(i.instancedDataArray.length>20)p.push(i.instancedDataBuffer),m.draw(e,a.gl.TRIANGLES,u,Wn.disabled,_,v,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,p,i.instancedDataArray.length);else{const n=l?"u_instance":"u_normal_matrix";for(let r=0;r<i.instancedDataArray.length;++r)g[n]=new Float32Array(i.instancedDataArray.arrayBuffer,64*r,16),m.draw(e,a.gl.TRIANGLES,u,Wn.disabled,_,v,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,p)}}if(n.children)for(const d of n.children)Hs(e,t,d,i,r,o,s)}const Ws=[1,-1,1];function qs(t,n,i,r){if(!i.modelManager)return!0;const o=i.modelManager;if(!i.shadowRenderer)return!0;const s=i.shadowRenderer,a=n.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const n in t.instancesPerModel){const t=o.getModel(n,r);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}a.max[2]=c,a.min[2]+=t.terrainElevationMin,a.max[2]+=t.terrainElevationMax,e.ad(a.min,a.min,n.tileMatrix),e.ad(a.max,a.max,n.tileMatrix);const u=a.intersects(s.getCurrentCascadeFrustum());return 0===i.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===u),0===u}function Xs(t,n){const i=t.uniformValues.u_cutoff_params[0],r=t.uniformValues.u_cutoff_params[1],o=t.uniformValues.u_cutoff_params[2],s=t.uniformValues.u_cutoff_params[3];return r===i||s===o?1:e.ay(((n-i)/(r-i)-o)/(s-o),0,1)}function Zs(t,n,i,r){if(n.pitch<20)return 1;const o=n.getWorldToCameraMatrix();e.az(o,o,t);const s=e.bR(i.min[0],i.min[1],i.min[2],1);let a=e.aA(e.ev(),s,o),l=a,c=a;s[1]=i.max[1],a=e.aA(e.ev(),s,o),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c,s[0]=i.max[0],a=e.aA(e.ev(),s,o),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c,s[1]=i.min[1],a=e.aA(e.ev(),s,o),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c;const u=e.ay(r[0],0,1),h=100*n.pixelsPerMeter*e.ay(r[1],0,1),d=e.ay(r[2],0,1),f=e.ew(e.ev(),l,c,u),p=Math.tan(.5*n.fovX),m=-f[2]*p;if(0===h)return f[1]<-Math.abs(m)?d:1;const g=(-Math.abs(m)-f[1])/h,_=(e,t,n)=>(1-n)*e+n*t,y=e.ay(_(1,d,g),d,1);return _(1,y,e.ay((n.pitch-20)/20,0,1))}class Ys{}class Ks{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,i){{const e=this._storage.get(n.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const r=i.gl,o=r.getBufferParameter(r.ELEMENT_ARRAY_BUFFER,r.BUFFER_SIZE),s=new ArrayBuffer(o),a=new Int16Array(s);r.getBufferSubData(r.ELEMENT_ARRAY_BUFFER,0,new Int16Array(s));const l=new e.ey;for(let e=0;e<o/2;e+=3){const t=a[e],n=a[e+1],i=a[e+2];l.emplaceBack(t,n),l.emplaceBack(n,i),l.emplaceBack(i,t)}const c=i.bindVertexArrayOES.current,u=new Ys;return u.buf=new Oo(i,l),u.lastUsedFrameIdx=t,this._storage.set(n.id,u),i.bindVertexArrayOES.set(c),u.buf}update(e){for(const[t,n]of this._storage)e-n.lastUsedFrameIdx>30&&(n.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class Js{constructor(e){this.occluderSize=30,this.depthOffset=-1e-4,e.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),e.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Qs=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class $s{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class ea{constructor(e,t){this.revealStart=11,this.revealRange=2,e.registerParameter(this,[...t,"Reveal"],"revealStart",{min:0,max:17,step:.05}),e.registerParameter(this,[...t,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const ta=e.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class na{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const i=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const n=new e.ez,i=new e.a_;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1),i.emplaceBack(0,1,2),i.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(n,ta.members),this.vignetteIdx=t.context.createIndexBuffer(i)}const r=e.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,i);const e={u_vignetteShape:(o={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:o.vignetteColor};i.draw(t,t.context.gl.TRIANGLES,Gn.disabled,Wn.disabled,jn.alphaBlended,Zn.disabled,e,"vignette",this.vignetteVx,this.vignetteIdx,r)}var o}}class ia{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const i=t.getFreeCameraOptions().position,r=i.toAltitude(),o=i.toLngLat(),s=e.al(o.lng),a=e.al(o.lat),l=t.pixelsPerMeter/n,c=s*e.eB,u=e.eB*Math.log(Math.tan(Math.PI/4+a/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const e=-this._offsetYPrev+u,t=-this._elevationPrev+r;this._accumulatedOffsetX+=(-this._offsetXPrev+c)*l,this._accumulatedOffsetY+=e*l,this._accumulatedElevation+=t*l,this._offsetXPrev=c,this._offsetYPrev=u,this._elevationPrev=r}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ra(e,t){return[-(e[0]-Math.floor(e[0]/t)*t),-(e[1]-Math.floor(e[1]/t)*t),-(e[2]-Math.floor(e[2]/t)*t)]}function oa(t){const n=e.el(1323123451230),i=[];for(let r=0;r<t;++r){const t=2*n()-1,r=2*n()-1,o=2*n()-1;i.push(e.d2(t,r,o))}return i}function sa(t,n,i,r,o){const s=e.ay((o-i)/(r-i),0,1);return(1-s)*t+s*n}class aa{constructor(e){this._movement=new ia,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new na,this._ppmScaleFactor=e}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const i=t.transform;this._movement.update(i,this._ppmScaleFactor);const r=i.starsProjMatrix,o=e.c3([]);e.c5(o,o,e.al(90)-i._pitch),e.c4(o,o,-i.angle);const s=e.c8(new Float32Array(16),o),a=e.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),l=e.ea([],a),c=e.az([],l,s),u=Date.now()/1e3;return this._accumulatedTimeFromStart+=(u-this._prevTime)*n,this._prevTime=u,{projectionMatrix:r,modelviewMatrix:c}}}class la extends aa{constructor(e){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ea(e.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const t=oa(this.particlesCount),i=new e.eC,r=new e.a_;let o=0;const s=e.el(1323123451230);for(let e=0;e<t.length;++e){const n=t[e],a=[2*s()-1,s(),s(),s()];i.emplaceBack(n[0],n[1],n[2],-1,-1,...a),i.emplaceBack(n[0],n[1],n[2],1,-1,...a),i.emplaceBack(n[0],n[1],n[2],1,1,...a),i.emplaceBack(n[0],n[1],n[2],-1,1,...a),r.emplaceBack(o+0,o+1,o+2),r.emplaceBack(o+0,o+2,o+3),o+=4}this.particlesVx=n.createVertexBuffer(i,Qs.members),this.particlesIdx=n.createIndexBuffer(r)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},i=t.transform.zoom;if(n.revealStart>i)return;const r=sa(0,1,n.revealStart,n.revealStart+n.revealRange,i);if(!this.particlesVx||!this.particlesIdx)return;const o=structuredClone(this._params);let s=[-o.direction.x,o.direction.y,-100];e.au(s,s);const a=structuredClone(this._vignetteParams);a.strength*=r,o.overrideStyleParameters||(o.intensity=t.style.rain.state.density,o.timeFactor=t.style.rain.state.intensity,o.color=structuredClone(t.style.rain.state.color),s=structuredClone(t.style.rain.state.direction),o.screenThinning.intensity=t.style.rain.state.centerThinning,o.dropletSizeX=t.style.rain.state.dropletSize[0],o.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],o.distortionStrength=100*t.style.rain.state.distortionStrength,a.strength=1,a.color=structuredClone(t.style.rain.state.vignetteColor));const l=this.updateOnRender(t,o.timeFactor),c=t.context,u=c.gl,h=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new e.T(c,{width:t.width,height:t.height,data:null},u.RGBA8)),o.distortionStrength>0&&(c.activeTexture.set(u.TEXTURE0),this.screenTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.copyTexSubImage2D(u.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const d=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(c,d),c.activeTexture.set(u.TEXTURE0),this.screenTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE);const f=[o.color.r,o.color.g,o.color.b,o.color.a],p=(n,i)=>{const r=ra(this._movement.getPosition(),n),a=o.dropletSizeX,c=o.dropletSizeX*o.dropletSizeYScale,p=t.width/2,m=t.height/2,g=sa(0,o.screenThinning.start,0,1,o.screenThinning.intensity),_=sa(.001,o.screenThinning.range,0,1,o.screenThinning.intensity),y=sa(0,o.screenThinning.particleOffset,0,1,o.screenThinning.intensity),v=(x={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:r,velocityConeAperture:o.velocityConeAperture,velocity:o.velocity,boxSize:n,rainDropletSize:[a,c],distortionStrength:o.distortionStrength,rainDirection:s,color:f,screenSize:[h.width,h.height],thinningCenterPos:[p,m],thinningShape:[g,_,Math.pow(10,o.screenThinning.fadePower)],thinningAffectedRatio:o.screenThinning.affectedRatio,thinningParticleOffset:y,shapeDirectionalPower:o.shapeDirPower,shapeNormalPower:o.shapeNormalPower,mode:i?0:1},{u_modelview:Float32Array.from(x.modelview),u_projection:Float32Array.from(x.projection),u_time:x.time,u_cam_pos:x.camPos,u_texScreen:0,u_velocityConeAperture:x.velocityConeAperture,u_velocity:x.velocity,u_boxSize:x.boxSize,u_rainDropletSize:x.rainDropletSize,u_distortionStrength:x.distortionStrength,u_rainDirection:x.rainDirection,u_color:x.color,u_screenSize:x.screenSize,u_thinningCenterPos:x.thinningCenterPos,u_thinningShape:x.thinningShape,u_thinningAffectedRatio:x.thinningAffectedRatio,u_thinningParticleOffset:x.thinningParticleOffset,u_shapeDirectionalPower:x.shapeDirectionalPower,u_shapeNormalPower:x.shapeNormalPower,u_mode:x.mode});var x;const b=Math.round(o.intensity*this.particlesCount),w=e.bd.simpleSegment(0,0,4*b,2*b);d.draw(t,u.TRIANGLES,Gn.disabled,Wn.disabled,jn.alphaBlended,Zn.disabled,v,"rain_particles",this.particlesVx,this.particlesIdx,w)};o.distortionStrength>0&&p(o.boxSize,!0),p(o.boxSize,!1),this._vignette.draw(t,a)}}const ca=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ua extends aa{constructor(e){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ea(e.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const t=oa(this.particlesCount),i=new e.eD,r=new e.a_;let o=0;const s=e.el(1323123451230);for(let e=0;e<t.length;++e){const n=t[e],a=s(),l=s(),c=s(),u=[e/t.length,a,l,c],h=[s(),s()];i.emplaceBack(n[0],n[1],n[2],-1,-1,...u,...h),i.emplaceBack(n[0],n[1],n[2],1,-1,...u,...h),i.emplaceBack(n[0],n[1],n[2],1,1,...u,...h),i.emplaceBack(n[0],n[1],n[2],-1,1,...u,...h),r.emplaceBack(o+0,o+1,o+2),r.emplaceBack(o+0,o+2,o+3),o+=4}this.particlesVx=n.createVertexBuffer(i,ca.members),this.particlesIdx=n.createIndexBuffer(r)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let i=[-n.direction.x,n.direction.y,-100];e.au(i,i);const r=structuredClone(this._vignetteParams),o=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},s=t.transform.zoom;if(o.revealStart>s)return;const a=sa(0,1,o.revealStart,o.revealStart+o.revealRange,s);r.strength*=a,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),i=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,r.strength=1,r.color=structuredClone(t.style.snow.state.vignetteColor));const l=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const c=t.context,u=c.gl,h=t.transform,d=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(c,d),((n,r,o)=>{const s=ra(this._movement.getPosition(),n),a=h.width/2,c=h.height/2,f=sa(0,o.screenThinning.start,0,1,o.screenThinning.intensity),p=sa(.001,o.screenThinning.range,0,1,o.screenThinning.intensity),m=sa(0,o.screenThinning.particleOffset,0,1,o.screenThinning.intensity),g=(_={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:s,velocityConeAperture:o.velocityConeAperture,velocity:o.velocity,horizontalOscillationRadius:o.horizontalOscillationRadius,horizontalOscillationRate:o.horizontalOscillationRate,boxSize:n,billboardSize:1*o.billboardSize,simpleShapeParameters:[o.shapeFadeStart,o.shapeFadePower],screenSize:[h.width,h.height],thinningCenterPos:[a,c],thinningShape:[f,p,Math.pow(10,o.screenThinning.fadePower)],thinningAffectedRatio:o.screenThinning.affectedRatio,thinningParticleOffset:m,color:[o.color.r,o.color.g,o.color.b,o.color.a],direction:i},{u_modelview:Float32Array.from(_.modelview),u_projection:Float32Array.from(_.projection),u_time:_.time,u_cam_pos:_.camPos,u_velocityConeAperture:_.velocityConeAperture,u_velocity:_.velocity,u_horizontalOscillationRadius:_.horizontalOscillationRadius,u_horizontalOscillationRate:_.horizontalOscillationRate,u_boxSize:_.boxSize,u_billboardSize:_.billboardSize,u_simpleShapeParameters:_.simpleShapeParameters,u_screenSize:_.screenSize,u_thinningCenterPos:_.thinningCenterPos,u_thinningShape:_.thinningShape,u_thinningAffectedRatio:_.thinningAffectedRatio,u_thinningParticleOffset:_.thinningParticleOffset,u_particleColor:_.color,u_direction:_.direction});var _;const y=Math.round(o.intensity*this.particlesCount),v=e.bd.simpleSegment(0,0,4*y,2*y);this.particlesVx&&this.particlesIdx&&d.draw(t,u.TRIANGLES,Gn.disabled,Wn.disabled,jn.alphaBlended,Zn.disabled,g,"snow_particles",this.particlesVx,this.particlesIdx,v)})(n.boxSize,0,n),this._vignette.draw(t,r)}}const ha={symbol:function(t,n,i,r,o){if("translucent"!==t.renderPass)return;const s=Wn.disabled,a=t.colorModeForRenderPass(),l=i.layout.get("text-variable-anchor"),c=i.layout.get("text-size-scale-range"),u=e.ay(t.scaleFactor,c[0],c[1]);l&&function(t,n,i,r,o,s,a,l){const c=n.transform,u="map"===o,h="map"===s;for(const d of t){const t=r.getTile(d),n=t.getBucket(i);if(!n||!n.text||!n.text.segments.get().length)continue;const o=e.bH(n.textSizeData,c.zoom,l),s=qt(d,n.getProjection(),c),f=c.calculatePixelsToTileUnitsMatrix(t),p=Jt(s,t.tileID.canonical,h,u,c,n.getProjection(),f),m=n.hasIconTextFit()&&n.hasIconData();o&&qo(n,u,h,a,c,p,d,Math.pow(2,c.zoom-t.tileID.overscaledZ),o,m)}}(r,t,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),o,u);const h=0!==i.paint.get("icon-opacity").constantOr(1),d=0!==i.paint.get("text-opacity").constantOr(1);void 0!==i.layout.get("symbol-sort-key").constantOr(1)&&(h||d)?Xo(t,n,i,r,s,a):(h&&Xo(t,n,i,r,s,a,{onlyIcons:!0}),d&&Xo(t,n,i,r,s,a,{onlyText:!0})),n.map.showCollisionBoxes&&(jo(t,n,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),jo(t,n,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(t,n,i,r){if("translucent"!==t.renderPass)return;const o=i.paint.get("circle-opacity"),s=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity"),l=void 0!==i.layout.get("circle-sort-key").constantOr(1),c=i.paint.get("circle-emissive-strength");if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const u=t.context,h=u.gl,d=t.transform,f=!(!t.terrain||!t.terrain.enabled),p=i.layout.get("circle-elevation-reference"),m=t.depthModeForSublayer(0,Gn.ReadOnly),g=new Gn(t.context.gl.LEQUAL,Gn.ReadOnly,t.depthRangeFor3D),_="none"===p||f?m:g,y=Wn.disabled,v=t.colorModeForDrapableLayerRenderPass(c),x="globe"===d.projection.name,b=[e.aD(d.center.lng),e.aH(d.center.lat)],w=[];for(let T=0;T<r.length;T++){const o=r[T],s=n.getTile(o),a=s.getBucket(i);if(!a||a.projection.name!==d.projection.name)continue;const c=a.programConfigurations.get(i.id),u=a.layoutVertexBuffer,h=a.globeExtVertexBuffer,f=a.indexBuffer,p=e.dW(i),m=[h],g=t.isTileAffectedByFog(o);x&&p.push("PROJECTION_GLOBE_VIEW"),p.push("DEPTH_D24"),t.terrain&&d.depthOcclusionForSymbolsAndCircles&&p.push("DEPTH_OCCLUSION"),a.hasElevation&&!t.terrain&&(p.push("ELEVATED_ROADS"),m.push(a.elevatedLayoutVertexBuffer));const _=t.getOrCreateProgram("circle",{config:c,defines:p,overrideFog:g}),y=d.projection.createInversionMatrix(d,o.canonical),v={programConfiguration:c,program:_,layoutVertexBuffer:u,dynamicBuffers:m,indexBuffer:f,uniformValues:e.dX(t,o,s,y,b,i),tile:s};if(l){const t=a.segments.get();for(const n of t)w.push({segments:new e.bd([n]),sortKey:n.sortKey,state:v})}else w.push({segments:a.segments,sortKey:0,state:v})}l&&w.sort((e,t)=>e.sortKey-t.sortKey);const E={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const e of w){const{programConfiguration:n,program:r,layoutVertexBuffer:o,dynamicBuffers:s,indexBuffer:a,uniformValues:l,tile:c}=e.state,f=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,r,E),t.uploadCommonUniforms(u,r,c.tileID.toUnwrapped()),r.draw(t,h.TRIANGLES,_,y,v,Zn.disabled,l,i.id,o,a,f,i.paint,d.zoom,n,s)}},heatmap:function(t,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,s=o.gl,a=Wn.disabled,l=new jn([s.ONE,s.ONE,s.ONE,s.ONE],e.am.transparent,[!0,!0,!0,!0]);!function(e,t,n,i){const r=e.gl,o=t.width*i,s=t.height*i;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,o,s]);let a=n.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=n.heatmapFbo=e.createFramebuffer(o,s,!0,null),function(e,t,n,i,r,o){const s=e.gl;s.texImage2D(s.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,r,o,0,s.RGBA,e.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(e,0,t,a,o,s)}else r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(o,t,i,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.am.transparent});const c=t.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[],d=u?Zn.frontCCW:Zn.disabled,f=[e.aD(c.center.lng),e.aH(c.center.lat)];for(let e=0;e<r.length;e++){const p=r[e];if(n.hasRenderableParent(p))continue;const m=n.getTile(p),g=m.getBucket(i);if(!g||g.projection.name!==c.projection.name)continue;const _=t.isTileAffectedByFog(p),y=g.programConfigurations.get(i.id),v=t.getOrCreateProgram("heatmap",{config:y,defines:h,overrideFog:_}),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(m,v),t.uploadCommonUniforms(o,v,p.toUnwrapped());const b=c.projection.createInversionMatrix(c,p.canonical);v.draw(t,s.TRIANGLES,Gn.disabled,a,l,d,vo(t,p,m,b,f,x,i.paint.get("heatmap-intensity")),i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,i.paint,t.transform.zoom,y,u?[g.globeExtVertexBuffer]:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){const i=t.context,r=i.gl,o=n.heatmapFbo;if(!o)return;i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);let s=n.colorRampTexture;s||(s=n.colorRampTexture=new e.T(i,n.colorRamp,r.RGBA8)),s.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,r.TRIANGLES,Gn.disabled,Wn.disabled,t.colorModeForRenderPass(),Zn.disabled,((e,t)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,n),n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}(t,i))},line:function(t,n,i,r){if("translucent"!==t.renderPass)return;const o=i.paint.get("line-opacity"),s=i.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=i.paint.get("line-emissive-strength"),l=i.paint.get("line-occlusion-opacity"),c=i.layout.get("line-elevation-reference"),u="meters"===i.layout.get("line-width-unit"),h="sea"===c,d=!(!t.terrain||!t.terrain.enabled),f=t.context,p=f.gl;if(i.hasElevatedBuckets&&"globe"===t.transform.projection.name)return;const m=i.layout.get("line-cross-slope"),g=void 0!==m,_=m<1,y=t.colorModeForDrapableLayerRenderPass(a),v=t.terrain&&t.terrain.renderingToTexture,x=v?1:e.q.devicePixelRatio,b=i.paint.get("line-dasharray"),w=b.constantOr(1),E=i.layout.get("line-cap"),T=b.constantOr(null),A=E.constantOr(null),S=i.paint.get("line-pattern"),D=S.constantOr(1),C=i.paint.get("line-pattern-cross-fade"),I=S.constantOr(null),R=i.paint.get("line-opacity").constantOr(1);let P=!D&&1!==R||t.depthOcclusion&&l>0&&l<1;const M=i.paint.get("line-gradient"),F=D?"linePattern":"line",L=e.dY(i);let k;if(v&&t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(P=!1),0!==l&&t.depthOcclusion){const t=i.paint._values["line-opacity"];t&&t.value&&"constant"===t.value.kind?k=t.value:e.w("Occlusion opacity for layer ".concat(i.id," is supported only when line-opacity isn't data-driven."))}"constant"!==s.value.kind&&!1===s.value.isLineProgressConstant&&L.push("VARIABLE_LINE_WIDTH");const O=(r,o,s,a,c,d)=>{for(const m of r){const r=n.getTile(m);if(D&&!r.patternsLoaded())continue;const g=r.getBucket(i);if(!g)continue;if("none"!==g.elevationType&&!c||"none"===g.elevationType&&c)continue;t.prepareDrawTile();const _=[...o],b=t.shadowRenderer,E="road"===g.elevationType&&!!b&&b.enabled;let S=[0,0,0];if(E){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(S=hi(t.style,e,n)),_.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const L=g.programConfigurations.get(i.id);let O=!1;if(I&&r.imageAtlas){const t=e.dZ.from(I),n=t.getPrimary().scaleSelf(x).toString(),i=r.imageAtlas.patternPositions.get(n),o=t.getSecondary(),s=o?r.imageAtlas.patternPositions.get(o.scaleSelf(x).toString()):null;O=!!i&&!!s,i&&L.setConstantPatternPositions(i,s)}C>0&&(O||L.getPatternTransitionVertexBuffer("line-pattern"))&&_.push("LINE_PATTERN_TRANSITION");const B=t.isTileAffectedByFog(m),z=t.getOrCreateProgram(F,{config:L,defines:_,overrideFog:B});if(!D&&T&&A&&r.lineAtlas){const e=r.lineAtlas.getDash(T,A);e&&L.setConstantPatternPositions(e)}E&&b.setupShadows(r.tileID.toUnwrapped(),z,"vector-tile");let[N,U]=i.paint.get("line-trim-offset");if("round"===A||"square"===A){const e=1;N!==U&&(0===N&&(N-=e),1===U&&(U+=e))}const V=v?m.projMatrix:null,j=u?1/g.tileToMeter/e.aw(r,1,t.transform.zoom):1,G=u?1/g.tileToMeter/e.aw(r,1,Math.floor(t.transform.zoom)):1,H=D?e.d_(t,r,i,V,x,j,G,[N,U],S,C):e.d$(t,r,i,V,g.lineClipsArray.length,x,j,G,[N,U],S);if(M){const r=g.gradients[i.id];let o=r.texture;if(i.gradientVersion!==r.version){let s=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=m.canonical.z===i?Math.ceil(1<<t.transform.maxZoom-m.canonical.z):1;s=e.ay(e.e0(g.maxLineLength/e.aj*1024*r),256,f.maxTextureSize)}r.gradient=e.e1({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:r.gradient||void 0,clips:g.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.T(f,r.gradient,p.RGBA8),r.version=i.gradientVersion,o=r.texture}f.activeTexture.set(p.TEXTURE1),o.bind(i.stepInterpolant?p.NEAREST:p.LINEAR,p.CLAMP_TO_EDGE)}w&&(f.activeTexture.set(p.TEXTURE0),r.lineAtlasTexture&&r.lineAtlasTexture.bind(p.LINEAR,p.REPEAT),L.updatePaintBuffers()),D&&(f.activeTexture.set(p.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),L.updatePaintBuffers()),c&&!h&&t.terrain.setupElevationDraw(r,z),t.uploadCommonUniforms(f,z,m.toUnwrapped());const W=e=>{null!=k&&(k.value=R*l),z.draw(t,p.TRIANGLES,s,e,y,Zn.disabled,H,i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,i.paint,t.transform.zoom,L,[g.layoutVertexBuffer2,g.patternVertexBuffer,g.zOffsetVertexBuffer]),null!=k&&(k.value=R)};if(P&&!c){const e=t.stencilModeForClipping(m).ref;0===e&&v&&f.clear({stencil:0});const n={func:p.EQUAL,mask:255};H.u_alpha_discard_threshold=.8,W(new Wn(n,e,255,p.KEEP,p.KEEP,p.INVERT)),H.u_alpha_discard_threshold=0,W(new Wn(n,e,255,p.KEEP,p.KEEP,p.KEEP))}else H.u_alpha_discard_threshold=P&&c&&d?.8:0,W(c?a:t.stencilModeForClipping(m))}};let B=t.depthModeForSublayer(0,Gn.ReadOnly);const z=new Gn(t.depthOcclusion?p.GREATER:p.LEQUAL,Gn.ReadOnly,t.depthRangeFor3D);if(i.hasNonElevatedBuckets){const n=!v&&t.terrain;0!==l&&n?e.w("Occlusion opacity for layer ".concat(i.id," is supported on terrain only if the layer has line-z-offset enabled.")):n?e.w("Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ".concat(i.id,".")):O(r,L,B,Wn.disabled,!1,!0)}if(i.hasElevatedBuckets){"hd-road-markup"===c?d||(B=z,L.push("ELEVATED_ROADS")):(L.push("ELEVATED"),B=z,g&&L.push(_?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),h&&L.push("ELEVATION_REFERENCE_SEA"));const e=P?t.stencilModeFor3D():Wn.disabled;t.forceTerrainMode=!0,O(r,L,B,e,!0,!0),P&&O(r,L,B,e,!0,!1),t.forceTerrainMode=!1}P&&(t.resetStencilClippingMasks(),v&&f.clear({stencil:0})),0===l||t.depthOcclusion||v||t.layersWithOcclusionOpacity.push(t.currentLayer)},fill:function(t,n,i,r){const o=i.paint.get("fill-color"),s=i.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=i.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),c=i.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===o.constantOr(e.am.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";let h="none";"none"!==i.layout.get("fill-elevation-reference")?h="road":0!==i.paint.get("fill-z-offset").constantOr(1)&&(h="offset");const d=!(!t.terrain||!t.terrain.enabled),f={painter:t,sourceCache:n,layer:i,coords:r,colorMode:l,elevationType:h,terrainEnabled:d,pass:u};if("shadow"!==t.renderPass)if("offset"!==h){if(Jo(f,!1),"road"===h){const e=!d&&"translucent"===t.renderPass;e&&Ko(t,n,i,r,"geometry"),Jo(f,!0,Wn.disabled),e&&function(e){const{painter:t,sourceCache:n,layer:i,coords:r,colorMode:o}=e,s=t.context.gl,a=e.painter.shadowRenderer,l=!!a&&a.enabled,c=new Gn(t.context.gl.LEQUAL,Gn.ReadOnly,t.depthRangeFor3D);let u=[0,0,0];if(l){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(u=hi(t.style,e,n))}const h=e=>{for(const h of r){const r=n.getTile(h),d=r.getBucket(i);if(!d)continue;const f=d.elevatedStructures;if(!f)continue;let p,m;if(e?(p=f.renderableBridgeSegments,m=f.bridgeProgramConfigurations.get(i.id)):(p=f.renderableTunnelSegments,m=f.tunnelProgramConfigurations.get(i.id)),!p||0===p.segments[0].primitiveLength)continue;m.updatePaintBuffers(),t.prepareDrawTile();const g=t.isTileAffectedByFog(h),_=[];l&&_.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const y=t.getOrCreateProgram("elevatedStructures",{config:m,overrideFog:g,defines:_}),v=t.translatePosMatrix(h.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));l&&a.setupShadows(r.tileID.toUnwrapped(),y,"vector-tile");const x=uo(v,u);t.uploadCommonUniforms(t.context,y,h.toUnwrapped()),y.draw(t,s.TRIANGLES,c,Wn.disabled,o,Zn.backCCW,x,i.id,f.vertexBuffer,f.indexBuffer,p,i.paint,t.transform.zoom,m,[f.vertexBufferNormal])}};h(!0),h(!1)}(f)}}else Jo(f,!1,t.stencilModeFor3D());else t.shadowRenderer&&"road"===h&&!d&&function(e){const{painter:t,sourceCache:n,layer:i,coords:r}=e,o=t.context.gl,s=e.painter.shadowRenderer;for(const a of r){const e=n.getTile(a),r=e.getBucket(i);if(!r)continue;const l=r.elevatedStructures;if(!l)continue;if(!l.shadowCasterSegments||0===l.shadowCasterSegments.segments[0].primitiveLength)continue;t.prepareDrawTile();const c=r.bufferData.programConfigurations.get(i.id),u=t.isTileAffectedByFog(a),h=t.getOrCreateProgram("elevatedStructuresDepth",{config:c,overrideFog:u}),d=s.calculateShadowPassMatrixFromTile(e.tileID.toUnwrapped());t.uploadCommonUniforms(t.context,h,a.toUnwrapped());const f={u_matrix:d,u_depth_bias:0};h.draw(t,o.TRIANGLES,s.getShadowPassDepthMode(),Wn.disabled,s.getShadowPassColorMode(),Zn.disabled,f,i.id,l.vertexBuffer,l.indexBuffer,l.shadowCasterSegments,i.paint,t.transform.zoom,c)}}(f)},"fill-extrusion":function(t,n,i,r){const o=i.paint.get("fill-extrusion-opacity"),s=t.context,a=s.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===o)return;const u=t.conflationActive&&t.style.isLayerClipped(i,n.getSource()),h=t.style.order.indexOf(i.fqid);if(u&&function(e,t,n,i,r){for(const o of i){const i=t.getTile(o).getBucket(n);i&&(i.updateReplacement(o,e.replacementSource,r),i.uploadCentroid(e.context))}}(t,n,i,r,h),l||u)for(const e of r){const r=n.getTile(e).getBucket(i);r&&ts(t.context,n,e,r,i,l,u)}if("shadow"===t.renderPass&&t.shadowRenderer){const s=t.shadowRenderer;if(l&&o<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.ab)return;const a=s.getShadowPassDepthMode(),c=s.getShadowPassColorMode();Qo(t,n,i,r,a,Wn.disabled,c,u)}else if("translucent"===t.renderPass){const h=!i.paint.get("fill-extrusion-pattern").constantOr(1),d=i.paint.get("fill-extrusion-color").constantOr(e.am.white);if(!c&&0!==d.a){const e=new Gn(t.context.gl.LEQUAL,Gn.ReadWrite,t.depthRangeFor3D);1===o&&h?Qo(t,n,i,r,e,Wn.disabled,jn.unblended,u):(Qo(t,n,i,r,e,Wn.disabled,jn.disabled,u),Qo(t,n,i,r,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),u),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&h&&(!l&&"globe"!==t.transform.projection.name||c)){const o=i.paint.get("fill-extrusion-opacity"),h=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),f=i.paint.get("fill-extrusion-flood-light-intensity"),p="none"===i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),m=i.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(p?null:i.lut).toArray01().slice(0,3),g=h>0&&d>0,_=f>0,y=(e,t,n)=>(1-n)*e+n*t,v=new $o;v.translate=i.paint.get("fill-extrusion-translate"),v.translateAnchor=i.paint.get("fill-extrusion-translate-anchor"),v.edgeRadius=i.layout.get("fill-extrusion-edge-radius"),v.cutoffFadeRange=i.paint.get("fill-extrusion-cutoff-fade-range");const x=s=>{const l=t.depthModeForSublayer(1,Gn.ReadOnly,a.LEQUAL,!0),c=i.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),p=y(.1,3,c),g=t._showOverdrawInspector;if(!g){const c=new Wn({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new jn([a.ONE,a.ONE,a.ONE,a.ONE],e.am.transparent,[!1,!1,!1,!0],a.MIN);es(v,t,n,i,r,l,c,g,Zn.disabled,s,"sdf",o,h,d,f,m,p,u,!1)}{const c=g?Wn.disabled:new Wn({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),_=g?t.colorModeForRenderPass():new jn([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],e.am.transparent,[!0,!0,!0,!0]);es(v,t,n,i,r,l,c,_,Zn.disabled,s,"color",o,h,d,f,m,p,u,!1)}};if(c){const c=(s,l,c)=>{const p=t.depthModeForSublayer(1,Gn.ReadOnly,a.LEQUAL,!1),g=i.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),_=y(.1,3,g);{const c=new jn([a.ONE,a.ONE,a.ONE,a.ONE],e.am.transparent,[!1,!1,!1,!0]);es(v,t,n,i,r,p,Wn.disabled,c,Zn.disabled,s,"clear",o,h,d,f,m,_,u,l)}{const c=new Wn({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new jn([a.ONE,a.ONE,a.ONE,a.ONE],e.am.transparent,[!1,!1,!1,!0],a.MIN);es(v,t,n,i,r,p,c,g,Zn.disabled,s,"sdf",o,h,d,f,m,_,u,l)}{const c=s?a.ZERO:a.ONE_MINUS_DST_ALPHA,g=new Wn({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),y=new jn([c,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],e.am.transparent,[!0,!0,!0,!0]);es(v,t,n,i,r,p,g,y,Zn.disabled,s,"color",o,h,d,f,m,_,u,l)}{const g=new jn([a.ONE,a.ONE,a.ONE,s?a.ZERO:a.ONE],e.am.transparent,[!1,!1,!1,!0],s?a.FUNC_ADD:a.MAX);es(v,t,n,i,r,p,Wn.disabled,g,Zn.disabled,s,"clear",o,h,d,f,m,_,u,l,c)}};if(g||_){let n;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],i=l.drapeBufferSize[1];n=l.framebufferCopyTexture,n&&(!n||n.size[0]===t&&n.size[1]===i)||(n&&n.destroy(),n=l.framebufferCopyTexture=new e.T(s,new e.r({width:t,height:i}),a.RGBA8)),n.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexSubImage2D(a.TEXTURE_2D,0,0,0,0,0,t,i)}g&&c(!0,!1,n),_&&c(!1,!0,n)}}else g&&x(!0),_&&x(!1),(g||_)&&t.resetStencilClippingMasks()}}},building:function(t,n,i,r){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);const o=i.paint.get("building-ambient-occlusion-ground-intensity"),s=i.paint.get("building-ambient-occlusion-ground-radius"),a=i.paint.get("building-ambient-occlusion-ground-attenuation");let l=o>0&&s>0,c=!0;const u=i.paint.get("building-vertical-scale");u<1&&(c=!1);const h=t.conflationActive&&t.style.isLayerClipped(i,n.getSource()),d=t.style.order.indexOf(i.fqid);if(function(e,t,n,i,r,o){for(const s of o){const o=t.getTile(s).getBucket(n);o&&(r&&o.updateReplacement(s,e.replacementSource,i),o.uploadUpdatedIndexBuffer(e.context))}}(t,n,i,d,h,r),function(e,t,n,i){for(const r of i){const i=t.getTile(r).getBucket(n);i&&i.needsEvaluation(e,n)&&(i.evaluate(n),i.uploadUpdatedColorBuffer(e.context))}}(t,n,i,r),i.resetLayerRenderingStats(t),t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0),"shadow"===t.renderPass&&t.shadowRenderer){const e=t.shadowRenderer,o=[],s=e.getShadowPassDepthMode();ss({painter:t,source:n,layer:i,coords:r,defines:o,blendMode:e.getShadowPassColorMode(),depthMode:s,verticalScale:u})}else if("translucent"===t.renderPass){l&&function(t,n,i,r,o,s,a,l,c,u,h,d){const f=t.context.gl,p=t.depthModeForSublayer(1,Gn.ReadOnly,f.LEQUAL,!0),m=.1*(1-(g=h))+3*g;var g;const _=t._showOverdrawInspector,y=d,v=new $o;_||es(v,t,n,i,r,p,new Wn({func:f.ALWAYS,mask:255},255,255,f.KEEP,f.KEEP,f.REPLACE),new jn([f.ONE,f.ONE,f.ONE,f.ONE],e.am.transparent,[!1,!1,!1,!0],f.MIN),Zn.disabled,o,"sdf",1,a,l,0,u,m,y,!1);{const s=_?Wn.disabled:new Wn({func:f.EQUAL,mask:255},255,255,f.KEEP,f.DECR,f.DECR),c=_?t.colorModeForRenderPass():new jn([f.ONE_MINUS_DST_ALPHA,f.DST_ALPHA,f.ONE,f.ONE],e.am.transparent,[!0,!0,!0,!0]);es(v,t,n,i,r,p,s,c,Zn.disabled,o,"color",1,a,l,0,u,m,y,!1)}}(t,n,i,r,!0,0,o,s,0,[0,0,0],a,h);let d=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];c&&(d=d.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),t.shadowRenderer.useNormalOffset&&(d=d.concat("NORMAL_OFFSET"));const f=new Gn(t.context.gl.LEQUAL,Gn.ReadWrite,t.depthRangeFor3D),p=t.colorModeForRenderPass();ss({painter:t,source:n,layer:i,coords:r,defines:d,blendMode:p,depthMode:f,verticalScale:u})}else if("light-beam"===t.renderPass){const e=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],o=new Gn(t.context.gl.LEQUAL,Gn.ReadOnly,t.depthRangeFor3D);ss({painter:t,source:n,layer:i,coords:r,defines:e,blendMode:jn.alphaBlended,depthMode:o,verticalScale:u})}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1),t.resetStencilClippingMasks()},hillshade:function(e,t,n,i){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const r=e.context,o=e.terrain&&e.terrain.renderingToTexture,[s,a]="translucent"!==e.renderPass||o?[{},i]:e.stencilConfigForOverlap(i);for(const l of a){const i=t.getTile(l);if(i.needsHillshadePrepare&&"offscreen"===e.renderPass)$i(e,i,n);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Gn.ReadOnly),r=n.paint.get("hillshade-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(r),c=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):s[l.overscaledZ];Ji(e,l,i,n,t,c,a)}}r.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(t,n,i,r,o,s){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;const a="globe"===t.transform.projection.name,l=0!==i.paint.get("raster-elevation"),c=l&&a;if(t.renderElevatedRasterBackface&&!c)return;const u=t.context,h=u.gl,d=n.getSource(),f=function(t,n,i,r){const o=n.paint.get("raster-color"),s="raster-array"===t.type,a=[],l=n.paint.get("raster-resampling"),c=n.paint.get("raster-color-mix");let u=n.paint.get("raster-color-range");const h=[c[0],c[1],c[2],0],d=c[3];let f="nearest"===l?r.NEAREST:r.LINEAR;if(s&&(a.push("RASTER_ARRAY"),o||a.push("RASTER_COLOR"),"linear"===l&&a.push("RASTER_ARRAY_LINEAR"),f=r.NEAREST,!u&&t.rasterLayers)){const e=t.rasterLayers.find(e=>{let{id:t}=e;return t===n.sourceLayer});e&&e.fields&&e.fields.range&&(u=e.fields.range)}if(u=u||[0,1],o){a.push("RASTER_COLOR"),i.activeTexture.set(r.TEXTURE2),n.updateColorRamp(u);let t=n.colorRampTexture;t||(t=n.colorRampTexture=new e.T(i,n.colorRamp,r.RGBA8)),t.bind(r.LINEAR,r.CLAMP_TO_EDGE)}return{mix:h,range:u,offset:d,defines:a,resampling:f}}(d,i,u,h);if(d instanceof e.aP&&!r.length&&!a)return;const p=i.paint.get("raster-emissive-strength"),m=t.colorModeForDrapableLayerRenderPass(p),g=t.terrain&&t.terrain.renderingToTexture,_=!t.options.moving,y="nearest"===i.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(d instanceof e.aP&&!r.length&&(d.onNorthPole||d.onSouthPole)){const e=l?t.stencilModeFor3D():Wn.disabled;return void ls(!!d.onNorthPole,null,t,n,i,p,f,Zn.disabled,e)}if(!r.length)return;const[v,x]=d instanceof e.aP||g?[{},r]:t.stencilConfigForOverlap(r),b=x[x.length-1].overscaledZ;c&&f.defines.push("PROJECTION_GLOBE_VIEW"),l&&f.defines.push("RENDER_CUTOFF");const w=(r,o,x)=>{for(const w of r){const r=w.toUnwrapped(),E=n.getTile(w);if(g&&(!E||!E.hasData()))continue;u.activeTexture.set(h.TEXTURE0);const T=us(E,d,i,f);if(!T||!T.texture)continue;const{texture:A,mix:S,offset:D,tileSize:C,buffer:I}=T;let R,P;g?(R=Gn.disabled,P=w.projMatrix):l?(R=new Gn(h.LEQUAL,Gn.ReadWrite,t.depthRangeFor3D),P=a?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(r,_)):(R=t.depthModeForSublayer(w.overscaledZ-b,1===i.paint.get("raster-opacity")?Gn.ReadWrite:Gn.ReadOnly,h.LESS),P=t.transform.calculateProjMatrix(r,_));const M=t.terrain&&g?t.terrain.stencilModeForRTTOverlap(w):v[w.overscaledZ],F=s?0:i.paint.get("raster-fade-duration");E.registerFadeDuration(F);const L=n.findLoadedParent(w,0),k=Wr(E,L,n,t.transform,F);let O,B;t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(h.TEXTURE0),A.bind(y,h.CLAMP_TO_EDGE),u.activeTexture.set(h.TEXTURE1),L?(L.texture&&L.texture.bind(y,h.CLAMP_TO_EDGE),O=Math.pow(2,L.tileID.overscaledZ-E.tileID.overscaledZ),B=[E.tileID.canonical.x*O%1,E.tileID.canonical.y*O%1]):A.bind(y,h.CLAMP_TO_EDGE),"useMipmap"in A&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const z=t.transform;let N;const U=l?cs(z):[0,0,0,0];let V,j,G,H,W,q=0;if(c&&d instanceof e.aP&&d.coordinates.length>3)V=Float32Array.from(e.bh(e.dD(new e.cA(0,0,0)))),j=Float32Array.from(z.globeMatrix),G=Float32Array.from(e.dz(z)),H=[e.aD(z.center.lng),e.aH(z.center.lat)],N=d.elevatedGlobePerspectiveTransform,W=d.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.dA(w.canonical);q=e.dB(t.getCenter().lat),V=Float32Array.from(e.bh(e.dD(w.canonical))),j=Float32Array.from(z.globeMatrix),G=Float32Array.from(e.dz(z)),H=[e.aD(z.center.lng),e.aH(z.center.lat)],N=[0,0],W=Float32Array.from(e.dC(w.canonical,t,q,z.worldSize/z._pixelsPerMercatorPixel))}else N=d instanceof e.aP?d.perspectiveTransform:[0,0],V=new Float32Array(16),j=new Float32Array(9),G=new Float32Array(16),H=[0,0],W=new Float32Array(9);const X=wo(P,V,j,G,W,B||[0,0],e.ah(t.transform.zoom),H,U,O||1,k,i,N,l?i.paint.get("raster-elevation"):0,2,S,D,f.range,C,I,p),Z=t.isTileAffectedByFog(w),Y=t.getOrCreateProgram("raster",{defines:f.defines,overrideFog:Z});if(t.uploadCommonUniforms(u,Y,r),d instanceof e.aP){const n=d.elevatedGlobeVertexBuffer,r=d.elevatedGlobeIndexBuffer;if(g||!a)d.boundsBuffer&&d.boundsSegments&&Y.draw(t,h.TRIANGLES,R,Wn.disabled,m,Zn.disabled,X,i.id,d.boundsBuffer,t.quadTriangleIndexBuffer,d.boundsSegments);else if(n&&r){const s=z.zoom<=e.cX?d.elevatedGlobeSegments:d.getSegmentsForLongitude(z.center.lng);s&&Y.draw(t,h.TRIANGLES,R,Wn.disabled,m,o,X,i.id,n,r,s)}}else if(c){R=new Gn(h.LEQUAL,Gn.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[n,r,s]=e.getGridBuffers(q,!1);Y.draw(t,h.TRIANGLES,R,x||M,t.colorModeForRenderPass(),o,X,i.id,n,r,s)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:n,tileBoundsSegments:r}=t.getTileBoundsBuffers(E);Y.draw(t,h.TRIANGLES,R,M,m,Zn.disabled,X,i.id,e,n,r)}}if(!(d instanceof e.aP)&&c)for(const e of r){const r=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&ls(!0,e,t,n,i,p,f,o,x||Wn.disabled),r&&ls(!1,e,t,n,i,p,f,o===Zn.frontCW?Zn.backCW:Zn.frontCW,x||Wn.disabled)}};c?w(x,t.renderElevatedRasterBackface?Zn.backCW:Zn.frontCW,t.stencilModeFor3D()):w(x,Zn.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,n,i,r,o,s){"offscreen"===t.renderPass&&function(t,n,i,r){if(!r.length)return;const o=t.context,s=o.gl,a=n.getSource();if(!(a instanceof at))return;const l=Math.ceil(Math.sqrt(i.paint.get("raster-particle-count")));let c=i.particlePositionRGBAImage;if(!c||c.width!==l){const t=function(e){const t=e*e,n=new Uint8Array(4*t),i=function(e){return e|=0,e=Math.imul(2747636419^e,2654435769),e=Math.imul(e^e>>>16,2654435769),((e=Math.imul(e^e>>>16,2654435769))>>>0)/4294967296},r=1/1.1;for(let o=0;o<t;o++){const e=r*(i(2*o+0)+To),t=r*(i(2*o+1)+To),s=255*e%1,a=255*t%1,l=s,c=t-a/255,u=a;n[4*o+0]=255*(e-s/255),n[4*o+1]=255*l,n[4*o+2]=255*c,n[4*o+3]=255*u}return n}(l);c=i.particlePositionRGBAImage=new e.r({width:l,height:l},t)}let u=i.particleFramebuffer;u?u.width!==l&&(u.destroy(),u=i.particleFramebuffer=o.createFramebuffer(l,l,!0,null)):u=i.particleFramebuffer=o.createFramebuffer(l,l,!0,null);const h=[];for(const e of r){const t=n.getTile(e);if(!(t instanceof St))continue;const r=fs(t,a,i);if(!r)continue;const s=[t.tileSize,t.tileSize];let u=i.tileFramebuffer;u||(u=i.tileFramebuffer=o.createFramebuffer(s[0],s[1],!0,null));let d=t.rasterParticleState;d||(d=t.rasterParticleState=new ds(o,e,s,c));const f=d.update(i.lastInvalidatedAt);d.particleTextureDimension!==l&&d.updateParticleTexture(e,c);const p=d.targetColorTexture;d.targetColorTexture=d.backgroundColorTexture,d.backgroundColorTexture=p;const m=d.particleTexture0;d.particleTexture0=d.particleTexture1,d.particleTexture1=m,h.push([e,r,d,f])}if(0===h.length)return;const d=e.q.now(),f=i.previousDrawTimestamp?.001*(d-i.previousDrawTimestamp):.0167;if(i.previousDrawTimestamp=d,i.hasColorMap()){o.activeTexture.set(s.TEXTURE0+2);let t=i.colorRampTexture;t||(t=i.colorRampTexture=new e.T(o,i.colorRamp,s.RGBA8)),t.bind(s.LINEAR,s.CLAMP_TO_EDGE)}o.bindFramebuffer.set(i.tileFramebuffer.framebuffer),function(t,n,i){const r=t.context,o=r.gl,s=n.tileFramebuffer;r.activeTexture.set(o.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(c=n.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const u of i){const[,,i,c]=u;s.colorAttachment.set(i.targetColorTexture.texture),r.viewport.set([0,0,s.width,s.height]),r.clear({color:e.am.transparent}),c&&(i.backgroundColorTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),l.draw(t,o.TRIANGLES,Gn.disabled,Wn.disabled,jn.alphaBlended,Zn.disabled,a,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,i,h),function(t,n,i,r){const o=t.context,s=o.gl,a=i.tileFramebuffer,l="globe"===t.transform.projection.name,c=i.paint.get("raster-particle-max-speed");for(const u of r){const[r,h,d]=u;o.activeTexture.set(s.TEXTURE0+0),h.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a.colorAttachment.set(d.targetColorTexture.texture);const f=t.getOrCreateProgram("rasterParticleDraw",{defines:h.defines,overrideFog:!1});o.activeTexture.set(s.TEXTURE0+1);const p=h.scalarData?[]:[0,1,2,3].map(t=>e.e3[t](r));p.push(r);const m=r.canonical.x,g=r.canonical.y;for(const e of p){const o=n.getTile(l?e.wrapped():e);if(!o)continue;const a=o.rasterParticleState;if(!a)continue;const u=e.canonical.x+(1<<e.canonical.z)*(e.wrap-r.wrap),d=e.canonical.y;a.particleTexture0.bind(s.NEAREST,s.CLAMP_TO_EDGE);const p=So(1,a.particleTexture0.size[0],[u-m,d-g],0,h.texture.size,2,c,h.textureOffset,h.scale,h.offset);f.draw(t,s.POINTS,Gn.disabled,Wn.disabled,jn.alphaBlended,Zn.disabled,p,i.id,a.particleIndexBuffer,void 0,a.particleSegment)}}}(t,n,i,h),o.bindFramebuffer.set(i.particleFramebuffer.framebuffer),function(t,n,i,r){const o=t.context,s=o.gl,a=n.paint.get("raster-particle-max-speed"),l=r*n.paint.get("raster-particle-speed-factor")*.15,c=function(e){return Math.pow(e,6)}(.01+1*n.paint.get("raster-particle-reset-rate-factor")),u=n.particleFramebuffer;o.viewport.set([0,0,u.width,u.height]);for(const h of i){const[,i,r]=h;o.activeTexture.set(s.TEXTURE0+0),i.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),o.activeTexture.set(s.TEXTURE0+1);const d=r.particleTexture0;d.bind(s.NEAREST,s.CLAMP_TO_EDGE);const f=Do(1,d.size[0],0,i.texture.size,a,l,c,i.textureOffset,i.scale,i.offset);u.colorAttachment.set(r.particleTexture1.texture),o.clear({color:e.am.transparent}),t.getOrCreateProgram("rasterParticleUpdate",{defines:i.defines}).draw(t,s.TRIANGLES,Gn.disabled,Wn.disabled,jn.unblended,Zn.disabled,f,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}}(t,i,h,f)}(t,n,i,r),"translucent"===t.renderPass&&(function(t,n,i,r){const o=t.context,s=o.gl,a=n.getSource().tileSize,l=5*(1-e.af(e.cI,e.cI+1,t.transform.zoom))*a+i.paint.get("raster-particle-elevation"),c=!t.options.moving,u="globe"===t.transform.projection.name;if(!r.length)return;const[h,d]=t.stencilConfigForOverlap(r),f=[];u&&f.push("PROJECTION_GLOBE_VIEW");const p=t.stencilModeFor3D();for(const m of d){const r=m.toUnwrapped(),a=n.getTile(m);if(!a.rasterParticleState)continue;const d=a.rasterParticleState,g=100;a.registerFadeDuration(g);const _=n.findLoadedParent(m,0),y=Wr(a,_,n,t.transform,g);let v,x;t.terrain&&t.terrain.prepareDrawTile(),o.activeTexture.set(s.TEXTURE0),d.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),o.activeTexture.set(s.TEXTURE1),_&&_.rasterParticleState?(_.rasterParticleState.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),v=Math.pow(2,_.tileID.overscaledZ-a.tileID.overscaledZ),x=[a.tileID.canonical.x*v%1,a.tileID.canonical.y*v%1]):d.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const b=u?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(r,c),w=t.transform,E=ps(w),T=e.dA(m.canonical),A=e.dB(T.getCenter().lat);let S,D,C,I,R;u?(S=Float32Array.from(e.bh(e.dD(m.canonical))),D=Float32Array.from(w.globeMatrix),C=Float32Array.from(e.dz(w)),I=[e.aD(w.center.lng),e.aH(w.center.lat)],R=Float32Array.from(e.dC(m.canonical,T,A,w.worldSize/w._pixelsPerMercatorPixel))):(S=new Float32Array(16),D=new Float32Array(9),C=new Float32Array(16),I=[0,0],R=new Float32Array(9));const P=Ao(b,S,D,C,R,x||[0,0],e.ah(t.transform.zoom),I,E,v||1,y,l),M=t.isTileAffectedByFog(m),F=t.getOrCreateProgram("rasterParticle",{defines:f,overrideFog:M});if(t.uploadCommonUniforms(o,F,r),u){const e=new Gn(s.LEQUAL,Gn.ReadOnly,t.depthRangeFor3D),n=0,r=t.globeSharedBuffers;if(r){const[o,a,l]=r.getGridBuffers(A,0!==n);F.draw(t,s.TRIANGLES,e,p,jn.alphaBlended,t.renderElevatedRasterBackface?Zn.frontCCW:Zn.backCCW,P,i.id,o,a,l)}}else{const e=t.depthModeForSublayer(0,Gn.ReadOnly),n=h[m.overscaledZ],{tileBoundsBuffer:r,tileBoundsIndexBuffer:o,tileBoundsSegments:l}=t.getTileBoundsBuffers(a);F.draw(t,s.TRIANGLES,e,n,jn.alphaBlended,Zn.disabled,P,i.id,r,o,l)}}t.resetStencilClippingMasks()}(t,n,i,r),t.style.map.triggerRepaint())},background:function(t,n,i,r){const o=i.paint.get("background-color"),s="none"===i.paint.get("background-color-use-theme").constantOr("default"),a=i.paint.get("background-opacity"),l=i.paint.get("background-emissive-strength"),c="viewport"===i.paint.get("background-pitch-alignment");if(0===a)return;const u=t.context,h=u.gl,d=t.transform,f=d.tileSize,p=i.paint.get("background-pattern");let m;if(void 0!==p){if(null===p)return;if(m=t.imageManager.getPattern(e.I.from(p.toString()),i.scope,t.style.getLut(i.scope)),!m)return}const g=!p&&1===o.a&&1===a&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==g)return;const _=Wn.disabled,y=t.depthModeForSublayer(0,"opaque"===g?Gn.ReadWrite:Gn.ReadOnly),v=t.colorModeForDrapableLayerRenderPass(l),x=p?"backgroundPattern":"background";let b,w=r;if(w||(b=t.getBackgroundTiles(),w=Object.values(b).map(e=>e.tileID)),p&&(u.activeTexture.set(h.TEXTURE0),t.imageManager.bind(t.context,i.scope)),c){const n=t.getOrCreateProgram(x,{overrideFog:!1,overrideRtt:!0}),r=new Float32Array(e.bx([])),u=new e.aM(0,0,0,0,0),d=p?Po(r,l,a,t,0,i.scope,m,c,{tileID:u,tileSize:f}):Ro(r,l,a,o.toPremultipliedRenderColor(s?null:i.lut));n.draw(t,h.TRIANGLES,y,_,v,Zn.disabled,d,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}else for(const e of w){const g=t.isTileAffectedByFog(e),w=t.getOrCreateProgram(x,{overrideFog:g}),E=e.toUnwrapped(),T=r?e.projMatrix:t.transform.calculateProjMatrix(E);t.prepareDrawTile();const A=n?n.getTile(e):b?b[e.key]:new At(e,f,d.zoom,t),S=p?Po(T,l,a,t,0,i.scope,m,c,{tileID:e,tileSize:f}):Ro(T,l,a,o.toPremultipliedRenderColor(s?null:i.lut));t.uploadCommonUniforms(u,w,E);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:C,tileBoundsSegments:I}=t.getTileBoundsBuffers(A);w.draw(t,h.TRIANGLES,y,_,v,Zn.disabled,S,i.id,D,C,I)}},sky:function(t,n,i){const r=t._atmosphere?e.ah(t.transform.zoom):1,o=i.paint.get("sky-opacity")*r;if(0===o)return;const s=t.context,a=i.paint.get("sky-type"),l=new Gn(s.gl.LEQUAL,Gn.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===t.renderPass?i.needsSkyboxCapture(t)&&(function(t,n){const i=t.context,r=i.gl;let o=n.skyboxFbo;if(!o){o=n.skyboxFbo=i.createFramebuffer(32,32,!0,null),n.skyboxGeometry=new Cs(i),n.skyboxTexture=i.gl.createTexture(),r.bindTexture(r.TEXTURE_CUBE_MAP,n.skyboxTexture),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR);for(let e=0;e<6;++e)r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,r.RGBA,32,32,0,r.RGBA,r.UNSIGNED_BYTE,null)}i.bindFramebuffer.set(o.framebuffer),i.viewport.set([0,0,32,32]);const s=n.getCenter(t,!0),a=t.getOrCreateProgram("skyboxCapture"),l=new Float64Array(16);e.bx(l),e.eh(l,l,.5*-Math.PI),Is(t,n,a,l,s,0),e.bx(l),e.eh(l,l,.5*Math.PI),Is(t,n,a,l,s,1),e.bx(l),e.cR(l,l,.5*-Math.PI),Is(t,n,a,l,s,2),e.bx(l),e.cR(l,l,.5*Math.PI),Is(t,n,a,l,s,3),e.bx(l),Is(t,n,a,l,s,4),e.bx(l),e.eh(l,l,Math.PI),Is(t,n,a,l,s,5),i.viewport.set([0,0,t.width,t.height])}(t,i),i.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,n,i,r){const o=e.context,s=o.gl,a=e.transform,l=e.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,n,i,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:i,u_temporal_offset:r}))(a.skyboxMatrix,t.getCenter(e,!1),0,i,r);e.uploadCommonUniforms(o,l),l.draw(e,s.TRIANGLES,n,Wn.disabled,e.colorModeForRenderPass(),Zn.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(t,i,l,o,c):"gradient"===a&&"sky"===t.renderPass&&function(t,n,i,r,o){const s=t.context,a=s.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new Cs(s)),s.activeTexture.set(a.TEXTURE0);let u=n.colorRampTexture;u||(u=n.colorRampTexture=new e.T(s,n.colorRamp,a.RGBA8)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((t,n,i,r,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:n,u_radius:e.al(i),u_opacity:r,u_temporal_offset:o}))(l.skyboxMatrix,n.getCenter(t,!1),n.paint.get("sky-gradient-radius"),r,o);t.uploadCommonUniforms(s,c),c.draw(t,a.TRIANGLES,i,Wn.disabled,t.colorModeForRenderPass(),Zn.backCW,h,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,i,l,o,c)},custom:function(t,n,i,r){const o=t.context,s=i.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&i.isDraped(n)){if("offscreen"===t.renderPass){const n=s.prerender;if(n){if(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;n.call(s,o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ah(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else n.call(s,o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const e=s.renderToTile;if(e){const n=r[0].canonical,i={x:n.x+r[0].wrap*(s.wrapTileId?0:1<<n.z),y:n.y,z:n.z};o.setDepthMode(Gn.disabled),o.setStencilMode(Wn.disabled),o.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),e.call(s,o.gl,i),o.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(Wn.disabled);const n="3d"===s.renderingMode?new Gn(t.context.gl.LEQUAL,Gn.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Gn.ReadOnly);if(o.setDepthMode(n),"globe"===t.transform.projection.name){const n=t.transform.pointMerc;s.render(o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ah(t.transform.zoom),[n.x,n.y],t.transform.pixelsPerMeterRatio)}else s.render(o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,n,i,r){if("opaque"===t.renderPass)return;const o=i.paint.get("model-opacity").constantOr(1);if(0===o)return;const s=i.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!s)return;if(t.terrain&&o<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof e.ab)return}const a=t.shadowRenderer,l=i.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,l||(a.enabled=!1));const c=()=>{a&&(a.useNormalOffset=!0,l||(a.enabled=!0))},u=n.getSource();if("light-beam"===t.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(t,n,i,r,o){const s=t.transform;if("mercator"!==s.projection.name)return void e.w("Drawing 3D models for ".concat(s.projection.name," projection is not yet implemented"));const a=s.getFreeCameraOptions().position;if(!t.modelManager)return;const l=t.modelManager;i.modelManager=l;const c=t.shadowRenderer;if(!i._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const u=i._unevaluatedLayout._values["model-id"],h=Object.assign({},i.layout.get("model-id").parameters),d=t.style.order.indexOf(i.fqid);for(const f of r){const r=n.getTile(f).getBucket(i);if(!r||r.projection.name!==s.projection.name)continue;const p=r.getModelUris();p&&!r.modelsRequested&&(l.addModelsFromBucket(p,o),r.modelsRequested=!0);const m=Gs(f,s);h.zoom=m;const g=u.possiblyEvaluate(h);if(Vs(t,r,f),js.shadowUniformsInitialized=!1,js.useSingleShadowCascade=!!c&&0===c.getMaxCascadeForTile(f.toUnwrapped()),"shadow"===t.renderPass&&c){if(1===t.currentShadowCascade&&r.isInsideFirstShadowMapFrustum)continue;const n=s.calculatePosMatrix(f.toUnwrapped(),s.worldSize);if(js.tileMatrix.set(n),js.shadowTileMatrix=Float32Array.from(c.calculateShadowPassMatrixFromMatrix(n)),js.aabb.min.fill(0),js.aabb.max[0]=js.aabb.max[1]=e.aj,js.aabb.max[2]=0,qs(r,js,t,i.scope))continue}const _=1<<f.canonical.z,y=[((a.x-f.wrap)*_-f.canonical.x)*e.aj,(a.y*_-f.canonical.y)*e.aj,a.z*_*e.aj];t.conflationActive&&Object.keys(r.instancesPerModel).length>0&&t.style.isLayerClipped(i,n.getSource())&&r.updateReplacement(f,t.replacementSource,d,o)&&(r.uploaded=!1,r.upload(t.context));for(let e in r.instancesPerModel){const n=r.instancesPerModel[e];n.features.length>0&&(e=g.evaluate(n.features[0].feature,{}));const s=l.getModel(e,o);if(s||l.hasURLBeenRequested(e)||r.modelUris.includes(e)||(r.modelUris.push(e),r.modelsRequested=!1),s&&s.uploaded)for(const e of s.nodes)Hs(t,i,e,n,y,f,js)}}}(t,n,i,r,"vector"===u.type?i.scope:""),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(t,n,i,r){i.resetLayerRenderingStats(t);const o=t.context,s=t.transform,a=t.style.fog,l=t.shadowRenderer;if("mercator"!==s.projection.name)return void e.w("Drawing 3D landmark models for ".concat(s.projection.name," projection is not yet implemented"));const c=t.transform.getFreeCameraOptions().position,u=e.c1([],[c.x,c.y,c.z],t.transform.worldSize),h=e.eq([],u),d=e.bx([]),f=e.e9(s.center.lat,s.zoom),p=e.bn([],[1,1,1/f]);e.bo(d,d,h);const m=i.paint.get("model-opacity").constantOr(1),g=new Gn(o.gl.LEQUAL,Gn.ReadWrite,t.depthRangeFor3D),_=new Gn(o.gl.LEQUAL,Gn.ReadOnly,t.depthRangeFor3D),y=new e.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),v="shadow"===t.renderPass,x=v&&l?l.getCurrentCascadeFrustum():s.getFrustum(s.scaleZoom(s.worldSize)),b=i.paint.get("model-front-cutoff"),w=b[2]<1,E=ri(t,i.paint.get("model-cutoff-fade-range")),T=i.getLayerRenderingStats();(function(e,t,n,i){const r=e.terrain?e.terrain.exaggeration():0,o=e.transform.zoom;for(const s of i){const i=t.getTile(s).getBucket(n);i&&(i.setFilter(n.filter),e.conflationActive&&i.updateReplacement(s,e.replacementSource),i.evaluateTransform(e,n),e.terrain&&r>0&&i.elevationUpdate(e.terrain,r,s,n.source),i.needsReEvaluation(e,o,n)&&i.evaluate(n))}})(t,n,i,r),function(){let c,h,A;w?(c=r.length-1,h=-1,A=-1):(c=0,h=r.length,A=1);const S=new Float64Array(16),D=e.cx(),C=new e.P(0,0);for(let I=c;I!==h;I+=A){const c=r[I],h=n.getTile(c).getBucket(i);if(!h||!h.uploaded)continue;let A=!1;l&&(A=0===l.getMaxCascadeForTile(c.toUnwrapped()));const R=s.calculatePosMatrix(c.toUnwrapped(),s.worldSize),P=h.modelTraits;!v&&w&&(e.bi(S,R),e.ad(D,u,S),C.x=D[0],C.y=D[1]);const M=[];h.setFilter(i.filter);for(const n of h.getNodesInfo()){if(n.hiddenByReplacement)continue;if(!n.node.meshes)continue;const i=n.node;let r=0;t.terrain&&i.elevation&&(r=i.elevation*t.terrain.exaggeration());const o=(()=>{const t=n.aabb;return y.min=[...t.min],y.max=[...t.max],y.min[2]+=r,y.max[2]+=r,e.ad(y.min,y.min,R),e.ad(y.max,y.max,R),y})(),a=n.evaluatedScale;if(a[0]<=1&&a[1]<=1&&a[2]<=1&&0===o.intersects(x))continue;if(!v&&w){const t=1/6;n.cameraCollisionOpacity=u[0]>o.min[0]&&u[0]<o.max[0]&&u[1]>o.min[1]&&u[1]<o.max[1]&&u[2]*f<o.max[2]&&i.footprint&&e.bY(C,i.footprint)?Math.max(n.cameraCollisionOpacity-t,0):Math.min(1,n.cameraCollisionOpacity+t)}const l=[...R],h=1/e.d4(c.canonical),d=i.anchor?i.anchor[0]:0,p=i.anchor?i.anchor[1]:0;e.bo(l,l,[d*(a[0]-1)+n.evaluatedTranslation[0]*h,p*(a[1]-1)+n.evaluatedTranslation[1]*h,r+n.evaluatedTranslation[2]]),e.cn(a,e.es)||e.cP(l,l,a);const g=e.az([],l,i.matrix),_=e.az([],s.expandedFarZProjMatrix,g),T=e.az([],s.expandedFarZProjMatrix,l),A=e.aA([],[d,p,r,1],_)[2];i.hidden=!1;let S=m;v||(w&&(S*=n.cameraCollisionOpacity,S*=Zs(l,s,n.aabb,b)),S*=Xs(E,A)),0!==S?M.push({nodeInfo:n,depth:A,opacity:S,wvpForNode:_,wvpForTile:T,nodeModelMatrix:g,tileModelMatrix:l}):i.hidden=!0}v||M.sort((e,t)=>!w||1===e.opacity&&1===t.opacity?e.depth<t.depth?-1:1:1===e.opacity?-1:1===t.opacity?1:e.depth>t.depth?-1:1);for(const n of M){const r=n.nodeInfo,c=r.node;let u=e.az([],p,n.tileModelMatrix);e.az(u,d,u);const h=e.bi([],u);e.ea(h,h),e.cP(h,h,Ws),u=e.az(u,u,c.matrix);const f="light-beam"===t.renderPass,m="none"===i.paint.get("model-color-use-theme").constantOr("default"),y=P&e.ex.HasMapboxMeshFeatures,x=y?0:r.evaluatedRMEA[0][2];for(let e=0;e<c.meshes.length;++e){const d=c.meshes[e],p=e===c.lightMeshIndex;let b=n.wvpForNode;if(p){if(!f&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}b=n.wvpForTile}else if(f)continue;const w={defines:[]},E=[];if(!v&&l&&(l.useNormalOffset=!!d.normalBuffer),Bs(w.defines,E,d,t,m?null:i.lut),y||w.defines.push("DIFFUSE_SHADED"),A&&w.defines.push("SHADOWS_SINGLE_CASCADE"),T&&(v?T.numRenderedVerticesInShadowPass+=d.vertexArray.length:T.numRenderedVerticesInTransparentPass+=d.vertexArray.length),v){Us(d,n.nodeModelMatrix,t,i);continue}let S=null;if(a){const e=Os(n.nodeModelMatrix,t.transform);if(S=new Float32Array(e),"globe"!==s.projection.name){const t=d.aabb.min,n=d.aabb.max,[i,r]=a.getOpacityForBounds(e,t[0],t[1],n[0],n[1]);w.overrideFog=i>=Ne||r>=Ne}}const D=d.material;let C;D.occlusionTexture&&D.occlusionTexture.offsetScale&&(C=D.occlusionTexture.offsetScale,w.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const I=t.getOrCreateProgram("model",w);!v&&l&&l.setupShadowsFromMatrix(n.tileModelMatrix,I,l.useNormalOffset),t.uploadCommonUniforms(o,I,null,S);const R=D.pbrMetallicRoughness;R.metallicFactor=.9,R.roughnessFactor=.5;const P=Fo(new Float32Array(b),new Float32Array(u),new Float32Array(h),new Float32Array(c.matrix),t,n.opacity,R.baseColorFactor,D.emissiveFactor,R.metallicFactor,R.roughnessFactor,D,x,i,[0,0,0],C);!p&&(r.hasTranslucentParts||n.opacity<1)&&I.draw(t,o.gl.TRIANGLES,g,Wn.disabled,jn.disabled,Zn.backCCW,P,i.id,d.vertexBuffer,d.indexBuffer,d.segments,i.paint,t.transform.zoom,void 0,E),I.draw(t,o.gl.TRIANGLES,p?_:g,Wn.disabled,p||n.opacity<1||r.hasTranslucentParts?jn.alphaBlended:jn.unblended,Zn.backCCW,P,i.id,d.vertexBuffer,d.indexBuffer,d.segments,i.paint,t.transform.zoom,void 0,E)}}}}()}(t,n,i,r),void c();if("model"!==u.type)return;const h=u.getModels(),d=[],f=t.transform.getFreeCameraOptions().position,p=e.c1([],[f.x,f.y,f.z],t.transform.worldSize);e.eq(p,p);const m=[],g=[];let _=0;for(const y of h){const n=i.paint.get("model-rotation").constantOr(null),r=i.paint.get("model-scale").constantOr(null),o=i.paint.get("model-translation").constantOr(null);y.computeModelMatrix(t,n,r,o,!0,!0,!1);const s=e.bx([]),a=e.e9(y.position.lat,t.transform.zoom),l=e.bn([],[1,1,1/a]);e.bo(s,s,p),d.push({zScaleMatrix:l,negCameraPosMatrix:s});for(const e of y.nodes)Ns(t.transform,e,y.matrix,t.transform.expandedFarZProjMatrix,_,m,g);_++}if(m.sort((e,t)=>t.depth-e.depth),"shadow"!==t.renderPass){if(1===o)for(const e of g)zs(e,t,i,d[e.modelIndex],Wn.disabled,t.colorModeForRenderPass());else{for(const e of g)zs(e,t,i,d[e.modelIndex],Wn.disabled,jn.disabled);for(const e of g)zs(e,t,i,d[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const e of m)zs(e,t,i,d[e.modelIndex],Wn.disabled,t.colorModeForRenderPass());c()}else{for(const e of g)Us(e.mesh,e.nodeModelMatrix,t,i);for(const e of m)Us(e.mesh,e.nodeModelMatrix,t,i);c()}}},da={line:function(e,t,n){if(e.hasElevatedBuckets=!1,e.hasNonElevatedBuckets=!1,void 0!==e._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==e._unevaluatedLayout.getValue("line-z-offset")){if(t){const n=t.getVisibleCoordinates();for(const i of n){const n=t.getTile(i).getBucket(e);if(n&&("none"!==n.elevationType?e.hasElevatedBuckets=!0:e.hasNonElevatedBuckets=!0,e.hasElevatedBuckets&&e.hasNonElevatedBuckets))break}}}else e.hasNonElevatedBuckets=!0},model:function(e,t,n){const i=t.getSource();if(!i.loaded())return;if("vector"===i.type||"geojson"===i.type)return void(n.modelManager&&n.modelManager.upload(n,"vector"===i.type?e.scope:""));if("batched-model"===i.type)return;if("model"!==i.type)return;const r=i.getModels();for(const o of r)o.upload(n.context)},raster:function(e,t,n){const i=t.getSource();if(!(i instanceof at&&i.loaded()))return;const r=e.sourceLayer||i.rasterLayerIds&&i.rasterLayerIds[0];if(!r)return;const o=e.paint.get("raster-array-band")||i.getInitialBand(r);if(null==o)return;const s=t.getIds().map(e=>t.getTileByID(e));for(const a of s)a.updateNeeded(e.id,o)&&i.prepareTile(a,r,e.id,o)},"raster-particle":function(e,t,n){const i=t.getSource();if(!(i instanceof at&&i.loaded()))return;const r=e.sourceLayer||i.rasterLayerIds&&i.rasterLayerIds[0];if(!r)return;const o=e.paint.get("raster-particle-array-band")||i.getInitialBand(r);if(null==o)return;const s=t.getIds().map(e=>t.getTileByID(e));for(const a of s)a.updateNeeded(e.id,o)&&i.prepareTile(a,r,e.id,o)}},fa={fill:Ko},pa={fill:function(e,t,n,i){if(!n.layout||"none"===n.layout.get("fill-elevation-reference"))return;const r=e.context.gl,o=new Gn(r.LEQUAL,Gn.ReadOnly,e.depthRangeFor3D),s=new Wn({func:r.ALWAYS,mask:255},255,255,r.KEEP,r.KEEP,r.REPLACE),a=e.transform.getFreeCameraOptions().position,l=e.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const c of i){const i=t.getTile(c),u=i.getBucket(n);if(!u)continue;const h=u.elevatedStructures;if(!h||0===h.depthSegments.segments[0].primitiveLength)continue;const d=Yo(c.toUnwrapped(),a),f=e.translatePosMatrix(c.projMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),p=ho(f,d,0,1,0);l.draw(e,r.TRIANGLES,o,s,jn.disabled,Zn.disabled,p,n.id,h.vertexBuffer,h.indexBuffer,h.depthSegments,n.paint,e.transform.zoom)}}};class ma{constructor(t,n,i,r,o,s){this.context=new Uo(t,n),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=o,this._timeStamp=e.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const a=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const e of a)this._debugParams.enabledLayers[e]=!0;o.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),o.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),o.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),o.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),o.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),o.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const e of a)o.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],e);this.occlusionParams=new Js(o),this.setup(),this.numSublayers=It.maxUnderzooming+It.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new li(this),this._wireframeDebugCache=new Ks,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const l=new e.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new e.T(this.context,l,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=r,this.worldview=s}updateTerrain(e,t){const n=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Yr(this,e));const i=this._terrain;this.transform.elevation=n?i:null,i.update(e,this.transform,t),this.transform.elevation&&!i.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,i]=t.getFovAdjustedRange(this.transform._fov);if(n>i)return void(this.transform.fogCullDistSq=null);const r=n+.78*(i-n);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(e){e&&!this._terrain&&(this._terrain=new Yr(this,this.style)),this._forceTerrainMode=e}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*e.q.devicePixelRatio,this.height=n*e.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,n=new e.ba;n.emplaceBack(0,0),n.emplaceBack(e.aj,0),n.emplaceBack(0,e.aj),n.emplaceBack(e.aj,e.aj),this.tileExtentBuffer=t.createVertexBuffer(n,e.bc.members),this.tileExtentSegments=e.bd.simpleSegment(0,0,4,2);const i=new e.ba;i.emplaceBack(0,0),i.emplaceBack(e.aj,0),i.emplaceBack(0,e.aj),i.emplaceBack(e.aj,e.aj),this.debugBuffer=t.createVertexBuffer(i,e.bc.members),this.debugSegments=e.bd.simpleSegment(0,0,4,5);const r=new e.ba;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,e.bc.members),this.viewportSegments=e.bd.simpleSegment(0,0,4,2);const o=new e.aZ;o.emplaceBack(0,0,0,0),o.emplaceBack(e.aj,0,e.aj,0),o.emplaceBack(0,e.aj,0,e.aj),o.emplaceBack(e.aj,e.aj,e.aj,e.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.bf.members),this.mercatorBoundsSegments=e.bd.simpleSegment(0,0,4,2);const s=new e.a_;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);const a=new e.bb;for(const e of[0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.T(t,new e.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=e.bz();const l=this.context.gl;this.stencilClearMode=new Wn({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Gn.disabled,this.stencilClearMode,jn.disabled,Zn.disabled,Hr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,n){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of n)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const i=this.context,r=i.gl;this.nextStencilID+n.length>256&&this.clearStencil(),i.setColorMode(jn.disabled),i.setDepthMode(Gn.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of n){const e=t.getTile(s),n=this._tileClippingMaskIDs[s.key]=this.nextStencilID++,{tileBoundsBuffer:i,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(e);o.draw(this,r.TRIANGLES,Gn.disabled,new Wn({func:r.ALWAYS,mask:0},n,255,r.KEEP,r.KEEP,r.REPLACE),jn.disabled,Zn.disabled,Hr(s.projMatrix),"$clipping",i,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Wn({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new Wn({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,n=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const e={};for(let n=0;n<r;n++)e[n+i]=new Wn({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=r,[e,n]}return[{[i]:Wn.disabled},n]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new jn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.am(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?jn.unblended:jn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new jn([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new e.am(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.depthOcclusion)return new Gn(this.context.gl.GREATER,Gn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!i)return Gn.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Gn(n||this.context.gl.LEQUAL,t,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),i=Math.ceil(this.height),r=this.context.bindFramebuffer.get(),o=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===i||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==n&&0!==i&&(this.depthFBO=new No(this.context,n,i,!1,"texture"),this.depthTexture=new e.T(this.context,{width:n,height:i,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(r),t.bindTexture(t.TEXTURE_2D,o),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,i,0,0,n,i,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((e,t)=>e+t/this._fpsHistory.length,0))}render(t,n){const i=e.q.now();this._dt=i-this._timeStamp,this._timeStamp=i,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const r=this.style._mergedLayers,o=!(!this.terrain||!this.terrain.enabled),s=()=>this.style._getOrder(o).filter(e=>{const t=r[e];return!(t.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[t.type]});let a=s(),l=!1,c=!1,u=null;for(const e of a){const t=r[e];"circle"===t.type?l=!0:"building"===t.type?u=t:"symbol"===t.type&&(t.hasInitialOcclusionOpacityProperties?c=!0:l=!0)}let h=a.map(e=>r[e]);const d=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.q.now()),this.imageManager.beginFrame();let f=0,p=!1;for(const e in d){const t=d[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++f)}let m=!1;for(const e of h)e.isHidden(this.transform.zoom)||("clip"===e.type&&(m=!0),this.prepareLayer(e));const g={},_={},y={},v={},x={};for(const e in d){const t=d[e];g[e]=t.getVisibleCoordinates(),_[e]=g[e].slice().reverse(),y[e]=t.getVisibleCoordinates(!0).reverse(),v[e]=t.getShadowCasterCoordinates(),x[e]=t.sortCoordinatesByDistance(g[e])}const b=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(f||m||this._clippingActiveLastFrame){const t=[],n=[];let i=0;for(const e of h)this.isSourceForClippingOrConflation(e,b(e))&&(t.push(e),n.push(i)),i++;if(t&&(m||t.length>1)||this._clippingActiveLastFrame){m=!1;const i=[];for(let r=0;r<t.length;r++){const o=t[r],s=n[r],a=this.style.getLayerSourceCache(o);if(!a||!a.used||!a.getSource().usedInConflation&&"clip"!==o.type&&"building"!==o.type)continue;let l=e.eF,c=e.bW.None;const u=[];let h=!0;if("building"===o.type)l=e.eH;else if("clip"===o.type){l=s;for(const t of o.layout.get("clip-layer-types"))c|="model"===t?e.bW.Model:"symbol"===t?e.bW.Symbol:e.bW.FillExtrusion;for(const e of o.layout.get("clip-layer-scope"))u.push(e);o.isHidden(this.transform.zoom)?h=!1:m=!0}h&&i.push({layer:o.fqid,cache:a,order:l,clipMask:c,clipScope:u})}this.replacementSource.setSources(i),p=!0}}this._clippingActiveLastFrame=m,p||this.replacementSource.clear(),this.conflationActive=p,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let e=0;e<h.length;e++){const t=h[e],n=t.cutoffRange();if(this.longestCutoffRange=Math.max(n,this.longestCutoffRange),n>0){const e=b(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}t.is3D(o)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=e),this._lastOcclusionLayer=e)}const w=this.style&&this.style.fog;w?(this._fogVisible=0!==w.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=w.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0,a=s(),h=a.map(e=>r[e]));const E=this._shadowRenderer;if(E){E.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in d)for(const t of g[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),E.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ls(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const T=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),A=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(T&&!this._snow&&(this._snow=new ua(this)),!T&&this._snow&&(this._snow.destroy(),delete this._snow),A&&!this._rain&&(this._rain=new la(this)),!A&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),u){this.buildingTileBorderManager||(this.buildingTileBorderManager=new ks);const e=this.style.getLayerSourceCache(u);this.buildingTileBorderManager.updateBorders(e,u)}if(!G.has(this.context.gl))return;this.renderPass="offscreen";for(const e of h){const n=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const i=n?_[n.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||i&&i.length)&&this.renderLayer(this,n,e,i)}this.depthRangeFor3D=[0,1-(h.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,v)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const S="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),D=(()=>{if(n.showOverdrawInspector)return e.am.black;const t=this.style.fog;if(t&&this.transform.projection.supportsFog){const n=this.style.getLut(t.scope);if(!S){const i="none"===t.properties.get("color-use-theme"),r=t.properties.get("color").toNonPremultipliedRenderColor(i?null:n).toArray01();return new e.am(...r)}if(S){const i="none"===t.properties.get("space-color-use-theme"),r=t.properties.get("space-color").toNonPremultipliedRenderColor(i?null:n).toArray01();return new e.am(...r)}}return e.am.transparent})();if(this.context.clear({color:D,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&S&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const e=h[this.currentLayer],n=t.getLayerSourceCache(e);if(e.isSky())continue;const i=n?(e.is3D(o)?x:_)[n.id]:void 0;this._renderTileClippingMasks(e,n,i),this.renderLayer(this,n,e,i)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&S&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.ah(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const e=h[this.currentLayer],n=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,n,e,n?_[n.id]:void 0)}function C(e,t){let n;return t&&(n=("symbol"===e.type?y:e.is3D(o)?x:_)[t.id]),n}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<a.length;){const e=h[this.currentLayer];if("raster"===e.type||"raster-particle"===e.type){const n=t.getLayerSourceCache(e);this.renderLayer(this,n,e,C(e,n))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let I=0;E&&(I=E.getShadowCastingLayerCount());let R=!1,P=-1;for(let e=0;e<a.length;++e){const t=h[e];t.isHidden(this.transform.zoom)||t.is3D(o)&&(P=e)}c&&-1===P&&(l=!0);let M=!1;for(;this.currentLayer<a.length;){const e=h[this.currentLayer],n=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!M&&e.is3D(o)&&!o){const e=this.currentLayer,t=e=>{for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const t=h[this.currentLayer];if(fa[t.type]){const n=this.style.getLayerSourceCache(t);fa[t.type](this,n,t,C(t,n),e)}}};t("initialize"),t("reset"),this.currentLayer=e,M=!0}if(l&&!R&&this.terrain&&!this.transform.isOrthographic&&(R=!0,this.blitDepth()),c&&-1!==P&&this.currentLayer===P+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(e,n,n?g[n.id]:void 0),this.renderLayer(this,n,e,C(e,n)),!this.terrain&&E&&I>0&&e.hasShadowPass()&&0==--I){{this.clearStencil(),this.resetStencilClippingMasks();const e=this.currentLayer;for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const e=h[this.currentLayer];if(pa[e.type]){const t=this.style.getLayerSourceCache(e);pa[e.type](this,t,e,C(e,t))}}this.currentLayer=e}if(E.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=h[this.currentLayer];if(!e.hasLightBeamPass())continue;const n=t.getLayerSourceCache(e);this.renderLayer(this,n,e,n?_[n.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const e=this.currentLayer;this.depthOcclusion=!0;for(const n of this.layersWithOcclusionOpacity){this.currentLayer=n;const e=h[this.currentLayer],i=t.getLayerSourceCache(e),r=i?_[i.id]:void 0;this.terrain||this._renderTileClippingMasks(e,i,i?g[i.id]:void 0),this.renderLayer(this,i,e,r)}this.depthOcclusion=!1,this.currentLayer=e,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let n=null;h.forEach(e=>{const i=t.getLayerSourceCache(e);i&&!e.isHidden(this.transform.zoom)&&i.getVisibleCoordinates().length&&(!n||n.getSource().maxzoom<i.getSource().maxzoom)&&(n=i)}),n&&this.options.showTileBoundaries&&xs(this,n,n.getVisibleCoordinates(),e.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&xs(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;ws(e,e.transform.height-(t.top||0),3,ms),ws(e,t.bottom||0,3,gs),Es(e,t.left||0,3,_s),Es(e,e.transform.width-(t.right||0),3,ys);const n=e.transform.centerPoint;!function(e,t,n,i){Ts(e,t-1,n-10,2,20,i),Ts(e,t-10,n-1,20,2,i)}(e,n.x,e.transform.height-n.y,vs)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),p||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,n=!t||!t.includes(e.type);if(da[e.type]&&(n||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);da[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||"model"===n.type||"raster"===n.type||"raster-particle"===n.type||i&&i.length)&&(this.id=n.id,this.gpuTimingStart(n),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(n.type)&&(!e.terrain||"custom"!==n.type)||"clip"===n.type||ha[n.type](e,t,n,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,n=this.context.gl;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:n.createQuery()}),i.calls++,n.beginQuery(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,n=t.createQuery();this.deferredRenderGpuTimeQueries.push(n),t.beginQuery(e.TIME_ELAPSED_EXT,n)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const n in e){const i=e[n],r=this.context.extTimerQuery,o=r.getQueryParameter(i.query,this.context.gl.QUERY_RESULT)/1e6;r.deleteQueryEXT(i.query),t[n]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.gl;let n=0;for(const i of e)n+=t.getQueryParameter(i,t.QUERY_RESULT)/1e6,t.deleteQuery(i);return n}translatePosMatrix(t,n,i,r,o){if(!i[0]&&!i[1])return t;const s=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(s){const e=Math.sin(s),t=Math.cos(s);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t]}const a=[o?i[0]:e.aw(n,i[0],this.transform.zoom),o?i[1]:e.aw(n,i[1],this.transform.zoom),0],l=new Float32Array(16);return e.bo(l,t,a),l}saveTileTexture(e){if(e.context!==this.context)return;const t=e.size[0],n=this._tileTextures[t];n?n.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,n){const i=void 0===n?this.terrain&&this.terrain.renderingToTexture:n,r=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(r.push("LIGHTING_3D_MODE"),r.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):i||r.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||r.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(r.push("TERRAIN"),this.linearFloatFilteringSupported()&&r.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&r.push("GLOBE"),!this._fogVisible||i||void 0!==t&&!t||r.push("FOG","FOG_DITHERING"),i&&r.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&r.push("OVERDRAW_INSPECTOR"),r}getOrCreateProgram(e,t){this.cache=this.cache||{};const n=t&&t.defines||[],i=t&&t.config,r=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(n),o=$r.cacheKey(qi[e],e,r,i);return this.cache[o]||(this.cache[o]=new $r(this.context,e,qi[e],i,ko[e],r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const i=this.style.directionalLight,r=this.style.ambientLight;if(i&&r){const o=((t,n,i)=>{const r=t.properties.get("direction"),o="none"===t.properties.get("color-use-theme"),s=t.properties.get("color").toNonPremultipliedRenderColor(o?null:i.getLut(t.scope)).toArray01(),a=t.properties.get("intensity"),l="none"===n.properties.get("color-use-theme"),c=n.properties.get("color").toNonPremultipliedRenderColor(l?null:i.getLut(n.scope)).toArray01(),u=n.properties.get("intensity"),h=[r.x,r.y,r.z],d=e.dI(c,u),f=e.dI(s,a);return{u_lighting_ambient_color:d,u_lighting_directional_dir:h,u_lighting_directional_color:f,u_ground_radiance:Kr(h,f,d)}})(i,r,this.style);n.setLightsUniformValues(t,o)}}}uploadCommonUniforms(t,n,i,r,o){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const s=this.style.fog;if(s){const o=s.getOpacity(this.transform.pitch),a=((t,n,i,r,o,s,a,l,c,u,h,d)=>{const f=t.transform,p="none"===n.properties.get("color-use-theme"),m=n.properties.get("color").toNonPremultipliedRenderColor(p?null:t.style.getLut(n.scope)).toArray01();m[3]=r;const g=t.frameCounter/1e3%1,[_,y]=n.properties.get("vertical-range");return{u_fog_matrix:i?f.calculateFogTileMatrix(i):d||t.identityMat,u_fog_range:n.getFovAdjustedRange(f._fov),u_fog_color:m,u_fog_horizon_blend:n.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_,y),y],u_fog_temporal_offset:g,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:e.ah(f.zoom),u_is_globe:+("globe"===f.projection.name)}})(this,s,i,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.q.devicePixelRatio,this.transform.height*e.q.devicePixelRatio],r);n.setFogUniformValues(t,a)}o&&n.setCutoffUniformValues(t,o.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const i of n)t[i.key]=e[i.key]||new At(i,512,this.transform.tileZoom,this,void 0,this.worldview);return t}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(e,t){return!(!e.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==e.type&&"building"!==e.type&&(e.minzoom&&e.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==e.sourceLayer&&"procedural_buildings"!==e.sourceLayer)&&(!t||"batched-model"!==t.type)))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=Ne||t[1]>=Ne}setupDepthForOcclusion(e,t,n){const i=this.context,r=i.gl,o=!!n;var s;n||(n={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),i.activeTexture.set(r.TEXTURE3),e&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),n.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],n.u_depth_range_unpack=[2/((s=this.depthRangeFor3D)[1]-s[0]),-1-2*s[0]/(s[1]-s[0])],n.u_occluder_half_size=.5*this.occlusionParams.occluderSize,n.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),i.activeTexture.set(r.TEXTURE0),o||t.setTerrainUniformValues(i,n)}}function ga(e,t){let n=!1,i=null;const r=()=>{i=null,n&&(e(),i=setTimeout(r,t),n=!1)};return()=>(n=!0,i||r(),i)}class _a{constructor(t){this._hashName=t&&encodeURIComponent(t),e.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ga(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=ya(e);if(this._hashName){const e=this._hashName;let n=!1;const i=location.hash.slice(1).split("&").map(i=>{const r=i.split("=")[0];return r===e?(n=!0,"".concat(r,"=").concat(t)):i}).filter(e=>e);return n||i.push("".concat(e,"=").concat(t)),"#".concat(i.join("&"))}return"#".concat(t)}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some(e=>isNaN(Number(e)))){const n=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ya(e,t){const n=e.getCenter(),i=Math.round(100*e.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),s=Math.round(n.lng*o)/o,a=Math.round(n.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?"/".concat(s,"/").concat(a,"/").concat(i):"".concat(i,"/").concat(a,"/").concat(s);return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/".concat(Math.round(c))),u}const va={linearity:.3,easing:e.eI(0,0,.3,1)},xa=e.h({deceleration:2500,maxSpeed:1400},va),ba=e.h({deceleration:20,maxSpeed:1400},va),wa=e.h({deceleration:1e3,maxSpeed:360},va),Ea=e.h({deceleration:1e3,maxSpeed:90},va);class Ta{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=e.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const o=Sa(n.pan.mag(),i,e.h({},xa,t||{}));r.offset=n.pan.mult(o.amount/n.pan.mag()),r.center=this._map.transform.center,Aa(r,o)}if(n.zoom){const e=Sa(n.zoom,i,ba);r.zoom=this._map.transform.zoom+e.amount,Aa(r,e)}if(n.bearing){const t=Sa(n.bearing,i,wa);r.bearing=this._map.transform.bearing+e.ay(t.amount,-179,179),Aa(r,t)}if(n.pitch){const e=Sa(n.pitch,i,Ea);r.pitch=this._map.transform.pitch+e.amount,Aa(r,e)}if(r.zoom||r.bearing){const e=void 0===n.pinchAround?n.around:n.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function Aa(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Sa(t,n,i){const{maxSpeed:r,linearity:o,deceleration:s}=i,a=e.ay(t*o/(n/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:i.easing,duration:1e3*l,amount:a*(l/2)}}class Da extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=x(n.getCanvasContainer(),i),s=n.unproject(o);super(t,e.h({point:o,lngLat:s,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class Ca extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){const r="touchend"===t?i.changedTouches:i.touches,o=b(n.getCanvasContainer(),r),s=o.map(e=>n.unproject(e)),a=o.reduce((e,t,n,i)=>e.add(t.div(i.length)),new e.P(0,0));super(t,{points:o,point:a,lngLats:s,lngLat:n.unproject(a),originalEvent:i}),this._defaultPrevented=!1}}class Ia extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t){super("wheel",{originalEvent:t}),this._defaultPrevented=!1}}class Ra{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new Ia(this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Da(e.type,this._map,e))}mouseup(e){this._map.fire(new Da(e.type,this._map,e))}preclick(t){const n=e.h({},t);n.type="preclick",this._map.fire(new Da(n.type,this._map,n))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new Da(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new Da(e.type,this._map,e))}mouseover(e){this._map.fire(new Da(e.type,this._map,e))}mouseout(e){this._map.fire(new Da(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ca(e.type,this._map,e))}touchmove(e){this._map.fire(new Ca(e.type,this._map,e))}touchend(e){this._map.fire(new Ca(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ca(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pa{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new Da(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Da("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Da(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ma{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(g(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t,i=this._startPos,r=this._lastPos;if(!i||!r||r.equals(n)||!this._box&&n.dist(i)<this._clickTolerance)return;this._lastPos=n,this._box||(this._box=h("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const o=Math.min(i.x,n.x),s=Math.max(i.x,n.x),a=Math.min(i.y,n.y),l=Math.max(i.y,n.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform="translate(".concat(o,"px,").concat(a,"px)"),this._box.style.width=s-o+"px",this._box.style.height=l-a+"px")})}mouseupWindow(t,n){if(!this._active)return;const i=this._startPos,r=n;if(i&&0===t.button){if(this.reset(),v(),i.x!==r.x||i.y!==r.y)return this._map.fire(new e.A("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new e.A(t,{originalEvent:n}))}}function Fa(e,t){const n={};for(let i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}class La{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){const n=new e.P(0,0);for(const e of t)n._add(e);return n.div(t.length)}(n),this.touches=Fa(i,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const i=Fa(n,t);for(const r in this.touches){const e=i[r];(!e||e.dist(this.touches[r])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class ka{constructor(e){this.singleTap=new La(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const i=this.singleTap.touchend(e,t,n);if(i){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class Oa{constructor(){this._zoomIn=new ka({numTouches:1,numTaps:2}),this._zoomOut=new ka({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const i=this._zoomIn.touchend(e,t,n),r=this._zoomOut.touchend(e,t,n);return i?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ba={0:1,2:2},za={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Na{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const n=w(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}mousemoveWindow(e,t){const n=this._lastPoint;if(n)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const n=Ba[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}mouseupWindow(e){this._lastPoint&&w(e)===this._eventButton&&(this._moved&&v(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ua extends Na{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Va extends Na{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?za[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class ja extends Na{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?za[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class Ga{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),e.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(t,n,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!e.eJ())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,i)}}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,i){i.length>0&&(this._active=!0);const r=Fa(i,n),o=new e.P(0,0),s=new e.P(0,0);let a=0;for(const e in r){const t=r[e],n=this._touches[e];n&&(o._add(t),s._add(t.sub(n)),a++,r[e]=t)}if(this._touches=r,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=h("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ha{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,n){return{}}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){const i=this._firstTwoTouches;if(!i)return;e.preventDefault();const[r,o]=i,s=Wa(n,t,r),a=Wa(n,t,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,o=Wa(n,t,i),s=Wa(n,t,r);o&&s||(this._active&&v(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Wa(e,t,n){for(let i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function qa(e,t){return Math.log(e/t)/Math.LN2}class Xa extends Ha{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(qa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qa(this._distance,n),pinchAround:t}}}function Za(e,t){return 180*e.angleWith(t)/Math.PI}class Ya extends Ha{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const n=this._vector;if(this._vector=e[0].sub(e[1]),n&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Za(this._vector,n),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=this._startVector;if(!n)return!1;const i=Za(e,n);return Math.abs(i)<t}}function Ka(e){return Math.abs(e.y)>Math.abs(e.x)}class Ja extends Ha{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Ka(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,n,i){const r=this._lastPoints;if(!r)return;const o=t[0].sub(r[0]),s=t[1].sub(r[1]);return this._map._cooperativeGestures&&!e.eJ()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(o,s,i.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(o.y+s.y)/2*-.5})}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const i=e.mag()>=2,r=t.mag()>=2;if(!i&&!r)return;if(!i||!r)return null==this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return Ka(e)&&Ka(t)&&o}}const Qa={panStep:100,bearingStep:15,pitchStep:10};class $a{constructor(){const e=Qa;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,i=0,r=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:el,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+n*this._bearingStep,pitch:s.getPitch()+i*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function el(e){return e*(2-e)}const tl=4.000244140625,nl=1/450;class il{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=nl,e.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.eJ()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const i=e.q.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%tl==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=x(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>tl?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);const r=n(),o=Math.pow(2,r),s="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(s*i))),"wheel"===this._type&&(this._startZoom=r,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),r=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&r&&o){const t=Math.min((e.q.now()-this._lastWheelEventTime)/200,1),n=o(t);s=e.ai(r,i,n),t<1?this._frameId||(this._frameId=!0):a=!0}else s=i,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let l=s-n();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=e.eK;if(this._prevEase){const t=this._prevEase,i=(e.q.now()-t.start)/t.duration,r=t.easing(i+.01)-t.easing(i),o=.27/Math.sqrt(r*r+1e-4)*.01,s=Math.sqrt(.0729-o*o);n=e.eI(o,s,.25,1)}return this._prevEase={start:e.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=h("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class rl{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ol{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sl{constructor(){this._tap=new ka({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=t[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class al{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ll{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cl{constructor(e,t,n,i){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ul=e=>e.zoom||e.drag||e.pitch||e.rotate;class hl extends e.A{}class dl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const i=e.at([],n,t);this.radius=e.ae(i[2]<0?e.eM([],i,this.constants):[i[0],i[1],0])}projectRay(t){e.eM(t,t,this.constants),e.au(t,t),e.eN(t,t,this.constants);const n=e.c1([],t,this.radius);if(n[2]>0){const t=e.c1([],[0,0,1],e.bG(n,[0,0,1])),i=e.c1([],e.au([],[n[0],n[1],0]),this.radius),r=e.d5([],n,e.c1([],e.at([],e.d5([],i,t),n),2));n[0]=r[0],n[1]=r[1]}return n}}function fl(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class pl{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ta(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new dl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),e.aV(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,r,o]of this._listeners){const t=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(r,t,o)}}destroy(){for(const[e,t,n]of this._listeners){const i=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,i,n)}}_addDefaultHandlers(e){const t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new Ra(t,e));const i=t.boxZoom=new Ma(t,e);this._add("boxZoom",i);const r=new Oa,o=new ol;t.doubleClickZoom=new rl(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const s=new sl;this._add("tapDragZoom",s);const a=t.touchPitch=new Ja(t);this._add("touchPitch",a);const l=new Va(e),c=new ja(e);t.dragRotate=new ll(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Ua(e),h=new Ga(t,e);t.dragPan=new al(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new Ya,f=new Xa;t.touchZoomRotate=new cl(n,f,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Pa(t));const p=t.scrollZoom=new il(t,this);this._add("scrollZoom",p,["mousePan"]);const m=t.keyboard=new $a;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[g]&&t[g].enable(e[g])}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ul(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,n){for(const i in e)if(i!==n&&(!t||t.indexOf(i)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,"".concat(e.type,"Window"))}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}handleEvent(e,t){this._updatingCamera=!0;const n="renderFrame"===e.type,i=n?void 0:e,r={needsRenderFrame:!1},o={},s={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?b(this._el,a):n?void 0:x(this._el,e);for(const{handlerName:h,handler:d,allowed:f}of this._handlers){if(!d.isEnabled())continue;let n;this._blockedByActive(s,f,h)?d.reset():d[t||e.type]&&(n=d[t||e.type](e,l,a),this.mergeHandlerResult(r,o,n,h,i),n&&n.needsRenderFrame&&this._triggerRenderFrame()),(n||d.isActive())&&(s[h]=d)}const c={};for(const h in this._previousActiveHandlers)s[h]||(c[h]=i);this._previousActiveHandlers=s,(Object.keys(c).length||fl(r))&&(this._changes.push([r,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||fl(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,n,i,r,o){if(!i)return;e.h(t,i);const s={handlerName:r,originalEvent:i.originalEvent||o};void 0!==i.zoomDelta&&(n.zoom=s),void 0!==i.panDelta&&(n.drag=s),void 0!==i.pitchDelta&&(n.pitch=s),void 0!==i.bearingDelta&&(n.rotate=s)}_applyChanges(){const t={},n={},i={};for(const[r,o,s]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.h(n,o),e.h(i,s);this._updateMapTransform(t,n,i),this._changes=[]}_updateMapTransform(t,n,i){const r=this._map,o=r.transform,s=e=>[e.x,e.y,e.z];if((()=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!fl(t)){const e=o.zoom;o.cameraElevationReference="sea",null!=this._originalZoom&&o._orthographicProjectionAtLowPitch&&"globe"!==o.projection.name&&0===o.pitch?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),e!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&r._stop(!0),!fl(t))return void this._fireEvents(n,i,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:f}=t;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==f&&(h=f),(l||(e=>n[e]&&!this._eventsInProgress[e])("drag"))&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const p=[0,0,0];if(a)if("mercator"===o.projection.name){const e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(a)).dir);p[0]=t[0]-e[0],p[1]=t[1]-e[1]}else{const t=o.pointCoordinate(h);if("globe"===o.projection.name){a=a.rotate(-o.angle);const n=o._pixelsPerMercatorPixel/o.worldSize;p[0]=-a.x*e.eL(e.aY(t.y))*n,p[1]=-a.y*e.eL(o.center.lat)*n}else{const e=o.pointCoordinate(h.sub(a));t&&e&&(p[0]=e.x-t.x,p[1]=e.y-t.y)}}const m=o.zoom,g=[0,0,0];if(l){const t=s(d||o.pointCoordinate3D(h)),n={dir:e.au([],e.at([],t,o._camera.position))};if(n.dir[2]<0){const i=o.zoomDeltaToMovement(t,l);e.c1(g,n.dir,i)}}const _=e.d5(p,p,g);o._translateCameraConstrained(_),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,i,!0)}_fireEvents(t,n,i){const r=ul(this._eventsInProgress),o=ul(t),s={};for(const e in t){const{originalEvent:n}=t[e];this._eventsInProgress[e]||(s["".concat(e,"start")]=n),this._eventsInProgress[e]=t[e]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in s)this._fireEvent(e,s[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:n}=t[e];this._fireEvent(e,n)}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=n[t]||i,a["".concat(e,"end")]=l)}for(const e in a)this._fireEvent(e,a[e]);const c=ul(this._eventsInProgress);if(i&&(r||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(n(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.A("moveend",{originalEvent:l})),n(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new e.A(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new hl("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ml="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class gl extends e.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=!1!==n.respectPrefersReducedMotion,e.aV(["_renderFrameCallback"],this)}getCenter(){return new e.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,n,i){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.h({offset:t},n),i)}panTo(t,n,i){return this.easeTo(e.h({center:t},n),i)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,n,i){return this.easeTo(e.h({zoom:t},n),i)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,n,i){return this.easeTo(e.h({bearing:t},n),i)}resetNorth(t,n){return this.rotateTo(0,e.h({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(e.h({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,n){t=e.aG.convert(t);const i=n&&n.bearing||0,r=n&&n.pitch||0,o=t.getNorthWest(),s=t.getSouthEast();return this._cameraForBounds(this.transform,o,s,i,r,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return null==t?e.h({},n,this.transform.padding):"number"==typeof t?{top:t,bottom:t,right:t,left:t}:e.h({},n,t)}_extendCameraOptions(t){return(t=e.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(e,t){const n=t.max[0]-t.min[0],i=t.max[1]-t.min[1];return n/i>e.aspect?n/(2*Math.tan(.5*e.fovX)*e.aspect):i/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,n,i,r,o,s){const a=t.clone(),l=this._extendCameraOptions(s);a.bearing=r,a.pitch=o;const c=e.ci.convert(n),u=e.ci.convert(i),h=.5*(c.lat+u.lat),d=.5*(c.lng+u.lng),f=e.eO(h,d),p=e.au([],f),m=e.au([],e.bF([],p,[0,1,0])),g=e.bF([],m,p),_=[m[0],m[1],m[2],0,g[0],g[1],g[2],0,p[0],p[1],p[2],0,0,0,0,1],y=[f,e.eO(c.lat,c.lng),e.eO(u.lat,c.lng),e.eO(u.lat,u.lng),e.eO(c.lat,u.lng),e.eO(h,c.lng),e.eO(h,u.lng),e.eO(c.lat,d),e.eO(u.lat,d)];let v=e.d6.fromPoints(y.map(t=>[e.bG(m,t),e.bG(g,t),e.bG(p,t)]));const x=e.ad([],v.center,_);0===e.eP(x)&&e.eQ(x,0,0,1),e.au(x,x),e.c1(x,x,e.aB),a.center=e.eR(x);const b=a.getWorldToCameraMatrix(),w=e.bi(new Float64Array(16),b);v=e.d6.applyTransform(v,e.az([],b,_));const E=this._extendAABB(v,a,l,r);if(!E)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=E,e.ad(x,x,b);const T=.5*(v.max[2]-v.min[2]),A=this._minimumAABBFrustumDistance(a,v),S=e.c1([],[0,0,1],T),D=e.d5(S,x,S),C=A+(0===a.pitch?0:e.bD(x,D)),I=a.globeCenterInViewSpace,R=e.at([],x,[I[0],I[1],I[2]]);e.au(R,R),e.c1(R,R,C);const P=e.d5([],x,R);e.ad(P,P,w);const M=e.eB/e.aB,F=e.ae(P),L=e.cb(Math.max(F*M-e.eB,Number.EPSILON),0),k=Math.min(a.zoomFromMercatorZAdjusted(L),l.maxZoom);return k>.5*(e.cX+e.cI)?(a.setProjection({name:"mercator"}),a.zoom=k,this._cameraForBounds(a,n,i,r,o,s)):{center:a.center,zoom:k,bearing:r,pitch:o}}_extendAABB(t,n,i,r){const o=.5*((i.padding.left||0)+(i.padding.right||0)),s=.5*((i.padding.top||0)+(i.padding.bottom||0)),a=s,l=o,c=o,u=s,h=n.width-(l+c),d=n.height-(a+u),f=e.at([],t.max,t.min),p=Math.min(h/f[0],d/f[1]),m=Math.min(n.scaleZoom(n.scale*p),i.maxZoom);if(isNaN(m))return null;const g=n.scale/n.zoomScale(m),_=new e.d6([t.min[0]-l*g,t.min[1]-u*g,t.min[2]],[t.max[0]+c*g,t.max[1]+a*g,t.max[2]]),y=("number"==typeof i.offset.x&&"number"==typeof i.offset.y?new e.P(i.offset.x,i.offset.y):e.P.convert(i.offset)).rotate(-e.al(r));return _.center[0]-=y.x*g,_.center[1]+=y.y*g,_}queryTerrainElevation(t,n){const i=this.transform.elevation;return i?(n=e.h({},{exaggerated:!0},n),i.getAtPoint(e.ac.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,i,r,o,s){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,n,i,r,o,s);const a=t.clone(),l=this._extendCameraOptions(s);a.bearing=r,a.pitch=o;const c=e.ci.convert(n),u=e.ci.convert(i),h=new e.ci(c.lng,u.lat),d=new e.ci(u.lng,c.lat),f=a.project(c),p=a.project(u),m=this.queryTerrainElevation(c),g=this.queryTerrainElevation(u),_=this.queryTerrainElevation(h),y=this.queryTerrainElevation(d),v=[[f.x,f.y,Math.min(m||0,g||0,_||0,y||0)],[p.x,p.y,Math.max(m||0,g||0,_||0,y||0)]];let x=e.d6.fromPoints(v);const b=a.getWorldToCameraMatrix(),w=e.bi(new Float64Array(16),b);x=e.d6.applyTransform(x,b);const E=this._extendAABB(x,a,l,r);if(!E)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");x=E;const T=.5*e.at([],x.max,x.min)[2],A=this._minimumAABBFrustumDistance(a,x),S=[0,0,1,0];e.aA(S,S,b),e.eS(S,S);const D=e.c1([],S,A+T),C=e.d5([],x.center,D);e.ad(x.center,x.center,w),e.ad(C,C,w);const I=a.unproject(new e.P(x.center[0],x.center[1])),R=e.eT(a.projection,I),P=Math.pow(2,R),M=Math.min(a._zoomFromMercatorZ(C[2]*a.pixelsPerMeter*P/a.worldSize),l.maxZoom);return a.mercatorFromTransition&&M<.5*(e.cX+e.cI)?(a.setProjection({name:"globe"}),a.zoom=M,this._cameraForBounds(a,n,i,r,o,s)):{center:I,zoom:M,bearing:r,pitch:o}}fitBounds(e,t,n){const i=this.cameraForBounds(e,t);return this._fitInternal(i,t,n)}fitScreenCoordinates(t,n,i,r,o){const s=e.P.convert(t),a=e.P.convert(n),l=new e.P(Math.min(s.x,a.x),Math.min(s.y,a.y)),c=new e.P(Math.max(s.x,a.x),Math.max(s.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(s,a))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new e.P(l.x,c.y)),f=this.transform.pointLocation3D(new e.P(c.x,l.y)),p=[Math.min(u.lng,h.lng,d.lng,f.lng),Math.min(u.lat,h.lat,d.lat,f.lat)],m=[Math.max(u.lng,h.lng,d.lng,f.lng),Math.max(u.lat,h.lat,d.lat,f.lat)],g=r&&r.pitch?r.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,p,m,i,g,r);return this._fitInternal(_,r,o)}_fitInternal(t,n,i){return t?(n=e.h(t,n)).linear?this.easeTo(n,i):this.flyTo(n,i):this}jumpTo(t,n){this.stop();const i=t.preloadOnly?this.transform.clone():this.transform;let r=!1,o=!1,s=!1;"zoom"in t&&i.zoom!==+t.zoom&&(r=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=e.ci.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(o=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(s=!0,i.pitch=+t.pitch);const a="number"==typeof t.padding?this._extendPadding(t.padding):t.padding;if(null!=t.padding&&!i.isPaddingEqual(a))if(!1===t.retainPadding){const e=i.clone();e.padding=a,i.setLocationAtPoint(i.center,e.centerPoint)}else i.padding=a;return t.preloadOnly?(this._preloadTiles(i),this):(this.fire(new e.A("movestart",n)).fire(new e.A("move",n)),r&&this.fire(new e.A("zoomstart",n)).fire(new e.A("zoom",n)).fire(new e.A("zoomend",n)),o&&this.fire(new e.A("rotatestart",n)).fire(new e.A("rotate",n)).fire(new e.A("rotateend",n)),s&&this.fire(new e.A("pitchstart",n)).fire(new e.A("pitch",n)).fire(new e.A("pitchend",n)),this.fire(new e.A("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(ml),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const i=this.transform;if(!i.projection.supportsFreeCamera)return e.w(ml),this;this.stop();const r=i.zoom,o=i.pitch,s=i.bearing;i.setFreeCameraOptions(t);const a=r!==i.zoom,l=o!==i.pitch,c=s!==i.bearing;return this.fire(new e.A("movestart",n)).fire(new e.A("move",n)),a&&this.fire(new e.A("zoomstart",n)).fire(new e.A("zoom",n)).fire(new e.A("zoomend",n)),c&&this.fire(new e.A("rotatestart",n)).fire(new e.A("rotate",n)).fire(new e.A("rotateend",n)),l&&this.fire(new e.A("pitchstart",n)).fire(new e.A("pitch",n)).fire(new e.A("pitchend",n)),this.fire(new e.A("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=e.h({offset:[0,0],duration:500,easing:e.eK},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const i=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h=this._extendPadding(t.padding),d=e.P.convert(t.offset);let f,p,m;if("globe"===i.projection.name){const n=e.ac.fromLngLat(i.center),r=d.rotate(-i.angle);n.x+=r.x/i.worldSize,n.y+=r.y/i.worldSize;const o=n.toLngLat(),s=e.ci.convert(t.center||o);this._normalizeCenter(s),f=i.centerPoint.add(r),p=new e.P(n.x,n.y).mult(i.worldSize),m=new e.P(e.aD(s.lng),e.aH(s.lat)).mult(i.worldSize).sub(p)}else{f=i.centerPoint.add(d);const n=i.pointLocation(f),r=e.ci.convert(t.center||n);this._normalizeCenter(r),p=i.project(n),m=i.project(r).sub(p)}const g=i.zoomScale(l-r);let _,y;t.around&&(_=e.ci.convert(t.around),y=i.locationPoint(_));const v=this._zooming||l!==r,x=this._rotating||o!==c,b=this._pitching||u!==s,w=!i.isPaddingEqual(h),E=!1===t.retainPadding?i.clone():i,T=i=>T=>{if(v&&(i.zoom=e.ai(r,l,T)),x&&(i.bearing=e.ai(o,c,T)),b&&(i.pitch=e.ai(s,u,T)),w&&(E.interpolatePadding(a,h,T),f=E.centerPoint.add(d)),_)i.setLocationAtPoint(_,y);else{const e=i.zoomScale(i.zoom-r),t=l>r?Math.min(2,g):Math.max(.5,g),n=Math.pow(t,1-T),o=i.unproject(p.add(m.mult(T*n)).mult(e));i.setLocationAtPoint(i.renderWorldCopies?o.wrap():o,f)}return t.preloadOnly||this._fireMoveEvents(n),i};if(t.preloadOnly){const e=this._emulate(T,t.duration,i);return this._preloadTiles(e),this}const A={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,A),this._ease(T(i),e=>{"sea"===i.cameraElevationReference&&i.recenterOnTerrain(),this._afterEase(n,e)},t),this}_prepareEase(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),n||i.moving||this.fire(new e.A("movestart",t)),this._zooming&&!i.zooming&&this.fire(new e.A("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new e.A("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new e.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.A("move",t)),this._zooming&&this.fire(new e.A("zoom",t)),this._rotating&&this.fire(new e.A("rotate",t)),this._pitching&&this.fire(new e.A("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const i=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new e.A("zoomend",t)),r&&this.fire(new e.A("rotateend",t)),o&&this.fire(new e.A("pitchend",t)),this.fire(new e.A("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const i=e.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(i,n)}this.stop(),t=e.h({offset:[0,0],speed:1.2,curve:1.42,easing:e.eK},t);const i=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?e.ay(+t.zoom,i.minZoom,i.maxZoom):r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h=this._extendPadding(t.padding),d=i.zoomScale(l-r),f=e.P.convert(t.offset);let p=i.centerPoint.add(f);const m=i.pointLocation(p),g=e.ci.convert(t.center||m);this._normalizeCenter(g);const _=i.project(m),y=i.project(g).sub(_);let v=t.curve;const x=Math.max(i.width,i.height),b=x/d,w=y.mag();if("minZoom"in t){const n=e.ay(Math.min(t.minZoom,r,l),i.minZoom,i.maxZoom),o=x/i.zoomScale(n-r);v=Math.sqrt(o/w*2)}const E=v*v;function T(e){const t=(b*b-x*x+(e?-1:1)*E*E*w*w)/(2*(e?b:x)*E*w);return Math.log(Math.sqrt(t*t+1)-t)}function A(e){return(Math.exp(e)-Math.exp(-e))/2}function S(e){return(Math.exp(e)+Math.exp(-e))/2}const D=T(0);let C=function(e){return S(D)/S(D+v*e)},I=function(e){return x*((S(D)*(A(t=D+v*e)/S(t))-A(D))/E)/w;var t},R=(T(1)-D)/v;if(Math.abs(w)<1e-6||!isFinite(R)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,n);const e=b<x?-1:1;R=Math.abs(Math.log(b/x))/v,I=function(){return 0},C=function(t){return Math.exp(e*v*t)}}t.duration="duration"in t?+t.duration:1e3*R/("screenSpeed"in t?+t.screenSpeed/v:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const P=o!==c,M=u!==s,F=!i.isPaddingEqual(h),L=!1===t.retainPadding?i.clone():i,k=i=>d=>{const m=d*R,v=1/C(m);i.zoom=1===d?l:r+i.scaleZoom(v),P&&(i.bearing=e.ai(o,c,d)),M&&(i.pitch=e.ai(s,u,d)),F&&(L.interpolatePadding(a,h,d),p=L.centerPoint.add(f));const x=1===d?g:i.unproject(_.add(y.mult(I(m))).mult(v));return i.setLocationAtPoint(i.renderWorldCopies?x.wrap():x,p),i._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),i};if(t.preloadOnly){const e=this._emulate(k,t.duration,i);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=P,this._pitching=M,this._padding=F,this._prepareEase(n,!1),this._ease(k(i),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,n,i){!1===i.animate||0===i.duration?(t(1),n()):(this._easeStart=e.q.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=e.bQ(t,-180,180);const i=Math.abs(t-n);return Math.abs(t-360-n)<i&&(t-=360),Math.abs(t+360-n)<i&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,n){const i=Math.ceil(15*t/1e3),r=[],o=e(n.clone());for(let s=0;s<=i;s++){const e=o(s/i);r.push(e.clone())}return r}_preloadTiles(e,t){}}class _l{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,e.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact,n=e._getUIString("AttributionControl.ToggleAttribution");this._map=e,this._container=h("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=h("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",n);const i=h("span","mapboxgl-ctrl-icon",this._compactButton);return i.setAttribute("aria-hidden","true"),i.setAttribute("title",n),this._innerContainer=h("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.e.ACCESS_TOKEN}];if(t){const i=n.reduce((e,t,i)=>(t.value&&(e+="".concat(t.key,"=").concat(t.value).concat(i<n.length-1?"&":"")),e),"?");t.href="".concat(e.e.FEEDBACK_URL,"/").concat(i,"#").concat(ya(this._map,!0)),t.rel="noopener nofollow"}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const i in t){const n=t[i];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort((e,t)=>e.length-t.length),e=e.filter((t,n)=>{for(let i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yl{constructor(){e.aV(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=h("div","mapboxgl-ctrl");const t=h("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class vl{constructor(){e.aV(["_onIndoorUpdate"],this)}onAdd(e){return this._map=e,this._container=h("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",e=>this._onIndoorUpdate({selectedFloorId:e.selectedFloorId,floors:e.floors})),this._container}_createButton(e,t){const n=h("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){this._map&&(e.setAttribute("aria-label",t),e.innerHTML="<strong>".concat(t,"</strong>"),e.firstElementChild&&e.firstElementChild.setAttribute("title",t))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(e){if(!e||!e.floors)return void(this._container.style.display="none");const t=this._model;this._model=e,this._container.style.display="inline-block";const n=e.floors.sort((e,t)=>e.levelOrder-t.levelOrder);t?(Array.from(this._container.children).forEach(e=>e.remove()),this.addCurrentFloors(n)):this.addCurrentFloors(n)}addCurrentFloors(e){for(const t of e){const e=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(t.id),Array.from(this._container.children).forEach(e=>{e.classList.remove("mapboxgl-ctrl-level-button-selected")}),e.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(e,t.shortName),this._model&&t.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(t.id),e.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(e)}}}class xl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const i of n)if(i.id===e)return void(i.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class bl{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=e.dx((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,n){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+n}}const wl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class El extends e.A{constructor(e,t,n,i){const{point:r,lngLat:o,originalEvent:s,target:a}=e;super(e.type,{point:r,lngLat:o,originalEvent:s,target:a}),this.preventDefault=()=>{e.preventDefault()},this.id=t,this.interaction=n,this.feature=i}}class Tl{constructor(e){this.map=e,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error('Interaction id "'.concat(t,'" already exists.'));const i=n.filter;let r=n.type;i&&this.filters.set(t,e.b3(i)),"mouseover"===r&&(r="mouseenter"),"mouseout"===r&&(r="mouseleave");const o=this.interactionsByType.get(r)||new Map;"mouseenter"===r||"mouseleave"===r?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):0===o.size&&this.map.on(r,this.handleType),0===o.size&&this.interactionsByType.set(r,o),o.set(t,n),this.typeById.set(t,r)}get(e){const t=this.typeById.get(e);if(!t)return;const n=this.interactionsByType.get(t);return n?n.get(e):void 0}remove(e){const t=this.typeById.get(e);if(!t)return;this.typeById.delete(e),this.filters.delete(e);const n=this.interactionsByType.get(t);n&&(n.delete(e),"mouseenter"===t||"mouseleave"===t?(this.delegatedInteractions.delete(e),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===n.size&&this.map.off(t,this.handleType))}queryTargets(e,t){const n=[];for(const[i,r]of t)r.target&&n.push({targetId:i,target:r.target,filter:this.filters.get(i)});return this.map.style.queryRenderedTargets(e,n,this.map.transform)}handleMove(e){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const t=this.queryTargets(e.point,Array.from(this.delegatedInteractions).reverse());t.length&&(e.type="mouseenter",this.handleType(e,t));const n=new Map;for(const[i,{feature:r}]of this.prevHoveredFeatures)this.hoveredFeatures.has(i)||n.set(r.id,r);n.size&&(e.type="mouseleave",this.handleType(e,Array.from(n.values())))}handleOut(e){const t=Array.from(this.hoveredFeatures.values()).map(e=>{let{feature:t}=e;return t});t.length&&(e.type="mouseleave",this.handleType(e,t)),this.hoveredFeatures.clear()}handleType(t,n){const i="mouseenter"===t.type;if(i&&!this.interactionsByType.has(t.type))return void e.w("mouseenter interaction required for mouseleave to work.");const r=Array.from(this.interactionsByType.get(t.type)).reverse(),o=!!n;n=n||this.queryTargets(t.point,r);let s=!1;const a=new Set;for(const l of n){for(const[n,c]of r){if(!c.target)continue;const r=l.variants?l.variants[n]:null;if(r){for(const u of r){if(ht(u,l,a,n))continue;const r=new e.dr(l,u),h=ut(u,l,n);o&&(r.state=this.map.getFeatureState(r));const d=i?this.prevHoveredFeatures.get(h):null,f=new El(t,n,c,r),p=d?d.stop:c.handler(f);if(i&&this.hoveredFeatures.set(h,{feature:l,stop:p}),!1!==p){s=!0;break}}if(s)break}}if(s)break}if(!s)for(const[e,l]of r){const{handler:n,target:i}=l;if(!i&&!1!==n(new El(t,e,l,null)))break}}}function Al(t,n){if(Array.isArray(t)&&Array.isArray(n)){const e=new Set(t),i=new Set(n);return e.size===i.size&&t.every(e=>i.has(e))}return e.bv(t,n)}const Sl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Dl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cl{constructor(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=n,this.mouseRotate=new Va({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new ja({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),g()}move(e,t){const n=this.map,i=this.mouseRotate.mousemoveWindow(e,t),r=i&&i.bearingDelta;if(r&&n.setBearing(n.getBearing()+r),this.mousePitch){const i=this.mousePitch.mousemoveWindow(e,t),r=i&&i.pitchDelta;r&&n.setPitch(n.getPitch()+r)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),x(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,x(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=b(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=b(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Il(t,n,i){if(t=new e.ci(t.lng,t.lat),n){const r=new e.ci(t.lng-360,t.lat),o=new e.ci(t.lng+360,t.lat),s=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),a=i.locationPoint3D(t).distSqr(n),l=n.x<0||n.y<0||n.x>i.width||n.y>i.height;i.locationPoint3D(r).distSqr(n)<a&&(l||Math.abs(r.lng-i.center.lng)<s)?t=r:i.locationPoint3D(o).distSqr(n)<a&&(l||Math.abs(o.lng-i.center.lng)<s)&&(t=o)}for(;Math.abs(t.lng-i.center.lng)>180;){const e=i.locationPoint3D(t);if(e.x>=0&&e.y>=0&&e.x<=i.width&&e.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}const Rl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Pl={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Ml extends e.E{constructor(t,n){super(),(t instanceof HTMLElement||n)&&(t=e.h({element:t},n)),e.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:i="center",color:r="#3FB1CE",scale:o=1,draggable:s=!1,clickTolerance:a=0,rotation:l=Pl.rotation,rotationAlignment:c=Pl.rotationAlignment,pitchAlignment:u=Pl.pitchAlignment,occludedOpacity:h=Pl.occludedOpacity,altitude:d=Pl.altitude}=t||{};this._anchor=i,this._color=r,this._scale=o,this._draggable=s,this._clickTolerance=a,this._rotation=l,this._rotationAlignment=c,this._pitchAlignment=u,this._occludedOpacity=h,this._altitude=d,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=e.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()});const f=this._element.classList;for(const e in Rl)f.remove("mapboxgl-marker-anchor-".concat(e));f.add("mapboxgl-marker-anchor-".concat(this._anchor));const p=t&&t.className?t.className.trim().split(/\s+/):[];f.add(...p),this._popup=null}_createDefaultMarker(){const e=h("div"),t=d("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},e);if(0===this._altitude){const e=d("radialGradient",{id:"shadowGradient"},d("defs",{},t));d("stop",{offset:"10%","stop-opacity":.4},e),d("stop",{offset:"100%","stop-opacity":.05},e),d("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},t)}return d("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},t),d("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},t),d("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},t),e}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.ci.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(e){return e===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==e||0!==this._altitude&&0===e)&&(this._element=this._createDefaultMarker()),this._altitude=e||Pl.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,i=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-n+i)],"bottom-right":[-i,-1*(t-n+i)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,e._marker=this,e._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const n=e.unproject(t,this._altitude),i=e.getFreeCameraOptions();if(!i.position)return!1;const r=i.position.toLngLat();return r.distanceTo(n)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const i=t.unproject(n,this._altitude);let r;t._showingGlobe()&&e.eW(t.transform,this._lngLat)?r=0:(r=1-t._queryFogOpacity(i),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity="".concat(r),this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(e.x,"px,").concat(e.y,"px)\n            ").concat(Rl[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(t.x,"px,").concat(t.y,"px)\n        ")}_calculateXYTransform(){const t=this._pos,n=this._map,i=this.getPitchAlignment();if(!n||!t||"map"!==i)return"";if(!n._showingGlobe()){const e=n.getPitch();return e?"rotateX(".concat(e,"deg)"):""}const r=e.cU(e.eX(n.transform,this._lngLat)),o=t.sub(e.eY(n.transform)),s=Math.abs(o.x)+Math.abs(o.y);if(0===s)return"";const a=r/s;return"rotateX(".concat(-o.y*a,"deg) rotateY(").concat(o.x*a,"deg)")}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let i=0;const r=this.getRotationAlignment();if("map"===r)if(n._showingGlobe()){const t=n.project(new e.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),r=n.project(new e.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(t);i=e.cU(Math.atan2(r.y,r.x))-90}else i=-n.getBearing();else if("horizon"===r){const r=e.af(4,6,n.getZoom()),o=e.eY(n.transform);o.y+=r*n.transform.height;const s=t.sub(o),a=e.cU(Math.atan2(s.y,s.x));i=(a>90?a-270:a+90)*(1-r)}return i+=this._rotation,i?"rotateZ(".concat(i,"deg)"):""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=Il(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat,this._altitude),!0===e?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),t._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const n=this._map;if(!n)return;const i=this._pointerdownPos,r=this._positionDelta;if(i&&r){if(!this._isDragging){const e=this._clickTolerance||n._clickTolerance;if(t.point.dist(i)<e)return;this._isDragging=!0}this._pos=t.point.sub(r),this._lngLat=n.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.A("dragstart"))),this.fire(new e.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.A("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,n=this._pos;t&&n&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(n),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||Pl.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||Pl.rotationAlignment,this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||Pl.pitchAlignment,this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||Pl.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Fl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ll={maxWidth:100,unit:"metric"},kl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ol={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Bl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zl(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.P(0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof t){const i=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(n){case"top":return new e.P(0,t);case"top-left":return new e.P(i,i);case"top-right":return new e.P(-i,i);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(i,-i);case"bottom-right":return new e.P(-i,-i);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[n]||[0,0])}const Nl={version:t,supported:u.supported,setRTLTextPlugin:e.f0,getRTLTextPluginStatus:e.e$,Map:class extends gl{constructor(t){s.mark(n.create);const i=t;if(null!=(t=e.h({},Sl,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.eU(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ii(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies,null,null),t),this._repaint=!!t.repaint,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new xl,this._domRenderTaskQueue=new xl,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.a$(),this._locale=e.h({},wl,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._tessellationStep=t.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=t.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=t.scaleFactor,this._requestManager=new S(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?Object.assign({},t.contextCreateOptions):{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error("Container '".concat(t.container.toString(),"' not found."));this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),this._spriteFormat=t.spriteFormat,e.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new $s),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new pl(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.e.DEFAULT_STYLE,{config:t.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),this.indoor=new vi(this),t.hash&&(this._hash=new _a("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==i.center&&null==i.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const n=t.bounds;n&&(this.resize(),this.fitBounds(n,e.h({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new _l({customAttribution:t.customAttribution})),this._logoControl=new yl,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new e.A("".concat(t.dataType,"data"),t))}),this.on("dataloading",t=>{this.fire(new e.A("".concat(t.dataType,"dataloading"),t))}),this._interactions=new Tl(this)}_getMapId(){return this._mapId}addControl(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new e.A("movestart",t)).fire(new e.A("move",t)),this.fire(new e.A("resize",t)),n&&this.fire(new e.A("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.aG.convert(t)),this._update()}setMinZoom(t){if((t=null!==t&&void 0!==t?t:-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null!==t&&void 0!==t?t:22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null!==t&&void 0!==t?t:0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null!==t&&void 0!==t?t:85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(e){return this._scaleFactor=e,this.painter.scaleFactor=e,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(e=>"symbol"===e.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(e=>"auto"===e?navigator.language:e):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,n=t.projection.name;let i;"globe"===n&&t.zoom>=e.cI?(t.setMercatorFromTransition(),i=!0):"mercator"===n&&t.zoom<e.cI&&(t.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let n;return n="globe"===t.name&&this.transform.zoom>=e.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t,n){return this.transform.locationPoint3D(e.ci.convert(t),n)}unproject(t,n){return this.transform.pointLocation3D(e.P.convert(t),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,n){const i=e=>{let n=[];if(Array.isArray(t)){const i=t.filter(e=>this.getLayer(e));n=i.length?this.queryRenderedFeatures(e,{layers:i}):[]}else n=this.queryRenderedFeatures(e,{target:t});return n};if("mouseenter"===e||"mouseover"===e){let r=!1;const o=t=>{const o=i(t.point);o.length?r||(r=!0,n.call(this,new Da(e,this,t.originalEvent,{features:o}))):r=!1};return{listener:n,targets:t,delegates:{mousemove:o,mouseout:()=>{r=!1}}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const o=t=>{i(t.point).length?r=!0:r&&(r=!1,n.call(this,new Da(e,this,t.originalEvent)))},s=t=>{r&&(r=!1,n.call(this,new Da(e,this,t.originalEvent)))};return{listener:n,targets:t,delegates:{mousemove:o,mouseout:s}}}{const r=e=>{const t=i(e.point);t.length&&(e.features=t,n.call(this,e),delete e.features)};return{listener:n,targets:t,delegates:{[e]:r}}}}on(e,t,n){if("function"==typeof t||void 0===n)return super.on(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const i=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const r in i.delegates)this.on(r,i.delegates[r]);return this}once(e,t,n){if("function"==typeof t||void 0===n)return super.once(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const i=this._createDelegatedListener(e,t,n);for(const r in i.delegates)this.once(r,i.delegates[r]);return this}off(e,t,n){if("function"==typeof t||void 0===n)return super.off(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const i=this._delegatedListeners?this._delegatedListeners[e]:void 0;return i&&(e=>{for(let i=0;i<e.length;i++){const r=e[i];if(r.listener===n&&Al(r.targets,t)){for(const e in r.delegates)this.off(e,r.delegates[e]);return e.splice(i,1),this}}})(i),this}queryRenderedFeatures(t,n){if(!this.style)return[];if(void 0===t||t instanceof e.P||Array.isArray(t)||void 0!==n||(n=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],!n){const e=this.style.queryRenderedFeatures(t,void 0,this.transform),n=this.style.queryRenderedFeatureset(t,void 0,this.transform);return e.concat(n)}let i=!0;if(n.target&&(i=this._isTargetValid(n.target),i&&!n.layers))return this.style.queryRenderedFeatureset(t,n,this.transform);let r=!0;if(n.layers&&Array.isArray(n.layers)){for(const e of n.layers)if(!this._isValidId(e)){r=!1;break}if(r&&!n.target)return this.style.queryRenderedFeatures(t,n,this.transform)}let o=[];return r&&(o=o.concat(this.style.queryRenderedFeatures(t,n,this.transform))),i&&(o=o.concat(this.style.queryRenderedFeatureset(t,n,this.transform))),o}querySourceFeatures(e,t){return!e||"string"==typeof e&&!this._isValidId(e)?[]:this.style.querySourceFeatures(e,t)}isPointOnSurface(t){const{name:n}=this.transform.projection;return"globe"!==n&&"mercator"!==n&&e.w("".concat(n," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(e.P.convert(t))}addInteraction(e,t){return this._interactions.add(e,t),this}removeInteraction(e){return this._interactions.remove(e),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(e){return this._cooperativeGestures=e,this}setStyle(t,n){return n=e.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&t&&!1!==n.diff&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(t,(i,r)=>{if(i){const r="string"==typeof i?i:i instanceof Error?i.message:i.error;e.w("Unable to perform style diff: ".concat(r,". Rebuilding the style from scratch.")),this._updateStyle(t,n)}else r&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(t,n))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}_updateStyle(t,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t){const i=e.h({},n);n&&n.config&&(i.initialConfig=n.config,delete i.config),this.style=new Ii(this,i).load(t),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ii(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.z(new Error("IDs can't be empty."))),!1):!e.dk(t)||(this.fire(new e.z(new Error("IDs can't contain special symbols: \"".concat(t,'".')))),!1)}_isTargetValid(e){return"featuresetId"in e?this._isValidId("importId"in e?e.importId:e.featuresetId):"layerId"in e&&this._isValidId(e.layerId)}_areTargetsValid(e){if(Array.isArray(e)){for(const t of e)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(e)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,n){let{pixelRatio:i=1,sdf:r=!1,stretchX:o,stretchY:s,content:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._lazyInitEmptyStyle();const l=e.I.from(t);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:t,height:c,data:u}=e.q.getImageData(n);this.style.addImage(l,{data:new e.r({width:t,height:c},u),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:r,version:0,usvg:!1})}else if(void 0===n.width||void 0===n.height)this.fire(new e.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:c,height:u}=n,h=n;this.style.addImage(l,{data:new e.r({width:c,height:u},new Uint8Array(h.data)),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:r,usvg:!1,version:0,userImage:h}),h.onAdd&&h.onAdd(this,t)}}updateImage(t,n){this._lazyInitEmptyStyle();const i=e.I.from(t),r=this.style.getImage(i);if(!r)return void this.fire(new e.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?e.q.getImageData(n):n,{width:s,height:a,data:l}=o;if(void 0===s||void 0===a)return void this.fire(new e.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==(r.usvg?r.icon.usvg_tree.width:r.data.width)||a!==(r.usvg?r.icon.usvg_tree.height:r.data.height))return void this.fire(new e.z(new Error("The width and height of the updated image (".concat(s,", ").concat(a,")\n                must be that same as the previous version of the image\n                (").concat(r.data.width,", ").concat(r.data.height,")"))));const c=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let u=!1;r.usvg?(r.data=new e.r({width:s,height:a},new Uint8Array(l)),r.usvg=!1,r.icon=void 0,u=!0):r.data.replace(l,c),this.style.updateImage(i,r,u)}hasImage(t){return t?!!this.style&&!!this.style.getImage(e.I.from(t)):(this.fire(new e.z(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(e.I.from(t))}loadImage(t,n){e.o(this._requestManager.transformRequest(t,e.R.Image),(t,i)=>{n(t,i instanceof HTMLImageElement?e.q.getImageData(i):i)})}listImages(){return this.style.listImages().map(e=>e.name)}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.z(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(t,n){return this.style.addImport(t,n).catch(t=>this.fire(new e.z(new Error("Failed to add import",t)))),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){if(!this._isValidId(e))return null;const t=this.style.getOwnLayer(e);return t?"custom"===t.type?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(e,t,n){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,n),this._update(!0)):this}setFilter(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,n),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,n,i),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,n,i),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(e){return this.style.setGlyphsUrl(e),this._update(!0)}getSchema(e){return this.style.getSchema(e)}setSchema(e,t){return this.style.setSchema(e,t),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,t){return this.style.setConfig(e,t),this._update(!0)}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,n){return this.style.setConfigProperty(e,t,n),this._update(!0)}getFeaturesetDescriptors(e){return this.style.getFeaturesetDescriptors(e)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(e){return this._lazyInitEmptyStyle(),this.style.setSnow(e),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(e){return this._lazyInitEmptyStyle(),this.style.setRain(e),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(e){return this._lazyInitEmptyStyle(),this.style.setColorTheme(e),this._update(!0)}setImportColorTheme(e,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(e,t),this._update(!0)}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.ci.convert(t),this.transform):0}setFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.setFeatureState(e,t),this._update())}removeFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.removeFeatureState(e,t),this._update())}getFeatureState(e){return e.source&&!this._isValidId(e.source)?null:this.style.getFeatureState(e)}_selectIndoorFloor(e){this.indoor.selectFloor(e)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new vl),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,i,r,o=this._container;for(;o&&(!i||!r);){const e=window.getComputedStyle(o).transform;e&&"none"!==e&&(n=e.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(i=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(r=n[3])),o=o.parentElement}this._containerWidth=i?Math.abs(e/i):e,this._containerHeight=r?Math.abs(t/r):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=h("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=h("div","mapboxgl-canvas-container",e);this._canvas=h("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=h("div","mapboxgl-control-container",e),i=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(e=>{i[e]=h("div","mapboxgl-ctrl-".concat(e),n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,n){const i=e.q.devicePixelRatio||1;this._canvas.width=i*Math.ceil(t),this._canvas.height=i*Math.ceil(n),this._canvas.style.width="".concat(t,"px"),this._canvas.style.height="".concat(n,"px")}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.h({},u.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",t);n?(H(n,!0),this.painter=new ma(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)}),e.l.testSupport(n)):this.fire(new e.z(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.A("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new e.A("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;this.fire(new e.A("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,o=e.q.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=a.createQuery(),a.beginQuery(r.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,n=this.transform.pitch,i=e.q.now(),r=new e.aa(t,{now:i,fadeDuration:l,pitch:n,transition:this.style.transition,worldview:this._worldview});this.style.update(r)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let c=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),c=this._updateAverageElevation(o),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):c=this._updateAverageElevation(o);const u=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),u&&(this._placementDirty=u.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.mark(n.load),this.fire(new e.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.q.now()-o;a.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const n=a.getQueryParameter(i,a.QUERY_RESULT)/1e6;a.deleteQuery(i),this.fire(new e.A("gpu-timing-frame",{cpuTime:t,gpuTime:n}))},50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout(()=>{const n=this.painter.queryGpuTimers(t);this.fire(new e.A("gpu-timing-layer",{layerTimes:n}))},50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const n=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.A("gpu-timing-deferred-render",{gpuTime:n}))},50)}const h=this._sourcesDirty||this._styleDirty||this._placementDirty||c;if(h||this._repaint)this.triggerRepaint();else{const t=this.idle();if(t&&(c=this._updateAverageElevation(o,!0)),c)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.A("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,s.mark(n.fullLoad),this._performanceMetricsCollection&&U(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let r=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-r);if(o>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(r),n(r);this._averageElevation.easeTo(r,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(r),n(r)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){j(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===A||401===t.status)){const t=this.painter.context.gl;H(t,!1),this._logoControl instanceof yl&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),O(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&z(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function r(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,n){let i=n[1]-n[0];const r=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);i+=(n[o+2]-n[o+1])*(1-a/r)}return i}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),G.delete(this.painter.context.gl),V.remove(),k.remove(),this._removed=!0,this.fire(new e.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.q.frame(e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)}))}_preloadTiles(t){const n=this.style?this.style.getSourceCaches():[];return e.bt(n,(e,n)=>e._preloadTiles(t,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this._tp.refreshUI(),e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,this._tp.refreshUI(),e&&this._update())}_setCacheLimits(t,n){e.eV(t,n)}get version(){return t}},NavigationControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e.h({},Dl,t),this._container=h("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(e.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),h("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),h("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))}),this._compassIcon=h("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),n=t===e.getMaxZoom(),i=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(e.transform.pitch,"deg) rotateZ(").concat(e.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(e.transform.angle*(180/Math.PI),"deg)");e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cl(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const n=h("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){if(!this._map)return;const n=this._map._getUIString("NavigationControl.".concat(t));e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends e.E{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const n=navigator.geolocation;this.options=e.h({geolocation:n},Fl,t),e.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ga(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=h("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var t=this;const n=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!t.options.geolocation;t._supportsGeolocation=n,e(n)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(e=>n("denied"!==e.state)).catch(()=>n()):n()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.A("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("geolocate",t)),this._finish()}}_updateCamera(t){const n=new e.ci(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=this._map.getBearing(),o=e.h({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),o,{geolocateSource:!0})}_updateMarker(t){if(t){const n=new e.ci(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,n=e.cb(1,t._center.lat)*t.worldSize,i=Math.ceil(2*this._accuracy*n);this._circleElement.style.width="".concat(i,"px"),this._circleElement.style.height="".concat(i,"px")}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=h("button","mapboxgl-ctrl-geolocate",this._container),h("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=h("div","mapboxgl-user-location"),this._dotElement.appendChild(h("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(h("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ml({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=h("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ml({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.A("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_l,ScaleControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e.h({},Ll,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,i=t._containerWidth/2-e/2,r=t.unproject([i,n]),o=t.unproject([i+e,n]),s=r.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*s;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,t,n){this._map._requestDomTask(()=>{const i=function(e){const t=Math.pow(10,"".concat(Math.floor(e)).length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(t),r=i/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(i):"".concat(i,"&nbsp;").concat(kl[n]),this._container.style.width=e*r+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=h("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=h("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=h("button","mapboxgl-ctrl-fullscreen",this._controlContainer);h("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:vl,Popup:class extends e.E{constructor(t){super(),this.options=e.h(Object.create(Ol),t),this._altitude=this.options.altitude,e.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.A("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.ci.convert(t),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(e){return this._altitude=e,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),n=document.createElement("body");let i;for(n.innerHTML=e;i=n.firstChild,i;)t.appendChild(i);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=h("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=h("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.innerHTML='<span aria-hidden="true">&#215;</span>',e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,i=this._pos;if(!t||!n||!i)return"bottom";const r=n.offsetWidth,o=n.offsetHeight,s=i.x<r/2,a=i.x>t.transform.width-r/2;if(i.y+e<o)return s?"top-left":a?"top-right":"top";if(i.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const n=this._map,i=this._content;if(!n||!this._lngLat&&!this._trackPointer||!i)return;let r=this._container;if(r||(r=this._container=h("div","mapboxgl-popup",n.getContainer()),this._tip=h("div","mapboxgl-popup-tip",r),r.appendChild(i)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Il(this._lngLat,this._pos,n.transform)),!this._trackPointer||t){const i=this._pos=this._trackPointer&&t instanceof e.P?t:n.project(this._lngLat,this._altitude),r=zl(this.options.offset),o=this._anchor=this._getAnchor(r.y),s=zl(this.options.offset,o),a=i.add(s).round();n._requestDomTask(()=>{this._container&&o&&(this._container.style.transform="".concat(Rl[o]," translate(").concat(a.x,"px,").concat(a.y,"px)"))})}if(!this._marker&&n._showingGlobe()){const t=e.eW(n.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(Bl);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity="".concat(e)),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Ml,Style:Ii,LngLat:e.ci,LngLatBounds:e.aG,Point:e.P,MercatorCoordinate:e.ac,FreeCameraOptions:Qn,Evented:e.E,config:e.e,prewarm:e.e_,clearPrewarmedResources:e.eZ,get accessToken(){return e.e.ACCESS_TOKEN},set accessToken(t){e.e.ACCESS_TOKEN=t},get baseApiUrl(){return e.e.API_URL},set baseApiUrl(t){e.e.API_URL=t},get workerCount(){return e.f7.workerCount},set workerCount(t){e.f7.workerCount=t},get maxParallelImageRequests(){return e.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.e.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.f6(t)},get workerUrl(){return e.f5.workerUrl},set workerUrl(t){e.f5.workerUrl=t},get workerClass(){return e.f5.workerClass},set workerClass(t){e.f5.workerClass=t},get workerParams(){return e.f5.workerParams},set workerParams(t){e.f5.workerParams=t},get dracoUrl(){return e.f4()},set dracoUrl(t){e.f3(t)},get meshoptUrl(){return e.f2()},set meshoptUrl(t){e.f1(t)},setNow:e.q.setNow,restoreNow:e.q.restoreNow};return Nl}),n}()},893:e=>{e.exports=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n},e.exports.__esModule=!0,e.exports.default=e.exports},896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,s=r>>>1;i<s;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<r&&0>o(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[a]=n,i=a);else{if(!(c<r&&0>o(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,_=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function w(e){if(g=!1,b(e),!m)if(null!==i(c))m=!0,T||(T=!0,E());else{var t=i(u);null!==t&&M(w,t.startTime-e)}}var E,T=!1,A=-1,S=5,D=-1;function C(){return!!_||!(t.unstable_now()-D<S)}function I(){if(_=!1,T){var e=t.unstable_now();D=e;var n=!0;try{e:{m=!1,g&&(g=!1,v(A),A=-1),p=!0;var o=f;try{t:{for(b(e),d=i(c);null!==d&&!(d.expirationTime>e&&C());){var s=d.callback;if("function"===typeof s){d.callback=null,f=d.priorityLevel;var a=s(d.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof a){d.callback=a,b(e),n=!0;break t}d===i(c)&&r(c),b(e)}else r(c);d=i(c)}if(null!==d)n=!0;else{var l=i(u);null!==l&&M(w,l.startTime-e),n=!1}}break e}finally{d=null,f=o,p=!1}n=void 0}}finally{n?E():T=!1}}}if("function"===typeof x)E=function(){x(I)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,P=R.port2;R.port1.onmessage=I,E=function(){P.postMessage(null)}}else E=function(){y(I,0)};function M(e,n){A=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_requestPaint=function(){_=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,r,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===i(c)&&e===i(u)&&(g?(v(A),A=-1):g=!0,M(w,o-s))):(e.sortIndex=a,n(c,e),m||p||(m=!0,T||(T=!0,E()))),e},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,i)=>(n.f[i](e,t),t),[])),n.u=e=>"static/js/"+e+".6fb14c22.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="my-deckgl-app:";n.l=(i,r,o,s)=>{if(e[i])e[i].push(r);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+o){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+o),a.src=i),e[i]=[r];var d=(t,n)=>{a.onerror=a.onload=null,clearTimeout(f);var r=e[i];if(delete e[i],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach(e=>e(n)),t)return t(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{var e={792:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var o=new Promise((n,i)=>r=e[t]=[n,i]);i.push(r[2]=o);var s=n.p+n.u(t),a=new Error;n.l(s,i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,r[1](a)}},"chunk-"+t,t)}};var t=(t,i)=>{var r,o,s=i[0],a=i[1],l=i[2],c=0;if(s.some(t=>0!==e[t])){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(l)l(n)}for(t&&t(i);c<s.length;c++)o=s[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},i=self.webpackChunkmy_deckgl_app=self.webpackChunkmy_deckgl_app||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e=n(43),t=n(391);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function o(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var l=n(879),c=n.n(l);let u=1,h=1;class d{constructor(){o(this,"time",0),o(this,"channels",new Map),o(this,"animations",new Map),o(this,"playing",!1),o(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=e,o=u++,s={time:0,delay:t,duration:n,rate:i,repeat:r};return this._setChannelTime(s,this.time),this.channels.set(o,s),o}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:e,channel:t}=i;e.setTime(this.getTime(t))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=h++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}const f={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"===typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function p(e){let t=m(e);if("object"!==t)return a(a({value:e},f[t]),{},{type:t});if("object"===typeof e)return e?void 0!==e.type?a(a(a({},e),f[e.type]),{},{type:e.type}):void 0===e.value?{type:"object",value:e}:(t=m(e.value),a(a(a({},e),f[t]),{},{type:t})):{type:"object",value:null};throw new Error("props")}function m(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const g={vertex:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\n  fragColor = material_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  fragColor = lighting_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_FOG\n  fragColor = fog_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  fragColor = picking_filterHighlightColor(fragColor);\n  fragColor = picking_filterPickingColor(fragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},_=/void\s+main\s*\([^)]*\)\s*\{\n?/,y=/}\n?[^{}]*$/,v=[],x="__LUMA_INJECT_DECLARATIONS__";function b(e){const t={vertex:{},fragment:{}};for(const n in e){let i=e[n];"string"===typeof i&&(i={order:0,injection:i}),t[w(n)][n]=i}return t}function w(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function E(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r="vertex"===t;for(const o in n){const t=n[o];t.sort((e,t)=>e.order-t.order),v.length=t.length;for(let e=0,n=t.length;e<n;++e)v[e]=t[e].injection;const i="".concat(v.join("\n"),"\n");switch(o){case"vs:#decl":r&&(e=e.replace(x,i));break;case"vs:#main-start":r&&(e=e.replace(_,e=>e+i));break;case"vs:#main-end":r&&(e=e.replace(y,e=>i+e));break;case"fs:#decl":r||(e=e.replace(x,i));break;case"fs:#main-start":r||(e=e.replace(_,e=>e+i));break;case"fs:#main-end":r||(e=e.replace(y,e=>i+e));break;default:e=e.replace(o,e=>e+i)}}return e=e.replace(x,""),i&&(e=e.replace(/\}\s*$/,e=>e+g[t])),e}function T(e){e.map(e=>A(e))}function A(e){if(e.instance)return;T(e.dependencies||[]);const{propTypes:t={},deprecations:n=[],inject:i={}}=e,r={normalizedInjections:b(i),parsedDeprecations:D(n)};t&&(r.propValidators=function(e){const t={};for(const[n,i]of Object.entries(e))t[n]=p(i);return t}(t)),e.instance=r;let o={};t&&(o=Object.entries(t).reduce((e,t)=>{let[n,i]=t;const r=null===i||void 0===i?void 0:i.value;return r&&(e[n]=r),e},{})),e.defaultUniforms=a(a({},e.defaultUniforms),o)}function S(e,t,n){var i;null===(i=e.deprecations)||void 0===i||i.forEach(e=>{var i;null!==(i=e.regex)&&void 0!==i&&i.test(t)&&(e.deprecated?n.deprecated(e.old,e.new)():n.removed(e.old,e.new)())})}function D(e){return e.forEach(e=>{if("function"===e.type)e.regex=new RegExp("\\b".concat(e.old,"\\("));else e.regex=new RegExp("".concat(e.type," ").concat(e.old,";"))}),e}function C(e){T(e);const t={},n={};I({modules:e,level:0,moduleMap:t,moduleDepth:n});const i=Object.keys(n).sort((e,t)=>n[t]-n[e]).map(e=>t[e]);return T(i),i}function I(e){const{modules:t,level:n,moduleMap:i,moduleDepth:r}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const o of t)i[o.name]=o,(void 0===r[o.name]||r[o.name]<n)&&(r[o.name]=n);for(const o of t)o.dependencies&&I({modules:o.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}const R=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],P=[...R,[L("attribute"),"in $1"],[L("varying"),"out $1"]],M=[...R,[L("varying"),"in $1"]];function F(e,t){for(const[n,i]of t)e=e.replace(n,i);return e}function L(e){return new RegExp("\\b".concat(e,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}function k(e,t){let n="";for(const i in e){const r=e[i];if(n+="void ".concat(r.signature," {\n"),r.header&&(n+="  ".concat(r.header)),t[i]){const e=t[i];e.sort((e,t)=>e.order-t.order);for(const t of e)n+="  ".concat(t.injection,"\n")}r.footer&&(n+="  ".concat(r.footer)),n+="}\n"}return n}function O(e){const t={vertex:{},fragment:{}};for(const n of e){let e,i;"string"!==typeof n?(e=n,i=e.hook):(e={},i=n),i=i.trim();const[r,o]=i.split(":"),s=i.replace(/\(.+/,""),a=Object.assign(e,{signature:o});switch(r){case"vs":t.vertex[s]=a;break;case"fs":t.fragment[s]=a;break;default:throw new Error(r)}}return t}function B(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}function z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed";const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function N(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error("Invalid GLSL version ".concat(t));return t}const U="\n\n".concat(x,"\n");function V(e,t){const{source:n,stage:i,modules:r,hookFunctions:o=[],inject:s={},log:a}=t;B("string"===typeof n,"shader source must be a string");const l=n;let c="";const u=O(o),h={},d={},f={};for(const g in s){const e="string"===typeof s[g]?{injection:s[g],order:0}:s[g],t=/^(v|f)s:(#)?([\w-]+)$/.exec(g);if(t){const n=t[2],i=t[3];n?"decl"===i?d[g]=[e]:f[g]=[e]:h[g]=[e]}else f[g]=[e]}const p=r;for(const g of p){var m;a&&S(g,l,a);c+=H(g,"wgsl");const e=(null===(m=g.injections)||void 0===m?void 0:m[i])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?d:f;i[t]=i[t]||[],i[t].push(e[t])}else h[t]=h[t]||[],h[t].push(e[t])}}return c+=U,c=E(c,i,d),c+=k(u[i],h),c+=l,c=E(c,i,f),c}function j(e,t){const{id:n,source:i,stage:r,language:o="glsl",modules:s,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=t;B("string"===typeof i,"shader source must be a string");const d="glsl"===o?function(e,t){return{name:z(e,t),language:"glsl",version:N(e)}}(i).version:-1,f=e.shaderLanguageVersion,p=100===d?"#version 100":"#version 300 es",m=i.split("\n").slice(1).join("\n"),g={};s.forEach(e=>{Object.assign(g,e.defines)}),Object.assign(g,a);let _="";switch(o){case"wgsl":break;case"glsl":_=u?"".concat(p,"\n\n// ----- PROLOGUE -------------------------\n").concat(function(e){const{id:t,source:n,stage:i}=e,r=t&&-1===n.indexOf("SHADER_NAME");return r?"\n#define SHADER_NAME ".concat(t,"_").concat(i):""}({id:n,source:i,stage:r}),"\n","#define SHADER_TYPE_".concat(r.toUpperCase()),"\n\n").concat(function(e){switch(null===e||void 0===e?void 0:e.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e),"\n").concat("fragment"===r?"precision highp float;\n":"","\n\n// ----- APPLICATION DEFINES -------------------------\n\n").concat(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="";for(const n in e){const i=e[n];(i||Number.isFinite(i))&&(t+="#define ".concat(n.toUpperCase()," ").concat(e[n],"\n"))}return t}(g),"\n\n"):"".concat(p,"\n")}const y=O(l),v={},x={},b={};for(const E in c){const e="string"===typeof c[E]?{injection:c[E],order:0}:c[E],t=/^(v|f)s:(#)?([\w-]+)$/.exec(E);if(t){const n=t[2],i=t[3];n?"decl"===i?x[E]=[e]:b[E]=[e]:v[E]=[e]}else b[E]=[e]}for(const E of s){var w;h&&S(E,m,h);_+=H(E,r);const e=(null===(w=E.instance)||void 0===w?void 0:w.normalizedInjections[r])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?x:b;i[t]=i[t]||[],i[t].push(e[t])}else v[t]=v[t]||[],v[t].push(e[t])}}return _+="// ----- MAIN SHADER SOURCE -------------------------",_+=U,_=E(_,r,x),_+=k(y[r],v),_+=m,_=E(_,r,b),"glsl"===o&&d!==f&&(_=function(e,t){var n;if(300!==Number((null===(n=e.match(/^#version[ \t]+(\d+)/m))||void 0===n?void 0:n[1])||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return F(e,P);case"fragment":return F(e,M);default:throw new Error(t)}}(_,r)),_.trim()}function G(e){return function(t){const n={};for(const r of e){var i;const e=null===(i=r.getUniforms)||void 0===i?void 0:i.call(r,t,n);Object.assign(n,e)}return n}}function H(e,t){let n;switch(t){case"vertex":n=e.vs||"";break;case"fragment":n=e.fs||"";break;case"wgsl":n=e.source||"";break;default:B(!1)}if(!e.name)throw new Error("Shader module must have a name");const i=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r="// ----- MODULE ".concat(e.name," ---------------\n\n");return"wgsl"!==t&&(r+="#define MODULE_".concat(i,"\n")),r+="".concat(n,"\n"),r}const W=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,q=/^\s*\#\s*endif\s*$/;class X{constructor(){o(this,"_hookFunctions",[]),o(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return X.defaultShaderAssembler=X.defaultShaderAssembler||new X,X.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"===typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"===typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:r}=function(e){const t=C(e.modules||[]);return{source:V(e.platformInfo,a(a({},e),{},{source:e.source,stage:"vertex",modules:t})),getUniforms:G(t)}}(a(a({},e),{},{source:e.source,modules:t,hookFunctions:n})),o="wgsl"===e.platformInfo.shaderLanguage?function(e,t){const n=e.split("\n"),i=[];let r=!0,o=null;for(const a of n){const e=a.match(W),n=a.match(q);var s;e?(o=e[1],r=Boolean(null===t||void 0===t||null===(s=t.defines)||void 0===s?void 0:s[o])):n?r=!0:r&&i.push(a)}return i.join("\n")}(i):i;return{source:o,getUniforms:r,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,i=function(e){const{vs:t,fs:n}=e,i=C(e.modules||[]);return{vs:j(e.platformInfo,a(a({},e),{},{source:t,stage:"vertex",modules:i})),fs:j(e.platformInfo,a(a({},e),{},{source:n,stage:"fragment",modules:i})),getUniforms:G(i)}}(a(a({},e),{},{vs:e.vs,fs:e.fs,modules:t,hookFunctions:n}));return a(a({},i),{},{modules:t})}_getModuleList(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let r=0,o=this._defaultModules.length;r<o;++r){const e=this._defaultModules[r],o=e.name;t[i++]=e,n[o]=!0}for(let r=0,o=e.length;r<o;++r){const o=e[r],s=o.name;n[s]||(t[i++]=o,n[s]=!0)}return t.length=i,T(t),t}}o(X,"defaultShaderAssembler",void 0);const Z="#define SMOOTH_EDGE_RADIUS 0.5",Y={name:"geometry",source:"const SMOOTH_EDGE_RADIUS: f32 = 0.5;\n\nstruct VertexGeometry {\n  position: vec4<f32>,\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\nvar<private> geometry_: VertexGeometry = VertexGeometry(\n  vec4<f32>(0.0, 0.0, 1.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec2<f32>(0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0)\n);\n\nstruct FragmentGeometry {\n  uv: vec2<f32>,\n};\n\nvar<private> fragmentGeometry: FragmentGeometry;\n\nfn smoothedge(edge: f32, x: f32) -> f32 {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n",vs:"".concat(Z,"\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n"),fs:"".concat(Z,"\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n")},K=[Y],J=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],Q=[];function $(e){const t=X.getDefaultShaderAssembler();for(const i of K)t.addDefaultModule(i);const n="glsl"===e?J:Q;for(const i of n)t.addShaderHook(i);return t}const ee="uniform layerUniforms {\n  uniform float opacity;\n} layer;\n",te={name:"layer",vs:ee,fs:ee,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},ne="Awaiting state",ie="Matched. State transferred from previous layer",re="Initialized",oe="Discarded. Awaiting garbage collection",se="No longer matched. Awaiting garbage collection",ae="Finalized! Awaiting garbage collection",le=Symbol.for("component"),ce=Symbol.for("propTypes"),ue=Symbol.for("deprecatedProps"),he=Symbol.for("asyncPropDefaults"),de=Symbol.for("asyncPropOriginal"),fe=Symbol.for("asyncPropResolved");function pe(e){var t,n;if("undefined"!==typeof window&&"renderer"===(null===(t=window.process)||void 0===t?void 0:t.type))return!0;if("undefined"!==typeof process&&Boolean(null===(n=process.versions)||void 0===n?void 0:n.electron))return!0;const i="undefined"!==typeof navigator&&navigator.userAgent,r=e||i;return Boolean(r&&r.indexOf("Electron")>=0)}function me(){var e;return!("object"===typeof process&&"[object process]"===String(process)&&!(null!==(e=process)&&void 0!==e&&e.browser))||pe()}const ge="4.1.0";class _e{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(qh){return null}}(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}var ye;!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(ye||(ye={}));function ve(e){return"string"!==typeof e?e:(e=e.toUpperCase(),ye[e]||ye.WHITE)}function xe(e,t){if(!e)throw new Error(t||"Assertion failed")}const be=globalThis,we=(globalThis.document,globalThis.process||{}),Ee=(globalThis.console,globalThis.navigator||{});function Te(){let e;var t,n;if(me()&&be.performance)e=null===be||void 0===be||null===(t=be.performance)||void 0===t||null===(n=t.now)||void 0===n?void 0:n.call(t);else if("hrtime"in we){var i;const t=null===we||void 0===we||null===(i=we.hrtime)||void 0===i?void 0:i.call(we);e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}const Ae={debug:me()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Se={enabled:!0,level:0};function De(){}const Ce={},Ie={once:!0};class Re{constructor(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};this.VERSION=ge,this._startTs=Te(),this._deltaTs=Te(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new _e("__probe-".concat(this.id,"__"),Se),this.timeStamp("".concat(this.id," started")),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n),r=e;for(const o of i){const n=r[o];"function"===typeof n&&(t.find(e=>o===e)||(r[o]=n.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Te()-this._startTs).toPrecision(10))}getDelta(){return Number((Te()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Ae.warn,arguments,Ie)}error(e){return this._getLogFunction(0,e,Ae.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,Ae.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Ae.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Ae.debug||Ae.info,arguments,Ie)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||De,n&&[n],{tag:Fe(t)}):De}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||De)}group(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const i=Me({logLevel:e,message:t,opts:n}),{collapsed:r}=n;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||De)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Pe(e)}_getLogFunction(e,t,n,i,r){if(this._shouldLog(e)){r=Me({logLevel:e,message:t,args:i,opts:r}),xe(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Te();const o=r.tag||r.message;if(r.once&&o){if(Ce[o])return De;Ce[o]=Te()}return t=function(e,t,n){if("string"===typeof t){const i=n.time?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(n.total)):"";t=function(e,t,n){if(!me&&"string"===typeof e){if(t){const n=ve(t);e="\x1b[".concat(n,"m").concat(e,"\x1b[39m")}if(n){const t=ve(n);e="\x1b[".concat(t+10,"m").concat(e,"\x1b[49m")}}return e}(t=n.time?"".concat(e,": ").concat(i,"  ").concat(t):"".concat(e,": ").concat(t),n.color,n.background)}return t}(this.id,r.message,r),n.bind(console,t,...r.args)}return De}}function Pe(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return xe(Number.isFinite(t)&&t>=0),t}function Me(e){const{logLevel:t,message:n}=e;e.logLevel=Pe(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&i.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"===typeof e.message&&(e.message=e.message());const r=typeof e.message;return xe("string"===r||"object"===r),Object.assign(e,{args:i},e.opts)}function Fe(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}Re.VERSION=ge;const Le=new Re({id:"deck"});let ke={};function Oe(e){ke=e}function Be(e,t,n,i){Le.level>0&&ke[e]&&ke[e].call(null,t,n,i)}function ze(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;return Array.isArray(e)?Ne(e,t,[]):t(e)?[e]:[]}function Ne(e,t,n){let i=-1;for(;++i<e.length;){const r=e[i];Array.isArray(r)?Ne(r,t,n):t(r)&&n.push(r)}return n}function Ue(e){let{target:t,source:n,start:i=0,count:r=1}=e;const o=n.length,s=r*o;let a=0;for(let l=i;a<o;a++)t[l++]=n[a];for(;a<s;)a<s-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+s-a),a=s);return t}function Ve(){let e;if("undefined"!==typeof window&&window.performance)e=window.performance.now();else if("undefined"!==typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class je{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Ve(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Ve()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Ge{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(i=e instanceof je?e:new je(t,n),this.stats[t]=i),i}}const He=e=>"boolean"===typeof e,We=e=>"function"===typeof e,qe=e=>null!==e&&"object"===typeof e,Xe=e=>qe(e)&&e.constructor==={}.constructor,Ze=e=>"undefined"!==typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Ye=e=>"undefined"!==typeof Blob&&e instanceof Blob,Ke=e=>(e=>"undefined"!==typeof ReadableStream&&e instanceof ReadableStream||qe(e)&&We(e.tee)&&We(e.cancel)&&We(e.getReader))(e)||(e=>qe(e)&&We(e.read)&&We(e.pipe)&&He(e.readable))(e);function Je(e,t){if(!e)throw new Error(t||"loader assertion failed.")}function Qe(e){var t;if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions)}function $e(e){var t,n;let i;return Je(e,"null loader"),Je(Qe(e),"invalid loader"),Array.isArray(e)&&(i=e[1],e=a(a({},e=e[0]),{},{options:a(a({},e.options),i)})),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(n=e)&&void 0!==n&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}let et="";const tt={};class nt extends Error{constructor(e,t){super(e),o(this,"reason",void 0),o(this,"url",void 0),o(this,"response",void 0),this.reason=t.reason,this.url=t.url,this.response=t.response}}const it=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,rt=/^([-\w.]+\/[-\w.+]+)/;function ot(e,t){return e.toLowerCase()===t.toLowerCase()}function st(e){const t=it.exec(e);return t?t[1]:""}const at=/\?.*/;function lt(e){return e.replace(at,"")}function ct(e){if(Ze(e)){return e.url}if(Ye(e)){return e.name||""}return"string"===typeof e?e:""}function ut(e){if(Ze(e)){const t=e,n=t.headers.get("content-type")||"",i=lt(t.url);return function(e){const t=rt.exec(e);return t?t[1]:e}(n)||st(i)}if(Ye(e)){return e.type||""}return"string"===typeof e?st(e):""}async function ht(e){if(Ze(e))return e;const t={},n=function(e){if(Ze(e))return e.headers["content-length"]||-1;if(Ye(e))return e.size;return"string"===typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const i=ct(e),r=ut(e);r&&(t["content-type"]=r);const o=await async function(e){const t=5;if("string"===typeof e)return"data:,".concat(e.slice(0,t));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(e=>{const n=new FileReader;n.onload=t=>{var n;return e(null===t||void 0===t||null===(n=t.target)||void 0===n?void 0:n.result)},n.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const n=function(e){let t="";const n=new Uint8Array(e);for(let i=0;i<n.byteLength;i++)t+=String.fromCharCode(n[i]);return btoa(t)}(e.slice(0,t));return"data:base64,".concat(n)}return null}(e);o&&(t["x-first-bytes"]=o),"string"===typeof e&&(e=(new TextEncoder).encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:i}),s}async function dt(e){if(!e.ok){const t=await async function(e){const n=function(e){if(e.length<50)return e;const t=e.slice(e.length-15),n=e.substr(0,32);return"".concat(n,"...").concat(t)}(e.url);let i="Failed to fetch resource (".concat(e.status,") ").concat(e.statusText,": ").concat(n);i=i.length>100?"".concat(i.slice(0,100),"..."):i;const r={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");r.reason=!e.bodyUsed&&null!==t&&void 0!==t&&t.includes("application/json")?await e.json():await e.text()}catch(t){}return new nt(i,r)}(e);throw t}}async function ft(e,t){if("string"===typeof e){const r=function(e){for(const t in tt)if(e.startsWith(t)){const n=tt[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e="".concat(et).concat(e)),e}(e);var n,i;if(function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(r))if(null!==(n=globalThis.loaders)&&void 0!==n&&n.fetchNode)return null===(i=globalThis.loaders)||void 0===i?void 0:i.fetchNode(r,t);return await fetch(r,t)}return await ht(e)}const pt=new Re({id:"loaders.gl"});class mt{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}"undefined"!==typeof self&&self,"undefined"!==typeof window&&window,"undefined"!==typeof global&&global,"undefined"!==typeof document&&document;const gt=Boolean("object"!==typeof process||"[object process]"!==String(process)||process.browser),_t="undefined"!==typeof process&&process.version&&/v([0-9]*)/.exec(process.version),yt=(_t&&parseFloat(_t[1]),{fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){o(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.error.bind(this.console,...t)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:gt,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]}),vt={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function xt(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function bt(){const e=xt();return e.globalOptions=e.globalOptions||a({},yt),e.globalOptions}function wt(e,t,n,i){return n=n||[],function(e,t){Et(e,null,yt,vt,t);for(const n of t){const i=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Et(i,n.id,r,o,t)}}(e,n=Array.isArray(n)?n:[n]),At(t,e,i)}function Et(e,t,n,i,r){const o=t||"Top level",s=t?"".concat(t,"."):"";for(const a in e){const l=!t&&qe(e[a]);if(!(a in n)&&!("baseUri"===a&&!t)&&!("workerUrl"===a&&t))if(a in i)pt.warn("".concat(o," loader option '").concat(s).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const e=Tt(a,r);pt.warn("".concat(o," loader option '").concat(s).concat(a,"' not recognized. ").concat(e))()}}}function Tt(e,t){const n=e.toLowerCase();let i="";for(const r of t)for(const t in r.options){if(e===t)return"Did you mean '".concat(r.id,".").concat(t,"'?");const o=t.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(t,"'?"))}return i}function At(e,t,n){const i=a({},e.options||{});return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(i,n),null===i.log&&(i.log=new mt),St(i,bt()),St(i,t),i}function St(e,t){for(const n in t)if(n in t){const i=t[n];Xe(i)&&Xe(e[n])?e[n]=a(a({},e[n]),t[n]):e[n]=t[n]}}function Dt(e,t){const n=bt(),i=e||n;return"function"===typeof i.fetch?i.fetch:qe(i.fetch)?e=>ft(e,i.fetch):null!==t&&void 0!==t&&t.fetch?null===t||void 0===t?void 0:t.fetch:ft}function Ct(e,t){return It(e||{},t)}function It(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n>3)return t;const i=a({},e);for(const[r,o]of Object.entries(t))o&&"object"===typeof o&&!Array.isArray(o)?i[r]=It(i[r]||{},t[r],n+1):i[r]=t[r];return i}"undefined"!==typeof self&&self,"undefined"!==typeof window&&window,"undefined"!==typeof global&&global,"undefined"!==typeof document&&document;const Rt="object"!==typeof process||"[object process]"!==String(process)||process.browser,Pt="undefined"!==typeof window&&"undefined"!==typeof window.orientation,Mt="undefined"!==typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Mt&&parseFloat(Mt[1]);class Ft{terminate(){}}function Lt(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const kt=new Map;function Ot(e){Lt(e.source&&!e.url||!e.source&&e.url);let t=kt.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return Bt((t=e,"try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var t}(e.url),kt.set(e.url,t)),e.source&&(t=Bt(e.source),kt.set(e.source,t))),Lt(t),t}function Bt(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function zt(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(e){if(Nt(e))i.add(e);else if(Nt(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"===typeof e)for(const r in e)zt(e[r],t,i)}else;return void 0===n?Array.from(i):[]}function Nt(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!==typeof MessagePort&&e instanceof MessagePort||("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const Ut=()=>{};class Vt{static isSupported(){return"undefined"!==typeof Worker&&Rt||"undefined"!==typeof Ft&&!Rt}constructor(e){o(this,"name",void 0),o(this,"source",void 0),o(this,"url",void 0),o(this,"terminated",!1),o(this,"worker",void 0),o(this,"onMessage",void 0),o(this,"onError",void 0),o(this,"_loadableURL","");const{name:t,source:n,url:i}=e;Lt(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=Ut,this.onError=e=>console.log(e),this.worker=Rt?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Ut,this.onError=Ut,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||zt(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=Ot({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Ft(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new Ft(this.source,{eval:!0})}return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class jt{constructor(e,t){o(this,"name",void 0),o(this,"workerThread",void 0),o(this,"isRunning",!0),o(this,"result",void 0),o(this,"_resolve",()=>{}),o(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Lt(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Lt(this.isRunning),this.isRunning=!1,this._reject(e)}}class Gt{static isSupported(){return Vt.isSupported()}constructor(e){o(this,"name","unnamed"),o(this,"source",void 0),o(this,"url",void 0),o(this,"maxConcurrency",1),o(this,"maxMobileConcurrency",1),o(this,"onDebug",()=>{}),o(this,"reuseWorkers",!0),o(this,"props",{}),o(this,"jobQueue",[]),o(this,"idleQueue",[]),o(this,"count",0),o(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props=a(a({},this.props),e),void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t,n)=>e.done(n),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e.error(t);const i=new Promise(i=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:i}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new jt(t.name,e);e.onMessage=e=>t.onMessage(i,e.type,e.payload),e.onError=e=>t.onError(i,e),t.onStart(i);try{await i.result}catch(n){console.error("Worker exception: ".concat(n))}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Rt||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Vt({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Pt?this.maxMobileConcurrency:this.maxConcurrency}}const Ht={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Wt{static isSupported(){return Vt.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Wt._workerFarm=Wt._workerFarm||new Wt({}),Wt._workerFarm.setProps(e),Wt._workerFarm}constructor(e){o(this,"props",void 0),o(this,"workerPools",new Map),this.props=a({},Ht),this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props=a(a({},this.props),e);for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let r=this.workerPools.get(t);return r||(r=new Gt({name:t,source:n,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}o(Wt,"_workerFarm",void 0);const qt=function(){var e;return null!==(e=globalThis._loadersgl_)&&void 0!==e&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}();async function Xt(e,t,n,i,r){const o=e.id,s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t[e.id]||{},i="".concat(e.id,Rt?"-worker.js":"-worker-node.js");let r=n.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r=Rt?"modules/".concat(e.module,"/dist/").concat(i):"modules/".concat(e.module,"/src/workers/").concat(e.id,"-worker-node.ts")),!r){let t=e.version;"latest"===t&&(t="latest");const n=t?"@".concat(t):"";r="https://unpkg.com/@loaders.gl/".concat(e.module).concat(n,"/dist/").concat(i)}return Lt(r),r}(e,n),a=Wt.getWorkerFarm(n).getWorkerPool({name:o,url:s});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const l=await a.startJob("process-on-worker",Zt.bind(null,r));l.postMessage("process",{input:t,options:n,context:i});const c=await l.result;return await c.result}async function Zt(e,t,n,i){switch(n){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:o,input:s,options:a}=i;try{const n=await e(s,a);t.postMessage("done",{id:o,result:n})}catch(r){const e=r instanceof Error?r.message:"unknown error";t.postMessage("error",{id:o,error:e})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function Yt(e){var t,n,i,r=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);r--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new Kt(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Kt(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Kt=function(e){this.s=e,this.n=e.next},Kt.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Kt(e)}function Jt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){const t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),n=t.reduce((e,t)=>e+t.byteLength,0),i=new Uint8Array(n);let r=0;for(const o of t)i.set(o,r),r+=o.byteLength;return i.buffer}(t)}const Qt=262144;function $t(e,t){this.v=e,this.k=t}function en(e){return new $t(e,0)}function tn(e){return function(){return new nn(e.apply(this,arguments))}}function nn(e){var t,n;function i(t,n){try{var o=e[t](n),s=o.value,a=s instanceof $t;Promise.resolve(a?s.v:s).then(function(n){if(a){var l="return"===t?"return":"next";if(!s.k||n.done)return i(l,n);n=e[l](n).value}r(o.done?"return":"normal",n)},function(e){i("throw",e)})}catch(e){r("throw",e)}}function r(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(e,r){return new Promise(function(o,s){var a={key:e,arg:r,resolve:o,reject:s,next:null};n?n=n.next=a:(t=n=a,i(e,r))})},"function"!=typeof e.return&&(this.return=void 0)}nn.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},nn.prototype.next=function(e){return this._invoke("next",e)},nn.prototype.throw=function(e){return this._invoke("throw",e)},nn.prototype.return=function(e){return this._invoke("return",e)};function rn(){return rn=tn(function*(e,t){const n=(null===t||void 0===t?void 0:t.chunkSize)||1048576;let i=0;for(;i<e.size;){const t=i+n,r=yield en(e.slice(i,t).arrayBuffer());i=t,yield r}}),rn.apply(this,arguments)}function on(e){if(function(e){return e&&"object"===typeof e&&e.isBuffer}(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"===typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"===typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function sn(e,t){return gt?function(e,t){return an.apply(this,arguments)}(e,t):function(e,t){return ln.apply(this,arguments)}(e,t)}function an(){return an=tn(function*(e,t){const n=e.getReader();let i;try{for(;;){const e=i||n.read();null!==t&&void 0!==t&&t._streamReadAhead&&(i=n.read());const{done:r,value:o}=yield en(e);if(r)return;yield on(o)}}catch(r){n.releaseLock()}}),an.apply(this,arguments)}function ln(){return(ln=tn(function*(e,t){var n,i=!1,r=!1;try{for(var o,s=Yt(e);i=!(o=yield en(s.next())).done;i=!1){const e=o.value;yield on(e)}}catch(a){r=!0,n=a}finally{try{i&&null!=s.return&&(yield en(s.return()))}finally{if(r)throw n}}})).apply(this,arguments)}function cn(e,t){if("string"===typeof e)return function*(e,t){const n=(null===t||void 0===t?void 0:t.chunkSize)||262144;let i=0;const r=new TextEncoder;for(;i<e.length;){const t=Math.min(e.length-i,n),o=e.slice(i,i+t);i+=t,yield r.encode(o)}}(e,t);if(e instanceof ArrayBuffer)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const{chunkSize:n=Qt}=t;let i=0;for(;i<e.byteLength;){const t=Math.min(e.byteLength-i,n),r=new ArrayBuffer(t),o=new Uint8Array(e,i,t);new Uint8Array(r).set(o),i+=t,yield r}}()}(e,t);if(Ye(e))return function(e,t){return rn.apply(this,arguments)}(e,t);if(Ke(e))return sn(e,t);if(Ze(e)){return sn(e.body,t)}throw new Error("makeIterator")}const un="Cannot convert supplied data type";async function hn(e,t,n){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"===typeof e||i)return function(e,t){if(t.text&&"string"===typeof e)return e;if((e=>e&&"object"===typeof e&&e.isBuffer)(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const i=e.byteLength||e.length;return 0===e.byteOffset&&i===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+i)),n}throw new Error(un)}(e,t);if(Ye(e)&&(e=await ht(e)),Ze(e)){const n=e;return await dt(n),t.binary?await n.arrayBuffer():await n.text()}if(Ke(e)&&(e=cn(e,n)),(e=>Boolean(e)&&"function"===typeof e[Symbol.iterator])(e)||(e=>e&&"function"===typeof e[Symbol.asyncIterator])(e))return async function(e){const t=[];var n,i=!1,r=!1;try{for(var o,s=Yt(e);i=!(o=await s.next()).done;i=!1){const e=o.value;t.push(e)}}catch(a){r=!0,n=a}finally{try{i&&null!=s.return&&await s.return()}finally{if(r)throw n}}return Jt(...t)}(e);throw new Error(un)}function dn(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function fn(e,t,n){if(n)return n;const i=a({fetch:Dt(t,e)},e);if(i.url){const e=lt(i.url);i.baseUrl=e,i.queryString=function(e){const t=e.match(at);return t&&t[0]}(i.url),i.filename=dn(e),i.baseUrl=function(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}(e)}return Array.isArray(i.loaders)||(i.loaders=null),i}const pn="4.3.3",mn=pn[0]>="0"&&pn[0]<="9"?"v".concat(pn):"";const gn=function(){const e=new Re({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=mn,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}(),_n=()=>{const e=xt();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};const yn=/\.([^.]+)$/;function vn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!xn(e))return null;if(t&&!Array.isArray(t))return $e(t);let r=[];t&&(r=r.concat(t)),null!==n&&void 0!==n&&n.ignoreRegisteredLoaders||r.push(..._n()),function(e){for(const t of e)$e(t)}(r);const o=function(e,t,n,i){const r=ct(e),o=ut(e),s=lt(r)||(null===i||void 0===i?void 0:i.url);let a=null,l="";null!==n&&void 0!==n&&n.mimeType&&(a=wn(t,null===n||void 0===n?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(null===n||void 0===n?void 0:n.mimeType));a=a||function(e,t){const n=t&&yn.exec(t),i=n&&n[1];return i?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,i):null}(t,s),l=l||(a?"matched url ".concat(s):""),a=a||wn(t,o),l=l||(a?"matched MIME type ".concat(o):""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"===typeof t){if(En(t,n))return n}else if(ArrayBuffer.isView(t)){if(Tn(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer){if(Tn(t,0,n))return n}return null}(t,e),l=l||(a?"matched initial data ".concat(An(e)):""),null!==n&&void 0!==n&&n.fallbackMimeType&&(a=a||wn(t,null===n||void 0===n?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(o):""));var c;l&&gn.log(1,"selectLoader selected ".concat(null===(c=a)||void 0===c?void 0:c.name,": ").concat(l,"."));return a}(e,r,n,i);if(!o&&(null===n||void 0===n||!n.nothrow))throw new Error(bn(e));return o}function xn(e){return!(e instanceof Response&&204===e.status)}function bn(e){const t=ct(e),n=ut(e);let i="No valid loader found (";i+=t?"".concat(dn(t),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=e?An(e):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function wn(e,t){for(const i of e){var n;if(null!==(n=i.mimeTypes)&&void 0!==n&&n.some(e=>ot(t,e)))return i;if(ot(t,"application/x.".concat(i.id)))return i}return null}function En(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}function Tn(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(n=>function(e,t,n,i){if(i instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const i=new Uint8Array(e),r=new Uint8Array(t);for(let o=0;o<i.length;++o)if(i[o]!==r[o])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e);case"string":return i===Sn(e,t,i.length);default:return!1}}(e,t,0,n))}function An(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"===typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Sn(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return Sn(e,0,t)}return""}function Sn(e,t,n){if(e.byteLength<t+n)return"";const i=new DataView(e);let r="";for(let o=0;o<n;o++)r+=String.fromCharCode(i.getUint8(t+o));return r}async function Dn(e,t,n,i){!t||Array.isArray(t)||Qe(t)||(i=void 0,n=t,t=void 0),n=n||{};const r=ct(e=await e),o=function(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:void 0}(t,i),s=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!xn(e))return null;let r=vn(e,t,a(a({},n),{},{nothrow:!0}),i);if(r)return r;if(Ye(e)&&(r=vn(e=await e.slice(0,10).arrayBuffer(),t,n,i)),!r&&(null===n||void 0===n||!n.nothrow))throw new Error(bn(e));return r}(e,o,n);return s?(i=fn({url:r,_parse:Dn,loaders:o},n=wt(n,s,o,r),i||null),await async function(e,t,n,i){if(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qt;Lt(e,"no worker provided");const n=e.version}(e),n=Ct(e.options,n),Ze(t)){const e=t,{ok:n,redirected:r,status:o,statusText:s,type:a,url:l}=e,c=Object.fromEntries(e.headers.entries());i.response={headers:c,ok:n,redirected:r,status:o,statusText:s,type:a,url:l}}t=await hn(t,e,n);const r=e;if(r.parseTextSync&&"string"===typeof t)return r.parseTextSync(t,n,i);if(function(e,t){return!!Wt.isSupported()&&!!(Rt||null!==t&&void 0!==t&&t._nodeWorkers)&&e.worker&&(null===t||void 0===t?void 0:t.worker)}(e,n))return await Xt(e,t,n,i,Dn);if(r.parseText&&"string"===typeof t)return await r.parseText(t,n,i);if(r.parse)return await r.parse(t,n,i);throw Lt(!r.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}(s,e,n,i)):null}async function Cn(e,t,n,i){let r,o;Array.isArray(t)||Qe(t)?(r=t,o=n):(r=[],o=t);const s=Dt(o);let a=e;return"string"===typeof e&&(a=await s(e)),Ye(e)&&(a=await s(e)),Array.isArray(r),await Dn(a,r,o)}class In{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;"string"===typeof e&&(i=Cn(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=e)}).catch(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const r of this._subscribers)r.onChange(this.getData())}}class Rn{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:null===(t=e.device)||void 0===t?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add(e){let{resourceId:t,data:n,forceUpdate:i=!1,persistent:r=!0}=e,o=this._resources[t];o?o.setData(n,i):(o=new In(t,n,this._context),this._resources[t]=o),o.persistent=r}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:t}=e;const n=this._consumers[t];if(n){for(const e in n){const t=n[e],i=this._resources[t.resourceId];i&&i.unsubscribe(t)}delete this._consumers[t],this.prune()}}subscribe(e){let{resourceId:t,onChange:n,consumerId:i,requestId:r="default"}=e;const{_resources:o,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),o[t]||this.add({resourceId:t,data:null,persistent:!1}));const a=o[t];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const r=this._consumers,o=r[e]=r[e]||{};let s=o[t];const a=s&&s.resourceId&&this._resources[s.resourceId];a&&(a.unsubscribe(s),this.prune()),n&&(s?(s.onChange=i,s.resourceId=n.id):s={onChange:i,resourceId:n.id},o[t]=s,n.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}const Pn=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,n){let{size:i=1,type:r,padding:o=0,copy:s=!1,initialize:a=!1,maxCount:l}=n;const c=r||e&&e.constructor||Float32Array,u=t*i+o;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let h=1/0;l&&(h=l*i+o);const d=this._allocate(c,u,a,h);return e&&s?d.set(e):a||d.fill(0,0,4),this._release(e),d}release(e){this._release(e)}_allocate(e,t,n,i){let r=Math.max(Math.ceil(t*this.opts.overAlloc),1);r>i&&(r=i);const o=this._pool,s=e.BYTES_PER_ELEMENT*r,a=o.findIndex(e=>e.byteLength>=s);if(a>=0){const t=new e(o.splice(a,1)[0],0,r);return n&&t.fill(0),t}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,r=t.findIndex(e=>e.byteLength>=i);r<0?t.push(n):(r>0||t.length<this.opts.poolSize)&&t.splice(r,0,n),t.length>this.opts.poolSize&&t.shift()}};Math.PI,Math.PI;globalThis.mathgl=globalThis.mathgl||{config:a({},{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1})};const Mn=globalThis.mathgl.config;function Fn(e){let{precision:t=Mn.precision}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=function(e){return Math.round(e/Mn.EPSILON)*Mn.EPSILON}(e),"".concat(parseFloat(e.toPrecision(t)))}function Ln(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function kn(e,t,n){return zn(e,e=>Math.max(t,Math.min(n,e)))}function On(e,t,n){return Ln(e)?e.map((e,i)=>On(e,t[i],n)):n*t+(1-n)*e}function Bn(e,t,n){const i=Mn.EPSILON;n&&(Mn.EPSILON=n);try{if(e===t)return!0;if(Ln(e)&&Ln(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Bn(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"===typeof e&&"number"===typeof t&&Math.abs(e-t)<=Mn.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{Mn.EPSILON=i}}function zn(e,t,n){if(Ln(e)){const i=e;n=n||function(e){return e.clone?e.clone():new Array(e.length)}(i);for(let r=0;r<n.length&&r<i.length;++r){const i="number"===typeof e?e:e[r];n[r]=t(i,r,n)}return n}return t(e)}class Nn extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Ln(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Mn)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+Fn(this[n],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Bn(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const r=e[i],o="number"===typeof t?t:t[i];this[i]=r+n*(o-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let e=0;e<this.ELEMENTS;++e)this[e]+=i[e];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let e=0;e<this.ELEMENTS;++e)this[e]-=i[e];return this.check()}scale(e){if("number"===typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Mn.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function Un(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(JSON.stringify(e)));return e}function Vn(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(Mn.debug&&!function(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e,t))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return e}function jn(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}class Gn extends Nn{get x(){return this[0]}set x(e){this[0]=Un(e)}get y(){return this[1]}set y(e){this[1]=Un(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return Un(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Un(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let e=0;e<this.ELEMENTS;++e)this[e]*=i[e];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=i[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return jn(e>=0&&e<this.ELEMENTS,"index is out of range"),Un(this[e])}setComponent(e,t){return jn(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Hn=1e-6;let Wn="undefined"!==typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function qn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Xn(e,t,n){const i=t[0],r=t[1],o=t[2];let s=n[3]*i+n[7]*r+n[11]*o+n[15];return s=s||1,e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/s,e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e}const Zn=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},Yn=function(e){const t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)},Kn=function(e){const t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i};!function(){const e=function(){const e=new Wn(3);return Wn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}()}();function Jn(e,t,n){const i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o||1;return e[0]=(n[0]*i+n[4]*r+n[8]*o)/s,e[1]=(n[1]*i+n[5]*r+n[9]*o)/s,e[2]=(n[2]*i+n[6]*r+n[10]*o)/s,e}const Qn=[0,0,0];let $n;class ei extends Gn{static get ZERO(){return $n||($n=new ei(0,0,0),Object.freeze($n)),$n}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(-0,-0,-0),1===arguments.length&&Ln(e)?this.copy(e):(Mn.debug&&(Un(e),Un(t),Un(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Mn.debug&&(Un(e.x),Un(e.y),Un(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Un(e)}angle(e){return function(e,t){const n=e[0],i=e[1],r=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt((n*n+i*i+r*r)*(o*o+s*s+a*a)),c=l&&qn(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,e)}cross(e){return function(e,t,n){const i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s}(this,this,e),this.check()}rotateX(e){let{radians:t,origin:n=Qn}=e;return function(e,t,n,i){const r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,n,t),this.check()}rotateY(e){let{radians:t,origin:n=Qn}=e;return function(e,t,n,i){const r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,n,t),this.check()}rotateZ(e){let{radians:t,origin:n=Qn}=e;return function(e,t,n,i){const r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,n,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Xn(this,this,e),this.check()}transformAsVector(e){return Jn(this,this,e),this.check()}transformByMatrix3(e){return function(e,t,n){const i=t[0],r=t[1],o=t[2];e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8]}(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return function(e,t,n){const i=n[0],r=n[1],o=n[2],s=n[3],a=t[0],l=t[1],c=t[2];let u=r*c-o*l,h=o*a-i*c,d=i*l-r*a,f=r*d-o*h,p=o*u-i*d,m=i*h-r*u;const g=2*s;u*=g,h*=g,d*=g,f*=2,p*=2,m*=2,e[0]=a+u+f,e[1]=l+h+p,e[2]=c+d+m}(this,this,e),this.check()}}const ti=new ei;function ni(e,t,n,i){ti.set(e,t,n);const r=ti.len();return{distance:i/r,normal:new ei(-e/r,-t/r,-n/r)}}function ii(e){return e-Math.fround(e)}let ri;function oi(e,t){const{size:n=1,startIndex:i=0}=t,r=void 0!==t.endIndex?t.endIndex:e.length,o=(r-i)/n;ri=Pn.allocate(ri,o,{type:Float32Array,size:2*n});let s=i,a=0;for(;s<r;){for(let t=0;t<n;t++){const i=e[s++];ri[a+t]=i,ri[a+t+n]=ii(i)}a+=2*n}return ri.subarray(0,o*n*2)}function si(e){let t=null,n=!1;for(const i of e)i&&(t?(n||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],n=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}class ai extends Nn{toString(){let e="[";if(Mn.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=" ".concat(this[n*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Un(n),this}getColumn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0);const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}}function li(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=n*a-i*s,v=n*l-r*s,x=n*c-o*s,b=i*l-r*a,w=i*c-o*a,E=r*c-o*l,T=u*m-h*p,A=u*g-d*p,S=u*_-f*p,D=h*g-d*m,C=h*_-f*m,I=d*_-f*g;let R=y*I-v*C+x*D+b*S-w*A+E*T;return R?(R=1/R,e[0]=(a*I-l*C+c*D)*R,e[1]=(r*C-i*I-o*D)*R,e[2]=(m*E-g*w+_*b)*R,e[3]=(d*w-h*E-f*b)*R,e[4]=(l*S-s*I-c*A)*R,e[5]=(n*I-r*S+o*A)*R,e[6]=(g*x-p*E-_*v)*R,e[7]=(u*E-d*x+f*v)*R,e[8]=(s*C-a*S+c*T)*R,e[9]=(i*S-n*C-o*T)*R,e[10]=(p*w-m*x+_*y)*R,e[11]=(h*x-u*w-f*y)*R,e[12]=(a*A-s*D-l*T)*R,e[13]=(n*D-i*A+r*T)*R,e[14]=(m*v-p*b-g*y)*R,e[15]=(u*b-h*v+d*y)*R,e):null}function ci(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15];let v=n[0],x=n[1],b=n[2],w=n[3];return e[0]=v*i+x*a+b*h+w*m,e[1]=v*r+x*l+b*d+w*g,e[2]=v*o+x*c+b*f+w*_,e[3]=v*s+x*u+b*p+w*y,v=n[4],x=n[5],b=n[6],w=n[7],e[4]=v*i+x*a+b*h+w*m,e[5]=v*r+x*l+b*d+w*g,e[6]=v*o+x*c+b*f+w*_,e[7]=v*s+x*u+b*p+w*y,v=n[8],x=n[9],b=n[10],w=n[11],e[8]=v*i+x*a+b*h+w*m,e[9]=v*r+x*l+b*d+w*g,e[10]=v*o+x*c+b*f+w*_,e[11]=v*s+x*u+b*p+w*y,v=n[12],x=n[13],b=n[14],w=n[15],e[12]=v*i+x*a+b*h+w*m,e[13]=v*r+x*l+b*d+w*g,e[14]=v*o+x*c+b*f+w*_,e[15]=v*s+x*u+b*p+w*y,e}function ui(e,t,n){const i=n[0],r=n[1],o=n[2];let s,a,l,c,u,h,d,f,p,m,g,_;return t===e?(e[12]=t[0]*i+t[4]*r+t[8]*o+t[12],e[13]=t[1]*i+t[5]*r+t[9]*o+t[13],e[14]=t[2]*i+t[6]*r+t[10]*o+t[14],e[15]=t[3]*i+t[7]*r+t[11]*o+t[15]):(s=t[0],a=t[1],l=t[2],c=t[3],u=t[4],h=t[5],d=t[6],f=t[7],p=t[8],m=t[9],g=t[10],_=t[11],e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=h,e[6]=d,e[7]=f,e[8]=p,e[9]=m,e[10]=g,e[11]=_,e[12]=s*i+u*r+p*o+t[12],e[13]=a*i+h*r+m*o+t[13],e[14]=l*i+d*r+g*o+t[14],e[15]=c*i+f*r+_*o+t[15]),e}function hi(e,t,n){const i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function di(e,t,n){const i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-s*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e}function fi(e,t,n){const i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-s*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e}const pi=function(e,t,n,i,r){const o=1/Math.tan(t/2);if(e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0){const t=1/(i-r);e[10]=(r+i)*t,e[14]=2*r*i*t}else e[10]=-1,e[14]=-2*i;return e};const mi=function(e,t,n,i,r,o,s){const a=1/(t-n),l=1/(i-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1,e};function gi(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function _i(e,t,n,i){const r=t[0],o=t[1];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e}!function(){const e=function(){const e=new Wn(2);return Wn!=Float32Array&&(e[0]=0,e[1]=0),e}()}();function yi(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function vi(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e}!function(){const e=function(){const e=new Wn(4);return Wn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();var xi;!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"}(xi||(xi={}));const bi=45*Math.PI/180,wi=1,Ei=.1,Ti=500,Ai=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Si extends ai{static get IDENTITY(){return function(){Ci||(Ci=new Si,Object.freeze(Ci));return Ci}()}static get ZERO(){return function(){Di||(Di=new Si([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Di));return Di}()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return xi}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=o,this[6]=s,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=f,this[14]=p,this[15]=m,this.check()}setRowMajor(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,m){return this[0]=e,this[1]=r,this[2]=l,this[3]=d,this[4]=t,this[5]=o,this[6]=c,this[7]=f,this[8]=n,this[9]=s,this[10]=u,this[11]=p,this[12]=i,this[13]=a,this[14]=h,this[15]=m,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Ai)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,f=r*a,p=r*l,m=o*s,g=o*a,_=o*l;e[0]=1-h-p,e[1]=u+_,e[2]=d-g,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=f+m,e[7]=0,e[8]=d+g,e[9]=f-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:r,near:o=Ei,far:s=Ti}=e;return s===1/0?function(e,t,n,i,r,o){const s=2*o/(n-t),a=2*o/(r-i),l=(n+t)/(n-t),c=(r+i)/(r-i),u=-1,h=-1,d=-2*o;e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=u,e[11]=h,e[12]=0,e[13]=0,e[14]=d,e[15]=0}(this,t,n,i,r,o):function(e,t,n,i,r,o,s){const a=1/(n-t),l=1/(r-i),c=1/(o-s);e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0}(this,t,n,i,r,o,s),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return function(e,t,n,i){let r,o,s,a,l,c,u,h,d,f;const p=t[0],m=t[1],g=t[2],_=i[0],y=i[1],v=i[2],x=n[0],b=n[1],w=n[2];Math.abs(p-x)<Hn&&Math.abs(m-b)<Hn&&Math.abs(g-w)<Hn?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(h=p-x,d=m-b,f=g-w,r=1/Math.sqrt(h*h+d*d+f*f),h*=r,d*=r,f*=r,o=y*f-v*d,s=v*h-_*f,a=_*d-y*h,r=Math.sqrt(o*o+s*s+a*a),r?(r=1/r,o*=r,s*=r,a*=r):(o=0,s=0,a=0),l=d*a-f*s,c=f*o-h*a,u=h*s-d*o,r=Math.sqrt(l*l+c*c+u*u),r?(r=1/r,l*=r,c*=r,u*=r):(l=0,c=0,u=0),e[0]=o,e[1]=l,e[2]=h,e[3]=0,e[4]=s,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=u,e[10]=f,e[11]=0,e[12]=-(o*p+s*m+a*g),e[13]=-(l*p+c*m+u*g),e[14]=-(h*p+d*m+f*g),e[15]=1)}(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:r,near:o=Ei,far:s=Ti}=e;return mi(this,t,n,i,r,o,s),this.check()}orthographic(e){const{fovy:t=bi,aspect:n=wi,focalDistance:i=1,near:r=Ei,far:o=Ti}=e;Ii(t);const s=t/2,a=i*Math.tan(s),l=a*n;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:r,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:r=500}=e;return Ii(t),pi(this,t,n,i,r),this.check()}determinant(){return function(e){const t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=t*s-n*o,_=t*a-i*o,y=n*a-i*s,v=c*p-u*f,x=c*m-h*f,b=u*m-h*p;return l*(t*b-n*x+i*v)-r*(o*b-s*x+a*v)+e[15]*(c*y-u*_+h*g)-d*(f*y-p*_+m*g)}(this)}getScale(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*r,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*r,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*r,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*r,e[8]=this[10]*o,e}transpose(){return function(e,t){if(e===t){const n=t[1],i=t[2],r=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}invert(){return li(this,this),this.check()}multiplyLeft(e){return ci(this,e,this),this.check()}multiplyRight(e){return ci(this,this,e),this.check()}rotateX(e){return di(this,this,e),this.check()}rotateY(e){return function(e,t,n){const i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=s*r-u*i,e[2]=a*r-h*i,e[3]=l*r-d*i,e[8]=o*i+c*r,e[9]=s*i+u*r,e[10]=a*i+h*r,e[11]=l*i+d*r}(this,this,e),this.check()}rotateZ(e){return fi(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return function(e,t,n,i){let r,o,s,a,l,c,u,h,d,f,p,m,g,_,y,v,x,b,w,E,T,A,S,D,C=i[0],I=i[1],R=i[2],P=Math.sqrt(C*C+I*I+R*R);P<Hn||(P=1/P,C*=P,I*=P,R*=P,o=Math.sin(n),r=Math.cos(n),s=1-r,a=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],f=t[6],p=t[7],m=t[8],g=t[9],_=t[10],y=t[11],v=C*C*s+r,x=I*C*s+R*o,b=R*C*s-I*o,w=C*I*s-R*o,E=I*I*s+r,T=R*I*s+C*o,A=C*R*s+I*o,S=I*R*s-C*o,D=R*R*s+r,e[0]=a*v+h*x+m*b,e[1]=l*v+d*x+g*b,e[2]=c*v+f*x+_*b,e[3]=u*v+p*x+y*b,e[4]=a*w+h*E+m*T,e[5]=l*w+d*E+g*T,e[6]=c*w+f*E+_*T,e[7]=u*w+p*E+y*T,e[8]=a*A+h*S+m*D,e[9]=l*A+d*S+g*D,e[10]=c*A+f*S+_*D,e[11]=u*A+p*S+y*D,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}scale(e){return hi(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return ui(this,this,e),this.check()}transform(e,t){return 4===e.length?(Vn(t=vi(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=function(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}(t||[-0,-0],e,this);break;case 3:i=Xn(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Vn(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=function(e,t,n){const i=t[0],r=t[1],o=n[3]*i+n[7]*r||1;return e[0]=(n[0]*i+n[4]*r)/o,e[1]=(n[1]*i+n[5]*r)/o,e}(t||[-0,-0],e,this);break;case 3:n=Jn(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Vn(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let Di,Ci;function Ii(e){if(e>2*Math.PI)throw Error("expected radians")}function Ri(e,t){const n=vi([],t,e);return yi(n,n,1/n[3]),n}function Pi(e,t){const n=e%t;return n<0?t+n:n}function Mi(e,t,n){return e<t?t:e>n?n:e}const Fi=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function Li(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const ki=Math.PI,Oi=ki/4,Bi=ki/180,zi=180/ki,Ni=512,Ui=4003e4,Vi=85.051129,ji=1.5;function Gi(e){const[t,n]=e;Li(Number.isFinite(t)),Li(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=n*Bi;return[Ni*(t*Bi+ki)/(2*ki),Ni*(ki+Math.log(Math.tan(Oi+.5*i)))/(2*ki)]}function Hi(e){const[t,n]=e,i=t/Ni*(2*ki)-ki,r=2*(Math.atan(Math.exp(n/Ni*(2*ki)-ki))-Oi);return[i*zi,r*zi]}function Wi(e){const{latitude:t}=e;Li(Number.isFinite(t));const n=Math.cos(t*Bi);return function(e){return Fi(e)}(Ui*n)-9}function qi(e){return 12790407194604047e-21/Math.cos(e*Bi)}function Xi(e){const{latitude:t,longitude:n,highPrecision:i=!1}=e;Li(Number.isFinite(t)&&Number.isFinite(n));const r=Ni,o=Math.cos(t*Bi),s=r/360,a=s/o,l=12790407194604047e-21/o,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[s,a,l],degreesPerUnit:[.703125,1/a,1/l]};if(i){const e=Bi*Math.tan(t*Bi)/o,n=s*e/2,i=12790407194604047e-21*e,r=i/a*l;c.unitsPerDegree2=[0,n,i],c.unitsPerMeter2=[r,0,r]}return c}function Zi(e,t){const[n,i,r]=e,[o,s,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=Xi({longitude:n,latitude:i,highPrecision:!0}),u=Gi(e);u[0]+=o*(l[0]+c[0]*s),u[1]+=s*(l[1]+c[1]*s);const h=Hi(u),d=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],d]:h}function Yi(e){const{width:t,height:n,altitude:i,pitch:r=0,offset:o,center:s,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=e;let{fovy:u=Ki(ji)}=e;void 0!==i&&(u=Ki(i));const h=u*Bi,d=r*Bi,f=Ji(u);let p=f;s&&(p+=s[2]*a/Math.cos(d)/n);const m=h*(.5+(o?o[1]:0)/n),g=Math.sin(m)*p/Math.sin(Mi(Math.PI/2-d-m,.01,Math.PI-.01)),_=Math.sin(d)*g+p,y=10*p;return{fov:h,aspect:t/n,focalDistance:f,near:l,far:Math.min(_*c,y)}}function Ki(e){return 2*Math.atan(.5/e)*zi}function Ji(e){return.5/Math.tan(.5*e*Bi)}function Qi(e,t){const[n,i,r=0]=e;return Li(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),Ri(t,[n,i,r,1])}function $i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const[i,r,o]=e;if(Li(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(o)){return Ri(t,[i,r,o,1])}const s=Ri(t,[i,r,0,1]),a=Ri(t,[i,r,1,1]),l=s[2],c=a[2];return _i([],s,a,l===c?0:((n||0)-l)/(c-l))}function er(e){const{width:t,height:n,bounds:i,minExtent:r=0,maxZoom:o=24,offset:s=[0,0]}=e,[[a,l],[c,u]]=i,h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"===typeof e)return{top:e,bottom:e,left:e,right:e};return Li(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e}(e.padding),d=Gi([a,Mi(u,-85.051129,Vi)]),f=Gi([c,Mi(l,-85.051129,Vi)]),p=[Math.max(Math.abs(f[0]-d[0]),r),Math.max(Math.abs(f[1]-d[1]),r)],m=[t-h.left-h.right-2*Math.abs(s[0]),n-h.top-h.bottom-2*Math.abs(s[1])];Li(m[0]>0&&m[1]>0);const g=m[0]/p[0],_=m[1]/p[1],y=(h.right-h.left)/2/g,v=(h.top-h.bottom)/2/_,x=Hi([(f[0]+d[0])/2+y,(f[1]+d[1])/2+v]),b=Math.min(o,Fi(Math.abs(Math.min(g,_))));return Li(Number.isFinite(b)),{longitude:x[0],latitude:x[1],zoom:b}}const tr=Math.PI/180;function nr(e,t,n){const{pixelUnprojectionMatrix:i}=e,r=Ri(i,[t,0,1,1]),o=Ri(i,[t,e.height,1,1]),s=Hi(_i([],r,o,(n*e.distanceScales.unitsPerMeter[2]-r[2])/(o[2]-r[2])));return s.push(n),s}var ir,rr,or;!function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"}(ir||(ir={})),function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"}(rr||(rr={})),function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"}(or||(or={}));const sr="auto",ar="manipulation",lr="none",cr="pan-x",ur="pan-y";class hr{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return function(e){if(e.includes(lr))return lr;const t=e.includes(cr),n=e.includes(ur);return t&&n?lr:t||n?t?cr:ur:e.includes(ar)?ar:sr}(e.join(" "))}}function dr(e){return e.trim().split(/\s+/g)}function fr(e,t,n){if(e)for(const i of dr(t))e.addEventListener(i,n,!1)}function pr(e,t,n){if(e)for(const i of dr(t))e.removeEventListener(i,n,!1)}function mr(e){return(e.ownerDocument||e).defaultView}function gr(e){const t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let n=0,i=0,r=0;for(;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:Math.round(n/t),y:Math.round(i/t)}}function _r(e){const t=[];let n=0;for(;n<e.pointers.length;)t[n]={clientX:Math.round(e.pointers[n].clientX),clientY:Math.round(e.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:t,center:gr(t),deltaX:e.deltaX,deltaY:e.deltaY}}function yr(e,t){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}function vr(e,t){const n=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(n*n+i*i)}function xr(e,t){const n=t.clientX-e.clientX,i=t.clientY-e.clientY;return 180*Math.atan2(i,n)/Math.PI}function br(e,t){return e===t?rr.None:Math.abs(e)>=Math.abs(t)?e<0?rr.Left:rr.Right:t<0?rr.Up:rr.Down}function wr(e,t,n){return{x:t/e||0,y:n/e||0}}function Er(e,t){const{session:n}=e,{pointers:i}=t,{length:r}=i;n.firstInput||(n.firstInput=_r(t)),r>1&&!n.firstMultiple?n.firstMultiple=_r(t):1===r&&(n.firstMultiple=!1);const{firstInput:o,firstMultiple:s}=n,a=s?s.center:o.center,l=t.center=gr(i);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=function(e,t){const n=t.x-e.x,i=t.y-e.y;return 180*Math.atan2(i,n)/Math.PI}(a,l),t.distance=yr(a,l);const{deltaX:c,deltaY:u}=function(e,t){const n=t.center;let i=e.offsetDelta,r=e.prevDelta;const o=e.prevInput;return t.eventType!==ir.Start&&(null===o||void 0===o?void 0:o.eventType)!==ir.End||(r=e.prevDelta={x:(null===o||void 0===o?void 0:o.deltaX)||0,y:(null===o||void 0===o?void 0:o.deltaY)||0},i=e.offsetDelta={x:n.x,y:n.y}),{deltaX:r.x+(n.x-i.x),deltaY:r.y+(n.y-i.y)}}(n,t);t.deltaX=c,t.deltaY=u,t.offsetDirection=br(t.deltaX,t.deltaY);const h=wr(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=h.x,t.overallVelocityY=h.y,t.overallVelocity=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,t.scale=s?function(e,t){return vr(t[0],t[1])/vr(e[0],e[1])}(s.pointers,i):1,t.rotation=s?function(e,t){return xr(t[1],t[0])-xr(e[1],e[0])}(s.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length;let d=e.element;return function(e,t){let n=e;for(;n;){if(n===t)return!0;n=n.parentNode}return!1}(t.srcEvent.target,d)&&(d=t.srcEvent.target),t.target=d,function(e,t){const n=e.lastInterval||t,i=t.timeStamp-n.timeStamp;let r,o,s,a;if(t.eventType!==ir.Cancel&&(i>25||void 0===n.velocity)){const l=t.deltaX-n.deltaX,c=t.deltaY-n.deltaY,u=wr(i,l,c);o=u.x,s=u.y,r=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=br(l,c),e.lastInterval=t}else r=n.velocity,o=n.velocityX,s=n.velocityY,a=n.direction;t.velocity=r,t.velocityX=o,t.velocityY=s,t.direction=a}(n,t),t}class Tr{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){!function(e,t,n){const i=n.pointers.length,r=n.changedPointers.length,o=t&ir.Start&&i-r===0,s=t&(ir.End|ir.Cancel)&&i-r===0;n.isFirst=Boolean(o),n.isFinal=Boolean(s),o&&(e.session={}),n.eventType=t;const a=Er(e,n);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}(this.manager,e,t)}init(){fr(this.element,this.evEl,this.domHandler),fr(this.target,this.evTarget,this.domHandler),fr(mr(this.element),this.evWin,this.domHandler)}destroy(){pr(this.element,this.evEl,this.domHandler),pr(this.target,this.evTarget,this.domHandler),pr(mr(this.element),this.evWin,this.domHandler)}}const Ar={pointerdown:ir.Start,pointermove:ir.Move,pointerup:ir.End,pointercancel:ir.Cancel,pointerout:ir.Cancel};class Sr extends Tr{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const i=Ar[e.type],r=e.pointerType,o="touch"===r;let s=t.findIndex(t=>t.pointerId===e.pointerId);i&ir.Start&&(e.buttons||o)?s<0&&(t.push(e),s=t.length-1):i&(ir.End|ir.Cancel)&&(n=!0),s<0||(t[s]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:r,srcEvent:e}),n&&t.splice(s,1))}}const Dr=["","webkit","Moz","MS","ms","o"];function Cr(e,t){const n=t[0].toUpperCase()+t.slice(1);for(const i of Dr){const r=i?i+n:t;if(r in e)return r}}const Ir={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Rr{constructor(e,t){this.options=a(a(a({},Ir),t),{},{cssProps:a(a({},Ir.cssProps),t.cssProps),inputTarget:t.inputTarget||e}),this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new Sr(this),this.touchAction=new hr(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){const{session:t}=this;if(t.stopped)return;let n;this.session.prevented&&e.srcEvent.preventDefault();const{recognizers:i}=this;let{curRecognizer:r}=t;(!r||r&&r.state&or.Recognized)&&(r=t.curRecognizer=null);let o=0;for(;o<i.length;)n=i[o],2===t.stopped||r&&n!==r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&n.state&(or.Began|or.Changed|or.Ended)&&(r=t.curRecognizer=n),o++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const t of e)this.add(t);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const t of e)this.remove(t);return this}const t="string"===typeof e?this.get(e):e;if(t){const{recognizers:e}=this,n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const i of dr(e))n[i]=n[i]||[],n[i].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const i of dr(e))t?n[i]&&n[i].splice(n[i].indexOf(t),1):delete n[i]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<n.length;)n[r](i),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,i]of Object.entries(this.options.cssProps)){const r=Cr(t.style,n);e?(this.oldCssProps[r]=t.style[r],t.style[r]=i):t.style[r]=this.oldCssProps[r]||""}e||(this.oldCssProps={})}}}let Pr=1;function Mr(e){return e&or.Cancelled?"cancel":e&or.Ended?"end":e&or.Changed?"move":e&or.Began?"start":""}class Fr{constructor(e){this.options=e,this.id=Pr++,this.state=or.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const t of e)this.recognizeWith(t);return this}let t;if("string"===typeof e){if(t=this.manager.get(e),!t)throw new Error("Cannot find recognizer ".concat(e))}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const t of e)this.dropRecognizeWith(t);return this}let t;return t="string"===typeof e?this.manager.get(e):e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const t of e)this.requireFailure(t);return this}let t;if("string"===typeof e){if(t=this.manager.get(e),!t)throw new Error("Cannot find recognizer ".concat(e))}else t=e;const{requireFail:n}=this;return-1===n.indexOf(t)&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const t of e)this.dropRequireFailure(t);return this}let t;if(t="string"===typeof e?this.manager.get(e):e,t){const e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return Boolean(this.requireFail.find(e=>e.options.enable))}canRecognizeWith(e){return Boolean(this.simultaneous[e.id])}emit(e){if(!e)return;const{state:t}=this;t<or.Ended&&this.manager.emit(this.options.event+Mr(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=or.Ended&&this.manager.emit(this.options.event+Mr(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=or.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(or.Failed|or.Possible)))return!1;e++}return!0}recognize(e){const t=a({},e);if(!this.options.enable)return this.reset(),void(this.state=or.Failed);this.state&(or.Recognized|or.Cancelled|or.Failed)&&(this.state=or.Possible),this.state=this.process(t),this.state&(or.Began|or.Changed|or.Ended|or.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class Lr extends Fr{attrTest(e){const t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,i=t&(or.Began|or.Changed),r=this.attrTest(e);return i&&(n&ir.Cancel||!r)?t|or.Cancelled:i||r?n&ir.End?t|or.Ended:t&or.Began?t|or.Changed:or.Began:or.Failed}}class kr extends Fr{constructor(){super(a({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[ar]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&ir.Start&&0===this.count)return this.failTimeout();if(i&&r&&n){if(e.eventType!==ir.End)return this.failTimeout();const n=!this.pTime||e.timeStamp-this.pTime<t.interval,i=!this.pCenter||yr(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,i&&n?this.count+=1:this.count=1,this._input=e;if(0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=or.Recognized,this.tryEmit(this._input)},t.interval),or.Began):or.Recognized}return or.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=or.Failed},this.options.interval),or.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===or.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const Or=["","start","move","end","cancel","up","down","left","right"];class Br extends Lr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(a({enable:!0,pointers:1,event:"pan",threshold:10,direction:rr.All},e)),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&rr.Horizontal&&t.push(ur),e&rr.Vertical&&t.push(cr),t}getEventNames(){return Or.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:i}=e,{direction:r}=e;const o=e.deltaX,s=e.deltaY;return r&t.direction||(t.direction&rr.Horizontal?(r=0===o?rr.None:o<0?rr.Left:rr.Right,n=o!==this.pX,i=Math.abs(e.deltaX)):(r=0===s?rr.None:s<0?rr.Up:rr.Down,n=s!==this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&Boolean(r&t.direction)}attrTest(e){return super.attrTest(e)&&(Boolean(this.state&or.Began)||!(this.state&or.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=rr[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const zr=["","start","move","end","cancel","in","out"];class Nr{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const Ur="undefined"!==typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Vr=("undefined"!==typeof window?window:global,"undefined"!==typeof global?global:window,"undefined"!==typeof document&&document,-1!==Ur.indexOf("firefox")),jr=4.000244140625;class Gr extends Nr{constructor(e,t,n){super(e,t,a({enable:!0},n)),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(Vr&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%jr===0&&(t=Math.floor(t/jr)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}const Hr=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class Wr extends Nr{constructor(e,t,n){super(e,t,a({enable:!0},n)),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,Hr.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){Hr.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const qr=["keydown","keyup"];class Xr extends Nr{constructor(e,t,n){super(e,t,a({enable:!0,tabIndex:0},n)),this.handleEvent=e=>{const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",qr.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){qr.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class Zr extends Nr{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}const Yr={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};const Kr={srcElement:"root",priority:0};class Jr{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{handlers:o,handlersByElement:s}=this,l=a(a({},Kr),n);let c=s.get(l.srcElement);c||(c=[],s.set(l.srcElement,c));const u={type:e,handler:t,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),r&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=c.length-1;for(;h>=0&&!(c[h].priority>=u.priority);)h--;c.splice(h+1,0,u)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.type===e&&o.handler===t){n.splice(r,1);const e=i.get(o.srcElement);e.splice(e.indexOf(o),1),0===e.length&&i.delete(o.srcElement)}}this._active=n.some(e=>!e.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const i=()=>{e.handled=!0},r=()=>{e.handled=!0,t=!0},o=[];for(let s=0;s<n.length;s++){const{type:l,handler:c,once:u}=n[s];if(c(a(a({},e),{},{type:l,stopPropagation:i,stopImmediatePropagation:r})),u&&o.push(n[s]),t)break}for(let e=0;e<o.length;e++){const{type:t,handler:n}=o[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return a(a(a(a({},e),function(e){const t=Yr[e.srcEvent.type];if(!t)return null;const{buttons:n,button:i}=e.srcEvent;let r=!1,o=!1,s=!1;return 2===t?(r=Boolean(1&n),o=Boolean(4&n),s=Boolean(2&n)):(r=0===i,o=1===i,s=2===i),{leftButton:r,middleButton:o,rightButton:s}}(e)),function(e,t){const n=e.center;if(!n)return null;const i=t.getBoundingClientRect(),r=i.width/t.offsetWidth||1,o=i.height/t.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-i.left-t.clientLeft)/r,y:(n.y-i.top-t.clientTop)/o}}}(e,t)),{},{preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t})}}function Qr(e){if("recognizer"in e)return e;let t;const n=Array.isArray(e)?[...e]:[e];if("function"===typeof n[0]){t=new(n.shift())(n.shift()||{})}else t=n.shift();return{recognizer:t,recognizeWith:"string"===typeof n[0]?[n[0]]:n[0],requireFailure:"string"===typeof n[1]?[n[1]]:n[1]}}class $r{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options=a({recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{}},t),this.events=new Map,this.element=e,e){this.manager=new Rr(e,this.options);for(const e of this.options.recognizers){const{recognizer:t,recognizeWith:n,requireFailure:i}=Qr(e);this.manager.add(t),n&&t.recognizeWith(n),i&&t.requireFailure(i)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new Gr(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Wr(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Xr(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Zr(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var n,i,r,o;const{manager:s}=this;if(!s)return;const a=s.get(e);a&&(a.set({enable:t}),s.touchAction.update()),null===(n=this.wheelInput)||void 0===n||n.enableEventType(e,t),null===(i=this.moveInput)||void 0===i||i.enableEventType(e,t),null===(r=this.keyInput)||void 0===r||r.enableEventType(e,t),null===(o=this.contextmenuInput)||void 0===o||o.enableEventType(e,t)}_addEventHandler(e,t,n,i,r){if("string"!==typeof e){n=t;for(const[t,o]of Object.entries(e))this._addEventHandler(t,o,n,i,r);return}const{manager:o,events:s}=this;if(!o)return;let a=s.get(e);if(!a){const t=this._getRecognizerName(e)||e;a=new Jr(this,t),s.set(e,a),o&&o.on(e,a.handleEvent)}a.add(e,t,n,i,r),a.isEmpty()||this._toggleRecognizer(a.recognizerName,!0)}_removeEventHandler(e,t){if("string"!==typeof e){for(const[t,n]of Object.entries(e))this._removeEventHandler(t,n);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:e}=i;let t=!1;for(const i of n.values())if(i.recognizerName===e&&!i.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){var t;return null===(t=this.manager.recognizers.find(t=>t.getEventNames().includes(e)))||void 0===t?void 0:t.options.event}}const eo={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(eo,"IDENTITY",{get:()=>(Le.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const to={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},no={common:0,meters:1,pixels:2},io={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},ro={multipan:[Br,{threshold:10,direction:rr.Vertical,pointers:2}],pinch:[class extends Lr{constructor(){super(a({enable:!0,event:"pinch",threshold:0,pointers:2},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}))}getTouchAction(){return[lr]}getEventNames(){return zr.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||Boolean(this.state&or.Began))}emit(e){if(1!==e.scale){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}},{},null,["multipan"]],pan:[Br,{threshold:1},["pinch"],["multipan"]],dblclick:[kr,{event:"dblclick",taps:2}],click:[kr,{event:"click"},null,["dblclick"]]},oo=Math.PI/180,so=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ao=[0,0,0],lo={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class co{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||lo,this.focalDistance=e.focalDistance||1,this.position=e.position||ao,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?to.WEB_MERCATOR:to.WEB_MERCATOR_AUTO_OFFSET:to.IDENTITY}equals(e){return e instanceof co&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Bn(e.projectionMatrix,this.projectionMatrix)&&Bn(e.viewMatrix,this.viewMatrix))}project(e){let{topLeft:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Qi(this.projectPosition(e),this.pixelProjectionMatrix),[i,r]=n,o=t?r:this.height-r;return 2===e.length?[i,o]:[i,o,n[2]]}unproject(e){let{topLeft:t=!0,targetZ:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[i,r,o]=e,s=t?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=$i([i,s,o],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(o)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=Gi(e);return t[1]=kn(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Hi(e):e}getBounds(){const e={targetZ:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0},t=this.unproject([0,0],e),n=this.unproject([this.width,0],e),i=this.unproject([0,this.height],e),r=this.unproject([this.width,this.height],e);return[Math.min(t[0],n[0],i[0],r[0]),Math.min(t[1],n[1],i[1],r[1]),Math.max(t[0],n[0],i[0],r[0]),Math.max(t[1],n[1],i[1],r[1])]}getDistanceScales(e){return e&&this.isGeospatial?Xi({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:t,y:n,width:i=1,height:r=1}=e;return t<this.x+this.width&&this.x<t+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:ni((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:ni(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:ni(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:ni(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:ni(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:ni(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes;var e}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Wi({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Xi({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:r,modelMatrix:o}=e;let s=ao;if(r&&(s=o?new Si(o).transformAsVector(r,[]):r),this.isGeospatial){const e=this.projectPosition([t,n,0]);this.center=new ei(s).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:t=so,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:r,fovy:o=75,near:s=.1,far:a=1e3,padding:l=null,focalDistance:c=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new Si).multiplyRight(t).translate(new ei(this.center).negate()),this.projectionMatrix=n||function(e){let{width:t,height:n,orthographic:i,fovyRadians:r,focalDistance:o,padding:s,near:a,far:l}=e;const c=t/n,u=i?(new Si).orthographic({fovy:r,aspect:c,focalDistance:o,near:a,far:l}):(new Si).perspective({fovy:r,aspect:c,near:a,far:l});if(s){const{left:e=0,right:i=0,top:r=0,bottom:o=0}=s,a=kn((e+t-i)/2,0,t)-t/2,l=kn((r+n-o)/2,0,n)-n/2;u[8]-=2*a/t,u[9]+=2*l/n}return u}({width:this.width,height:this.height,orthographic:i,fovyRadians:r||o*oo,focalDistance:c,padding:l,near:s,far:a});const u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h;ci(u,u,this.projectionMatrix),ci(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=li([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(h=this.viewMatrixInverse)[12],h[13],h[14]];const d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];hi(d,d,[this.width/2,-this.height/2,1]),ui(d,d,[1,-1,0]),ci(f,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=f,this.pixelUnprojectionMatrix=li([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Le.warn("Pixel project matrix not invertible")()}}co.displayName="Viewport";const uo=co;class ho{constructor(e,t){var n;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{Be("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:i,stats:r,viewport:o,timeline:s}=t||{};this.layers=[],this.resourceManager=new Rn({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:null===e||void 0===e?void 0:e.gl,deck:i,shaderAssembler:$((null===e||void 0===e||null===(n=e.info)||void 0===n?void 0:n.shadingLanguage)||"glsl"),defaultShaderModules:[te],renderPass:void 0,stats:r||new Ge({id:"deck.gl"}),viewport:o||new uo({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new d,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Be("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;const n=ze(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(t=>t.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(t=>t.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,"".concat(e," of ").concat(n))}_updateLayers(e,t){const n={};for(const o of e)n[o.id]?Le.warn("Multiple old layers with same id ".concat(o.id))():n[o.id]=o;if(this._defaultShaderModulesChanged){for(const t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let r=!1;for(const o of i)if(o.hasUniformTransition()){r="Uniform transition in ".concat(o);break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(e,t,n){for(const r of e){r.context=this.context;const e=t[r.id];null===e&&Le.warn("Multiple new layers with same id ".concat(r.id))(),t[r.id]=null;let o=null;try{this._debug&&e!==r&&r.validateProps(),e?(this._transferLayerState(e,r),this._updateLayer(r)):this._initializeLayer(r),n.push(r),o=r.isComposite?r.getSubLayers():null}catch(i){this._handleError("matching",i,r)}o&&this._updateSublayersRecursively(o,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=re}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=ie,t!==e&&(e.lifecycle=oe)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=se;try{e._finalize(),e.lifecycle=ae}catch(t){this._handleError("finalization",t,e)}}}function fo(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!fo(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"===typeof e&&"object"===typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const o of i){if(!t.hasOwnProperty(o))return!1;if(!fo(e[o],t[o],n-1))return!1}return!0}return!1}class po{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t="string"===typeof e?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let r=n.length-1;r>=0;--r){const o=n[r];if(o.containsPixel(i)){const n=e.slice();return n[0]-=o.x,n[1]-=o.y,o.unproject(n,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=ze(e,Boolean);this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){if(e){!fo(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else Le.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){return new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>{var n;return null===(n=this.getView(e.id))||void 0===n?void 0:n.makeViewport({viewState:t,width:this.width,height:this.height})}})}_updateController(e,t,n,i){const r=e.controller;if(r&&n){const o=a(a(a({},t),r),{},{id:e.id,x:n.x,y:n.y,width:n.width,height:n.height});return i&&i.constructor===r.type||(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const r=e[i],o=this.getViewState(r),s=r.makeViewport({viewState:o,width:this.width,height:this.height});let a=t[r.id];const l=Boolean(r.controller);l&&!a&&(n=!0),!n&&l||!a||(a.finalize(),a=null),this.controllers[r.id]=this._updateController(r,o,s,a),s&&this._viewports.unshift(s)}for(const i in t){const e=t[i];e&&!this.controllers[i]&&e.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((n,i)=>!e[i].equals(t[i]))}}const mo=/([0-9]+\.?[0-9]*)(%|px)/;function go(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=mo.exec(e);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(e))}}function _o(e,t){return e.relative?Math.round(e.position*t):e.position}class yo{constructor(e){const{id:t,x:n=0,y:i=0,width:r="100%",height:o="100%",padding:s=null}=e;this.id=t||this.constructor.displayName||"view",this.props=a(a({},e),{},{id:this.id}),this._x=go(n),this._y=go(i),this._width=go(r),this._height=go(o),this._padding=s&&{left:go(s.left||0),right:go(s.right||0),top:go(s.top||0),bottom:go(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&fo(this.props,e.props,2)}makeViewport(e){let{width:t,height:n,viewState:i}=e;i=this.filterViewState(i);const r=this.getDimensions({width:t,height:n});if(!r.height||!r.width)return null;return new(this.getViewportType(i))(a(a(a({},i),this.props),r))}getViewStateId(){const{viewState:e}=this.props;return"string"===typeof e?e:(null===e||void 0===e?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&"object"===typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t=a({},e);for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions(e){let{width:t,height:n}=e;const i={x:_o(this._x,t),y:_o(this._y,n),width:_o(this._width,t),height:_o(this._height,n)};return this._padding&&(i.padding={left:_o(this._padding.left,t),top:_o(this._padding.top,n),right:_o(this._padding.right,t),bottom:_o(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"===typeof e?{type:e}:a({type:this.ControllerType},e):null}}class vo extends uo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:r=0,bearing:o=0,nearZMultiplier:s=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:h=!1,projectionMatrix:d,repeat:f=!1,worldOffset:p=0,position:m,padding:g,legacyMeterSizes:_=!1}=e;let{width:y,height:v,altitude:x=1.5}=e;const b=Math.pow(2,i);let w;y=y||1,v=v||1;let E=null;if(d)x=d[5]/2,w=Ki(x);else{let n;if(e.fovy?(w=e.fovy,x=Ji(w)):w=Ki(x),g){const{top:e=0,bottom:t=0}=g;n=[0,kn((e+v-t)/2,0,v)-v/2]}E=Yi({width:y,height:v,scale:b,center:m&&[0,0,m[2]*qi(t)],offset:n,pitch:r,fovy:w,nearZMultiplier:s,farZMultiplier:l}),Number.isFinite(c)&&(E.near=c),Number.isFinite(u)&&(E.far=u)}let T=function(e){const{height:t,pitch:n,bearing:i,altitude:r,scale:o,center:s}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];ui(a,a,[0,0,-r]),di(a,a,-n*Bi),fi(a,a,i*Bi);const l=o/t;return hi(a,a,[l,l,l]),s&&ui(a,a,function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}([],s)),a}({height:v,pitch:r,bearing:o,scale:b,altitude:x});if(p){T=(new Si).translate([512*p,0,0]).multiplyLeft(T)}super(a(a(a({},e),{},{width:y,height:v,viewMatrix:T,longitude:n,latitude:t,zoom:i},E),{},{fovy:w,focalDistance:x})),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=r,this.bearing=o,this.altitude=x,this.fovy=w,this.orthographic=h,this._subViewports=f?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=t;i<=n;i++){const e=i?new vo(a(a({},this),{},{worldOffset:i})):this;this._subViewports.push(e)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*qi(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)/qi(n)]}addMetersToLngLat(e,t){return Zi(e,t)}panByPosition(e,t){const n=$i(t,this.pixelUnprojectionMatrix),i=gi([],this.projectFlat(e),function(e,t){return e[0]=-t[0],e[1]=-t[1],e}([],n)),r=gi([],this.center,i),[o,s]=this.unprojectFlat(r);return{longitude:o,latitude:s}}getBounds(){const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:n,height:i,unproject:r}=e,o={targetZ:t},s=r([0,i],o),a=r([n,i],o);let l,c;return(e.fovy?.5*e.fovy*tr:Math.atan(.5/e.altitude))>(90-e.pitch)*tr-.01?(l=nr(e,0,t),c=nr(e,n,t)):(l=r([0,0],o),c=r([n,0],o)),[s,a,c,l]}(this,(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{width:n,height:i}=this,{longitude:r,latitude:o,zoom:s}=er(a({width:n,height:i,bounds:e},t));return new vo({width:n,height:i,longitude:r,latitude:o,zoom:s})}}vo.displayName="WebMercatorViewport";const xo=vo;class bo{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,null===(t=(n=this.settings).onStart)||void 0===t||t.call(n,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null===(e=(t=this.settings).onEnd)||void 0===e||e.call(t,this))}cancel(){var e,t;this._inProgress&&(null===(e=(t=this.settings).onInterrupt)||void 0===e||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null===(e=(t=this.settings).onUpdate)||void 0===e||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const wo=()=>{},Eo=2,To=3,Ao=e=>e,So=1;class Do{constructor(e){this._onTransitionUpdate=e=>{const{time:t,settings:{interpolator:n,startProps:i,endProps:r,duration:o,easing:s}}=e,l=s(t/o),c=n.interpolateProps(i,r,l);this.propsInTransition=this.getControllerState(a(a({},this.props),c)).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new bo(e.timeline),this.onViewStateChange=e.onViewStateChange||wo,this.onStateChange=e.onStateChange||wo}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:e,endProps:t}=this.transition.settings;i=a(a({},n),e===Eo?t:this.propsInTransition||n)}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||"auto"===t)&&Boolean(n)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){if(this.transition.inProgress){return this.transition.settings.interruption===To||this._isUpdateDueToCurrentTransition(t)}return!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),r=t.transitionInterpolator,o=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(0===o)return;const s=r.initializeProps(e,i);this.propsInTransition={};const a={duration:o,easing:t.transitionEasing||Ao,interpolator:r,interruption:t.transitionInterruption||So,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),null===e||void 0===e||e(t)}}}function Co(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class Io{constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!Bn(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const r of this._propsToExtract)(r in e||r in t)&&(n[r]=e[r],i[r]=t[r]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];Co(Number.isFinite(n)||Array.isArray(n),"".concat(t," is required for transition"))})}}const Ro=["longitude","latitude","zoom","bearing","pitch"],Po=["longitude","latitude","zoom"];class Mo extends Io{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Ro,required:Po},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:r}=this.opts;if(i&&r){const o=i(e),s=i(t),a=o.unproject(r);n.start.around=r,Object.assign(n.end,{around:s.project(a),aroundPosition:a,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const r of this._propsToExtract)i[r]=On(e[r]||0,t[r]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport(a(a({},t),i));Object.assign(i,r.panByPosition(t.aroundPosition,On(e.around,t.around,n)))}return i}}const Fo={transitionDuration:0},Lo=e=>1-(1-e)*(1-e),ko=["wheel"],Oo=["panstart","panmove","panend"],Bo=["pinchstart","pinchmove","pinchend"],zo=["multipanstart","multipanmove","multipanend"],No=["dblclick"],Uo=["keydown"],Vo={};class jo{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Do(a(a({},e),{},{getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)})),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events){var e;if(this._events[t])null===(e=this.eventManager)||void 0===e||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState(a(a({makeViewport:this.makeViewport},this.props),this.state)),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const r=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return r&&t&&t.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:o=!0,touchZoom:s=!0,touchRotate:a=!1,keyboard:l=!0}=e,c=Boolean(this.onViewStateChange);this.toggleEvents(ko,c&&n),this.toggleEvents(Oo,c),this.toggleEvents(Bo,c&&(s||a)),this.toggleEvents(zo,c&&a),this.toggleEvents(No,c&&o),this.toggleEvents(Uo,c&&l),this.scrollZoom=n,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=o,this.touchZoom=s,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=a(a({},e.getViewportProps()),t),r=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),r){const e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange(a(a({},e),{},{interactionState:this._interactionState,viewId:this.props.id}))}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,Fo,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,Fo,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,a(a({},this._getTransitionProps()),{},{transitionDuration:t,transitionEasing:Lo}),{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Fo,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,a(a({},this._getTransitionProps()),{},{transitionDuration:t,transitionEasing:Lo}),{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:r}=e;let o=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==o&&(o=1/o);const s=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(s,a(a({},this._getTransitionProps({around:t})),{},{transitionDuration:i?250:1}),{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,Fo,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Fo,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,a(a({},this._getTransitionProps()),{},{transitionDuration:t,transitionEasing:Lo}),{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Vo._startPinchRotation=e.rotation,Vo._lastPinchEvent=e,this.updateViewport(n,Fo,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:Vo._startPinchRotation-n})}return this.updateViewport(t,Fo,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Vo._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=Vo;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let r=this.controllerState.rotateEnd();const o=Math.log2(e.scale),s=(o-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),l=Math.pow(2,o+s*t/2);r=r.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(r,a(a({},this._getTransitionProps({around:i})),{},{transitionDuration:t,transitionEasing:Lo}),{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Vo._startPinchRotation=null,Vo._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:o}=!0===this.keyboard?{}:this.keyboard,{controllerState:s}=this;let a;const l={};switch(e.srcEvent.code){case"Minus":a=t?s.zoomOut(n).zoomOut(n):s.zoomOut(n),l.isZooming=!0;break;case"Equal":a=t?s.zoomIn(n).zoomIn(n):s.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":t?(a=s.rotateLeft(r),l.isRotating=!0):(a=s.moveLeft(i),l.isPanning=!0);break;case"ArrowRight":t?(a=s.rotateRight(r),l.isRotating=!0):(a=s.moveRight(i),l.isPanning=!0);break;case"ArrowUp":t?(a=s.rotateUp(o),l.isRotating=!0):(a=s.moveUp(i),l.isPanning=!0);break;case"ArrowDown":t?(a=s.rotateDown(o),l.isRotating=!0):(a=s.moveDown(i),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:t}=this;return t&&t.transitionInterpolator?e?a(a({},t),{},{transitionInterpolator:new Mo(a(a(a({},e),t.transitionInterpolator.opts),{},{makeViewport:this.controllerState.makeViewport}))}):t:Fo}}class Go{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class Ho extends Go{constructor(e){const{width:t,height:n,latitude:i,longitude:r,zoom:o,bearing:s=0,pitch:a=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:f=0,startPanLngLat:p,startZoomLngLat:m,startRotatePos:g,startBearing:_,startPitch:y,startZoom:v,normalize:x=!0}=e;Co(Number.isFinite(r)),Co(Number.isFinite(i)),Co(Number.isFinite(o)),super({width:t,height:n,latitude:i,longitude:r,zoom:o,bearing:s,pitch:a,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:f,normalize:x,position:c},{startPanLngLat:p,startZoomLngLat:m,startRotatePos:g,startBearing:_,startPitch:y,startZoom:v}),this.makeViewport=e.makeViewport}panStart(e){let{pos:t}=e;return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan(e){let{pos:t,startPos:n}=e;const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:t}=e;return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(e){let{pos:t,deltaAngleX:n=0,deltaAngleY:i=0}=e;const{startRotatePos:r,startBearing:o,startPitch:s}=this.getState();if(!r||void 0===o||void 0===s)return this;let a;return a=t?this._getNewRotation(t,r,s,o):{bearing:o+n,pitch:s+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:t}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom(e){let{pos:t,startPos:n,scale:i}=e,{startZoom:r,startZoomLngLat:o}=this.getState();if(o||(r=this.getViewportProps().zoom,o=this._unproject(n)||this._unproject(t)),!o)return this;const{maxZoom:s,minZoom:l}=this.getViewportProps();let c=r+Math.log2(i);c=kn(c,l,s);const u=this.makeViewport(a(a({},this.getViewportProps()),{},{zoom:c}));return this._getUpdatedState(a({zoom:c},u.panByPosition(o,t)))}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n=a({},this.getViewportProps()),{bearing:i,longitude:r}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-t.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=kn(i,n,t);const{maxPitch:r,minPitch:o,pitch:s}=e;e.pitch=kn(s,o,r);const{normalize:a=!0}=e;return a&&Object.assign(e,function(e){const{width:t,height:n,pitch:i=0}=e;let{longitude:r,latitude:o,zoom:s,bearing:a=0}=e;(r<-180||r>180)&&(r=Pi(r+180,360)-180),(a<-180||a>180)&&(a=Pi(a+180,360)-180);const l=Fi(n/512);if(s<=l)s=l,o=0;else{const e=n/2/Math.pow(2,s),t=Hi([0,e])[1];if(o<t)o=t;else{const t=Hi([0,512-e])[1];o>t&&(o=t)}}return{width:t,height:n,longitude:r,latitude:o,zoom:s,pitch:i,bearing:a}}(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor(a(a(a({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),e))}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const r=e[0]-t[0],o=e[1]-t[1],s=e[1],a=t[1],{width:l,height:c}=this.getViewportProps(),u=r/l;let h=0;o>0?Math.abs(c-a)>5&&(h=o/(a-c)*1.2):o<0&&a>5&&(h=1-s/a),h=kn(h,-1,1);const{minPitch:d,maxPitch:f}=this.getViewportProps();let p=n;return h>0?p=n+h*(f-n):h<0&&(p=n-h*(d-n)),{pitch:p,bearing:i+180*u}}}class Wo extends jo{constructor(){super(...arguments),this.ControllerState=Ho,this.transition={transitionDuration:300,transitionInterpolator:new Mo({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e);(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState(a(a({makeViewport:this.makeViewport},e),this.state)))}}class qo extends yo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}getViewportType(){return xo}get ControllerType(){return Wo}}qo.displayName="MapView";const Xo=qo,Zo=[255,255,255],Yo=1;let Ko=0;class Jo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.type="ambient";const{color:t=Zo}=e,{intensity:n=Yo}=e;this.id=e.id||"ambient-".concat(Ko++),this.color=t,this.intensity=n}}const Qo=[255,255,255],$o=1,es=[0,0,-1];let ts=0;class ns{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.type="directional";const{color:t=Qo}=e,{intensity:n=$o}=e,{direction:i=es}=e,{_shadow:r=!1}=e;this.id=e.id||"directional-".concat(ts++),this.color=t,this.intensity=n,this.type="directional",this.direction=new ei(i).normalize().toArray(),this.shadow=r}getProjectedLight(e){return this}}class is{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{id:"pass"};const{id:n}=t;this.id=n,this.device=e,this.props=a({},t)}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class rs extends is{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){var t,n,i;const[r,o]=this.device.canvasContext.getDrawingBufferSize(),s=null===(t=e.clearCanvas)||void 0===t||t,a=null!==(n=e.clearColor)&&void 0!==n?n:!!s&&[0,0,0,0],l=!!s&&1,c=!!s&&0,u=null!==(i=e.colorMask)&&void 0!==i?i:15,h={viewport:[0,0,r,o]};e.colorMask&&(h.colorMask=u),e.scissorRect&&(h.scissorRect=e.scissorRect);const d=this.device.beginRenderPass({framebuffer:e.target,parameters:h,clearColor:a,clearDepth:l,clearStencil:c});try{return this._drawLayers(d,e)}finally{d.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:i,viewports:r,views:o,onViewportActive:s,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);const l=[];for(const c of r){const r=o&&o[c.id];null===s||void 0===s||s(c);const a=this._getDrawLayerParams(c,t),u=c.subViewports||[c];for(const o of u){const s=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:o,view:r,pass:t.pass,layers:t.layers},a);l.push(s)}}return l}_getDrawLayerParams(e,t){let{layers:n,pass:i,isPicking:r=!1,layerFilter:o,cullRect:s,effects:l,shaderModuleProps:c}=t,u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h=[],d=os(this._lastRenderIndex+1),f={layer:n[0],viewport:e,isPicking:r,renderPass:i,cullRect:s},p={};for(let g=0;g<n.length;g++){const t=n[g],r=this._shouldDrawLayer(t,f,o,p),s={shouldDrawLayer:r};var m;if(r&&!u)s.shouldDrawLayer=!0,s.layerRenderIndex=d(t,r),s.shaderModuleProps=this._getShaderModuleProps(t,l,i,c),s.layerParameters=a(a({},null===(m=t.context.deck)||void 0===m?void 0:m.props.parameters),this.getLayerParameters(t,g,e));h[g]=s}return h}_drawLayersInViewport(e,t,n){let{layers:i,shaderModuleProps:r,pass:o,target:s,viewport:a,view:l}=t;const c=function(e,t){var n,i;let{shaderModuleProps:r,target:o,viewport:s}=t;const a=null!==(n=null===r||void 0===r||null===(i=r.project)||void 0===i?void 0:i.devicePixelRatio)&&void 0!==n?n:e.canvasContext.cssToDeviceRatio(),[,l]=e.canvasContext.getDrawingBufferSize(),c=o?o.height:l,u=s;return[u.x*a,c-(u.y+u.height)*a,u.width*a,u.height*a]}(this.device,{shaderModuleProps:r,target:s,viewport:a});if(l&&l.props.clear){const e=!0===l.props.clear?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:c,scissorRect:c},clearColor:!!e.color&&[0,0,0,0],clearDepth:!!e.depth&&1}).end()}const u={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let d=0;d<i.length;d++){const t=i[d],r=n[d],{shouldDrawLayer:s}=r;if(s&&t.props.pickable&&u.pickableCount++,t.isComposite&&u.compositeCount++,t.isDrawable&&r.shouldDrawLayer){const{layerRenderIndex:n,shaderModuleProps:i,layerParameters:s}=r;u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,n),i.project&&(i.project.viewport=a),t.context.renderPass=e;try{t._drawLayer({renderPass:e,shaderModuleProps:i,uniforms:{layerIndex:n},parameters:s})}catch(h){t.raiseError(h,"drawing ".concat(t," to ").concat(o))}}}return u}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let r=e.parent;for(;r;){if(!r.props.visible||!r.filterSubLayer(t))return!1;t.layer=r,r=r.parent}if(n){const e=t.layer.id;if(e in i||(i[e]=n(t)),!i[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,i){var r;const o=this.device.canvasContext.cssToDeviceRatio(),s=(null===(r=e.internalState)||void 0===r?void 0:r.propsInTransition)||e.props,a={layer:s,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:s.modelMatrix,coordinateSystem:s.coordinateSystem,coordinateOrigin:s.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const c of t){var l;ss(a,null===(l=c.getShaderModuleProps)||void 0===l?void 0:l.call(c,e,a))}return ss(a,this.getShaderModuleProps(e,t,a),i)}}function os(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={},i=(r,o)=>{const s=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in t)&&i(r.parent,!1),l in n){const e=n[l]=n[l]||os(t[l],t);c=e(r,o),n[a]=e}else Number.isFinite(s)?(c=s+(t[l]||0),n[a]=null):c=e;return o&&c>=e&&(e=c+1),t[a]=c,c};return i}function ss(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)if(r)for(const t in r)e[t]?Object.assign(e[t],r[t]):e[t]=r[t];return e}class as extends rs{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],r=i.width*n,o=i.height*n;r===t.width&&o===t.height||t.resize({width:r,height:o}),super.render(a(a({},e),{},{clearColor:[1,1,1,1],target:t,pass:"shadow"}))}getLayerParameters(e,t,n){return a(a({},e.props.parameters),{},{blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"})}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const ls={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n"};function cs(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}function us(e){let t,n={};return i=>{for(const r in i)if(!cs(i[r],n[r])){t=e(i),n=i;break}return t}}const hs=[0,0,0,0],ds=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],fs=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ps=[0,0,0],ms=[0,0,0],gs=us(function(e){let{viewport:t,devicePixelRatio:n,coordinateSystem:i,coordinateOrigin:r}=e;const{projectionCenter:o,viewProjectionMatrix:s,originCommon:a,cameraPosCommon:l,shaderCoordinateOrigin:c,geospatialOrigin:u}=function(e,t,n){const{viewMatrixUncentered:i,projectionMatrix:r}=e;let{viewMatrix:o,viewProjectionMatrix:s}=e,a=hs,l=hs,c=e.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=_s(e,t,n);d&&(l=e.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=vi([],l,s),o=i||o,s=ci([],r,o),s=ci([],s,ds));return{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(t,i,r),h=t.getDistanceScales(),d=[t.width*n,t.height*n],f=vi([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,p={coordinateSystem:i,projectionMode:t.projectionMode,coordinateOrigin:c,commonOrigin:a.slice(0,3),center:o,pseudoMeters:Boolean(t._pseudoMeters),viewportSize:d,devicePixelRatio:n,focalDistance:f,commonUnitsPerMeter:h.unitsPerMeter,commonUnitsPerWorldUnit:h.unitsPerMeter,commonUnitsPerWorldUnit2:ps,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:fs,cameraPosition:l};if(u){const e=t.getDistanceScales(u);switch(i){case eo.METER_OFFSETS:p.commonUnitsPerWorldUnit=e.unitsPerMeter,p.commonUnitsPerWorldUnit2=e.unitsPerMeter2;break;case eo.LNGLAT:case eo.LNGLAT_OFFSETS:t._pseudoMeters||(p.commonUnitsPerMeter=e.unitsPerMeter),p.commonUnitsPerWorldUnit=e.unitsPerDegree,p.commonUnitsPerWorldUnit2=e.unitsPerDegree2;break;case eo.CARTESIAN:p.commonUnitsPerWorldUnit=[1,1,e.unitsPerMeter[2]],p.commonUnitsPerWorldUnit2=[0,0,e.unitsPerMeter2[2]]}}return p});function _s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ms;n.length<3&&(n=[n[0],n[1],0]);let i,r=n,o=!0;switch(i=t===eo.LNGLAT_OFFSETS||t===eo.METER_OFFSETS?n:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case to.WEB_MERCATOR:t!==eo.LNGLAT&&t!==eo.CARTESIAN||(i=[0,0,0],o=!1);break;case to.WEB_MERCATOR_AUTO_OFFSET:t===eo.LNGLAT?r=i:t===eo.CARTESIAN&&(r=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case to.IDENTITY:r=e.position.map(Math.fround),r[2]=r[2]||0;break;case to.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:o}}const ys=Object.keys(eo).map(e=>"const COORDINATE_SYSTEM_".concat(e,": i32 = ").concat(eo[e],";")).join(""),vs=Object.keys(to).map(e=>"const PROJECTION_MODE_".concat(e,": i32 = ").concat(to[e],";")).join(""),xs=Object.keys(no).map(e=>"const UNIT_".concat(e.toUpperCase(),": i32 = ").concat(no[e],";")).join(""),bs="".concat(ys,"\n").concat(vs,"\n").concat(xs,'\n\nconst TILE_SIZE: f32 = 512.0;\nconst PI: f32 = 3.1415926536;\nconst WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);\nconst ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);\nconst EARTH_RADIUS: f32 = 6370972.0; // meters\nconst GLOBE_RADIUS: f32 = 256.0;\n\n// -----------------------------------------------------------------------------\n// Uniform block (converted from GLSL uniform block)\n// -----------------------------------------------------------------------------\nstruct ProjectUniforms {\n  wrapLongitude: i32,\n  coordinateSystem: i32,\n  commonUnitsPerMeter: vec3<f32>,\n  projectionMode: i32,\n  scale: f32,\n  commonUnitsPerWorldUnit: vec3<f32>,\n  commonUnitsPerWorldUnit2: vec3<f32>,\n  center: vec4<f32>,\n  modelMatrix: mat4x4<f32>,\n  viewProjectionMatrix: mat4x4<f32>,\n  viewportSize: vec2<f32>,\n  devicePixelRatio: f32,\n  focalDistance: f32,\n  cameraPosition: vec3<f32>,\n  coordinateOrigin: vec3<f32>,\n  commonOrigin: vec3<f32>,\n  pseudoMeters: i32,\n};\n\n@group(0) @binding(0)\nvar<uniform> project: ProjectUniforms;\n\n// -----------------------------------------------------------------------------\n// Geometry data\n// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,\n// you might supply this via vertex attributes or a uniform. Here we define a\n// uniform struct for demonstration.)\n// -----------------------------------------------------------------------------\n\n// Structure to carry additional geometry data used by deck.gl filters.\nstruct Geometry {\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  position: vec4<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\n// @group(0) @binding(1)\nvar<private> geometry: Geometry;\n'),ws="".concat(bs,'\n\n// -----------------------------------------------------------------------------\n// Functions\n// -----------------------------------------------------------------------------\n\n// Returns an adjustment factor for commonUnitsPerMeter\nfn _project_size_at_latitude(lat: f32) -> f32 {\n  let y = clamp(lat, -89.9, 89.9);\n  return 1.0 / cos(radians(y));\n}\n\n// Overloaded version: scales a value in meters at a given latitude.\nfn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);\n}\n\n// Computes a non-linear scale factor based on geometry.\n// (Note: This function relies on "geometry" being provided.)\nfn project_size() -> f32 {\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n      project.pseudoMeters == 0) {\n    if (geometry.position.w == 0.0) {\n      return _project_size_at_latitude(geometry.worldPosition.y);\n    }\n    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    let y2 = y * y;\n    let y4 = y2 * y2;\n    let y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n\n// Overloads to scale offsets (meters to world units)\nfn project_size_float(meters: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * project_size();\n}\n\nfn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {\n  return meters * project.commonUnitsPerMeter.xy * project_size();\n}\n\nfn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {\n  return meters * project.commonUnitsPerMeter * project_size();\n}\n\nfn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {\n  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\n\n// Returns a rotation matrix aligning the z\u2011axis with the given up vector.\nfn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {\n  let uz = normalize(up);\n  let ux = select(\n    vec3<f32>(1.0, 0.0, 0.0),\n    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),\n    abs(uz.z) == 1.0\n  );\n  let uy = cross(uz, ux);\n  return mat3x3<f32>(ux, uy, uz);\n}\n\n// Since WGSL does not support "out" parameters, we return a struct.\nstruct RotationResult {\n  needsRotation: bool,\n  transform: mat3x3<f32>,\n};\n\nfn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    return RotationResult(true, project_get_orientation_matrix(commonPosition));\n  } else {\n    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed\n  };\n}\n\n// Projects a normal vector from the current coordinate system to world space.\nfn project_normal(vector: vec3<f32>) -> vec3<f32> {\n  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);\n  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\n  let rotResult = project_needs_rotation(geometry.position.xyz);\n  if (rotResult.needsRotation) {\n    n = rotResult.transform * n;\n  }\n  return n;\n}\n\n// Applies a scale offset based on y-offset (dy)\nfn project_offset_(offset: vec4<f32>) -> vec4<f32> {\n  let dy: f32 = offset.y;\n  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\n  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\n\n// Projects lng/lat coordinates to a unit tile [0,1]\nfn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {\n  var x = lnglat.x;\n  if (project.wrapLongitude != 0) {\n    x = ((x + 180.0) % 360.0) - 180.0;\n  }\n  let y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2<f32>(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// Projects lng/lat/z coordinates for a globe projection.\nfn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {\n  let lambda = radians(lnglatz.x);\n  let phi = radians(lnglatz.y);\n  let cosPhi = cos(phi);\n  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n  return vec3<f32>(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\n\n// Projects positions (with an optional 64-bit low part) from the input\n// coordinate system to the common space.\nfn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {\n  var position_world = project.modelMatrix * position;\n\n  // Work around for a Mac+NVIDIA bug:\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_mercator_(position_world.xy),\n        _project_size_at_latitude_m(position_world.z, position_world.y),\n        position_world.w\n      );\n    }\n    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\n        return vec4<f32>(\n          project_mercator_(position_world.xy) - project.commonOrigin.xy,\n          project_size_float(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);\n  }\n\n  return project_offset_(position_world) +\n         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));\n}\n\n// Overloaded versions for different input types.\nfn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {\n  return project_position_vec4_f64(position, ZERO_64_LOW);\n}\n\nfn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nfn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nfn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\n// Transforms a common space position to clip space.\nfn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {\n  return viewProjectionMatrix * position + center;\n}\n\n// Uses the project viewProjectionMatrix and center.\nfn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {\n  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);\n}\n\n// Returns a clip space offset corresponding to a given number of screen pixels.\nfn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {\n  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\n  return offset * project.focalDistance;\n}\n\nfn project_meter_size_to_pixel(meters: f32) -> f32 {\n  return project_size_float(meters) * project.scale;\n}\n\nfn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {\n  if (unit == UNIT_METERS) {\n    return project_meter_size_to_pixel(size);\n  } else if (unit == UNIT_COMMON) {\n    return size * project.scale;\n  }\n  // UNIT_PIXELS: no scaling applied.\n  return size;\n}\n\nfn project_pixel_size_float(pixels: f32) -> f32 {\n  return pixels / project.scale;\n}\n\nfn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {\n  return pixels / project.scale;\n}\n'),Es=Object.keys(eo).map(e=>"const int COORDINATE_SYSTEM_".concat(e," = ").concat(eo[e],";")).join(""),Ts=Object.keys(to).map(e=>"const int PROJECTION_MODE_".concat(e," = ").concat(to[e],";")).join(""),As=Object.keys(no).map(e=>"const int UNIT_".concat(e.toUpperCase()," = ").concat(no[e],";")).join(""),Ss="".concat(Es,"\n").concat(Ts,"\n").concat(As,"\nuniform projectUniforms {\nbool wrapLongitude;\nint coordinateSystem;\nvec3 commonUnitsPerMeter;\nint projectionMode;\nfloat scale;\nvec3 commonUnitsPerWorldUnit;\nvec3 commonUnitsPerWorldUnit2;\nvec4 center;\nmat4 modelMatrix;\nmat4 viewProjectionMatrix;\nvec2 viewportSize;\nfloat devicePixelRatio;\nfloat focalDistance;\nvec3 cameraPosition;\nvec3 coordinateOrigin;\nvec3 commonOrigin;\nbool pseudoMeters;\n} project;\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\nfloat y = clamp(lat, -89.9, 89.9);\nreturn 1.0 / cos(radians(y));\n}\nfloat project_size() {\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\nproject.pseudoMeters == false) {\nif (geometry.position.w == 0.0) {\nreturn project_size_at_latitude(geometry.worldPosition.y);\n}\nfloat y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\nfloat y2 = y * y;\nfloat y4 = y2 * y2;\nfloat y6 = y4 * y2;\nreturn 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n}\nreturn 1.0;\n}\nfloat project_size_at_latitude(float meters, float lat) {\nreturn meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\nreturn meters * project.commonUnitsPerMeter.z * project_size();\n}\nvec2 project_size(vec2 meters) {\nreturn meters * project.commonUnitsPerMeter.xy * project_size();\n}\nvec3 project_size(vec3 meters) {\nreturn meters * project.commonUnitsPerMeter * project_size();\n}\nvec4 project_size(vec4 meters) {\nreturn vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\nvec3 uz = normalize(up);\nvec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\nvec3 uy = cross(uz, ux);\nreturn mat3(ux, uy, uz);\n}\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\ntransform = project_get_orientation_matrix(commonPosition);\nreturn true;\n}\nreturn false;\n}\nvec3 project_normal(vec3 vector) {\nvec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);\nvec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\nmat3 rotation;\nif (project_needs_rotation(geometry.position.xyz, rotation)) {\nn = rotation * n;\n}\nreturn n;\n}\nvec4 project_offset_(vec4 offset) {\nfloat dy = offset.y;\nvec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\nreturn vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\nfloat x = lnglat.x;\nif (project.wrapLongitude) {\nx = mod(x + 180., 360.0) - 180.;\n}\nfloat y = clamp(lnglat.y, -89.9, 89.9);\nreturn vec2(\nradians(x) + PI,\nPI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n) * WORLD_SCALE;\n}\nvec3 project_globe_(vec3 lnglatz) {\nfloat lambda = radians(lnglatz.x);\nfloat phi = radians(lnglatz.y);\nfloat cosPhi = cos(phi);\nfloat D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\nreturn vec3(\nsin(lambda) * cosPhi,\n-cos(lambda) * cosPhi,\nsin(phi)\n) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\nvec4 position_world = project.modelMatrix * position;\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_mercator_(position_world.xy),\nproject_size_at_latitude(position_world.z, position_world.y),\nposition_world.w\n);\n}\nif (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\nposition_world.xyz += project.coordinateOrigin;\n}\n}\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_globe_(position_world.xyz),\nposition_world.w\n);\n}\n}\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nif (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\nreturn vec4(\nproject_mercator_(position_world.xy) - project.commonOrigin.xy,\nproject_size(position_world.z),\nposition_world.w\n);\n}\n}\n}\nif (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\nposition_world.xyz -= project.coordinateOrigin;\n}\nreturn project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));\n}\nvec4 project_position(vec4 position) {\nreturn project_position(position, ZERO_64_LOW);\n}\nvec3 project_position(vec3 position, vec3 position64Low) {\nvec4 projected_position = project_position(vec4(position, 1.0), position64Low);\nreturn projected_position.xyz;\n}\nvec3 project_position(vec3 position) {\nvec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\nreturn projected_position.xyz;\n}\nvec2 project_position(vec2 position) {\nvec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\nreturn projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\nreturn offset * project.focalDistance;\n}\nfloat project_size_to_pixel(float meters) {\nreturn project_size(meters) * project.scale;\n}\nfloat project_size_to_pixel(float size, int unit) {\nif (unit == UNIT_METERS) return project_size_to_pixel(size);\nif (unit == UNIT_COMMON) return size * project.scale;\nreturn size;\n}\nfloat project_pixel_size(float pixels) {\nreturn pixels / project.scale;\n}\nvec2 project_pixel_size(vec2 pixels) {\nreturn pixels / project.scale;\n}\n"),Ds={};const Cs={name:"project",dependencies:[ls,Y],source:ws,vs:Ss,getUniforms:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ds;return"viewport"in e?function(e){let{viewport:t,devicePixelRatio:n=1,modelMatrix:i=null,coordinateSystem:r=eo.DEFAULT,coordinateOrigin:o=ms,autoWrapLongitude:s=!1}=e;r===eo.DEFAULT&&(r=t.isGeospatial?eo.LNGLAT:eo.CARTESIAN);const a=gs({viewport:t,devicePixelRatio:n,coordinateSystem:r,coordinateOrigin:o});return a.wrapLongitude=s,a.modelMatrix=i||fs,a}(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},Is="\nuniform shadowUniforms {\n  bool drawShadowMap;\n  bool useShadowMap;\n  vec4 color;\n  highp int lightId;\n  float lightCount;\n  mat4 viewProjectionMatrix0;\n  mat4 viewProjectionMatrix1;\n  vec4 projectCenter0;\n  vec4 projectCenter1;\n} shadow;\n",Rs="\n".concat(Is,"\n").concat("\nconst int max_lights = 2;\n\nout vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  mat4 viewProjectionMatrices[max_lights];\n  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;\n  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;\n  vec4 projectCenters[max_lights];\n  projectCenters[0] = shadow.projectCenter0;\n  projectCenters[1] = shadow.projectCenter1;\n\n  if (shadow.drawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);\n  }\n  if (shadow.useShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow.lightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n","\n"),Ps="\n".concat(Is,"\n").concat("\nconst int max_lights = 2;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\n\nin vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow.drawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow.useShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow.lightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow.color.a / shadow.lightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n","\n"),Ms=us(function(e){let{viewport:t,center:n}=e;return new Si(t.viewProjectionMatrix).invert().transform(n)}),Fs=us(function(e){let{viewport:t,shadowMatrices:n}=e;const i=[],r=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,s=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(e=>function(e,t){const[n,i,r]=e,o=$i([n,i,r],t);if(Number.isFinite(r))return o;return[o[0],o[1],0]}(e,r));for(const a of n){const e=a.clone().translate(new ei(t.center).negate()),n=s.map(t=>e.transform(t)),r=(new Si).ortho({left:Math.min(...n.map(e=>e[0])),right:Math.max(...n.map(e=>e[0])),bottom:Math.min(...n.map(e=>e[1])),top:Math.max(...n.map(e=>e[1])),near:Math.min(...n.map(e=>-e[2])),far:Math.max(...n.map(e=>-e[2]))});i.push(r.multiplyRight(a))}return i}),Ls=[0,0,0,1],ks=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];const Os={name:"shadow",dependencies:[Cs],vs:Rs,fs:Ps,inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(e){const{shadowEnabled:t=!0,project:n}=e;if(!t||!n||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const i=Cs.getUniforms(n),r=Ms({viewport:n.viewport,center:i.center}),o=[],s=Fs({shadowMatrices:e.shadowMatrices,viewport:n.viewport}).slice();for(let l=0;l<e.shadowMatrices.length;l++){const e=s[l],t=e.clone().translate(new ei(n.viewport.center).negate());i.coordinateSystem===eo.LNGLAT&&i.projectionMode===to.WEB_MERCATOR?(s[l]=t,o[l]=r):(s[l]=e.clone().multiplyRight(ks),o[l]=t.transform(r))}const a={drawShadowMap:Boolean(e.drawToShadowMap),useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||Ls,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let l=0;l<s.length;l++)a["viewProjectionMatrix".concat(l)]=s[l],a["projectCenter".concat(l)]=o[l];for(let l=0;l<2;l++)a["shadow_uShadowMap".concat(l)]=e.shadowMaps&&e.shadowMaps[l]||e.dummyShadowMap;return a},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Bs={color:[255,255,255],intensity:1},zs=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Ns=[0,0,0,200/255];class Us{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.id="lighting-effect",this.shadowColor=Ns,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(Os),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=e}preRender(e){let{layers:t,layerFilter:n,viewports:i,onViewportActive:r,views:o}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let e=0;e<this.shadowPasses.length;e++){this.shadowPasses[e].render({layers:t,layerFilter:n,viewports:i,onViewportActive:r,views:o,shaderModuleProps:{shadow:{shadowLightId:e,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(e=>e.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(t=>t.getProjectedLight({layer:e})),pointLights:this.pointLights.map(t=>t.getProjectedLight({layer:e}))},r=e.props.material;return{shadow:n,lighting:i,phongMaterial:r,gouraudMaterial:r}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Os))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=(new Si).lookAt({eye:new ei(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new as(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;e||0!==t.length||0!==n.length||(this.ambientLight=new Jo(Bs),this.directionalLights.push(new ns(zs[0]),new ns(zs[1])))}}const Vs=new Us;class js{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){const n=t.findIndex(t=>function(e,t){var n,i;return(null!==(n=e.order)&&void 0!==n?n:1/0)-(null!==(i=t.order)&&void 0!==i?i:1/0)}(t,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(fo(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const n=[];for(const i of e){const e=t[i.id];let r=i;e&&e!==i?e.setProps?(e.setProps(i.props),r=e):e.cleanup(this._context):e||i.setup(this._context),n.push(r),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(e=>e instanceof Us)||this._resolvedEffects.push(Vs),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Gs extends rs{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const Hs={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class Ws extends rs{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:t,layerFilter:n,views:i,viewports:r,onViewportActive:o,pickingFBO:s,deviceRect:{x:a,y:l,width:c,height:u},cullRect:h,effects:d,pass:f="picking",pickZ:p,shaderModuleProps:m}=e;this.pickZ=p;const g=this._resetColorEncoder(p),_=[a,l,c,u],y=super.render({target:s,layers:t,layerFilter:n,views:i,viewports:r,onViewportActive:o,cullRect:h,effects:null===d||void 0===d?void 0:d.filter(e=>e.useInPicking),pass:f,isPicking:!0,shaderModuleProps:m,clearColor:[0,0,0,0],colorMask:15,scissorRect:_});this._colorEncoderState=null;return{decodePickingColor:g&&qs.bind(null,g),stats:y}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const i=a({},e.props.parameters),{pickable:r,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:r&&o.includes("draw")&&(Object.assign(i,Hs),i.blend=!0,i.blendColor=function(e,t,n){const{byLayer:i,byAlpha:r}=e;let o,s=i.get(t);s?(s.viewports.push(n),o=s.a):(o=i.size+1,o<=255?(s={a:o,layer:t,viewports:[n]},i.set(t,s),r[o]=s):(Le.warn("Too many pickable layers, only picking the first 255")(),o=0));return[0,0,0,o/255]}(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function qs(e,t){const n=e.byAlpha[t[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(t)}}class Xs{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Gs(e),this.pickLayersPass=new Ws(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n=a({layerFilter:this.layerFilter,isPicking:this.drawPickingColors},e);n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const r=t.render(a(a({},n),{},{target:i}));n.effects&&this._postRender(n.effects,n),this.renderCount++,Be("deckRenderer.renderLayers",this,r,e)}needsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();0===e.length&&[0,1].map(t=>{const n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:"deck-renderbuffer-".concat(t),colorAttachments:[n]}))});for(const n of e)n.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i=a(a({},t),{},{inputBuffer:n[0],swapBuffer:n[1]});for(const r of e)if(r.postRender){i.target=r.id===this.lastPostProcessEffect?t.target:void 0;const e=r.postRender(i);i.inputBuffer=e,i.swapBuffer=e===n[0]?n[1]:n[0]}}}const Zs={pickedColor:null,pickedObjectIndex:-1};function Ys(e){let{pickedColors:t,decodePickingColor:n,deviceX:i,deviceY:r,deviceRadius:o,deviceRect:s}=e;const{x:l,y:c,width:u,height:h}=s;let d=o*o,f=-1,p=0;for(let a=0;a<h;a++){const e=a+c-r,n=e*e;if(n>d)p+=4*u;else for(let r=0;r<u;r++){if(t[p+3]-1>=0){const e=r+l-i,t=e*e+n;t<=d&&(d=t,f=p)}p+=4}}if(f>=0){const e=t.slice(f,f+4),i=n(e);if(i){const t=Math.floor(f/4/u),n=f/4-t*u;return a(a({},i),{},{pickedColor:e,pickedX:l+n,pickedY:c+t})}Le.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Zs}function Ks(e){let t,{pickInfo:n,viewports:i,pixelRatio:r,x:o,y:s,z:a}=e,l=i[0];if(i.length>1&&(l=function(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.containsPixel(t))return i}return e[0]}((null===n||void 0===n?void 0:n.pickedViewports)||i,{x:o,y:s})),l){const e=[o-l.x,s-l.y];void 0!==a&&(e[2]=a),t=l.unproject(e)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:o,y:s,pixel:[o,s],coordinate:t,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:r}}function Js(e){const{pickInfo:t,lastPickedInfo:n,mode:i,layers:r}=e,{pickedColor:o,pickedLayer:s,pickedObjectIndex:l}=t,c=s?[s]:[];if("hover"===i){const e=n.index,t=n.layerId,i=s?s.props.id:null;if(i!==t||l!==e){if(i!==t){const e=r.find(e=>e.props.id===t);e&&c.unshift(e)}n.layerId=i,n.index=l,n.info=null}}const u=Ks(e),h=new Map;return h.set(null,u),c.forEach(e=>{let t=a({},u);e===s&&(t.color=o,t.index=l,t.picked=!0),t=Qs({layer:e,info:t,mode:i});const r=t.layer;e===s&&"hover"===i&&(n.info=t),h.set(r.id,t),"hover"===i&&r.updateAutoHighlight(t)}),h}function Qs(e){let{layer:t,info:n,mode:i}=e;for(;t&&n;){const e=n.layer||null;n.sourceLayer=e,n.layer=t,n=t.getPickingInfo({info:n,mode:i,sourceLayer:e}),t=t.parent}return n}class $s{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Ws(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:t,y:n,layers:i,viewports:r}=e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastPickedInfo.info;const s=o&&o.layer&&o.layer.id,l=o&&o.viewport&&o.viewport.id,c=s?i.find(e=>e.id===s):null,u=l&&r.find(e=>e.id===l)||r[0],h=u&&u.unproject([t-u.x,n-u.y]),d={x:t,y:n,viewport:u,coordinate:h,layer:c};return a(a({},o),d)}_resizeBuffer(){var e,t;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:n}=this.device.getDefaultCanvasContext();null===(e=this.pickingFBO)||void 0===e||e.resize({width:n.width,height:n.height}),null===(t=this.depthFBO)||void 0===t||t.resize({width:n.width,height:n.height})}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter(e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite);return t.length?t:null}_pickClosestObject(e){let{layers:t,views:n,viewports:i,x:r,y:o,radius:s=0,depth:l=1,mode:c="query",unproject3D:u,onViewportActive:h,effects:d}=e;const f=this.device.canvasContext.cssToDeviceRatio(),p=this._getPickable(t);if(!p||0===i.length)return{result:[],emptyInfo:Ks({viewports:i,x:r,y:o,pixelRatio:f})};this._resizeBuffer();const m=this.device.canvasContext.cssToDevicePixels([r,o],!0),g=[m.x+Math.floor(m.width/2),m.y+Math.floor(m.height/2)],_=Math.round(s*f),{width:y,height:v}=this.pickingFBO,x=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:_,deviceWidth:y,deviceHeight:v}),b={x:r-s,y:o-s,width:2*s+1,height:2*s+1};let w;const E=[],T=new Set;for(let A=0;A<l;A++){let e,t;if(x){e=Ys(a(a({},this._drawAndSample({layers:p,views:n,viewports:i,onViewportActive:h,deviceRect:x,cullRect:b,effects:d,pass:"picking:".concat(c)})),{},{deviceX:g[0],deviceY:g[1],deviceRadius:_,deviceRect:x}))}else e={pickedColor:null,pickedObjectIndex:-1};if(e.pickedLayer&&u&&this.depthFBO){const{pickedColors:r}=this._drawAndSample({layers:[e.pickedLayer],views:n,viewports:i,onViewportActive:h,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:b,effects:d,pass:"picking:".concat(c,":z")},!0);r[3]&&(t=r[0])}e.pickedLayer&&A+1<l&&(T.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),w=Js({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:c,layers:p,viewports:i,x:r,y:o,z:t,pixelRatio:f});for(const n of w.values())n.layer&&E.push(n);if(!e.pickedColor)break}for(const a of T)a.restorePickingColors();return{result:E,emptyInfo:w.get(null)}}_pickVisibleObjects(e){let{layers:t,views:n,viewports:i,x:r,y:o,width:s=1,height:l=1,mode:c="query",maxObjects:u=null,onViewportActive:h,effects:d}=e;const f=this._getPickable(t);if(!f||0===i.length)return[];this._resizeBuffer();const p=this.device.canvasContext.cssToDeviceRatio(),m=this.device.canvasContext.cssToDevicePixels([r,o],!0),g=m.x,_=m.y+m.height,y=this.device.canvasContext.cssToDevicePixels([r+s,o+l],!0),v=y.x+y.width,x=y.y,b={x:g,y:x,width:v-g,height:_-x},w=function(e){let{pickedColors:t,decodePickingColor:n}=e;const i=new Map;if(t)for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const e=t.slice(r,r+4),o=e.join(",");if(!i.has(o)){const t=n(e);t?i.set(o,a(a({},t),{},{color:e})):Le.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(i.values())}(this._drawAndSample({layers:f,views:n,viewports:i,onViewportActive:h,deviceRect:b,cullRect:{x:r,y:o,width:s,height:l},effects:d,pass:"picking:".concat(c)})),E=new Map,T=[],A=Number.isFinite(u);for(let a=0;a<w.length;a++){var S;if(A&&T.length>=u)break;const e=w[a];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:r,y:o,pixelRatio:p};t=Qs({layer:e.pickedLayer,info:t,mode:c});const n=t.layer.id;E.has(n)||E.set(n,new Set);const i=E.get(n),s=null!==(S=t.object)&&void 0!==S?S:t.index;i.has(s)||(i.add(s),T.push(t))}return T}_drawAndSample(e){let{layers:t,views:n,viewports:i,onViewportActive:r,deviceRect:o,cullRect:s,effects:a,pass:l}=e,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const u=c?this.depthFBO:this.pickingFBO,h={layers:t,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:u,deviceRect:o,cullRect:s,effects:a,pass:l,pickZ:c,preRenderStats:{},isPicking:!0};for(const y of a)y.useInPicking&&(h.preRenderStats[y.id]=y.preRender(h));const{decodePickingColor:d}=this.pickLayersPass.render(h),{x:f,y:p,width:m,height:g}=o,_=new(c?Float32Array:Uint8Array)(m*g*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:f,sourceY:p,sourceWidth:m,sourceHeight:g,target:_}),{pickedColors:_,decodePickingColor:d}}_getPickingRect(e){let{deviceX:t,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:o}=e;const s=Math.max(0,t-i),a=Math.max(0,n-i),l=Math.min(r,t+i+1)-s,c=Math.min(o,n+i+1)-a;return l<=0||c<=0?null:{x:s,y:a,width:l,height:c}}}const ea={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},ta="top-left",na="__root";class ia{constructor(e){let{deck:t,parentElement:n}=e;this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!fo(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const e=t[n.id];e?e.viewId!==n.viewId||e.placement!==n.placement?(this._remove(e),this._add(n)):n!==e&&(e.setProps(n.props),n=e):this._add(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const e=t[n];e&&this._remove(e)}this.widgets=e}_add(e){const{viewId:t=null,placement:n=ta}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,n).append(i),e._element=i}_remove(e){var t;null===(t=e.onRemove)||void 0===t||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const n=e||na;let i=this.containers[n];var r;i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",null===(r=this.parentElement)||void 0===r||r.append(i),this.containers[n]=i);let o=i.querySelector(".".concat(t));return o||(o=document.createElement("div"),o.className=t,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,ea[t]),i.append(o)),o}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,r=n===na||i,o=this.containers[n];r?(o.style.display="block",o.style.left="".concat(i?i.x:0,"px"),o.style.top="".concat(i?i.y:0,"px"),o.style.width="".concat(i?i.width:e,"px"),o.style.height="".concat(i?i.height:t,"px")):o.style.display="none"}}onRedraw(e){let{viewports:t,layers:n}=e;const i=t.reduce((e,t)=>(e[t.id]=t,e),{});for(const s of this.getWidgets()){const{viewId:e}=s;if(e){const t=i[e];var r;if(t)s.onViewportChange&&s.onViewportChange(t),null===(r=s.onRedraw)||void 0===r||r.call(s,{viewports:[t],layers:n})}else{var o;if(s.onViewportChange)for(const e of t)s.onViewportChange(e);null===(o=s.onRedraw)||void 0===o||o.call(s,{viewports:t,layers:n})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(const r of this.getWidgets()){var n;const{viewId:o}=r;var i;if(!o||o===(null===(n=e.viewport)||void 0===n?void 0:n.id))null===(i=r.onHover)||void 0===i||i.call(r,e,t)}}onEvent(e,t){const n=io[t.type];if(n)for(const o of this.getWidgets()){var i;const{viewId:s}=o;var r;if(!s||s===(null===(i=e.viewport)||void 0===i?void 0:i.id))null===(r=o[n])||void 0===r||r.call(o,e,t)}}}const ra={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class oa{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd(e){let{deck:t}=e;const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,ra),this.deck=t,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===(null===(t=this.lastViewport)||void 0===t?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.element;if(i){if("string"===typeof e)i.innerText=e;else{if(!e)return this.isVisible=!1,void(i.style.display="none");e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className)}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(t,"px, ").concat(n,"px)"),e&&"object"===typeof e&&"style"in e&&Object.assign(i.style,e.style)}}}var sa;const aa=null===(sa=globalThis.loaders)||void 0===sa?void 0:sa.parseImageNode,la="undefined"!==typeof Image,ca="undefined"!==typeof ImageBitmap,ua=Boolean(aa),ha=!!gt||ua;function da(e){const t=pa(e);if(!t)throw new Error("Not an image");return t}function fa(e){switch(da(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function pa(e){return"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!==typeof Image&&e instanceof Image?"image":e&&"object"===typeof e&&e.data&&e.width&&e.height?"data":null}const ma=/^data:image\/svg\+xml/,ga=/\.svg((\?|#).*)?$/;function _a(e){return e&&(ma.test(e)||ga.test(e))}function ya(e,t){if(_a(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function va(e,t,n){const i=function(e,t){if(_a(t)){let t=(new TextDecoder).decode(e);try{"function"===typeof unescape&&"function"===typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(n){throw new Error(n.message)}return"data:image/svg+xml;base64,".concat(btoa(t))}return ya(e,t)}(e,n),r=self.URL||self.webkitURL,o="string"!==typeof i&&r.createObjectURL(i);try{return await async function(e,t){const n=new Image;if(n.src=e,t.image&&t.image.decode&&n.decode)return await n.decode(),n;return await new Promise((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>{const n=e instanceof Error?e.message:"error";t(new Error(n))}}catch(i){t(i)}})}(o||i,t)}finally{o&&r.revokeObjectURL(o)}}const xa={};let ba=!0;async function wa(e,t,n){let i;if(_a(n)){i=await va(e,t,n)}else i=ya(e,n);const r=t&&t.imagebitmap;return await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(e){for(const t in e||xa)return!1;return!0}(t)&&ba||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(n){console.warn(n),ba=!1}return await createImageBitmap(e)}(i,r)}function Ea(e){return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=function(e){return[...e].map(e=>e.charCodeAt(0))}(t);for(let r=0;r<i.length;++r)if(i[r]!==e[r+n])return!1;return!0}(e,"ftyp",4)?0===(96&e[8])?null:function(e){switch(function(e,t,n){return String.fromCharCode(...e.slice(t,n))}(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}(e):null}const Ta=!1,Aa=!0;function Sa(e){const t=Da(e);return function(e){const t=Da(e),n=t.byteLength>=24&&2303741511===t.getUint32(0,Ta);if(!n)return null;return{mimeType:"image/png",width:t.getUint32(16,Ta),height:t.getUint32(20,Ta)}}(t)||function(e){const t=Da(e),n=t.byteLength>=3&&65496===t.getUint16(0,Ta)&&255===t.getUint8(2);if(!n)return null;const{tableMarkers:i,sofMarkers:r}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let o=2;for(;o+9<t.byteLength;){const e=t.getUint16(o,Ta);if(r.has(e))return{mimeType:"image/jpeg",height:t.getUint16(o+5,Ta),width:t.getUint16(o+7,Ta)};if(!i.has(e))return null;o+=2,o+=t.getUint16(o,Ta)}return null}(t)||function(e){const t=Da(e),n=t.byteLength>=10&&1195984440===t.getUint32(0,Ta);if(!n)return null;return{mimeType:"image/gif",width:t.getUint16(6,Aa),height:t.getUint16(8,Aa)}}(t)||function(e){const t=Da(e),n=t.byteLength>=14&&16973===t.getUint16(0,Ta)&&t.getUint32(2,Aa)===t.byteLength;if(!n)return null;return{mimeType:"image/bmp",width:t.getUint32(18,Aa),height:t.getUint32(22,Aa)}}(t)||function(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),n=Ea(t);if(!n)return null;return{mimeType:n.mimeType,width:0,height:0}}(t)}function Da(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const Ca={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,n){const i=((t=t||{}).image||{}).type||"auto",{url:r}=n||{},o=function(e){switch(e){case"auto":case"data":return function(){if(ca)return"imagebitmap";if(la)return"image";if(ha)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return ca||la||ha;case"imagebitmap":return ca;case"image":return la;case"data":return ha;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}(i);let s;switch(o){case"imagebitmap":s=await wa(e,t,r);break;case"image":s=await va(e,t,r);break;case"data":s=await async function(e){var t;const{mimeType:n}=Sa(e)||{},i=null===(t=globalThis.loaders)||void 0===t?void 0:t.parseImageNode;return Je(i),await i(e,n)}(e);break;default:Je(!1)}return"data"===i&&(s=fa(s)),s},tests:[e=>Boolean(Sa(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};const Ia={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],n=e[e.length-1];return"{"===t&&"}"===n||"["===t&&"]"===n},parseTextSync:JSON.parse};const Ra=function(){const e="9.1.14",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(e));return t||(Le.log(1,"deck.gl ".concat(e))(),globalThis.deck=a(a({},globalThis.deck),{},{VERSION:e,version:e,log:Le,_registerLoggers:Oe}),function(e){const t=_n();e=Array.isArray(e)?e:[e];for(const n of e){const e=$e(n);t.find(t=>e===t)||t.unshift(e)}}([Ia,[Ca,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}();const Pa=new class{constructor(){o(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Ge({id:e})),this.stats.get(e)}},Ma=new Re({id:"luma.gl"}),Fa={};function La(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";Fa[e]=Fa[e]||1;const t=Fa[e]++;return"".concat(e,"-").concat(t)}class ka{toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,':"').concat(this.id,'"')}constructor(e,t,n){if(o(this,"id",void 0),o(this,"props",void 0),o(this,"userData",{}),o(this,"_device",void 0),o(this,"destroyed",!1),o(this,"allocatedBytes",0),o(this,"_attachedResources",new Set),!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n=a({},t);for(const i in e)void 0!==e[i]&&(n[i]=e[i]);return n}(t,n);const i="undefined"!==this.props.id?this.props.id:La(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("".concat(t,"s Active")).decrementCount()}trackAllocatedMemory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag];const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get("".concat(t," Memory")).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag];const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get("".concat(e," Memory")).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}}o(ka,"defaultProps",{id:"undefined",handle:void 0,userData:void 0});class Oa extends ka{get[Symbol.toStringTag](){return"Buffer"}constructor(e,t){const n=a({},t);(t.usage||0)&Oa.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?n.indexType="uint32":t.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(e,n,Oa.defaultProps),o(this,"usage",void 0),o(this,"indexType",void 0),o(this,"updateTimestamp",void 0),o(this,"debugData",new ArrayBuffer(0)),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer(a(a({},this.props),e))}readSyncWebGL(e,t){throw new Error("not implemented")}_setDebugData(e,t,n){const i=ArrayBuffer.isView(e)?e.buffer:e,r=Math.min(e?e.byteLength:n,Oa.DEBUG_DATA_MAX_LENGTH);null===i?this.debugData=new ArrayBuffer(r):0===t&&n===i.byteLength?this.debugData=i.slice(0,r):this.debugData=i.slice(t,t+r)}}function Ba(e){const t=function(e){const t=Na[e];return t}(za[e]),n=e.includes("norm"),i=!n&&!e.startsWith("float"),r=e.startsWith("s");return{dataType:za[e],byteLength:t,integer:i,signed:r,normalized:n}}o(Oa,"defaultProps",a(a({},ka.defaultProps),{},{usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1})),o(Oa,"MAP_READ",1),o(Oa,"MAP_WRITE",2),o(Oa,"COPY_SRC",4),o(Oa,"COPY_DST",8),o(Oa,"INDEX",16),o(Oa,"VERTEX",32),o(Oa,"UNIFORM",64),o(Oa,"STORAGE",128),o(Oa,"INDIRECT",256),o(Oa,"QUERY_RESOLVE",512),o(Oa,"DEBUG_DATA_MAX_LENGTH",32);const za={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},Na={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Ua="texture-compression-bc",Va="texture-compression-astc",ja="texture-compression-etc2",Ga="texture-compression-pvrtc-webgl",Ha="texture-compression-atc-webgl",Wa="float32-renderable-webgl",qa="float16-renderable-webgl",Xa="snorm8-renderable-webgl",Za="norm16-renderable-webgl",Ya="snorm16-renderable-webgl",Ka="float32-filterable",Ja="float16-filterable-webgl";function Qa(e){const t=$a[e];if(!t)throw new Error("Unsupported texture format ".concat(e));return t}const $a={r8unorm:{},r8snorm:{render:Xa},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Xa},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:qa,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Za},"r16snorm-webgl":{f:Ya},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Xa},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:qa,filter:Ja},"rg16unorm-webgl":{render:Za},"rg16snorm-webgl":{render:Ya},r32uint:{},r32sint:{},r32float:{render:Wa,filter:Ka},rgb9e5ufloat:{channels:"rgb",packed:!0,render:"rgb9e5ufloat-renderable-webgl"},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Wa},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Za},"rgb16snorm-webgl":{f:Za},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Ka},rgba16uint:{},rgba16sint:{},rgba16float:{render:qa,filter:Ja},"rgba16unorm-webgl":{render:Za},"rgba16snorm-webgl":{render:Ya},"rgb32float-webgl":{render:Wa,filter:Ka},rgba32uint:{},rgba32sint:{},rgba32float:{render:Wa,filter:Ka},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Ua},"bc1-rgb-unorm-srgb-webgl":{f:Ua},"bc1-rgba-unorm":{f:Ua},"bc1-rgba-unorm-srgb":{f:Ua},"bc2-rgba-unorm":{f:Ua},"bc2-rgba-unorm-srgb":{f:Ua},"bc3-rgba-unorm":{f:Ua},"bc3-rgba-unorm-srgb":{f:Ua},"bc4-r-unorm":{f:Ua},"bc4-r-snorm":{f:Ua},"bc5-rg-unorm":{f:Ua},"bc5-rg-snorm":{f:Ua},"bc6h-rgb-ufloat":{f:Ua},"bc6h-rgb-float":{f:Ua},"bc7-rgba-unorm":{f:Ua},"bc7-rgba-unorm-srgb":{f:Ua},"etc2-rgb8unorm":{f:ja},"etc2-rgb8unorm-srgb":{f:ja},"etc2-rgb8a1unorm":{f:ja},"etc2-rgb8a1unorm-srgb":{f:ja},"etc2-rgba8unorm":{f:ja},"etc2-rgba8unorm-srgb":{f:ja},"eac-r11unorm":{f:ja},"eac-r11snorm":{f:ja},"eac-rg11unorm":{f:ja},"eac-rg11snorm":{f:ja},"astc-4x4-unorm":{f:Va},"astc-4x4-unorm-srgb":{f:Va},"astc-5x4-unorm":{f:Va},"astc-5x4-unorm-srgb":{f:Va},"astc-5x5-unorm":{f:Va},"astc-5x5-unorm-srgb":{f:Va},"astc-6x5-unorm":{f:Va},"astc-6x5-unorm-srgb":{f:Va},"astc-6x6-unorm":{f:Va},"astc-6x6-unorm-srgb":{f:Va},"astc-8x5-unorm":{f:Va},"astc-8x5-unorm-srgb":{f:Va},"astc-8x6-unorm":{f:Va},"astc-8x6-unorm-srgb":{f:Va},"astc-8x8-unorm":{f:Va},"astc-8x8-unorm-srgb":{f:Va},"astc-10x5-unorm":{f:Va},"astc-10x5-unorm-srgb":{f:Va},"astc-10x6-unorm":{f:Va},"astc-10x6-unorm-srgb":{f:Va},"astc-10x8-unorm":{f:Va},"astc-10x8-unorm-srgb":{f:Va},"astc-10x10-unorm":{f:Va},"astc-10x10-unorm-srgb":{f:Va},"astc-12x10-unorm":{f:Va},"astc-12x10-unorm-srgb":{f:Va},"astc-12x12-unorm":{f:Va},"astc-12x12-unorm-srgb":{f:Va},"pvrtc-rgb4unorm-webgl":{f:Ga},"pvrtc-rgba4unorm-webgl":{f:Ga},"pvrtc-rbg2unorm-webgl":{f:Ga},"pvrtc-rgba2unorm-webgl":{f:Ga},"etc1-rbg-unorm-webgl":{f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{f:Ha},"atc-rgba-unorm-webgl":{f:Ha},"atc-rgbai-unorm-webgl":{f:Ha}},el=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],tl=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function nl(e){return el.some(t=>e.startsWith(t))}function il(e){let t=function(e){var t,n,i,r,o,s,l,c;const u=Qa(e),h=u.bytesPerPixel||1,d=u.bitsPerChannel||[8,8,8,8];delete u.bitsPerChannel,delete u.bytesPerPixel,delete u.f,delete u.render,delete u.filter,delete u.blend,delete u.store;const f=a(a({},u),{},{format:e,attachment:u.attachment||"color",channels:u.channels||"r",components:u.components||(null===(t=u.channels)||void 0===t?void 0:t.length)||1,bytesPerPixel:h,bitsPerChannel:d,dataType:u.dataType||"uint8",srgb:null!==(n=u.srgb)&&void 0!==n&&n,packed:null!==(i=u.packed)&&void 0!==i&&i,webgl:null!==(r=u.webgl)&&void 0!==r&&r,integer:null!==(o=u.integer)&&void 0!==o&&o,signed:null!==(s=u.signed)&&void 0!==s&&s,normalized:null!==(l=u.normalized)&&void 0!==l&&l,compressed:null!==(c=u.compressed)&&void 0!==c&&c});return f}(e);if(nl(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=function(e){const t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){const[,e,n]=t;return{blockWidth:Number(e),blockHeight:Number(n)}}return null}(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const n=tl.exec(e);if(n){const[,i,r,o,s,a]=n,l=Ba("".concat(o).concat(r)),c=8*l.byteLength,u=i.length,h=[c,u>=2?c:0,u>=3?c:0,u>=4?c:0];t={format:e,attachment:t.attachment,dataType:l.dataType,components:u,channels:i,integer:l.integer,signed:l.signed,normalized:l.normalized,bitsPerChannel:h,bytesPerPixel:l.byteLength*i.length,packed:t.packed,srgb:t.srgb},"-webgl"===a&&(t.webgl=!0),"-srgb"===s&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}class rl{}class ol{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;o(this,"features",void 0),o(this,"disabledFeatures",void 0),this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!(null!==(t=this.disabledFeatures)&&void 0!==t&&t[e])&&this.features.has(e)}}class sl{get[Symbol.toStringTag](){return"Device"}constructor(e){o(this,"id",void 0),o(this,"props",void 0),o(this,"userData",{}),o(this,"statsManager",Pa),o(this,"timestamp",0),o(this,"_reused",!1),o(this,"_lumaData",{}),this.props=a(a({},sl.defaultProps),e),this.id=this.props.id||La(this[Symbol.toStringTag].toLowerCase())}getTextureFormatCapabilities(e){const t=function(e){var t,n,i,r,o;const s=Qa(e),a={format:e,create:null===(t=s.f)||void 0===t||t,render:null===(n=s.render)||void 0===n||n,filter:null===(i=s.filter)||void 0===i||i,blend:null===(r=s.blend)||void 0===r||r,store:null===(o=s.store)||void 0===o||o},l=il(e),c=e.startsWith("depth")||e.startsWith("stencil"),u=null===l||void 0===l?void 0:l.signed,h=null===l||void 0===l?void 0:l.integer,d=null===l||void 0===l?void 0:l.webgl;return a.render&&(a.render=!u),a.filter&&(a.filter=!c&&!u&&!h&&!d),a}(e),n=e=>{var t;return null===(t="string"===typeof e?this.features.has(e):e)||void 0===t||t},i=n(t.create),r={format:e,create:i,render:i&&n(t.render),filter:i&&n(t.filter),blend:i&&n(t.blend),store:i&&n(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(r)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return nl(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return!0===e.createCanvasContext?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t=a({},e);return(e.usage||0)&Oa.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":Ma.warn("indices buffer content must be of integer type")()),t}}o(sl,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Ma.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Ma.get("debug")||void 0,debugShaders:Ma.get("debug-shaders")||void 0,debugFramebuffers:Boolean(Ma.get("debug-framebuffers")),debugWebGL:Boolean(Ma.get("debug-webgl")),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});const al=me()&&"undefined"!==typeof document,ll="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class cl{constructor(){if(o(this,"stats",Pa),o(this,"log",Ma),o(this,"VERSION","9.1.9"),o(this,"spector",void 0),o(this,"preregisteredAdapters",new Map),globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Ma.error("Found luma.gl ".concat(globalThis.luma.VERSION," while initialzing ").concat(this.VERSION))(),Ma.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Ma.error("This version of luma.gl has already been initialized")()}Ma.log(1,"".concat(this.VERSION," - ").concat("set luma.log.level=1 (or higher) to trace rendering"))(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.getAdapterMap(e);return Array.from(t).map(e=>{let[,t]=e;return t}).filter(e=>{var t;return null===(t=e.isSupported)||void 0===t?void 0:t.call(e)}).map(e=>e.type)}getBestAvailableAdapter(){var e,t,n,i;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const o=this.getAdapterMap(r);return null!==(e=o.get("webgpu"))&&void 0!==e&&null!==(t=e.isSupported)&&void 0!==t&&t.call(e)?"webgpu":null!==(n=o.get("webgl"))&&void 0!==n&&null!==(i=n.isSupported)&&void 0!==i&&i.call(n)?"webgl":null}setDefaultDeviceProps(e){Object.assign(cl.defaultProps,e)}async createDevice(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=a(a({},cl.defaultProps),t),t.waitForPageLoad&&await cl.pageLoaded;const n=this.getAdapterMap(t.adapters);let i=t.type||"";"best-available"===i&&(i=this.getBestAvailableAdapter(t.adapters)||i);const r=(this.getAdapterMap(t.adapters)||n).get(i),o=await(null===r||void 0===r||null===(e=r.create)||void 0===e?void 0:e.call(r,t));if(o)return o;throw new Error(ll)}async attachDevice(e){var t;const n=this.getAdapterMap(e.adapters);let i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await cl.pageLoaded,null===e.handle&&(i="unknown");const r=n.get(i),o=await(null===r||void 0===r||null===(t=r.attach)||void 0===t?void 0:t.call(r,null));if(o)return o;throw new Error(ll)}enforceWebGL2(){var e;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const i=this.getAdapterMap(n).get("webgl");i||Ma.warn("enforceWebGL2: webgl adapter not found")(),null===i||void 0===i||null===(e=i.enforceWebGL2)||void 0===e||e.call(i,t)}getAdapterMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}registerDevices(e){Ma.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const e=t.adapter;e&&this.preregisteredAdapters.set(e.type,e)}}}o(cl,"defaultProps",a(a({},sl.defaultProps),{},{type:"best-available",adapters:void 0,waitForPageLoad:!0})),o(cl,"pageLoaded",function(){if(al&&"complete"===document.readyState||"undefined"===typeof window)return Promise.resolve();return new Promise(e=>{window.addEventListener("load",()=>e())})}().then(()=>{Ma.probe(2,"DOM is loaded")()}));const ul=new cl;class hl{}const dl={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},fl=(e,t,n)=>t?e.enable(n):e.disable(n),pl=(e,t,n)=>e.hint(n,t),ml=(e,t,n)=>e.pixelStorei(n,t),gl=(e,t,n)=>{const i=36006===n?36009:36008;return e.bindFramebuffer(i,t)},_l=(e,t,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];e.bindBuffer(i,t)};function yl(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const vl={3042:fl,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:fl,2885:(e,t)=>e.cullFace(t),2929:fl,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:fl,35723:pl,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>{var n;return null===(n=e.bindTransformFeedback)||void 0===n?void 0:n.call(e,36386,t)},34229:(e,t)=>e.bindVertexArray(t),36006:gl,36010:gl,34964:_l,36662:_l,36663:_l,35053:_l,35055:_l,2886:(e,t)=>e.frontFace(t),33170:pl,2849:(e,t)=>e.lineWidth(t),32823:fl,32824:"polygonOffset",10752:"polygonOffset",35977:fl,32926:fl,32928:fl,32938:"sampleCoverage",32939:"sampleCoverage",3089:fl,3088:(e,t)=>e.scissor(...t),2960:fl,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:fl,10754:fl,12288:fl,12289:fl,12290:fl,12291:fl,12292:fl,12293:fl,12294:fl,12295:fl,3333:ml,3317:ml,37440:ml,37441:ml,37443:ml,3330:ml,3332:ml,3331:ml,3314:ml,32878:ml,3316:ml,3315:ml,32877:ml,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"===typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===(null===t||void 0===t?void 0:t.length)?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=yl(t)?t:[t,t];const[n,i]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,i)},stencilFunc:(e,t)=>{t=yl(t)&&3===t.length?[...t,...t]:t;const[n,i,r,o,s,a]=t;e.stencilFuncSeparate(1028,n,i,r),e.stencilFuncSeparate(1029,o,s,a)},stencilOp:(e,t)=>{t=yl(t)&&3===t.length?[...t,...t]:t;const[n,i,r,o,s,a]=t;e.stencilOpSeparate(1028,n,i,r),e.stencilOpSeparate(1029,o,s,a)},viewport:(e,t)=>e.viewport(...t)};function xl(e,t,n){return void 0!==t[e]?t[e]:n[e]}const bl={blendEquation:(e,t,n)=>e.blendEquationSeparate(xl(32777,t,n),xl(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(xl(32969,t,n),xl(32968,t,n),xl(32971,t,n),xl(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(xl(32824,t,n),xl(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(xl(32938,t,n),xl(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,xl(2962,t,n),xl(2967,t,n),xl(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,xl(34816,t,n),xl(36003,t,n),xl(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,xl(2964,t,n),xl(2965,t,n),xl(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,xl(34817,t,n),xl(34818,t,n),xl(34819,t,n))},wl={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,n)=>e({36007:n}),bindTransformFeedback:(e,t,n)=>e({36389:n}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({36006:n,36010:n});case 36009:return e({36006:n});case 36008:return e({36010:n});default:return null}},bindBuffer:(e,t,n)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return i?e({[i]:n}):{valueChanged:!0}},blendColor:(e,t,n,i,r)=>e({32773:new Float32Array([t,n,i,r])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,n)=>e({32777:t,34877:n}),blendFunc:(e,t,n)=>e({32969:t,32968:n,32971:t,32970:n}),blendFuncSeparate:(e,t,n,i,r)=>e({32969:t,32968:n,32971:i,32970:r}),clearColor:(e,t,n,i,r)=>e({3106:new Float32Array([t,n,i,r])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,n,i,r)=>e({3107:[t,n,i,r]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,n)=>e({2928:new Float32Array([t,n])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,n)=>e({32824:t,10752:n}),sampleCoverage:(e,t,n)=>e({32938:t,32939:n}),scissor:(e,t,n,i,r)=>e({3088:new Int32Array([t,n,i,r])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,n)=>e({[1028===t?2968:36005]:n}),stencilFunc:(e,t,n,i)=>e({2962:t,2967:n,2963:i,34816:t,36003:n,36004:i}),stencilFuncSeparate:(e,t,n,i,r)=>e({[1028===t?2962:34816]:n,[1028===t?2967:36003]:i,[1028===t?2963:36004]:r}),stencilOp:(e,t,n,i)=>e({2964:t,2965:n,2966:i,34817:t,34818:n,34819:i}),stencilOpSeparate:(e,t,n,i,r)=>e({[1028===t?2964:34817]:n,[1028===t?2965:34818]:i,[1028===t?2966:34819]:r}),viewport:(e,t,n,i,r)=>e({2978:[t,n,i,r]})},El=(e,t)=>e.isEnabled(t),Tl={3042:El,2884:El,2929:El,3024:El,32823:El,32926:El,32928:El,3089:El,2960:El,35977:El},Al=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Sl(e,t){if(function(e){for(const t in e)return!1;return!0}(t))return;const n={};for(const r in t){const i=Number(r),o=vl[r];o&&("string"===typeof o?n[o]=!0:o(e,t[r],i))}const i=e.state&&e.state.cache;if(i)for(const r in n){(0,bl[r])(e,t,i)}}function Dl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dl;if("number"===typeof t){const n=t,i=Tl[n];return i?i(e,n):e.getParameter(n)}const n=Array.isArray(t)?t:Object.keys(t),i={};for(const r of n){const t=Tl[r];i[r]=t?t(e,Number(r)):e.getParameter(Number(r))}return i}function Cl(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&i&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}class Il{static get(e){return e.state}constructor(e,t){o(this,"gl",void 0),o(this,"program",null),o(this,"stateStack",[]),o(this,"enable",!0),o(this,"cache",null),o(this,"log",void 0),o(this,"initialized",!1),this.gl=e,this.log=(null===t||void 0===t?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Sl(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?Dl(e):Object.assign({},dl),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const i=Il.get(e);i.program!==n&&(t(n),i.program=n)}}(e);for(const n in wl){Pl(e,n,wl[n])}Rl(e,"getParameter"),Rl(e,"isEnabled")}_updateCache(e){let t,n=!1;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){const o=e[r],s=this.cache[r];Cl(o,s)||(n=!0,t=s,i&&!(r in i)&&(i[r]=s),this.cache[r]=o)}return{valueChanged:n,oldValue:t}}}function Rl(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||Al.has(t))return n(t);const i=Il.get(e);return t in i.cache||(i.cache[t]=n(t)),i.enable?i.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function Pl(e,t,n){if(!e[t])return;const i=e[t].bind(e);e[t]=function(){const t=Il.get(e);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];const{valueChanged:a,oldValue:l}=n(t._updateCache,...o);return a&&i(...o),l},Object.defineProperty(e[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function Ml(e,t,n){return void 0===n[t]&&(n[t]=e.getExtension(t)||null),n[t]}function Fl(e,t){const n=e.getParameter(7936),i=e.getParameter(7937);Ml(e,"WEBGL_debug_renderer_info",t);const r=t.WEBGL_debug_renderer_info,o=e.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936)||n,s=e.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937)||i,a=e.getParameter(7938),l=Ll(o,s),c=function(e,t){if(/Metal/i.exec(e)||/Metal/i.exec(t))return"metal";if(/ANGLE/i.exec(e)||/ANGLE/i.exec(t))return"opengl";return"unknown"}(o,s),u=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(Ll(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(o,s);return{type:"webgl",gpu:l,gpuType:u,gpuBackend:c,vendor:o,renderer:s,version:a,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Ll(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function kl(e){switch(e){case"uint8":case"unorm8":return 5121;case"sint8":case"snorm8":return 5120;case"uint16":case"unorm16":return 5123;case"sint16":case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const Ol="WEBGL_compressed_texture_s3tc",Bl="WEBGL_compressed_texture_s3tc_srgb",zl="EXT_texture_compression_rgtc",Nl="EXT_texture_compression_bptc",Ul="EXT_texture_norm16",Vl="EXT_render_snorm",jl={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Vl],"norm16-renderable-webgl":[Ul],"snorm16-renderable-webgl":[Ul,Vl],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Ol,Bl,zl,Nl],"texture-compression-bc5-webgl":[zl],"texture-compression-bc7-webgl":[Nl],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]};const Gl={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:"EXT_color_buffer_float",dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Ol},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Bl},"bc1-rgba-unorm":{gl:33777,x:Ol},"bc1-rgba-unorm-srgb":{gl:35916,x:Bl},"bc2-rgba-unorm":{gl:33778,x:Ol},"bc2-rgba-unorm-srgb":{gl:35918,x:Bl},"bc3-rgba-unorm":{gl:33779,x:Ol},"bc3-rgba-unorm-srgb":{gl:35919,x:Bl},"bc4-r-unorm":{gl:36283,x:zl},"bc4-r-snorm":{gl:36284,x:zl},"bc5-rg-unorm":{gl:36285,x:zl},"bc5-rg-snorm":{gl:36286,x:zl},"bc6h-rgb-ufloat":{gl:36495,x:Nl},"bc6h-rgb-float":{gl:36494,x:Nl},"bc7-rgba-unorm":{gl:36492,x:Nl},"bc7-rgba-unorm-srgb":{gl:36493,x:Nl},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Hl(e){var t;const n=Gl[e],i=function(e){const t=Gl[e],n=null===t||void 0===t?void 0:t.gl;if(void 0===n)throw new Error("Unsupported texture format ".concat(e));return n}(e),r=il(e);return{internalFormat:i,format:(null===n||void 0===n?void 0:n.dataFormat)||Wl(r.channels,r.integer,r.normalized,i),type:r.dataType?kl(r.dataType):(null===n||void 0===n||null===(t=n.types)||void 0===t?void 0:t[0])||5121,compressed:r.compressed||!1}}function Wl(e,t,n,i){if(6408===i||6407===i)return i;switch(e){case"r":return t&&!n?36244:6403;case"rg":return t&&!n?33320:33319;case"rgb":return t&&!n?36248:6407;case"rgba":return t&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}const ql={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Xl extends ol{constructor(e,t,n){super([],n),o(this,"gl",void 0),o(this,"extensions",void 0),o(this,"testedFeatures",new Set),this.gl=e,this.extensions=t,Ml(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){var t;return(null===(t=this.disabledFeatures)||void 0===t||!t[e])&&(this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in jl}(e)&&function(e,t,n){return(jl[t]||[]).every(t=>Ml(e,t,n))}(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(e=>"polygon-mode-webgl"!==e);for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(ql),...Object.keys(jl)]}getWebGLFeature(e){const t=ql[e];return"string"===typeof t?Boolean(Ml(this.gl,t,this.extensions)):Boolean(t)}}class Zl extends rl{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}constructor(e){super(),o(this,"gl",void 0),o(this,"limits",{}),this.gl=e}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Yl{toString(){return"".concat(this[Symbol.toStringTag],"(").concat(this.id,")")}constructor(e){if(o(this,"id",void 0),o(this,"props",void 0),o(this,"canvas",void 0),o(this,"htmlCanvas",void 0),o(this,"offscreenCanvas",void 0),o(this,"type",void 0),o(this,"width",1),o(this,"height",1),o(this,"resizeObserver",void 0),o(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1}),this.props=a(a({},Yl.defaultProps),e),e=this.props,!me())return this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,void(this.canvas=null);if(e.canvas)"string"===typeof e.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}(e.canvas):this.canvas=e.canvas;else{var t,n;const i=function(e){const{width:t,height:n}=e,i=document.createElement("canvas");return i.id=La("lumagl-auto-created-canvas"),i.width=t||1,i.height=n||1,i.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",i.style.height=Number.isFinite(n)?"".concat(n,"px"):"100%",i}(e),r=function(e){if("string"===typeof e){const t=document.getElementById(e);if(!t)throw new Error("".concat(e," is not an HTML element"));return t}if(e)return e;return document.body}((null===(t=e)||void 0===t?void 0:t.container)||null);r.insertBefore(i,r.firstChild),this.canvas=i,null!==(n=e)&&void 0!==n&&n.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(e=>{for(const t of e)t.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){if("undefined"!==typeof OffscreenCanvas&&this.canvas instanceof OffscreenCanvas)return 1;if(!(e=void 0===e?this.props.useDevicePixels:e)||e<=0)return 1;if(!0===e){return"undefined"!==typeof window&&window.devicePixelRatio||1}return e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{var e;const[t]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||(null===(e=this.htmlCanvas)||void 0===e?void 0:e.clientWidth);return n?t/n:1}catch(t){return 1}}cssToDevicePixels(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.cssToDeviceRatio(),[i,r]=this.getDrawingBufferSize();return function(e,t,n,i,r){const o=e,s=Kl(o[0],t,n);let a=Jl(o[1],t,i,r),l=Kl(o[0]+1,t,n);const c=l===n-1?l:l-1;let u;l=Jl(o[1]+1,t,i,r),r?(l=0===l?l:l+1,u=a,a=l):u=l===i-1?l:l-1;return{x:s,y:a,width:Math.max(c-s+1,1),height:Math.max(u-a+1,1)}}(e,n,i,r,t)}setDevicePixelRatio(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;n&&i||(Ma.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const r=this._canvasSizeInfo;if(r.clientWidth!==n||r.clientHeight!==i||r.devicePixelRatio!==e){let t=e;const r=Math.floor(n*t),o=Math.floor(i*t);this.htmlCanvas.width=r,this.htmlCanvas.height=o;if(this.device.gl){const[s,a]=this.getDrawingBufferSize();s===r&&a===o||(t=Math.min(s/n,a/i),this.htmlCanvas.width=Math.floor(n*t),this.htmlCanvas.height=Math.floor(i*t),Ma.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;"lumagl-auto-created-canvas"===(null===(t=this.htmlCanvas)||void 0===t?void 0:t.id)&&(this.htmlCanvas.id=e)}}function Kl(e,t,n){return Math.min(Math.round(e*t),n-1)}function Jl(e,t,n,i){return i?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}o(Yl,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});class Ql extends ka{get[Symbol.toStringTag](){return"Texture"}toString(){return"Texture(".concat(this.id,",").concat(this.format,",").concat(this.width,"x").concat(this.height,")")}constructor(e,t){if(super(e,t=Ql.normalizeProps(e,t),Ql.defaultProps),o(this,"dimension",void 0),o(this,"format",void 0),o(this,"width",void 0),o(this,"height",void 0),o(this,"depth",void 0),o(this,"mipLevels",void 0),o(this,"updateTimestamp",void 0),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,void 0===this.props.width||void 0===this.props.height){const e=Ql.getTextureDataSize(this.props.data);this.width=(null===e||void 0===e?void 0:e.width)||1,this.height=(null===e||void 0===e?void 0:e.height)||1}this.props.mipmaps&&void 0===this.props.mipLevels&&(this.props.mipLevels="pyramid"),this.mipLevels="pyramid"===this.props.mipLevels?Ql.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture(a(a({},this.props),e))}static isExternalImage(e){return"undefined"!==typeof ImageData&&e instanceof ImageData||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if("undefined"!==typeof ImageData&&e instanceof ImageData||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if("undefined"!==typeof VideoFrame&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const t=null===e||void 0===e?void 0:e.data;return ArrayBuffer.isView(t)}static getTextureDataSize(e){if(!e)return null;if(ArrayBuffer.isView(e))return null;if(Array.isArray(e))return Ql.getTextureDataSize(e[0]);if(Ql.isExternalImage(e))return Ql.getExternalImageSize(e);if(e&&"object"===typeof e&&e.constructor===Object){const t=Object.values(e)[0];return{width:t.width,height:t.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,t){let n;return n=ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e],n}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static normalizeProps(e,t){var n;const i=a({},t),r=(null===e||void 0===e||null===(n=e.props)||void 0===n||null===(n=n._resourceDefaults)||void 0===n?void 0:n.texture)||{};Object.assign(i,r);const{width:o,height:s}=i;return"number"===typeof o&&(i.width=Math.max(1,Math.ceil(o))),"number"===typeof s&&(i.height=Math.max(1,Math.ceil(s))),i}}o(Ql,"COPY_SRC",1),o(Ql,"COPY_DST",2),o(Ql,"TEXTURE",4),o(Ql,"STORAGE",8),o(Ql,"RENDER_ATTACHMENT",16),o(Ql,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),o(Ql,"defaultProps",a(a({},ka.defaultProps),{},{data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0})),o(Ql,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});class $l extends ka{get[Symbol.toStringTag](){return"Framebuffer"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},$l.defaultProps),o(this,"width",void 0),o(this,"height",void 0),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(t=>t.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer(a(a({},this.props),{},{colorAttachments:t,depthStencilAttachment:n}))}resize(e){let t=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||n!==this.width,this.width=n,this.height=i}t&&(Ma.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(this.width,"x").concat(this.height))(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,t)=>{if("string"===typeof e){const n=this.createColorTexture(e,t);return this.attachResource(n),n.view}return e instanceof Ql?e.view:e});const e=this.props.depthStencilAttachment;if(e)if("string"===typeof e){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else this.depthStencilAttachment=e instanceof Ql?e.view:e}createColorTexture(e,t){return this.device.createTexture({id:"".concat(this.id,"-color-attachment-").concat(t),usage:Ql.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:"".concat(this.id,"-depth-stencil-attachment"),usage:Ql.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.colorAttachments[n].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}}o($l,"defaultProps",a(a({},ka.defaultProps),{},{width:1,height:1,colorAttachments:[],depthStencilAttachment:null}));class ec extends $l{constructor(e,t){super(e,t),o(this,"device",void 0),o(this,"gl",void 0),o(this,"handle",void 0),o(this,"colorAttachments",[]),o(this,"depthStencilAttachment",null);const n=null===t.handle;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const e=this.colorAttachments[t];if(e){const n=36064+t;this._attachTextureView(n,e)}}if(this.depthStencilAttachment){const e=function(e){switch(il(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error("Not a depth stencil format: ".concat(e))}}(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(36053!==e)throw new Error("Framebuffer ".concat(function(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return"".concat(e)}}(e)))}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:n}=this.device,{texture:i}=t,r=t.props.baseMipLevel,o=t.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,i.handle,r,o);break;case 34067:const t=function(e){return e<34069?e+34069:e}(o);n.framebufferTexture2D(36160,e,t,i.handle,r);break;case 3553:n.framebufferTexture2D(36160,e,3553,i.handle,r);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}}class tc extends Yl{get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),o(this,"device",void 0),o(this,"format","rgba8unorm"),o(this,"depthStencilFormat","depth24plus"),o(this,"presentationSize",void 0),o(this,"_framebuffer",null),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId("".concat(this.device.id,"-canvas")),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new ec(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const t=this.getDevicePixelRatio(null===e||void 0===e?void 0:e.useDevicePixels);return void this.setDevicePixelRatio(t,e)}}commit(){}}async function nc(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",e),t&&(i.id=t),new Promise((t,r)=>{i.onload=t,i.onerror=t=>r(new Error("Unable to load script '".concat(e,"': ").concat(t))),n.appendChild(i)})}let ic=null,rc=!1;const oc={debugSpectorJS:Ma.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};var sc;!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"}(sc||(sc={}));function ac(e){return e.luma=e.luma||{},e.luma}function lc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.debugWebGL||t.traceWebGL?function(e,t){if(!globalThis.WebGLDebugUtils)return Ma.warn("webgl-debug not loaded")(),e;const n=ac(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init(a(a({},sc),e));const i=globalThis.WebGLDebugUtils.makeDebugContext(e,uc.bind(null,t),hc.bind(null,t));for(const s in sc)s in i||"number"!==typeof sc[s]||(i[s]=sc[s]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.setPrototypeOf(r,i);const o=Object.create(r);return n.realContext=e,n.debugContext=o,o.debug=!0,o}(e,t):function(e){const t=ac(e);return t.realContext?t.realContext:e}(e)}function cc(e,t){t=Array.from(t).map(e=>void 0===e?"undefined":e);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n="".concat(n.slice(0,100)).concat(n.length>100?"...":""),"gl.".concat(e,"(").concat(n,")")}function uc(e,t,n,i){i=Array.from(i).map(e=>void 0===e?"undefined":e);const r=globalThis.WebGLDebugUtils.glEnumToString(t),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i),s="".concat(r," in gl.").concat(n,"(").concat(o,")");Ma.error(s)()}function hc(e,t,n){let i="";Ma.level>=1&&(i=cc(t,n),e.traceWebGL&&Ma.log(1,i)());for(const r of n)void 0===r&&(i=i||cc(t,n))}const dc={};function fc(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";dc[e]=dc[e]||1;const t=dc[e]++;return"".concat(e,"-").concat(t)}class pc extends Oa{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),o(this,"device",void 0),o(this,"gl",void 0),o(this,"handle",void 0),o(this,"glTarget",void 0),o(this,"glUsage",void 0),o(this,"glIndexType",5123),o(this,"byteLength",void 0),o(this,"bytesUsed",void 0),this.device=e,this.gl=this.device.gl;const n="object"===typeof t?t.handle:void 0;this.handle=n||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,a(a({},this.props),{},{data:typeof this.props.data})),this.glTarget=function(e){if(e&Oa.INDEX)return 34963;if(e&Oa.VERTEX)return 34962;if(e&Oa.UNIFORM)return 35345;return 34962}(this.props.usage),this.glUsage=function(e){if(e&Oa.INDEX)return 35044;if(e&Oa.VERTEX)return 35044;if(e&Oa.UNIFORM)return 35048;return 35044}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength+t;const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=36663;this.gl.bindBuffer(n,this.handle),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this._setDebugData(e,t,e.byteLength)}async readAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return this.readSyncWebGL(e,t)}readSyncWebGL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;t=null!==t&&void 0!==t?t:this.byteLength-e;const n=new Uint8Array(t);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,0,t),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,t),n}}function mc(e,t,n,i){if(null!==i&&void 0!==i&&i.inlineSource){const i=function(e,t,n){let i="";for(let r=t-2;r<=t;r++){const o=e[r-1];void 0!==o&&(i+=gc(o,t,n))}return i}(t,n),r=e.linePos>0?"".concat(" ".repeat(e.linePos+5),"^^^\n"):"";return"\n".concat(i).concat(r).concat(e.type.toUpperCase(),": ").concat(e.message,"\n\n")}const r="error"===e.type?"red":"#8B4000";return null!==i&&void 0!==i&&i.html?"<div class='luma-compiler-log-error' style=\"color:".concat(r,';"><b> ').concat(e.type.toUpperCase(),": ").concat(e.message,"</b></div>"):"".concat(e.type.toUpperCase(),": ").concat(e.message)}function gc(e,t,n){const i=null!==n&&void 0!==n&&n.html?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return"".concat(function(e,t){let n="";for(let i=e.length;i<t;++i)n+=" ";return n+e}(String(t),4),": ").concat(i).concat(null!==n&&void 0!==n&&n.html?"<br/>":"\n")}class _c extends ka{get[Symbol.toStringTag](){return"Shader"}constructor(e,t){t=a(a({},t),{},{debugShaders:t.debugShaders||e.props.debugShaders||"errors"}),super(e,a({id:yc(t)},t),_c.defaultProps),o(this,"stage",void 0),o(this,"source",void 0),o(this,"compilationStatus","pending"),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}const t=await this.getCompilationInfo();"warnings"===e&&0===(null===t||void 0===t?void 0:t.length)||this._displayShaderLog(t)}_displayShaderLog(e){var t,n;if("undefined"===typeof document||null===(t=document)||void 0===t||!t.createElement)return;const i=vc(this.source),r="".concat(this.stage," ").concat(i);let o=function(e,t,n){let i="";const r=t.split(/\r?\n/),o=e.slice().sort((e,t)=>e.lineNum-t.lineNum);switch((null===n||void 0===n?void 0:n.showSourceCode)||"no"){case"all":let t=0;for(let e=1;e<=r.length;e++)for(i+=gc(r[e-1],e,n);o.length>t&&o[t].lineNum===e;){const e=o[t++];i+=mc(e,r,e.lineNum,a(a({},n),{},{inlineSource:!1}))}return i;case"issues":case"no":for(const o of e)i+=mc(o,r,o.lineNum,{inlineSource:"no"!==(null===n||void 0===n?void 0:n.showSourceCode)});return i}}(e,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(o+='<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>'.concat(s,"</pre></code>"));const l=document.createElement("Button");l.innerHTML="\n<h1>Shader Compilation Error in ".concat(r,'</h1><br /><br />\n<code style="user-select:text;"><pre>\n').concat(o,"\n</pre></code>"),l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l);null===(n=document.getElementsByClassName("luma-compiler-log-error")[0])||void 0===n||n.scrollIntoView(),l.onclick=()=>{const e="data:text/plain,".concat(encodeURIComponent(this.source));navigator.clipboard.writeText(e)}}}function yc(e){return vc(e.source)||e.id||La("unnamed ".concat(e.stage,"-shader"))}function vc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}function xc(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}o(_c,"defaultProps",a(a({},ka.defaultProps),{},{language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}));class bc extends _c{constructor(e,t){switch(super(e,t),o(this,"device",void 0),o(this,"handle",void 0),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?function(e){const t=e.split(/\r?\n/),n=[];for(const i of t){if(i.length<=1)continue;const e=i.split(":");if(2===e.length){const[t,i]=e;n.push({message:i.trim(),type:xc(t),lineNum:0,linePos:0});continue}const[t,r,o,...s]=e;let a=parseInt(o,10);isNaN(a)&&(a=0);let l=parseInt(r,10);isNaN(l)&&(l=0),n.push({message:s.join(":").trim(),type:xc(t),lineNum:a,linePos:l})}return n}(e):[]}getTranslatedSource(){const e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(null===e||void 0===e?void 0:e.getTranslatedShaderSource(this.handle))||null}async _compile(e){e=e.startsWith("#version ")?e:"#version 300 es\n".concat(e);const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),this.device.props.debug){if(this.device.features.has("compilation-status-async-webgl"))Ma.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Ma.info(2,"Shader ".concat(this.id," - async compilation complete: ").concat(this.compilationStatus))(),this._getCompilationStatus(),this.debugShader();else if(this._getCompilationStatus(),this.debugShader(),"error"===this.compilationStatus)throw new Error("GLSL compilation errors in ".concat(this.props.stage," shader ").concat(this.props.id))}else this.compilationStatus="pending"}async _waitForCompilationComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}class wc extends ka{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){super(e,t=wc.normalizeProps(e,t),wc.defaultProps)}static normalizeProps(e,t){var n;const i=(null===e||void 0===e||null===(n=e.props)||void 0===n||null===(n=n._resourceDefaults)||void 0===n?void 0:n.sampler)||{};return a(a({},t),i)}}function Ec(e,t){const n=e,{gl:i}=n;if(t.cullMode)switch(t.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029)}if(t.frontFace&&i.frontFace(Cc("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&i.enable(34383),void 0!==t.depthBias&&(i.enable(32823),i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const e=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,i=Cc("provokingVertex",t.provokingVertex,{first:36429,last:36430});null===e||void 0===e||e.provokingVertexWEBGL(i)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const e=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,i=Cc("polygonMode",t.polygonMode,{fill:6914,line:6913});null===e||void 0===e||e.polygonModeWEBGL(1028,i),null===e||void 0===e||e.polygonModeWEBGL(1029,i)}t.polygonOffsetLine&&i.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&i.enable(12288),t.clipDistance1&&i.enable(12289),t.clipDistance2&&i.enable(12290),t.clipDistance3&&i.enable(12291),t.clipDistance4&&i.enable(12292),t.clipDistance5&&i.enable(12293),t.clipDistance6&&i.enable(12294),t.clipDistance7&&i.enable(12295)),void 0!==t.depthWriteEnabled&&i.depthMask(function(e,t){return t}(0,t.depthWriteEnabled)),t.depthCompare&&("always"!==t.depthCompare?i.enable(2929):i.disable(2929),i.depthFunc(Tc("depthCompare",t.depthCompare))),t.stencilWriteMask){const e=t.stencilWriteMask;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,e)}if(t.stencilReadMask&&Ma.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const e=t.stencilReadMask||4294967295,n=Tc("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,n,0,e),i.stencilFuncSeparate(1029,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=Ac("stencilPassOperation",t.stencilPassOperation),n=Ac("stencilFailOperation",t.stencilFailOperation),r=Ac("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(1028,n,r,e),i.stencilOpSeparate(1029,n,r,e)}switch(t.blend){case!0:i.enable(3042);break;case!1:i.disable(3042)}if(t.blendColorOperation||t.blendAlphaOperation){const e=Sc("blendColorOperation",t.blendColorOperation||"add"),n=Sc("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(e,n);const r=Dc("blendColorSrcFactor",t.blendColorSrcFactor||"one"),o=Dc("blendColorDstFactor",t.blendColorDstFactor||"zero"),s=Dc("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=Dc("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(r,o,s,a)}}function Tc(e,t){return Cc(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Ac(e,t){return Cc(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Sc(e,t){return Cc(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Dc(e,t){return Cc(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Cc(e,t,n){if(!(t in n))throw new Error(function(e,t){return"Illegal parameter ".concat(t," for ").concat(e)}(e,t));return n[t]}function Ic(e){let t=!0;for(const n in e){t=!1;break}return t}function Rc(e){const t={};return e.addressModeU&&(t[10242]=Pc(e.addressModeU)),e.addressModeV&&(t[10243]=Pc(e.addressModeV)),e.addressModeW&&(t[32882]=Pc(e.addressModeW)),e.magFilter&&(t[10240]=Mc(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";if(!t)return Mc(e);switch(t){case"none":return Mc(e);case"nearest":return"nearest"===e?9984:9986;case"linear":return"nearest"===e?9985:9987}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[33082]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[33083]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[34892]=34894),e.compare&&(t[34893]=Tc("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function Pc(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Mc(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}o(wc,"defaultProps",a(a({},ka.defaultProps),{},{type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1}));class Fc extends wc{constructor(e,t){super(e,t),o(this,"device",void 0),o(this,"handle",void 0),o(this,"parameters",void 0),this.device=e,this.parameters=Rc(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return"Sampler(".concat(this.id,",").concat(JSON.stringify(this.props),")")}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,e,n);break;default:this.device.gl.samplerParameteri(this.handle,e,n)}}}}class Lc extends ka{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Lc.defaultProps)}}o(Lc,"defaultProps",a(a({},ka.defaultProps),{},{format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}));class kc extends Lc{constructor(e,t){super(e,a(a({},Ql.defaultProps),t)),o(this,"device",void 0),o(this,"gl",void 0),o(this,"handle",void 0),o(this,"texture",void 0),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}function Oc(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function Bc(e,t,n){if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:i=!0}=t,r=Il.get(e);let o;if(r.push(),Sl(e,t),i)o=n(e),r.pop();else try{o=n(e)}finally{r.pop()}return o}function zc(e,t,n,i){const{width:r,height:o}=i,{dimension:s,depth:a=0,mipLevel:l=0}=i,{x:c=0,y:u=0,z:h=0}=i,{glFormat:d,glType:f}=i,p=Uc(i.glTarget,s,a),m=i.flipY?{37440:!0}:{};Bc(e,m,()=>{switch(s){case"2d-array":case"3d":e.bindTexture(p,t),e.texSubImage3D(p,l,c,u,h,r,o,a,d,f,n),e.bindTexture(p,null);break;case"2d":case"cube":e.bindTexture(p,t),e.texSubImage2D(p,l,c,u,r,o,d,f,n),e.bindTexture(p,null);break;default:throw new Error(s)}})}function Nc(e,t,n){const{dimension:i,width:r,height:o,depth:s=0,mipLevel:a=0,byteOffset:l=0}=n,{x:c=0,y:u=0,z:h=0}=n,{glFormat:d,glType:f,compressed:p}=n,m=Uc(n.glTarget,i,s);switch(i){case"2d-array":case"3d":p?e.compressedTexSubImage3D(m,a,c,u,h,r,o,s,d,t,l):e.texSubImage3D(m,a,c,u,h,r,o,s,d,f,t,l);break;case"2d":case"cube":p?e.compressedTexSubImage2D(m,a,c,u,r,o,d,t,l):e.texSubImage2D(m,a,c,u,r,o,d,f,t,l);break;default:throw new Error(i)}}function Uc(e,t,n){return"cube"===t?34069+n:e}function Vc(e,t){var n;const{sourceX:i=0,sourceY:r=0,sourceAttachment:o=0}=t||{};let{target:s=null,sourceWidth:a,sourceHeight:l,sourceDepth:c,sourceFormat:u,sourceType:h}=t||{};const{framebuffer:d,deleteFramebuffer:f}=jc(e),{gl:p,handle:m}=d;a||(a=d.width),l||(l=d.height);const g=null===(n=d.colorAttachments[o])||void 0===n?void 0:n.texture;if(!g)throw new Error("Invalid framebuffer attachment ".concat(o));c=(null===g||void 0===g?void 0:g.depth)||1,u||(u=(null===g||void 0===g?void 0:g.glFormat)||6408),h||(h=(null===g||void 0===g?void 0:g.glType)||5121),s=function(e,t,n,i,r){if(e)return e;t||(t=5121);const o=function(e,t){const{clamped:n=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}(t,{clamped:!1}),s=Oc(n);return new o(i*r*s)}(s,h,u,a,l),h=h||function(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error("Failed to deduce GL constant from typed array")}}(s);const _=p.bindFramebuffer(36160,m);return p.readBuffer(36064+o),p.readPixels(i,r,a,l,u,h,s),p.readBuffer(36064),p.bindFramebuffer(36160,_||null),f&&d.destroy(),s}function jc(e){return e instanceof $l?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:Gc(e),deleteFramebuffer:!0}}function Gc(e,t){const{device:n,width:i,height:r,id:o}=e;return n.createFramebuffer(a(a({},t),{},{id:"framebuffer-for-".concat(o),width:i,height:r,colorAttachments:[e]}))}class Hc extends Ql{constructor(e,t){super(e,t),o(this,"device",void 0),o(this,"gl",void 0),o(this,"handle",void 0),o(this,"sampler",void 0),o(this,"view",void 0),o(this,"mipmaps",void 0),o(this,"compressed",void 0),o(this,"glTarget",void 0),o(this,"glFormat",void 0),o(this,"glType",void 0),o(this,"glInternalFormat",void 0),o(this,"textureUnit",0);const n=a({},this.props);n.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=function(e){switch(e){case"1d":case"cube-array":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(e)}(this.props.dimension);const i=Hl(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=Boolean(this.props.mipmaps),this._initialize(n),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,a(a({},this.props),{},{data:e.data}));let{width:t,height:n}=e;if(!t||!n){const i=Ql.getTextureDataSize(e.data);t=(null===i||void 0===i?void 0:i.width)||1,n=(null===i||void 0===i?void 0:i.height)||1}if(this.width=t,this.height=n,this.depth=e.depth,this.setSampler(e.sampler),this.view=new kc(this.device,a(a({},this.props),{},{texture:this})),this.bind(),function(e,t,n){const{dimension:i,width:r,height:o,depth:s=0}=n,{glInternalFormat:a}=n,l=n.glTarget;switch(i){case"2d-array":case"3d":e.texStorage3D(l,t,a,r,o,s);break;default:e.texStorage2D(l,t,a,r,o)}}(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new kc(this.device,a(a({},e),{},{texture:this}))}setSampler(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t instanceof Fc?(this.sampler=t,e=t.props):(this.sampler=new Fc(this.device,t),e=t);const n=Rc(e);this._setSamplerParameters(n)}generateMipmap(e){if(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format)||(Ma.warn("".concat(this," is not renderable or filterable, may not be able to generate mipmaps"))(),null!==e&&void 0!==e&&e.force))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(t){Ma.warn("Error generating mipmap for ".concat(this,": ").concat(t.message))()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const t=Ql.getExternalImageSize(e.image),n=a(a(a({},Ql.defaultCopyExternalImageOptions),t),e),{image:i,depth:r,mipLevel:o,x:s,y:l,z:c,flipY:u}=n;let{width:h,height:d}=n;const{dimension:f,glTarget:p,glFormat:m,glInternalFormat:g,glType:_}=this;if(h=Math.min(h,this.width-s),d=Math.min(d,this.height-l),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return zc(this.device.gl,this.handle,i,{dimension:f,mipLevel:o,x:s,y:l,z:c,width:h,height:d,depth:r,glFormat:m,glInternalFormat:g,glType:_,glTarget:p,flipY:u}),{width:n.width,height:n.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.bind();const n=Ql.normalizeTextureData(e,this);n.length>1&&!1!==this.props.mipmaps&&Ma.warn("Texture ".concat(this.id," mipmap and multiple LODs."))();for(let i=0;i<n.length;i++){const e=n[i];this._setMipLevel(t,i,e)}this.unbind()}setTexture3DData(e){if("3d"!==this.props.dimension)throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),Nc(this.device.gl,e,this),this.unbind())}setTextureCubeData(e){if("cube"!==this.props.dimension)throw new Error(this.id);for(const t of Ql.CubeFaces)this.setTextureCubeFaceData(e[t],t)}setTextureArrayData(e){if("2d-array"!==this.props.dimension)throw new Error(this.id);throw new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t){Array.isArray(e)&&e.length>1&&!1!==this.props.mipmaps&&Ma.warn("".concat(this.id," has mipmap and multiple LODs."))();const n=Ql.CubeFaces.indexOf(t);this.setTexture2DData(e,n)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:t,width:n,height:i,pixels:r,data:o,format:s=6408,type:a=5121}=e,{gl:l}=this,c=r||o;this.bind(),c instanceof Promise?c.then(n=>this.setImageDataForFace(Object.assign({},e,{face:t,data:n,pixels:n}))):this.width||this.height?l.texImage2D(t,0,s,n,i,0,s,a,c):l.texImage2D(t,0,s,s,a,c)}_getImageDataMap(e){for(let t=0;t<Ql.CubeFaces.length;++t){const n=Ql.CubeFaces[t];e[n]&&(e[34069+t]=e[n],delete e[n])}return e}_setSamplerParameters(e){Ma.log(1,"".concat(this.id," sampler parameters"),this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),i=n;switch(e){case 33082:case 33083:this.gl.texParameterf(this.glTarget,e,i);break;case 10241:case 10242:case 10243:default:this.gl.texParameteri(this.glTarget,e,i);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,e,i)}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.glTarget;if(Ql.isExternalImage(n))zc(this.device.gl,this.handle,n,a(a({},this),{},{depth:e,mipLevel:t,glTarget:i,flipY:this.props.flipY}));else{if(!Ql.isTextureLevelData(n))throw new Error("Texture: invalid image data");Nc(this.device.gl,n.data,a(a({},this),{},{depth:e,mipLevel:t,glTarget:i}))}}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}var Wc;class qc extends ka{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){super(e,t=qc.normalizeProps(e,t),qc.defaultProps)}static normalizeProps(e,t){var n;return a(a({},null===(n=e.props._resourceDefaults)||void 0===n?void 0:n.renderPass),t)}}Wc=qc,o(qc,"defaultClearColor",[0,0,0,1]),o(qc,"defaultClearDepth",1),o(qc,"defaultClearStencil",0),o(qc,"defaultProps",a(a({},ka.defaultProps),{},{framebuffer:null,parameters:void 0,clearColor:Wc.defaultClearColor,clearColors:void 0,clearDepth:Wc.defaultClearDepth,clearStencil:Wc.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}));const Xc=[1,2,4,8];class Zc extends qc{constructor(e,t){var n;let i;if(super(e,t),o(this,"device",void 0),o(this,"glParameters",void 0),this.device=e,null===t||void 0===t||null===(n=t.parameters)||void 0===n||!n.viewport)if(null!==t&&void 0!==t&&t.framebuffer){const{width:e,height:n}=t.framebuffer;i=[0,0,e,n]}else{const[t,n]=e.getCanvasContext().getDrawingBufferSize();i=[0,0,t,n]}this.device.pushState(),this.setParameters(a({viewport:i},this.props.parameters));const r=this.props.framebuffer;if(null!==r&&void 0!==r&&r.handle)if(this.props.framebuffer){const e=this.props.framebuffer.colorAttachments.map((e,t)=>36064+t);this.device.gl.drawBuffers(e)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=a({},this.glParameters);t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=Xc.map(t=>Boolean(t&e.colorMask))),this.glParameters=t,Sl(this.device.gl,t)}beginOcclusionQuery(e){const t=this.props.occlusionQuerySet;null===t||void 0===t||t.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;null===e||void 0===e||e.endOcclusionQuery()}clear(){const e=a({},this.glParameters);let t=0;this.props.clearColors&&this.props.clearColors.forEach((e,t)=>{e&&this.clearColorBuffer(t,e)}),!1!==this.props.clearColor&&void 0===this.props.clearColors&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&Bc(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0];Bc(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class Yc extends ka{get[Symbol.toStringTag](){return"RenderPipeline"}constructor(e,t){super(e,t,Yc.defaultProps),o(this,"shaderLayout",void 0),o(this,"bufferLayout",void 0),o(this,"linkStatus","pending"),o(this,"hash",""),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}function Kc(e){return Jc.includes(e)}o(Yc,"defaultProps",a(a({},ka.defaultProps),{},{vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}}));const Jc=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Qc={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function $c(e){const t=Qc[e];if(!t)throw new Error("uniform");const[n,i,,r]=t;return{format:r,components:i,glType:n}}function eu(e){const t=Qc[e];if(!t)throw new Error("attribute");const[,n,,i,r]=t;return{attributeType:i,vertexFormat:r,components:n}}function tu(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r);if(!i)throw new Error("activeInfo");const{name:o,type:s}=i,a=e.getAttribLocation(t,o);if(a>=0){const{attributeType:e}=eu(s),t=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:a,stepMode:t,type:e})}}return n.sort((e,t)=>e.location-t.location),n}(e,t);const i=function(e,t){const n=(n,i)=>e.getActiveUniformBlockParameter(t,n,i),i=[],r=e.getProgramParameter(t,35382);for(let o=0;o<r;o++){const r={name:e.getActiveUniformBlockName(t,o)||"",location:n(o,35391),byteLength:n(o,35392),vertex:n(o,35396),fragment:n(o,35398),uniformCount:n(o,35394),uniforms:[]},s=n(o,35395)||[],a=e.getActiveUniforms(t,s,35383),l=e.getActiveUniforms(t,s,35384),c=e.getActiveUniforms(t,s,35387),u=e.getActiveUniforms(t,s,35388);for(let n=0;n<r.uniformCount;++n){const i=e.getActiveUniform(t,s[n]);if(!i)throw new Error("activeInfo");r.uniforms.push({name:i.name,format:$c(a[n]).format,type:a[n],arrayLength:l[n],byteOffset:c[n],byteStride:u[n]})}i.push(r)}return i.sort((e,t)=>e.location-t.location),i}(e,t);for(const a of i){const e=a.uniforms.map(e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength}));n.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:e})}const r=function(e,t){const n=[],i=e.getProgramParameter(t,35718);for(let r=0;r<i;r++){const i=e.getActiveUniform(t,r);if(!i)throw new Error("activeInfo");const{name:o,size:s,type:l}=i,{name:c,isArray:u}=ru(o);let h=e.getUniformLocation(t,c);const d={location:h,name:c,size:s,type:l,isArray:u};if(n.push(d),d.size>1)for(let r=0;r<d.size;r++){const i="".concat(c,"[").concat(r,"]");h=e.getUniformLocation(t,i);const o=a(a({},d),{},{name:i,location:h});n.push(o)}}return n}(e,t);let o=0;for(const a of r)if(Kc(a.type)){const{viewDimension:e,sampleType:t}=iu(a.type);n.bindings.push({type:"texture",name:a.name,group:0,location:o,viewDimension:e,sampleType:t}),a.textureUnit=o,o+=1}r.length&&(n.uniforms=r);const s=function(e,t){const n=[],i=e.getProgramParameter(t,35971);for(let r=0;r<i;r++){const i=e.getTransformFeedbackVarying(t,r);if(!i)throw new Error("activeInfo");const{name:o,type:s,size:a}=i,{glType:l,components:c}=$c(s),u={location:r,name:o,type:l,size:a*c};n.push(u)}return n.sort((e,t)=>e.location-t.location),n}(e,t);return null!==s&&void 0!==s&&s.length&&(n.varyings=s),n}const nu={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function iu(e){const t=nu[e];if(!t)throw new Error("sampler");const[n,i]=t;return{viewDimension:n,sampleType:i}}function ru(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function ou(e,t,n,i){const r=e;let o=i;!0===o&&(o=1),!1===o&&(o=0);const s="number"===typeof o?[o]:o;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if("number"!==typeof i)throw new Error("samplers must be set to integers");return e.uniform1i(t,i);case 5126:return e.uniform1fv(t,s);case 35664:return e.uniform2fv(t,s);case 35665:return e.uniform3fv(t,s);case 35666:return e.uniform4fv(t,s);case 5124:case 35670:return e.uniform1iv(t,s);case 35667:case 35671:return e.uniform2iv(t,s);case 35668:case 35672:return e.uniform3iv(t,s);case 35669:case 35673:return e.uniform4iv(t,s);case 5125:return r.uniform1uiv(t,s,1);case 36294:return r.uniform2uiv(t,s,2);case 36295:return r.uniform3uiv(t,s,3);case 36296:return r.uniform4uiv(t,s,4);case 35674:return e.uniformMatrix2fv(t,!1,s);case 35675:return e.uniformMatrix3fv(t,!1,s);case 35676:return e.uniformMatrix4fv(t,!1,s);case 35685:return r.uniformMatrix2x3fv(t,!1,s);case 35686:return r.uniformMatrix2x4fv(t,!1,s);case 35687:return r.uniformMatrix3x2fv(t,!1,s);case 35688:return r.uniformMatrix3x4fv(t,!1,s);case 35689:return r.uniformMatrix4x2fv(t,!1,s);case 35690:return r.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}function su(e){return function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)||function(e){return!!Array.isArray(e)&&(0===e.length||"number"===typeof e[0])}(e)}function au(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(n=>{const i=e[n];!function(e){return null!==su(e)||"number"===typeof e||"boolean"===typeof e}(i)?t.bindings[n]=i:t.uniforms[n]=i}),t}class lu extends Yc{constructor(e,t){super(e,t),o(this,"device",void 0),o(this,"handle",void 0),o(this,"vs",void 0),o(this,"fs",void 0),o(this,"introspectedLayout",void 0),o(this,"uniforms",{}),o(this,"bindings",{}),o(this,"varyings",null),o(this,"_uniformCount",0),o(this,"_uniformSetters",{}),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:i=35981}=t;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),Ma.time(1,"RenderPipeline ".concat(this.id," - shaderLayout introspection"))(),this.introspectedLayout=tu(this.device.gl,this.handle),Ma.timeEnd(1,"RenderPipeline ".concat(this.id," - shaderLayout introspection"))(),this.shaderLayout=function(e,t){const n=a(a({},e),{},{attributes:e.attributes.map(e=>a({},e))});for(const i of(null===t||void 0===t?void 0:t.attributes)||[]){const e=n.attributes.find(e=>e.name===i.name);e?(e.type=i.type||e.type,e.stepMode=i.stepMode||e.stepMode):Ma.warn("shader layout attribute ".concat(i.name," not present in shader"))}return n}(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(const[n,i]of Object.entries(e)){const e=this.shaderLayout.bindings.find(e=>e.name===n)||this.shaderLayout.bindings.find(e=>e.name==="".concat(n,"Uniforms"));if(!e){const e=this.shaderLayout.bindings.map(e=>'"'.concat(e.name,'"')).join(", ");null!==t&&void 0!==t&&t.disableWarnings||Ma.warn('No binding "'.concat(n,'" in render pipeline "').concat(this.id,'", expected one of ').concat(e),i)();continue}switch(i||Ma.warn('Unsetting binding "'.concat(n,'" in render pipeline "').concat(this.id,'"'))(),e.type){case"uniform":if(!(i instanceof pc)&&!(i.buffer instanceof pc))throw new Error("buffer value");break;case"texture":if(!(i instanceof kc||i instanceof Hc||i instanceof ec))throw new Error("texture value");break;case"sampler":Ma.warn("Ignoring sampler ".concat(n))();break;default:throw new Error(e.type)}this.bindings[n]=i}}draw(e){var t;const{renderPass:n,parameters:i=this.props.parameters,topology:r=this.props.topology,vertexArray:o,vertexCount:s,instanceCount:a,isInstanced:l=!1,firstVertex:c=0,transformFeedback:u}=e,h=function(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}(r),d=Boolean(o.indexBuffer),f=null===(t=o.indexBuffer)||void 0===t?void 0:t.glIndexType;if("success"!==this.linkStatus)return Ma.info(2,"RenderPipeline:".concat(this.id,".draw() aborted - waiting for shader linking"))(),!1;if(!this._areTexturesRenderable())return Ma.info(2,"RenderPipeline:".concat(this.id,".draw() aborted - textures not yet loaded"))(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(n),u&&u.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const p=n;return function(e,t,n,i){if(Ic(t))return i(e);const r=e;r.pushState();try{return Ec(e,t),Sl(r.gl,n),i(e)}finally{r.popState()}}(this.device,i,p.glParameters,()=>{d&&l?this.device.gl.drawElementsInstanced(h,s||0,f,c,a||0):d?this.device.gl.drawElements(h,s||0,f,c):l?this.device.gl.drawArraysInstanced(h,c,s||0,a||0):this.device.gl.drawArrays(h,c,s||0),u&&u.end()}),o.unbindAfterRender(n),!0}setUniformsWebGL(e){const{bindings:t}=au(e);Object.keys(t).forEach(e=>{Ma.warn('Unsupported value "'.concat(JSON.stringify(t[e]),'" used in setUniforms() for key ').concat(e,". Use setBindings() instead?"))()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Ma.time(4,"linkProgram for ".concat(this.id))(),e.linkProgram(this.handle),Ma.timeEnd(4,"linkProgram for ".concat(this.id))(),Ma.level,!this.device.features.has("compilation-status-async-webgl")){const e=this._getLinkStatus();return void this._reportLinkStatus(e)}Ma.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Ma.info(2,"RenderPipeline ".concat(this.id," - async linking complete: ").concat(this.linkStatus))();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){var t;if("success"!==e){switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error("Error during compilation of shader ".concat(this.vs.id));case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader())}switch(null===(t=this.fs)||void 0===t?void 0:t.compilationStatus){case"error":throw this.fs.debugShader(),new Error("Error during compilation of shader ".concat(this.fs.id));case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader())}const n=this.device.gl.getProgramInfoLog(this.handle);throw new Error("Error during ".concat(e,": ").concat(n))}}_getLinkStatus(){const{gl:e}=this.device;if(!e.getProgramParameter(this.handle,35714))return this.linkStatus="error","linking";e.validateProgram(this.handle);return e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")}async _waitForLinkComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)this.bindings[t.name]||this.bindings[t.name.replace(/Uniforms$/,"")]||(Ma.warn("Binding ".concat(t.name," not found in ").concat(this.id))(),e=!1);return e}_applyBindings(){if("success"!==this.linkStatus)return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const i of this.shaderLayout.bindings){const r=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!r)throw new Error("No value for binding ".concat(i.name," in ").concat(this.id));switch(i.type){case"uniform":const{name:o}=i,s=e.getUniformBlockIndex(this.handle,o);if(4294967295===s)throw new Error("Invalid uniform block name ".concat(o));e.uniformBlockBinding(this.handle,n,s),r instanceof pc?e.bindBufferBase(35345,n,r.handle):e.bindBufferRange(35345,n,r.buffer.handle,r.offset||0,r.size||r.buffer.byteLength-r.offset),n+=1;break;case"texture":if(!(r instanceof kc||r instanceof Hc||r instanceof ec))throw new Error("texture");let a;if(r instanceof kc)a=r.texture;else if(r instanceof Hc)a=r;else{if(!(r instanceof ec&&r.colorAttachments[0]instanceof kc))throw new Error("No texture");Ma.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=r.colorAttachments[0].texture}e.activeTexture(33984+t),e.bindTexture(a.glTarget,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error("binding type '".concat(i.type,"' not supported in WebGL"))}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){var e;const{name:n,location:i,type:r,textureUnit:o}=t,s=null!==(e=this.uniforms[n])&&void 0!==e?e:o;void 0!==s&&ou(this.device.gl,i,r,s)}}}class cu extends ka{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,cu.defaultProps)}}o(cu,"defaultProps",a(a({},ka.defaultProps),{},{measureExecutionTime:void 0}));class uu extends ka{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,uu.defaultProps)}}o(uu,"defaultProps",a({},ka.defaultProps));class hu extends uu{constructor(e){super(e,{}),o(this,"device",void 0),o(this,"commands",[]),this.device=e}submitCommands(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.commands;for(const t of e)switch(t.name){case"copy-buffer-to-buffer":du(this.device,t.options);break;case"copy-buffer-to-texture":fu(this.device,t.options);break;case"copy-texture-to-buffer":pu(this.device,t.options);break;case"copy-texture-to-texture":mu(this.device,t.options);break;default:throw new Error(t.name)}}}function du(e,t){var n,i;const r=t.sourceBuffer,o=t.destinationBuffer;e.gl.bindBuffer(36662,r.handle),e.gl.bindBuffer(36663,o.handle),e.gl.copyBufferSubData(36662,36663,null!==(n=t.sourceOffset)&&void 0!==n?n:0,null!==(i=t.destinationOffset)&&void 0!==i?i:0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function fu(e,t){throw new Error("Not implemented")}function pu(e,t){const{sourceTexture:n,mipLevel:i=0,aspect:r="all",width:o=t.sourceTexture.width,height:s=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:d}=t;if("all"!==r)throw new Error("aspect not supported in WebGL");if(0!==i||0!==a||h||d)throw new Error("not implemented");const{framebuffer:f,destroyFramebuffer:p}=gu(n);let m;try{const t=c,n=o||f.width,i=s||f.height,r=Hl(f.colorAttachments[0].texture.props.format),a=r.format,h=r.type;e.gl.bindBuffer(35051,t.handle),m=e.gl.bindFramebuffer(36160,f.handle),e.gl.readPixels(l[0],l[1],n,i,a,h,u)}finally{e.gl.bindBuffer(35051,null),void 0!==m&&e.gl.bindFramebuffer(36160,m),p&&f.destroy()}}function mu(e,t){const{sourceTexture:n,destinationMipLevel:i=0,origin:r=[0,0],destinationOrigin:o=[0,0],destinationTexture:s}=t;let{width:a=t.destinationTexture.width,height:l=t.destinationTexture.height}=t;const{framebuffer:c,destroyFramebuffer:u}=gu(n),[h,d]=r,[f,p,m]=o,g=e.gl.bindFramebuffer(36160,c.handle);let _,y=null;if(!(s instanceof Hc))throw new Error("invalid destination");switch(y=s,a=Number.isFinite(a)?a:y.width,l=Number.isFinite(l)?l:y.height,y.bind(0),_=y.glTarget,_){case 3553:case 34067:e.gl.copyTexSubImage2D(_,i,f,p,h,d,a,l);break;case 35866:case 32879:e.gl.copyTexSubImage3D(_,i,f,p,m,h,d,a,l)}y&&y.unbind(),e.gl.bindFramebuffer(36160,g),u&&c.destroy()}function gu(e){if(e instanceof Ql){const{width:t,height:n,id:i}=e;return{framebuffer:e.device.createFramebuffer({id:"framebuffer-for-".concat(i),width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class _u extends cu{constructor(e,t){super(e,t),o(this,"device",void 0),o(this,"commandBuffer",void 0),this.device=e,this.commandBuffer=new hu(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}const yu={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},vu={f32:4,f16:2,i32:4,u32:4};function xu(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,i]=e.split("x"),r=n,o=i?parseInt(i):1,s=Ba(r),a={type:r,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(a.webglOnly=!0),a}function bu(e,t){const n={};for(const i of e.attributes){const r=wu(e,t,i.name);r&&(n[i.name]=r)}return n}function wu(e,t,n){const i=function(e,t){const n=e.attributes.find(e=>e.name===t);n||Ma.warn('shader layout attribute "'.concat(t,'" not present in shader'));return n||null}(e,n),r=function(e,t){Eu(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);if(n)return n;if(n=function(e,t){for(const i of e){var n;let e=i.byteStride;if("number"!==typeof i.byteStride)for(const t of i.attributes||[]){e+=xu(t.format).byteLength}const r=null===(n=i.attributes)||void 0===n?void 0:n.find(e=>e.attribute===t);if(r)return{attributeName:r.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:e}}return null}(e,t),n)return n;return Ma.warn('layout for attribute "'.concat(t,'" not present in buffer layout')),null}(t,n);if(!i)return null;const o=function(e){const[t,n]=yu[e],i="i32"===t||"u32"===t,r="u32"!==t,o=vu[t]*n,s=function(e,t){let n;switch(e){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return 1===t?n:"".concat(n,"x").concat(t)}(t,n);return{dataType:t,components:n,defaultVertexFormat:s,byteLength:o,integer:i,signed:r}}(i.type),s=(null===r||void 0===r?void 0:r.vertexFormat)||o.defaultVertexFormat,a=xu(s);return{attributeName:(null===r||void 0===r?void 0:r.attributeName)||i.name,bufferName:(null===r||void 0===r?void 0:r.bufferName)||i.name,location:i.location,shaderType:i.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:o.integer,stepMode:(null===r||void 0===r?void 0:r.stepMode)||i.stepMode||"vertex",byteOffset:(null===r||void 0===r?void 0:r.byteOffset)||0,byteStride:(null===r||void 0===r?void 0:r.byteStride)||0}}function Eu(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&Ma.warn("BufferLayout ".concat(name," must have either 'attributes' or 'format' field"))}class Tu extends ka{get[Symbol.toStringTag](){return"VertexArray"}constructor(e,t){super(e,t,Tu.defaultProps),o(this,"maxVertexAttributes",void 0),o(this,"attributeInfos",void 0),o(this,"indexBuffer",null),o(this,"attributes",void 0),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:n,bufferLayout:i}=t.renderPipeline||{};if(!n||!i)throw new Error("VertexArray");this.attributeInfos=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16;const i=bu(e,t),r=new Array(n).fill(null);for(const o of Object.values(i))r[o.location]=o;return r}(n,i,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"))}}let Au;function Su(e){return(!Au||Au.byteLength<e)&&(Au=new ArrayBuffer(e)),Au}o(Tu,"defaultProps",a(a({},ka.defaultProps),{},{renderPipeline:null}));class Du extends Tu{get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return"Chrome"===(t||me()?pe(t)?"Electron":(t||Ee.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node");var t}constructor(e,t){super(e,t),o(this,"device",void 0),o(this,"handle",void 0),o(this,"buffer",null),o(this,"bufferValue",null),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){var e;(super.destroy(),this.buffer)&&(null===(e=this.buffer)||void 0===e||e.destroy());this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&34963!==t.glTarget)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const n=t;if(34963===n.glTarget)throw new Error("Use .setIndexBuffer()");const{size:i,type:r,stride:o,offset:s,normalized:a,integer:l,divisor:c}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),l?this.device.gl.vertexAttribIPointer(e,i,r,o,s):this.device.gl.vertexAttribPointer(e,i,r,a,o,s),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,c||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error("Unknown attribute location ".concat(e));const n=kl(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=Du.isConstantAttributeZeroSupported(this.device);(t||(n||0!==e))&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=function(e){if(Array.isArray(e))return new Float32Array(e);return e}(t),i=n.byteLength*e,r=n.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error("Buffer size is immutable, byte length ".concat(i," !== ").concat(this.buffer.byteLength,"."));let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),o=o||!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue),o){const e=function(e,t){return new e(Su(e.BYTES_PER_ELEMENT*t),0,t)}(t.constructor,r);!function(e){const{target:t,source:n,start:i=0,count:r=1}=e,o=n.length,s=r*o;let a=0;for(let l=i;a<o;a++)t[l++]=n[a];for(;a<s;)a<s-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+s-a),a=s);e.target}({target:e,source:n,start:0,count:r}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}class Cu extends ka{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Cu.defaultProps)}}o(Cu,"defaultProps",a(a({},ka.defaultProps),{},{layout:void 0,buffers:{}}));class Iu extends Cu{constructor(e,t){super(e,t),o(this,"device",void 0),o(this,"gl",void 0),o(this,"handle",void 0),o(this,"layout",void 0),o(this,"buffers",{}),o(this,"unusedBuffers",{}),o(this,"bindOnUse",!0),o(this,"_bound",!1),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"point-list";this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return 0;case"line-list":case"line-strip":return 1;case"triangle-list":case"triangle-strip":return 4;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:i,byteLength:r,byteOffset:o}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=i,void Ma.warn("".concat(this.id," unusedBuffers varying buffer ").concat(e))();this.buffers[n]={buffer:i,byteLength:r,byteOffset:o},this.bindOnUse||this._bindBuffer(n,i,o,r)}getBuffer(e){if(Ru(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!==typeof t?(this.gl.bindTransformFeedback(36386,t),this):(this._bound?e=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,e=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),e)}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof pc)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(Ru(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const r=t&&t.handle;r&&void 0!==i?this.gl.bindBufferRange(35982,e,r,n,i):this.gl.bindBufferBase(35982,e,r)}}function Ru(e){return"number"===typeof e?Number.isInteger(e):/^\d+$/.test(e)}class Pu extends ka{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Pu.defaultProps)}}o(Pu,"defaultProps",a(a({},ka.defaultProps),{},{type:void 0,count:void 0}));class Mu extends Pu{get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),o(this,"device",void 0),o(this,"handle",void 0),o(this,"target",null),o(this,"_queryPending",!1),o(this,"_pollingPromise",null),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(null!==e&&void 0!==e&&e.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)}),this._pollingPromise}}class Fu extends sl{constructor(e){var t;super(a(a({},e),{},{id:e.id||fc("webgl-device")})),o(this,"type","webgl"),o(this,"handle",void 0),o(this,"features",void 0),o(this,"limits",void 0),o(this,"info",void 0),o(this,"canvasContext",void 0),o(this,"lost",void 0),o(this,"_resolveContextLost",void 0),o(this,"gl",void 0),o(this,"debug",!1),o(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1}),o(this,"_extensions",{}),o(this,"_polyfilled",!1),o(this,"spectorJS",void 0),o(this,"renderPass",null),o(this,"_constants",void 0);const n=sl._getCanvasContextProps(e);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=null===(t=n.canvas)||void 0===t||null===(t=t.gl)||void 0===t?void 0:t.device;if(i)throw new Error("WebGL context already attached to device ".concat(i.id));this.canvasContext=new tc(this,n),this.lost=new Promise(e=>{this._resolveContextLost=e});const r=a({},e.webgl);"premultiplied"===n.alphaMode&&(r.premultipliedAlpha=!0),void 0!==e.powerPreference&&(r.powerPreference=e.powerPreference);const s=this.props._handle||function(e,t,n){var i;let r="";const o=a({preserveDrawingBuffer:!0},n);let s=null;var l;if(s||(s=e.getContext("webgl2",o)),o.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),s||n.failIfMajorPerformanceCaveat||(o.failIfMajorPerformanceCaveat=!1,s=e.getContext("webgl2",o),(l=s).luma||(l.luma={}),s.luma.softwareRenderer=!0),s||(s=e.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error("Failed to create WebGL context: ".concat(r));const{onContextLost:c,onContextRestored:u}=t;return e.addEventListener("webglcontextlost",e=>c(e),!1),e.addEventListener("webglcontextrestored",e=>u(e),!1),(i=s).luma||(i.luma={}),s}(this.canvasContext.canvas,{onContextLost:e=>{var t;return null===(t=this._resolveContextLost)||void 0===t?void 0:t.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:e=>console.log("WebGL context restored")},r);if(!s)throw new Error("WebGL context creation failed");if(i=s.device,i){if(e._reuseDevices)return Ma.log(1,"Not creating a new Device, instead returning a reference to Device ".concat(i.id," already attached to WebGL context"),i)(),i._reused=!0,i;throw new Error("WebGL context already attached to device ".concat(i.id))}this.handle=s,this.gl=s,this.spectorJS=function(e){var t,n,i;if(!(e=a(a({},oc),e)).debugSpectorJS)return null;if(!ic&&globalThis.SPECTOR&&(null===(t=globalThis.luma)||void 0===t||!t.spector)){Ma.probe(1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;ic=new e,globalThis.luma&&(globalThis.luma.spector=ic)}if(!ic)return null;if(rc||(rc=!0,ic.spyCanvases(),null===(n=ic)||void 0===n||n.onCaptureStarted.add(e=>Ma.info("Spector capture started:",e)()),null===(i=ic)||void 0===i||i.onCapture.add(e=>{var t,n,i;Ma.info("Spector capture complete:",e)(),null===(t=ic)||void 0===t||t.getResultUI(),null===(n=ic)||void 0===n||n.resultView.display(),null===(i=ic)||void 0===i||i.resultView.addCapture(e)})),e.gl){var r;const t=e.gl,n=t.device;null===(r=ic)||void 0===r||r.startCapture(e.gl,500),t.device=n,new Promise(e=>setTimeout(e,2e3)).then(e=>{var t;Ma.info("Spector capture stopped after 2 seconds")(),null===(t=ic)||void 0===t||t.stopCapture()})}return ic}(a(a({},this.props),{},{gl:this.handle})),this.gl.device=this,this.gl._version=2,this.info=Fl(this.gl,this._extensions),this.limits=new Zl(this.gl),this.features=new Xl(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),!1!==n.autoResize&&this.canvasContext.resize();const l=new Il(this.gl,{log:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ma.log(1,...t)()}});l.trackState(this.gl,{copyState:!1});const c=e.debugWebGL||e.debug,u=e.debugWebGL;c&&(this.gl=lc(this.gl,{debugWebGL:c,traceWebGL:u}),Ma.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Ma.level=Math.max(Ma.level,1)))}destroy(){this.props._reuseDevices||this._reused||delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new pc(this,t)}createTexture(e){return new Hc(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new Fc(this,e)}createShader(e){return new bc(this,e)}createFramebuffer(e){return new ec(this,e)}createVertexArray(e){return new Du(this,e)}createTransformFeedback(e){return new Iu(this,e)}createQuerySet(e){return new Mu(this,e)}createRenderPipeline(e){return new lu(this,e)}beginRenderPass(e){return new Zc(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(){return new _u(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}submit(){var e;null===(e=this.renderPass)||void 0===e||e.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return Vc(e,t)}readPixelsToBufferWebGL(e,t){return function(e,t){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:o=6408,targetByteOffset:s=0}=t||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{};const{framebuffer:u,deleteFramebuffer:h}=jc(e);a=a||u.width,l=l||u.height;const d=u;c=c||5121;let f=n;if(!f){const e=Oc(o),t=function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}(c),n=s+a*l*e*t;f=d.device.createBuffer({byteLength:n})}const p=e.device.createCommandEncoder();return p.copyTextureToBuffer({sourceTexture:e,width:a,height:l,origin:[i,r],destinationBuffer:f,byteOffset:s}),p.destroy(),h&&u.destroy(),f}(e,t)}setParametersWebGL(e){Sl(this.gl,e)}getParametersWebGL(e){return Dl(this.gl,e)}withParametersWebGL(e,t){return Bc(this.gl,e,t)}resetWebGL(){Ma.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),Sl(this.gl,dl)}_getDeviceSpecificTextureFormatCapabilities(e){return function(e,t,n){let i=t.create;const r=Gl[t.format];return void 0===(null===r||void 0===r?void 0:r.gl)&&(i=!1),null!==r&&void 0!==r&&r.x&&(i=i&&Boolean(Ml(e,r.x,n))),{format:t.format,create:i&&t.create,render:i&&t.render,filter:i&&t.filter,blend:i&&t.blend,store:i&&t.store}}(this.gl,e,this._extensions)}loseDevice(){var e;let t=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),null===(e=this._resolveContextLost)||void 0===e||e.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Il.get(this.gl).push()}popState(){Il.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){const n=Number(e);for(const i in this.gl)if(this.gl[i]===n)return"GL.".concat(i);return null!==t&&void 0!==t&&t.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((e,n)=>{let[i,r]=n;return e["".concat(i,":").concat(this.getGLKey(i,t))]="".concat(r,":").concat(this.getGLKey(r,t)),e},{})}setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(i,t)&&Ma.info(1,"setConstantAttributeWebGL(".concat(e,") could have been skipped, value unchanged"))(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n)}}(this,e,t);break;case Int32Array:!function(e,t,n){e.gl.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){e.gl.vertexAttribI4uiv(t,n)}(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return Ml(this.gl,e,this._extensions),this._extensions}}const Lu={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},ku=e=>({drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Ou=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)}),Bu=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(){return e.drawArraysInstanced(...arguments)},drawElementsInstancedANGLE(){return e.drawElementsInstanced(...arguments)},vertexAttribDivisorANGLE(){return e.vertexAttribDivisor(...arguments)}});function zu(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext)return t.getContext=t.originalGetContext,void(t.originalGetContext=void 0);t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){const e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");const t=a(a({},Lu),{},{WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:ku(e),OES_vertex_array_object:Ou(e),ANGLE_instanced_arrays:Bu(e)}),n=e.getExtension;e.getExtension=function(i){const r=n.call(e,i);return r||(i in t?t[i]:null)};const i=e.getSupportedExtensions;e.getSupportedExtensions=function(){const n=i.apply(e)||[];return null===n||void 0===n?void 0:n.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}const Nu=new class extends hl{constructor(){super(),o(this,"type","webgl"),sl.defaultProps=a(a({},sl.defaultProps),oc),Fu.adapter=this}isSupported(){return"undefined"!==typeof WebGL2RenderingContext}enforceWebGL2(e){zu(e)}async attach(e){if(e instanceof Fu)return e;if((null===e||void 0===e?void 0:e.device)instanceof sl)return e.device;if(!function(e){if("undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return!0;return Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");return new Fu({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ma.groupCollapsed(1,"WebGLDevice created")();const t=[];(e.debugWebGL||e.debug)&&t.push(async function(){me()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await nc("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.debugSpectorJS&&t.push(async function(e){if(!globalThis.SPECTOR)try{await nc(e.debugSpectorJSUrl||oc.debugSpectorJSUrl)}catch(t){Ma.warn(String(t))}}(e));const n=await Promise.allSettled(t);for(const o of n)"rejected"===o.status&&Ma.error("Failed to initialize debug libraries ".concat(o.reason))();const i=new Fu(e),r="".concat(i._reused?"Reusing":"Created"," device with WebGL2 ").concat(i.debug?"debug ":"","context: ").concat(i.info.vendor,", ").concat(i.info.renderer," for canvas: ").concat(i.canvasContext.id);return Ma.probe(1,r)(),Ma.table(1,i.info)(),Ma.groupEnd(1)(),i}};let Uu=0;const Vu={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:ul.stats.get("animation-loop-".concat(Uu++)),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class ju{constructor(e){if(o(this,"device",null),o(this,"canvas",null),o(this,"props",void 0),o(this,"animationProps",null),o(this,"timeline",null),o(this,"stats",void 0),o(this,"cpuTime",void 0),o(this,"gpuTime",void 0),o(this,"frameRate",void 0),o(this,"display",void 0),o(this,"needsRedraw","initialized"),o(this,"_initialized",!1),o(this,"_running",!1),o(this,"_animationFrameId",null),o(this,"_nextFramePromise",null),o(this,"_resolveNextFrame",null),o(this,"_cpuStartTime",0),o(this,"_error",null),this.props=a(a({},Vu),e),!(e=this.props).device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Ge({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var t;this.props.onError(e),this._error=Error();if((null===(t=this.device)||void 0===t||null===(t=t.canvasContext)||void 0===t?void 0:t.canvas)instanceof HTMLCanvasElement){const t=document.createElement("h1");t.innerHTML=e.message,t.style.position="absolute",t.style.top="20%",t.style.left="10px",t.style.color="black",t.style.backgroundColor="red",document.body.appendChild(t)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return null!==(e=this.device)&&void 0!==e&&e.isLost||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!==typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),null===(t=this.device)||void 0===t||t.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e;const t=null===(e=this.device)||void 0===e||null===(e=e.canvasContext)||void 0===e?void 0:e.canvas;if(!this.device||!t)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:t,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=(null===(e=this.device.canvasContext)||void 0===e?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var e,t;if(!this.device)return{width:1,height:1,aspect:1};const[n,i]=(null===(e=this.device)||void 0===e||null===(e=e.canvasContext)||void 0===e?void 0:e.getPixelSize())||[1,1];let r=1;const o=null===(t=this.device)||void 0===t||null===(t=t.canvasContext)||void 0===t?void 0:t.canvas;return o&&o.clientHeight?r=o.clientWidth/o.clientHeight:n>0&&i>0&&(r=n/i),{width:n,height:i,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e;this.props.autoResizeDrawingBuffer&&(null===(e=this.device)||void 0===e||null===(e=e.canvasContext)||void 0===e||e.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}function Gu(){}const Hu={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Gu,onWebGLInitialized:Gu,onResize:Gu,onViewStateChange:Gu,onInteractionStateChange:Gu,onBeforeRender:Gu,onAfterRender:Gu,onLoad:Gu,onError:e=>Le.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:e=>{let{isDragging:t}=e;return t?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class Wu{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Ge({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;t.x=n.x,t.y=n.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{const t=io[e.type],n=e.offsetCenter;if(!t||!n||!this.layerManager)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:o}=r,s=o&&(o[t]||o.props[t]),a=this.props[t];let l=!1;s&&(l=s.call(o,r,e)),l||(null===a||void 0===a||a(r,e),this.widgetManager.onEvent(r,e))},this._onPointerDown=e=>{var t;if("webgpu"===(null===(t=this.device)||void 0===t?void 0:t.type))return;const n=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props=a(a({},Hu),e),(e=this.props).viewState&&e.initialViewState&&Le.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Le.error("WebGL1 context not supported.")(),t=Nu.attach(e.gl)),t||(t=ul.createDevice(a(a({type:"best-available",_reuseDevices:!0,adapters:[Nu]},e.deviceProps),{},{createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}}))),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Pn.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,i,r,o,s,a,l,c;(null===(e=this.animationLoop)||void 0===e||e.stop(),null===(t=this.animationLoop)||void 0===t||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,null===(n=this.layerManager)||void 0===n||n.finalize(),this.layerManager=null,null===(i=this.viewManager)||void 0===i||i.finalize(),this.viewManager=null,null===(r=this.effectManager)||void 0===r||r.finalize(),this.effectManager=null,null===(o=this.deckRenderer)||void 0===o||o.finalize(),this.deckRenderer=null,null===(s=this.deckPicker)||void 0===s||s.finalize(),this.deckPicker=null,null===(a=this.eventManager)||void 0===a||a.destroy(),this.eventManager=null,null===(l=this.widgetManager)||void 0===l||l.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas)||(null===(c=this.canvas.parentElement)||void 0===c||c.removeChild(this.canvas),this.canvas=null)}setProps(e){var t;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Le.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Le.removed("onLayerClick","onClick")(),e.initialViewState&&!fo(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),null===(t=this.animationLoop)||void 0===t||t.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||n||i||r||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return Co(this.viewManager),this.viewManager.views}getViewports(e){return Co(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;null===(t=this.layerManager)||void 0===t||t.removeDefaultShaderModule(e)}_pick(e,t,n){Co(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const r=this.deckPicker[e](a({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects()},n));return i.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;if("string"===typeof t&&(t=document.getElementById(t),Co(t)),!t){t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay";(e.parent||document.body).appendChild(t)}return Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:n}=e;if(t||0===t){const e=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=e}if(n||0===n){var i;const t=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.position=(null===(i=e.style)||void 0===i?void 0:i.position)||"absolute",this.canvas.style.height=t}}_updateCanvasSize(){var e,t;const{canvas:n}=this;if(!n)return;const i=null!==(e=n.clientWidth)&&void 0!==e?e:n.width,r=null!==(t=n.clientHeight)&&void 0!==t?t:n.height;var o,s;i===this.width&&r===this.height||(this.width=i,this.height=r,null===(o=this.viewManager)||void 0===o||o.setProps({width:i,height:r}),null===(s=this.layerManager)||void 0===s||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:r}))}_createAnimationLoop(e,t){const{gl:n,onError:i,useDevicePixels:r}=t;return new ju({device:e,useDevicePixels:r,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Xo({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var e;if("webgpu"===(null===(e=this.device)||void 0===e?void 0:e.type))return;const{_pickRequest:t}=this;if(t.event){const{result:e,emptyInfo:o}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=e.length>0;let s=o,a=!1;for(const i of e){var n;s=i,a=(null===(n=i.layer)||void 0===n?void 0:n.onHover(i,t.event))||a}var i,r;if(!a)null===(i=(r=this.props).onHover)||void 0===i||i.call(r,s,t.event),this.widgetManager.onHover(s,t.event);t.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var t,n;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=null===(n=this.device.canvasContext)||void 0===n?void 0:n.canvas);"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);const i=new d;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new $r(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(ro).map(e=>{var t;const[n,i,r,o]=ro[e],s=null===(t=this.props.eventRecognizerOptions)||void 0===t?void 0:t[e];return{recognizer:new n(a(a(a({},i),s),{},{event:e})),recognizeWith:r,requestFailure:o}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in io)this.eventManager.on(o,this._onEvent);this.viewManager=new po({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new ho(this.device,{deck:this,stats:this.stats,viewport:r,timeline:i}),this.effectManager=new js({deck:this,device:this.device}),this.deckRenderer=new Xs(this.device),this.deckPicker=new $s(this.device),this.widgetManager=new ia({deck:this,parentElement:null===(t=this.canvas)||void 0===t?void 0:t.parentElement}),this.widgetManager.addDefault(new oa),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var n;const{device:i,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:r});const o=a({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects()},t);null===(n=this.deckRenderer)||void 0===n||n.renderLayers(o),"screen"===o.pass&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:i,gl:r})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Le.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),"webgpu"!==(null===(e=this.device)||void 0===e?void 0:e.type)&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState=a(a({},this.viewState),{},{[e.viewId]:t}),this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=ul.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Wu.defaultProps=Hu,Wu.VERSION=Ra;const qu=Wu,Xu=Math.PI/180,Zu=180/Math.PI,Yu=6370972,Ku=256;function Ju(){const e=4018225162502676e-20,t=Math.PI/180*Ku;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,24886.609375]}}class Qu extends uo{constructor(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{longitude:i=0,zoom:r=0,nearZMultiplier:o=.5,farZMultiplier:s=1,resolution:l=10}=n;let{latitude:c=0,height:u,altitude:h=1.5,fovy:d}=n;c=Math.max(Math.min(c,Vi),-85.051129),u=u||1,d?h=Ji(d):d=Ki(h);const f=1/Math.PI/Math.cos(c*Math.PI/180),p=Math.pow(2,r)*f,m=null!==(e=n.nearZ)&&void 0!==e?e:o,g=null!==(t=n.farZ)&&void 0!==t?t:(h+512*p/u)*s,_=(new Si).lookAt({eye:[0,-h,0],up:[0,0,1]});_.rotateX(c*Xu),_.rotateZ(-i*Xu),_.scale(p/u),super(a(a({},n),{},{height:u,viewMatrix:_,longitude:i,latitude:c,zoom:r,distanceScales:Ju(),fovy:d,focalDistance:h,near:m,far:g})),this.scale=p,this.latitude=c,this.longitude=i,this.resolution=l}get projectionMode(){return to.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(){const e={targetZ:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0},t=this.unproject([0,this.height/2],e),n=this.unproject([this.width/2,0],e),i=this.unproject([this.width,this.height/2],e),r=this.unproject([this.width/2,this.height],e);return i[0]<this.longitude&&(i[0]+=360),t[0]>this.longitude&&(t[0]-=360),[Math.min(t[0],i[0],n[0],r[0]),Math.min(t[1],i[1],n[1],r[1]),Math.max(t[0],i[0],n[0],r[0]),Math.max(t[1],i[1],n[1],r[1])]}unproject(e){let{topLeft:t=!0,targetZ:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[i,r,o]=e,s=t?r:this.height-r,{pixelUnprojectionMatrix:a}=this;let l;if(Number.isFinite(o))l=$u(a,[i,s,o,1]);else{const e=$u(a,[i,s,-1,1]),t=$u(a,[i,s,1,1]),r=((n||0)/Yu+1)*Ku,o=Kn(Zn([],e,t)),c=Kn(e),u=Kn(t),h=4*((4*c*u-(o-c-u)**2)/16)/o;l=function(e,t,n,i){const r=t[0],o=t[1],s=t[2];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e}([],e,t,(Math.sqrt(c-h)-Math.sqrt(Math.max(0,r*r-h)))/Math.sqrt(o))}const[c,u,h]=this.unprojectPosition(l);return Number.isFinite(o)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n,i=0]=e,r=t*Xu,o=n*Xu,s=Math.cos(o),a=(i/Yu+1)*Ku;return[Math.sin(r)*s*a,-Math.cos(r)*s*a,Math.sin(o)*a]}unprojectPosition(e){const[t,n,i]=e,r=Yn(e),o=Math.asin(i/r);return[Math.atan2(t,-n)*Zu,o*Zu,(r/Ku-1)*Yu]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function $u(e,t){const n=vi([],t,e);return yi(n,n,1/n[3]),n}class eh extends Ho{applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=kn(i,n,t);const{longitude:r,latitude:o}=e;return(r<-180||r>180)&&(e.longitude=function(e,t){const n=e%t;return n<0?t+n:n}(r+180,360)-180),e.latitude=kn(o,-85.051129,Vi),e}}class th extends jo{constructor(){super(...arguments),this.ControllerState=eh,this.transition={transitionDuration:300,transitionInterpolator:new Mo(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class nh extends yo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}getViewportType(e){return e.zoom>12?xo:Qu}get ControllerType(){return th}}nh.displayName="GlobeView";const ih=nh,rh=512,oh=Math.PI/180;function sh(e){let{map:t,gl:n,deck:i}=e;if(t.__deck)return t.__deck;const r=null===i||void 0===i?void 0:i.props._customRender,o=null===i||void 0===i?void 0:i.props.onLoad,s=a(a({},null===i||void 0===i?void 0:i.props),{},{_customRender:()=>{t.triggerRepaint(),null===r||void 0===r||r("")}});let l;return s.parameters=a(a({},ch(t,!0)),s.parameters),s.views||(s.views=hh(t)),i&&i.props.gl!==n||(Object.assign(s,{gl:n,width:null,height:null,touchAction:"unset",viewState:dh(t)}),null!==i&&void 0!==i&&i.isInitialized?ah(i,t):s.onLoad=()=>{null===o||void 0===o||o(),ah(l,t)}),i?(l=i,i.setProps(s),i.userData.isExternal=!0):(l=new qu(s),t.on("remove",()=>{lh(t)})),l.userData.mapboxLayers=new Set,t.__deck=l,t.on("render",()=>{l.isInitialized&&function(e,t){const{mapboxLayers:n,isExternal:i}=e.userData;if(i){const i=Array.from(n,e=>e.id),r=ze(e.props.layers,Boolean).some(e=>e&&!i.includes(e.id));let o=e.getViewports();const s=o.findIndex(e=>"mapbox"===e.id),a=o.length>1||s<0;(r||a)&&(s>=0&&(o=o.slice(),o[s]=fh(e,t)),e._drawLayers("mapbox-repaint",{viewports:o,layerFilter:t=>(!e.props.layerFilter||e.props.layerFilter(t))&&("mapbox"!==t.viewport.id||!i.includes(t.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}(l,t)}),l}function ah(e,t){const n=()=>{e.isInitialized?function(e,t){e.setProps({viewState:dh(t)}),e.needsRedraw({clearRedrawFlags:!0})}(e,t):t.off("move",n)};t.on("move",n)}function lh(e){var t;null===(t=e.__deck)||void 0===t||t.finalize(),e.__deck=null}function ch(e,t){const n=t?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return"globe"===uh(e)&&(n.cullMode="back"),n}function uh(e){var t;const n=null===(t=e.getProjection)||void 0===t?void 0:t.call(e),i=(null===n||void 0===n?void 0:n.type)||(null===n||void 0===n?void 0:n.name);if("globe"===i)return"globe";if(i&&"mercator"!==i)throw new Error("Unsupported projection");return"mercator"}function hh(e){return"globe"===uh(e)?new ih({id:"mapbox"}):new Xo({id:"mapbox"})}function dh(e){var t;const{lng:n,lat:i}=e.getCenter(),r={longitude:(n+540)%360-180,latitude:i,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return null!==(t=e.getTerrain)&&void 0!==t&&t.call(e)&&function(e,t){if(e.getFreeCameraOptions){const{position:n}=e.getFreeCameraOptions();if(!n||void 0===n.z)return;const i=e.transform.height,{longitude:r,latitude:o,pitch:s}=t,a=n.x*rh,l=(1-n.y)*rh,c=n.z*rh,u=Gi([r,o]),h=a-u[0],d=l-u[1],f=Math.sqrt(h*h+d*d),p=s*oh,m=1.5*i,g=p<.001?m*Math.cos(p)/c:m*Math.sin(p)/f;t.zoom=Math.log2(g);const _=c-m*Math.cos(p)/g;t.position=[0,0,_/qi(o)]}else"number"===typeof e.transform.elevation&&(t.position=[0,0,e.transform.elevation])}(e,r),r}function fh(e,t,n){var i,r;const o=dh(t),s=hh(t);n&&(s.props.nearZMultiplier=.2);const a=null!==(i=null===n||void 0===n?void 0:n.nearZ)&&void 0!==i?i:t.transform._nearZ,l=null!==(r=null===n||void 0===n?void 0:n.farZ)&&void 0!==r?r:t.transform._farZ;return Number.isFinite(a)&&(o.nearZ=a/t.transform.height,o.farZ=l/t.transform.height),s.makeViewport({width:e.width,height:e.height,viewState:o})}function ph(e){if(e.userData.isExternal)return;const t=[];e.userData.mapboxLayers.forEach(e=>{const n=new(0,e.props.type)(e.props);t.push(n)}),e.setProps({layers:t})}class mh{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){var n,i;this.map=e,this.deck=sh({map:e,gl:t,deck:this.props.deck}),n=this.deck,i=this,n.userData.mapboxLayers.add(i),ph(n)}onRemove(){var e,t;this.deck&&(e=this.deck,t=this,e.userData.mapboxLayers.delete(t),ph(e))}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&ph(this.deck)}render(e,t){!function(e,t,n,i){let{currentViewport:r}=e.userData,o=!1;r||(r=fh(e,t,i),e.userData.currentViewport=r,o=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:t=>(!e.props.layerFilter||e.props.layerFilter(t))&&(n.id===t.layer.id||t.layer.props.operation.includes("terrain")),clearStack:o,clearCanvas:!1})}(this.deck,this.map,this,t)}}const gh="__UNDEFINED__";function _h(e,t,n,i){if(!e||!t||!e.style||!e.style._loaded)return;const r=ze(i,Boolean);if(n!==i){const t=ze(n,Boolean),i=new Set(t.map(e=>e.id));for(const e of r)i.delete(e.id);for(const n of i)e.getLayer(n)&&e.removeLayer(n)}for(const a of r){const n=e.getLayer(a.id);if(n){(n.implementation||n).setProps(a.props)}else e.addLayer(new mh({id:a.id,deck:t,slot:a.props.slot}),a.props.beforeId)}const o=e.style._order,s={};for(const a of r){let{beforeId:e}=a.props;e&&o.includes(e)||(e=gh),s[e]=s[e]||[],s[e].push(a.id)}for(const a in s){const t=s[a];let n=a===gh?o.length:o.indexOf(a),i=a===gh?void 0:a;for(let r=t.length-1;r>=0;r--){const s=t[r],a=o.indexOf(s);a!==n-1&&(e.moveLayer(s,i),a>n&&n++),n--,i=s}}}const yh=["interleaved"];class vh{constructor(e){this._handleStyleChange=()=>{_h(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:e,clientHeight:t}=this._map.getContainer();Object.assign(this._container.style,{width:"".concat(e,"px"),height:"".concat(t,"px")})}},this._updateViewState=()=>{const e=this._deck,t=this._map;e&&t&&(e.setProps({views:this._props.views||hh(t),viewState:dh(t)}),e.isInitialized&&e.redraw())},this._handleMouseEvent=e=>{const t=this._deck;if(!t||!t.isInitialized)return;const n={type:e.type,offsetCenter:e.point,srcEvent:e},i=this._lastMouseDownPoint;switch(!e.point&&i&&(n.deltaX=e.originalEvent.clientX-i.clientX,n.deltaY=e.originalEvent.clientY-i.clientY,n.offsetCenter={x:i.x+n.deltaX,y:i.y+n.deltaY}),n.type){case"mousedown":t._onPointerDown(n),this._lastMouseDownPoint=a(a({},e.point),{},{clientX:e.originalEvent.clientX,clientY:e.originalEvent.clientY});break;case"dragstart":n.type="panstart",t._onEvent(n);break;case"drag":n.type="panmove",t._onEvent(n);break;case"dragend":n.type="panend",t._onEvent(n);break;case"click":n.tapCount=1,t._onEvent(n);break;case"dblclick":n.type="click",n.tapCount=2,t._onEvent(n);break;case"mousemove":n.type="pointermove",t._onPointerMove(n);break;case"mouseout":n.type="pointerleave",t._onPointerMove(n);break;default:return}};const{interleaved:t=!1}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,yh);this._interleaved=t,this._props=n}setProps(e){this._interleaved&&e.layers&&_h(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps(a(a({},this._props),{},{parameters:a(a({},ch(this._map,this._interleaved)),this._props.parameters)}))}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new qu(a(a({},this._props),{},{parent:t,parameters:a(a({},ch(e,!1)),this._props.parameters),views:this._props.views||hh(e),viewState:dh(e)})),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&Le.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=sh({map:e,gl:t,deck:new qu(a(a({},this._props),{},{gl:t}))}),e.on("styledata",this._handleStyleChange),_h(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var t;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),null===(t=this._deck)||void 0===t||t.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),_h(e,this._deck,this._props.layers,[]),lh(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Co(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Co(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Co(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}function xh(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function bh(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function wh(e,t,n){if(!t||t>4)throw new Error("size ".concat(t));const i=t;let r=xh(e);if("uint8"===r&&n&&1===i)return"unorm8-webgl";if("uint8"===r&&n&&3===i)return"unorm8x3-webgl";if("uint8"===r||"sint8"===r){if(1===i||3===i)throw new Error("size: ".concat(t));return n&&(r=r.replace("int","norm")),"".concat(r,"x").concat(i)}if("uint16"===r||"sint16"===r){if(1===i||3===i)throw new Error("size: ".concat(t));return n&&(r=r.replace("int","norm")),"".concat(r,"x").concat(i)}return 1===i?r:"".concat(r,"x").concat(i)}const Eh=xh;function Th(e,t,n){const i="webgpu"===n&&"uint8"===t.type?"unorm8":t.type;return{attribute:e,format:t.size>1?"".concat(i,"x").concat(t.size):t.type,byteOffset:t.offset||0}}function Ah(e){return e.stride||e.size*e.bytesPerElement}function Sh(e,t){t.offset&&Le.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Ah(e),i=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*n+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return a(a({},t),{},{offset:i,stride:n})}class Dh{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,r="float64"===i;let o,{defaultValue:s}=t;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0),o=r?"float32":!i&&t.isIndexed?"uint32":i||"float32";let l=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return bh(e)}}(i||o);this.doublePrecision=r,r&&!1===t.fp64&&(l=Float32Array),this.value=null,this.settings=a(a({},t),{},{defaultType:l,defaultValue:s,logicalType:i,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT}),this.state=a(a({},n),{},{externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1})}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ah(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Pn.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n={};if(this.state.constant){const i=this.value;if(t){const r=Sh(this.getAccessor(),t),o=r.offset/i.BYTES_PER_ELEMENT,s=r.size||this.size;n[e]=i.subarray(o,o+s)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n["".concat(e,"64Low")]=n[e]:n["".concat(e,"64Low")]=new Float32Array(this.size)),n}_getBufferLayout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.getAccessor(),i=[],r={name:this.id,byteStride:Ah(n),attributes:i};if(this.doublePrecision){const r=function(e,t){const n=Sh(e,t);return{high:n,low:a(a({},n),{},{offset:n.offset+4*e.size})}}(n,t||{});i.push(Th(e,a(a({},n),r.high),this.device.type),Th("".concat(e,"64Low"),a(a({},n),r.low),this.device.type))}else if(t){const r=Sh(n,t);i.push(Th(e,a(a({},n),r),this.device.type))}else i.push(Th(e,n,this.device.type));return r}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,r=n*i;if(t&&r&&t.length>=r){const n=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let e=0;e<r;)for(let r=0;r<i;r++){const i=t[e++];i<n[r]&&(n[r]=i),i>o[r]&&(o[r]=i)}e=[n,o]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;n=ArrayBuffer.isView(e)?{value:e}:e instanceof Oa?{buffer:e}:e;const i=a(a({},this.settings),n);if(ArrayBuffer.isView(n.value)){if(!n.type){if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const e=Eh(n.value);i.type=i.normalized?e.replace("int","norm"):e}}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Ah(i)}if(t.bounds=null,n.constant){let e=n.value;e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e));if(!(!t.constant||!this._areValuesEqual(e,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(n.buffer){const e=n.buffer;t.externalBuffer=e,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let e=n.value;t.externalBuffer=null,t.constant=!1,this.value=e;let{buffer:r}=this;const o=Ah(i),s=(i.vertexOffset||0)*o;if(this.doublePrecision&&e instanceof Float64Array&&(e=oi(e,i)),this.settings.isIndexed){const t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}const a=e.byteLength+s+2*o;(!r||r.byteLength<a)&&(r=this._createBuffer(a)),r.write(e,s)}return this.setAccessor(i),!0}updateSubBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?oi(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{state:n}=this,i=n.allocatedValue,r=Pn.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=r;const{byteOffset:o}=this;let{buffer:s}=this;return(!s||s.byteLength<r.byteLength+o)&&(s=this._createBuffer(r.byteLength+o),t&&i&&s.write(i instanceof Float64Array?oi(i,this):i,o)),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));t instanceof n||!this.settings.normalized||"normalized"in e||Le.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(e=>e/255);case"unorm16":return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let e=r;for(;--e>=0;)t[n+e]=i[e];return t}switch(r){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=r;for(;--o>=0;)t[n+o]=Number.isFinite(e[o])?e[o]:i[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){var t;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:i}=this.settings;return this._buffer=this.device.createBuffer(a(a({},null===(t=this._buffer)||void 0===t?void 0:t.props),{},{id:this.id,usage:(n?Oa.INDEX:Oa.VERTEX)|Oa.COPY_DST,indexType:n?i:void 0,byteLength:e})),this._buffer}}const Ch=[],Ih=[];function Rh(e){return e&&e[Symbol.asyncIterator]}const Ph=[],Mh=[[0,1/0]];const Fh={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function Lh(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const n=e.type||"interpolation";return a(a(a(a({},Fh[n]),t),e),{},{type:n})}class kh extends Dh{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Mh}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,n,i;(t=this.state).layoutChanged||(t.layoutChanged=(n=e,i=this.getAccessor(),!(n.type===i.type&&n.size===i.size&&Ah(n)===Ah(i)&&(n.offset||0)===(i.offset||0)))),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!==typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,i=Array.isArray(t)?e[t.find(t=>e[t])]:e[t];return Lh(i,n)}setNeedsUpdate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,t=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:n=1/0}=t;this.state.updateRanges=function(e,t){if(e===Mh)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const n=[],i=e.length;let r=0;for(let o=0;o<i;o++){const i=e[o];i[1]<t[0]?(n.push(i),r=o+1):i[0]>t[1]?n.push(i):t=[Math.min(i[0],t[0]),Math.max(i[1],t[1])]}return n.splice(r,0,t),n}(this.state.updateRanges,[e,n])}else this.state.updateRanges=Mh}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Ph}setNeedsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return!n.noAlloc&&(!!n.update&&(super.allocate(e,t.updateRanges!==Mh),!0))}updateBuffer(e){let{numInstances:t,data:n,props:i,context:r}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:s,noAlloc:a}}=this;let l=!0;if(s){for(const[e,a]of o)s.call(r,this,{data:n,startRow:e,endRow:a,props:i,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[e,n]of o){const i=Number.isFinite(e)?this.getVertexOffset(e):0,r=Number.isFinite(n)?this.getVertexOffset(n):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}else;this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){if("webgpu"===this.device.type||void 0===e||"function"===typeof e)return!1;return this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;n.binaryValue=e,this.setNeedsRedraw();if(i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const r=e;Co(ArrayBuffer.isView(r.value),"invalid ".concat(i.accessor));const o=Boolean(r.size)&&r.size!==this.size;return n.binaryAccessor=function(e,t){const{size:n,stride:i,offset:r,startIndices:o,nested:s}=t,a=e.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((e.length-c)/l);return(t,i)=>{let{index:r,target:a}=i;if(!o){const t=r*l+c;for(let i=0;i<n;i++)a[i]=e[t+i];return a}const h=o[r],d=o[r+1]||u;let f;if(s){f=new Array(d-h);for(let t=h;t<d;t++){const i=t*l+c;a=new Array(n);for(let t=0;t<n;t++)a[t]=e[i+t];f[t-h]=a}}else if(l===n)f=e.subarray(h*n+c,d*n+c);else{f=new e.constructor((d-h)*n);let t=0;for(let i=h;i<d;i++){const r=i*l+c;for(let i=0;i<n;i++)f[t++]=e[r+i]}}return f}}(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:t,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(n.stepMode="dynamic"===i?e?e.isInstanced?"instance":"vertex":"instance":null!==i&&void 0!==i?i:"vertex",!t)return n;for(const r in t){const e=super._getBufferLayout(r,t[r]);n.attributes.push(...e.attributes)}return n}_autoUpdater(e,t){let{data:n,startRow:i,endRow:r,props:o,numInstances:s}=t;if(e.constant&&"webgpu"!==this.context.device.type)return;const{settings:a,state:l,value:c,size:u,startIndices:h}=e,{accessor:d,transform:f}=a;let p=l.binaryAccessor||("function"===typeof d?d:o[d]);"function"!==typeof p&&(p=()=>p),Co("function"===typeof p,'accessor "'.concat(d,'" is not a function'));let m=e.getVertexOffset(i);const{iterable:g,objectInfo:_}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,i=Ch;const r={index:-1,data:e,target:[]};return e?"function"===typeof e[Symbol.iterator]?i=e:e.length>0&&(Ih.length=e.length,i=Ih):i=Ch,(t>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,n),r.index=t-1),{iterable:i,objectInfo:r}}(n,i,r);for(const y of g){_.index++;let t=p(y,_);if(f&&(t=f.call(this,t)),h){const n=(_.index<h.length-1?h[_.index+1]:s)-h[_.index];if(t&&Array.isArray(t[0])){let n=m;for(const i of t)e._normalizeValue(i,c,n),n+=u}else t&&t.length>u?c.set(t,m):(e._normalizeValue(t,_.target,0),Ue({target:c,source:_.target,start:m,count:n}));m+=n*u}else e._normalizeValue(t,c,m),m+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||"function"===typeof e.update))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}const Oh="#version 300 es\n".concat("out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}");function Bh(e){const{input:t,inputChannels:n,output:i}=e||{};if(!t)return Oh;if(!n)throw new Error("inputChannels");const r=function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error("invalid channels: ".concat(e))}}(n),o=function(e,t){switch(t){case 1:return"vec4(".concat(e,", 0.0, 0.0, 1.0)");case 2:return"vec4(".concat(e,", 0.0, 1.0)");case 3:return"vec4(".concat(e,", 1.0)");case 4:return e;default:throw new Error("invalid channels: ".concat(t))}}(t,n);return"#version 300 es\nin ".concat(r," ").concat(t,";\nout vec4 ").concat(i,";\nvoid main() {\n  ").concat(i," = ").concat(o,";\n}")}class zh{constructor(e){o(this,"bufferLayouts",void 0),this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?null===(t=e.attributes)||void 0===t?void 0:t.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const i of t){const e=n.findIndex(e=>e.name===i.name);e<0?n.push(i):n[e]=i}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(t=>t.name===e);return-1===t&&Ma.warn('BufferLayout: Missing buffer for "'.concat(e,'".'))(),t}}function Nh(e){return Array.isArray(e)?0===e.length||"number"===typeof e[0]:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)}class Uh{constructor(e){if(o(this,"name",void 0),o(this,"uniforms",{}),o(this,"modifiedUniforms",{}),o(this,"modified",!0),o(this,"bindingLayout",{}),o(this,"needsRedraw","initialized"),this.name=(null===e||void 0===e?void 0:e.name)||"unnamed",null!==e&&void 0!==e&&e.name&&null!==e&&void 0!==e&&e.shaderLayout){var t;const n=null===e||void 0===e||null===(t=e.shaderLayout.bindings)||void 0===t?void 0:t.find(t=>"uniform"===t.type&&t.name===(null===e||void 0===e?void 0:e.name));if(!n)throw new Error(null===e||void 0===e?void 0:e.name);const i=n;for(const e of i.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw("".concat(this.name,".").concat(t,"=").concat(n))}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){(function(e,t){if(e!==t)return!1;const n=e,i=t;if(!Nh(n))return!1;if(Nh(i)&&n.length===i.length)for(let r=0;r<n.length;++r)if(i[r]!==n[r])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=function(e){return Nh(e)?e.slice():e}(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}const Vh={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function jh(e){return Vh[e]}function Gh(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}class Hh{constructor(e){o(this,"layout",{}),o(this,"byteLength",void 0);let t=0;for(const[i,r]of Object.entries(e)){const e=jh(r),{type:n,components:o}=e;t=Gh(t,o);const s=t;t+=o,this.layout[i]={type:n,size:o,offset:s}}t+=(4-t%4)%4;const n=4*t;this.byteLength=Math.max(n,1024)}getData(e){const t=Su(Math.max(this.byteLength,1024)),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[i,r]of Object.entries(e)){const e=this.layout[i];if(!e){Ma.warn("Supplied uniform value ".concat(i," not present in uniform block layout"))();continue}const{type:t,size:o,offset:s}=e,a=n[t];if(1===o){if("number"!==typeof r&&"boolean"!==typeof r){Ma.warn("Supplied value for single component uniform ".concat(i," is not a number: ").concat(r))();continue}a[s]=Number(r)}else{if(!Nh(r)){Ma.warn("Supplied value for multi component / array uniform ".concat(i," is not a numeric array: ").concat(r))();continue}a.set(r,s)}}return new Uint8Array(t)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class Wh{constructor(e){o(this,"uniformBlocks",new Map),o(this,"uniformBufferLayouts",new Map),o(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const e=t,i=new Hh(n.uniformTypes||{});this.uniformBufferLayouts.set(e,i);const r=new Uh({name:t});r.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,r)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,i]of Object.entries(e)){var t;null===(t=this.uniformBlocks.get(n))||void 0===t||t.setUniforms(i)}this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return(null===(t=this.uniformBufferLayouts.get(e))||void 0===t?void 0:t.byteLength)||0}getUniformBufferData(e){var t,n;const i=(null===(t=this.uniformBlocks.get(e))||void 0===t?void 0:t.getAllUniforms())||{};return null===(n=this.uniformBufferLayouts.get(e))||void 0===n?void 0:n.getData(i)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:Oa.UNIFORM|Oa.COPY_DST,byteLength:i}),o=this.getUniformBufferData(t);return r.write(o),r}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:Oa.UNIFORM|Oa.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&Ma.log(3,"UniformStore.updateUniformBuffers(): ".concat(e))(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&null!==t&&void 0!==t&&t.needsRedraw){var r,o;i||(i=t.needsRedraw);const s=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),null===(r=n)||void 0===r||r.write(s);const a=null===(o=this.uniformBlocks.get(e))||void 0===o?void 0:o.getAllUniforms();Ma.log(4,"Writing to uniform buffer ".concat(String(e)),s,a)()}return i}}class qh{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Xh{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Zh extends qh{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Yh extends qh{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return"array<".concat(this.format.getTypeName(),", ").concat(this.count,">")}}class Kh extends qh{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return"&".concat(this.format.getTypeName())}}class Jh extends qh{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+="<".concat(this.format.name,">")}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}var Qh;(e=>{e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(Qh||(Qh={}));class $h{constructor(e,t,n,i,r,o,s){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=r,this.resourceType=o,this.access=s}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ed{constructor(e,t){this.name=e,this.type=t}}class td{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class nd{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class id{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class rd{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class od{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class sd{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const ad=new Float32Array(1),ld=new Int32Array(ad.buffer),cd=new Uint16Array(1);function ud(e){ad[0]=e;const t=ld[0],n=t>>31&1;let i=t>>23&255,r=8388607&t;if(255===i)return cd[0]=n<<15|31744|(0!==r?512:0),cd[0];if(0===i){if(0===r)return cd[0]=n<<15,cd[0];r|=8388608;let e=113;for(;!(8388608&r);)r<<=1,e--;return i=127-e,r&=8388607,i>0?(r=(r>>126-i)+(r>>127-i&1),cd[0]=n<<15|i<<10|r>>13,cd[0]):(cd[0]=n<<15,cd[0])}return i=i-127+15,i>=31?(cd[0]=n<<15|31744,cd[0]):i<=0?i<-10?(cd[0]=n<<15,cd[0]):(r=(8388608|r)>>1-i,cd[0]=n<<15|r>>13,cd[0]):(r>>=13,cd[0]=n<<15|i<<10|r,cd[0])}const hd=new Uint32Array(1),dd=new Float32Array(hd.buffer,0,1);function fd(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return hd[0]=t,dd[0]}function pd(e,t,n,i){const r=[0,0,0,0];for(let c=0;c<i;++c)switch(n){case"8unorm":r[c]=e[t]/255,t++;break;case"8snorm":r[c]=e[t]/255*2-1,t++;break;case"8uint":r[c]=e[t],t++;break;case"8sint":r[c]=e[t]-127,t++;break;case"16uint":r[c]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":r[c]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":r[c]=(void 0,void 0,void 0,s=(32768&(o=e[t]|e[t+1]<<8))>>15,l=1023&o,0==(a=(31744&o)>>10)?(s?-1:1)*Math.pow(2,-14)*(l/Math.pow(2,10)):31==a?l?NaN:1/0*(s?-1:1):(s?-1:1)*Math.pow(2,a-15)*(1+l/Math.pow(2,10))),t+=2;break;case"32uint":case"32sint":r[c]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":r[c]=new Float32Array(e.buffer,t,1)[0],t+=4}var o,s,a,l;return r}function md(e,t,n,i,r){for(let o=0;o<i;++o)switch(n){case"8unorm":e[t]=255*r[o],t++;break;case"8snorm":e[t]=.5*(r[o]+1)*255,t++;break;case"8uint":e[t]=r[o],t++;break;case"8sint":e[t]=r[o]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=r[o],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=r[o],t+=2;break;case"16float":{const n=ud(r[o]);new Uint16Array(e.buffer,t,1)[0]=n,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=r[o],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=r[o],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=r[o],t+=4}return r}const gd={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class _d{constructor(){this.id=_d._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(yd.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(vd.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}_d._id=0;class yd extends _d{}yd.instance=new yd;class vd extends _d{}vd.instance=new vd;const xd=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class bd extends _d{constructor(){super()}}class wd extends bd{constructor(e,t,n,i,r,o){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=r,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class Ed extends bd{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Td extends bd{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Ad extends bd{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Sd extends bd{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;null===(t=this.init)||void 0===t||t.search(e),null===(n=this.condition)||void 0===n||n.search(e),null===(i=this.increment)||void 0===i||i.search(e),this.searchBlock(this.body,e)}}class Dd extends bd{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"var"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class Cd extends bd{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class Id extends bd{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"let"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class Rd extends bd{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}var Pd,Md,Fd,Ld;(e=>{e.increment="++",e.decrement="--"})(Pd||(Pd={})),(e=>{e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}})(Pd||(Pd={}));class kd extends bd{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(Md||(Md={})),(e=>{e.parse=function(e){const t=e;if("parse"==t)throw new Error("Invalid value for AssignOperator");return t}})(Md||(Md={}));class Od extends bd{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Bd extends bd{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return xd.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class zd extends bd{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class Nd extends bd{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class Ud extends bd{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Vd extends bd{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class jd extends bd{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Gd extends bd{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Hd extends bd{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Wd extends bd{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class qd extends bd{constructor(){super()}get astNodeType(){return"discard"}}class Xd extends bd{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class Zd extends bd{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Yd extends bd{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const i=Yd._priority.get(t.name);Yd._priority.get(e[n].name)<i&&(t=e[n])}return"x32"===t.name?Yd.i32:t}getTypeName(){return this.name}}Yd.x32=new Yd("x32"),Yd.f32=new Yd("f32"),Yd.i32=new Yd("i32"),Yd.u32=new Yd("u32"),Yd.f16=new Yd("f16"),Yd.bool=new Yd("bool"),Yd.void=new Yd("void"),Yd._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Kd extends Yd{constructor(e){super(e)}}class Jd extends Yd{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class Qd extends Yd{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+="<".concat(this.format.name,">")}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}Qd.vec2f=new Qd("vec2",Yd.f32,null),Qd.vec3f=new Qd("vec3",Yd.f32,null),Qd.vec4f=new Qd("vec4",Yd.f32,null),Qd.vec2i=new Qd("vec2",Yd.i32,null),Qd.vec3i=new Qd("vec3",Yd.i32,null),Qd.vec4i=new Qd("vec4",Yd.i32,null),Qd.vec2u=new Qd("vec2",Yd.u32,null),Qd.vec3u=new Qd("vec3",Yd.u32,null),Qd.vec4u=new Qd("vec4",Yd.u32,null),Qd.vec2h=new Qd("vec2",Yd.f16,null),Qd.vec3h=new Qd("vec3",Yd.f16,null),Qd.vec4h=new Qd("vec4",Yd.f16,null),Qd.vec2b=new Qd("vec2",Yd.bool,null),Qd.vec3b=new Qd("vec3",Yd.bool,null),Qd.vec4b=new Qd("vec4",Yd.bool,null),Qd.mat2x2f=new Qd("mat2x2",Yd.f32,null),Qd.mat2x3f=new Qd("mat2x3",Yd.f32,null),Qd.mat2x4f=new Qd("mat2x4",Yd.f32,null),Qd.mat3x2f=new Qd("mat3x2",Yd.f32,null),Qd.mat3x3f=new Qd("mat3x3",Yd.f32,null),Qd.mat3x4f=new Qd("mat3x4",Yd.f32,null),Qd.mat4x2f=new Qd("mat4x2",Yd.f32,null),Qd.mat4x3f=new Qd("mat4x3",Yd.f32,null),Qd.mat4x4f=new Qd("mat4x4",Yd.f32,null),Qd.mat2x2h=new Qd("mat2x2",Yd.f16,null),Qd.mat2x3h=new Qd("mat2x3",Yd.f16,null),Qd.mat2x4h=new Qd("mat2x4",Yd.f16,null),Qd.mat3x2h=new Qd("mat3x2",Yd.f16,null),Qd.mat3x3h=new Qd("mat3x3",Yd.f16,null),Qd.mat3x4h=new Qd("mat3x4",Yd.f16,null),Qd.mat4x2h=new Qd("mat4x2",Yd.f16,null),Qd.mat4x3h=new Qd("mat4x3",Yd.f16,null),Qd.mat4x4h=new Qd("mat4x4",Yd.f16,null),Qd.mat2x2i=new Qd("mat2x2",Yd.i32,null),Qd.mat2x3i=new Qd("mat2x3",Yd.i32,null),Qd.mat2x4i=new Qd("mat2x4",Yd.i32,null),Qd.mat3x2i=new Qd("mat3x2",Yd.i32,null),Qd.mat3x3i=new Qd("mat3x3",Yd.i32,null),Qd.mat3x4i=new Qd("mat3x4",Yd.i32,null),Qd.mat4x2i=new Qd("mat4x2",Yd.i32,null),Qd.mat4x3i=new Qd("mat4x3",Yd.i32,null),Qd.mat4x4i=new Qd("mat4x4",Yd.i32,null),Qd.mat2x2u=new Qd("mat2x2",Yd.u32,null),Qd.mat2x3u=new Qd("mat2x3",Yd.u32,null),Qd.mat2x4u=new Qd("mat2x4",Yd.u32,null),Qd.mat3x2u=new Qd("mat3x2",Yd.u32,null),Qd.mat3x3u=new Qd("mat3x3",Yd.u32,null),Qd.mat3x4u=new Qd("mat3x4",Yd.u32,null),Qd.mat4x2u=new Qd("mat4x2",Yd.u32,null),Qd.mat4x3u=new Qd("mat4x3",Yd.u32,null),Qd.mat4x4u=new Qd("mat4x4",Yd.u32,null);class $d extends Yd{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class ef extends Yd{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class tf extends Yd{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class nf extends _d{constructor(){super(),this.postfix=null}}class rf extends nf{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class of extends nf{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class sf extends nf{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return xd.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class af extends nf{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class lf extends nf{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class cf extends nf{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof Sf}get isVector(){return this.value instanceof Cf||this.value instanceof If}get scalarValue(){return this.value instanceof Sf?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Cf||this.value instanceof If?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class uf extends nf{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class hf extends nf{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class df extends nf{constructor(){super()}}class ff extends df{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class pf extends df{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?Yd.f32:"u32"===e.name||"u32"===t.name?Yd.u32:Yd.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class mf extends _d{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class gf extends nf{constructor(){super()}get astNodeType(){return"default"}}class _f extends mf{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class yf extends mf{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class vf extends _d{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class xf extends _d{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class bf extends _d{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class wf extends _d{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Ef{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Ef._id++}clone(){throw"Clone: Not implemented for ".concat(this.constructor.name)}setDataValue(e,t,n,i){console.error("SetDataValue: Not implemented for ".concat(this.constructor.name))}getSubData(e,t,n){return console.error("GetDataValue: Not implemented for ".concat(this.constructor.name)),null}toString(){return"<".concat(this.typeInfo.getTypeName(),">")}}Ef._id=0;class Tf extends Ef{constructor(){super(new qh("void",null),null)}toString(){return"void"}}Tf.void=new Tf;class Af extends Ef{constructor(e){super(new Kh("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,i){this.reference.setDataValue(e,t,n,i)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return"&".concat(this.reference.toString())}}class Sf extends Ef{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):"f32"===this.typeInfo.name||"f16"===this.typeInfo.name?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new Sf(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Sf(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Sf(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,i){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(t instanceof Sf))return void console.error("SetDataValue: Invalid value",t);let r=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?r=Math.floor(r):"bool"===this.typeInfo.name&&(r=r?1:0),this.data[0]=r}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return"".concat(this.value)}}function Df(e,t,n){const i=t.length;return 2===i?"f32"===n?new Cf(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===n||"bool"===n?new Cf(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===n?new Cf(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===n?new Cf(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error("getSubData: Unknown format ".concat(n)),null):3===i?"f32"===n?new Cf(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===n||"bool"===n?new Cf(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===n?new Cf(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===n?new Cf(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error("getSubData: Unknown format ".concat(n)),null):4===i?"f32"===n?new Cf(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===n||"bool"===n?new Cf(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===n?new Cf(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===n?new Cf(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error("getSubData: Unknown format ".concat(n)),null):(console.error("getSubData: Invalid vector size ".concat(t.length)),null)}class Cf extends Ef{constructor(e,t){if(super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):"vec2"===t||"vec3"===t||"vec4"===t?this.data=new Float32Array(e):console.error("VectorData: Invalid type ".concat(t))}}clone(){if(this.data instanceof Float32Array)return new Cf(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Cf(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Cf(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,i){n instanceof rf?console.error("TODO: Set vector postfix"):t instanceof Cf?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(null===t)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Jh)i=this.typeInfo.format||i;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?i=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?i=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?i=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?i=e.getTypeInfo("u32"):"vec2h"===t||"vec3h"===t||"vec4h"===t?i=e.getTypeInfo("f16"):console.error("GetSubData: Unknown type ".concat(t))}let r=this;for(;null!==t&&null!==r;){if(t instanceof hf){const o=t.index;let s=-1;if(o instanceof cf){if(!(o.value instanceof Sf))return console.error("GetSubData: Invalid array index ".concat(o.value)),null;s=o.value.value}else{const t=e.evalExpression(o,n);if(!(t instanceof Sf))return console.error("GetSubData: Unknown index type",o),null;s=t.value}if(s<0||s>=r.data.length)return console.error("GetSubData: Index out of range",s),null;if(r.data instanceof Float32Array){const e=new Float32Array(r.data.buffer,r.data.byteOffset+4*s,1);return new Sf(e,i)}if(r.data instanceof Int32Array){const e=new Int32Array(r.data.buffer,r.data.byteOffset+4*s,1);return new Sf(e,i)}if(r.data instanceof Uint32Array){const e=new Uint32Array(r.data.buffer,r.data.byteOffset+4*s,1);return new Sf(e,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof rf))return console.error("GetSubData: Unknown postfix",t),null;{const n=t.value.toLowerCase();if(1===n.length){let e=0;if("x"===n||"r"===n)e=0;else if("y"===n||"g"===n)e=1;else if("z"===n||"b"===n)e=2;else{if("w"!==n&&"a"!==n)return console.error("GetSubData: Unknown member ".concat(n)),null;e=3}if(this.data instanceof Float32Array){let t=new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Sf(t,i,this)}if(this.data instanceof Int32Array){let t=new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Sf(t,i,this)}if(this.data instanceof Uint32Array){let t=new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Sf(t,i,this)}}const o=[];for(const e of n)"x"===e||"r"===e?o.push(this.data[0]):"y"===e||"g"===e?o.push(this.data[1]):"z"===e||"b"===e?o.push(this.data[2]):"w"===e||"a"===e?o.push(this.data[3]):console.error("GetDataValue: Unknown member ".concat(e));r=Df(e,o,i.name)}t=t.postfix}return r}toString(){let e="".concat(this.data[0]);for(let t=1;t<this.data.length;++t)e+=", ".concat(this.data[t]);return e}}class If extends Ef{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new If(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,i){n instanceof rf?console.error("TODO: Set matrix postfix"):t instanceof If?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(null===t)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Jh)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error("GetDataValue: Unknown type ".concat(i)),null;e.getTypeInfo("f16")}if(t instanceof hf){const r=t.index;let o=-1;if(r instanceof cf){if(!(r.value instanceof Sf))return console.error("GetDataValue: Invalid array index ".concat(r.value)),null;o=r.value.value}else{const t=e.evalExpression(r,n);if(!(t instanceof Sf))return console.error("GetDataValue: Unknown index type",r),null;o=t.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const s=i.endsWith("h")?"h":"f";let a;if("mat2x2"===i||"mat2x2f"===i||"mat2x2h"===i||"mat3x2"===i||"mat3x2f"===i||"mat3x2h"===i||"mat4x2"===i||"mat4x2f"===i||"mat4x2h"===i)a=new Cf(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo("vec2".concat(s)));else if("mat2x3"===i||"mat2x3f"===i||"mat2x3h"===i||"mat3x3"===i||"mat3x3f"===i||"mat3x3h"===i||"mat4x3"===i||"mat4x3f"===i||"mat4x3h"===i)a=new Cf(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo("vec3".concat(s)));else{if("mat2x4"!==i&&"mat2x4f"!==i&&"mat2x4h"!==i&&"mat3x4"!==i&&"mat3x4f"!==i&&"mat3x4h"!==i&&"mat4x4"!==i&&"mat4x4f"!==i&&"mat4x4h"!==i)return console.error("GetDataValue: Unknown type ".concat(i)),null;a=new Cf(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo("vec4".concat(s)))}return t.postfix?a.getSubData(e,t.postfix,n):a}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e="".concat(this.data[0]);for(let t=1;t<this.data.length;++t)e+=", ".concat(this.data[t]);return e}}class Rf extends Ef{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Rf(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,i){if(null===t)return void console.log("setDataValue: NULL data.");let r=this.offset,o=this.typeInfo;for(;n;){if(n instanceof hf)if(o instanceof Yh){const t=n.index;if(t instanceof cf){if(!(t.value instanceof Sf))return void console.error("SetDataValue: Invalid index type ".concat(t.value));r+=t.value.value*o.stride}else{const n=e.evalExpression(t,i);if(!(n instanceof Sf))return void console.error("SetDataValue: Unknown index type",t);r+=n.value*o.stride}o=o.format}else console.error("SetDataValue: Type ".concat(o.getTypeName()," is not an array"));else{if(!(n instanceof rf))return void console.error("SetDataValue: Unknown postfix type",n);{const e=n.value;if(o instanceof Zh){let t=!1;for(const n of o.members)if(n.name===e){r+=n.offset,o=n.type,t=!0;break}if(!t)return void console.error("SetDataValue: Member ".concat(e," not found"))}else if(o instanceof qh){const n=o.getTypeName();let i=0;if("x"===e||"r"===e)i=0;else if("y"===e||"g"===e)i=1;else if("z"===e||"b"===e)i=2;else{if("w"!==e&&"a"!==e)return void console.error("SetDataValue: Unknown member ".concat(e));i=3}if(!(t instanceof Sf))return void console.error("SetDataValue: Invalid value",t);const s=t.value;return"vec2f"===n?void(new Float32Array(this.buffer,r,2)[i]=s):"vec3f"===n?void(new Float32Array(this.buffer,r,3)[i]=s):"vec4f"===n?void(new Float32Array(this.buffer,r,4)[i]=s):"vec2i"===n?void(new Int32Array(this.buffer,r,2)[i]=s):"vec3i"===n?void(new Int32Array(this.buffer,r,3)[i]=s):"vec4i"===n?void(new Int32Array(this.buffer,r,4)[i]=s):"vec2u"===n?void(new Uint32Array(this.buffer,r,2)[i]=s):"vec3u"===n?void(new Uint32Array(this.buffer,r,3)[i]=s):"vec4u"===n?void(new Uint32Array(this.buffer,r,4)[i]=s):void console.error("SetDataValue: Type ".concat(n," is not a struct"))}}}n=n.postfix}this.setData(e,t,o,r,i)}setData(e,t,n,i,r){const o=n.getTypeName();if("f32"!==o&&"f16"!==o)if("i32"!==o&&"atomic<i32>"!==o&&"x32"!==o)if("u32"!==o&&"atomic<u32>"!==o)if("bool"!==o)if("vec2f"!==o&&"vec2h"!==o)if("vec3f"!==o&&"vec3h"!==o)if("vec4f"!==o&&"vec4h"!==o)if("vec2i"!==o)if("vec3i"!==o)if("vec4i"!==o)if("vec2u"!==o)if("vec3u"!==o)if("vec4u"!==o)if("vec2b"!==o)if("vec3b"!==o)if("vec4b"!==o)if("mat2x2f"!==o&&"mat2x2h"!==o)if("mat2x3f"!==o&&"mat2x3h"!==o)if("mat2x4f"!==o&&"mat2x4h"!==o)if("mat3x2f"!==o&&"mat3x2h"!==o)if("mat3x3f"!==o&&"mat3x3h"!==o)if("mat3x4f"!==o&&"mat3x4h"!==o)if("mat4x2f"!==o&&"mat4x2h"!==o)if("mat4x3f"!==o&&"mat4x3h"!==o)if("mat4x4f"!==o&&"mat4x4h"!==o)if(t instanceof Rf){if(n===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",o,t.typeInfo.getTypeName())}else console.error("SetData: Unknown type ".concat(o));else{const e=new Float32Array(this.buffer,i,16);t instanceof If?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15])}else{const e=new Float32Array(this.buffer,i,12);t instanceof If?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11])}else{const e=new Float32Array(this.buffer,i,8);t instanceof If?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7])}else{const e=new Float32Array(this.buffer,i,12);t instanceof If?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11])}else{const e=new Float32Array(this.buffer,i,9);t instanceof If?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8])}else{const e=new Float32Array(this.buffer,i,6);t instanceof If?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5])}else{const e=new Float32Array(this.buffer,i,8);t instanceof If?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7])}else{const e=new Float32Array(this.buffer,i,6);t instanceof If?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5])}else{const e=new Float32Array(this.buffer,i,4);t instanceof If?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}else{const e=new Uint32Array(this.buffer,i,4);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}else{const e=new Uint32Array(this.buffer,i,3);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2])}else{const e=new Uint32Array(this.buffer,i,2);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1])}else{const e=new Uint32Array(this.buffer,i,4);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}else{const e=new Uint32Array(this.buffer,i,3);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2])}else{const e=new Uint32Array(this.buffer,i,2);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1])}else{const e=new Int32Array(this.buffer,i,4);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}else{const e=new Int32Array(this.buffer,i,3);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2])}else{const e=new Int32Array(this.buffer,i,2);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1])}else{const e=new Float32Array(this.buffer,i,4);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}else{const e=new Float32Array(this.buffer,i,3);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2])}else{const e=new Float32Array(this.buffer,i,2);t instanceof Cf?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1])}else t instanceof Sf&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof Sf&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof Sf&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof Sf&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,n){var i,r,o;if(null===t)return this;let s=this.offset,a=this.typeInfo;for(;t;){if(t instanceof hf){const i=t.index,r=i instanceof nf?e.evalExpression(i,n):i;let o=0;if(r instanceof Sf?o=r.value:"number"==typeof r?o=r:console.error("GetDataValue: Invalid index type",i),a instanceof Yh)s+=o*a.stride,a=a.format;else{const t=a.getTypeName();"mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t?(s+=16*o,a=e.getTypeInfo("vec4f")):console.error("getDataValue: Type ".concat(a.getTypeName()," is not an array"))}}else{if(!(t instanceof rf))return console.error("GetDataValue: Unknown postfix type",t),null;{const n=t.value;if(a instanceof Zh){let e=!1;for(const t of a.members)if(t.name===n){s+=t.offset,a=t.type,e=!0;break}if(!e)return console.error("GetDataValue: Member ".concat(n," not found")),null}else if(a instanceof qh){const t=a.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(n.length>0&&n.length<5){let i="f";const r=[];for(let o=0;o<n.length;++o){const a=n[o].toLowerCase();let l=0;if("x"===a||"r"===a)l=0;else if("y"===a||"g"===a)l=1;else if("z"===a||"b"===a)l=2;else{if("w"!==a&&"a"!==a)return console.error("Unknown member ".concat(n)),null;l=3}if(1===n.length){if(t.endsWith("f"))return this.buffer.byteLength<s+4*l+4?(console.log("Insufficient buffer data"),null):new Sf(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new Sf(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new Sf(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new Sf(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new Sf(new Uint32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)r.push(new Float32Array(this.buffer,s,2)[l]);else if("vec3f"===t){if(s+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const e=new Float32Array(this.buffer,s,3);r.push(e[l])}else if("vec4f"===t)r.push(new Float32Array(this.buffer,s,4)[l]);else if("vec2i"===t)i="i",r.push(new Int32Array(this.buffer,s,2)[l]);else if("vec3i"===t)i="i",r.push(new Int32Array(this.buffer,s,3)[l]);else if("vec4i"===t)i="i",r.push(new Int32Array(this.buffer,s,4)[l]);else if("vec2u"===t){i="u";const e=new Uint32Array(this.buffer,s,2);r.push(e[l])}else"vec3u"===t?(i="u",r.push(new Uint32Array(this.buffer,s,3)[l])):"vec4u"===t&&(i="u",r.push(new Uint32Array(this.buffer,s,4)[l]))}return 2===r.length?a=e.getTypeInfo("vec2".concat(i)):3===r.length?a=e.getTypeInfo("vec3".concat(i)):4===r.length?a=e.getTypeInfo("vec4".concat(i)):console.error("GetDataValue: Invalid vector length ".concat(r.length)),new Cf(r,a,null)}return console.error("GetDataValue: Unknown member ".concat(n)),null}return console.error("GetDataValue: Type ".concat(t," is not a struct")),null}}}t=t.postfix}const l=a.getTypeName();return"f32"===l?new Sf(new Float32Array(this.buffer,s,1),a,this):"i32"===l?new Sf(new Int32Array(this.buffer,s,1),a,this):"u32"===l?new Sf(new Uint32Array(this.buffer,s,1),a,this):"vec2f"===l?new Cf(new Float32Array(this.buffer,s,2),a,this):"vec3f"===l?new Cf(new Float32Array(this.buffer,s,3),a,this):"vec4f"===l?new Cf(new Float32Array(this.buffer,s,4),a,this):"vec2i"===l?new Cf(new Int32Array(this.buffer,s,2),a,this):"vec3i"===l?new Cf(new Int32Array(this.buffer,s,3),a,this):"vec4i"===l?new Cf(new Int32Array(this.buffer,s,4),a,this):"vec2u"===l?new Cf(new Uint32Array(this.buffer,s,2),a,this):"vec3u"===l?new Cf(new Uint32Array(this.buffer,s,3),a,this):"vec4u"===l?new Cf(new Uint32Array(this.buffer,s,4),a,this):a instanceof Jh&&"atomic"===a.name?"u32"===(null===(i=a.format)||void 0===i?void 0:i.name)?new Sf(new Uint32Array(this.buffer,s,1)[0],a.format,this):"i32"===(null===(r=a.format)||void 0===r?void 0:r.name)?new Sf(new Int32Array(this.buffer,s,1)[0],a.format,this):(console.error("GetDataValue: Invalid atomic format ".concat(null===(o=a.format)||void 0===o?void 0:o.name)),null):new Rf(this.buffer,a,s,this)}toString(){let e="";if(this.typeInfo instanceof Yh)if("f32"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e="[".concat(t[0]);for(let n=1;n<t.length;++n)e+=", ".concat(t[n])}else if("i32"===this.typeInfo.format.name){const t=new Int32Array(this.buffer,this.offset);e="[".concat(t[0]);for(let n=1;n<t.length;++n)e+=", ".concat(t[n])}else if("u32"===this.typeInfo.format.name){const t=new Uint32Array(this.buffer,this.offset);e="[".concat(t[0]);for(let n=1;n<t.length;++n)e+=", ".concat(t[n])}else if("vec2f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e="[".concat(t[0],", ").concat(t[1],"]");for(let n=1;n<t.length/2;++n)e+=", [".concat(t[2*n],", ").concat(t[2*n+1],"]")}else if("vec3f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e="[".concat(t[0],", ").concat(t[1],", ").concat(t[2],"]");for(let n=4;n<t.length;n+=4)e+=", [".concat(t[n],", ").concat(t[n+1],", ").concat(t[n+2],"]")}else if("vec4f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e="[".concat(t[0],", ").concat(t[1],", ").concat(t[2],", ").concat(t[3],"]");for(let n=4;n<t.length;n+=4)e+=", [".concat(t[n],", ").concat(t[n+1],", ").concat(t[n+2],", ").concat(t[n+3],"]")}else e="[...]";else this.typeInfo instanceof Zh?e+="{...}":e="[...]";return e}}class Pf extends Ef{constructor(e,t,n,i){super(t,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new Pf(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?null!==(e=n[0])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.width)&&void 0!==t?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?null!==(e=n[1])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.height)&&void 0!==t?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?null!==(e=n[2])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.depthOrArrayLayers)&&void 0!==t?t:0}get format(){var e;return this.descriptor&&null!==(e=this.descriptor.format)&&void 0!==e?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!==(e=this.descriptor.sampleCount)&&void 0!==e?e:1}get mipLevelCount(){var e;return this.descriptor&&null!==(e=this.descriptor.mipLevelCount)&&void 0!==e?e:1}get dimension(){var e;return this.descriptor&&null!==(e=this.descriptor.dimension)&&void 0!==e?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=gd[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=gd[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=gd[e],n=this.width;if(!e||n<=0||!t)return-1;const i=this.height,r=this.depthOrArrayLayers,o=this.dimension;return n/t.blockWidth*("1d"===o?1:i/t.blockHeight)*t.bytesPerBlock*r}getPixel(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=this.texelByteSize,o=this.bytesPerRow,s=this.height,a=this.data[i];return function(e,t,n,i,r,o,s,a,l){const c=i*(s>>=r)*(o>>=r)+n*s+t*a;switch(l){case"r8unorm":return[pd(e,c,"8unorm",1)[0]];case"r8snorm":return[pd(e,c,"8snorm",1)[0]];case"r8uint":return[pd(e,c,"8uint",1)[0]];case"r8sint":return[pd(e,c,"8sint",1)[0]];case"rg8unorm":{const t=pd(e,c,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{const t=pd(e,c,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{const t=pd(e,c,"8uint",2);return[t[0],t[1]]}case"rg8sint":{const t=pd(e,c,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const t=pd(e,c,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{const t=pd(e,c,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{const t=pd(e,c,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{const t=pd(e,c,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const t=pd(e,c,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[pd(e,c,"16uint",1)[0]];case"r16sint":return[pd(e,c,"16sint",1)[0]];case"r16float":return[pd(e,c,"16float",1)[0]];case"rg16uint":{const t=pd(e,c,"16uint",2);return[t[0],t[1]]}case"rg16sint":{const t=pd(e,c,"16sint",2);return[t[0],t[1]]}case"rg16float":{const t=pd(e,c,"16float",2);return[t[0],t[1]]}case"rgba16uint":{const t=pd(e,c,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{const t=pd(e,c,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{const t=pd(e,c,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[pd(e,c,"32uint",1)[0]];case"r32sint":return[pd(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[pd(e,c,"32float",1)[0]];case"rg32uint":{const t=pd(e,c,"32uint",2);return[t[0],t[1]]}case"rg32sint":{const t=pd(e,c,"32sint",2);return[t[0],t[1]]}case"rg32float":{const t=pd(e,c,"32float",2);return[t[0],t[1]]}case"rgba32uint":{const t=pd(e,c,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{const t=pd(e,c,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{const t=pd(e,c,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{const t=new Uint32Array(e.buffer,c,1)[0],n=(4192256&t)>>11,i=(4290772992&t)>>22;return[fd(2047&t),fd(n),function(e){const t=112+(e>>5&31)<<23|(31&e)<<18;return hd[0]=t,dd[0]}(i),1]}}return null}(new Uint8Array(a),e,t,n,i,s,o,r,this.format)}setPixel(e,t,n,i,r){const o=this.texelByteSize,s=this.bytesPerRow,a=this.height,l=this.data[i];!function(e,t,n,i,r,o,s,a,l,c){const u=i*(s>>=r)*(o>>=r)+n*s+t*a;switch(l){case"r8unorm":return void md(e,u,"8unorm",1,c);case"r8snorm":return void md(e,u,"8snorm",1,c);case"r8uint":return void md(e,u,"8uint",1,c);case"r8sint":return void md(e,u,"8sint",1,c);case"rg8unorm":return void md(e,u,"8unorm",2,c);case"rg8snorm":return void md(e,u,"8snorm",2,c);case"rg8uint":return void md(e,u,"8uint",2,c);case"rg8sint":return void md(e,u,"8sint",2,c);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void md(e,u,"8unorm",4,c);case"rgba8snorm":return void md(e,u,"8snorm",4,c);case"rgba8uint":return void md(e,u,"8uint",4,c);case"rgba8sint":return void md(e,u,"8sint",4,c);case"r16uint":return void md(e,u,"16uint",1,c);case"r16sint":return void md(e,u,"16sint",1,c);case"r16float":return void md(e,u,"16float",1,c);case"rg16uint":return void md(e,u,"16uint",2,c);case"rg16sint":return void md(e,u,"16sint",2,c);case"rg16float":return void md(e,u,"16float",2,c);case"rgba16uint":return void md(e,u,"16uint",4,c);case"rgba16sint":return void md(e,u,"16sint",4,c);case"rgba16float":return void md(e,u,"16float",4,c);case"r32uint":return void md(e,u,"32uint",1,c);case"r32sint":return void md(e,u,"32sint",1,c);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void md(e,u,"32float",1,c);case"rg32uint":return void md(e,u,"32uint",2,c);case"rg32sint":return void md(e,u,"32sint",2,c);case"rg32float":return void md(e,u,"32float",2,c);case"rgba32uint":return void md(e,u,"32uint",4,c);case"rgba32sint":return void md(e,u,"32sint",4,c);case"rgba32float":return void md(e,u,"32float",4,c);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}}(new Uint8Array(l),e,t,n,i,a,s,o,this.format,r)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(Ld||(Ld={}));class Mf{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class Ff{}Fd=Ff,Ff.none=new Mf("",Ld.reserved,""),Ff.eof=new Mf("EOF",Ld.token,""),Ff.reserved={asm:new Mf("asm",Ld.reserved,"asm"),bf16:new Mf("bf16",Ld.reserved,"bf16"),do:new Mf("do",Ld.reserved,"do"),enum:new Mf("enum",Ld.reserved,"enum"),f16:new Mf("f16",Ld.reserved,"f16"),f64:new Mf("f64",Ld.reserved,"f64"),handle:new Mf("handle",Ld.reserved,"handle"),i8:new Mf("i8",Ld.reserved,"i8"),i16:new Mf("i16",Ld.reserved,"i16"),i64:new Mf("i64",Ld.reserved,"i64"),mat:new Mf("mat",Ld.reserved,"mat"),premerge:new Mf("premerge",Ld.reserved,"premerge"),regardless:new Mf("regardless",Ld.reserved,"regardless"),typedef:new Mf("typedef",Ld.reserved,"typedef"),u8:new Mf("u8",Ld.reserved,"u8"),u16:new Mf("u16",Ld.reserved,"u16"),u64:new Mf("u64",Ld.reserved,"u64"),unless:new Mf("unless",Ld.reserved,"unless"),using:new Mf("using",Ld.reserved,"using"),vec:new Mf("vec",Ld.reserved,"vec"),void:new Mf("void",Ld.reserved,"void")},Ff.keywords={array:new Mf("array",Ld.keyword,"array"),atomic:new Mf("atomic",Ld.keyword,"atomic"),bool:new Mf("bool",Ld.keyword,"bool"),f32:new Mf("f32",Ld.keyword,"f32"),i32:new Mf("i32",Ld.keyword,"i32"),mat2x2:new Mf("mat2x2",Ld.keyword,"mat2x2"),mat2x3:new Mf("mat2x3",Ld.keyword,"mat2x3"),mat2x4:new Mf("mat2x4",Ld.keyword,"mat2x4"),mat3x2:new Mf("mat3x2",Ld.keyword,"mat3x2"),mat3x3:new Mf("mat3x3",Ld.keyword,"mat3x3"),mat3x4:new Mf("mat3x4",Ld.keyword,"mat3x4"),mat4x2:new Mf("mat4x2",Ld.keyword,"mat4x2"),mat4x3:new Mf("mat4x3",Ld.keyword,"mat4x3"),mat4x4:new Mf("mat4x4",Ld.keyword,"mat4x4"),ptr:new Mf("ptr",Ld.keyword,"ptr"),sampler:new Mf("sampler",Ld.keyword,"sampler"),sampler_comparison:new Mf("sampler_comparison",Ld.keyword,"sampler_comparison"),struct:new Mf("struct",Ld.keyword,"struct"),texture_1d:new Mf("texture_1d",Ld.keyword,"texture_1d"),texture_2d:new Mf("texture_2d",Ld.keyword,"texture_2d"),texture_2d_array:new Mf("texture_2d_array",Ld.keyword,"texture_2d_array"),texture_3d:new Mf("texture_3d",Ld.keyword,"texture_3d"),texture_cube:new Mf("texture_cube",Ld.keyword,"texture_cube"),texture_cube_array:new Mf("texture_cube_array",Ld.keyword,"texture_cube_array"),texture_multisampled_2d:new Mf("texture_multisampled_2d",Ld.keyword,"texture_multisampled_2d"),texture_storage_1d:new Mf("texture_storage_1d",Ld.keyword,"texture_storage_1d"),texture_storage_2d:new Mf("texture_storage_2d",Ld.keyword,"texture_storage_2d"),texture_storage_2d_array:new Mf("texture_storage_2d_array",Ld.keyword,"texture_storage_2d_array"),texture_storage_3d:new Mf("texture_storage_3d",Ld.keyword,"texture_storage_3d"),texture_depth_2d:new Mf("texture_depth_2d",Ld.keyword,"texture_depth_2d"),texture_depth_2d_array:new Mf("texture_depth_2d_array",Ld.keyword,"texture_depth_2d_array"),texture_depth_cube:new Mf("texture_depth_cube",Ld.keyword,"texture_depth_cube"),texture_depth_cube_array:new Mf("texture_depth_cube_array",Ld.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Mf("texture_depth_multisampled_2d",Ld.keyword,"texture_depth_multisampled_2d"),texture_external:new Mf("texture_external",Ld.keyword,"texture_external"),u32:new Mf("u32",Ld.keyword,"u32"),vec2:new Mf("vec2",Ld.keyword,"vec2"),vec3:new Mf("vec3",Ld.keyword,"vec3"),vec4:new Mf("vec4",Ld.keyword,"vec4"),bitcast:new Mf("bitcast",Ld.keyword,"bitcast"),block:new Mf("block",Ld.keyword,"block"),break:new Mf("break",Ld.keyword,"break"),case:new Mf("case",Ld.keyword,"case"),continue:new Mf("continue",Ld.keyword,"continue"),continuing:new Mf("continuing",Ld.keyword,"continuing"),default:new Mf("default",Ld.keyword,"default"),diagnostic:new Mf("diagnostic",Ld.keyword,"diagnostic"),discard:new Mf("discard",Ld.keyword,"discard"),else:new Mf("else",Ld.keyword,"else"),enable:new Mf("enable",Ld.keyword,"enable"),fallthrough:new Mf("fallthrough",Ld.keyword,"fallthrough"),false:new Mf("false",Ld.keyword,"false"),fn:new Mf("fn",Ld.keyword,"fn"),for:new Mf("for",Ld.keyword,"for"),function:new Mf("function",Ld.keyword,"function"),if:new Mf("if",Ld.keyword,"if"),let:new Mf("let",Ld.keyword,"let"),const:new Mf("const",Ld.keyword,"const"),loop:new Mf("loop",Ld.keyword,"loop"),while:new Mf("while",Ld.keyword,"while"),private:new Mf("private",Ld.keyword,"private"),read:new Mf("read",Ld.keyword,"read"),read_write:new Mf("read_write",Ld.keyword,"read_write"),return:new Mf("return",Ld.keyword,"return"),requires:new Mf("requires",Ld.keyword,"requires"),storage:new Mf("storage",Ld.keyword,"storage"),switch:new Mf("switch",Ld.keyword,"switch"),true:new Mf("true",Ld.keyword,"true"),alias:new Mf("alias",Ld.keyword,"alias"),type:new Mf("type",Ld.keyword,"type"),uniform:new Mf("uniform",Ld.keyword,"uniform"),var:new Mf("var",Ld.keyword,"var"),override:new Mf("override",Ld.keyword,"override"),workgroup:new Mf("workgroup",Ld.keyword,"workgroup"),write:new Mf("write",Ld.keyword,"write"),r8unorm:new Mf("r8unorm",Ld.keyword,"r8unorm"),r8snorm:new Mf("r8snorm",Ld.keyword,"r8snorm"),r8uint:new Mf("r8uint",Ld.keyword,"r8uint"),r8sint:new Mf("r8sint",Ld.keyword,"r8sint"),r16uint:new Mf("r16uint",Ld.keyword,"r16uint"),r16sint:new Mf("r16sint",Ld.keyword,"r16sint"),r16float:new Mf("r16float",Ld.keyword,"r16float"),rg8unorm:new Mf("rg8unorm",Ld.keyword,"rg8unorm"),rg8snorm:new Mf("rg8snorm",Ld.keyword,"rg8snorm"),rg8uint:new Mf("rg8uint",Ld.keyword,"rg8uint"),rg8sint:new Mf("rg8sint",Ld.keyword,"rg8sint"),r32uint:new Mf("r32uint",Ld.keyword,"r32uint"),r32sint:new Mf("r32sint",Ld.keyword,"r32sint"),r32float:new Mf("r32float",Ld.keyword,"r32float"),rg16uint:new Mf("rg16uint",Ld.keyword,"rg16uint"),rg16sint:new Mf("rg16sint",Ld.keyword,"rg16sint"),rg16float:new Mf("rg16float",Ld.keyword,"rg16float"),rgba8unorm:new Mf("rgba8unorm",Ld.keyword,"rgba8unorm"),rgba8unorm_srgb:new Mf("rgba8unorm_srgb",Ld.keyword,"rgba8unorm_srgb"),rgba8snorm:new Mf("rgba8snorm",Ld.keyword,"rgba8snorm"),rgba8uint:new Mf("rgba8uint",Ld.keyword,"rgba8uint"),rgba8sint:new Mf("rgba8sint",Ld.keyword,"rgba8sint"),bgra8unorm:new Mf("bgra8unorm",Ld.keyword,"bgra8unorm"),bgra8unorm_srgb:new Mf("bgra8unorm_srgb",Ld.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Mf("rgb10a2unorm",Ld.keyword,"rgb10a2unorm"),rg11b10float:new Mf("rg11b10float",Ld.keyword,"rg11b10float"),rg32uint:new Mf("rg32uint",Ld.keyword,"rg32uint"),rg32sint:new Mf("rg32sint",Ld.keyword,"rg32sint"),rg32float:new Mf("rg32float",Ld.keyword,"rg32float"),rgba16uint:new Mf("rgba16uint",Ld.keyword,"rgba16uint"),rgba16sint:new Mf("rgba16sint",Ld.keyword,"rgba16sint"),rgba16float:new Mf("rgba16float",Ld.keyword,"rgba16float"),rgba32uint:new Mf("rgba32uint",Ld.keyword,"rgba32uint"),rgba32sint:new Mf("rgba32sint",Ld.keyword,"rgba32sint"),rgba32float:new Mf("rgba32float",Ld.keyword,"rgba32float"),static_assert:new Mf("static_assert",Ld.keyword,"static_assert")},Ff.tokens={decimal_float_literal:new Mf("decimal_float_literal",Ld.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Mf("hex_float_literal",Ld.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Mf("int_literal",Ld.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Mf("uint_literal",Ld.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Mf("name",Ld.token,/((?:[A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037B-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFC5D\uFC64-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDF9\uFE71\uFE73\uFE77\uFE79\uFE7B\uFE7D\uFE7F-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFF9D\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC4\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF])(?:[0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037B-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u0870-\u0887\u0889-\u088E\u0897-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3C-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C5D\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDD\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1-\u0CF3\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECE\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u1715\u171F-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u180F-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF-\u1ACE\u1B00-\u1B4C\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFC5D\uFC64-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDF9\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE71\uFE73\uFE77\uFE79\uFE7B\uFE7D\uFE7F-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF65-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDD40-\uDD65\uDD69-\uDD6D\uDD6F-\uDD85\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDEC2-\uDEC4\uDEFC-\uDF1C\uDF27\uDF30-\uDF50\uDF70-\uDF85\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC75\uDC7F-\uDCBA\uDCC2\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E-\uDE41\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7-\uDFC0\uDFC2\uDFC5\uDFC7-\uDFCA\uDFCC-\uDFD3\uDFE1\uDFE2]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDED0-\uDEE3\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39\uDF40-\uDF46]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0\uDFF0-\uDFF9]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDF00-\uDF10\uDF12-\uDF3A\uDF3E-\uDF42\uDF50-\uDF5A\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC40-\uDC55\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD39]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDE70-\uDEBE\uDEC0-\uDEC9\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDD70-\uDD79\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD833[\uDCF0-\uDCF9\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDC30-\uDC6D\uDC8F\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDE90-\uDEAE\uDEC0-\uDEF9]|\uD839[\uDCD0-\uDCF9\uDDD0-\uDDFA\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF]|\uDB40[\uDD00-\uDDEF])+)|((?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037B-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFC5D\uFC64-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDF9\uFE71\uFE73\uFE77\uFE79\uFE7B\uFE7D\uFE7F-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFF9D\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC4\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF]))/),ident:new Mf("ident",Ld.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Mf("and",Ld.token,"&"),and_and:new Mf("and_and",Ld.token,"&&"),arrow:new Mf("arrow ",Ld.token,"->"),attr:new Mf("attr",Ld.token,"@"),forward_slash:new Mf("forward_slash",Ld.token,"/"),bang:new Mf("bang",Ld.token,"!"),bracket_left:new Mf("bracket_left",Ld.token,"["),bracket_right:new Mf("bracket_right",Ld.token,"]"),brace_left:new Mf("brace_left",Ld.token,"{"),brace_right:new Mf("brace_right",Ld.token,"}"),colon:new Mf("colon",Ld.token,":"),comma:new Mf("comma",Ld.token,","),equal:new Mf("equal",Ld.token,"="),equal_equal:new Mf("equal_equal",Ld.token,"=="),not_equal:new Mf("not_equal",Ld.token,"!="),greater_than:new Mf("greater_than",Ld.token,">"),greater_than_equal:new Mf("greater_than_equal",Ld.token,">="),shift_right:new Mf("shift_right",Ld.token,">>"),less_than:new Mf("less_than",Ld.token,"<"),less_than_equal:new Mf("less_than_equal",Ld.token,"<="),shift_left:new Mf("shift_left",Ld.token,"<<"),modulo:new Mf("modulo",Ld.token,"%"),minus:new Mf("minus",Ld.token,"-"),minus_minus:new Mf("minus_minus",Ld.token,"--"),period:new Mf("period",Ld.token,"."),plus:new Mf("plus",Ld.token,"+"),plus_plus:new Mf("plus_plus",Ld.token,"++"),or:new Mf("or",Ld.token,"|"),or_or:new Mf("or_or",Ld.token,"||"),paren_left:new Mf("paren_left",Ld.token,"("),paren_right:new Mf("paren_right",Ld.token,")"),semicolon:new Mf("semicolon",Ld.token,";"),star:new Mf("star",Ld.token,"*"),tilde:new Mf("tilde",Ld.token,"~"),underscore:new Mf("underscore",Ld.token,"_"),xor:new Mf("xor",Ld.token,"^"),plus_equal:new Mf("plus_equal",Ld.token,"+="),minus_equal:new Mf("minus_equal",Ld.token,"-="),times_equal:new Mf("times_equal",Ld.token,"*="),division_equal:new Mf("division_equal",Ld.token,"/="),modulo_equal:new Mf("modulo_equal",Ld.token,"%="),and_equal:new Mf("and_equal",Ld.token,"&="),or_equal:new Mf("or_equal",Ld.token,"|="),xor_equal:new Mf("xor_equal",Ld.token,"^="),shift_right_equal:new Mf("shift_right_equal",Ld.token,">>="),shift_left_equal:new Mf("shift_left_equal",Ld.token,"<<=")},Ff.simpleTokens={"@":Fd.tokens.attr,"{":Fd.tokens.brace_left,"}":Fd.tokens.brace_right,":":Fd.tokens.colon,",":Fd.tokens.comma,"(":Fd.tokens.paren_left,")":Fd.tokens.paren_right,";":Fd.tokens.semicolon},Ff.literalTokens={"&":Fd.tokens.and,"&&":Fd.tokens.and_and,"->":Fd.tokens.arrow,"/":Fd.tokens.forward_slash,"!":Fd.tokens.bang,"[":Fd.tokens.bracket_left,"]":Fd.tokens.bracket_right,"=":Fd.tokens.equal,"==":Fd.tokens.equal_equal,"!=":Fd.tokens.not_equal,">":Fd.tokens.greater_than,">=":Fd.tokens.greater_than_equal,">>":Fd.tokens.shift_right,"<":Fd.tokens.less_than,"<=":Fd.tokens.less_than_equal,"<<":Fd.tokens.shift_left,"%":Fd.tokens.modulo,"-":Fd.tokens.minus,"--":Fd.tokens.minus_minus,".":Fd.tokens.period,"+":Fd.tokens.plus,"++":Fd.tokens.plus_plus,"|":Fd.tokens.or,"||":Fd.tokens.or_or,"*":Fd.tokens.star,"~":Fd.tokens.tilde,_:Fd.tokens.underscore,"^":Fd.tokens.xor,"+=":Fd.tokens.plus_equal,"-=":Fd.tokens.minus_equal,"*=":Fd.tokens.times_equal,"/=":Fd.tokens.division_equal,"%=":Fd.tokens.modulo_equal,"&=":Fd.tokens.and_equal,"|=":Fd.tokens.or_equal,"^=":Fd.tokens.xor_equal,">>=":Fd.tokens.shift_right_equal,"<<=":Fd.tokens.shift_left_equal},Ff.regexTokens={decimal_float_literal:Fd.tokens.decimal_float_literal,hex_float_literal:Fd.tokens.hex_float_literal,int_literal:Fd.tokens.int_literal,uint_literal:Fd.tokens.uint_literal,ident:Fd.tokens.ident},Ff.storage_class=[Fd.keywords.function,Fd.keywords.private,Fd.keywords.workgroup,Fd.keywords.uniform,Fd.keywords.storage],Ff.access_mode=[Fd.keywords.read,Fd.keywords.write,Fd.keywords.read_write],Ff.sampler_type=[Fd.keywords.sampler,Fd.keywords.sampler_comparison],Ff.sampled_texture_type=[Fd.keywords.texture_1d,Fd.keywords.texture_2d,Fd.keywords.texture_2d_array,Fd.keywords.texture_3d,Fd.keywords.texture_cube,Fd.keywords.texture_cube_array],Ff.multisampled_texture_type=[Fd.keywords.texture_multisampled_2d],Ff.storage_texture_type=[Fd.keywords.texture_storage_1d,Fd.keywords.texture_storage_2d,Fd.keywords.texture_storage_2d_array,Fd.keywords.texture_storage_3d],Ff.depth_texture_type=[Fd.keywords.texture_depth_2d,Fd.keywords.texture_depth_2d_array,Fd.keywords.texture_depth_cube,Fd.keywords.texture_depth_cube_array,Fd.keywords.texture_depth_multisampled_2d],Ff.texture_external_type=[Fd.keywords.texture_external],Ff.any_texture_type=[...Fd.sampled_texture_type,...Fd.multisampled_texture_type,...Fd.storage_texture_type,...Fd.depth_texture_type,...Fd.texture_external_type],Ff.texel_format=[Fd.keywords.r8unorm,Fd.keywords.r8snorm,Fd.keywords.r8uint,Fd.keywords.r8sint,Fd.keywords.r16uint,Fd.keywords.r16sint,Fd.keywords.r16float,Fd.keywords.rg8unorm,Fd.keywords.rg8snorm,Fd.keywords.rg8uint,Fd.keywords.rg8sint,Fd.keywords.r32uint,Fd.keywords.r32sint,Fd.keywords.r32float,Fd.keywords.rg16uint,Fd.keywords.rg16sint,Fd.keywords.rg16float,Fd.keywords.rgba8unorm,Fd.keywords.rgba8unorm_srgb,Fd.keywords.rgba8snorm,Fd.keywords.rgba8uint,Fd.keywords.rgba8sint,Fd.keywords.bgra8unorm,Fd.keywords.bgra8unorm_srgb,Fd.keywords.rgb10a2unorm,Fd.keywords.rg11b10float,Fd.keywords.rg32uint,Fd.keywords.rg32sint,Fd.keywords.rg32float,Fd.keywords.rgba16uint,Fd.keywords.rgba16sint,Fd.keywords.rgba16float,Fd.keywords.rgba32uint,Fd.keywords.rgba32sint,Fd.keywords.rgba32float],Ff.const_literal=[Fd.tokens.int_literal,Fd.tokens.uint_literal,Fd.tokens.decimal_float_literal,Fd.tokens.hex_float_literal,Fd.keywords.true,Fd.keywords.false],Ff.literal_or_ident=[Fd.tokens.ident,Fd.tokens.int_literal,Fd.tokens.uint_literal,Fd.tokens.decimal_float_literal,Fd.tokens.hex_float_literal,Fd.tokens.name],Ff.element_count_expression=[Fd.tokens.int_literal,Fd.tokens.uint_literal,Fd.tokens.ident],Ff.template_types=[Fd.keywords.vec2,Fd.keywords.vec3,Fd.keywords.vec4,Fd.keywords.mat2x2,Fd.keywords.mat2x3,Fd.keywords.mat2x4,Fd.keywords.mat3x2,Fd.keywords.mat3x3,Fd.keywords.mat3x4,Fd.keywords.mat4x2,Fd.keywords.mat4x3,Fd.keywords.mat4x4,Fd.keywords.atomic,Fd.keywords.bitcast,...Fd.any_texture_type],Ff.attribute_name=[Fd.tokens.ident,Fd.keywords.block,Fd.keywords.diagnostic],Ff.assignment_operators=[Fd.tokens.equal,Fd.tokens.plus_equal,Fd.tokens.minus_equal,Fd.tokens.times_equal,Fd.tokens.division_equal,Fd.tokens.modulo_equal,Fd.tokens.and_equal,Fd.tokens.or_equal,Fd.tokens.xor_equal,Fd.tokens.shift_right_equal,Fd.tokens.shift_left_equal],Ff.increment_operators=[Fd.tokens.plus_plus,Fd.tokens.minus_minus];class Lf{constructor(e,t,n,i,r){this.type=e,this.lexeme=t,this.line=n,this.start=i,this.end=r}toString(){return this.lexeme}isTemplateType(){return-1!=Ff.template_types.indexOf(this.type)}isArrayType(){return this.type==Ff.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class kf{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw"Invalid syntax at line ".concat(this._line);return this._tokens.push(new Lf(Ff.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}const t=Ff.simpleTokens[e];if(t)return this._addToken(t),!0;let n=Ff.none;const i=this._isAlpha(e),r="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(i){const t=Ff.keywords[e];if(t)return this._addToken(t),!0}if(i||r)return this._addToken(Ff.tokens.ident),!0;for(;;){let t=this._findType(e);const i=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==i)return this._current++,e+=i,this._addToken(Ff.tokens.minus_equal),!0;if("-"==i)return this._current++,e+=i,this._addToken(Ff.tokens.minus_minus),!0;const n=this._tokens.length-1;if((-1!=Ff.literal_or_ident.indexOf(this._tokens[n].type)||this._tokens[n].type==Ff.tokens.paren_right)&&">"!=i)return this._addToken(t),!0}if(">"==e&&(">"==i||"="==i)){let e=!1,n=this._tokens.length-1;for(let t=0;t<5&&n>=0&&-1===Ff.assignment_operators.indexOf(this._tokens[n].type);++t,--n)if(this._tokens[n].type===Ff.tokens.less_than){n>0&&this._tokens[n-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===Ff.none){let i=e,r=0;const o=2;for(let e=0;e<o;++e)if(i+=this._peekAhead(e),t=this._findType(i),t!==Ff.none){r=e;break}if(t===Ff.none)return n!==Ff.none&&(this._current--,this._addToken(n),!0);e=i,this._current+=r+1}if(n=t,this._isAtEnd())break;e+=this._advance()}return n!==Ff.none&&(this._addToken(n),!0)}_findType(e){for(const t in Ff.regexTokens){const n=Ff.regexTokens[t];if(this._match(e,n.rule))return n}return Ff.literalTokens[e]||Ff.none}_match(e,t){const n=t.exec(e);return n&&0==n.index&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"\t"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new Lf(e,t,this._line,this._start,this._current))}}function Of(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}const Bf=new Float32Array(1),zf=new Uint32Array(Bf.buffer),Nf=new Uint32Array(Bf.buffer),Uf=new Int32Array(1),Vf=new Float32Array(Uf.buffer),jf=new Uint32Array(Uf.buffer),Gf=new Uint32Array(1),Hf=new Float32Array(Gf.buffer),Wf=new Int32Array(Gf.buffer);function qf(e,t,n){if(t===n)return e;if("f32"===t){if("i32"===n||"x32"===n)return Bf[0]=e,zf[0];if("u32"===n)return Bf[0]=e,Nf[0]}else if("i32"===t||"x32"===t){if("f32"===n)return Uf[0]=e,Vf[0];if("u32"===n)return Uf[0]=e,jf[0]}else if("u32"===t){if("f32"===n)return Gf[0]=e,Hf[0];if("i32"===n||"x32"===n)return Gf[0]=e,Wf[0]}return console.error("Unsupported cast from ".concat(t," to ").concat(n)),e}class Xf{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Zf{constructor(e,t){this.align=e,this.size=t}}class Yf{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new sd,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(const t of e)t instanceof wd&&this._functions.set(t.name,new Xf(t));for(const t of e)if(t instanceof Jd){const e=this.getTypeInfo(t,null);e instanceof Zh&&this.structs.push(e)}for(const t of e)if(t instanceof Wd)this.aliases.push(this._getAliasInfo(t));else if(t instanceof Cd){const e=t,n=this._getAttributeNum(e.attributes,"id",0),i=null!=e.type?this.getTypeInfo(e.type,e.attributes):null;this.overrides.push(new id(e.name,i,e.attributes,n))}else if(this._isUniformVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),o=new $h(e.name,r,n,i,e.attributes,Qh.Uniform,e.access);o.access||(o.access="read"),this.uniforms.push(o)}else if(this._isStorageVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),o=this._isStorageTexture(r),s=new $h(e.name,r,n,i,e.attributes,o?Qh.StorageTexture:Qh.Storage,e.access);s.access||(s.access="read"),this.storage.push(s)}else if(this._isTextureVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),o=this._isStorageTexture(r),s=new $h(e.name,r,n,i,e.attributes,o?Qh.StorageTexture:Qh.Texture,e.access);s.access||(s.access="read"),o?this.storage.push(s):this.textures.push(s)}else if(this._isSamplerVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),o=new $h(e.name,r,n,i,e.attributes,Qh.Sampler,e.access);this.samplers.push(o)}for(const t of e)if(t instanceof wd){const e=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),r=e||n||i,o=new od(t.name,null==r?void 0:r.name,t.attributes);o.attributes=t.attributes,o.startLine=t.startLine,o.endLine=t.endLine,this.functions.push(o),this._functions.get(t.name).info=o,r&&(this._functions.get(t.name).inUse=!0,o.inUse=!0,o.resources=this._findResources(t,!!r),o.inputs=this._getInputs(t.args),o.outputs=this._getOutputs(t.returnType),this.entry[r.name].push(o)),o.arguments=t.args.map(e=>new rd(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes)),o.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(e=>{var n,i,r;if(e instanceof wf){if(e.value)if(Of(e.value))for(const o of e.value)for(const e of this.overrides)o===e.name&&(null===(n=t.info)||void 0===n||n.overrides.push(e));else for(const o of this.overrides)e.value===o.name&&(null===(i=t.info)||void 0===i||i.overrides.push(o))}else if(e instanceof af)for(const o of this.overrides)e.name===o.name&&(null===(r=t.info)||void 0===r||r.overrides.push(o))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const e=null===(n=this._functions.get(i.name))||void 0===n?void 0:n.info;e&&t.add(e)}}findResource(e,t,n){if(n){for(const i of this.entry.compute)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n;for(const i of this.entry.vertex)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n;for(const i of this.entry.fragment)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,r=[];return e.search(o=>{if(o instanceof yd)r.push({});else if(o instanceof vd)r.pop();else if(o instanceof Dd){const e=o;t&&null!==e.type&&this._markStructsFromAST(e.type),r.length>0&&(r[r.length-1][e.name]=e)}else if(o instanceof of){const e=o;t&&null!==e.type&&this._markStructsFromAST(e.type)}else if(o instanceof Id){const e=o;t&&null!==e.type&&this._markStructsFromAST(e.type),r.length>0&&(r[r.length-1][e.name]=e)}else if(o instanceof af){const e=o;if(r.length>0&&r[r.length-1][e.name])return;const t=i._findResource(e.name);t&&n.push(t)}else if(o instanceof sf){const r=o,s=i._functions.get(r.name);s&&(t&&(s.inUse=!0),e.calls.add(s.node),null===s.resources&&(s.resources=i._findResources(s.node,t)),n.push(...s.resources))}else if(o instanceof Bd){const r=o,s=i._functions.get(r.name);s&&(t&&(s.inUse=!0),e.calls.add(s.node),null===s.resources&&(s.resources=i._findResources(s.node,t)),n.push(...s.resources))}}),[...new Map(n.map(e=>[e.name,e])).values()]}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(void 0===t&&(t=[]),e instanceof Jd)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof Jd)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const i=this.getTypeInfo(n.type,n.type.attributes),r=this._parseInt(e.value),o=new nd(n.name,i,e.name,r);t.push(o)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new nd("",n,t.name,i)}return null}_getInputs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0===t&&(t=[]);for(const n of e)if(n.type instanceof Jd)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof Jd)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),r=this._parseInt(t.value),o=new td(e.name,i,t.name,r);return null!==n&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new ed(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._types.has(e))return this._types.get(e);if(e instanceof $d){const n=e.type?this.getTypeInfo(e.type,e.attributes):null,i=new Kh(e.name,n,t);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof ef){const n=e,i=n.format?this.getTypeInfo(n.format,n.attributes):null,r=new Yh(n.name,t);return r.format=i,r.count=n.count,this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Jd){const n=e,i=new Zh(n.name,t);i.startLine=n.startLine,i.endLine=n.endLine;for(const e of n.members){const t=this.getTypeInfo(e.type,e.attributes);i.members.push(new Xh(e.name,t,e.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof tf){const n=e,i=n.format instanceof Yd,r=n.format?i?this.getTypeInfo(n.format,null):new qh(n.format,null):null,o=new Jh(n.name,r,t,n.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Qd){const n=e,i=n.format?this.getTypeInfo(n.format,null):null,r=new Jh(n.name,i,t,n.access);return this._types.set(e,r),this._updateTypeInfo(r),r}const n=new qh(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,i;const r=this._getTypeSize(e);if(e.size=null!==(t=null==r?void 0:r.size)&&void 0!==t?t:0,e instanceof Yh&&e.format){const t=this._getTypeSize(e.format);e.stride=Math.max(null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,null!==(i=null==t?void 0:t.align)&&void 0!==i?i:0),this._updateTypeInfo(e.format)}e instanceof Kh&&this._updateTypeInfo(e.format),e instanceof Zh&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,r=0,o=0;for(let s=0,a=e.members.length;s<a;++s){const a=e.members[s],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+i),i=u,r=n,o=Math.max(o,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(o,r+i),e.align=o}_getTypeSize(e){var t,n;if(null==e)return null;const i=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Xh&&(e=e.type),e instanceof qh){const t=this._getAlias(e.name);null!==t&&(e=t)}{const n=Yf._typeInfo[e.name];if(void 0!==n){const o="f16"===(null===(t=e.format)||void 0===t?void 0:t.name)?2:1;return new Zf(Math.max(r,n.align/o),Math.max(i,n.size/o))}}{const t=Yf._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const n="h"===e.name[e.name.length-1]?2:1;return new Zf(Math.max(r,t.align/n),Math.max(i,t.size/n))}}if(e instanceof Yh){let t=e,o=8,s=8;const a=this._getTypeSize(t.format);return null!==a&&(s=a.size,o=a.align),s=t.count*this._getAttributeNum(null!==(n=null==e?void 0:e.attributes)&&void 0!==n?n:null,"stride",this._roundUp(o,s)),i&&(s=i),new Zf(Math.max(r,o),Math.max(i,s))}if(e instanceof Zh){let t=0,n=0,o=0,s=0,a=0;for(const i of e.members){const e=this._getTypeSize(i.type);null!==e&&(t=Math.max(e.align,t),o=this._roundUp(e.align,o+s),s=e.size,a=o)}return n=this._roundUp(t,a+s),new Zf(Math.max(r,t),Math.max(i,n))}return null}_isUniformVar(e){return e instanceof Dd&&"uniform"==e.storage}_isStorageVar(e){return e instanceof Dd&&"storage"==e.storage}_isTextureVar(e){return e instanceof Dd&&null!==e.type&&-1!=Yf._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof Dd&&null!==e.type&&-1!=Yf._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let r of i)if(r.name==t)return r;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let i of e)if(i.name==t){let e=null!==i&&null!==i.value?i.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}Yf._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Yf._textureTypes=Ff.any_texture_type.map(e=>e.name),Yf._samplerTypes=Ff.sampler_type.map(e=>e.name);let Kf=0;class Jf{constructor(e,t,n){this.id=Kf++,this.name=e,this.value=t,this.node=n}clone(){return new Jf(this.name,this.value,this.node)}}class Qf{constructor(e){this.id=Kf++,this.name=e.name,this.node=e}clone(){return new Qf(this.node)}}class $f{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Kf++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!==(t=this.variables.get(e))&&void 0!==t?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!==(t=this.functions.get(e))&&void 0!==t?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new Jf(e,t,null!=n?n:null))}setVariable(e,t,n){const i=this.getVariable(e);null!==i?i.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return null!==(t=null==n?void 0:n.value)&&void 0!==t?t:null}clone(){return new $f(this)}}class ep{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class tp{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let i=!0;if(n instanceof Cf)return n.data.forEach(e=>{e||(i=!1)}),new Sf(i?1:0,this.getTypeInfo("bool"));throw new Error("All() expects a vector argument. Line ".concat(e.line))}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf){const e=n.data.some(e=>e);return new Sf(e?1:0,this.getTypeInfo("bool"))}throw new Error("Any() expects a vector argument. Line ".concat(e.line))}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof Sf))throw new Error("Select() expects a bool condition. Line ".concat(e.line));return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.evalExpression(n,t);if(i instanceof Rf&&0===i.typeInfo.size){const e=i.typeInfo,t=i.buffer.byteLength/e.stride;return new Sf(t,this.getTypeInfo("u32"))}return new Sf(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.abs(e)),n.typeInfo);const i=n;return new Sf(Math.abs(i.value),i.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.acos(e)),n.typeInfo);const i=n;return new Sf(Math.acos(i.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.acosh(e)),n.typeInfo);const i=n;return new Sf(Math.acosh(i.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.asin(e)),n.typeInfo);const i=n;return new Sf(Math.asin(i.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.asinh(e)),n.typeInfo);const i=n;return new Sf(Math.asinh(i.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.atan(e)),n.typeInfo);const i=n;return new Sf(Math.atan(i.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.atanh(e)),n.typeInfo);const i=n;return new Sf(Math.atanh(i.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Cf&&i instanceof Cf)return new Cf(n.data.map((e,t)=>Math.atan2(e,i.data[t])),n.typeInfo);const r=n,o=i;return new Sf(Math.atan2(r.value,o.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.ceil(e)),n.typeInfo);const i=n;return new Sf(Math.ceil(i.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Cf&&i instanceof Cf&&r instanceof Cf)return new Cf(n.data.map((e,t)=>this._clamp(e,i.data[t],r.data[t])),n.typeInfo);const o=n,s=i,a=r;return new Sf(this._clamp(o.value,s.value,a.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.cos(e)),n.typeInfo);const i=n;return new Sf(Math.cos(i.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.cosh(e)),n.typeInfo);const i=n;return new Sf(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.clz32(e)),n.typeInfo);const i=n;return new Sf(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>this._countOneBits(e)),n.typeInfo);const i=n;return new Sf(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>this._countTrailingZeros(e)),n.typeInfo);const i=n;return new Sf(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Cf&&i instanceof Cf){if(3!==n.data.length||3!==i.data.length)return console.error("Cross() expects 3D vectors. Line ".concat(e.line)),null;const t=n.data,r=i.data;return new Cf([t[1]*r[2]-r[1]*t[2],t[2]*r[0]-r[2]*t[0],t[0]*r[1]-r[0]*t[1]],n.typeInfo)}return console.error("Cross() expects vector arguments. Line ".concat(e.line)),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return n instanceof Cf?new Cf(n.data.map(e=>e*i),n.typeInfo):new Sf(n.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof If){const e=n.data,t=n.typeInfo.getTypeName(),i=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new Sf(e[0]*e[3]-e[1]*e[2],i);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new Sf(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t)console.error("TODO: Determinant for ".concat(t));else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t)console.error("TODO: Determinant for ".concat(t));else{if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new Sf(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);"mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t||"mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t||"mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t?console.error("TODO: Determinant for ".concat(t)):"mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||console.error("TODO: Determinant for ".concat(t))}}return console.error("Determinant expects a matrix argument. Line ".concat(e.line)),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Cf&&i instanceof Cf){let e=0;for(let t=0;t<n.data.length;++t)e+=(n.data[t]-i.data[t])*(n.data[t]-i.data[t]);return new Sf(Math.sqrt(e),this.getTypeInfo("f32"))}const r=n,o=i;return new Sf(Math.abs(r.value-o.value),n.typeInfo)}_dot(e,t){let n=0;for(let i=0;i<e.length;++i)n+=t[i]*e[i];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return n instanceof Cf&&i instanceof Cf?new Sf(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error("Dot() expects vector arguments. Line ".concat(e.line)),null)}Dot4U8Packed(e,t){return console.error("TODO: dot4U8Packed. Line ".concat(e.line)),null}Dot4I8Packed(e,t){return console.error("TODO: dot4I8Packed. Line ".concat(e.line)),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.exp(e)),n.typeInfo);const i=n;return new Sf(Math.exp(i.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.pow(2,e)),n.typeInfo);const i=n;return new Sf(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if("u32"!==i.typeInfo.name&&"x32"!==i.typeInfo.name)return console.error("ExtractBits() expects an i32 offset argument. Line ".concat(e.line)),null;if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return console.error("ExtractBits() expects an i32 count argument. Line ".concat(e.line)),null;const o=i.value,s=r.value;if(n instanceof Cf)return new Cf(n.data.map(e=>e>>o&(1<<s)-1),n.typeInfo);if("i32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error("ExtractBits() expects an i32 argument. Line ".concat(e.line)),null;const a=n.value;return new Sf(a>>o&(1<<s)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Cf&&i instanceof Cf&&r instanceof Cf){const e=this._dot(i.data,r.data);return new Cf(e<0?Array.from(n.data):n.data.map(e=>-e),n.typeInfo)}return console.error("FaceForward() expects vector arguments. Line ".concat(e.line)),null}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>this._firstLeadingBit(e)),n.typeInfo);const i=n;return new Sf(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>this._firstTrailingBit(e)),n.typeInfo);const i=n;return new Sf(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.floor(e)),n.typeInfo);const i=n;return new Sf(Math.floor(i.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Cf&&i instanceof Cf&&r instanceof Cf)return n.data.length!==i.data.length||n.data.length!==r.data.length?(console.error("Fma() expects vectors of the same length. Line ".concat(e.line)),null):new Cf(n.data.map((e,t)=>e*i.data[t]+r.data[t]),n.typeInfo);const o=n,s=i,a=r;return new Sf(o.value*s.value+a.value,o.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>e-Math.floor(e)),n.typeInfo);const i=n;return new Sf(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,t){return console.error("TODO: frexp. Line ".concat(e.line)),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t),o=this.exec.evalExpression(e.args[3],t);if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return console.error("InsertBits() expects an i32 offset argument. Line ".concat(e.line)),null;const s=r.value,a=(1<<o.value)-1<<s,l=~a;if(n instanceof Cf&&i instanceof Cf)return new Cf(n.data.map((e,t)=>e&l|i.data[t]<<s&a),n.typeInfo);const c=n.value,u=i.value;return new Sf(c&l|u<<s&a,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>1/Math.sqrt(e)),n.typeInfo);const i=n;return new Sf(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,t){return console.error("TODO: ldexp. Line ".concat(e.line)),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf){let e=0;return n.data.forEach(t=>{e+=t*t}),new Sf(Math.sqrt(e),this.getTypeInfo("f32"))}const i=n;return new Sf(Math.abs(i.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.log(e)),n.typeInfo);const i=n;return new Sf(Math.log(i.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.log2(e)),n.typeInfo);const i=n;return new Sf(Math.log2(i.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Cf&&i instanceof Cf)return new Cf(n.data.map((e,t)=>Math.max(e,i.data[t])),n.typeInfo);const r=n,o=i;return new Sf(Math.max(r.value,o.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Cf&&i instanceof Cf)return new Cf(n.data.map((e,t)=>Math.min(e,i.data[t])),n.typeInfo);const r=n,o=i;return new Sf(Math.min(r.value,o.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Cf&&i instanceof Cf&&r instanceof Cf)return new Cf(n.data.map((e,t)=>n.data[t]*(1-r.data[t])+i.data[t]*r.data[t]),n.typeInfo);const o=i,s=r;return new Sf(n.value*(1-s.value)+o.value*s.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Cf&&i instanceof Cf)return new Cf(n.data.map((e,t)=>e%i.data[t]),n.typeInfo);const r=i;return new Sf(n.value%r.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf){const i=this.Length(e,t).value;return new Cf(n.data.map(e=>e/i),n.typeInfo)}return console.error("Normalize() expects a vector argument. Line ".concat(e.line)),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Cf&&i instanceof Cf)return new Cf(n.data.map((e,t)=>Math.pow(e,i.data[t])),n.typeInfo);const r=n,o=i;return new Sf(Math.pow(r.value,o.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Cf?new Cf(n.data.map(e=>e),n.typeInfo):new Sf(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Cf?new Cf(n.data.map(e=>e*Math.PI/180),n.typeInfo):new Sf(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Cf&&i instanceof Cf){const e=this._dot(n.data,i.data);return new Cf(n.data.map((t,n)=>t-2*e*i.data[n]),n.typeInfo)}return console.error("Reflect() expects vector arguments. Line ".concat(e.line)),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Cf&&i instanceof Cf&&r instanceof Sf){const e=this._dot(i.data,n.data);return new Cf(n.data.map((t,n)=>{const o=1-r.value*r.value*(1-e*e);if(o<0)return 0;const s=Math.sqrt(o);return r.value*t-(r.value*e+s)*i.data[n]}),n.typeInfo)}return console.error("Refract() expects vector arguments and a scalar argument. Line ".concat(e.line)),null}ReverseBits(e,t){return console.error("TODO: reverseBits. Line ".concat(e.line)),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.round(e)),n.typeInfo);const i=n;return new Sf(Math.round(i.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.min(Math.max(e,0),1)),n.typeInfo);const i=n;return new Sf(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.sign(e)),n.typeInfo);const i=n;return new Sf(Math.sign(i.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.sin(e)),n.typeInfo);const i=n;return new Sf(Math.sin(i.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.sinh(e)),n.typeInfo);const i=n;return new Sf(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,t,n){const i=Math.min(Math.max((n-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(r instanceof Cf&&n instanceof Cf&&i instanceof Cf)return new Cf(r.data.map((e,t)=>this._smoothstep(n.data[t],i.data[t],e)),r.typeInfo);const o=n,s=i,a=r;return new Sf(this._smoothstep(o.value,s.value,a.value),r.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.sqrt(e)),n.typeInfo);const i=n;return new Sf(Math.sqrt(i.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof Cf&&n instanceof Cf)return new Cf(i.data.map((e,t)=>e<n.data[t]?0:1),i.typeInfo);const r=n;return new Sf(i.value<r.value?0:1,r.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.tan(e)),n.typeInfo);const i=n;return new Sf(Math.tan(i.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.tanh(e)),n.typeInfo);const i=n;return new Sf(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):("mat4x4f"===t||"mat4x4h"===t||console.error("Invalid matrix type ".concat(t)),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof If))return console.error("Transpose() expects a matrix argument. Line ".concat(e.line)),null;const i=this._getTransposeType(n.typeInfo);if("mat2x2"===n.typeInfo.name||"mat2x2f"===n.typeInfo.name||"mat2x2h"===n.typeInfo.name){const e=n.data;return new If([e[0],e[2],e[1],e[3]],i)}if("mat2x3"===n.typeInfo.name||"mat2x3f"===n.typeInfo.name||"mat2x3h"===n.typeInfo.name){const e=n.data;return new If([e[0],e[3],e[6],e[1],e[4],e[7]],i)}if("mat2x4"===n.typeInfo.name||"mat2x4f"===n.typeInfo.name||"mat2x4h"===n.typeInfo.name){const e=n.data;return new If([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],i)}if("mat3x2"===n.typeInfo.name||"mat3x2f"===n.typeInfo.name||"mat3x2h"===n.typeInfo.name){const e=n.data;return new If([e[0],e[3],e[1],e[4],e[2],e[5]],i)}if("mat3x3"===n.typeInfo.name||"mat3x3f"===n.typeInfo.name||"mat3x3h"===n.typeInfo.name){const e=n.data;return new If([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],i)}if("mat3x4"===n.typeInfo.name||"mat3x4f"===n.typeInfo.name||"mat3x4h"===n.typeInfo.name){const e=n.data;return new If([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],i)}if("mat4x2"===n.typeInfo.name||"mat4x2f"===n.typeInfo.name||"mat4x2h"===n.typeInfo.name){const e=n.data;return new If([e[0],e[4],e[1],e[5],e[2],e[6]],i)}if("mat4x3"===n.typeInfo.name||"mat4x3f"===n.typeInfo.name||"mat4x3h"===n.typeInfo.name){const e=n.data;return new If([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],i)}if("mat4x4"===n.typeInfo.name||"mat4x4f"===n.typeInfo.name||"mat4x4h"===n.typeInfo.name){const e=n.data;return new If([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],i)}return console.error("Invalid matrix type ".concat(n.typeInfo.name)),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Cf)return new Cf(n.data.map(e=>Math.trunc(e)),n.typeInfo);const i=n;return new Sf(Math.trunc(i.value),n.typeInfo)}Dpdx(e,t){return console.error("TODO: dpdx. Line ".concat(e.line)),null}DpdxCoarse(e,t){return console.error("TODO: dpdxCoarse. Line ".concat(e.line)),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof af){const r=n.name,o=t.getVariableValue(r);if(o instanceof Pf){if(i<0||i>=o.mipLevelCount)return console.error("Invalid mip level for textureDimensions. Line ".concat(e.line)),null;const t=o.getMipLevelSize(i),n=o.dimension;return"1d"===n?new Sf(t[0],this.getTypeInfo("u32")):"3d"===n?new Cf(t,this.getTypeInfo("vec3u")):"2d"===n?new Cf(t.slice(0,2),this.getTypeInfo("vec2u")):(console.error("Invalid texture dimension ".concat(n," not found. Line ").concat(e.line)),null)}return console.error("Texture ".concat(r," not found. Line ").concat(e.line)),null}return console.error("Invalid texture argument for textureDimensions. Line ".concat(e.line)),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),r=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof Cf)||2!==i.data.length)return console.error("Invalid UV argument for textureLoad. Line ".concat(e.line)),null;if(n instanceof af){const o=n.name,s=t.getVariableValue(o);if(s instanceof Pf){const t=Math.floor(i.data[0]),n=Math.floor(i.data[1]);if(t<0||t>=s.width||n<0||n>=s.height)return console.error("Texture ".concat(o," out of bounds. Line ").concat(e.line)),null;const a=s.getPixel(t,n,0,r);return null===a?(console.error("Invalid texture format for textureLoad. Line ".concat(e.line)),null):new Cf(a,this.getTypeInfo("vec4f"))}return console.error("Texture ".concat(o," not found. Line ").concat(e.line)),null}return console.error("Invalid texture argument for textureLoad. Line ".concat(e.line)),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof af){const i=n.name,r=t.getVariableValue(i);return r instanceof Pf?new Sf(r.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error("Texture ".concat(i," not found. Line ").concat(e.line)),null)}return console.error("Invalid texture argument for textureNumLayers. Line ".concat(e.line)),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof af){const i=n.name,r=t.getVariableValue(i);return r instanceof Pf?new Sf(r.mipLevelCount,this.getTypeInfo("u32")):(console.error("Texture ".concat(i," not found. Line ").concat(e.line)),null)}return console.error("Invalid texture argument for textureNumLevels. Line ".concat(e.line)),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof af){const i=n.name,r=t.getVariableValue(i);return r instanceof Pf?new Sf(r.sampleCount,this.getTypeInfo("u32")):(console.error("Texture ".concat(i," not found. Line ").concat(e.line)),null)}return console.error("Invalid texture argument for textureNumSamples. Line ".concat(e.line)),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),r=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,o=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==o.length)return console.error("Invalid value argument for textureStore. Line ".concat(e.line)),null;if(!(i instanceof Cf)||2!==i.data.length)return console.error("Invalid UV argument for textureStore. Line ".concat(e.line)),null;if(n instanceof af){const s=n.name,a=t.getVariableValue(s);if(a instanceof Pf){const t=a.getMipLevelSize(0),n=Math.floor(i.data[0]),l=Math.floor(i.data[1]);return n<0||n>=t[0]||l<0||l>=t[1]?(console.error("Texture ".concat(s," out of bounds. Line ").concat(e.line)),null):(a.setPixel(n,l,0,r,Array.from(o)),null)}return console.error("Texture ".concat(s," not found. Line ").concat(e.line)),null}return console.error("Invalid texture argument for textureStore. Line ".concat(e.line)),null}AtomicLoad(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.getVariableName(n,t);return t.getVariable(i).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t);return a instanceof Sf&&s instanceof Sf&&(a.value=s.value),r.value instanceof Rf&&r.value.setDataValue(this.exec,a,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Sf(a.value,a.typeInfo);return a instanceof Sf&&s instanceof Sf&&(a.value+=s.value),r.value instanceof Rf&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicSub(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Sf(a.value,a.typeInfo);return a instanceof Sf&&s instanceof Sf&&(a.value-=s.value),r.value instanceof Rf&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMax(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Sf(a.value,a.typeInfo);return a instanceof Sf&&s instanceof Sf&&(a.value=Math.max(a.value,s.value)),r.value instanceof Rf&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMin(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Sf(a.value,a.typeInfo);return a instanceof Sf&&s instanceof Sf&&(a.value=Math.min(a.value,s.value)),r.value instanceof Rf&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicAnd(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Sf(a.value,a.typeInfo);return a instanceof Sf&&s instanceof Sf&&(a.value=a.value&s.value),r.value instanceof Rf&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicOr(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Sf(a.value,a.typeInfo);return a instanceof Sf&&s instanceof Sf&&(a.value=a.value|s.value),r.value instanceof Rf&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicXor(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Sf(a.value,a.typeInfo);return a instanceof Sf&&s instanceof Sf&&(a.value=a.value^s.value),r.value instanceof Rf&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicExchange(e,t){let n=e.args[0];n instanceof ff&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Sf(a.value,a.typeInfo);return a instanceof Sf&&s instanceof Sf&&(a.value=s.value),r.value instanceof Rf&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const np={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},ip={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class rp extends ep{constructor(e,t){var n;super(),this.ast=null!=e?e:[],this.reflection=new Yf,this.reflection.updateAST(this.ast),this.context=null!==(n=null==t?void 0:t.clone())&&void 0!==n?n:new $f,this.builtins=new tp(this),this.typeInfo={bool:this.getTypeInfo(Yd.bool),i32:this.getTypeInfo(Yd.i32),u32:this.getTypeInfo(Yd.u32),f32:this.getTypeInfo(Yd.f32),f16:this.getTypeInfo(Yd.f16),vec2f:this.getTypeInfo(Qd.vec2f),vec2u:this.getTypeInfo(Qd.vec2u),vec2i:this.getTypeInfo(Qd.vec2i),vec2h:this.getTypeInfo(Qd.vec2h),vec3f:this.getTypeInfo(Qd.vec3f),vec3u:this.getTypeInfo(Qd.vec3u),vec3i:this.getTypeInfo(Qd.vec3i),vec3h:this.getTypeInfo(Qd.vec3h),vec4f:this.getTypeInfo(Qd.vec4f),vec4u:this.getTypeInfo(Qd.vec4u),vec4i:this.getTypeInfo(Qd.vec4i),vec4h:this.getTypeInfo(Qd.vec4h),mat2x2f:this.getTypeInfo(Qd.mat2x2f),mat2x3f:this.getTypeInfo(Qd.mat2x3f),mat2x4f:this.getTypeInfo(Qd.mat2x4f),mat3x2f:this.getTypeInfo(Qd.mat3x2f),mat3x3f:this.getTypeInfo(Qd.mat3x3f),mat3x4f:this.getTypeInfo(Qd.mat3x4f),mat4x2f:this.getTypeInfo(Qd.mat4x2f),mat4x3f:this.getTypeInfo(Qd.mat4x3f),mat4x4f:this.getTypeInfo(Qd.mat4x4f)}}getVariableValue(e){var t,n;const i=null!==(n=null===(t=this.context.getVariable(e))||void 0===t?void 0:t.value)&&void 0!==n?n:null;if(null===i)return null;if(i instanceof Sf)return i.value;if(i instanceof Cf)return Array.from(i.data);if(i instanceof If)return Array.from(i.data);if(i instanceof Rf&&i.typeInfo instanceof Yh){if("u32"===i.typeInfo.format.name)return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if("i32"===i.typeInfo.format.name)return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if("f32"===i.typeInfo.format.name)return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error("Unsupported return variable type ".concat(i.typeInfo.name)),null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,i){const r=this.context.clone();(i=null!=i?i:{}).constants&&this._setOverrides(i.constants,r),this._execStatements(this.ast,r);const o=r.getFunction(e);if(!o)return void console.error("Function ".concat(e," not found"));if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return void console.error("Invalid dispatch count");1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const s=t[0],a=t[1],l=t[2],c=this.getTypeInfo("vec3u");r.setVariable("@num_workgroups",new Cf(t,c));for(const u in n)for(const e in n[u]){const t=n[u][e];r.variables.forEach(n=>{var i;const r=n.node;if(null==r?void 0:r.attributes){let o=null,s=null;for(const e of r.attributes)"binding"===e.name?o=e.value:"group"===e.name&&(s=e.value);if(e==o&&u==s)if(void 0!==t.texture&&void 0!==t.descriptor){const e=new Pf(t.texture,this.getTypeInfo(r.type),t.descriptor,null!==(i=t.texture.view)&&void 0!==i?i:null);n.value=e}else void 0!==t.uniform?n.value=new Rf(t.uniform,this.getTypeInfo(r.type)):n.value=new Rf(t,this.getTypeInfo(r.type))}})}for(let u=0;u<l;++u)for(let e=0;e<a;++e)for(let t=0;t<s;++t)r.setVariable("@workgroup_id",new Cf([t,e,u],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[t,e,u],r)}execStatement(e,t){if(e instanceof Vd)return this.evalExpression(e.value,t);if(e instanceof Xd){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof Sf))throw new Error("Invalid break-if condition");if(!n.value)return null}return rp._breakObj}if(e instanceof Zd)return rp._continueObj;if(e instanceof Id)this._let(e,t);else if(e instanceof Dd)this._var(e,t);else if(e instanceof Rd)this._const(e,t);else if(e instanceof wd)this._function(e,t);else{if(e instanceof Ud)return this._if(e,t);if(e instanceof Nd)return this._switch(e,t);if(e instanceof Sd)return this._for(e,t);if(e instanceof Td)return this._while(e,t);if(e instanceof zd)return this._loop(e,t);if(e instanceof Ad){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof Od)this._assign(e,t);else if(e instanceof kd)this._increment(e,t);else{if(e instanceof Jd)return null;if(e instanceof Cd){const n=e.name;null===t.getVariable(n)&&t.setVariable(n,new Sf(0,this.getTypeInfo("u32")))}else if(e instanceof Bd)this._call(e,t);else{if(e instanceof Hd)return null;if(e instanceof Wd)return null;console.error("Invalid statement type.",e,"Line ".concat(e.line))}}}return null}evalExpression(e,t){return e instanceof pf?this._evalBinaryOp(e,t):e instanceof cf?this._evalLiteral(e,t):e instanceof af?this._evalVariable(e,t):e instanceof sf?this._evalCall(e,t):e instanceof of?this._evalCreate(e,t):e instanceof lf?this._evalConst(e,t):e instanceof uf?this._evalBitcast(e,t):e instanceof ff?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,"Line ".concat(e.line)),null)}getTypeInfo(e){var t;if(e instanceof Yd){const t=this.reflection.getTypeInfo(e);if(null!==t)return t}let n=null!==(t=this.typeInfo[e])&&void 0!==t?t:null;return null!==n||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const i=e[n],r=this.reflection.getOverrideInfo(n);null!==r?(null===r.type&&(r.type=this.getTypeInfo("u32")),"u32"===r.type.name||"i32"===r.type.name||"f32"===r.type.name||"f16"===r.type.name?t.setVariable(n,new Sf(i,r.type)):"bool"===r.type.name?t.setVariable(n,new Sf(i?1:0,r.type)):"vec2"===r.type.name||"vec3"===r.type.name||"vec4"===r.type.name||"vec2f"===r.type.name||"vec3f"===r.type.name||"vec4f"===r.type.name||"vec2i"===r.type.name||"vec3i"===r.type.name||"vec4i"===r.type.name||"vec2u"===r.type.name||"vec3u"===r.type.name||"vec4u"===r.type.name||"vec2h"===r.type.name||"vec3h"===r.type.name||"vec4h"===r.type.name?t.setVariable(n,new Cf(i,r.type)):console.error("Invalid constant type for ".concat(n))):console.error("Override ".concat(n," does not exist in the shader."))}}_dispatchWorkgroup(e,t,n){const i=[1,1,1];for(const c of e.node.attributes)if("workgroup_size"===c.name){if(c.value.length>0){const e=n.getVariableValue(c.value[0]);i[0]=e instanceof Sf?e.value:parseInt(c.value[0])}if(c.value.length>1){const e=n.getVariableValue(c.value[1]);i[1]=e instanceof Sf?e.value:parseInt(c.value[1])}if(c.value.length>2){const e=n.getVariableValue(c.value[2]);i[2]=e instanceof Sf?e.value:parseInt(c.value[2])}}const r=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Cf(i,r));const s=i[0],a=i[1],l=i[2];for(let c=0,u=0;c<l;++c)for(let l=0;l<a;++l)for(let a=0;a<s;++a,++u){const s=[a,l,c],h=[a+t[0]*i[0],l+t[1]*i[1],c+t[2]*i[2]];n.setVariable("@local_invocation_id",new Cf(s,r)),n.setVariable("@global_invocation_id",new Cf(h,r)),n.setVariable("@local_invocation_index",new Sf(u,o)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const e of n.attributes)if("builtin"===e.name){const i="@".concat(e.value),r=t.getVariable(i);void 0!==r&&t.variables.set(n.name,r)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof ff;)e=e.right;return e instanceof af?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const e=t.clone(),i=this._execStatements(n,e);if(i)return i;continue}const e=this.execStatement(n,t);if(e)return e}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let t=0;t<i.node.args.length;++t){const r=i.node.args[t],o=this.evalExpression(e.args[t],n);n.setVariable(r.name,o,r)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);i?"++"===e.operator?i.value instanceof Sf?i.value.value++:console.error("Variable ".concat(n," is not a scalar. Line ").concat(e.line)):"--"===e.operator?i.value instanceof Sf?i.value.value--:console.error("Variable ".concat(n," is not a scalar. Line ").concat(e.line)):console.error("Unknown increment operator ".concat(e.operator,". Line ").concat(e.line)):console.error("Variable ".concat(n," not found. Line ").concat(e.line))}_getVariableData(e,t){if(e instanceof af){const n=this.getVariableName(e,t),i=t.getVariable(n);return null===i?(console.error("Variable ".concat(n," not found. Line ").concat(e.line)),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof ff){if("*"===e.operator){const n=this._getVariableData(e.right,t);return n instanceof Af?n.reference.getSubData(this,e.postfix,t):(console.error("Variable ".concat(e.right," is not a pointer. Line ").concat(e.line)),null)}if("&"===e.operator){const n=this._getVariableData(e.right,t);return new Af(n)}}return null}_assign(e,t){let n=null,i="<var>",r=null;if(e.variable instanceof ff){const n=this._getVariableData(e.variable,t),i=this.evalExpression(e.value,t),r=e.operator;if("="===r){if(n instanceof Sf||n instanceof Cf||n instanceof If){if(i instanceof Sf||i instanceof Cf||i instanceof If&&n.data.length===i.data.length)return void n.data.set(i.data);console.error("Invalid assignment. Line ".concat(e.line))}else if(n instanceof Rf&&i instanceof Rf&&n.buffer.byteLength-n.offset>=i.buffer.byteLength-i.offset)return void(n.buffer.byteLength%4==0?new Uint32Array(n.buffer,n.offset,n.typeInfo.size/4).set(new Uint32Array(i.buffer,i.offset,i.typeInfo.size/4)):new Uint8Array(n.buffer,n.offset,n.typeInfo.size).set(new Uint8Array(i.buffer,i.offset,i.typeInfo.size)));return console.error("Invalid assignment. Line ".concat(e.line)),null}if("+="===r)return n instanceof Sf||n instanceof Cf||n instanceof If?i instanceof Sf||i instanceof Cf||i instanceof If?void n.data.set(i.data.map((e,t)=>n.data[t]+e)):void console.error("Invalid assignment . Line ".concat(e.line)):void console.error("Invalid assignment. Line ".concat(e.line));if("-="===r)return(n instanceof Sf||n instanceof Cf||n instanceof If)&&(i instanceof Sf||i instanceof Cf||i instanceof If)?void n.data.set(i.data.map((e,t)=>n.data[t]-e)):void console.error("Invalid assignment. Line ".concat(e.line))}if(e.variable instanceof ff){if("*"===e.variable.operator){i=this.getVariableName(e.variable.right,t);const r=t.getVariable(i);if(!(r&&r.value instanceof Af))return void console.error("Variable ".concat(i," is not a pointer. Line ").concat(e.line));n=r.value.reference;let o=e.variable.postfix;if(!o){let t=e.variable.right;for(;t instanceof ff;){if(t.postfix){o=t.postfix;break}t=t.right}}o&&(n=n.getSubData(this,o,t))}}else{r=e.variable.postfix,i=this.getVariableName(e.variable,t);const o=t.getVariable(i);if(null===o)return void console.error("Variable ".concat(i," not found. Line ").concat(e.line));n=o.value}if(n instanceof Af&&(n=n.reference),null===n)return void console.error("Variable ".concat(i," not found. Line ").concat(e.line));const o=this.evalExpression(e.value,t),s=e.operator;if("="===s)if(n instanceof Rf)n.setDataValue(this,o,r,t);else if(r){if(!(n instanceof Cf||n instanceof If))return void console.error("Variable ".concat(i," is not a vector or matrix. Line ").concat(e.line));if(r instanceof hf){const s=this.evalExpression(r.index,t).value;if(n instanceof Cf){if(!(o instanceof Sf))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));n.data[s]=o.value}else{if(!(n instanceof If))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));{const s=this.evalExpression(r.index,t).value;if(s<0)return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));if(!(o instanceof Cf))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));{const t=n.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(s<2&&2===o.data.length))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));n.data[2*s]=o.data[0],n.data[2*s+1]=o.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(s<2&&3===o.data.length))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));n.data[3*s]=o.data[0],n.data[3*s+1]=o.data[1],n.data[3*s+2]=o.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(s<2&&4===o.data.length))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));n.data[4*s]=o.data[0],n.data[4*s+1]=o.data[1],n.data[4*s+2]=o.data[2],n.data[4*s+3]=o.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(s<3&&2===o.data.length))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));n.data[2*s]=o.data[0],n.data[2*s+1]=o.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(s<3&&3===o.data.length))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));n.data[3*s]=o.data[0],n.data[3*s+1]=o.data[1],n.data[3*s+2]=o.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(s<3&&4===o.data.length))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));n.data[4*s]=o.data[0],n.data[4*s+1]=o.data[1],n.data[4*s+2]=o.data[2],n.data[4*s+3]=o.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(s<4&&2===o.data.length))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));n.data[2*s]=o.data[0],n.data[2*s+1]=o.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(s<4&&3===o.data.length))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));n.data[3*s]=o.data[0],n.data[3*s+1]=o.data[1],n.data[3*s+2]=o.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t)return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));if(!(s<4&&4===o.data.length))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));n.data[4*s]=o.data[0],n.data[4*s+1]=o.data[1],n.data[4*s+2]=o.data[2],n.data[4*s+3]=o.data[3]}}}}}else if(r instanceof rf){const t=r.value;if(!(n instanceof Cf))return void console.error("Invalid assignment to ".concat(t,". Variable ").concat(i," is not a vector. Line ").concat(e.line));if(o instanceof Sf){if(t.length>1)return void console.error("Invalid assignment to ".concat(t," for variable ").concat(i,". Line ").concat(e.line));if("x"===t)n.data[0]=o.value;else if("y"===t){if(n.data.length<2)return void console.error("Invalid assignment to ".concat(t," for variable ").concat(i,". Line ").concat(e.line));n.data[1]=o.value}else if("z"===t){if(n.data.length<3)return void console.error("Invalid assignment to ".concat(t," for variable ").concat(i,". Line ").concat(e.line));n.data[2]=o.value}else if("w"===t){if(n.data.length<4)return void console.error("Invalid assignment to ".concat(t," for variable ").concat(i,". Line ").concat(e.line));n.data[3]=o.value}}else{if(!(o instanceof Cf))return void console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));if(t.length!==o.data.length)return void console.error("Invalid assignment to ".concat(t," for variable ").concat(i,". Line ").concat(e.line));for(let r=0;r<t.length;++r){const s=t[r];if("x"===s||"r"===s)n.data[0]=o.data[r];else if("y"===s||"g"===s){if(o.data.length<2)return void console.error("Invalid assignment to ".concat(s," for variable ").concat(i,". Line ").concat(e.line));n.data[1]=o.data[r]}else if("z"===s||"b"===s){if(o.data.length<3)return void console.error("Invalid assignment to ".concat(s," for variable ").concat(i,". Line ").concat(e.line));n.data[2]=o.data[r]}else{if("w"!==s&&"a"!==s)return void console.error("Invalid assignment to ".concat(s," for variable ").concat(i,". Line ").concat(e.line));if(o.data.length<4)return void console.error("Invalid assignment to ".concat(s," for variable ").concat(i,". Line ").concat(e.line));n.data[3]=o.data[r]}}}}}else n instanceof Sf&&o instanceof Sf?n.value=o.value:n instanceof Cf&&o instanceof Cf||n instanceof If&&o instanceof If?n.data.set(o.data):console.error("Invalid assignment to ".concat(i,". Line ").concat(e.line));else{const i=n.getSubData(this,r,t);if(i instanceof Cf&&o instanceof Sf){const t=i.data,n=o.value;if("+="===s)for(let e=0;e<t.length;++e)t[e]+=n;else if("-="===s)for(let e=0;e<t.length;++e)t[e]-=n;else if("*="===s)for(let e=0;e<t.length;++e)t[e]*=n;else if("/="===s)for(let e=0;e<t.length;++e)t[e]/=n;else if("%="===s)for(let e=0;e<t.length;++e)t[e]%=n;else if("&="===s)for(let e=0;e<t.length;++e)t[e]&=n;else if("|="===s)for(let e=0;e<t.length;++e)t[e]|=n;else if("^="===s)for(let e=0;e<t.length;++e)t[e]^=n;else if("<<="===s)for(let e=0;e<t.length;++e)t[e]<<=n;else if(">>="===s)for(let e=0;e<t.length;++e)t[e]>>=n;else console.error("Invalid operator ".concat(s,". Line ").concat(e.line))}else if(i instanceof Cf&&o instanceof Cf){const t=i.data,n=o.data;if(t.length!==n.length)return void console.error("Vector length mismatch. Line ".concat(e.line));if("+="===s)for(let e=0;e<t.length;++e)t[e]+=n[e];else if("-="===s)for(let e=0;e<t.length;++e)t[e]-=n[e];else if("*="===s)for(let e=0;e<t.length;++e)t[e]*=n[e];else if("/="===s)for(let e=0;e<t.length;++e)t[e]/=n[e];else if("%="===s)for(let e=0;e<t.length;++e)t[e]%=n[e];else if("&="===s)for(let e=0;e<t.length;++e)t[e]&=n[e];else if("|="===s)for(let e=0;e<t.length;++e)t[e]|=n[e];else if("^="===s)for(let e=0;e<t.length;++e)t[e]^=n[e];else if("<<="===s)for(let e=0;e<t.length;++e)t[e]<<=n[e];else if(">>="===s)for(let e=0;e<t.length;++e)t[e]>>=n[e];else console.error("Invalid operator ".concat(s,". Line ").concat(e.line))}else{if(!(i instanceof Sf&&o instanceof Sf))return void console.error("Invalid type for ".concat(e.operator," operator. Line ").concat(e.line));"+="===s?i.value+=o.value:"-="===s?i.value-=o.value:"*="===s?i.value*=o.value:"/="===s?i.value/=o.value:"%="===s?i.value%=o.value:"&="===s?i.value&=o.value:"|="===s?i.value|=o.value:"^="===s?i.value^=o.value:"<<="===s?i.value<<=o.value:">>="===s?i.value>>=o.value:console.error("Invalid operator ".concat(s,". Line ").concat(e.line))}n instanceof Rf&&n.setDataValue(this,i,r,t)}}_function(e,t){const n=new Qf(e);t.functions.set(e.name,n)}_const(e,t){let n=null;null!==e.value&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return void console.error("Invalid value for variable ".concat(e.name,". Line ").concat(e.line));e.value instanceof ff||(n=n.clone())}else{const i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||"array"===i){const i=new of(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return void console.error("Invalid value for variable ".concat(e.name,". Line ").concat(e.line));e.value instanceof ff||(n=n.clone())}else{if(null===e.type)return void console.error("Variable ".concat(e.name," has no type. Line ").concat(e.line));const i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||e.type instanceof ef||e.type instanceof Jd||e.type instanceof Qd){const i=new of(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Sf))return console.error("Invalid if condition. Line ".concat(e.line)),null;let i=null;for(const r of e.cases)if(r instanceof _f)for(const o of r.selectors){if(o instanceof gf){i=r;continue}const s=this.evalExpression(o,t);if(!(s instanceof Sf))return console.error("Invalid case selector. Line ".concat(e.line)),null;if(s.value===n.value)return this._execStatements(r.body,t)}else r instanceof yf&&(i=r);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Sf))return console.error("Invalid if condition. Line ".concat(e.line)),null;if(n.value)return this._execStatements(e.body,t);for(const i of e.elseif){const n=this.evalExpression(i.condition,t);if(!(n instanceof Sf))return console.error("Invalid if condition. Line ".concat(e.line)),null;if(n.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof Sf?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===rp._breakObj)break;if(null!==n&&n!==rp._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===rp._breakObj)break;if(n===rp._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===rp._breakObj)break}else if(null!==n)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===rp._breakObj)break;if(n!==rp._continueObj&&null!==n)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),i=e.type;if(n instanceof Sf){const e=qf(n.value,n.typeInfo.name,i.name);return new Sf(e,this.getTypeInfo(i))}if(n instanceof Cf){const t=n.typeInfo.getTypeName();let r="";if(t.endsWith("f"))r="f32";else if(t.endsWith("i"))r="i32";else if(t.endsWith("u"))r="u32";else if(t.endsWith("b"))r="bool";else{if(!t.endsWith("h"))return console.error("Unknown vector type ".concat(t,". Line ").concat(e.line)),null;r="f16"}const o=i.getTypeName();let s="";if(o.endsWith("f"))s="f32";else if(o.endsWith("i"))s="i32";else if(o.endsWith("u"))s="u32";else if(o.endsWith("b"))s="bool";else{if(!o.endsWith("h"))return console.error("Unknown vector type ".concat(s,". Line ").concat(e.line)),null;s="f16"}const a=function(e,t,n){if(t===n)return e;const i=new Array(e.length);for(let r=0;r<e.length;r++)i[r]=qf(e[r],t,n);return i}(Array.from(n.data),r,s);return new Cf(a,this.getTypeInfo(i))}return console.error("TODO: bitcast for ".concat(n.typeInfo.name,". Line ").concat(e.line)),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof of){if(null===e.type)return Tf.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const i=e instanceof of?e.type.name:e.name,r=e instanceof of?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===r)return console.error("Unknown type ".concat(i,". Line ").concat(e.line)),null;if(0===r.size)return null;const o=new Rf(new ArrayBuffer(r.size),r,0);if(r instanceof Zh){if(e.args)for(let s=0;s<e.args.length;++s){const n=r.members[s],i=e.args[s],a=this.evalExpression(i,t);o.setData(this,a,n.type,n.offset,t)}}else if(r instanceof Yh){let i=0;if(e.args)for(let s=0;s<e.args.length;++s){const a=e.args[s],l=this.evalExpression(a,t);null===r.format&&("x32"===(null===(n=l.typeInfo)||void 0===n?void 0:n.name)?r.format=this.getTypeInfo("i32"):r.format=l.typeInfo),o.setData(this,l,r.format,i,t),i+=r.stride}}else console.error('Unknown type "'.concat(i,'". Line ').concat(e.line));return e instanceof of?o.getSubData(this,e.postfix,t):o}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),i=n.name;return"x32"===i||"u32"===i||"f32"===i||"f16"===i||"i32"===i||"bool"===i?new Sf(e.scalarValue,n):"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i?this._callConstructorVec(e,t):"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return null===n?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const i=rp._priority.get(t.name);rp._priority.get(e[n].name)<i&&(t=e[n])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if("&"===e.operator)return new Af(n);if("*"===e.operator)return n instanceof Af?n.reference.getSubData(this,e.postfix,t):(console.error("Invalid dereference. Line ".concat(e.line)),null);const i=n instanceof Sf?n.value:n instanceof Cf?Array.from(n.data):null;switch(e.operator){case"+":{if(Of(i)){const e=i.map((e,t)=>+e);return new Cf(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Sf(+e,t)}case"-":{if(Of(i)){const e=i.map((e,t)=>-e);return new Cf(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Sf(-e,t)}case"!":{if(Of(i)){const e=i.map((e,t)=>e?0:1);return new Cf(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Sf(e?0:1,t)}case"~":{if(Of(i)){const e=i.map((e,t)=>~e);return new Cf(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Sf(~e,t)}}return console.error("Invalid unary operator ".concat(e.operator,". Line ").concat(e.line)),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),r=n instanceof Sf?n.value:n instanceof Cf||n instanceof If?Array.from(n.data):null,o=i instanceof Sf?i.value:i instanceof Cf||i instanceof If?Array.from(i.data):null;switch(e.operator){case"+":{if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e+i[t]);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t+e);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e+t);return new Cf(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Sf(t+s,a)}case"-":{if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e-i[t]);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t-e);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e-t);return new Cf(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Sf(t-s,a)}case"*":{if(Of(r)&&Of(o)){const t=r,s=o;if(n instanceof If&&i instanceof If){const r=function(e,t,n,i){if(void 0===ip[t.name]||void 0===ip[i.name])return null;const r=ip[t.name][0],o=ip[t.name][1],s=ip[i.name][0];if(r!==ip[i.name][1])return null;const a=new Array(s*o);for(let l=0;l<o;l++)for(let t=0;t<s;t++){let i=0;for(let s=0;s<r;s++)i+=e[s*o+l]*n[t*r+s];a[l*s+t]=i}return a}(t,n.typeInfo,s,i.typeInfo);if(null===r)return console.error("Matrix multiplication failed. Line ".concat(e.line,".")),null;const o=ip[i.typeInfo.name][0],a=ip[n.typeInfo.name][1],l=this.getTypeInfo("mat".concat(o,"x").concat(a,"f"));return new If(r,l)}if(n instanceof If&&i instanceof Cf){const r=function(e,t,n,i){if(void 0===ip[t.name]||void 0===np[i.name])return null;const r=ip[t.name][0],o=ip[t.name][1];if(r!==n.length)return null;const s=new Array(o);for(let a=0;a<o;a++){let t=0;for(let i=0;i<r;i++)t+=e[i*o+a]*n[i];s[a]=t}return s}(t,n.typeInfo,s,i.typeInfo);return null===r?(console.error("Matrix vector multiplication failed. Line ".concat(e.line,".")),null):new Cf(r,i.typeInfo)}if(n instanceof Cf&&i instanceof If){const r=function(e,t,n,i){if(void 0===np[t.name]||void 0===ip[i.name])return null;const r=ip[i.name][0],o=ip[i.name][1];if(o!==e.length)return null;const s=[];for(let a=0;a<r;a++){let t=0;for(let i=0;i<o;i++)t+=e[i]*n[i*r+a];s[a]=t}return s}(t,n.typeInfo,s,i.typeInfo);return null===r?(console.error("Matrix vector multiplication failed. Line ".concat(e.line,".")),null):new Cf(r,n.typeInfo)}{if(t.length!==s.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const i=t.map((e,t)=>e*s[t]);return new Cf(i,n.typeInfo)}}if(Of(r)){const e=o,t=r.map((t,n)=>t*e);return n instanceof If?new If(t,n.typeInfo):new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e*t);return i instanceof If?new If(t,i.typeInfo):new Cf(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Sf(t*s,a)}case"%":{if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e%i[t]);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t%e);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e%t);return new Cf(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Sf(t%s,a)}case"/":{if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e/i[t]);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t/e);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e/t);return new Cf(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Sf(t/s,a)}case"&":{if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e&i[t]);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t&e);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e&t);return new Cf(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Sf(t&s,a)}case"|":{if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e|i[t]);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t|e);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e|t);return new Cf(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Sf(t|s,a)}case"^":{if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e^i[t]);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t^e);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e^t);return new Cf(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Sf(t^s,a)}case"<<":{if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e<<i[t]);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t<<e);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e<<t);return new Cf(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Sf(t<<s,a)}case">>":{if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e>>i[t]);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t>>e);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e>>t);return new Cf(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Sf(t>>s,a)}case">":if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e>i[t]?1:0);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t>e?1:0);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e>t?1:0);return new Cf(t,i.typeInfo)}return new Sf(r>o?1:0,this.getTypeInfo("bool"));case"<":if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e<i[t]?1:0);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t<e?1:0);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e<t?1:0);return new Cf(t,i.typeInfo)}return new Sf(r<o?1:0,this.getTypeInfo("bool"));case"==":if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e===i[t]?1:0);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t==e?1:0);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e==t?1:0);return new Cf(t,i.typeInfo)}return new Sf(r===o?1:0,this.getTypeInfo("bool"));case"!=":if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e!==i[t]?1:0);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t!==e?1:0);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e!==t?1:0);return new Cf(t,i.typeInfo)}return new Sf(r!==o?1:0,this.getTypeInfo("bool"));case">=":if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e>=i[t]?1:0);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t>=e?1:0);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e>=t?1:0);return new Cf(t,i.typeInfo)}return new Sf(r>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e<=i[t]?1:0);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t<=e?1:0);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e<=t?1:0);return new Cf(t,i.typeInfo)}return new Sf(r<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e&&i[t]?1:0);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t&&e?1:0);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e&&t?1:0);return new Cf(t,i.typeInfo)}return new Sf(r&&o?1:0,this.getTypeInfo("bool"));case"||":if(Of(r)&&Of(o)){const t=r,i=o;if(t.length!==i.length)return console.error("Vector length mismatch. Line ".concat(e.line,".")),null;const s=t.map((e,t)=>e||i[t]?1:0);return new Cf(s,n.typeInfo)}if(Of(r)){const e=o,t=r.map((t,n)=>t||e?1:0);return new Cf(t,n.typeInfo)}if(Of(o)){const e=r,t=o.map((t,n)=>e||t?1:0);return new Cf(t,i.typeInfo)}return new Sf(r||o?1:0,this.getTypeInfo("bool"))}return console.error("Unknown operator ".concat(e.operator,". Line ").concat(e.line)),null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error('Unknown function "'.concat(e.name,'". Line ').concat(e.line)),null);for(let r=0;r<i.node.args.length;++r){const t=i.node.args[r],o=this.evalExpression(e.args[r],n);n.createVariable(t.name,o,t)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const i=t.clone();for(let t=0;t<n.node.args.length;++t){const r=n.node.args[t],o=this.evalExpression(e.args[t],i);i.setVariable(r.name,o,r)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new Sf(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),r=np[i];if(void 0===r)return console.error("Invalid vec constructor ".concat(i,". Line ").concat(e.line)),null;const o=[];if(e instanceof cf)if(e.isVector){const t=e.vectorValue;for(const e of t)o.push(e)}else o.push(e.scalarValue);else if(e.args)for(const s of e.args){const e=this.evalExpression(s,t);if(e instanceof Cf){const t=e.data;for(let e=0;e<t.length;++e){let n=t[e];o.push(n)}}else if(e instanceof Sf){let t=e.value;o.push(t)}}if(e.type instanceof Qd&&null===e.type.format&&(e.type.format=Qd.f32),0===o.length){const i=new Array(r).fill(0);return new Cf(i,n).getSubData(this,e.postfix,t)}if(1===o.length)for(;o.length<r;)o.push(o[0]);return o.length<r?(console.error("Invalid vec constructor. Line ".concat(e.line)),null):new Cf(o.length>r?o.slice(0,r):o,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),r=ip[i];if(void 0===r)return console.error("Invalid matrix constructor ".concat(i,". Line ").concat(e.line)),null;const o=[];if(e instanceof cf)if(e.isVector){const t=e.vectorValue;for(const e of t)o.push(e)}else o.push(e.scalarValue);else if(e.args)for(const s of e.args){const e=this.evalExpression(s,t);e instanceof Cf?o.push(...e.data):e instanceof Sf?o.push(e.value):e instanceof If&&o.push(...e.data)}if(n instanceof Jh&&null===n.format&&(n.format=this.getTypeInfo("f32")),0===o.length){const i=new Array(r[2]).fill(0);return new If(i,n).getSubData(this,e.postfix,t)}return o.length!==r[2]?(console.error("Invalid matrix constructor. Line ".concat(e.line)),null):new If(o,n).getSubData(this,e.postfix,t)}}rp._breakObj=new Ef(new qh("BREAK",null),null),rp._continueObj=new Ef(new qh("CONTINUE",null),null),rp._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class op{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class sp{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new op,this._exec=new rp,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(const t of this._deferArrayCountEval){const n=t.arrayType,i=t.countNode;if(i instanceof af){const t=i.name,r=this._context.constants.get(t);if(r)try{const e=r.constEvaluate(this._exec);n.count=e}catch(e){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of t)n.search(e=>{e instanceof bf||e instanceof $d?e.type=this._forwardType(e.type):e instanceof ef?e.format=this._forwardType(e.format):e instanceof Dd||e instanceof Id||e instanceof Rd?e.type=this._forwardType(e.type):e instanceof wd?e.returnType=this._forwardType(e.returnType):e instanceof vf&&(e.type=this._forwardType(e.type))});return t}_forwardType(e){if(e instanceof Kd){const t=this._getType(e.name);if(t)return t}else e instanceof $d?e.type=this._forwardType(e.type):e instanceof ef&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){const t=new kf(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>"".concat(t)}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Ff.eof}_match(e){if(e instanceof Mf)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),"".concat(t,". Line:").concat(this._currentLine))}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let i=!1;for(const t of e){if(n===t)return!0;t===Ff.tokens.name&&(i=!0)}if(i){const e=Ff.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Ff.tokens.name){const e=Ff.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!==(t=null===(e=this._peek())||void 0===e?void 0:e.line)&&void 0!==t?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Ff.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Ff.keywords.alias)){const e=this._type_alias();return this._consume(Ff.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Ff.keywords.diagnostic)){const e=this._diagnostic();return this._consume(Ff.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Ff.keywords.requires)){const e=this._requires_directive();return this._consume(Ff.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Ff.keywords.enable)){const e=this._enable_directive();return this._consume(Ff.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const e=this._attribute();if(this._check(Ff.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(Ff.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ff.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(Ff.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ff.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(Ff.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ff.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(Ff.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ff.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Ff.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Ff.keywords.fn))return null;const e=this._currentLine,t=this._consume(Ff.tokens.ident,"Expected function name.").toString();this._consume(Ff.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Ff.tokens.paren_right))do{if(this._check(Ff.tokens.paren_right))break;const e=this._attribute(),t=this._consume(Ff.tokens.name,"Expected argument name.").toString();this._consume(Ff.tokens.colon,"Expected ':' for argument type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i,n.push(this._updateNode(new vf(t,r,e))))}while(this._match(Ff.tokens.comma));this._consume(Ff.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(Ff.tokens.arrow)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}const r=this._compound_statement(),o=this._currentLine;return this._updateNode(new wd(t,n,i,r,e,o),e)}_compound_statement(){const e=[];for(this._consume(Ff.tokens.brace_left,"Expected '{' for block.");!this._check(Ff.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(Ff.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Ff.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Ff.tokens.attr)&&this._attribute(),this._check(Ff.keywords.if))return this._if_statement();if(this._check(Ff.keywords.switch))return this._switch_statement();if(this._check(Ff.keywords.loop))return this._loop_statement();if(this._check(Ff.keywords.for))return this._for_statement();if(this._check(Ff.keywords.while))return this._while_statement();if(this._check(Ff.keywords.continuing))return this._continuing_statement();if(this._check(Ff.keywords.static_assert))return this._static_assert_statement();if(this._check(Ff.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Ff.keywords.return))e=this._return_statement();else if(this._check([Ff.keywords.var,Ff.keywords.let,Ff.keywords.const]))e=this._variable_statement();else if(this._match(Ff.keywords.discard))e=this._updateNode(new qd);else if(this._match(Ff.keywords.break)){const t=this._updateNode(new Xd);if(this._currentLoop.length>0){const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t,this._check(Ff.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(Ff.keywords.continue)){const t=this._updateNode(new Zd);if(!(this._currentLoop.length>0))throw this._error(this._peek(),"Continue statement must be inside a loop. Line: ".concat(t.line));{const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(Ff.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Ff.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new Ed(t),e)}_while_statement(){if(!this._match(Ff.keywords.while))return null;const e=this._updateNode(new Td(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Ff.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Ff.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new Ad(n,e),t)}_for_statement(){if(!this._match(Ff.keywords.for))return null;this._consume(Ff.tokens.paren_left,"Expected '('.");const e=this._updateNode(new Sd(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Ff.tokens.semicolon)?null:this._for_init(),this._consume(Ff.tokens.semicolon,"Expected ';'."),e.condition=this._check(Ff.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Ff.tokens.semicolon,"Expected ';'."),e.increment=this._check(Ff.tokens.paren_right)?null:this._for_increment(),this._consume(Ff.tokens.paren_right,"Expected ')'."),this._check(Ff.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Ff.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Ff.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Dd(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(Ff.keywords.let)){const e=this._currentLine,t=this._consume(Ff.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(Ff.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(Ff.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new Id(t,n,null,null,i),e)}if(this._match(Ff.keywords.const)){const e=this._currentLine,t=this._consume(Ff.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(Ff.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(Ff.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return null===n&&i instanceof cf&&(n=i.type),this._updateNode(new Rd(t,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(Ff.increment_operators))return this._current=e,null;const n=this._consume(Ff.increment_operators,"Expected increment operator");return this._updateNode(new kd(n.type===Ff.tokens.plus_plus?Pd.increment:Pd.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(Ff.tokens.brace_right))return null;let n=this._match(Ff.tokens.underscore);if(n||(e=this._unary_expression()),!n&&null==e)return null;const i=this._consume(Ff.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return this._updateNode(new Od(Md.parse(i.lexeme),e,r),t)}_func_call_statement(){if(!this._check(Ff.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(Ff.tokens.ident,"Expected function name."),i=this._argument_expression_list();return null===i?(this._current=t,null):this._updateNode(new Bd(n.lexeme,i),e)}_loop_statement(){if(!this._match(Ff.keywords.loop))return null;this._check(Ff.tokens.attr)&&this._attribute(),this._consume(Ff.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new zd([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof Ad){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Ff.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Ff.keywords.switch))return null;const e=this._updateNode(new Nd(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Ff.tokens.attr)&&this._attribute(),this._consume(Ff.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Ff.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([Ff.keywords.default,Ff.keywords.case]);){if(this._match(Ff.keywords.case)){const n=this._case_selectors();for(const e of n)if(e instanceof gf){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Ff.tokens.colon),this._check(Ff.tokens.attr)&&this._attribute(),this._consume(Ff.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(Ff.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new _f(n,i)))}if(this._match(Ff.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Ff.tokens.colon),this._check(Ff.tokens.attr)&&this._attribute(),this._consume(Ff.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Ff.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new yf(n)))}}return e}_case_selectors(){const e=[];for(this._match(Ff.keywords.default)?e.push(this._updateNode(new gf)):e.push(this._shift_expression());this._match(Ff.tokens.comma);)this._match(Ff.keywords.default)?e.push(this._updateNode(new gf)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Ff.keywords.fallthrough))return this._consume(Ff.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(Ff.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(Ff.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(Ff.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let r=null;return this._match(Ff.keywords.else)&&(this._check(Ff.tokens.attr)&&this._attribute(),r=this._compound_statement()),this._updateNode(new Ud(t,n,i,r),e)}_match_elseif(){return this._tokens[this._current].type===Ff.keywords.else&&this._tokens[this._current+1].type===Ff.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new xf(t,n))),this._match_elseif()&&(this._check(Ff.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Ff.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new Vd(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Ff.tokens.or_or);)e=this._updateNode(new pf(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Ff.tokens.and_and);)e=this._updateNode(new pf(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Ff.tokens.or);)e=this._updateNode(new pf(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Ff.tokens.xor);)e=this._updateNode(new pf(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Ff.tokens.and);)e=this._updateNode(new pf(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Ff.tokens.equal_equal,Ff.tokens.not_equal])?this._updateNode(new pf(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Ff.tokens.less_than,Ff.tokens.greater_than,Ff.tokens.less_than_equal,Ff.tokens.greater_than_equal]);)e=this._updateNode(new pf(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Ff.tokens.shift_left,Ff.tokens.shift_right]);)e=this._updateNode(new pf(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Ff.tokens.plus,Ff.tokens.minus]);)e=this._updateNode(new pf(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Ff.tokens.star,Ff.tokens.forward_slash,Ff.tokens.modulo]);)e=this._updateNode(new pf(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Ff.tokens.minus,Ff.tokens.bang,Ff.tokens.tilde,Ff.tokens.star,Ff.tokens.and])?this._updateNode(new ff(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Ff.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Ff.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new hf(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(Ff.tokens.period)){const e=this._consume(Ff.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new rf(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return Yd.void;case"bool":return Yd.bool;case"i32":return Yd.i32;case"u32":return Yd.u32;case"f32":return Yd.f32;case"f16":return Yd.f16;case"vec2f":return Qd.vec2f;case"vec3f":return Qd.vec3f;case"vec4f":return Qd.vec4f;case"vec2i":return Qd.vec2i;case"vec3i":return Qd.vec3i;case"vec4i":return Qd.vec4i;case"vec2u":return Qd.vec2u;case"vec3u":return Qd.vec3u;case"vec4u":return Qd.vec4u;case"vec2h":return Qd.vec2h;case"vec3h":return Qd.vec3h;case"vec4h":return Qd.vec4h;case"mat2x2f":return Qd.mat2x2f;case"mat2x3f":return Qd.mat2x3f;case"mat2x4f":return Qd.mat2x4f;case"mat3x2f":return Qd.mat3x2f;case"mat3x3f":return Qd.mat3x3f;case"mat3x4f":return Qd.mat3x4f;case"mat4x2f":return Qd.mat4x2f;case"mat4x3f":return Qd.mat4x3f;case"mat4x4f":return Qd.mat4x4f;case"mat2x2h":return Qd.mat2x2h;case"mat2x3h":return Qd.mat2x3h;case"mat2x4h":return Qd.mat2x4h;case"mat3x2h":return Qd.mat3x2h;case"mat3x3h":return Qd.mat3x3h;case"mat3x4h":return Qd.mat3x4h;case"mat4x2h":return Qd.mat4x2h;case"mat4x3h":return Qd.mat4x3h;case"mat4x4h":return Qd.mat4x4h;case"mat2x2i":return Qd.mat2x2i;case"mat2x3i":return Qd.mat2x3i;case"mat2x4i":return Qd.mat2x4i;case"mat3x2i":return Qd.mat3x2i;case"mat3x3i":return Qd.mat3x3i;case"mat3x4i":return Qd.mat3x4i;case"mat4x2i":return Qd.mat4x2i;case"mat4x3i":return Qd.mat4x3i;case"mat4x4i":return Qd.mat4x4i;case"mat2x2u":return Qd.mat2x2u;case"mat2x3u":return Qd.mat2x3u;case"mat2x4u":return Qd.mat2x4u;case"mat3x2u":return Qd.mat3x2u;case"mat3x3u":return Qd.mat3x3u;case"mat3x4u":return Qd.mat3x4u;case"mat4x2u":return Qd.mat4x2u;case"mat4x3u":return Qd.mat4x3u;case"mat4x4u":return Qd.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),"Value out of range for i32: ".concat(e,". Line: ").concat(this._currentLine,"."))}else if("u32"===t.name&&(e<0||e>4294967295))throw this._error(this._previous(),"Value out of range for u32: ".concat(e,". Line: ").concat(this._currentLine,"."))}_primary_expression(){if(this._match(Ff.tokens.ident)){const e=this._previous().toString();if(this._check(Ff.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getType(e);return null!==n?this._updateNode(new of(n,t)):this._updateNode(new sf(e,t))}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return this._updateNode(new lf(e,t.value))}return this._updateNode(new af(e))}if(this._match(Ff.tokens.int_literal)){const e=this._previous().toString();let t=e.endsWith("i")||e.endsWith("i")?Yd.i32:e.endsWith("u")||e.endsWith("U")?Yd.u32:Yd.x32;const n=parseInt(e);return this._validateTypeRange(n,t),this._updateNode(new cf(new Sf(n,this._exec.getTypeInfo(t)),t))}if(this._match(Ff.tokens.uint_literal)){const e=parseInt(this._previous().toString());return this._validateTypeRange(e,Yd.u32),this._updateNode(new cf(new Sf(e,this._exec.getTypeInfo(Yd.u32)),Yd.u32))}if(this._match([Ff.tokens.decimal_float_literal,Ff.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));const n=parseFloat(e);this._validateTypeRange(n,t?Yd.f16:Yd.f32);const i=t?Yd.f16:Yd.f32;return this._updateNode(new cf(new Sf(n,this._exec.getTypeInfo(i)),i))}if(this._match([Ff.keywords.true,Ff.keywords.false])){let e=this._previous().toString()===Ff.keywords.true.rule;return this._updateNode(new cf(new Sf(e?1:0,this._exec.getTypeInfo(Yd.bool)),Yd.bool))}if(this._check(Ff.tokens.paren_left))return this._paren_expression();if(this._match(Ff.keywords.bitcast)){this._consume(Ff.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(Ff.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return this._updateNode(new uf(e,t))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new of(e,t))}_argument_expression_list(){if(!this._match(Ff.tokens.paren_left))return null;const e=[];do{if(this._check(Ff.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Ff.tokens.comma));return this._consume(Ff.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Ff.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Ff.tokens.paren_right),e}_paren_expression(){this._consume(Ff.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Ff.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Ff.keywords.struct))return null;const e=this._currentLine,t=this._consume(Ff.tokens.ident,"Expected name for struct.").toString();this._consume(Ff.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Ff.tokens.brace_right);){const e=this._attribute(),t=this._consume(Ff.tokens.name,"Expected variable name.").toString();this._consume(Ff.tokens.colon,"Expected ':' for struct member type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i),this._check(Ff.tokens.brace_right)?this._match(Ff.tokens.comma):this._consume(Ff.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new bf(t,r,e)))}this._consume(Ff.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,r=this._updateNode(new Jd(t,n,e,i),e);return this._context.structs.set(t,r),r}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Ff.tokens.equal)){const t=this._const_expression();e.value=t}if(null!==e.type&&e.value instanceof cf){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),"Invalid cast from ".concat(e.value.type.name," to ").concat(e.type.name,". Line:").concat(this._currentLine));e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof cf&&(e.type="x32"===e.value.type.name?Yd.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Ff.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Ff.keywords.const))return null;const t=this._consume(Ff.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(Ff.tokens.colon)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}let r=null;this._consume(Ff.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let e=[Yd.f32],n=o.constEvaluate(this._exec,e);n instanceof Sf&&this._validateTypeRange(n.value,e[0]),e[0]instanceof Qd&&null===e[0].format&&n.typeInfo instanceof Jh&&null!==n.typeInfo.format&&("f16"===n.typeInfo.format.name?e[0].format=Yd.f16:"f32"===n.typeInfo.format.name?e[0].format=Yd.f32:"i32"===n.typeInfo.format.name?e[0].format=Yd.i32:"u32"===n.typeInfo.format.name?e[0].format=Yd.u32:"bool"===n.typeInfo.format.name?e[0].format=Yd.bool:console.error("TODO: impelement template format type ".concat(n.typeInfo.format.name))),r=this._updateNode(new cf(n,e[0])),this._exec.context.setVariable(t.toString(),n)}catch(e){r=o}if(null!==i&&r instanceof cf){if("x32"!==r.type.name&&i.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),"Invalid cast from ".concat(r.type.name," to ").concat(i.name,". Line:").concat(this._currentLine));r.type=i,r.isScalar&&this._validateTypeRange(r.scalarValue,r.type)}else null===i&&r instanceof cf&&(i=null!==(e=null==r?void 0:r.type)&&void 0!==e?e:Yd.f32,i===Yd.x32&&(i=Yd.i32));const s=this._updateNode(new Rd(t.toString(),i,"","",r),n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(Ff.keywords.let))return null;const e=this._currentLine,t=this._consume(Ff.tokens.name,"Expected variable name");let n=null;if(this._match(Ff.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}let i=null;if(this._match(Ff.tokens.equal)&&(i=this._const_expression()),null!==n&&i instanceof cf){if("x32"!==i.type.name&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),"Invalid cast from ".concat(i.type.name," to ").concat(n.name,". Line:").concat(this._currentLine));i.type=n}else null===n&&i instanceof cf&&(n="x32"===i.type.name?Yd.i32:i.type);return i instanceof cf&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new Id(t.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Ff.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(Ff.tokens.less_than)&&(t=this._consume(Ff.storage_class,"Expected storage_class.").toString(),this._match(Ff.tokens.comma)&&(n=this._consume(Ff.access_mode,"Expected access_mode.").toString()),this._consume(Ff.tokens.greater_than,"Expected '>'."));const i=this._consume(Ff.tokens.name,"Expected variable name");let r=null;if(this._match(Ff.tokens.colon)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}return this._updateNode(new Dd(i.toString(),r,t,n,null),e)}_override_decl(){if(!this._match(Ff.keywords.override))return null;const e=this._consume(Ff.tokens.name,"Expected variable name");let t=null;if(this._match(Ff.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return this._updateNode(new Cd(e.toString(),t,null))}_diagnostic(){this._consume(Ff.tokens.paren_left,"Expected '('");const e=this._consume(Ff.tokens.ident,"Expected severity control name.");this._consume(Ff.tokens.comma,"Expected ','");let t=this._consume(Ff.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Ff.tokens.period)&&(t+=".".concat(this._consume(Ff.tokens.ident,"Expected diagnostic message.").toString())),this._consume(Ff.tokens.paren_right,"Expected ')'"),this._updateNode(new Hd(e.toString(),t))}_enable_directive(){const e=this._consume(Ff.tokens.ident,"identity expected.");return this._updateNode(new jd(e.toString()))}_requires_directive(){const e=[this._consume(Ff.tokens.ident,"identity expected.").toString()];for(;this._match(Ff.tokens.comma);){const t=this._consume(Ff.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new Gd(e))}_type_alias(){const e=this._consume(Ff.tokens.ident,"identity expected.");this._consume(Ff.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new Wd(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Ff.tokens.ident,...Ff.texel_format,Ff.keywords.bool,Ff.keywords.f32,Ff.keywords.i32,Ff.keywords.u32])){const e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){const t=this._updateNode(new Kd(e));return this._forwardTypeCount++,t}return this._updateNode(new Yd(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Ff.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(Ff.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(Ff.tokens.comma)&&(n=this._consume(Ff.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ff.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Qd(e,t,n))}if(this._match(Ff.keywords.ptr)){let e=this._previous().toString();this._consume(Ff.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(Ff.storage_class,"Expected storage_class for pointer");this._consume(Ff.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let i=null;return this._match(Ff.tokens.comma)&&(i=this._consume(Ff.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ff.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new $d(e,t.toString(),n,i))}const t=this._attribute();if(this._match(Ff.keywords.array)){let n=null,i=-1;const r=this._previous();let o=null;if(this._match(Ff.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let t="";if(this._match(Ff.tokens.comma)){o=this._shift_expression();try{t=o.constEvaluate(this._exec).toString(),o=null}catch(e){t="1"}}this._consume(Ff.tokens.greater_than,"Expected '>' for array."),i=t?parseInt(t):0}const s=this._updateNode(new ef(r.toString(),t,n,i));return o&&this._deferArrayCountEval.push({arrayType:s,countNode:o}),s}return null}_texture_sampler_types(){if(this._match(Ff.sampler_type))return this._updateNode(new tf(this._previous().toString(),null,null));if(this._match(Ff.depth_texture_type))return this._updateNode(new tf(this._previous().toString(),null,null));if(this._match(Ff.sampled_texture_type)||this._match(Ff.multisampled_texture_type)){const e=this._previous();this._consume(Ff.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Ff.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new tf(e.toString(),t,null))}if(this._match(Ff.storage_texture_type)){const e=this._previous();this._consume(Ff.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Ff.texel_format,"Invalid texel format.").toString();this._consume(Ff.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Ff.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Ff.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new tf(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(Ff.tokens.attr);){const t=this._consume(Ff.attribute_name,"Expected attribute name"),n=this._updateNode(new wf(t.toString(),null));if(this._match(Ff.tokens.paren_left)){if(n.value=this._consume(Ff.literal_or_ident,"Expected attribute value").toString(),this._check(Ff.tokens.comma)){this._advance();do{const e=this._consume(Ff.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(Ff.tokens.comma))}this._consume(Ff.tokens.paren_right,"Expected ')'")}e.push(n)}return 0==e.length?null:e}}class ap extends Yf{constructor(e){super(),e&&this.update(e)}update(e){const t=(new sp).parse(e);this.updateAST(t)}}function lp(e){const t={attributes:[],bindings:[]};let n;try{n=function(e){try{return new ap(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"===typeof t&&null!==t&&void 0!==t&&t.message&&(e+=": ".concat(t.message," ")),"object"===typeof t&&null!==t&&void 0!==t&&t.token&&(e+=t.token.line||""),new Error(e,{cause:t})}}(e)}catch(s){return Ma.error(s.message)(),t}for(const a of n.uniforms){const e=[];for(const t of(null===(i=a.type)||void 0===i?void 0:i.members)||[]){var i;e.push({name:t.name,type:cp(t.type)})}t.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:e})}for(const a of n.textures)t.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of n.samplers)t.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const r=n.entry.vertex[0],o=(null===r||void 0===r?void 0:r.inputs.length)||0;for(let a=0;a<o;a++){const e=r.inputs[a];if("location"===e.locationType){const n=cp(e.type);t.attributes.push({name:e.name,location:Number(e.location),type:n})}}return t}function cp(e){return e.format?"".concat(e.name,"<").concat(e.format.name,">"):e.name}const up={};function hp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";up[e]=up[e]||1;const t=up[e]++;return"".concat(e,"-").concat(t)}class dp{constructor(e){if(o(this,"id",void 0),o(this,"userData",{}),o(this,"topology",void 0),o(this,"bufferLayout",[]),o(this,"vertexCount",void 0),o(this,"indices",void 0),o(this,"attributes",void 0),this.id=e.id||hp("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Oa.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;null===(e=this.indices)||void 0===e||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function fp(e,t){if(t instanceof dp)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:Oa.INDEX,data:n})}(e,t),{attributes:i,bufferLayout:r}=function(e,t){const n=[],i={};for(const[o,s]of Object.entries(t.attributes)){let t=o;switch(o){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(s){i[t]=e.createBuffer({data:s.value,id:"".concat(o,"-buffer")});const{value:r,size:a,normalized:l}=s;n.push({name:t,format:wh(r,a,l)})}}const r=t._calculateVertexCount(t.attributes,t.indices);return{attributes:i,bufferLayout:n,vertexCount:r}}(e,t);return new dp({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:n,attributes:i})}class pp extends ka{get[Symbol.toStringTag](){return"ComputePipeline"}constructor(e,t){super(e,t,pp.defaultProps),o(this,"hash",""),o(this,"shaderLayout",void 0),this.shaderLayout=t.shaderLayout}}o(pp,"defaultProps",a(a({},ka.defaultProps),{},{shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}));class mp{static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new mp(e),e._lumaData.defaultPipelineFactory}constructor(e){o(this,"device",void 0),o(this,"destroyPolicy",void 0),o(this,"_hashCounter",0),o(this,"_hashes",{}),o(this,"_renderPipelineCache",{}),o(this,"_computePipelineCache",{}),this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const t=a(a({},Yc.defaultProps),e),n=this._hashRenderPipeline(t);if(!this._renderPipelineCache[n]){const e=this.device.createRenderPipeline(a(a({},t),{},{id:t.id?"".concat(t.id,"-cached"):void 0}));e.hash=n,this._renderPipelineCache[n]={pipeline:e,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const t=a(a({},pp.defaultProps),e),n=this._hashComputePipeline(t);if(!this._computePipelineCache[n]){const e=this.device.createComputePipeline(a(a({},t),{},{id:t.id?"".concat(t.id,"-cached"):void 0}));e.hash=n,this._computePipelineCache[n]={pipeline:e,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const t=e.hash,n=e instanceof pp?this._computePipelineCache:this._renderPipelineCache;n[t].useCount--,0===n[t].useCount&&"unused"===this.destroyPolicy&&(n[t].pipeline.destroy(),delete n[t])}_hashComputePipeline(e){const t=this._getHash(e.shader.source);return"".concat(t)}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout));if("webgl"===this.device.type)return"".concat(t,"/").concat(n,"V").concat("-","BL").concat(i);{const r=this._getHash(JSON.stringify(e.parameters));return"".concat(t,"/").concat(n,"V").concat("-","T").concat(e.topology,"P").concat(r,"BL").concat(i)}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}o(mp,"defaultProps",a({},Yc.defaultProps));class gp{static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new gp(e)),e._lumaData.defaultShaderFactory}constructor(e){o(this,"device",void 0),o(this,"destroyPolicy",void 0),o(this,"_cache",{}),this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const i=this.device.createShader(a(a({},e),{},{id:e.id?"".concat(e.id,"-cached"):void 0}));this._cache[t]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n&&(n.useCount--,0===n.useCount&&"unused"===this.destroyPolicy&&(delete this._cache[t],n.shader.destroy()))}_hashShader(e){return"".concat(e.stage,":").concat(e.source)}}o(gp,"defaultProps",a({},_c.defaultProps));let _p=null,yp=null;function vp(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!vp(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"===typeof e&&"object"===typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const o of i){if(!t.hasOwnProperty(o))return!1;if(!vp(e[o],t[o],n-1))return!1}return!0}return!1}function xp(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(n=>{const i=e[n];!function(e){return su(e)||"number"===typeof e||"boolean"===typeof e}(i)?t.bindings[n]=i:t.uniforms[n]=i}),t}class bp{constructor(e,t){o(this,"options",{disableWarnings:!1}),o(this,"modules",void 0),o(this,"moduleUniforms",void 0),o(this,"moduleBindings",void 0),Object.assign(this.options,t);const n=C(Object.values(e).filter(e=>e.dependencies));for(const i of n)e[i.name]=i;Ma.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,r]of Object.entries(e))this._addModule(r),r.name&&i!==r.name&&!this.options.disableWarnings&&Ma.warn("Module name: ".concat(i," vs ").concat(r.name))()}destroy(){}setProps(e){for(const n of Object.keys(e)){var t;const i=n,r=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||Ma.warn("Module ".concat(n," not found"))();continue}const s=this.moduleUniforms[i],l=this.moduleBindings[i],c=(null===(t=o.getUniforms)||void 0===t?void 0:t.call(o,r,s))||r,{uniforms:u,bindings:h}=xp(c);this.moduleUniforms[i]=a(a({},s),u),this.moduleBindings[i]=a(a({},l),h)}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[r,o]of Object.entries(i)){var t;e["".concat(n,".").concat(r)]={type:null===(t=this.modules[n].uniformTypes)||void 0===t?void 0:t[r],value:String(o)}}return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let wp="";async function Ep(e,t){const n=new Image;return n.crossOrigin=(null===t||void 0===t?void 0:t.crossOrigin)||"anonymous",n.src=e.startsWith("http")?e:wp+e,await n.decode(),t?await createImageBitmap(n,t):await createImageBitmap(n)}class Tp{get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return'AsyncTexture:"'.concat(this.id,'"(').concat(this.isReady?"ready":"loading",")")}constructor(e,t){var n;o(this,"device",void 0),o(this,"id",void 0),o(this,"texture",void 0),o(this,"sampler",void 0),o(this,"view",void 0),o(this,"ready",void 0),o(this,"isReady",!1),o(this,"destroyed",!1),o(this,"resolveReady",()=>{}),o(this,"rejectReady",()=>{}),this.device=e,this.id=t.id||hp("async-texture"),"string"===typeof(null===(n=t)||void 0===n?void 0:n.data)&&"2d"===t.dimension&&(t=a(a({},t),{},{data:Ep(t.data)})),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(t)}async initAsync(e){const t=e.data;let n;try{n=await Ap(t)}catch(r){this.rejectReady(r)}if(this.destroyed)return;const i=a(a({},e),{},{data:n});this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function Ap(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(Ap));if(e&&"object"===typeof e&&e.constructor===Object){const t=e,n=await Promise.all(Object.values(t)),i=Object.keys(t),r={};for(let e=0;e<i.length;e++)r[i[e]]=n[e];return r}return e}class Sp{get[Symbol.toStringTag](){return"Model"}toString(){return"Model(".concat(this.id,")")}constructor(e,t){var n,i,r;o(this,"device",void 0),o(this,"id",void 0),o(this,"source",void 0),o(this,"vs",void 0),o(this,"fs",void 0),o(this,"pipelineFactory",void 0),o(this,"shaderFactory",void 0),o(this,"userData",{}),o(this,"parameters",void 0),o(this,"topology",void 0),o(this,"bufferLayout",void 0),o(this,"isInstanced",void 0),o(this,"instanceCount",0),o(this,"vertexCount",void 0),o(this,"indexBuffer",null),o(this,"bufferAttributes",{}),o(this,"constantAttributes",{}),o(this,"bindings",{}),o(this,"uniforms",{}),o(this,"vertexArray",void 0),o(this,"transformFeedback",null),o(this,"pipeline",void 0),o(this,"shaderInputs",void 0),o(this,"_uniformStore",void 0),o(this,"_attributeInfos",{}),o(this,"_gpuGeometry",null),o(this,"_getModuleUniforms",void 0),o(this,"props",void 0),o(this,"_pipelineNeedsUpdate","newly created"),o(this,"_needsRedraw","initializing"),o(this,"_destroyed",!1),o(this,"_lastDrawTimestamp",-1),o(this,"_lastLogTime",0),o(this,"_logOpen",!1),o(this,"_drawCount",0),this.props=a(a({},Sp.defaultProps),t),t=this.props,this.id=t.id||hp("model"),this.device=e,Object.assign(this.userData,t.userData);const s=Object.fromEntries((null===(n=this.props.modules)||void 0===n?void 0:n.map(e=>[e.name,e]))||[]),l=t.shaderInputs||new bp(s,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(l);const c=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),u=((null===(i=this.props.modules)||void 0===i?void 0:i.length)>0?this.props.modules:null===(r=this.shaderInputs)||void 0===r?void 0:r.getModules())||[];if("webgpu"===this.device.type&&this.props.source){var h;const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader(a(a({platformInfo:c},this.props),{},{modules:u}));this.source=e,this._getModuleUniforms=t,(h=this.props).shaderLayout||(h.shaderLayout=lp(this.source))}else{const{vs:e,fs:t,getUniforms:n}=this.props.shaderAssembler.assembleGLSLShaderPair(a(a({platformInfo:c},this.props),{},{modules:u}));this.vs=e,this.fs=t,this._getModuleUniforms=n}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||mp.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||gp.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),null===(e=this._gpuGeometry)||void 0===e||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return Ma.info(2,">>> DRAWING ABORTED ".concat(this.id,": ").concat(t," not loaded"))(),!1;try{e.pushDebugGroup("".concat(this,".predraw(").concat(e,")")),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup("".concat(this,".draw(").concat(e,")")),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const t=this._getBindings();this.pipeline.setBindings(t,{disableWarnings:this.props.disableWarnings}),Cp(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:i}=this.vertexArray,r=i?i.byteLength/("uint32"===i.indexType?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:r,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var t;null===(t=this._gpuGeometry)||void 0===t||t.destroy();const n=e&&fp(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const e=new zh(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new zh(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){vp(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Wh(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(Dp(n)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings["".concat(t,"Uniforms")]=e}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){var n;const i=null!==(n=null===t||void 0===t?void 0:t.disableWarnings)&&void 0!==n?n:this.props.disableWarnings;e.indices&&Ma.warn("Model:".concat(this.id," setAttributes() - indexBuffer should be set using setIndexBuffer()"))(),this.bufferLayout=function(e,t){const n=Object.fromEntries(e.attributes.map(e=>[e.name,e.location])),i=t.slice();return i.sort((e,t)=>{const i=e.attributes?e.attributes.map(e=>e.attribute):[e.name],r=t.attributes?t.attributes.map(e=>e.attribute):[t.name];return Math.min(...i.map(e=>n[e]))-Math.min(...r.map(e=>n[e]))}),i}(this.pipeline.shaderLayout,this.bufferLayout);const r=new zh(this.bufferLayout);for(const[o,s]of Object.entries(e)){const e=r.getBufferLayout(o);if(!e){i||Ma.warn("Model(".concat(this.id,'): Missing layout for buffer "').concat(o,'".'))();continue}const t=r.getAttributeNamesForBuffer(e);let n=!1;for(const i of t){const e=this._attributeInfos[i];if(e){const t="webgpu"===this.device.type?r.getBufferIndex(e.bufferName):e.location;this.vertexArray.setBuffer(t,s),n=!0}}n||i||Ma.warn("Model(".concat(this.id,'): Ignoring buffer "').concat(s.id,'" for unknown attribute "').concat(o,'"'))()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,r]of Object.entries(e)){var n;const e=this._attributeInfos[i];e?this.vertexArray.setConstantWebGL(e.location,r):(null!==(n=null===t||void 0===t?void 0:t.disableWarnings)&&void 0!==n?n:this.props.disableWarnings)||Ma.warn('Model "'.concat(this.id,': Ignoring constant supplied for unknown attribute "').concat(i,'"'))()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Cp(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:n}=xp(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Tp&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof Tp?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Lc?e=Math.max(e,t.texture.updateTimestamp):t instanceof Oa||t instanceof Ql?e=Math.max(e,t.updateTimestamp):t instanceof Tp?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof wc||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t=a({},e.attributes);for(const[n]of Object.entries(t))this.pipeline.shaderLayout.attributes.find(e=>e.name===n)||"positions"===n||delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Ma.log(1,"Model ".concat(this.id,': Recreating pipeline because "').concat(this._pipelineNeedsUpdate,'".'))(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:"".concat(this.id,"-vertex"),stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:"".concat(this.id,"-fragment"),stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline(a(a({},this.props),{},{bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i})),this._attributeInfos=bu(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=Ma.level>3?0:1e4;Ma.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Ma.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:Ma.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e){var t;const n={},i="Values";if(0===e.attributes.length&&(null===(t=e.varyings)||void 0===t||!t.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const r of e.attributes)if(r){const e="".concat(r.location," ").concat(r.name,": ").concat(r.type);n["in ".concat(e)]={[i]:r.stepMode||"vertex"}}for(const r of e.varyings||[]){const e="".concat(r.location," ").concat(r.name);n["out ".concat(e)]={[i]:JSON.stringify(r)}}return n}(this.pipeline.shaderLayout,this.id);Ma.table(2,e)();const t=this.shaderInputs.getDebugTable();for(const[i,r]of Object.entries(this.uniforms))t[i]={value:r};Ma.table(2,t)();const n=this._getAttributeDebugTable();Ma.table(2,this._attributeInfos)(),Ma.table(2,n)(),Ma.groupEnd(2)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&function(e,t){var n;let{id:i,minimap:r,opaque:o,top:s="0",left:a="0",rgbaScale:l=1}=t;_p||(_p=document.createElement("canvas"),_p.id=i,_p.title=i,_p.style.zIndex="100",_p.style.position="absolute",_p.style.top=s,_p.style.left=a,_p.style.border="blue 5px solid",_p.style.transform="scaleY(-1)",document.body.appendChild(_p),yp=_p.getContext("2d")),_p.width===e.width&&_p.height===e.height||(_p.width=e.width/2,_p.height=e.height/2,_p.style.width="400px",_p.style.height="400px");const c=e.device.readPixelsToArrayWebGL(e),u=null===(n=yp)||void 0===n?void 0:n.createImageData(e.width,e.height);if(u){var h;const e=0;for(let t=0;t<c.length;t+=4)u.data[e+t+0]=c[t+0]*l,u.data[e+t+1]=c[t+1]*l,u.data[e+t+2]=c[t+2]*l,u.data[e+t+3]=o?255:c[t+3]*l;null===(h=yp)||void 0===h||h.putImageData(u,0,0)}}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=bh(t);return(e instanceof Oa?new n(e.debugData):e).toString()}}function Dp(e){return Boolean(e.uniformTypes&&!Cp(e.uniformTypes))}function Cp(e){for(const t in e)return!1;return!0}o(Sp,"defaultProps",a(a({},Yc.defaultProps),{},{source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:X.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0}));class Ip{static isSupported(e){var t;return"webgl"===(null===e||void 0===e||null===(t=e.info)||void 0===t?void 0:t.type)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ip.defaultProps;if(o(this,"device",void 0),o(this,"model",void 0),o(this,"transformFeedback",void 0),!Ip.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Sp(this.device,a({id:t.id||"buffer-transform-model",fs:t.fs||Bh(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings},t)),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){null!==e&&void 0!==e&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),null!==e&&void 0!==e&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Oa)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:r=n.byteLength}=t;return n.readAsync(i,r)}}function Rp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Math.fround(e),r=e-i;return t[n]=i,t[n+1]=r,t}function Pp(e){return e-Math.fround(e)}function Mp(e){const t=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=4*n+i;Rp(e[4*i+n],t,2*r)}return t}o(Ip,"defaultProps",a(a({},Sp.defaultProps),{},{outputs:void 0,feedbackBuffers:void 0}));const Fp={name:"fp64arithmetic",vs:"\nuniform fp64arithmeticUniforms {\n  uniform float ONE;\n} fp64;\n\n/*\nAbout LUMA_FP64_CODE_ELIMINATION_WORKAROUND\n\nThe purpose of this workaround is to prevent shader compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' form.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be 1 only at runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\n// Divide float number to high and low floats to extend fraction bits\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * fp64.ONE - (t - a);\n  float a_lo = a * fp64.ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\n\n// Divide float number again when high float uses too many fraction bits\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\n\n// Special sum operation when a > b\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * fp64.ONE;\n  float err = b - (sum - a) * fp64.ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\n\n// General sum operation\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *\n    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:Rp,fp64LowPart:Pp,fp64ifyMatrix4:Mp};function Lp(e){const{source:t,target:n,start:i=0,size:r,getData:o}=e,s=e.end||n.length,a=t.length,l=s-i;if(a>l)return void n.set(t.subarray(0,l),i);if(n.set(t,i),!o)return;let c=a;for(;c<l;){const e=o(c,t);for(let t=0;t<r;t++)n[i+c]=e[t]||0,c++}}function kp(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(e,'"'))}}function Op(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Bp(e){e.push(e.shift())}function zp(e){let{device:t,source:n,target:i}=e;var r;(!i||i.byteLength<n.byteLength)&&(null===(r=i)||void 0===r||r.destroy(),i=t.createBuffer({byteLength:n.byteLength,usage:n.usage}));return i}function Np(e){let{device:t,buffer:n,attribute:i,fromLength:r,toLength:o,fromStartIndices:s,getData:a=e=>e}=e;const l=i.doublePrecision&&i.value instanceof Float64Array?2:1,c=i.size*l,u=i.byteOffset,h=i.settings.bytesPerElement<4?u/i.settings.bytesPerElement*4:u,d=i.startIndices,f=s&&d,p=i.isConstant;if(!f&&n&&r>=o)return n;const m=i.value instanceof Float64Array?Float32Array:i.value.constructor,g=p?i.value:new m(i.getBuffer().readSyncWebGL(u,o*m.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!p){const e=a;a=(t,n)=>i.normalizeConstant(e(t,n))}const _=p?(e,t)=>a(g,t):(e,t)=>a(g.subarray(e+u,e+u+c),t),y=n?new Float32Array(n.readSyncWebGL(h,4*r).buffer):new Float32Array(0),v=new Float32Array(o);var x;(function(e){let{source:t,target:n,size:i,getData:r,sourceStartIndices:o,targetStartIndices:s}=e;if(!o||!s)return Lp({source:t,target:n,size:i,getData:r}),n;let a=0,l=0;const c=r&&((e,t)=>r(e+l,t)),u=Math.min(o.length,s.length);for(let h=1;h<u;h++){const e=o[h]*i,r=s[h]*i;Lp({source:t.subarray(a,e),target:n,start:l,end:r,size:i,getData:c}),a=e,l=r}l<n.length&&Lp({source:[],target:n,start:l,size:i,getData:c})}({source:y,target:v,sourceStartIndices:s,targetStartIndices:d,size:c,getData:_}),!n||n.byteLength<v.byteLength+h)&&(null===(x=n)||void 0===x||x.destroy(),n=t.createBuffer({byteLength:v.byteLength+h,usage:35050}));return n.write(v,h),n}class Up{constructor(e){let{device:t,attribute:n,timeline:i}=e;this.buffers=[],this.currentLength=0,this.device=t,this.transition=new bo(i),this.attribute=n,this.attributeInTransition=function(e){const{device:t,settings:n,value:i}=e,r=new kh(t,n);return r.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){const{doublePrecision:n,settings:i,value:r,size:o}=e,s=n&&r instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=e.settings;if(l)for(const u of Object.values(l)){var c;a=Math.max(a,null!==(c=u.vertexOffset)&&void 0!==c?c:0)}return(i.noAlloc?r.length:(t+a)*o)*s}(this.attribute,t),this.transition.start(a(a({},e),{},{duration:n}))}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}const Vp={name:"interpolation",vs:"uniform interpolationUniforms {\n  float time;\n} interpolation;\n",uniformTypes:{time:"f32"}},jp="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, interpolation.time);\n  gl_Position = vec4(0.0);\n}\n",Gp="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aFrom64Low;\nin ATTRIBUTE_TYPE aTo;\nin ATTRIBUTE_TYPE aTo64Low;\nout ATTRIBUTE_TYPE vCurrent;\nout ATTRIBUTE_TYPE vCurrent64Low;\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid main(void) {\n  for (int i=0; i<ATTRIBUTE_SIZE; i++) {\n    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);\n    vCurrent[i] = value.x;\n    vCurrent64Low[i] = value.y;\n  }\n  gl_Position = vec4(0.0);\n}\n";function Hp(e){return e.doublePrecision&&e.value instanceof Float64Array}const Wp={name:"spring",vs:"uniform springUniforms {\n  float damping;\n  float stiffness;\n} spring;\n",uniformTypes:{damping:"f32",stiffness:"f32"}},qp="#version 300 es\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nin ATTRIBUTE_TYPE aPrev;\nin ATTRIBUTE_TYPE aCur;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vNext;\nout float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE force = delta * spring.stiffness;\n  ATTRIBUTE_TYPE resistance = velocity * spring.damping;\n  return force - resistance + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",Xp="#version 300 es\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nin float vIsTransitioningFlag;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  fragColor = vec4(1.0);\n}";const Zp={interpolation:class extends Up{constructor(e){let{device:t,attribute:n,timeline:i}=e;super({device:t,attribute:n,timeline:i}),this.type="interpolation",this.transform=function(e,t){const n=t.size,i=kp(n),r=Op(n),o=t.getBufferLayout();if(Hp(t))return new Ip(e,{vs:Gp,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*n}]}],modules:[Fp,Vp],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0});return new Ip(e,{vs:jp,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:o.attributes[0].format}],modules:[Vp],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}(t,n)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();const{buffers:r,attribute:o}=this;Bp(r),r[0]=Np({device:this.device,buffer:r[0],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),r[1]=zp({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:s}=this,a=s.model;let l=Math.floor(this.currentLength/o.size);Hp(o)&&(l/=2),a.setVertexCount(l),o.isConstant?(a.setAttributes({aFrom:r[0]}),a.setConstantAttributes({aTo:o.value})):a.setAttributes({aFrom:r[0],aTo:o.getBuffer()}),s.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:r}=this.transform,o={time:i};r.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends Up{constructor(e){let{device:t,attribute:n,timeline:i}=e;super({device:t,attribute:n,timeline:i}),this.type="spring",this.texture=function(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}(t),this.framebuffer=function(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}(t,this.texture),this.transform=function(e,t){const n=kp(t.size),i=Op(t.size);return new Ip(e,{vs:qp,fs:Xp,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Wp],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(t,n)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:r,attribute:o}=this;for(let a=0;a<2;a++)r[a]=Np({device:this.device,buffer:r[a],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});r[2]=zp({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:s}=this.transform;s.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?s.setConstantAttributes({aTo:o.value}):s.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,r=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:r.stiffness,damping:r.damping};t.model.shaderInputs.setProps({spring:o}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Bp(e),this.setBuffer(e[1]);this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class Yp{constructor(e,t){let{id:n,timeline:i}=t;if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:t,transitions:n,numInstances:i}=e;this.numInstances=i||1;for(const r in t){const e=t[r],i=e.getTransitionSetting(n);i&&this._updateAttribute(r,e,i)}for(const r in this.transitions){const e=t[r];e&&e.getTransitionSetting(n)||this._removeTransition(r)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(const t in this.transitions){this.transitions[t].update()&&(this.needsRedraw=!0)}const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let r=!i||i.type!==n.type;if(r){i&&this._removeTransition(e);const o=Zp[n.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(Le.error("unsupported transition type '".concat(n.type,"'"))(),r=!1)}(r||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const Kp="attributeManager.invalidate";class Jp{constructor(e){let{id:t="attribute-manager",stats:n,timeline:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.mergeBoundsMemoized=us(si),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Yp(e,{id:"".concat(t,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);Be(Kp,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Be(Kp,this,"all")}update(e){let{data:t,numInstances:n,startIndices:i=null,transitions:r,props:o={},buffers:s={},context:a={}}=e,l=!1;Be("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const e=this.attributes[c],r=e.settings.accessor;e.startIndices=i,e.numInstances=n,o[c]&&Le.removed("props.".concat(c),"data.attributes.".concat(c))(),e.setExternalBuffer(s[c])||e.setBinaryValue("string"===typeof r?s[r]:void 0,t.startIndices)||"string"===typeof r&&!s[r]&&e.setConstantValue(o[r])||e.needsUpdate()&&(l=!0,this._updateAttribute({attribute:e,numInstances:n,data:t,props:o,context:a})),this.needsRedraw=this.needsRedraw||e.needsRedraw()}l&&Be("attributeManager.updateEnd",this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return a(a({},this.attributes),this.attributeTransitionManager.getAttributes())}getBounds(e){const t=e.map(e=>{var t;return null===(t=this.attributes[e])||void 0===t?void 0:t.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1};const{attributes:t,attributeTransitionManager:n}=this,i=a({},n.getAttributes());for(const r in t){const o=t[r];o.needsRedraw(e)&&!n.hasAttribute(r)&&(i[r]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const i=e[n],r=a(a({},i),{},{id:n,size:(i.isIndexed?1:i.size)||1},t);this.attributes[n]=new kh(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes){this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)})}this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,r=i[e];return r&&r.forEach(e=>{const i=n[e];i&&i.setNeedsUpdate(i.id,t)}),r}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(Be("attribute.updateStart",t),t.constant)return void t.setConstantValue(t.value);t.allocate(n)&&Be("attribute.allocate",t,n);t.updateBuffer(e)&&(this.needsRedraw=!0,Be("attribute.updateEnd",t,n))}}const Qp=1e-5;function $p(e,t,n,i,r){const o=t-e;return(n-t)*r+-o*i+o+t}function em(e,t){if(Array.isArray(e)){let n=0;for(let i=0;i<e.length;i++){const r=e[i]-t[i];n+=r*r}return Math.sqrt(n)}return Math.abs(e-t)}const tm={interpolation:class extends bo{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:r}}=this,o=r(e/i);this._value=On(t,n,o)}},spring:class extends bo{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:r=e,_currValue:o=e}=this;let s=function(e,t,n,i,r){if(Array.isArray(n)){const o=[];for(let s=0;s<n.length;s++)o[s]=$p(e[s],t[s],n[s],i,r);return o}return $p(e,t,n,i,r)}(r,o,t,n,i);const a=em(s,t),l=em(s,o);a<Qp&&l<Qp&&(s=t,this.end()),this._prevValue=o,this._currValue=s}}};class nm{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:r}=this;if(r.has(e)){const n=r.get(e),{value:i=n.settings.fromValue}=n;t=i,this.remove(e)}if(!(i=Lh(i)))return;const o=tm[i.type];if(!o)return void Le.error("unsupported transition type '".concat(i.type,"'"))();const s=new o(this.timeline);s.start(a(a({},i),{},{fromValue:t,toValue:n})),r.set(e,s)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function im(e,t){const n=om({newProps:e,oldProps:t,propTypes:e[ce],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=e;i?i(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied");n&&r&&(n=r(e.data,t.data)||n);return n}(e,t);let r=!1;return i||(r=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers){if(lm(e,t,"all"))return{all:!0}}const n={};let i=!1;for(const r in e.updateTriggers)if("all"!==r){lm(e,t,r)&&(n[r]=!0,i=!0)}return!!i&&n}(e,t)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:am(e,t),transitionsChanged:rm(e,t)}}function rm(e,t){if(!e.transitions)return!1;const n={},i=e[ce];let r=!1;for(const o in e.transitions){const s=i[o],a=s&&s.type;("number"===a||"color"===a||"array"===a)&&sm(e[o],t[o],s)&&(n[o]=!0,r=!0)}return!!r&&n}function om(e){let{newProps:t,oldProps:n,ignoreProps:i={},propTypes:r={},triggerName:o="props"}=e;if(n===t)return!1;if("object"!==typeof t||null===t)return"".concat(o," changed shallowly");if("object"!==typeof n||null===n)return"".concat(o," changed shallowly");for(const s of Object.keys(t))if(!(s in i)){if(!(s in n))return"".concat(o,".").concat(s," added");const e=sm(t[s],n[s],r[s]);if(e)return"".concat(o,".").concat(s," ").concat(e)}for(const s of Object.keys(n))if(!(s in i)){if(!(s in t))return"".concat(o,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const e=sm(t[s],n[s],r[s]);if(e)return"".concat(o,".").concat(s," ").concat(e)}}return!1}function sm(e,t,n){let i=n&&n.equal;return i&&!i(e,t,n)?"changed deeply":i||(i=e&&t&&e.equals,!i||i.call(e,t))?i||t===e?null:"changed shallowly":"changed deeply"}function am(e,t){if(null===t)return!0;const n=t.extensions,{extensions:i}=e;if(i===n)return!1;if(!n||!i)return!0;if(i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function lm(e,t,n){let i=e.updateTriggers[n];i=void 0===i||null===i?{}:i;let r=t.updateTriggers[n];r=void 0===r||null===r?{}:r;return om({oldProps:r,newProps:i,triggerName:n})}function cm(e){if(!function(e){return null!==e&&"object"===typeof e}(e))throw new Error("count(): argument not an object");if("function"===typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"===typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error("count(): argument not a container")}function um(e,t){if(!t)return e;const n=a(a({},e),t);if("defines"in t&&(n.defines=a(a({},e.defines),t.defines)),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some(e=>"project64"===e.name))){const e=n.modules.findIndex(e=>"project32"===e.name);e>=0&&n.modules.splice(e,1)}if("inject"in t)if(e.inject){const i=a({},e.inject);for(const e in t.inject)i[e]=(i[e]||"")+t.inject[e];n.inject=i}else n.inject=t.inject;return n}const hm=[0,0,0];function dm(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t.projectPosition(e);if(n&&t instanceof xo){const[n,r,o=0]=e,s=t.getDistanceScales([n,r]);i[2]=o*s.unitsPerMeter[2]}return i}function fm(e,t){let{viewport:n,modelMatrix:i,coordinateSystem:r,coordinateOrigin:o,offsetMode:s}=t,[a,l,c=0]=e;switch(i&&([a,l,c]=vi([],[a,l,c,1],i)),r){case eo.LNGLAT:return dm([a,l,c],n,s);case eo.LNGLAT_OFFSETS:return dm([a+o[0],l+o[1],c+(o[2]||0)],n,s);case eo.METER_OFFSETS:return dm(Zi(o,[a,l,c]),n,s);case eo.CARTESIAN:default:return n.isGeospatial?[a+o[0],l+o[1],c+o[2]]:n.projectPosition([a,l,c])}}function pm(e,t){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:a}=function(e){const{viewport:t,modelMatrix:n,coordinateOrigin:i}=e;let{coordinateSystem:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}=e;return r===eo.DEFAULT&&(r=t.isGeospatial?eo.LNGLAT:eo.CARTESIAN),void 0===o&&(o=r),void 0===s&&(s=i),{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:o,fromCoordinateOrigin:s}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=hm,shaderCoordinateOrigin:u=hm,offsetMode:h=!1}=l?_s(n,i,r):{},d=fm(e,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:a,offsetMode:h});if(h){const e=n.projectPosition(c||u);Zn(d,d,e)}return d}const mm={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},gm={};const _m={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||xm(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>fo(e,t,1)},accessor:{validate(e,t){const n=bm(e);return"function"===n||n===bm(t.value)},equal:(e,t,n)=>"function"===typeof t||fo(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||xm(e),equal(e,t,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?fo(e,t,r):e===t}},object:{equal(e,t,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?fo(e,t,r):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"===typeof e,equal:(e,t,n)=>!n.compare&&!1!==n.ignore||e===t},data:{transform:(e,t,n)=>{if(!e)return e;const{dataTransform:i}=n.props;return i?i(e):"string"===typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,n)=>{const i=n.context;return i&&i.device?function(e,t,n,i){if(n instanceof Ql)return n;n.constructor&&"Object"!==n.constructor.name&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const o=t.createTexture(a(a({},n),{},{sampler:a(a(a({},mm),r),i),mipmaps:!0}));return gm[o.id]=e,o}(n.id,i.device,e,a(a({},t.parameters),n.props.textureParameters)):null},release:(e,t,n)=>{var i,r;i=n.id,(r=e)&&r instanceof Ql&&gm[r.id]===i&&(r.delete(),delete gm[r.id])}}};function ym(e,t){switch(bm(t)){case"object":return vm(e,t);case"array":return vm(e,{type:"array",value:t,compare:!1});case"boolean":return vm(e,{type:"boolean",value:t});case"number":return vm(e,{type:"number",value:t});case"function":return vm(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function vm(e,t){return"type"in t?a(a({name:e},_m[t.type]),t):"value"in t?a({name:e,type:bm(t.value)},t):{name:e,type:"object",value:t}}function xm(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function bm(e){return xm(e)?"array":null===e?"null":typeof e}const wm="_mergedDefaultProps";function Em(e,t){if(!(e instanceof Im.constructor))return{};let n=wm;if(t)for(const r of t){const e=r.constructor;e&&(n+=":".concat(e.extensionName||e.name))}const i=Sm(e,n);return i||(e[n]=function(e,t){const n=e.prototype;if(!n)return null;const i=Object.getPrototypeOf(e),r=Em(i),o=Sm(e,"defaultProps")||{},s=function(e){const t={},n={},i={};for(const[r,o]of Object.entries(e)){const e=null===o||void 0===o?void 0:o.deprecatedFor;if(e)i[r]=Array.isArray(e)?e:[e];else{const e=ym(r,o);t[r]=e,n[r]=e.value}}return{propTypes:t,defaultProps:n,deprecatedProps:i}}(o),a=Object.assign(Object.create(null),r,s.defaultProps),l=Object.assign(Object.create(null),null===r||void 0===r?void 0:r[ce],s.propTypes),c=Object.assign(Object.create(null),null===r||void 0===r?void 0:r[ue],s.deprecatedProps);for(const u of t){const e=Em(u.constructor);e&&(Object.assign(a,e),Object.assign(l,e[ce]),Object.assign(c,e[ue]))}(function(e,t){const n=function(e){const t=e.componentName;t||Le.warn("".concat(e.name,".componentName not specified"))();return t||e.name}(t);Object.defineProperties(e,{id:{writable:!0,value:n}})})(a,e),function(e,t){const n={},i={};for(const r in t){const e=t[r],{name:o,value:s}=e;e.async&&(n[o]=s,i[o]=Tm(o))}e[he]=n,e[de]={},Object.defineProperties(e,i)}(a,l),function(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(e){const i="".concat(this.id,": ").concat(n);for(const r of t[n])Am(this,r)||(this[r]=e);Le.deprecated(i,t[n].join("/"))()}})}(a,c),a[ce]=l,a[ue]=c,0!==t.length||Am(e,"_propTypes")||(e._propTypes=l);return a}(e,t||[]))}function Tm(e){return{enumerable:!0,set(t){"string"===typeof t||t instanceof Promise||Rh(t)?this[de][e]=t:this[fe][e]=t},get(){if(this[fe]){if(e in this[fe]){return this[fe][e]||this[he][e]}if(e in this[de]){const t=this[le]&&this[le].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[he][e]}}return this[he][e]}}}function Am(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Sm(e,t){return Am(e,t)&&e[t]}let Dm=0;class Cm{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.props=function(e,t){let n;for(let o=t.length-1;o>=0;o--){const e=t[o];"extensions"in e&&(n=e.extensions)}const i=Em(e.constructor,n),r=Object.create(i);r[le]=e,r[de]={},r[fe]={};for(let o=0;o<t.length;++o){const e=t[o];for(const t in e)r[t]=e[t]}return Object.freeze(r),r}(this,t),this.id=this.props.id,this.count=Dm++}clone(e){const{props:t}=this,n={};for(const i in t[he])i in t[fe]?n[i]=t[fe][i]:i in t[de]&&(n[i]=t[de][i]);return new this.constructor(a(a(a({},t),n),e))}}Cm.componentName="Component",Cm.defaultProps={};const Im=Cm,Rm=Object.freeze({});class Pm{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Rm}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[le]||this.component;const t=e[fe]||{},n=e[de]||e,i=e[he]||{};for(const r in t){const e=t[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,e),t[r]=this.getAsyncProp(r)}for(const r in n){const e=n[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,e)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){this._didAsyncInputValueChange(e,t)&&("string"===typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):Rh(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.resolvedValue&&t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then(t=>{this.component&&(t=this._postProcessValue(n,t),this._setAsyncPropValue(e,t,i),this._onResolve(e,t))}).catch(t=>{this._onError(e,t)})}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let r=[],o=0;var s,a=!1,l=!1;try{for(var c,u=Yt(t);a=!(c=await u.next()).done;a=!1){const t=c.value;{if(!this.component)return;const{dataTransform:n}=this.component.props;r=n?n(t,r):r.concat(t),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:o,endRow:r.length}]}),o=r.length,this._setAsyncPropValue(e,r,i)}}}catch(h){l=!0,s=h}finally{try{a&&null!=u.return&&await u.return()}finally{if(l)throw s}}this._onResolve(e,r)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[ce];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Mm extends Pm{constructor(e){let{attributeManager:t,layer:n}=e;super(n),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=null===n||void 0===n?void 0:n.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;"data"===e&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const Fm=2**24-1,Lm=Object.freeze([]),km=us(e=>{let{oldViewport:t,viewport:n}=e;return t.equals(n)});let Om=new Uint8ClampedArray(0);const Bm={data:{type:"data",value:Lm,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,t)=>{let{propName:n,layer:i,loaders:r,loadOptions:o,signal:s}=t;const{resourceManager:l}=i.context;var c;(o=o||i.getLoadOptions(),r=r||i.props.loaders,s)&&(o=a(a({},o),{},{fetch:a(a({},null===(c=o)||void 0===c?void 0:c.fetch),{},{signal:s})}));let u=l.contains(e);return u||o||(l.add({resourceId:e,data:Cn(e,r),persistent:!1}),u=!0),u?l.subscribe({resourceId:e,onChange:e=>{var t;return null===(t=i.internalState)||void 0===t?void 0:t.reloadAsyncProp(n,e)},consumerId:i.id,requestId:n}):Cn(e,r,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:eo.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:e=>{let{layerIndex:t}=e;return[0,100*-t]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class zm extends Im{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ne,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Co(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=fm(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,o]=Qi(n,t.pixelProjectionMatrix);return 2===e.length?[i,r]:[i,r,o]}unproject(e){Co(this.internalState);return(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Co(this.internalState);return pm(e,a({viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem},t))}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(){for(const e of this.getModels())e.shaderInputs.setProps(...arguments)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===eo.DEFAULT||e===eo.LNGLAT||e===eo.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Co(e instanceof Uint8Array);const[t,n,i]=e;return t+256*n+65536*i-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:cm(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return null===(e=this.getAttributeManager())||void 0===e?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=um(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=um(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const i of n)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:n}=e,i=this.internalState.hasPickingBuffer,r=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(e=>e.getNeedsPickingBuffer.call(this,e));if(i!==r){this.internalState.hasPickingBuffer=r;const{pickingColors:e,instancePickingColors:n}=t.attributes,i=e||n;i&&(r&&i.constant&&(i.constant=!1,t.invalidate(i.id)),i.value||r||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo(e){let{info:t,mode:n,sourceLayer:i}=e;const{index:r}=t;return r>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[r]),t}raiseError(e,t){var n,i,r,o;(t&&(e=new Error("".concat(t,": ").concat(e.message),{cause:e})),null!==(n=(i=this.props).onError)&&void 0!==n&&n.call(i,e))||(null===(r=this.context)||void 0===r||null===(o=r.onError)||void 0===o||o.call(r,e,this))}getNeedsRedraw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var e;return(null===(e=this.internalState)||void 0===e?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,t&&km({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";const t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const e in t)Object.defineProperty(n,e,{value:t[e]});return n}return this.props}calculateInstancePickingColors(e,t){let{numInstances:n}=t;if(e.constant)return;const i=Math.floor(Om.length/4);if(this.internalState.usesPickingColorCache=!0,i<n){n>Fm&&Le.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Om=Pn.allocate(Om,n,{size:4,copy:!0,maxCount:Math.max(n,Fm)});const e=Math.floor(Om.length/4),t=[0,0,0];for(let n=i;n<e;n++)this.encodePickingColor(n,t),Om[4*n+0]=t[0],Om[4*n+1]=t[1],Om[4*n+2]=t[2],Om[4*n+3]=0}e.value=Om.subarray(0,4*n)}_setModelAttributes(e,t){var n;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!Object.keys(t).length)return;if(i){const n=this.getAttributeManager();e.setBufferLayout(n.getBufferLayouts(e)),t=n.getAttributes()}const r=(null===(n=e.userData)||void 0===n?void 0:n.excludeAttributes)||{},o={},s={};for(const a in t){if(r[a])continue;const n=t[a].getValue();for(const i in n){const r=n[i];r instanceof Oa?t[a].settings.isIndexed?e.setIndexBuffer(r):o[i]=r:r&&(s[i]=r)}}e.setAttributes(o),e.setConstantAttributes(s)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i,o=r&&t.attributes&&t.attributes[r.id];if(o&&o.value){const n=o.value,i=this.encodePickingColor(e);for(let e=0;e<t.length;e++){const t=r.getVertexOffset(e);n[t]===i[0]&&n[t+1]===i[1]&&n[t+2]===i[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const r=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-r),r)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Om.buffer&&(n.value=Om.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Co(!this.internalState),Co(Number.isFinite(this.props.coordinateSystem)),Be("layer.initialize",this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Mm({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Le.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new nm(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Be("layer.matched",this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Be("layer.update",this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,r=n.viewport,o=this._updateUniformTransition();i.propsInTransition=o,n.viewport=i.viewport||r,this.props=o;try{const e=this._getUpdateParams(),t=this.getModels();if(n.device)this.updateState(e);else try{this.updateState(e)}catch(s){}for(const n of this.props.extensions)n.updateState.call(this,e,n);this.setNeedsRedraw(),this._updateAttributes();const i=this.getModels()[0]!==t[0];this._postUpdate(e,i)}finally{n.viewport=r,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Be("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer(e){let{renderPass:t,shaderModuleProps:n=null,uniforms:i={},parameters:r={}}=e;this._updateAttributeTransition();const o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:e}=this.props,o=e&&e(i)||[0,0];s.device instanceof Fu&&s.device.setParametersWebGL({polygonOffset:o});for(const t of this.getModels())"webgpu"===t.device.type?t.setParameters(a(a({},t.parameters),r)):t.setParameters(r);if(s.device instanceof Fu)s.device.withParametersWebGL(r,()=>{const e={renderPass:t,shaderModuleProps:n,uniforms:i,parameters:r,context:s};for(const t of this.props.extensions)t.draw.call(this,e,t);this.draw(e)});else{const e={renderPass:t,shaderModuleProps:n,uniforms:i,parameters:r,context:s};for(const t of this.props.extensions)t.draw.call(this,e,t);this.draw(e)}}finally{this.props=o}}getChangeFlags(){var e;return null===(e=this.internalState)||void 0===e?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let n=!1;if("dataChanged"===i){const r=e[i],o=t[i];r&&Array.isArray(o)&&(t.dataChanged=Array.isArray(r)?o.concat(r):r,n=!0)}t[i]||(t[i]=e[i],n=!0),n&&Be("layer.changeFlag",this,i,e)}const n=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const n=im(e,t);if(n.updateTriggersChanged)for(const r in n.updateTriggersChanged)n.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(n.transitionsChanged)for(const r in n.transitionsChanged){var i;this.internalState.uniformTransitions.add(r,t[r],e[r],null===(i=e.transitions)||void 0===i?void 0:i[r])}return this.setChangeFlags(n)}validateProps(){!function(e){const t=e[ce];for(const n in t){const i=t[n],{validate:r}=i;if(r&&!r(e[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(e[n]))}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&"function"===typeof n&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Jp(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e,r=this.state.model;null!==r&&void 0!==r&&r.isInstanced&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:s,highlightColor:a}=n;if(t||i.autoHighlight!==o||i.highlightedObjectIndex!==s||i.highlightColor!==a){const e={};Array.isArray(a)&&(e.highlightColor=a),(t||i.autoHighlight!==o||s!==i.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=!!n&&n.getNeedsRedraw(e);if(t=t||i,t)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}zm.defaultProps=Bm,zm.layerName="Layer";const Nm=zm,Um={name:"project32",dependencies:[Cs],source:"// Define a structure to hold both the clip-space position and the common position.\nstruct ProjectResult {\n  clipPosition: vec4<f32>,\n  commonPosition: vec4<f32>,\n};\n\n// This function mimics the GLSL version with the 'out' parameter by returning both values.\nfn project_position_to_clipspace_and_commonspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> ProjectResult {\n  // Compute the projected position.\n  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);\n\n  // Start with the provided offset.\n  var finalOffset: vec3<f32> = offset;\n\n  // Get whether a rotation is needed and the rotation matrix.\n  let rotationResult = project_needs_rotation(projectedPosition);\n\n  // If rotation is needed, update the offset.\n  if (rotationResult.needsRotation) {\n    finalOffset = rotationResult.transform * offset;\n  }\n\n  // Compute the common position.\n  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);\n\n  // Convert to clip-space.\n  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);\n\n  return ProjectResult(clipPosition, commonPosition);\n}\n\n// A convenience overload that returns only the clip-space position.\nfn project_position_to_clipspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> vec4<f32> {\n  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;\n}\n",vs:"vec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"},Vm={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!bool(picking.isAttribute)) {\n      // Stores the picking color so that the fragment shader can render it during picking\n      picking_vRGBcolor_Avalid.rgb = pickingColor;\n    }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n",getUniforms:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const n=e.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=n}if(e.highlightColor){const n=Array.from(e.highlightColor,e=>e/255);Number.isFinite(n[3])||(n[3]=1),t.highlightColor=n}void 0!==e.isActive&&(t.isActive=Boolean(e.isActive),t.isAttribute=Boolean(e.isAttribute));void 0!==e.useFloatColors&&(t.useFloatColors=Boolean(e.useFloatColors));return t}};const jm=a(a({},Vm),{},{defaultUniforms:a(a({},Vm.defaultUniforms),{},{useFloatColors:!1}),inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}}),Gm="uniform arcUniforms {\n  bool greatCircle;\n  bool useShortestPath;\n  float numSegments;\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  highp int widthUnits;\n} arc;\n",Hm={name:"arc",vs:Gm,fs:Gm,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},Wm=[0,0,0,255],qm={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:Wm},getTargetColor:{type:"accessor",value:Wm},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Xm extends Nm{getBounds(){var e;return null===(e=this.getAttributeManager())||void 0===e?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME arc-layer-vertex-shader\nin vec4 instanceSourceColors;\nin vec4 instanceTargetColors;\nin vec3 instanceSourcePositions;\nin vec3 instanceSourcePositions64Low;\nin vec3 instanceTargetPositions;\nin vec3 instanceTargetPositions64Low;\nin vec3 instancePickingColors;\nin float instanceWidths;\nin float instanceHeights;\nin float instanceTilts;\nout vec4 vColor;\nout vec2 uv;\nout float isValid;\nfloat paraboloid(float distance, float sourceZ, float targetZ, float ratio) {\nfloat deltaZ = targetZ - sourceZ;\nfloat dh = distance * instanceHeights;\nif (dh == 0.0) {\nreturn sourceZ + deltaZ * ratio;\n}\nfloat unitZ = deltaZ / dh;\nfloat p2 = unitZ * unitZ + 1.0;\nfloat dir = step(deltaZ, 0.0);\nfloat z0 = mix(sourceZ, targetZ, dir);\nfloat r = mix(ratio, 1.0 - ratio, dir);\nreturn sqrt(r * (p2 - r)) * dh + z0;\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\nvec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn dir_screenspace * offset_direction * width / 2.0;\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));\n}\nvec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {\nfloat distance = length(source.xy - target.xy);\nfloat z = paraboloid(distance, source.z, target.z, segmentRatio);\nfloat tiltAngle = radians(instanceTilts);\nvec2 tiltDirection = normalize(target.xy - source.xy);\nvec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\nreturn vec3(\nmix(source.xy, target.xy, segmentRatio) + tilt,\nz * cos(tiltAngle)\n);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\nvec2 sourceRadians = radians(source);\nvec2 targetRadians = radians(target);\nvec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);\nvec2 shd_sq = sin_half_delta * sin_half_delta;\nfloat a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;\nreturn 2.0 * asin(sqrt(a));\n}\nvec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {\nvec2 lngLat;\nif(abs(angularDist - PI) < 0.001) {\nlngLat = (1.0 - t) * source.xy + t * target.xy;\n} else {\nfloat a = sin((1.0 - t) * angularDist);\nfloat b = sin(t * angularDist);\nvec3 p = source3D.yxz * a + target3D.yxz * b;\nlngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));\n}\nfloat z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);\nreturn vec3(lngLat, z);\n}\nvoid main(void) {\ngeometry.worldPosition = instanceSourcePositions;\ngeometry.worldPositionAlt = instanceTargetPositions;\nfloat segmentIndex = float(gl_VertexID / 2);\nfloat segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));\nfloat nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nisValid = 1.0;\nuv = vec2(segmentRatio, segmentSide);\ngeometry.uv = uv;\ngeometry.pickingColor = instancePickingColors;\nvec4 curr;\nvec4 next;\nvec3 source;\nvec3 target;\nif ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nsource = project_globe_(vec3(instanceSourcePositions.xy, 0.0));\ntarget = project_globe_(vec3(instanceTargetPositions.xy, 0.0));\nfloat angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);\nvec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);\nvec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);\nvec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);\nif (abs(currPos.x - prevPos.x) > 180.0) {\nindexDir = -1.0;\nisValid = 0.0;\n} else if (abs(currPos.x - nextPos.x) > 180.0) {\nindexDir = 1.0;\nisValid = 0.0;\n}\nnextPos = indexDir < 0.0 ? prevPos : nextPos;\nnextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\nif (isValid == 0.0) {\nnextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;\nfloat t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);\ncurrPos = mix(currPos, nextPos, t);\nsegmentRatio = mix(segmentRatio, nextSegmentRatio, t);\n}\nvec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\nvec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\ncurr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\nnext = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n} else {\nvec3 source_world = instanceSourcePositions;\nvec3 target_world = instanceTargetPositions;\nif (arc.useShortestPath) {\nsource_world.x = mod(source_world.x + 180., 360.0) - 180.;\ntarget_world.x = mod(target_world.x + 180., 360.0) - 180.;\nfloat deltaLng = target_world.x - source_world.x;\nif (deltaLng > 180.) target_world.x -= 360.;\nif (deltaLng < -180.) source_world.x -= 360.;\n}\nsource = project_position(source_world, instanceSourcePositions64Low);\ntarget = project_position(target_world, instanceTargetPositions64Low);\nfloat antiMeridianX = 0.0;\nif (arc.useShortestPath) {\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nantiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;\n}\nfloat thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);\nif (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {\nisValid = 0.0;\nindexDir = sign(segmentRatio - thresholdRatio);\nsegmentRatio = thresholdRatio;\n}\n}\nnextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\nvec3 currPos = interpolateFlat(source, target, segmentRatio);\nvec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);\nif (arc.useShortestPath) {\nif (nextPos.x < antiMeridianX) {\ncurrPos.x += TILE_SIZE;\nnextPos.x += TILE_SIZE;\n}\n}\ncurr = project_common_position_to_clipspace(vec4(currPos, 1.0));\nnext = project_common_position_to_clipspace(vec4(nextPos, 1.0));\ngeometry.position = vec4(currPos, 1.0);\n}\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),\narc.widthMinPixels, arc.widthMaxPixels\n);\nvec3 offset = vec3(\ngetExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),\n0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\nDECKGL_FILTER_GL_POSITION(curr, geometry);\ngl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\nvec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\nvColor = vec4(color.rgb, color.a * layer.opacity);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME arc-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 uv;\nin float isValid;\nout vec4 fragColor;\nvoid main(void) {\nif (isValid == 0.0) {\ndiscard;\n}\nfragColor = vColor;\ngeometry.uv = uv;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[Um,jm,Hm]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:Wm},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:Wm},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){var t;(super.updateState(e),e.changeFlags.extensionsChanged)&&(null===(t=this.state.model)||void 0===t||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw(e){let{uniforms:t}=e;const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:o,greatCircle:s,wrapLongitude:a,numSegments:l}=this.props,c={numSegments:l,widthUnits:no[n],widthScale:i,widthMinPixels:r,widthMaxPixels:o,greatCircle:s,useShortestPath:a},u=this.state.model;u.shaderInputs.setProps({arc:c}),u.setVertexCount(2*l),u.draw(this.context.renderPass)}_getModel(){return new Sp(this.context.device,a(a({},this.getShaders()),{},{id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0}))}}Xm.layerName="ArcLayer",Xm.defaultProps=qm;const Zm=Xm;class Ym{constructor(e){o(this,"id",void 0),o(this,"topology",void 0),o(this,"vertexCount",void 0),o(this,"indices",void 0),o(this,"attributes",void 0),o(this,"userData",{});const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||hp("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[r,o]of Object.entries(t)){const e=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(e.value))throw new Error("".concat(this._print(r),": must be typed array or object with value as typed array"));if("POSITION"!==r&&"positions"!==r||e.size||(e.size=3),"indices"===r){if(this.indices)throw new Error("Multiple indices detected");this.indices=e}else this.attributes[r]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?a({indices:this.indices},this.attributes):this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:e,size:t,constant:r}=i;!r&&e&&void 0!==t&&t>=1&&(n=Math.min(n,e.length/t))}return n}}const Km="uniform scatterplotUniforms {\n  float radiusScale;\n  float radiusMinPixels;\n  float radiusMaxPixels;\n  float lineWidthScale;\n  float lineWidthMinPixels;\n  float lineWidthMaxPixels;\n  float stroked;\n  float filled;\n  bool antialiasing;\n  bool billboard;\n  highp int radiusUnits;\n  highp int lineWidthUnits;\n} scatterplot;\n",Jm={name:"scatterplot",vs:Km,fs:Km,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Qm=[0,0,0,255],$m={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Qm},getLineColor:{type:"accessor",value:Qm},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class eg extends Nm{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-vertex-shader\nin vec3 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceRadius;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout vec2 unitPosition;\nout float innerUnitRadius;\nout float outerRadiusPixels;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nouterRadiusPixels = clamp(\nproject_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),\nscatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n);\nfloat lineWidthPixels = clamp(\nproject_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),\nscatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n);\nouterRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\nfloat edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\nunitPosition = edgePadding * positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\ninnerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;\nif (scatterplot.billboard) {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = edgePadding * positions * outerRadiusPixels;\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-fragment-shader\nprecision highp float;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin vec2 unitPosition;\nin float innerUnitRadius;\nin float outerRadiusPixels;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition) * outerRadiusPixels;\nfloat inCircle = scatterplot.antialiasing ?\nsmoothedge(distToCenter, outerRadiusPixels) :\nstep(distToCenter, outerRadiusPixels);\nif (inCircle == 0.0) {\ndiscard;\n}\nif (scatterplot.stroked > 0.5) {\nfloat isLine = scatterplot.antialiasing ?\nsmoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\nstep(innerUnitRadius * outerRadiusPixels, distToCenter);\nif (scatterplot.filled > 0.5) {\nfragColor = mix(vFillColor, vLineColor, isLine);\n} else {\nif (isLine == 0.0) {\ndiscard;\n}\nfragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n}\n} else if (scatterplot.filled < 0.5) {\ndiscard;\n} else {\nfragColor = vFillColor;\n}\nfragColor.a *= inCircle;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",source:'// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)\n\nstruct LayerUniforms {\n  opacity: f32,\n};\n\nvar<private> layer: LayerUniforms = LayerUniforms(1.0);\n// @group(0) @binding(1) var<uniform> layer: LayerUniforms;\n\n// Main shaders\n\nstruct ScatterplotUniforms {\n  radiusScale: f32,\n  radiusMinPixels: f32,\n  radiusMaxPixels: f32,\n  lineWidthScale: f32,\n  lineWidthMinPixels: f32,\n  lineWidthMaxPixels: f32,\n  stroked: f32,\n  filled: i32,\n  antialiasing: i32,\n  billboard: i32,\n  radiusUnits: i32,\n  lineWidthUnits: i32,\n};\n\nstruct ConstantAttributeUniforms {\n instancePositions: vec3<f32>,\n instancePositions64Low: vec3<f32>,\n instanceRadius: f32,\n instanceLineWidths: f32,\n instanceFillColors: vec4<f32>,\n instanceLineColors: vec4<f32>,\n instancePickingColors: vec3<f32>,\n\n instancePositionsConstant: i32,\n instancePositions64LowConstant: i32,\n instanceRadiusConstant: i32,\n instanceLineWidthsConstant: i32,\n instanceFillColorsConstant: i32,\n instanceLineColorsConstant: i32,\n instancePickingColorsConstant: i32\n};\n\n@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;\n\nstruct ConstantAttributes {\n  instancePositions: vec3<f32>,\n  instancePositions64Low: vec3<f32>,\n  instanceRadius: f32,\n  instanceLineWidths: f32,\n  instanceFillColors: vec4<f32>,\n  instanceLineColors: vec4<f32>,\n  instancePickingColors: vec3<f32>\n};\n\nconst constants = ConstantAttributes(\n  vec3<f32>(0.0),\n  vec3<f32>(0.0),\n  0.0,\n  0.0,\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec3<f32>(0.0)\n);\n\nstruct Attributes {\n  @builtin(instance_index) instanceIndex : u32,\n  @builtin(vertex_index) vertexIndex : u32,\n  @location(0) positions: vec3<f32>,\n  @location(1) instancePositions: vec3<f32>,\n  @location(2) instancePositions64Low: vec3<f32>,\n  @location(3) instanceRadius: f32,\n  @location(4) instanceLineWidths: f32,\n  @location(5) instanceFillColors: vec4<f32>,\n  @location(6) instanceLineColors: vec4<f32>,\n  @location(7) instancePickingColors: vec3<f32>\n};\n\nstruct Varyings {\n  @builtin(position) position: vec4<f32>,\n  @location(0) vFillColor: vec4<f32>,\n  @location(1) vLineColor: vec4<f32>,\n  @location(2) unitPosition: vec2<f32>,\n  @location(3) innerUnitRadius: f32,\n  @location(4) outerRadiusPixels: f32,\n};\n\n@vertex\nfn vertexMain(attributes: Attributes) -> Varyings {\n  var varyings: Varyings;\n\n  // Draw an inline geometry constant array clip space triangle to verify that rendering works.\n  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));\n  // if (attributes.instanceIndex == 0) {\n  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);\n  //   return varyings;\n  // }\n\n  // var geometry: Geometry;\n  // geometry.worldPosition = instancePositions;\n\n  // Multiply out radius and clamp to limits\n  varyings.outerRadiusPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),\n    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n  );\n\n  // Multiply out line width and clamp to limits\n  let lineWidthPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),\n    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n  );\n\n  // outer radius needs to offset by half stroke width\n  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\n  // Expand geometry to accommodate edge smoothing\n  let edgePadding = select(\n    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,\n    1.0,\n    scatterplot.antialiasing != 0\n  );\n\n  // position on the containing square in [-1, 1] space\n  varyings.unitPosition = edgePadding * attributes.positions.xy;\n  geometry.uv = varyings.unitPosition;\n  geometry.pickingColor = attributes.instancePickingColors;\n\n  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;\n\n  if (scatterplot.billboard != 0) {\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    let clipPixels = project_pixel_size_to_clipspace(offset.xy);\n    varyings.position.x = clipPixels.x;\n    varyings.position.y = clipPixels.y;\n  } else {\n    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n  }\n\n  // Apply opacity to instance color, or return instance picking color\n  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);\n  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);\n\n  return varyings;\n}\n\n@fragment\nfn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {\n  // var geometry: Geometry;\n  // geometry.uv = unitPosition;\n\n  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;\n  let inCircle = select(\n    smoothedge(distToCenter, varyings.outerRadiusPixels),\n    step(distToCenter, varyings.outerRadiusPixels),\n    scatterplot.antialiasing != 0\n  );\n\n  if (inCircle == 0.0) {\n    // discard;\n  }\n\n  var fragColor: vec4<f32>;\n\n  if (scatterplot.stroked != 0) {\n    let isLine = select(\n      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      scatterplot.antialiasing != 0\n    );\n\n    if (scatterplot.filled != 0) {\n      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        // discard;\n      }\n      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);\n    }\n  } else if (scatterplot.filled == 0) {\n    // discard;\n  } else {\n    fragColor = varyings.vFillColor;\n  }\n\n  fragColor.a *= inCircle;\n  // DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  return fragColor;\n  // return vec4<f32>(0, 0, 1, 1);\n}\n',modules:[Um,jm,Jm]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;(super.updateState(e),e.changeFlags.extensionsChanged)&&(null===(t=this.state.model)||void 0===t||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw(e){let{uniforms:t}=e;const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:o,stroked:s,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:d,lineWidthMaxPixels:f}=this.props,p={stroked:s,filled:a,billboard:l,antialiasing:c,radiusUnits:no[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:o,lineWidthUnits:no[u],lineWidthScale:h,lineWidthMinPixels:d,lineWidthMaxPixels:f},m=this.state.model;m.shaderInputs.setProps({scatterplot:p}),m.draw(this.context.renderPass)}_getModel(){return new Sp(this.context.device,a(a({},this.getShaders()),{},{id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ym({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0}))}}eg.defaultProps=$m,eg.layerName="ScatterplotLayer";const tg=eg,ng="precision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int lightType;\n\n  int directionalLightCount;\n  int pointLightCount;\n\n  vec3 ambientColor;\n\n  vec3 lightColor0;\n  vec3 lightPosition0;\n  vec3 lightDirection0;\n  vec3 lightAttenuation0;\n\n  vec3 lightColor1;\n  vec3 lightPosition1;\n  vec3 lightDirection1;\n  vec3 lightAttenuation1;\n\n  vec3 lightColor2;\n  vec3 lightPosition2;\n  vec3 lightDirection2;\n  vec3 lightAttenuation2;\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  switch (index) {\n    case 0:\n      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);\n    case 1:\n      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);\n    case 2:\n    default:  \n      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);\n  }\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  switch (index) {\n    case 0:\n      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);\n    case 1:\n      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);\n    case 2:\n    default:   \n      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);\n  }\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n";var ig;!function(e){e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL"}(ig||(ig={}));const rg={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:3},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:ig.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:"// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  color: vec3<f32>,\n};\n\nstruct PointLight {\n  color: vec3<f32>,\n  position: vec3<f32>,\n  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  color: vec3<f32>,\n  direction: vec3<f32>,\n};\n\nstruct lightingUniforms {\n  enabled: i32,\n  pointLightCount: i32,\n  directionalLightCount: i32,\n\n  ambientColor: vec3<f32>,\n\n  // TODO - support multiple lights by uncommenting arrays below\n  lightType: i32,\n  lightColor: vec3<f32>,\n  lightDirection: vec3<f32>,\n  lightPosition: vec3<f32>,\n  lightAttenuation: vec3<f32>,\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n};\n\n// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)\n@binding(1) @group(0) var<uniform> lighting : lightingUniforms;\n\nfn lighting_getPointLight(index: i32) -> PointLight {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nfn lighting_getDirectionalLight(index: i32) -> DirectionalLight {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n",vs:ng,fs:ng,getUniforms:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e=e?a({},e):e))return a({},rg.defaultUniforms);e.lights&&(e=a(a(a({},e),function(e){var t,n;const i={pointLights:[],directionalLights:[]};for(const r of e||[])switch(r.type){case"ambient":i.ambientLight=r;break;case"directional":null===(t=i.directionalLights)||void 0===t||t.push(r);break;case"point":null===(n=i.pointLights)||void 0===n||n.push(r)}return i}(e.lights)),{},{lights:void 0}));const{ambientLight:n,pointLights:i,directionalLights:r}=e||{};if(!(n||i&&i.length>0||r&&r.length>0))return a(a({},rg.defaultUniforms),{},{enabled:0});const o=a(a(a({},rg.defaultUniforms),t),function(e){let{ambientLight:t,pointLights:n=[],directionalLights:i=[]}=e;const r={};r.ambientLightColor=og(t);let o=0;for(const s of n){r.lightType=ig.POINT;const e=o;r["lightColor".concat(e)]=og(s),r["lightPosition".concat(e)]=s.position,r["lightAttenuation".concat(e)]=s.attenuation||[1,0,0],o++}for(const s of i){r.lightType=ig.DIRECTIONAL;const e=o;r["lightColor".concat(e)]=og(s),r["lightDirection".concat(e)]=s.direction,o++}o>3&&Ma.warn("MAX_LIGHTS exceeded")();return r.directionalLightCount=i.length,r.pointLightCount=n.length,r}({ambientLight:n,pointLights:i,directionalLights:r}));void 0!==e.enabled&&(o.enabled=e.enabled?1:0);return o}};function og(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{color:t=[0,0,0],intensity:n=1}=e;return t.map(e=>e*n/255)}const sg="struct phongMaterialUniforms {\n  ambient: f32,\n  diffuse: f32,\n  shininess: f32,\n  specularColor: vec3<f32>,\n};\n\n@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;\n\nfn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {\n  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);\n  var lambertian: f32 = dot(light_direction, normal_worldspace);\n  var specular: f32 = 0.0;\n  if (lambertian > 0.0) {\n    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, phongMaterial.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;\n}\n\nfn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {\n  var lightColor: vec3<f32> = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);\n  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    let pointLight: PointLight  = lighting_getPointLight(0);\n    let light_position_worldspace: vec3<f32> = pointLight.position;\n    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n}\n\nfn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{\n  var lightColor = vec3<f32>(0, 0, 0);\n  let surfaceColor = vec3<f32>(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    let view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0, default: {\n        let pointLight: PointLight = lighting_getPointLight(0);\n        let light_position_worldspace: vec3<f32> = pointLight.position;\n        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n      }\n      case 1: {\n        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n      }\n    }\n  }\n  return lightColor;\n}\n",ag="uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n",lg="uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  for (int i = 0; i < lighting.pointLightCount; i++) {\n    PointLight pointLight = lighting_getPointLight(i);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);\n  }\n\n  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);\n  for (int i = lighting.pointLightCount; i < totalLights; i++) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(i);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n}\n",cg={name:"phongMaterial",dependencies:[rg],source:sg,vs:ag,fs:lg,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t=a({},e);return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),a(a({},cg.defaultUniforms),t)}},ug={props:{},name:"gouraudMaterial",vs:lg.replace("phongMaterial","gouraudMaterial"),fs:ag.replace("phongMaterial","gouraudMaterial"),source:sg.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[rg],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t=a({},e);return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),a(a({},ug.defaultUniforms),t)}},hg=-1;function dg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Math.sign(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{start:n=0,end:i=e.length,plane:r="xy"}=t,o=t.size||2;let s=0;const a=fg[r[0]],l=fg[r[1]];for(let c=n,u=i-o;c<i;c+=o)s+=(e[c+a]-e[u+a])*(e[c+l]+e[u+l]),u=c;return s/2}(e,t))}(e,n);return i!==t&&(function(e,t){const{start:n=0,end:i=e.length,size:r=2}=t,o=(i-n)/r,s=Math.floor(o/2);for(let a=0;a<s;++a){const t=n+a*r,i=n+(o-1-a)*r;for(let n=0;n<r;++n){const r=e[t+n];e[t+n]=e[i+n],e[i+n]=r}}}(e,n),!0)}const fg={x:0,y:1,z:2};class pg extends Ym{constructor(e){const{indices:t,attributes:n}=function(e){const{radius:t,height:n=1,nradial:i=10}=e;let{vertices:r}=e;r&&(Le.assert(r.length>=i),r=r.flatMap(e=>[e[0],e[1]]),dg(r,hg));const o=n>0,s=i+1,a=o?3*s+1:i,l=2*Math.PI/i,c=new Uint16Array(o?3*i*2:0),u=new Float32Array(3*a),h=new Float32Array(3*a);let d=0;if(o){for(let e=0;e<s;e++){const o=e*l,s=e%i,a=Math.sin(o),c=Math.cos(o);for(let e=0;e<2;e++)u[d+0]=r?r[2*s]:c*t,u[d+1]=r?r[2*s+1]:a*t,u[d+2]=(.5-e)*n,h[d+0]=r?r[2*s]:c,h[d+1]=r?r[2*s+1]:a,d+=3}u[d+0]=u[d-3],u[d+1]=u[d-2],u[d+2]=u[d-1],d+=3}for(let f=o?0:1;f<s;f++){const e=Math.floor(f/2)*Math.sign(.5-f%2),o=e*l,s=(e+i)%i,a=Math.sin(o),c=Math.cos(o);u[d+0]=r?r[2*s]:c*t,u[d+1]=r?r[2*s+1]:a*t,u[d+2]=n/2,h[d+2]=1,d+=3}if(o){let e=0;for(let t=0;t<i;t++)c[e++]=2*t+0,c[e++]=2*t+2,c[e++]=2*t+0,c[e++]=2*t+1,c[e++]=2*t+1,c[e++]=2*t+3}return{indices:c,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:h}}}}(e);super(a(a({},e),{},{indices:t,attributes:n}))}}const mg="uniform columnUniforms {\n  float radius;\n  float angle;\n  vec2 offset;\n  bool extruded;\n  bool stroked;\n  bool isStroke;\n  float coverage;\n  float elevationScale;\n  float edgeDistance;\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  highp int radiusUnits;\n  highp int widthUnits;\n} column;\n",gg={name:"column",vs:mg,fs:mg,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},_g=[0,0,0,255],yg={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:_g},getLineColor:{type:"accessor",value:_g},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class vg extends Nm{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:"#version 300 es\n#define SHADER_NAME column-layer-vertex-shader\nin vec3 positions;\nin vec3 normals;\nin vec3 instancePositions;\nin float instanceElevations;\nin vec3 instancePositions64Low;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin float instanceStrokeWidths;\nin vec3 instancePickingColors;\nout vec4 vColor;\n#ifdef FLAT_SHADING\nout vec3 cameraPosition;\nout vec4 position_commonspace;\n#endif\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nvec4 color = column.isStroke ? instanceLineColors : instanceFillColors;\nmat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));\nfloat elevation = 0.0;\nfloat strokeOffsetRatio = 1.0;\nif (column.extruded) {\nelevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;\n} else if (column.stroked) {\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),\ncolumn.widthMinPixels, column.widthMaxPixels) / 2.0;\nfloat halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);\nif (column.isStroke) {\nstrokeOffsetRatio -= sign(positions.z) * halfOffset;\n} else {\nstrokeOffsetRatio -= halfOffset;\n}\n}\nfloat shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\nfloat dotRadius = column.radius * column.coverage * shouldRender;\ngeometry.pickingColor = instancePickingColors;\nvec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\nvec3 centroidPosition64Low = instancePositions64Low;\nvec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;\nif (column.radiusUnits == UNIT_METERS) {\noffset = project_size(offset);\n}\nvec3 pos = vec3(offset, 0.);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\ngeometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (column.extruded && !column.isStroke) {\n#ifdef FLAT_SHADING\ncameraPosition = project.cameraPosition;\nposition_commonspace = geometry.position;\nvColor = vec4(color.rgb, color.a * layer.opacity);\n#else\nvec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, color.a * layer.opacity);\n#endif\n} else {\nvColor = vec4(color.rgb, color.a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME column-layer-fragment-shader\nprecision highp float;\nout vec4 fragColor;\nin vec4 vColor;\n#ifdef FLAT_SHADING\nin vec3 cameraPosition;\nin vec4 position_commonspace;\n#endif\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\n#ifdef FLAT_SHADING\nif (column.extruded && !column.isStroke && !bool(picking.isActive)) {\nvec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\nfragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);\n}\n#endif\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:e,modules:[Um,t?cg:ug,jm,gg]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:_g},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:_g},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,r=i.extensionsChanged||t.flatShading!==n.flatShading;var o;r&&(null===(o=this.state.models)||void 0===o||o.forEach(e=>e.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const s=this.getNumInstances();this.state.fillModel.setInstanceCount(s),this.state.wireframeModel.setInstanceCount(s),(r||t.diskResolution!==n.diskResolution||t.vertices!==n.vertices||(t.extruded||t.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(t)}getGeometry(e,t,n){const i=new pg({radius:1,height:n?2:0,vertices:t,nradial:e});let r=0;if(t)for(let o=0;o<e;o++){const n=t[o];r+=Math.sqrt(n[0]*n[0]+n[1]*n[1])/e}else r=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*r}),i}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),n=new Sp(this.context.device,a(a({},e),{},{id:"".concat(this.props.id,"-fill"),bufferLayout:t,isInstanced:!0})),i=new Sp(this.context.device,a(a({},e),{},{id:"".concat(this.props.id,"-wireframe"),bufferLayout:t,isInstanced:!0}));return{fillModel:n,wireframeModel:i,models:[i,n]}}_updateGeometry(e){let{diskResolution:t,vertices:n,extruded:i,stroked:r}=e;const o=this.getGeometry(t,n,i||r);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});const s=this.state.fillModel,a=this.state.wireframeModel;s.setGeometry(o),s.setTopology("triangle-strip"),s.setIndexBuffer(null),a.setGeometry(o),a.setTopology("line-list")}draw(e){let{uniforms:t}=e;const{lineWidthUnits:n,lineWidthScale:i,lineWidthMinPixels:r,lineWidthMaxPixels:o,radiusUnits:s,elevationScale:l,extruded:c,filled:u,stroked:h,wireframe:d,offset:f,coverage:p,radius:m,angle:g}=this.props,_=this.state.fillModel,y=this.state.wireframeModel,{fillVertexCount:v,edgeDistance:x}=this.state,b={radius:m,angle:g/180*Math.PI,offset:f,extruded:c,stroked:h,coverage:p,elevationScale:l,edgeDistance:x,radiusUnits:no[s],widthUnits:no[n],widthScale:i,widthMinPixels:r,widthMaxPixels:o};c&&d&&(y.shaderInputs.setProps({column:a(a({},b),{},{isStroke:!0})}),y.draw(this.context.renderPass)),u&&(_.setVertexCount(v),_.shaderInputs.setProps({column:a(a({},b),{},{isStroke:!1})}),_.draw(this.context.renderPass)),!c&&h&&(_.setVertexCount(2*v/3),_.shaderInputs.setProps({column:a(a({},b),{},{isStroke:!0})}),_.draw(this.context.renderPass))}}vg.layerName="ColumnLayer",vg.defaultProps=yg;const xg=vg;var bg=n(766),wg=n.n(bg);function Eg(){}function Tg(e){return null==e?Eg:function(){return this.querySelector(e)}}function Ag(){return[]}function Sg(e){return null==e?Ag:function(){return this.querySelectorAll(e)}}function Dg(e){return function(){return function(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}function Cg(e){return function(){return this.matches(e)}}function Ig(e){return function(t){return t.matches(e)}}var Rg=Array.prototype.find;function Pg(){return this.firstElementChild}var Mg=Array.prototype.filter;function Fg(){return Array.from(this.children)}function Lg(e){return new Array(e.length)}function kg(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function Og(e,t,n,i,r,o){for(var s,a=0,l=t.length,c=o.length;a<c;++a)(s=t[a])?(s.__data__=o[a],i[a]=s):n[a]=new kg(e,o[a]);for(;a<l;++a)(s=t[a])&&(r[a]=s)}function Bg(e,t,n,i,r,o,s){var a,l,c,u=new Map,h=t.length,d=o.length,f=new Array(h);for(a=0;a<h;++a)(l=t[a])&&(f[a]=c=s.call(l,l.__data__,a,t)+"",u.has(c)?r[a]=l:u.set(c,l));for(a=0;a<d;++a)c=s.call(e,o[a],a,o)+"",(l=u.get(c))?(i[a]=l,l.__data__=o[a],u.delete(c)):n[a]=new kg(e,o[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(f[a])===l&&(r[a]=l)}function zg(e){return e.__data__}function Ng(e){return"object"===typeof e&&"length"in e?e:Array.from(e)}function Ug(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}kg.prototype={constructor:kg,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var Vg="http://www.w3.org/1999/xhtml";const jg={svg:"http://www.w3.org/2000/svg",xhtml:Vg,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Gg(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),jg.hasOwnProperty(t)?{space:jg[t],local:e}:e}function Hg(e){return function(){this.removeAttribute(e)}}function Wg(e){return function(){this.removeAttributeNS(e.space,e.local)}}function qg(e,t){return function(){this.setAttribute(e,t)}}function Xg(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Zg(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function Yg(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Kg(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Jg(e){return function(){this.style.removeProperty(e)}}function Qg(e,t,n){return function(){this.style.setProperty(e,t,n)}}function $g(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function e_(e,t){return e.style.getPropertyValue(t)||Kg(e).getComputedStyle(e,null).getPropertyValue(t)}function t_(e){return function(){delete this[e]}}function n_(e,t){return function(){this[e]=t}}function i_(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function r_(e){return e.trim().split(/^|\s+/)}function o_(e){return e.classList||new s_(e)}function s_(e){this._node=e,this._names=r_(e.getAttribute("class")||"")}function a_(e,t){for(var n=o_(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function l_(e,t){for(var n=o_(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function c_(e){return function(){a_(this,e)}}function u_(e){return function(){l_(this,e)}}function h_(e,t){return function(){(t.apply(this,arguments)?a_:l_)(this,e)}}function d_(){this.textContent=""}function f_(e){return function(){this.textContent=e}}function p_(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function m_(){this.innerHTML=""}function g_(e){return function(){this.innerHTML=e}}function __(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function y_(){this.nextSibling&&this.parentNode.appendChild(this)}function v_(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function x_(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Vg&&t.documentElement.namespaceURI===Vg?t.createElement(e):t.createElementNS(n,e)}}function b_(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function w_(e){var t=Gg(e);return(t.local?b_:x_)(t)}function E_(){return null}function T_(){var e=this.parentNode;e&&e.removeChild(this)}function A_(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function S_(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function D_(e){return function(){var t=this.__on;if(t){for(var n,i=0,r=-1,o=t.length;i<o;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?t.length=r:delete this.__on}}}function C_(e,t,n){return function(){var i,r=this.__on,o=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=t);this.addEventListener(e.type,o,n),i={type:e.type,name:e.name,value:t,listener:o,options:n},r?r.push(i):this.__on=[i]}}function I_(e,t,n){var i=Kg(e),r=i.CustomEvent;"function"===typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function R_(e,t){return function(){return I_(this,e,t)}}function P_(e,t){return function(){return I_(this,e,t.apply(this,arguments))}}s_.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var M_=[null];function F_(e,t){this._groups=e,this._parents=t}function L_(){return new F_([[document.documentElement]],M_)}F_.prototype=L_.prototype={constructor:F_,select:function(e){"function"!==typeof e&&(e=Tg(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o,s,a=t[r],l=a.length,c=i[r]=new Array(l),u=0;u<l;++u)(o=a[u])&&(s=e.call(o,o.__data__,u,a))&&("__data__"in o&&(s.__data__=o.__data__),c[u]=s);return new F_(i,this._parents)},selectAll:function(e){e="function"===typeof e?Dg(e):Sg(e);for(var t=this._groups,n=t.length,i=[],r=[],o=0;o<n;++o)for(var s,a=t[o],l=a.length,c=0;c<l;++c)(s=a[c])&&(i.push(e.call(s,s.__data__,c,a)),r.push(s));return new F_(i,r)},selectChild:function(e){return this.select(null==e?Pg:function(e){return function(){return Rg.call(this.children,e)}}("function"===typeof e?e:Ig(e)))},selectChildren:function(e){return this.selectAll(null==e?Fg:function(e){return function(){return Mg.call(this.children,e)}}("function"===typeof e?e:Ig(e)))},filter:function(e){"function"!==typeof e&&(e=Cg(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o,s=t[r],a=s.length,l=i[r]=[],c=0;c<a;++c)(o=s[c])&&e.call(o,o.__data__,c,s)&&l.push(o);return new F_(i,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,zg);var n=t?Bg:Og,i=this._parents,r=this._groups;"function"!==typeof e&&(e=function(e){return function(){return e}}(e));for(var o=r.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=i[c],h=r[c],d=h.length,f=Ng(e.call(u,u&&u.__data__,c,i)),p=f.length,m=a[c]=new Array(p),g=s[c]=new Array(p);n(u,h,m,g,l[c]=new Array(d),f,t);for(var _,y,v=0,x=0;v<p;++v)if(_=m[v]){for(v>=x&&(x=v+1);!(y=g[x])&&++x<p;);_._next=y||null}}return(s=new F_(s,i))._enter=a,s._exit=l,s},enter:function(){return new F_(this._enter||this._groups.map(Lg),this._parents)},exit:function(){return new F_(this._exit||this._groups.map(Lg),this._parents)},join:function(e,t,n){var i=this.enter(),r=this,o=this.exit();return"function"===typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,o=i.length,s=Math.min(r,o),a=new Array(r),l=0;l<s;++l)for(var c,u=n[l],h=i[l],d=u.length,f=a[l]=new Array(d),p=0;p<d;++p)(c=u[p]||h[p])&&(f[p]=c);for(;l<r;++l)a[l]=n[l];return new F_(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,r=e[t],o=r.length-1,s=r[o];--o>=0;)(i=r[o])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=Ug);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var s,a=n[o],l=a.length,c=r[o]=new Array(l),u=0;u<l;++u)(s=a[u])&&(c[u]=s);c.sort(t)}return new F_(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r,o=t[n],s=0,a=o.length;s<a;++s)(r=o[s])&&e.call(r,r.__data__,s,o);return this},attr:function(e,t){var n=Gg(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?Wg:Hg:"function"===typeof t?n.local?Yg:Zg:n.local?Xg:qg)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?Jg:"function"===typeof t?$g:Qg)(e,t,null==n?"":n)):e_(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?t_:"function"===typeof t?i_:n_)(e,t)):this.node()[e]},classed:function(e,t){var n=r_(e+"");if(arguments.length<2){for(var i=o_(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"===typeof t?h_:t?c_:u_)(n,t))},text:function(e){return arguments.length?this.each(null==e?d_:("function"===typeof e?p_:f_)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?m_:("function"===typeof e?__:g_)(e)):this.node().innerHTML},raise:function(){return this.each(y_)},lower:function(){return this.each(v_)},append:function(e){var t="function"===typeof e?e:w_(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"===typeof e?e:w_(e),i=null==t?E_:"function"===typeof t?t:Tg(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(T_)},clone:function(e){return this.select(e?S_:A_)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,r,o=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),s=o.length;if(!(arguments.length<2)){for(a=t?C_:D_,i=0;i<s;++i)this.each(a(o[i],t,n));return this}var a=this.node().__on;if(a)for(var l,c=0,u=a.length;c<u;++c)for(i=0,l=a[c];i<s;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"===typeof t?P_:R_)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i,r=e[t],o=0,s=r.length;o<s;++o)(i=r[o])&&(yield i)}};const k_=L_;var O_={value:()=>{}};function B_(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new z_(i)}function z_(e){this._=e}function N_(e,t){for(var n,i=0,r=e.length;i<r;++i)if((n=e[i]).name===t)return n.value}function U_(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=O_,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}z_.prototype=B_.prototype={constructor:z_,on:function(e,t){var n,i,r=this._,o=(i=r,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!i.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),s=-1,a=o.length;if(!(arguments.length<2)){if(null!=t&&"function"!==typeof t)throw new Error("invalid callback: "+t);for(;++s<a;)if(n=(e=o[s]).type)r[n]=U_(r[n],e.name,t);else if(null==t)for(n in r)r[n]=U_(r[n],e.name,null);return this}for(;++s<a;)if((n=(e=o[s]).type)&&(n=N_(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new z_(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),o=0;o<n;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=0,n=(i=this._[e]).length;o<n;++o)i[o].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};const V_=B_;var j_,G_,H_=0,W_=0,q_=0,X_=0,Z_=0,Y_=0,K_="object"===typeof performance&&performance.now?performance:Date,J_="object"===typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Q_(){return Z_||(J_($_),Z_=K_.now()+Y_)}function $_(){Z_=0}function ey(){this._call=this._time=this._next=null}function ty(e,t,n){var i=new ey;return i.restart(e,t,n),i}function ny(){Z_=(X_=K_.now())+Y_,H_=W_=0;try{!function(){Q_(),++H_;for(var e,t=j_;t;)(e=Z_-t._time)>=0&&t._call.call(void 0,e),t=t._next;--H_}()}finally{H_=0,function(){var e,t,n=j_,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:j_=t);G_=e,ry(i)}(),Z_=0}}function iy(){var e=K_.now(),t=e-X_;t>1e3&&(Y_-=t,X_=e)}function ry(e){H_||(W_&&(W_=clearTimeout(W_)),e-Z_>24?(e<1/0&&(W_=setTimeout(ny,e-K_.now()-Y_)),q_&&(q_=clearInterval(q_))):(q_||(X_=K_.now(),q_=setInterval(iy,1e3)),H_=1,J_(ny)))}function oy(e,t,n){var i=new ey;return t=null==t?0:+t,i.restart(n=>{i.stop(),e(n+t)},t,n),i}ey.prototype=ty.prototype={constructor:ey,restart:function(e,t,n){if("function"!==typeof e)throw new TypeError("callback is not a function");n=(null==n?Q_():+n)+(null==t?0:+t),this._next||G_===this||(G_?G_._next=this:j_=this,G_=this),this._call=e,this._time=n,ry()},stop:function(){this._call&&(this._call=null,this._time=1/0,ry())}};var sy=V_("start","end","cancel","interrupt"),ay=[];function ly(e,t,n,i,r,o){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function(e,t,n){var i,r=e.__transition;function o(e){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=e&&s(e-n.delay)}function s(o){var c,u,h,d;if(1!==n.state)return l();for(c in r)if((d=r[c]).name===n.name){if(3===d.state)return oy(s);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete r[c]):+c<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete r[c])}if(oy(function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(o))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(i[++u]=d);i.length=u+1}}function a(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(l),n.state=5,1),o=-1,s=i.length;++o<s;)i[o].call(e,r);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){for(var i in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=ty(o,0,n.time)}(e,n,{name:t,index:i,group:r,on:sy,tween:ay,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function cy(e,t){var n=hy(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function uy(e,t){var n=hy(e,t);if(n.state>3)throw new Error("too late; already running");return n}function hy(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function dy(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var fy,py=180/Math.PI,my={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function gy(e,t,n,i,r,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*py,skewX:Math.atan(l)*py,scaleX:s,scaleY:a}}function _y(e,t,n,i){function r(e){return e.length?e.pop()+" ":""}return function(o,s){var a=[],l=[];return o=e(o),s=e(s),function(e,i,r,o,s,a){if(e!==r||i!==o){var l=s.push("translate(",null,t,null,n);a.push({i:l-4,x:dy(e,r)},{i:l-2,x:dy(i,o)})}else(r||o)&&s.push("translate("+r+t+o+n)}(o.translateX,o.translateY,s.translateX,s.translateY,a,l),function(e,t,n,o){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),o.push({i:n.push(r(n)+"rotate(",null,i)-2,x:dy(e,t)})):t&&n.push(r(n)+"rotate("+t+i)}(o.rotate,s.rotate,a,l),function(e,t,n,o){e!==t?o.push({i:n.push(r(n)+"skewX(",null,i)-2,x:dy(e,t)}):t&&n.push(r(n)+"skewX("+t+i)}(o.skewX,s.skewX,a,l),function(e,t,n,i,o,s){if(e!==n||t!==i){var a=o.push(r(o)+"scale(",null,",",null,")");s.push({i:a-4,x:dy(e,n)},{i:a-2,x:dy(t,i)})}else 1===n&&1===i||o.push(r(o)+"scale("+n+","+i+")")}(o.scaleX,o.scaleY,s.scaleX,s.scaleY,a,l),o=s=null,function(e){for(var t,n=-1,i=l.length;++n<i;)a[(t=l[n]).i]=t.x(e);return a.join("")}}}var yy=_y(function(e){const t=new("function"===typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?my:gy(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),vy=_y(function(e){return null==e?my:(fy||(fy=document.createElementNS("http://www.w3.org/2000/svg","g")),fy.setAttribute("transform",e),(e=fy.transform.baseVal.consolidate())?gy((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):my)},", ",")",")");function xy(e,t){var n,i;return function(){var r=uy(this,e),o=r.tween;if(o!==n)for(var s=0,a=(i=n=o).length;s<a;++s)if(i[s].name===t){(i=i.slice()).splice(s,1);break}r.tween=i}}function by(e,t,n){var i,r;if("function"!==typeof n)throw new Error;return function(){var o=uy(this,e),s=o.tween;if(s!==i){r=(i=s).slice();for(var a={name:t,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===t){r[l]=a;break}l===c&&r.push(a)}o.tween=r}}function wy(e,t,n){var i=e._id;return e.each(function(){var e=uy(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return hy(e,i).value[t]}}function Ey(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ty(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Ay(){}var Sy=.7,Dy=1/Sy,Cy="\\s*([+-]?\\d+)\\s*",Iy="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ry="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Py=/^#([0-9a-f]{3,8})$/,My=new RegExp("^rgb\\(".concat(Cy,",").concat(Cy,",").concat(Cy,"\\)$")),Fy=new RegExp("^rgb\\(".concat(Ry,",").concat(Ry,",").concat(Ry,"\\)$")),Ly=new RegExp("^rgba\\(".concat(Cy,",").concat(Cy,",").concat(Cy,",").concat(Iy,"\\)$")),ky=new RegExp("^rgba\\(".concat(Ry,",").concat(Ry,",").concat(Ry,",").concat(Iy,"\\)$")),Oy=new RegExp("^hsl\\(".concat(Iy,",").concat(Ry,",").concat(Ry,"\\)$")),By=new RegExp("^hsla\\(".concat(Iy,",").concat(Ry,",").concat(Ry,",").concat(Iy,"\\)$")),zy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ny(){return this.rgb().formatHex()}function Uy(){return this.rgb().formatRgb()}function Vy(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Py.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?jy(t):3===n?new Wy(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Gy(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Gy(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=My.exec(e))?new Wy(t[1],t[2],t[3],1):(t=Fy.exec(e))?new Wy(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Ly.exec(e))?Gy(t[1],t[2],t[3],t[4]):(t=ky.exec(e))?Gy(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Oy.exec(e))?Jy(t[1],t[2]/100,t[3]/100,1):(t=By.exec(e))?Jy(t[1],t[2]/100,t[3]/100,t[4]):zy.hasOwnProperty(e)?jy(zy[e]):"transparent"===e?new Wy(NaN,NaN,NaN,0):null}function jy(e){return new Wy(e>>16&255,e>>8&255,255&e,1)}function Gy(e,t,n,i){return i<=0&&(e=t=n=NaN),new Wy(e,t,n,i)}function Hy(e,t,n,i){return 1===arguments.length?function(e){return e instanceof Ay||(e=Vy(e)),e?new Wy((e=e.rgb()).r,e.g,e.b,e.opacity):new Wy}(e):new Wy(e,t,n,null==i?1:i)}function Wy(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function qy(){return"#".concat(Ky(this.r)).concat(Ky(this.g)).concat(Ky(this.b))}function Xy(){const e=Zy(this.opacity);return"".concat(1===e?"rgb(":"rgba(").concat(Yy(this.r),", ").concat(Yy(this.g),", ").concat(Yy(this.b)).concat(1===e?")":", ".concat(e,")"))}function Zy(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Yy(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ky(e){return((e=Yy(e))<16?"0":"")+e.toString(16)}function Jy(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new $y(e,t,n,i)}function Qy(e){if(e instanceof $y)return new $y(e.h,e.s,e.l,e.opacity);if(e instanceof Ay||(e=Vy(e)),!e)return new $y;if(e instanceof $y)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),s=NaN,a=o-r,l=(o+r)/2;return a?(s=t===o?(n-i)/a+6*(n<i):n===o?(i-t)/a+2:(t-n)/a+4,a/=l<.5?o+r:2-o-r,s*=60):a=l>0&&l<1?0:s,new $y(s,a,l,e.opacity)}function $y(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function ev(e){return(e=(e||0)%360)<0?e+360:e}function tv(e){return Math.max(0,Math.min(1,e||0))}function nv(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function iv(e,t,n,i,r){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*n+(1+3*e+3*o-3*s)*i+s*r)/6}Ey(Ay,Vy,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Ny,formatHex:Ny,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Qy(this).formatHsl()},formatRgb:Uy,toString:Uy}),Ey(Wy,Hy,Ty(Ay,{brighter(e){return e=null==e?Dy:Math.pow(Dy,e),new Wy(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Sy:Math.pow(Sy,e),new Wy(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Wy(Yy(this.r),Yy(this.g),Yy(this.b),Zy(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:qy,formatHex:qy,formatHex8:function(){return"#".concat(Ky(this.r)).concat(Ky(this.g)).concat(Ky(this.b)).concat(Ky(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:Xy,toString:Xy})),Ey($y,function(e,t,n,i){return 1===arguments.length?Qy(e):new $y(e,t,n,null==i?1:i)},Ty(Ay,{brighter(e){return e=null==e?Dy:Math.pow(Dy,e),new $y(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Sy:Math.pow(Sy,e),new $y(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new Wy(nv(e>=240?e-240:e+120,r,i),nv(e,r,i),nv(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new $y(ev(this.h),tv(this.s),tv(this.l),Zy(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Zy(this.opacity);return"".concat(1===e?"hsl(":"hsla(").concat(ev(this.h),", ").concat(100*tv(this.s),"%, ").concat(100*tv(this.l),"%").concat(1===e?")":", ".concat(e,")"))}}));const rv=e=>()=>e;function ov(e,t){return function(n){return e+n*t}}function sv(e){return 1===(e=+e)?av:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):rv(isNaN(t)?n:t)}}function av(e,t){var n=t-e;return n?ov(e,n):rv(isNaN(e)?t:e)}const lv=function e(t){var n=sv(t);function i(e,t){var i=n((e=Hy(e)).r,(t=Hy(t)).r),r=n(e.g,t.g),o=n(e.b,t.b),s=av(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=r(t),e.b=o(t),e.opacity=s(t),e+""}}return i.gamma=e,i}(1);function cv(e){return function(t){var n,i,r=t.length,o=new Array(r),s=new Array(r),a=new Array(r);for(n=0;n<r;++n)i=Hy(t[n]),o[n]=i.r||0,s[n]=i.g||0,a[n]=i.b||0;return o=e(o),s=e(s),a=e(a),i.opacity=1,function(e){return i.r=o(e),i.g=s(e),i.b=a(e),i+""}}}var uv=cv(function(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],o=e[i+1],s=i>0?e[i-1]:2*r-o,a=i<t-1?e[i+2]:2*o-r;return iv((n-i/t)*t,s,r,o,a)}}),hv=(cv(function(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],o=e[i%t],s=e[(i+1)%t],a=e[(i+2)%t];return iv((n-i/t)*t,r,o,s,a)}}),/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g),dv=new RegExp(hv.source,"g");function fv(e,t){var n,i,r,o=hv.lastIndex=dv.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=hv.exec(e))&&(i=dv.exec(t));)(r=i.index)>o&&(r=t.slice(o,r),a[s]?a[s]+=r:a[++s]=r),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:dy(n,i)})),o=dv.lastIndex;return o<t.length&&(r=t.slice(o),a[s]?a[s]+=r:a[++s]=r),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,i=0;i<t;++i)a[(n=l[i]).i]=n.x(e);return a.join("")})}function pv(e,t){var n;return("number"===typeof t?dy:t instanceof Vy?lv:(n=Vy(t))?(t=n,lv):fv)(e,t)}function mv(e){return function(){this.removeAttribute(e)}}function gv(e){return function(){this.removeAttributeNS(e.space,e.local)}}function _v(e,t,n){var i,r,o=n+"";return function(){var s=this.getAttribute(e);return s===o?null:s===i?r:r=t(i=s,n)}}function yv(e,t,n){var i,r,o=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===i?r:r=t(i=s,n)}}function vv(e,t,n){var i,r,o;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttribute(e))===(a=l+"")?null:s===i&&a===r?o:(r=a,o=t(i=s,l));this.removeAttribute(e)}}function xv(e,t,n){var i,r,o;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:s===i&&a===r?o:(r=a,o=t(i=s,l));this.removeAttributeNS(e.space,e.local)}}function bv(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,r)),n}return r._value=t,r}function wv(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,r)),n}return r._value=t,r}function Ev(e,t){return function(){cy(this,e).delay=+t.apply(this,arguments)}}function Tv(e,t){return t=+t,function(){cy(this,e).delay=t}}function Av(e,t){return function(){uy(this,e).duration=+t.apply(this,arguments)}}function Sv(e,t){return t=+t,function(){uy(this,e).duration=t}}var Dv=k_.prototype.constructor;function Cv(e){return function(){this.style.removeProperty(e)}}var Iv=0;function Rv(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function Pv(){return++Iv}var Mv=k_.prototype;Rv.prototype=function(e){return k_().transition(e)}.prototype={constructor:Rv,select:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=Tg(e));for(var i=this._groups,r=i.length,o=new Array(r),s=0;s<r;++s)for(var a,l,c=i[s],u=c.length,h=o[s]=new Array(u),d=0;d<u;++d)(a=c[d])&&(l=e.call(a,a.__data__,d,c))&&("__data__"in a&&(l.__data__=a.__data__),h[d]=l,ly(h[d],t,n,d,h,hy(a,n)));return new Rv(o,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=Sg(e));for(var i=this._groups,r=i.length,o=[],s=[],a=0;a<r;++a)for(var l,c=i[a],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var d,f=e.call(l,l.__data__,h,c),p=hy(l,n),m=0,g=f.length;m<g;++m)(d=f[m])&&ly(d,t,n,m,f,p);o.push(f),s.push(l)}return new Rv(o,s,t,n)},selectChild:Mv.selectChild,selectChildren:Mv.selectChildren,filter:function(e){"function"!==typeof e&&(e=Cg(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o,s=t[r],a=s.length,l=i[r]=[],c=0;c<a;++c)(o=s[c])&&e.call(o,o.__data__,c,s)&&l.push(o);return new Rv(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,o=Math.min(i,r),s=new Array(i),a=0;a<o;++a)for(var l,c=t[a],u=n[a],h=c.length,d=s[a]=new Array(h),f=0;f<h;++f)(l=c[f]||u[f])&&(d[f]=l);for(;a<i;++a)s[a]=t[a];return new Rv(s,this._parents,this._name,this._id)},selection:function(){return new Dv(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=Pv(),i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],l=a.length,c=0;c<l;++c)if(s=a[c]){var u=hy(s,t);ly(s,e,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Rv(i,this._parents,e,n)},call:Mv.call,nodes:Mv.nodes,node:Mv.node,size:Mv.size,empty:Mv.empty,each:Mv.each,on:function(e,t){var n=this._id;return arguments.length<2?hy(this.node(),n).on.on(e):this.each(function(e,t,n){var i,r,o=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?cy:uy;return function(){var s=o(this,e),a=s.on;a!==i&&(r=(i=a).copy()).on(t,n),s.on=r}}(n,e,t))},attr:function(e,t){var n=Gg(e),i="transform"===n?vy:pv;return this.attrTween(e,"function"===typeof t?(n.local?xv:vv)(n,i,wy(this,"attr."+e,t)):null==t?(n.local?gv:mv)(n):(n.local?yv:_v)(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!==typeof t)throw new Error;var i=Gg(e);return this.tween(n,(i.local?bv:wv)(i,t))},style:function(e,t,n){var i="transform"===(e+="")?yy:pv;return null==t?this.styleTween(e,function(e,t){var n,i,r;return function(){var o=e_(this,e),s=(this.style.removeProperty(e),e_(this,e));return o===s?null:o===n&&s===i?r:r=t(n=o,i=s)}}(e,i)).on("end.style."+e,Cv(e)):"function"===typeof t?this.styleTween(e,function(e,t,n){var i,r,o;return function(){var s=e_(this,e),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(e),l=a=e_(this,e)),s===l?null:s===i&&l===r?o:(r=l,o=t(i=s,a))}}(e,i,wy(this,"style."+e,t))).each(function(e,t){var n,i,r,o,s="style."+t,a="end."+s;return function(){var l=uy(this,e),c=l.on,u=null==l.value[s]?o||(o=Cv(t)):void 0;c===n&&r===u||(i=(n=c).copy()).on(a,r=u),l.on=i}}(this._id,e)):this.styleTween(e,function(e,t,n){var i,r,o=n+"";return function(){var s=e_(this,e);return s===o?null:s===i?r:r=t(i=s,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!==typeof t)throw new Error;return this.tween(i,function(e,t,n){var i,r;function o(){var o=t.apply(this,arguments);return o!==r&&(i=(r=o)&&function(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}(e,o,n)),i}return o._value=t,o}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"===typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(wy(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!==typeof e)throw new Error;return this.tween(t,function(e){var t,n;function i(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&function(e){return function(t){this.textContent=e.call(this,t)}}(i)),t}return i._value=e,i}(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i,r=hy(this.node(),n).tween,o=0,s=r.length;o<s;++o)if((i=r[o]).name===e)return i.value;return null}return this.each((null==t?xy:by)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?Ev:Tv)(t,e)):hy(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?Av:Sv)(t,e)):hy(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!==typeof t)throw new Error;return function(){uy(this,e).ease=t}}(t,e)):hy(this.node(),t).ease},easeVarying:function(e){if("function"!==typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!==typeof n)throw new Error;uy(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(o,s){var a={value:s},l={value:function(){0===--r&&o()}};n.each(function(){var n=uy(this,i),r=n.on;r!==e&&((t=(e=r).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t}),0===r&&o()})},[Symbol.iterator]:Mv[Symbol.iterator]};var Fv={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Lv(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error("transition ".concat(t," not found"));return n}k_.prototype.interrupt=function(e){return this.each(function(){!function(e,t){var n,i,r,o=e.__transition,s=!0;if(o){for(r in t=null==t?null:t+"",o)(n=o[r]).name===t?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete o[r]):s=!1;s&&delete e.__transition}}(this,e)})},k_.prototype.transition=function(e){var t,n;e instanceof Rv?(t=e._id,e=e._name):(t=Pv(),(n=Fv).time=Q_(),e=null==e?null:e+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],l=a.length,c=0;c<l;++c)(s=a[c])&&ly(s,e,t,c,a,n||Lv(s,t));return new Rv(i,this._parents,e,t)};const{abs:kv,max:Ov,min:Bv}=Math;function zv(e){return[+e[0],+e[1]]}function Nv(e){return[zv(e[0]),zv(e[1])]}["w","e"].map(Uv),["n","s"].map(Uv),["n","w","e","s","nw","ne","sw","se"].map(Uv);function Uv(e){return{type:e}}const Vv=Math.sqrt(50),jv=Math.sqrt(10),Gv=Math.sqrt(2);function Hv(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),s=o>=Vv?10:o>=jv?5:o>=Gv?2:1;let a,l,c;return r<0?(c=Math.pow(10,-r)/s,a=Math.round(e*c),l=Math.round(t*c),a/c<e&&++a,l/c>t&&--l,c=-c):(c=Math.pow(10,r)*s,a=Math.round(e/c),l=Math.round(t/c),a*c<e&&++a,l*c>t&&--l),l<a&&.5<=n&&n<2?Hv(e,t,2*n):[a,l,c]}function Wv(e,t,n){if(!((n=+n)>0))return[];if((e=+e)===(t=+t))return[e];const i=t<e,[r,o,s]=i?Hv(t,e,n):Hv(e,t,n);if(!(o>=r))return[];const a=o-r+1,l=new Array(a);if(i)if(s<0)for(let c=0;c<a;++c)l[c]=(o-c)/-s;else for(let c=0;c<a;++c)l[c]=(o-c)*s;else if(s<0)for(let c=0;c<a;++c)l[c]=(r+c)/-s;else for(let c=0;c<a;++c)l[c]=(r+c)*s;return l}function qv(e,t,n){return Hv(e=+e,t=+t,n=+n)[2]}function Xv(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Zv(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Yv(e){let t,n,i;function r(e,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(r<o){if(0!==t(i,i))return o;do{const t=r+o>>>1;n(e[t],i)<0?r=t+1:o=t}while(r<o)}return r}return 2!==e.length?(t=Xv,n=(t,n)=>Xv(e(t),n),i=(t,n)=>e(t)-n):(t=e===Xv||e===Zv?e:Kv,n=e,i=e),{left:r,center:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=r(e,t,n,(arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length)-1);return o>n&&i(e[o-1],t)>-i(e[o],t)?o-1:o},right:function(e,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(r<o){if(0!==t(i,i))return o;do{const t=r+o>>>1;n(e[t],i)<=0?r=t+1:o=t}while(r<o)}return r}}}function Kv(){return 0}const Jv=Yv(Xv),Qv=Jv.right,$v=(Jv.left,Yv(function(e){return null===e?NaN:+e}).center,Qv);function ex(e,t){var n,i=t?t.length:0,r=e?Math.min(i,e.length):0,o=new Array(r),s=new Array(i);for(n=0;n<r;++n)o[n]=rx(e[n],t[n]);for(;n<i;++n)s[n]=t[n];return function(e){for(n=0;n<r;++n)s[n]=o[n](e);return s}}function tx(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function nx(e,t){var n,i={},r={};for(n in null!==e&&"object"===typeof e||(e={}),null!==t&&"object"===typeof t||(t={}),t)n in e?i[n]=rx(e[n],t[n]):r[n]=t[n];return function(e){for(n in i)r[n]=i[n](e);return r}}function ix(e,t){t||(t=[]);var n,i=e?Math.min(t.length,e.length):0,r=t.slice();return function(o){for(n=0;n<i;++n)r[n]=e[n]*(1-o)+t[n]*o;return r}}function rx(e,t){var n,i=typeof t;return null==t||"boolean"===i?rv(t):("number"===i?dy:"string"===i?(n=Vy(t))?(t=n,lv):fv:t instanceof Vy?lv:t instanceof Date?tx:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?ix:Array.isArray(t)?ex:"function"!==typeof t.valueOf&&"function"!==typeof t.toString||isNaN(t)?nx:dy)(e,t)}function ox(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function sx(e){return+e}var ax=[0,1];function lx(e){return e}function cx(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function ux(e,t,n){var i=e[0],r=e[1],o=t[0],s=t[1];return r<i?(i=cx(r,i),o=n(s,o)):(i=cx(i,r),o=n(o,s)),function(e){return o(i(e))}}function hx(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),o=new Array(i),s=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<i;)r[s]=cx(e[s],e[s+1]),o[s]=n(t[s],t[s+1]);return function(t){var n=$v(e,t,1,i)-1;return o[n](r[n](t))}}function dx(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function fx(){var e,t,n,i,r,o,s=ax,a=ax,l=rx,c=lx;function u(){var e=Math.min(s.length,a.length);return c!==lx&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(s[0],s[e-1])),i=e>2?hx:ux,r=o=null,h}function h(t){return null==t||isNaN(t=+t)?n:(r||(r=i(s.map(e),a,l)))(e(c(t)))}return h.invert=function(n){return c(t((o||(o=i(a,s.map(e),dy)))(n)))},h.domain=function(e){return arguments.length?(s=Array.from(e,sx),u()):s.slice()},h.range=function(e){return arguments.length?(a=Array.from(e),u()):a.slice()},h.rangeRound=function(e){return a=Array.from(e),l=ox,u()},h.clamp=function(e){return arguments.length?(c=!!e||lx,u()):c!==lx},h.interpolate=function(e){return arguments.length?(l=e,u()):l},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,i){return e=n,t=i,u()}}function px(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function mx(e,t){switch(arguments.length){case 0:break;case 1:"function"===typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"===typeof t?this.interpolator(t):this.range(t)}return this}var gx,_x=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function yx(e){if(!(t=_x.exec(e)))throw new Error("invalid format: "+e);var t;return new vx({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function vx(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function xx(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function bx(e){return(e=xx(Math.abs(e)))?e[1]:NaN}function wx(e,t){var n=xx(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}yx.prototype=vx.prototype,vx.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Ex={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>wx(100*e,t),r:wx,s:function(e,t){var n=xx(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(gx=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+xx(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Tx(e){return e}var Ax,Sx,Dx,Cx=Array.prototype.map,Ix=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function Rx(e){var t,n,i=void 0===e.grouping||void 0===e.thousands?Tx:(t=Cx.call(e.grouping,Number),n=e.thousands+"",function(e,i){for(var r=e.length,o=[],s=0,a=t[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),o.push(e.substring(r-=a,r+a)),!((l+=a+1)>i));)a=t[s=(s+1)%t.length];return o.reverse().join(n)}),r=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?Tx:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(Cx.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"\u2212":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=yx(e)).fill,n=e.align,h=e.sign,d=e.symbol,f=e.zero,p=e.width,m=e.comma,g=e.precision,_=e.trim,y=e.type;"n"===y?(m=!0,y="g"):Ex[y]||(void 0===g&&(g=12),_=!0,y="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var v="$"===d?r:"#"===d&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===d?o:/[%p]/.test(y)?l:"",b=Ex[y],w=/[defgprs%]/.test(y);function E(e){var r,o,l,d=v,E=x;if("c"===y)E=b(e)+E,e="";else{var T=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:b(Math.abs(e),g),_&&(e=function(e){e:for(var t,n=e.length,i=1,r=-1;i<n;++i)switch(e[i]){case".":r=t=i;break;case"0":0===r&&(r=i),t=i;break;default:if(!+e[i])break e;r>0&&(r=0)}return r>0?e.slice(0,r)+e.slice(t+1):e}(e)),T&&0===+e&&"+"!==h&&(T=!1),d=(T?"("===h?h:c:"-"===h||"("===h?"":h)+d,E=("s"===y?Ix[8+gx/3]:"")+E+(T&&"("===h?")":""),w)for(r=-1,o=e.length;++r<o;)if(48>(l=e.charCodeAt(r))||l>57){E=(46===l?s+e.slice(r+1):e.slice(r))+E,e=e.slice(0,r);break}}m&&!f&&(e=i(e,1/0));var A=d.length+e.length+E.length,S=A<p?new Array(p-A+1).join(t):"";switch(m&&f&&(e=i(S+e,S.length?p-E.length:1/0),S=""),n){case"<":e=d+e+E+S;break;case"=":e=d+S+e+E;break;case"^":e=S.slice(0,A=S.length>>1)+d+e+E+S.slice(A);break;default:e=S+d+e+E}return a(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),E.toString=function(){return e+""},E}return{format:h,formatPrefix:function(e,t){var n=h(((e=yx(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(bx(t)/3))),r=Math.pow(10,-i),o=Ix[8+i/3];return function(e){return n(r*e)+o}}}}function Px(e,t,n,i){var r,o=function(e,t,n){n=+n;const i=(t=+t)<(e=+e),r=i?qv(t,e,n):qv(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}(e,t,n);switch((i=yx(null==i?",f":i)).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(r=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(bx(t)/3)))-bx(Math.abs(e)))}(o,s))||(i.precision=r),Dx(i,s);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,bx(t)-bx(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=function(e){return Math.max(0,-bx(Math.abs(e)))}(o))||(i.precision=r-2*("%"===i.type))}return Sx(i)}function Mx(e){var t=e.domain;return e.ticks=function(e){var n=t();return Wv(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var i=t();return Px(i[0],i[i.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var i,r,o=t(),s=0,a=o.length-1,l=o[s],c=o[a],u=10;for(c<l&&(r=l,l=c,c=r,r=s,s=a,a=r);u-- >0;){if((r=qv(l,c,n))===i)return o[s]=l,o[a]=c,t(o);if(r>0)l=Math.floor(l/r)*r,c=Math.ceil(c/r)*r;else{if(!(r<0))break;l=Math.ceil(l*r)/r,c=Math.floor(c*r)/r}i=r}return e},e}function Fx(){var e=fx()(lx,lx);return e.copy=function(){return dx(e,Fx())},px.apply(e,arguments),Mx(e)}function Lx(e){return Math.log(e)}function kx(e){return Math.exp(e)}function Ox(e){return-Math.log(-e)}function Bx(e){return-Math.exp(-e)}function zx(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Nx(e){return(t,n)=>-e(-t,n)}function Ux(e){const t=e(Lx,kx),n=t.domain;let i,r,o=10;function s(){return i=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(o),r=function(e){return 10===e?zx:e===Math.E?Math.exp:t=>Math.pow(e,t)}(o),n()[0]<0?(i=Nx(i),r=Nx(r),e(Ox,Bx)):e(Lx,kx),t}return t.base=function(e){return arguments.length?(o=+e,s()):o},t.domain=function(e){return arguments.length?(n(e),s()):n()},t.ticks=e=>{const t=n();let s=t[0],a=t[t.length-1];const l=a<s;l&&([s,a]=[a,s]);let c,u,h=i(s),d=i(a);const f=null==e?10:+e;let p=[];if(!(o%1)&&d-h<f){if(h=Math.floor(h),d=Math.ceil(d),s>0){for(;h<=d;++h)for(c=1;c<o;++c)if(u=h<0?c/r(-h):c*r(h),!(u<s)){if(u>a)break;p.push(u)}}else for(;h<=d;++h)for(c=o-1;c>=1;--c)if(u=h>0?c/r(-h):c*r(h),!(u<s)){if(u>a)break;p.push(u)}2*p.length<f&&(p=Wv(s,a,f))}else p=Wv(h,d,Math.min(d-h,f)).map(r);return l?p.reverse():p},t.tickFormat=(e,n)=>{if(null==e&&(e=10),null==n&&(n=10===o?"s":","),"function"!==typeof n&&(o%1||null!=(n=yx(n)).precision||(n.trim=!0),n=Sx(n)),e===1/0)return n;const s=Math.max(1,o*e/t.ticks().length);return e=>{let t=e/r(Math.round(i(e)));return t*o<o-.5&&(t*=o),t<=s?n(e):""}},t.nice=()=>n(function(e,t){var n,i=0,r=(e=e.slice()).length-1,o=e[i],s=e[r];return s<o&&(n=i,i=r,r=n,n=o,o=s,s=n),e[i]=t.floor(o),e[r]=t.ceil(s),e}(n(),{floor:e=>r(Math.floor(i(e))),ceil:e=>r(Math.ceil(i(e)))})),t}function Vx(){const e=Ux(fx()).domain([1,10]);return e.copy=()=>dx(e,Vx()).base(e.base()),px.apply(e,arguments),e}function jx(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Gx(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Hx(e){return e<0?-e*e:e*e}function Wx(e){var t=e(lx,lx),n=1;return t.exponent=function(t){return arguments.length?1===(n=+t)?e(lx,lx):.5===n?e(Gx,Hx):e(jx(n),jx(1/n)):n},Mx(t)}function qx(){var e=Wx(fx());return e.copy=function(){return dx(e,qx()).exponent(e.exponent())},px.apply(e,arguments),e}function Xx(){return qx.apply(null,arguments).exponent(.5)}function Zx(){var e,t,n,i,r,o=0,s=1,a=lx,l=!1;function c(t){return null==t||isNaN(t=+t)?r:a(0===n?.5:(t=(i(t)-e)*n,l?Math.max(0,Math.min(1,t)):t))}function u(e){return function(t){var n,i;return arguments.length?([n,i]=t,a=e(n,i),c):[a(0),a(1)]}}return c.domain=function(r){return arguments.length?([o,s]=r,e=i(o=+o),t=i(s=+s),n=e===t?0:1/(t-e),c):[o,s]},c.clamp=function(e){return arguments.length?(l=!!e,c):l},c.interpolator=function(e){return arguments.length?(a=e,c):a},c.range=u(rx),c.rangeRound=u(ox),c.unknown=function(e){return arguments.length?(r=e,c):r},function(r){return i=r,e=r(o),t=r(s),n=e===t?0:1/(t-e),c}}function Yx(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Kx(){var e=Mx(Zx()(lx));return e.copy=function(){return Yx(e,Kx())},mx.apply(e,arguments)}Ax=Rx({thousands:",",grouping:[3],currency:["$",""]}),Sx=Ax.format,Dx=Ax.formatPrefix;var Jx=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(function(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(6*i,6*++i);return n});const Qx=(e=>uv(e[e.length-1]))(Jx);function $x(e,t,n){this.k=e,this.x=t,this.y=n}$x.prototype={constructor:$x,scale:function(e){return 1===e?this:new $x(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new $x(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};new $x(1,0,0);$x.prototype;var eb=n(579);c().accessToken="pk.eyJ1IjoiY2hyeXN0aTAyMDIiLCJhIjoiY21lMHF4cmplMDYyNDJqcTE1cTNtc2tpayJ9.Qjo1kSCg3d2J-XyRXkzKmQ";const tb=["data1.csv","data2.csv","data3.csv","data4.csv","data5.csv"],nb=128.6,ib=35.3,rb=4,ob=0,sb=0,ab="Sales";function lb(){var t,n;const i=(0,e.useRef)(null),r=(0,e.useRef)(null),o=(0,e.useRef)(null),s=(0,e.useRef)(null),l=(0,e.useRef)(null),u=(0,e.useRef)(null),[h,d]=(0,e.useState)({}),[f,p]=(0,e.useState)([]),[m,g]=(0,e.useState)(tb.reduce((e,t)=>a(a({},e),{},{[t]:!0}),{})),[_,y]=(0,e.useState)({arc:!0,scatter:!0,column:!0}),[v,x]=(0,e.useState)(""),[b,w]=(0,e.useState)({}),[E,T]=(0,e.useState)([0,100]),[A,S]=(0,e.useState)([0,100]);(0,e.useEffect)(()=>{S(e=>0===e[0]&&100===e[1]?E:e)},[E]);const[D]=(0,e.useState)(null),[C,I]=(0,e.useState)(null),[R,P]=(0,e.useState)(null);(0,e.useEffect)(()=>{(async()=>{try{const e=await Promise.all(tb.map(e=>fetch("".concat("","/data/").concat(e,"?v=").concat(Date.now())).then(e=>e.text()).then(t=>new Promise(n=>{wg().parse(t,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:t=>{var i;null!==(i=t.errors)&&void 0!==i&&i.length&&console.error("".concat(e," \ud30c\uc2f1 \uc624\ub958"),t.errors),n({file:e,rows:t.data||[]})}})})))),t={};e.forEach((e,n)=>{let{file:i,rows:r}=e;t[i]=r,0===n&&r.length&&p(Object.keys(r[0]))}),d(t)}catch(e){console.error("CSV \ub85c\ub4dc \uc2e4\ud328",e)}})()},[]);const M=(0,e.useMemo)(()=>{let e=[];for(const n of tb)m[n]&&h[n]&&(e=e.concat(h[n]));if(e.length){const t=e.map(e=>Number(e[ab])||0),n=Math.min(...t),i=Math.max(...t);Number.isFinite(n)&&Number.isFinite(i)&&(E[0]===n&&E[1]===i||(T([n,i]),(A[0]<n||A[1]>i)&&S([n,i])))}e=e.filter(e=>{const t=Number(e[ab])||0;return t>=A[0]&&t<=A[1]});for(const[n,i]of Object.entries(b))if(i&&i.values&&0!==i.values.length)if("text"===i.mode){const t=i.values.map(e=>(null!==e&&void 0!==e?e:"").toString().trim().toLowerCase()).filter(Boolean);t.length&&(e=e.filter(e=>t.some(t=>{var i;return(null!==(i=e[n])&&void 0!==i?i:"").toString().toLowerCase().includes(t)})))}else if("select"===i.mode){const t=new Set(i.values.map(e=>(null!==e&&void 0!==e?e:"").toString()));e=e.filter(e=>{var i;return t.has((null!==(i=e[n])&&void 0!==i?i:"").toString())})}const t=v.trim().toLowerCase();if(t){const n=t.split(":");if(2===n.length){const t=n[0],i=n[1];e=e.filter(e=>Object.entries(e).some(e=>{let[n,r]=e;return n.toLowerCase().includes(t)&&(null!==r&&void 0!==r?r:"").toString().toLowerCase().includes(i)}))}else{const n=t.split(/\s+/).filter(Boolean);e=e.filter(e=>n.every(t=>Object.values(e).some(e=>(null!==e&&void 0!==e?e:"").toString().toLowerCase().includes(t))))}}return e},[h,m,b,v,A,E]),F=(0,e.useMemo)(()=>{const e={};for(const t of f){const n=new Set;M.forEach(e=>{var i;return n.add((null!==(i=e[t])&&void 0!==i?i:"").toString())}),e[t]=Array.from(n).filter(e=>""!==e)}return e},[M,f]);(0,e.useEffect)(()=>{const e=new(c().Map)({container:i.current,style:"https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json",center:[nb,ib],zoom:rb,pitch:ob,bearing:sb});r.current=e,e.on("click",t=>{const n=e.queryRenderedFeatures(t.point);n.length?P(n[0]):(I(null),P(null))}),s.current=new Zm({id:"arc-layer",data:[]}),l.current=new tg({id:"scatter-layer",data:[]}),u.current=new xg({id:"column-layer",data:[]});const t=new vh({layers:[l.current,s.current,u.current]});return o.current=t,e.addControl(t),e.on("click",()=>P(null)),()=>e.remove()},[]);const L=(0,e.useMemo)(()=>{const e=M.map(e=>Number(e[ab])||0).filter(e=>e>=0),t=Math.min(...e),n=Math.max(...e),i=e.filter(e=>e>0),r=i.length?Math.min(...i):1,o=e.length?Math.max(...e):1,s=Math.min(r,1),a=Math.max(o,1),l=Vx().domain([s,a]).range([1,3]).clamp(!0),c=Vx().domain([s,a]).range([1e4,3e4]).clamp(!0),u=Fx().domain([t,n]).range([1e4,3e5]).clamp(!0),h=Xx().domain([s,a]).range([1e7,1e7]).clamp(!0),d=Kx(e=>{const t=Hy(Qx(.1+.8*e));return[t.r,t.g,t.b,200]}).domain([a,s]);return{widthScale:l,pointRadiusScale:c,columnHeightScale:u,columnRadiusScale:h,colorScale:d,domainMin:s,domainMax:a}},[M]);(0,e.useEffect)(()=>{if(!o.current)return;const e=e=>Number(e)>0?Number(e):L.domainMin,t=M.filter(e=>(e=>Number.isFinite(Number(e["Source Lat"]))&&Number.isFinite(Number(e["Source Lng"]))&&Number.isFinite(Number(e["Target Lat"]))&&Number.isFinite(Number(e["Target Lng"])))(e)),n=M.filter(e=>Number.isFinite(Number(e["Target Lat"]))&&Number.isFinite(Number(e["Target Lng"]))),i=n,r=new Zm({id:"arc-layer",data:_.arc?t:[],pickable:!0,getSourcePosition:e=>[Number(e["Source Lng"]),Number(e["Source Lat"])],getTargetPosition:e=>[Number(e["Target Lng"]),Number(e["Target Lat"])],getWidth:t=>L.widthScale(e(t[ab])),getHeight:e=>.5,getSourceColor:t=>L.colorScale(e(t[ab])),getTargetColor:t=>L.colorScale(e(t[ab])),fp64:!0,parameters:{depthTest:!1},coordinateSystem:eo.LNGLAT,pickingRadius:10,wrapLongitude:!0,onHover:e=>!R&&I(e.object?a(a({},e.object),{},{type:"arc",x:e.x,y:e.y}):null)}),c=[...n,...i].map(t=>e(t[ab])),h=Math.min(...c),d=Math.max(...c),f=Xx().domain([h,d]).range([2,12]),p=new tg({id:"scatter-layer",data:_.scatter?n:[],pickable:!0,radiusUnits:"pixels",getPosition:e=>[Number(e["Target Lng"]),Number(e["Target Lat"])],getRadius:t=>f(e(t[ab])),getFillColor:t=>L.colorScale(e(t[ab])),parameters:{depthTest:!1},wrapLongitude:!0,onHover:e=>!R&&I(e.object?a(a({},e.object),{},{type:"point",x:e.x,y:e.y}):null),onClick:e=>{var t;null!==e&&void 0!==e&&e.object?(null===(t=e.event)||void 0===t||t.stopPropagation(),P(a(a({},e.object),{},{type:"point",x:e.x,y:e.y}))):(I(null),P(null))}}),m=new xg({id:"column-layer",data:_.column?i:[],pickable:!0,diskResolution:12,radiusUnits:"meters",extruded:!0,radius:2e4,elevationScale:1,coverage:1,getPosition:e=>[Number(e["Target Lng"]),Number(e["Target Lat"])],getElevation:t=>2*L.columnHeightScale(e(t[ab])),getFillColor:t=>L.colorScale(e(t[ab])),parameters:{depthTest:!1},wrapLongitude:!0,onHover:e=>!R&&I(e.object?a(a({},e.object),{},{type:"column",x:e.x,y:e.y}):null),onClick:e=>{if(null!==e&&void 0!==e&&e.object){var t;null===(t=e.event)||void 0===t||t.stopPropagation();const n=a(a({},e.object),{},{x:e.x,y:e.y});(null===R||void 0===R?void 0:R.id)===e.object.id?P(null):P(n)}else P(null)}});s.current=r,l.current=p,u.current=m,o.current&&o.current.setProps({layers:[p,r,m],parameters:{depthRange:[0,1],nearZMultiplier:1e-8,farZMultiplier:10}}),o.current.setProps({layers:[p,r,m]})},[M,L,_,R]);const k=R||C,O=(0,e.useMemo)(()=>{if(!k)return[];const e=k,t=new Set(["x","y","type"]),n=f.length?f:Object.keys(e),i=[];for(const r of n)t.has(r)||r in e&&i.push([r,e[r]]);return i},[k,f]),B=e=>y(t=>a(a({},t),{},{[e]:!t[e]}));return(0,eb.jsxs)(eb.Fragment,{children:[(0,eb.jsxs)("div",{style:{position:"absolute",top:10,left:10,zIndex:10,background:"rgba(0,0,0,0.75)",color:"white",padding:10,borderRadius:6,width:"100%",maxWidth:360,maxHeight:"80vh",overflowX:"hidden",overflowY:"auto",boxShadow:"0 2px 10px rgba(0,0,0,0.35)"},children:[(0,eb.jsx)("h3",{style:{margin:"12px 0 6px"},children:"Search"}),(0,eb.jsx)("input",{type:"text",placeholder:"ex) Ford  or  Code:287504",value:v,onChange:e=>x(e.target.value),style:{width:"100%",padding:"6px 8px",borderRadius:4,border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",color:"white",boxSizing:"border-box"}}),(0,eb.jsx)("h3",{style:{margin:"12px 0 6px"},children:"Filters"}),f.length>0&&(0,eb.jsx)(cb,{headerOrder:f,uniqueValuesByCol:F,columnFilters:b,onChange:(e,t,n)=>{const i=(null!==n&&void 0!==n?n:"").toString().split(",").map(e=>e.trim()).filter(Boolean);w(n=>a(a({},n),{},{[e]:{mode:t,values:i}}))}}),(0,eb.jsx)("h3",{style:{margin:"12px 0 6px"},children:"Sales"}),(0,eb.jsxs)("div",{style:{fontSize:12,opacity:.9,marginBottom:6},children:["Range: ",A[0]," ~ ",A[1]," (min: ",E[0],", max: ",E[1],")"]}),(0,eb.jsxs)("div",{style:{display:"flex",gap:6},children:[(0,eb.jsx)("input",{type:"number",value:A[0],min:E[0],max:A[1],onChange:e=>S([Number(e.target.value),A[1]]),style:{width:"45%",padding:6,borderRadius:4,border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",color:"white"}}),(0,eb.jsx)("input",{type:"number",value:A[1],min:A[0],max:E[1],onChange:e=>S([A[0],Number(e.target.value)]),style:{width:"45%",padding:6,borderRadius:4,border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",color:"white"}})]}),(0,eb.jsxs)("div",{style:{display:"flex",gap:6,marginTop:6},children:[(0,eb.jsx)("input",{type:"range",min:E[0],max:E[1],step:"0.01",value:A[0],onChange:e=>S([Number(e.target.value),A[1]]),style:{flex:1}}),(0,eb.jsx)("input",{type:"range",min:E[0],max:E[1],step:"0.01",value:A[1],onChange:e=>S([A[0],Number(e.target.value)]),style:{flex:1}})]}),(0,eb.jsx)("h3",{style:{margin:"12px 0 6px"},children:"Layers"}),(0,eb.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[(0,eb.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,eb.jsx)("input",{type:"checkbox",checked:_.arc,onChange:()=>B("arc")}),(0,eb.jsx)("span",{children:"Arc"})]}),(0,eb.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,eb.jsx)("input",{type:"checkbox",checked:_.scatter,onChange:()=>B("scatter")}),(0,eb.jsx)("span",{children:"Scatter"})]}),(0,eb.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,eb.jsx)("input",{type:"checkbox",checked:_.column,onChange:()=>B("column")}),(0,eb.jsx)("span",{children:"Column"})]})]}),(0,eb.jsx)("div",{style:{marginTop:10,display:"flex",gap:8},children:(0,eb.jsx)("button",{onClick:()=>{x(""),w({}),S(E)},style:{padding:"6px 10px",borderRadius:4,border:"1px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.08)",color:"white"},children:"Reset All"})})]}),(0,eb.jsx)("div",{ref:i,style:{width:"100vw",height:"100vh"}}),L&&(0,eb.jsx)("div",{style:{position:"absolute",right:10,top:20,padding:6,background:"rgba(0,0,0,0.5)",borderRadius:6,color:"white",fontSize:12,zIndex:999},children:(0,eb.jsxs)("div",{style:{position:"relative",width:"200px",height:"30px",border:"0px solid rgba(255,255,255,0.3)",borderRadius:4,background:"linear-gradient(to left, ".concat([...Array(100)].map((e,t)=>{const n=t/99,i=Hy(Qx(.1+.8*n));return"rgb(".concat(i.r,",").concat(i.g,",").concat(i.b,") ").concat(100*n,"%")}).join(", "),")")},children:[(0,eb.jsx)("span",{style:{position:"absolute",left:4,top:"50%",transform:"translateY(-50%)",fontSize:14},children:L.domainMin.toLocaleString()}),(0,eb.jsx)("span",{style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",fontSize:14},children:L.domainMax.toLocaleString()})]})}),(D||R)&&(0,eb.jsx)("div",{style:{position:"absolute",pointerEvents:"auto",left:((null===R||void 0===R?void 0:R.x)||(null===D||void 0===D?void 0:D.x))+10,top:((null===R||void 0===R?void 0:R.y)||(null===D||void 0===D?void 0:D.y))+10,background:"white",padding:8,borderRadius:4,boxShadow:"0 2px 6px rgba(0,0,0,0.2)",fontSize:13,userSelect:"text"}}),k&&O.length>0&&(0,eb.jsxs)("div",{style:{position:"absolute",pointerEvents:"auto",left:null!==(t=k.x)&&void 0!==t?t:0,top:null!==(n=k.y)&&void 0!==n?n:0,transform:"translate(12px, 12px)",zIndex:9999,backgroundColor:"rgba(0,0,0,0.85)",color:"white",padding:"8px 12px",borderRadius:6,fontSize:13,maxWidth:420,userSelect:"text"},children:[(0,eb.jsx)("table",{style:{borderCollapse:"collapse"},children:(0,eb.jsx)("tbody",{children:O.map(e=>{var t,n;let[i,r]=e;return(0,eb.jsxs)("tr",{children:[(0,eb.jsx)("td",{style:{textAlign:"left",paddingRight:10,opacity:.9},children:i}),(0,eb.jsx)("td",{style:{textAlign:"right"},children:null!==(t=null===r||void 0===r||null===(n=r.toString)||void 0===n?void 0:n.call(r))&&void 0!==t?t:""})]},i)})})}),R&&(0,eb.jsx)("div",{style:{marginTop:6,textAlign:"right",opacity:.85},children:(0,eb.jsx)("button",{onClick:()=>{P(null),I(null)},style:{},children:"Click map or here to dismiss"})})]})]})}function cb(t){let{headerOrder:n,uniqueValuesByCol:i,columnFilters:r,onChange:o}=t;const[s,a]=(0,e.useState)(n[0]||""),[l,c]=(0,e.useState)(""),[u,h]=(0,e.useState)([]),[d,f]=(0,e.useState)(!1);(0,e.useEffect)(()=>{const e=r[s];c(""),e?"select"===e.mode?h(e.values||[]):"text"===e.mode?(h([]),c(e.values.join(", "))):h([]):h([])},[s,r]);const p=(0,e.useCallback)(()=>{u.length>0?o(s,"select",u.join(",")):""!==l.trim()?o(s,"text",l.trim()):o(s,null,null)},[s,u,l,o]);return(0,eb.jsxs)("div",{style:{display:"grid",gap:6},children:[(0,eb.jsxs)("div",{children:[(0,eb.jsx)("div",{style:{fontSize:12,marginBottom:4,opacity:.9},children:"Column"}),(0,eb.jsx)("select",{value:s,onChange:e=>a(e.target.value),style:{width:"100%",padding:6,borderRadius:4,background:"rgba(80,80,80,80.75)",color:"white",border:"1px solid rgba(255,255,255,0.25)"},children:n.map(e=>(0,eb.jsx)("option",{value:e,children:e},e))})]}),(0,eb.jsxs)("div",{style:{position:"relative"},children:[(0,eb.jsx)("div",{style:{fontSize:12,marginBottom:4,opacity:.9},children:"Values"}),(0,eb.jsx)("input",{type:"text",placeholder:"Type to search or enter text filter (e.g., A, B, C)...",value:l,onChange:e=>c(e.target.value),onFocus:()=>f(!0),onBlur:()=>setTimeout(()=>f(!1),150),style:{width:"100%",padding:"6px 8px",borderRadius:4,border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.1)",color:"white",boxSizing:"border-box"}}),d&&(0,eb.jsx)("div",{style:{position:"absolute",top:"100%",left:0,width:"100%",maxHeight:180,overflowY:"auto",background:"rgba(0,0,0,0.9)",color:"white",borderRadius:6,boxShadow:"0 2px 10px rgba(0,0,0,0.35)",zIndex:1e3,marginTop:2},children:(i[s]||[]).filter(e=>String(e).toLowerCase().includes(l.toLowerCase())).map(e=>(0,eb.jsx)("div",{onClick:()=>(e=>{h(t=>{const n=t.includes(e)?t.filter(t=>t!==e):[...t,e];return c(""),n})})(e),style:{padding:"6px 8px",cursor:"pointer",background:u.includes(e)?"rgba(255,255,255,0.2)":"transparent"},children:e},e))}),(0,eb.jsx)("div",{style:{marginTop:6,fontSize:12,opacity:.85},children:u.length>0?"Selected Values: ".concat(u.join(", ")):""!==l.trim()?'Text Filter: "'.concat(l.trim(),'"'):"No filter applied."}),(0,eb.jsxs)("div",{style:{display:"flex",gap:8,marginTop:10},children:[(0,eb.jsx)("button",{onClick:p,style:{padding:"6px 10px",borderRadius:4,border:"1px solid rgba(255,255,255,0.3)",background:"rgba(80,80,80,0.75)",color:"white"},children:"Apply"}),(0,eb.jsx)("button",{onClick:()=>{c(""),h([]),o(s,null,null)},style:{padding:"6px 10px",borderRadius:4,border:"1px solid rgba(255,255,255,0.3)",background:"rgba(80,80,80,0.75)",color:"white"},children:"Reset"})]})]})]})}const ub=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,453)).then(t=>{let{getCLS:n,getFID:i,getFCP:r,getLCP:o,getTTFB:s}=t;n(e),i(e),r(e),o(e),s(e)})};t.createRoot(document.getElementById("root")).render((0,eb.jsx)(e.StrictMode,{children:(0,eb.jsx)(lb,{})})),ub()})()})();
//# sourceMappingURL=main.20efbd2b.js.map